@interface CKChatController
+ (id)representationFromFileURL:(id)l;
+ (void)donateStickerToRecents:(id)recents;
+ (void)donateStickerToRecentsWithIdentifier:(id)identifier representations:(id)representations stickerEffectType:(int64_t)type externalURI:(id)i name:(id)name accessibilityLabel:(id)label metadata:(id)metadata ckAttributionInfo:(id)self0;
- (BOOL)_CKRunningInSOSBuddy;
- (BOOL)__shouldHideNavigationBarForThrowBalloonViewAttributesCollection:(id)collection inContainerView:(id)view framesOfAddedChatItems:(id)items;
- (BOOL)_allowsMultipleSelectionForMessage:(id)message;
- (BOOL)_anySuggestionPresenterWantsToShowBanner;
- (BOOL)_anyTranscriptBannerIsVisible;
- (BOOL)_backgroundEligibleForTranscriptDocking;
- (BOOL)_balloonViewOfCell:(id)cell containsPoint:(CGPoint)point fromView:(id)view;
- (BOOL)_canReloadEntryView;
- (BOOL)_canShowBackButtonView;
- (BOOL)_clickyOrbEnabled;
- (BOOL)_displayPreviewItemForMediaObject:(id)object;
- (BOOL)_dropSessionIsNewSticker:(id)sticker;
- (BOOL)_dropSessionIsTargetingEntryView:(id)view;
- (BOOL)_hasExistingBannerMatchingStyle:(unint64_t)style withNicknames:(id)nicknames;
- (BOOL)_hasJoinableCall;
- (BOOL)_hasPreviewViewControllerForChatItem:(id)item;
- (BOOL)_isFirstUnreadMessageVisibleForContentOffset:(CGPoint)offset;
- (BOOL)_lastAddressedHandleIsAvailableAsiMessageAlias:(id)alias SIMID:(id)d;
- (BOOL)_macShouldShowFaceTimeButtonInToolbar;
- (BOOL)_mediaObjectHasTrimMetadata:(id)metadata;
- (BOOL)_mediaObjectNeedsTrimming:(id)trimming;
- (BOOL)_noticeIsExpired:(id)expired;
- (BOOL)_point:(CGPoint)_point visuallyIntersectsBalloonViewInCollectionView:(id)view;
- (BOOL)_presentCollabInvalidFileProviderLocationAlertIfNecessaryForPayload:(id)payload collaborationType:(int64_t)type;
- (BOOL)_sharingAllowOthersToInviteFromOptionsGroups:(id)groups;
- (BOOL)_shouldCheckWithSafetyMonitor;
- (BOOL)_shouldConfigureChatItemMenuForCommSafety:(id)safety;
- (BOOL)_shouldHideNavigationBarForSendAnimationContext:(id)context;
- (BOOL)_shouldRestoreDraftState;
- (BOOL)_shouldRestoreFirstResponderAfterDetailsViewDismiss;
- (BOOL)_shouldShowNicknameOnboardingFlow;
- (BOOL)_shouldShowPollDetailsActionForChatItem:(id)item;
- (BOOL)_shouldShowReadReceiptAlert;
- (BOOL)_shouldShowSaveStickerActionForChatItem:(id)item;
- (BOOL)_shouldValidatePayloadBeforeSendingPayload:(id)payload;
- (BOOL)_showOrHideNicknameBannerIfNeeded;
- (BOOL)_transcriptScrollsOnEntryViewActivation;
- (BOOL)_wantsCatchUpAffordance;
- (BOOL)_wantsThreeColumnLayout;
- (BOOL)_wantsToShowCollaborationNotices;
- (BOOL)accountCanCreateNickname;
- (BOOL)actionPerformer:(id)performer transitionToViewController:(id)controller transitionType:(int64_t)type;
- (BOOL)allowDebugItems;
- (BOOL)allowEffectPickerToBePresented;
- (BOOL)allowsMentions;
- (BOOL)allowsNavigationBarTitleInteraction;
- (BOOL)appManagerDisplayedInMessages;
- (BOOL)appModalIsDisplayed;
- (BOOL)becomeFirstResponder;
- (BOOL)canBecomeFirstResponder;
- (BOOL)canPerformAction:(SEL)action withSender:(id)sender;
- (BOOL)chatFooterViewOffset:(double *)offset;
- (BOOL)chatInputControllerCanSend:(id)send;
- (BOOL)chatInputControllerShouldShowHandwriting:(id)handwriting;
- (BOOL)clearCommSafetyCompositionIfNecessary;
- (BOOL)clickInteractionShouldBegin:(id)begin;
- (BOOL)commitStickerAsTapback:(id)tapback;
- (BOOL)contextMenuInteractionIsOutsideOfVisibleBalloonCells:(id)cells;
- (BOOL)dragInteraction:(id)interaction sessionIsRestrictedToDraggingApplication:(id)application;
- (BOOL)dropInteraction:(id)interaction canHandleSession:(id)session;
- (BOOL)fullScreenBalloonViewControllerShouldShowHightlightButton:(id)button forChatItem:(id)item;
- (BOOL)fullScreenBalloonViewControllerShouldShowReplyButton:(id)button;
- (BOOL)gestureRecognizer:(id)recognizer shouldReceiveTouch:(id)touch;
- (BOOL)gestureRecognizer:(id)recognizer shouldRequireFailureOfGestureRecognizer:(id)gestureRecognizer;
- (BOOL)hasSelectedChatItems;
- (BOOL)hasSelectedChatItemsIncludingAssociatedTapback;
- (BOOL)inputAccessoryViewControllerEnabled;
- (BOOL)isChatControllerShowingStandaloneWindow:(id)window;
- (BOOL)isDetailsNavigationControllerDetached;
- (BOOL)isEditingMessage;
- (BOOL)isFullScreenBalloonViewOnScreen;
- (BOOL)isFunCamPresented;
- (BOOL)isHandwritingLandscape;
- (BOOL)isInlineReply;
- (BOOL)isKeyboardSnapshotVisible;
- (BOOL)isKeyboardSnapshotted;
- (BOOL)isMainTranscript;
- (BOOL)isSafeToMarkAsRead;
- (BOOL)isShowingBusinessOnboarding;
- (BOOL)isShowingOscarChat;
- (BOOL)isShowingReactWithAStickerOverlay;
- (BOOL)isUsingVisibleInputViewHeightWhenUpdatingScrollGeometry;
- (BOOL)keyboardIsQuickPathing;
- (BOOL)messageEditingViewController:(id)controller balloonHasTailForChatItemGuid:(id)guid;
- (BOOL)messageEntryView:(id)view shouldInsertMediaObjects:(id)objects;
- (BOOL)messageEntryViewWidth:(double *)width andOffset:(double *)offset;
- (BOOL)needsFooter;
- (BOOL)photosGridFullScreenBalloonViewControllerShouldShowReplyButton:(id)button;
- (BOOL)photosGridViewPresented;
- (BOOL)photosViewController:(id)controller didPickAssetReference:(id)reference;
- (BOOL)pluginButtonsEnabled;
- (BOOL)prefersBottomDividerHidden;
- (BOOL)prefersStatusBarHidden;
- (BOOL)presentUpdateBanner;
- (BOOL)previewController:(id)controller canShareItem:(id)item;
- (BOOL)previewController:(id)controller shouldDetectMachineReadableCodeForPreviewItem:(id)item;
- (BOOL)previewControllerIsInGroupConversation:(id)conversation;
- (BOOL)repositionSticker:(id)sticker stickerChatItem:(id)item parentMessagePartChatItem:(id)chatItem stickerPositioningInfo:(id)info;
- (BOOL)respondsToSelector:(SEL)selector;
- (BOOL)shouldAutorotate;
- (BOOL)shouldDismissKeyboardWhenShowingFullScreenAcknowledgmentPickerForBalloonChatItem:(id)item;
- (BOOL)shouldHideInteractionOptions;
- (BOOL)shouldListParticipantsInTitle;
- (BOOL)shouldNotShowGroupBanners;
- (BOOL)shouldOfferTranslateConversationInTranslateMenu;
- (BOOL)shouldPageSelectedChatItem;
- (BOOL)shouldPresentDetailsInInspector;
- (BOOL)shouldQuickLookChatItem:(id)item;
- (BOOL)shouldQuickLookSelectedChatItem;
- (BOOL)shouldShowAcceptedContactBanner;
- (BOOL)shouldShowAvatarViewInNavBarCanvas;
- (BOOL)shouldShowBanners;
- (BOOL)shouldShowEntryView;
- (BOOL)shouldShowFullScreenAcknowledgmentPickerForChatItem:(id)item;
- (BOOL)shouldShowReplyButtonForMediaObject:(id)object previewController:(id)controller;
- (BOOL)shouldShowTapbackPickerForChatItem:(id)item;
- (BOOL)shouldShowTipsWithAlignment:(int64_t)alignment;
- (BOOL)shouldUseMacConversationAvatarTitleView;
- (BOOL)shouldUseMinimumSafeAreas;
- (BOOL)shouldUseThrowAnimationForComposition:(id)composition;
- (BOOL)shouldViewDetailsForSelectedChatItem;
- (BOOL)showFullScreenAcknowledgmentPickerIfNeededForBalloonAtIndexPath:(id)path;
- (BOOL)showGroupBannerUpdateIfNeeded;
- (BOOL)showKeyboardForReply;
- (BOOL)showNicknameSharingOnboardingWithMemoji:(BOOL)memoji;
- (BOOL)showSendAlertIfNecessaryForComposition:(id)composition;
- (BOOL)throwAnimationUsesAnimatedReloadForMessages:(id)messages;
- (BOOL)transcriptCollectionViewController:(id)controller balloonView:(id)view shouldSelectChatItem:(id)item;
- (BOOL)transcriptCollectionViewController:(id)controller balloonViewDidRequestCommitPayload:(id)payload forPlugin:(id)plugin allowAllCommits:(BOOL)commits error:(id *)error;
- (BOOL)transcriptCollectionViewController:(id)controller balloonViewDidRequestCommitSticker:(id)sticker forPlugin:(id)plugin allowAllCommits:(BOOL)commits error:(id *)error;
- (BOOL)transcriptCollectionViewController:(id)controller balloonViewDidRequestSendCustomAcknowledgementPayload:(id)payload forPlugin:(id)plugin error:(id *)error;
- (BOOL)transcriptCollectionViewController:(id)controller shouldSetupFullscreenEffectUI:(id)i;
- (BOOL)transcriptCollectionViewControllerShouldPlayAudio:(id)audio;
- (BOOL)transcriptCollectionViewControllerShouldScrollToBottomForLocalSentMessage:(id)message;
- (BOOL)transcriptCollectionViewControllerShouldShouldScrollToTopForStatusBarTap:(id)tap;
- (BOOL)transcriptCollectionViewControllerShouldSuppressDockingBehavior:(id)behavior;
- (BOOL)wantsMessageRequestsTip;
- (CGAffineTransform)stickerPreviewTransform;
- (CGPoint)contentOffsetForFirstUnreadMessage;
- (CGPoint)fullScreenBalloonViewController:(id)controller stickerCenterForChatItem:(id)item;
- (CGPoint)initialContentOffset;
- (CGRect)_convertedNavigationBarFrameInSendAnimationContainerView:(id)view;
- (CGRect)_keyboardFrameAccountingForSalientTranscriptBackgroundRect:(CGRect)rect;
- (CGRect)_targetStickerFrameFromStickerCell:(id)cell coordinateSpace:(id)space;
- (CGRect)effectiveVisibleRectOfCollectionViewForTranscriptCollectionViewController:(id)controller;
- (CGRect)fullScreenBalloonViewController:(id)controller balloonFrameForChatItem:(id)item;
- (CGRect)fullScreenBalloonViewController:(id)controller stickerBoundsForChatItem:(id)item;
- (CGRect)fullScreenBalloonViewControllerSafeAreaLayoutFrame:(id)frame;
- (CGRect)fullScreenBalloonViewControllerSafeAreaLayoutFrameIgnoreEntryView:(id)view;
- (CGRect)inlineReplyController:(id)controller gradientFrameWithInsets:(UIEdgeInsets)insets;
- (CGRect)inputAccessoryViewFrameForFloatingKeyboard;
- (CGRect)messageEntryView:(id)view frameInThrowViewCoordinatesForView:(id)forView;
- (CGRect)photoGridTapbackSnapshotRect;
- (CGRect)photosGridFullScreenBalloonViewControllerSafeAreaLayoutFrame:(id)frame;
- (CGRect)previewController:(id)controller frameForPreviewItem:(id)item inSourceView:(id *)view;
- (CGRect)salientTranscriptBackgroundRect;
- (CGRect)screenFrameForNotification:(id)notification;
- (CGRect)throwAnimationWindowFrame:(id)frame;
- (CGSize)lastLaidOutSize;
- (CGSize)messageEntryViewMaxShelfPluginViewSize:(id)size;
- (CKAggregateAttachmentMessagePartChatItem)photoGridMomentShareChatItem;
- (CKCallButtonStateResolver)callStateResolver;
- (CKChatController)initWithConversation:(id)conversation;
- (CKChatControllerSendMenuDelegate)sendMenuDelegate;
- (CKComposition)composition;
- (CKExternalPluginViewControllerProvider)externalPluginControllerProvider;
- (CKMediaObjectAssetDataSourceManager)photoGridDataSourceManager;
- (CKMessageEntryView)entryView;
- (CKNavBarUnifiedCallButton)navBarFaceTimeCallButton;
- (CKOnboardingController)onboardingController;
- (CKTapbackPickerContainerAccessoryView)pickerContainerAccessoryView;
- (CKTranscriptCollectionView)collectionView;
- (CNContactPickerViewController)contactPicker;
- (Class)CKCloudSharingClass;
- (NSArray)internalBarButtonItems;
- (NSArray)keyCommands;
- (OS_dispatch_group)revealAnimationGroup;
- (UIEdgeInsets)_avoidanceInsets;
- (UIEdgeInsets)_contentInsetForSendAnimation;
- (UIEdgeInsets)_marginInsetsForEntryView;
- (UIEdgeInsets)additionalSafeAreaInsets;
- (UIEdgeInsets)adjustedContentInsetsForComputedInsets:(UIEdgeInsets)insets;
- (UIEdgeInsets)bannerInsets;
- (UIEdgeInsets)initialContentInset;
- (UIEdgeInsets)macToolbarInsets;
- (UIEdgeInsets)messageEditingViewController:(id)controller contentInsetsForChatItemGuid:(id)guid;
- (UIEdgeInsets)parentTranscriptContentInsetsForInlineReplyController:(id)controller;
- (UIEdgeInsets)virtualToolbarContentInsets;
- (UIView)previewSourceView;
- (UIView)recipientsVirtualToolbarItem;
- (UIViewController)walletOrderImportViewController;
- (_TtC7ChatKit29CKNavBarPersistentMenuManager)chatBotPersistentMenuManager;
- (char)messageEditingViewController:(id)controller colorTypeForChatItemGuid:(id)guid;
- (double)_currentScrollDelta;
- (double)_currentlyVisibleBannerHeight;
- (double)_expectedAppCardAndEntryViewHeight;
- (double)_keyboardHeightFromLayoutGuide;
- (double)_maxEntryViewHeight;
- (double)balloonMaxWidth;
- (double)bottomInsetPadding;
- (double)gradientBottomPlaceholderHeight;
- (double)minimumBottomInset;
- (double)throwAnimationManagerTopHeaderHeight:(id)height;
- (double)topInsetPadding;
- (double)transcriptCollectionViewController:(id)controller targetAlphaForChatItem:(id)item;
- (double)visibleInputViewHeight;
- (id)_addPollDetailsActionForChatItem:(id)item parentChatItem:(id)chatItem sourceView:(id)view;
- (id)_addStickerActionForChatItem:(id)item parentChatItem:(id)chatItem sourceView:(id)view;
- (id)_animationPropertiesToUseForUpdateAfterHoldForReason:(id)reason;
- (id)_animationPropertiesToUseInUpdateForReasons:(id)reasons followingHoldForReason:(id)reason;
- (id)_assetReferenceForDisplayedGridChatItem:(id)item selectionSnapshot:(id)snapshot;
- (id)_associatedStickerChatItemInInsertedIndexes:(id)indexes matchingSticker:(id)sticker;
- (id)_attributionFromHighlight:(id)highlight forChatGUID:(id)d;
- (id)_audioMessageThrowBalloonsForSendingMessages:(id)messages audioMessageSourceRect:(CGRect)rect contextContainerView:(id)view audioRecordingPillViewSnapshot:(id)snapshot;
- (id)_balloonViewForCellAtIndexPath:(id)path;
- (id)_chatItemForContextMenuWithConfiguration:(id)configuration;
- (id)_chatItemForMediaObject:(id)object;
- (id)_chatItemForReplyingToChatItem:(id)item explicitlySelected:(BOOL)selected;
- (id)_chatItemToEdit;
- (id)_compositionForEmojiSticker:(id)sticker mediaObject:(id)object;
- (id)_copyActionForChatItem:(id)item shouldUseTopMostChatItemIfAggregateChatItem:(BOOL)chatItem;
- (id)_debugSelectedGuidSummary;
- (id)_defaultTranscriptNavBarAppearance;
- (id)_deleteActionForChatItem:(id)item shouldUseTopMostChatItemIfAggregateChatItem:(BOOL)chatItem;
- (id)_deleteActionsForChatItem:(id)item;
- (id)_deleteMenuForChatItem:(id)item;
- (id)_downgradeMessageActionForChatItem:(id)item;
- (id)_dragInteraction:(id)interaction sessionPropertiesForSession:(id)session;
- (id)_dragItemsForInteraction:(id)interaction;
- (id)_dragItemsFromChatItem:(id)item balloonView:(id)view;
- (id)_dragItemsIfRepositioningForInteraction:(id)interaction;
- (id)_emojiDetailsActionForChatItem:(id)item;
- (id)_exportActionForChatItem:(id)item shouldUseTopMostChatItemIfAggregateChatItem:(BOOL)chatItem;
- (id)_exportActionsForChatItem:(id)item;
- (id)_exportMenuForChatItem:(id)item;
- (id)_fillColorForColorType:(char)type dynamicFillColor:(IMColorComponents)color;
- (id)_forwardActionForChatItem:(id)item;
- (id)_forwardAndCopyActionsForChatItem:(id)item;
- (id)_forwardAndCopyMenuForChatItem:(id)item;
- (id)_fullScreenBalloonViewControllerForPhotosGridViewWithChatItem:(id)item snapshotView:(id)view presentTapbackKeyboardInput:(BOOL)input;
- (id)_fullscreenEffectsManager;
- (id)_gridViewNavigationControllerForMomentShare:(id)share chatItem:(id)item tapbackManager:(id)manager;
- (id)_groupConversationContainingSharedURL:(id)l;
- (id)_highlightActionForChatItem:(id)item;
- (id)_inlineReplyActionForChatItem:(id)item;
- (id)_interfaceActionsForChatItem:(id)item;
- (id)_internalMenuForChatItem:(id)item;
- (id)_itemProvidersFromDragItems:(id)items;
- (id)_localizedTitleStringForAggregateAction:(int64_t)action numberOfPhotos:(int64_t)photos numberOfVideos:(int64_t)videos numberOfOther:(int64_t)other;
- (id)_makeInternalMenu;
- (id)_makeSnapshotForGlassKeyboardTargetView:(id)view afterScreenUpdates:(BOOL)updates;
- (id)_makeThrowBalloonsForSendAnimationWithType:(unint64_t)type inContainerView:(id)view forSendingMessages:(id)messages shouldUseQuickReplySourceRect:(BOOL)rect quickReplySourceRect:(CGRect)sourceRect quickReplySnapshotView:(id)snapshotView audioMessageSourceRect:(CGRect)messageSourceRect audioRecordingPillViewSnapshot:(id)self0;
- (id)_meContact;
- (id)_mediaAttributionActionForChatItem:(id)item;
- (id)_menuForChatItem:(id)item withParentChatItem:(id)chatItem menuAppearance:(int64_t)appearance;
- (id)_moreActionForChatItem:(id)item configureForCommSafety:(BOOL)safety;
- (id)_navigationControllerToPop;
- (id)_newCollaborationPayloadFromPayload:(id)payload shareURL:(id)l updatedMetadata:(id)metadata;
- (id)_newImageConfiguredForNSToolbarWithName:(id)name tintColor:(id)color;
- (id)_originalIndexPathForRepositioningDropSession:(id)session;
- (id)_parentChatItemForIndexPath:(id)path;
- (id)_previewViewControllerForAssetReference:(id)reference dataSource:(id)source previewDelegate:(id)delegate previewMode:(int64_t)mode;
- (id)_previewViewControllerForAssetReference:(id)reference photosViewController:(id)controller previewMode:(int64_t)mode;
- (id)_previewingViewControllerForHitView:(id)view indexPath:(id)path;
- (id)_previewingViewControllerForLocation:(CGPoint)location inSourceView:(id)view;
- (id)_progressBarHostView;
- (id)_recipientHandle;
- (id)_recipientHandleID;
- (id)_regularGridViewNavigationControllerForChatItem:(id)item assetReference:(id)reference tapbackManager:(id)manager;
- (id)_responsesSubmenuForChatItem:(id)item withParentChatItem:(id)chatItem menuAppearance:(int64_t)appearance;
- (id)_retractionActionForChatItem:(id)item;
- (id)_saveStickerActionForChatItem:(id)item sourceView:(id)view;
- (id)_selectedBalloonFromTouchForDropSession:(id)session;
- (id)_sendertHandleID;
- (id)_showTimestampsAction;
- (id)_stickerChatItemForDragItem:(id)item;
- (id)_stickerDetailsActionForChatItem:(id)item;
- (id)_stickerDragPreviewForDragItem:(id)item defaultPreview:(id)preview;
- (id)_stickerDropProposalForItem:(id)item inSession:(id)session;
- (id)_stickerDropProposalForSession:(id)session;
- (id)_stickerFromChatItem:(id)item;
- (id)_tapbackStatusManagerForChatItem:(id)item;
- (id)_throwBalloonAttributesForSendAnimationWithType:(unint64_t)type shouldUseQuickReplySourceRect:(BOOL)rect quickReplySourceRect:(CGRect)sourceRect isRunningPhotosPlugin:(BOOL)plugin chatItem:(id)item isPhotosExtensionMediaPayload:(BOOL)payload pluginChatItemCounterInOut:(unint64_t *)out containerView:(id)self0 isChatItemFromShelf:(BOOL)self1 isLastChatItem:(BOOL)self2 currentBalloonOriginInOut:(CGPoint *)self3 quickReplySnapshotView:(id)self4;
- (id)_transcriptOverlayTransitionContextForAnchoredMessagePart:(id)part threadIdentifier:(id)identifier presentKeyboard:(BOOL)keyboard;
- (id)_transcriptOverlayTransitionContextForModalPresentation;
- (id)_transcriptStickerCellContainingInteraction:(id)interaction;
- (id)_updatedFaceTimeToolbarItemImage;
- (id)_viewControllerForModalPresentationOfViewController:(id)controller;
- (id)_visibleChatItemsToScreenFrameMap;
- (id)_votingViewForChatItem:(id)item containingViewController:(id)controller;
- (id)actionManager:(id)manager tapbackElementsForChatItem:(id)item;
- (id)activeSendMenuPresentationForChatController:(id)controller;
- (id)activeSendMenuPresentationForChatInputController:(id)controller;
- (id)addContactOptionsMenuWithNicknameUpdate:(id)update;
- (id)addToExistingContactActionWithNicknameUpdate:(id)update;
- (id)additionalActivitiesTypesForPreviewController:(id)controller;
- (id)buildTapbackMenuElementsForChatItem:(id)item sendHandler:(id)handler emojiKeyboardHandler:(id)keyboardHandler detailsHandler:(id)detailsHandler;
- (id)cellIndexPathForDragTarget:(id)target;
- (id)chatInputTranscriptIdentifier;
- (id)chatItems;
- (id)compositionForSticker:(id)sticker mediaObject:(id)object;
- (id)consumingBundleIdentifiers;
- (id)contactForNickname:(id)nickname;
- (id)contextMenuAccessoryViewsForChatItem:(id)item containingViewController:(id)controller;
- (id)contextMenuInteraction:(id)interaction configurationForMenuAtLocation:(CGPoint)location;
- (id)contextMenuInteractionOutsideOfVisibleBalloonCells;
- (id)contextualCKChatItemsForPreviewController:(id)controller;
- (id)contextualCKChatItemsForTapbackPickerViewController:(id)controller;
- (id)createAlertControllerForAccountComposition:(id)composition completion:(id)completion;
- (id)createAnalyticsDictionaryForCollaborationForType:(int64_t)type sharingURL:(id)l;
- (id)createBannerForGroupUpdates:(id)updates;
- (id)createGroupUpdateWithType:(int64_t)type;
- (id)createNewContactActionWithNicknameUpdate:(id)update;
- (id)currentChatController;
- (id)currentDragPreviewContainer;
- (id)currentLocationDeniedAlert;
- (id)currentNavigationBarBasedOnSizeClass;
- (id)currentTopChatItemForAggregateChatItem:(id)item;
- (id)dateOfNewestVisibleMessageForMessageHistoryViewController:(id)controller;
- (id)deleteAlertFor:(int64_t)for;
- (id)detailsViewControllerForInspector;
- (id)dragInteraction:(id)interaction itemsForAddingToSession:(id)session withTouchAtPoint:(CGPoint)point;
- (id)dragInteraction:(id)interaction previewForCancellingItem:(id)item withDefault:(id)default;
- (id)dragInteraction:(id)interaction previewForLiftingItem:(id)item session:(id)session;
- (id)dragPreviewParametersForBalloonView:(id)view;
- (id)dropInteraction:(id)interaction previewForDroppingItem:(id)item withDefault:(id)default;
- (id)dropInteraction:(id)interaction sessionDidUpdate:(id)update;
- (id)editingToolbarItems;
- (id)excludedActivityTypesForPreviewController:(id)controller;
- (id)firstUnreadMessageItemGUIDForTranscriptCollectionViewController:(id)controller;
- (id)generatedSummary;
- (id)generativeContext;
- (id)getCurrentContext;
- (id)hashKeyForDragItem:(id)item;
- (id)innermostToolbarItemIdentifier;
- (id)inputAccessoryView;
- (id)inputAccessoryViewController;
- (id)inputContextHistoryForMessageEntryView:(id)view;
- (id)inputViewController;
- (id)keyboardLayoutGuideForAppCardPresentation;
- (id)lastOutgoingMessagePartItem;
- (id)launchURLForMode:(id)mode;
- (id)makeNavigationBarContext;
- (id)makeThrowAnimationManagerForComposition:(id)composition;
- (id)mediaObjectsFromComposition:(id)composition;
- (id)messageEditingViewController:(id)controller colorForChatItemGuid:(id)guid;
- (id)messageEditingViewController:(id)controller originalMessageCompositionForMessageWithGuid:(id)guid;
- (id)messageEntryViewActiveSendMenuPresentation:(id)presentation;
- (id)modalInlineReplyControllerForChatItem:(id)item;
- (id)nameAndPhotoForContact:(id)contact andNicknameUpdate:(id)update withCompletionBlock:(id)block;
- (id)nameOnlyForContact:(id)contact andNicknameUpdate:(id)update withCompletionBlock:(id)block;
- (id)nextMediaObjectToTrimInComposition:(id)composition;
- (id)photoOnlyForContact:(id)contact andNicknameUpdate:(id)update withCompletionBlock:(id)block;
- (id)photosGridViewController;
- (id)photosViewController:(id)controller accessoriesForContextMenuInteraction:(id)interaction assetReference:(id)reference;
- (id)photosViewController:(id)controller configurationForContextMenuInteraction:(id)interaction assetReference:(id)reference;
- (id)photosViewController:(id)controller contextMenuInteraction:(id)interaction styleForMenuWithConfiguration:(id)configuration;
- (id)photosViewController:(id)controller dragItemProviderForAssetReference:(id)reference;
- (id)pickerAccessoryViewForChatItem:(id)item containingViewController:(id)controller;
- (id)preferredFocusEnvironments;
- (id)preferredNavigationBarTitleText;
- (id)preferredViewControllerForModalDetailPresentation;
- (id)presentedControllerDoneButtonItem;
- (id)presentingViewControllerForAlertsFromDetailsAdapter:(id)adapter;
- (id)presentingViewControllerForOnboardingController:(id)controller;
- (id)previewActionsForPreviewController:(id)controller;
- (id)previewController:(id)controller transitionViewForPreviewItem:(id)item uncroppedSourceFrame:(CGRect *)frame;
- (id)previewItemsForMediaObject:(id)object currentItemIndex:(int64_t *)index containsRestoring:(BOOL *)restoring;
- (id)previewingContext:(id)context viewControllerForLocation:(CGPoint)location;
- (id)progressBar;
- (id)proofReadingInfoForMessageEditingViewController:(id)controller;
- (id)redesignedDetailsViewForConversation:(id)conversation;
- (id)representationForRole:(id)role sticker:(id)sticker;
- (id)selectedBalloonForTarget:(id)target;
- (id)selectedBalloonIntersectingRect:(CGRect)rect chatItemForRepositioning:(id)repositioning;
- (id)selectedChatItems;
- (id)selectedChatItemsIncludingTapbackedChatItem;
- (id)selectedMessagePartItem;
- (id)setBackgroundActionForChatItem:(id)item;
- (id)shareMetadataWithDugongTokensForCKShare:(id)share shareURL:(id)l;
- (id)smartEmojiResponses:(id)responses chatItem:(id)item;
- (id)splitViewController;
- (id)tapbackMenuElementsForChatItem:(id)item;
- (id)textDroppableView:(id)view proposalForDrop:(id)drop;
- (id)textPasteConfigurationSupporting:(id)supporting combineItemAttributedStrings:(id)strings forRange:(id)range;
- (id)textPasteConfigurationSupporting:(id)supporting performPasteOfAttributedString:(id)string toRange:(id)range;
- (id)textSelectionActionWithChatItem:(id)item;
- (id)throwAnimationContainerSuperview:(id)superview;
- (id)transcriptCollectionViewController:(id)controller accessoriesForContextMenuWithConfiguration:(id)configuration;
- (id)transcriptCollectionViewController:(id)controller addToContactsMenuForSenderChatItem:(id)item;
- (id)transcriptCollectionViewController:(id)controller contextMenuConfigurationForItemAtIndexPath:(id)path point:(CGPoint)point interaction:(id)interaction;
- (id)transcriptCollectionViewController:(id)controller previewForDismissingContextMenuWithConfiguration:(id)configuration;
- (id)transcriptCollectionViewController:(id)controller previewForHighlightingContextMenuWithConfiguration:(id)configuration;
- (id)transcriptCollectionViewController:(id)controller styleForContextMenuWithConfiguration:(id)configuration;
- (id)transcriptCollectionViewControllerOuterEffectPresentingView:(id)view;
- (id)transcriptContextChatItemProvider;
- (id)updateDataSourceForPluginPayload:(id)payload forGUID:(id)d withCollaborationMetadata:(id)metadata shareURL:(id)l;
- (id)updateOptionsMenuForContact:(id)contact withNicknameUpdate:(id)update withCompletionBlock:(id)block;
- (id)viewControllerToPresentFrom;
- (id)viewForDragAndChatInputDropTarget;
- (id)viewToInsertTranscriptCollectionViewBelow;
- (id)virtualView;
- (int)dragManager:(id)manager dropAreaForDragTarget:(id)target;
- (int64_t)_determineEntryViewPositioningGuideToActivate;
- (int64_t)_sharingAccessTypeFromOptionsGroups:(id)groups;
- (int64_t)_sharingPermissionTypeFromOptionsGroups:(id)groups;
- (int64_t)currentTranscriptNavigationBarMode;
- (int64_t)currentTranscriptNavigationBarTitleDisplayMode;
- (int64_t)entryViewPositioningGuideForCurrentTapbackPickerPresentation;
- (int64_t)preferredStatusBarStyle;
- (int64_t)sceneInterfaceOrientation;
- (int64_t)transcriptCollectionViewControllerWantsCurrentDesiredIntent:(id)intent;
- (unint64_t)_animationOptionsFromCurve:(int64_t)curve;
- (unint64_t)preferredScreenEdgesDeferringSystemGestures;
- (unint64_t)recipientsCount;
- (unint64_t)supportedInterfaceOrientations;
- (void)__raiseGestureRecognized:(id)recognized;
- (void)__setEntryViewFrame:(CGRect)frame;
- (void)_actuallyPresentCollaborationFailureAlertForComposition:(id)composition sharingURL:(id)l error:(id)error completion:(id)completion;
- (void)_addAppCardBackgroundView;
- (void)_addDefaultButtonToSharingErrorAlertController:(id)controller sharingURL:(id)l defaultButtonAction:(int64_t)action completion:(id)completion;
- (void)_addOtherButtonToSharingErrorAlertController:(id)controller otherButtonAction:(int64_t)action completion:(id)completion;
- (void)_addParticipant:(id)participant toShareBearURL:(id)l containerSetupInfo:(id)info completionHandler:(id)handler;
- (void)_addParticipant:(id)participant toShareURL:(id)l forChatGUID:(id)d completionHandler:(id)handler;
- (void)_addParticipantToShare:(id)share withHandle:(id)handle toCollaboration:(id)collaboration containerSetupInfo:(id)info completionHandler:(id)handler;
- (void)_applicationDidBecomeActive:(id)active;
- (void)_applicationWillResignActive:(id)active;
- (void)_askToTurnOnReadReceiptsIfNeeded;
- (void)_askToTurnOnSMSRelayIfNeeded;
- (void)_autoAcceptNicknameIfNeeded;
- (void)_backbuttonPressed;
- (void)_beginDeferringSystemNavigationPopGestureForPlusButton;
- (void)_callButtonPressed;
- (void)_callButtonPressedWithVideoEnabled:(BOOL)enabled;
- (void)_cancelDeletion:(id)deletion;
- (void)_catchUpButtonTapped;
- (void)_clearBalloonViewOverlaysWithAnimation:(BOOL)animation;
- (void)_clearCompositionAndPendingConversation;
- (void)_collaborationMetadataForURL:(id)l forChatGUID:(id)d completionHandler:(id)handler;
- (void)_commitSticker:(id)sticker toCoordinate:(CGPoint)coordinate withInitialSize:(CGSize)size dropPreviewTransform:(CGAffineTransform *)transform;
- (void)_commitSticker:(id)sticker toCoordinate:(CGPoint)coordinate withInitialSize:(CGSize)size dropPreviewTransform:(CGAffineTransform *)transform isRepositioningSticker:(BOOL)repositioningSticker localStickerChatItem:(id)item;
- (void)_configureCallStateResolverForCurrentConversation;
- (void)_configureEditMessageCommand:(id)command;
- (void)_configureGridControllerForStackTransition:(id)transition chatItem:(id)item;
- (void)_configureMacFaceTimeButtonMenu;
- (void)_confirmReadReceiptSettings;
- (void)_contactsListDidChange;
- (void)_conversationJoinStateDidChange:(id)change;
- (void)_conversationParticipantsChanged:(id)changed;
- (void)_dataDetectorsDidDismissNotification:(id)notification;
- (void)_dataDetectorsWillPresentNotification:(id)notification;
- (void)_dealloc;
- (void)_deleteSelectedMessages:(id)messages;
- (void)_deleteStickerWithTransferGUID:(id)d;
- (void)_detailsAdapterWantsDismiss:(id)dismiss;
- (void)_detailsButtonPressed;
- (void)_didSendCompositionInConversation:(id)conversation;
- (void)_didTapNavigationBarAvatarView;
- (void)_didTapNavigationBarToDismissReplies;
- (void)_didTapToPresentNewCompose;
- (void)_dismissBannerView:(id)view completion:(id)completion;
- (void)_dismissCollaborationPopoverUI;
- (void)_dismissFullScreenBubbleViewControllerAnimated:(BOOL)animated withSendAnimation:(BOOL)animation completion:(id)completion;
- (void)_dismissFullScreenBubbleViewControllerAnimated:(BOOL)animated withSendAnimation:(BOOL)animation dismissAppCard:(BOOL)card completion:(id)completion;
- (void)_dismissPresentedViewController:(id)controller;
- (void)_dismissSendMenuIfNecessaryForChangedPresentationStyle;
- (void)_dismissSentWithSiriUI;
- (void)_displayNameUpdatedNotification:(id)notification;
- (void)_doneButtonPressed;
- (void)_dragInteraction:(id)interaction prepareForSession:(id)session completion:(id)completion;
- (void)_dragInteractionDidCancelLiftWithoutDragging:(id)dragging;
- (void)_editCancelButtonPressed;
- (void)_editingToolbarSelectedForward:(id)forward;
- (void)_endDeferringSystemNavigationPopGestureForPlusButton;
- (void)_evaluateMetricsForStagingLocation;
- (void)_fetchCollaborationNotices;
- (void)_fetchRecipientCapabilitiesDeferred;
- (void)_finishSendAnimation;
- (void)_gridViewNavigationControllerForChatItem:(id)item assetReference:(id)reference completionHandler:(id)handler;
- (void)_gridViewNavigationControllerForMomentShareURL:(id)l chatItem:(id)item tapbackManager:(id)manager completionHandler:(id)handler;
- (void)_handleAddressBookChangedNotification:(id)notification;
- (void)_handleChatItemDidChange:(id)change;
- (void)_handleCollaborationNoticesChanged:(id)changed;
- (void)_handleContactStoreBatchLoadCompleteNotification:(id)notification;
- (void)_handleDictationStarted:(id)started;
- (void)_handleGroupNameChanged:(id)changed;
- (void)_handleGroupPhotoChanged:(id)changed;
- (void)_handleInterworkingStateChanged:(id)changed;
- (void)_handleIsFilteredChange;
- (void)_handleIsUnexpectedlyLoggedOutChanged:(id)changed;
- (void)_handleKeyTransparencyShouldRefresh:(id)refresh;
- (void)_handleSetAsBackgroundActionForAssetURL:(id)l;
- (void)_handleTranscriptPluginChatItem:(id)item presentationConfiguration:(id)configuration;
- (void)_handleTranslationSettingChanged:(id)changed;
- (void)_handleTranslationSupportChanged:(id)changed;
- (void)_hideCatchUpButtonIfNeededAndRemoveOnCompletion:(BOOL)completion;
- (void)_highlightForShareURL:(id)l completionHandler:(id)handler;
- (void)_inheritHiddenKeyboardAppearanceIfNeeded;
- (void)_initializeEffectPicker;
- (void)_invalidateChatItemLayoutIfNecessary:(CGSize)necessary;
- (void)_invalidateEntryViewConstraints;
- (void)_isShareBearURL:(id)l completionHandler:(id)handler;
- (void)_kickPhotoKit;
- (void)_layoutBannerView:(id)view;
- (void)_layoutEntryViewSuperview;
- (void)_markAsReadIfNecessary;
- (void)_markVisibleMentionsAsRead;
- (void)_messageReceived:(id)received;
- (void)_passKitUIDismissed:(id)dismissed;
- (void)_performResume;
- (void)_prepareForDropAnimationWithItem:(id)item preview:(id)preview;
- (void)_presentAlertForDebugSummary:(id)summary;
- (void)_presentAppStoreForAdamID:(id)d;
- (void)_presentBannerView:(id)view placingHandlesUnderScrutiny:(id)scrutiny completion:(id)completion;
- (void)_presentBrowserForPlugin:(id)plugin;
- (void)_presentBrowserOrAppStoreForAdamID:(id)d url:(id)url identifier:(id)identifier isForSticker:(BOOL)sticker;
- (void)_presentCollabAddToMessagesGroupAlert:(id)alert sendBlock:(id)block completionHandler:(id)handler;
- (void)_presentCollabAddToMessagesGroupAlertIfNecessary:(id)necessary collaborationType:(int64_t)type sendBlock:(id)block completionHandler:(id)handler;
- (void)_presentCollaborationAlertsIfNecessaryForPayload:(id)payload collaborationType:(int64_t)type sendBlock:(id)block completionHandler:(id)handler;
- (void)_presentDetailsViewControllerAnimated:(BOOL)animated;
- (void)_presentGridForChatItem:(id)item assetReference:(id)reference;
- (void)_presentGridForPendingMomentShareChatItem:(id)item;
- (void)_presentGridViewNavigationController:(id)controller;
- (void)_presentPreviewViewControllerFromPhotosViewController:(id)controller assetReference:(id)reference;
- (void)_presentSentWithSiriUI;
- (void)_presentTranscriptSharingBannerIfNecessary;
- (void)_presentViewerForChatItem:(id)item assetReference:(id)reference;
- (void)_prewarmBalloonPluginViewCacheCompleted:(id)completed;
- (void)_processCollaborationNoticesForBanner:(id)banner;
- (void)_raiseToListenSettingChanged:(id)changed;
- (void)_reduceTransparencyStatusDidChange;
- (void)_registerRepresentationsInItemProvider:(id)provider sticker:(id)sticker;
- (void)_registerSendProgressDelegate;
- (void)_registerStandardRepresentationsInItemProvider:(id)provider sticker:(id)sticker effectView:(id)view;
- (void)_reloadMentionsData;
- (void)_removeParticipant:(id)participant fromShareBearURL:(id)l containerSetupInfo:(id)info completionHandler:(id)handler;
- (void)_removeParticipant:(id)participant fromShareURL:(id)l forChatGUID:(id)d completionHandler:(id)handler;
- (void)_removeSubsharesAndSendFileProviderComposition:(id)composition shareURL:(id)l completion:(id)completion;
- (void)_replaceBannerView:(id)view withNewBannerView:(id)bannerView placingHandlesUnderScrutiny:(id)scrutiny completion:(id)completion;
- (void)_reportSelectedMessages:(id)messages;
- (void)_resetEffectPickerViewController;
- (void)_restoreDraftState;
- (void)_retryGroupPhotoUploadIfNecessary;
- (void)_retryTranscriptBackgroundUploadIfNecessary;
- (void)_satelliteStateChangedNotification:(id)notification;
- (void)_saveDraftState;
- (void)_sendAutomaticallyPlacedSticker:(id)sticker stickerReactionSession:(id)session forChatItem:(id)item forParentChatItem:(id)chatItem stickerFrame:(CGRect)frame animationCompletionHandler:(id)handler;
- (void)_sendCollaborationCompositionForCloudKit:(id)kit sharingURL:(id)l share:(id)share completion:(id)completion;
- (void)_sendCollaborationCompositionForFileProvider:(id)provider sharingURL:(id)l share:(id)share completion:(id)completion;
- (void)_sendCommSafetyVerifiedSticker:(id)sticker withMediaObject:(id)object composition:(id)composition parentMessagePartChatItem:(id)item messageSummaryInfo:(id)info;
- (void)_sendCompositionForFileProviderCloudDrive:(id)drive completion:(id)completion;
- (void)_sendCompositionForNewCloudKitShare:(id)share completion:(id)completion;
- (void)_sendNewStickerFromDropSession:(id)session;
- (void)_sendStickerForDragItem:(id)item previewSize:(CGSize)size dropLocation:(CGPoint)location;
- (void)_setBannersHidden:(BOOL)hidden;
- (void)_setConversationDeferredSetup;
- (void)_setEntryViewFrame:(CGRect)frame isContentChange:(BOOL)change animated:(BOOL)animated completionHandler:(id)handler;
- (void)_setOverlayForBalloonViewAtIndexPath:(id)path animated:(BOOL)animated;
- (void)_setTitle:(id)title animated:(BOOL)animated;
- (void)_setUpEntryViewAppCardLayoutConstraint;
- (void)_setUpEntryViewChatFooterViewLayoutConstraint;
- (void)_setupModernTranscriptNavigationBar;
- (void)_showAutoDonationAlertForAppName:(id)name bundleID:(id)d;
- (void)_showCatchUpButtonIfNeededResumingFromBackground:(BOOL)background;
- (void)_showMapViewerForMediaObject:(id)object;
- (void)_showPassbookCardViewForMediaObject:(id)object;
- (void)_showReaderForAggregateChatItem:(id)item balloonView:(id)view;
- (void)_showTapbackReplyOverlayFromPhotosViewController:(id)controller assetReference:(id)reference presentTapbackKeyboardInput:(BOOL)input;
- (void)_showVCalViewerForMediaObject:(id)object;
- (void)_showVCardViewerForMediaObject:(id)object;
- (void)_showWalletOrderImportViewForMediaObject:(id)object;
- (void)_sizeEffectPickerWindow;
- (void)_stageCurrentLocationInEntryViewForURL:(id)l;
- (void)_stageFindMyLocationRequest;
- (void)_startSharingForURLForFileProviderCloudDrive:(id)drive completion:(id)completion;
- (void)_stickerTranscriptScrollDisplayLinkFired;
- (void)_switchedAwayFromEmojiKeyboard:(id)keyboard;
- (void)_switchedToEmojiKeyboard:(id)keyboard;
- (void)_textInputModeDidChange:(id)change;
- (void)_traitsAffectingBarAppearanceDidChange;
- (void)_transferCompleted:(id)completed;
- (void)_transferFileTooLarge:(id)large;
- (void)_transferFinishedNotification:(id)notification;
- (void)_transferRestoredNotification:(id)notification;
- (void)_transferUpdated:(id)updated;
- (void)_updateAccountRegistrationFailureNotification;
- (void)_updateAndSendCompositionForExistingCloudKitShare:(id)share share:(id)a4 attempt:(unint64_t)attempt completion:(id)completion;
- (void)_updateAndSendCompositionForFileProvider:(id)provider share:(id)share sharingURL:(id)l completion:(id)completion;
- (void)_updateBannerNotifications;
- (void)_updateCatchUpButtonVisibilityResumingFromBackground:(BOOL)background;
- (void)_updateEntryViewConstraintsIfNeeded;
- (void)_updateEntryViewFrameIfNeeded:(BOOL)needed;
- (void)_updateEntryViewPasteConfiguration;
- (void)_updateFauxKeyboardLayoutGuideIfNeededForKeyboardAppearanceNotification:(id)notification;
- (void)_updateFauxKeyboardLayoutGuideIfNeededWithKeyboardFrame:(CGRect)frame;
- (void)_updateForNewPreferredService;
- (void)_updateIndexPathForFirstUnreadMessage;
- (void)_updateLogoutBannerNotification;
- (void)_updateNavigationButtons;
- (void)_updateNotDefaultTextingAppNotification;
- (void)_updateNotificationBannerOfType:(int64_t)type show:(BOOL)show;
- (void)_updatePhotoGridIfNeeded;
- (void)_updatePollSuggestionAvailability;
- (void)_updateRecipientCapabilities;
- (void)_updateShare:(id)share containerSetupInfo:(id)info completionHandler:(id)handler;
- (void)_updateSuggestionsBanners;
- (void)_updateTitleAnimated:(BOOL)animated;
- (void)_updateToolbarItems;
- (void)_updateTranscriptOffsetForBannerView;
- (void)_validateAndSendComposition:(id)composition completion:(id)completion;
- (void)_walletOrderImportControllerDismissed;
- (void)_willSendComposition:(id)composition inConversation:(id)conversation;
- (void)actionCancelIsTappedForChatItem:(id)item;
- (void)actionManager:(id)manager copyChatItems:(id)items;
- (void)actionManager:(id)manager forwardChatItems:(id)items;
- (void)actionManager:(id)manager presentInlineReplyControllerForChatItem:(id)item;
- (void)actionManager:(id)manager quickLookChatItem:(id)item;
- (void)actionManager:(id)manager tapbackChatItem:(id)item;
- (void)actionMoreIsTappedForChatItem:(id)item;
- (void)actionRetractIsTappedForChatItem:(id)item;
- (void)addAppCardBackgroundViewIfNecessary;
- (void)addHEICImage:(id)image completion:(id)completion;
- (void)addOrRemoveEntryViewIfNeeded;
- (void)addPNGImage:(id)image completion:(id)completion;
- (void)addParticipant:(id)participant toCollaboration:(id)collaboration forChatGUID:(id)d containerSetupInfo:(id)info completionHandler:(id)handler;
- (void)addPassesViewControllerDidFinish:(id)finish;
- (void)addSuggestionBanner:(id)banner animated:(BOOL)animated;
- (void)addToCollaboration:(id)collaboration;
- (void)animateRevealWithInteractionProgress:(id)progress forPreviewingAtLocation:(CGPoint)location inSourceView:(id)view containerView:(id)containerView;
- (void)animateSendMenuStatusBarAppearanceUpdate;
- (void)animatedDismissalOfKeyboardSnapshot;
- (void)appCardDidChangeEntryViewAlignmentHeight:(double)height animated:(BOOL)animated;
- (void)appCardDidDismiss;
- (void)appCardViewStateDidChange:(BOOL)change;
- (void)appendCompositionFromItemProviders:(id)providers;
- (void)askToShareScreenFromBuddyMenu:(id)menu;
- (void)associatedStickerCells:(id *)cells stickerChatItems:(id *)items chatItemGUID:(id)d;
- (void)beginHoldingAutorotationForKey:(id)key;
- (void)beginThrowAnimationForComposition:(id)composition;
- (void)blockUserFromBuddyMenu:(id)menu;
- (void)button:(id)button requestsJoinActiveCallWithVideoEnabled:(BOOL)enabled;
- (void)button:(id)button requestsStartFaceTimeWithScreenShareType:(unint64_t)type;
- (void)buttonRequestsLeaveJoinedCall:(id)call;
- (void)buttonRequestsOpenJoinedCall:(id)call;
- (void)buttonRequestsStartFaceTimeAudio:(id)audio;
- (void)buttonRequestsStartFaceTimeVideo:(id)video;
- (void)chatAllowedByScreenTimeChanged:(id)changed;
- (void)chatController:(id)controller didFinishDismissAnimationForSendMenuViewController:(id)viewController;
- (void)chatController:(id)controller requestPresentSendMenu:(id)menu currentlyPresentedViewController:(id)viewController;
- (void)chatControllerWillBeginResizing;
- (void)chatInputController:(id)controller didFinishDismissAnimationForSendMenuViewController:(id)viewController;
- (void)chatInputController:(id)controller didPresentStickerPickerForChatItem:(id)item;
- (void)chatInputController:(id)controller didRequestAppendToCompositionForPayload:(id)payload;
- (void)chatInputController:(id)controller requestPresentSendMenu:(id)menu;
- (void)chatInputController:(id)controller willPresentStickerPickerForChatItem:(id)item;
- (void)chatInputControllerCancelSelectFunCamera:(id)camera;
- (void)chatInputControllerDidDismissCompactBrowserViewController:(id)controller;
- (void)chatInputControllerDidDismissModalBrowserViewController:(id)controller;
- (void)chatInputControllerDidSelectFunCamera:(id)camera;
- (void)chatInputControllerDidSelectRequestLocation:(id)location;
- (void)chatInputControllerDidTransitionCollapsed:(id)collapsed;
- (void)chatInputControllerDidTransitionExpanded:(id)expanded;
- (void)chatInputControllerRequestInputViewFocusFromFullscreen:(id)fullscreen;
- (void)chatInputControllerWillDismissModalBrowserViewController:(id)controller;
- (void)chatInputControllerWillPresentModalBrowserViewController:(id)controller;
- (void)chatInputControllerWillSelectFunCamera:(id)camera;
- (void)chatInputControllerWillTransitionCollapsed:(id)collapsed;
- (void)chatInputControllerWillTransitionExpanded:(id)expanded;
- (void)chatInputDidSelectEffectPicker;
- (void)chatInputDidSelectPhotoPicker;
- (void)chatInputDidUpdateInputViewShowingBrowser:(BOOL)browser entryFieldCollapsed:(BOOL)collapsed animated:(BOOL)animated;
- (void)chatInputDidUpdateWithNewInputViewController:(id)controller;
- (void)chatInputSentComposition:(id)composition;
- (void)chatInputWillChangeHeightForCompactPresentation:(double)presentation;
- (void)checkSuggestionsForBanner;
- (void)cleanUpDarkEffectStyle;
- (void)cleanupPostComposeTransitionWithKBFrame:(CGRect)frame;
- (void)clearEntryViewPasteConfiguration;
- (void)clearHandlesFromScrutiny:(id)scrutiny;
- (void)clearStagedSensitiveContentUsingContextDictionary:(id)dictionary;
- (void)clearTranslationCache;
- (void)collaborationNoticeSuggestionWillDismiss:(id)dismiss;
- (void)communicationLimitsDeleteButtonPressed:(id)pressed;
- (void)communicationLimitsPreviewMessageButtonPressed:(id)pressed;
- (void)composeButtonClicked:(id)clicked;
- (void)computedInsetsDidChange;
- (void)configureFooterIfNeeded;
- (void)configureForCurrentTraitCollection;
- (void)configureMacToolbarProperties;
- (void)configureThrowAnimationManagerForAudioSendAnimation:(id)animation;
- (void)configureWithToolbarController:(id)controller;
- (void)contactPicker:(id)picker didSelectContact:(id)contact;
- (void)contactViewController:(id)controller didCompleteWithContact:(id)contact;
- (void)contentInsetDidChangeWithAnimationProperties:(id)properties;
- (void)contentInsetWillChange:(UIEdgeInsets)change withAnimationProperties:(id)properties;
- (void)contextMenuInteraction:(id)interaction willDisplayMenuForConfiguration:(id)configuration animator:(id)animator;
- (void)contextMenuInteraction:(id)interaction willEndForConfiguration:(id)configuration animator:(id)animator;
- (void)controller:(id)controller didCompleteClassificationRequest:(id)request withResponse:(id)response;
- (void)copy:(id)copy;
- (void)createCollaborationFailureAlertForFailedMetadataLoadWithFallback:(BOOL)fallback URL:(id)l;
- (void)createCollaborationFailureAlertForNotice:(id)notice;
- (void)createContactWithNicknameUpdate:(id)update;
- (void)dealloc;
- (void)delete:(id)delete;
- (void)deleteMediaObjectAttachmentGUIDs:(id)ds originalStackCount:(int64_t)count;
- (void)detailsAdapter:(id)adapter shouldComposeConversationWithRecipientAddresses:(id)addresses;
- (void)detailsAdapter:(id)adapter wantsToStageComposition:(id)composition;
- (void)detailsAdapterDidDismiss:(id)dismiss;
- (void)detailsAdapterWantsToPresentKTContactVerificationUI:(id)i;
- (void)detailsAdapterWillDismiss:(id)dismiss;
- (void)detailsCoordinatorDidDismiss:(id)dismiss;
- (void)detailsCoordinatorDidRequestNavigationToConversationList:(id)list;
- (void)detailsCoordinatorDidRequestNewCompose:(id)compose addresses:(id)addresses;
- (void)detailsCoordinatorRequestedContactsPopover:(id)popover sourceView:(id)view activeHandle:(id)handle contact:(id)contact;
- (void)determineIfSendMenuShouldElevateCheckInWithCompletion:(id)completion;
- (void)didDismissPreviewViewController:(id)controller committing:(BOOL)committing;
- (void)didPresentEditorTranscriptBackground:(BOOL)background;
- (void)didReceiveMemoryWarning;
- (void)didRequestComposeAudio:(id)audio;
- (void)didRequestComposeText:(id)text text:(id)a4;
- (void)didRequestComposeVideo:(id)video;
- (void)didRequestCreateCalendarEvent:(id)event;
- (void)didRequestLocationPush:(BOOL)push;
- (void)didRequestOpenWebView:(id)view;
- (void)didRequestSendDeviceDetails;
- (void)didRequestSendResponseForAction:(id)action;
- (void)didSelectTranscriptBackground:(id)background;
- (void)dimsmissCurrentBannerAndShowNewBannerForGroupUpdate:(id)update;
- (void)disableRotationWhileRecordingAudioMessage;
- (void)disableSendButtonSpinner;
- (void)dismissBusinessOnboardingIfShowing;
- (void)dismissCollaborationNoticeBannersIfNecessary;
- (void)dismissCollaborationNoticeSuggestion:(id)suggestion;
- (void)dismissContextMenuInteractionMenu;
- (void)dismissController:(id)controller withCompletion:(id)completion;
- (void)dismissDetailsControllerAnimated:(BOOL)animated;
- (void)dismissDetailsNavigationControllerWithCompletion:(id)completion;
- (void)dismissDetailsView;
- (void)dismissDetailsViewAndShowConversationListWithCompletion:(id)completion;
- (void)dismissEffectPickerAnimated:(BOOL)animated;
- (void)dismissInlineReplyController:(BOOL)controller;
- (void)dismissInlineReplyIfNeededAndScrollToBottom;
- (void)dismissKeyboard;
- (void)dismissMessageEditingViewController:(BOOL)controller;
- (void)dismissTipIfPresented;
- (void)dismissTranscriptOverlayViewController:(id)controller presentKeyboard:(BOOL)keyboard;
- (void)dismissViewControllerAnimated:(BOOL)animated completion:(id)completion;
- (void)documentPicker:(id)picker didPickDocumentsAtURLs:(id)ls;
- (void)dragInteraction:(id)interaction item:(id)item willAnimateCancelWithAnimator:(id)animator;
- (void)dragInteraction:(id)interaction session:(id)session didEndWithOperation:(unint64_t)operation;
- (void)dragInteraction:(id)interaction sessionWillBegin:(id)begin;
- (void)dragManager:(id)manager draggedItemWithTarget:(id)target;
- (void)dragManagerDidBeginDragging:(id)dragging;
- (void)dragManagerDidEndDragging:(id)dragging;
- (void)dropInteraction:(id)interaction concludeDrop:(id)drop;
- (void)dropInteraction:(id)interaction item:(id)item willAnimateDropWithAnimator:(id)animator;
- (void)dropInteraction:(id)interaction performDrop:(id)drop;
- (void)dropInteraction:(id)interaction sessionDidEnd:(id)end;
- (void)dropInteraction:(id)interaction sessionDidEnter:(id)enter;
- (void)editingViewController:(id)controller didFinishWithConfiguration:(id)configuration;
- (void)effectPickerViewController:(id)controller effectWithIdentifierSelected:(id)selected;
- (void)effectPickerViewControllerClose:(id)close keepingSideMountContainer:(BOOL)container animated:(BOOL)animated;
- (void)emphasizeMessageWithMessageGUID:(id)d;
- (void)enableAutomaticTranslationForLanguageCode:(id)code userTranslationCode:(id)translationCode affectedMessageGUIDs:(id)ds;
- (void)enableRotationAfterRecording;
- (void)enableSendButtonSpinner;
- (void)endHoldingAutorotationForKey:(id)key;
- (void)enforceSendMenuOrderingInWindowSubviews;
- (void)entryViewContainerViewDidLayoutSubviews:(id)subviews;
- (void)escButtonPressed:(id)pressed;
- (void)faceTimeAudioFromBuddyMenu:(id)menu;
- (void)faceTimeVideoFromBuddyMenu:(id)menu;
- (void)flagSensitiveMediaObjects:(id)objects;
- (void)forciblyUnloadChatInputController;
- (void)fullScreenBalloonViewController:(id)controller deleteStickerWithTransferGUID:(id)d;
- (void)fullScreenBalloonViewController:(id)controller didAppearAnimated:(BOOL)animated;
- (void)fullScreenBalloonViewController:(id)controller didTapToSaveSticker:(id)sticker;
- (void)fullScreenBalloonViewController:(id)controller replyButtonPressedForChatItem:(id)item;
- (void)fullScreenBalloonViewController:(id)controller sendMessageAcknowledgment:(int64_t)acknowledgment forChatItem:(id)item;
- (void)fullScreenBalloonViewController:(id)controller sendMessageHighlight:(BOOL)highlight forChatItem:(id)item;
- (void)fullScreenBalloonViewController:(id)controller stickerPackTappedWithAdamID:(id)d;
- (void)fullScreenBalloonViewController:(id)controller verticallyScrollTranscriptByAmount:(double)amount animated:(BOOL)animated duration:(double)duration completion:(id)completion;
- (void)fullScreenBalloonViewController:(id)controller willAppearAnimated:(BOOL)animated;
- (void)fullScreenBalloonViewController:(id)controller willDisappearWithSendAnimation:(BOOL)animation duration:(double)duration;
- (void)fullScreenBalloonViewControllerDidDisappear:(id)disappear;
- (void)fullScreenBalloonViewControllerHandleDismissTap:(id)tap;
- (void)fullScreenBalloonViewControllerWillReturnToSuggestionsPicker:(id)picker;
- (void)fullScreenBalloonViewControllerWillTransitionToKeyboardInput:(id)input;
- (void)groupPhotoUpdateBanner:(id)banner dismissedUpdate:(id)update;
- (void)handleAutomaticallyPlacedStickerCommSafetySendContext:(id)context;
- (void)handleContentSizeCategoryDidChangeNotification:(id)notification;
- (void)handleStickerDropConfirmCommSafetySendContext:(id)context;
- (void)handleStickerTapbackConfirmCommSafetySendContext:(id)context;
- (void)hideAcknowledgmentsAssociatedWithChatItem:(id)item;
- (void)hideAssociatedCellsForChatItem:(id)item;
- (void)hideExistingKeyboardSnapshot;
- (void)hideMediaPickerAnimated:(BOOL)animated completion:(id)completion;
- (void)imagePickerController:(id)controller didFinishPickingMediaWithInfo:(id)info;
- (void)inlineReplyControllerIsAppearing:(id)appearing;
- (void)inlineReplyControllerRequestsDismissal:(id)dismissal presentKeyboard:(BOOL)keyboard;
- (void)inputController:(id)controller willDismissPresentationController:(id)presentationController;
- (void)inputLanguageDidChange:(id)change;
- (void)insertInitialCompositionIfNeeded;
- (void)interactionProgress:(id)progress didEnd:(BOOL)end;
- (void)interactionProgressDidUpdate:(id)update;
- (void)inviteToShareScreenFromBuddyMenu:(id)menu;
- (void)keyCommandApplyTextEffect:(id)effect;
- (void)keyCommandApplyTextStyle:(id)style;
- (void)keyCommandDeleteConversation:(id)conversation;
- (void)keyCommandEditMessage:(id)message;
- (void)keyCommandPage:(id)page;
- (void)keyCommandPrint:(id)print;
- (void)keyCommandReply:(id)reply withModifier:(BOOL)modifier;
- (void)keyCommandSelectTapback:(id)tapback;
- (void)keyCommandShowDetails:(id)details;
- (void)keyCommandTapback:(id)tapback;
- (void)keyCommandToggleDetails;
- (void)keyCommandToggleTimeStamp:(id)stamp;
- (void)keyCommandToggleUnreadState;
- (void)keyTransparencyConversationViewControllerDidComplete:(id)complete;
- (void)keyboardDidChangeFrame:(id)frame;
- (void)keyboardDidHide:(id)hide;
- (void)keyboardDidShow:(id)show;
- (void)keyboardWillChangeFrame:(id)frame;
- (void)keyboardWillHide:(id)hide;
- (void)keyboardWillShow:(id)show;
- (void)layoutFooterView;
- (void)layoutLockoutView;
- (void)learnMoreButtonTapped;
- (void)loadChatInputController;
- (void)loadView;
- (void)lockoutViewControllerDidFinishDismissing:(id)dismissing;
- (void)macRecipientsControllerDidUpdateToFieldSizing:(id)sizing;
- (void)mentionsControllerDidFinishAnimation:(id)animation;
- (void)messageEditingViewController:(id)controller confirmedEditWithComposition:(id)composition;
- (void)messageEditingViewController:(id)controller didUpdateFrameForBalloonView:(id)view;
- (void)messageEditingViewControllerIsAnimatingIn:(id)in;
- (void)messageEditingViewControllerIsAnimatingOut:(id)out;
- (void)messageEntryView:(id)view didInsertPluginPayload:(id)payload;
- (void)messageEntryView:(id)view didMoveToWindow:(id)window;
- (void)messageEntryViewDidBeginEditing:(id)editing;
- (void)messageEntryViewDidBeginEditingNotAlreadyActive:(id)active;
- (void)messageEntryViewDidChange:(id)change isTextChange:(BOOL)textChange isShelfChange:(BOOL)shelfChange isTranslationChange:(BOOL)translationChange;
- (void)messageEntryViewDidDismissCustomizationPicker:(id)picker;
- (void)messageEntryViewDidPresentCustomizationPicker:(id)picker;
- (void)messageEntryViewPlusButtonHit:(id)hit;
- (void)messageEntryViewPopulateNextSentMessage:(id)message;
- (void)messageEntryViewPopulatePreviousSentMessage:(id)message;
- (void)messageEntryViewRaiseGestureAutoSend:(id)send;
- (void)messageEntryViewRecordingDidChange:(id)change;
- (void)messageEntryViewRequestsVisionAppMenu:(id)menu fromButton:(id)button;
- (void)messageEntryViewSafeAreaInsetsDidChange:(id)change;
- (void)messageEntryViewSendButtonHit:(id)hit;
- (void)messageEntryViewSendButtonHitWhileDisabled:(id)disabled;
- (void)messageEntryViewSendLaterPluginInfoUpdated:(id)updated;
- (void)messageEntryViewSwipeDownGestureRecognized:(id)recognized;
- (void)messageEntryViewTextFormattingAnimationsOptionsPresentationInProgress:(BOOL)progress;
- (void)messageEntryViewWantsGenerativePlaygroundPluginPresented:(id)presented presentationStyle:(unint64_t)style;
- (void)messageEntryViewWantsSendLaterPickerPresented:(id)presented;
- (void)messageEntryViewWillDismissCustomizationPicker:(id)picker;
- (void)messageEntryViewWillPresentCustomizationPicker:(id)picker;
- (void)messageHistoryViewController:(id)controller didSelectDate:(id)date withMessages:(id)messages;
- (void)nicknameBannerDidInteractWithOnboardingOffer;
- (void)nicknameBannerView:(id)view actionButtonTapped:(id)tapped forUpdates:(id)updates;
- (void)nicknameStoreDidChange:(id)change;
- (void)nicknameUpdatesViewController:(id)controller selectedAction:(unint64_t)action forNicknameUpdate:(id)update sourceView:(id)view;
- (void)onboardingControllerDidFinish:(id)finish;
- (void)openURLInExtensionContextForMode:(id)mode;
- (void)parentControllerDidBecomeActive;
- (void)performAnimatedJunkRecoveryTransition:(id)transition;
- (void)performPlatformSpecificDetailsPresentation:(id)presentation;
- (void)performRelayPhoneCall:(id)call;
- (void)performResumeDeferredSetup;
- (void)persistentMenuManager:(id)manager selectedChipAction:(id)action;
- (void)photoGridDisplayedChatItemChanged:(id)changed;
- (void)photosGridFullScreenBalloonViewController:(id)controller replyButtonPressedForChatItem:(id)item;
- (void)photosGridFullScreenBalloonViewController:(id)controller verticallyScrollTranscriptByAmount:(double)amount animated:(BOOL)animated duration:(double)duration completion:(id)completion;
- (void)photosGridFullScreenBalloonViewControllerHandleDismissTap:(id)tap;
- (void)photosViewController:(id)controller commitPreviewViewControllerForContextMenuInteraction:(id)interaction;
- (void)photosViewController:(id)controller contextMenuInteraction:(id)interaction willEndForConfiguration:(id)configuration animator:(id)animator;
- (void)photosViewController:(id)controller didDoubleTapAssetReference:(id)reference;
- (void)prepareForSuspend;
- (void)prepareInputForPreviewPresentation;
- (void)prepareToDismissForSecondInstance;
- (void)presentActionMenuForAccountSelection:(id)selection completion:(id)completion;
- (void)presentAddContactViewController:(id)controller;
- (void)presentAppStoreForURL:(id)l fromSourceApplication:(id)application;
- (void)presentBlockPersonAlertWithHandle:(id)handle;
- (void)presentCollaborationFailureAlertForComposition:(id)composition sharingURL:(id)l error:(id)error completion:(id)completion;
- (void)presentCollaborationPopoverUI;
- (void)presentDetailsViewControllerAnimated:(BOOL)animated;
- (void)presentEmojiDetailsControllerWithIndexPath:(id)path;
- (void)presentLoadingIndicatorCoverIfNeeded;
- (void)presentNicknameUpdatesViewControllerFromView:(id)view;
- (void)presentPhotosApp;
- (void)presentRedesignedDetailsViewForConversation:(id)conversation;
- (void)presentReplaceCompositionAlertWithConfirmationBlock:(id)block cancelBlock:(id)cancelBlock;
- (void)presentStickerDetailControllerWithIndexPath:(id)path;
- (void)presentStickerDetailsViewController:(id)controller fromChatItem:(id)item;
- (void)presentTranscriptOverlayViewController:(id)controller;
- (void)presentTranslationLanguagePickerWithCompletionHandler:(id)handler;
- (void)presentTrimControllerForMediaObject:(id)object;
- (void)presentViewController:(id)controller animated:(BOOL)animated completion:(id)completion;
- (void)presentationControllerDidDismiss:(id)dismiss;
- (void)presentedPreviewControllerDidSelectDismissToGrid;
- (void)presentedPreviewControllerDidSelectNavigateToGrid;
- (void)previewController:(id)controller didTransitionToState:(int64_t)state;
- (void)previewController:(id)controller willTransitionToState:(int64_t)state;
- (void)previewControllerDidCancelDismiss:(id)dismiss;
- (void)previewControllerDidDismiss:(id)dismiss;
- (void)previewControllerWillDismiss:(id)dismiss;
- (void)previewingContext:(id)context commitViewController:(id)controller;
- (void)prewarmFunCamera;
- (void)primeTranscriptWithInitialOffset:(CGPoint)offset inset:(UIEdgeInsets)inset;
- (void)providerWillBeRemovedFromToolbarController:(id)controller;
- (void)purgeAttachmentsForChat:(id)chat;
- (void)quickLookSelectedChatItem;
- (void)raiseGestureRecognized:(id)recognized;
- (void)readerViewControllerWillDismiss:(id)dismiss;
- (void)receivedBalloonEmphasisNotification:(id)notification;
- (void)recoverableDeleteConversation;
- (void)refreshMacToolbar;
- (void)registerChatForScreenTime:(id)time;
- (void)registerForTextInputPayloadHandling;
- (void)registerForTextinputPayloadHandlingForCheckInForConversation:(id)conversation;
- (void)registerNotifications;
- (void)registerNotificationsForConversation:(id)conversation;
- (void)relayPhoneCallFromBuddyMenu:(id)menu;
- (void)reloadEntryViewIfNeeded;
- (void)reloadFooterViewControllerIfNecessary;
- (void)removeAppCardBackgroundViewIfNecessary;
- (void)removeFooterView;
- (void)removeFromCollaboration:(id)collaboration;
- (void)removeLoadingIndicatorCoverIfNeeded;
- (void)removeLockoutControllerIfNeeded;
- (void)removeParticipant:(id)participant fromCollaboration:(id)collaboration forChatGUID:(id)d containerSetupInfo:(id)info completionHandler:(id)handler;
- (void)removeSuggestionsBanner:(id)banner animated:(BOOL)animated;
- (void)replyButtonTappedForMediaObject:(id)object previewController:(id)controller;
- (void)requestDismissKeyboardSnapshotForEffectPickerIfNeeded;
- (void)requestDismissKeyboardSnapshotForReason:(unint64_t)reason;
- (void)requestShowKeyboardSnapshotForReason:(unint64_t)reason;
- (void)resignFirstResponderOnEntryViewIfNeeded;
- (void)restoreEntryViewAfterPreview;
- (void)restoreEntryViewPasteConfiguration;
- (void)restoreInputAfterPreviewPresentation;
- (void)restoreInputAfterSearchPresentation;
- (void)retractScheduledChatItem:(id)item;
- (void)retractScheduledChatItems:(id)items fromAggregateChatItem:(id)item;
- (void)revealExistingKeyboardSnapshot;
- (void)saveButtonTappedForMediaObject:(id)object previewController:(id)controller;
- (void)saveSticker:(id)sticker sourceRect:(CGRect)rect;
- (void)saveStickerFromChatItem:(id)item pluginSourceView:(id)view animateFlyIn:(BOOL)in;
- (void)saveStickerFromDetailViewController:(id)controller chatItemContainingSticker:(id)sticker;
- (void)saveStickerFromEmojiDetails:(id)details;
- (void)saveStickerFromTapbackAttributionFlow:(id)flow;
- (void)scrollGeometryIsUpdatingForReasons:(id)reasons followingHoldForReason:(id)reason;
- (void)scrollToMessage:(id)message atSpecificMessagePartIndex:(int64_t)index highlight:(BOOL)highlight withInlineReplyOverlay:(BOOL)overlay alignedWithView:(id)view allowOverScroll:(BOOL)scroll;
- (void)scrollToMessageGUID:(id)d atSpecificMessagePartIndex:(int64_t)index highlight:(BOOL)highlight autoDismissHighlight:(BOOL)dismissHighlight withInlineReplyOverlay:(BOOL)overlay alignedWithView:(id)view allowOverScroll:(BOOL)scroll scrollPosition:(unint64_t)self0;
- (void)scrollToMessageWith:(id)with in:(id)in withInlineReplyOverlay:(BOOL)overlay;
- (void)scrollTranscriptPageUpDirection:(BOOL)direction toBounds:(BOOL)bounds;
- (void)scrollTranscriptToAlignWithMessageEditingBalloonView;
- (void)selectAccountAndSendComposition:(id)composition completion:(id)completion;
- (void)selectAllForActionManager:(id)manager;
- (void)selectContact;
- (void)selectedQuickLook:(id)look;
- (void)sendAnalyticsForElapsedSendTimeForType:(int64_t)type sharingURL:(id)l timeInterval:(double)interval;
- (void)sendAnimationManagerDidStopAnimation:(id)animation context:(id)context;
- (void)sendAnimationManagerWillStartAnimation:(id)animation context:(id)context;
- (void)sendAutomaticallyPlacedSticker:(id)sticker stickerReactionSession:(id)session forChatItem:(id)item forParentChatItem:(id)chatItem stickerFrame:(CGRect)frame animationCompletionHandler:(id)handler;
- (void)sendCollaborationCompositionAndSetSendingState:(id)state;
- (void)sendComposition:(id)composition;
- (void)sendComposition:(id)composition animations:(id)animations;
- (void)sendCompositionForCloudKit:(id)kit completion:(id)completion;
- (void)sendCompositionForCollaboration:(id)collaboration collaborationType:(int64_t)type completion:(id)completion;
- (void)sendCompositionForFileProvider:(id)provider completion:(id)completion;
- (void)sendCompositionForPendingCollaboration:(id)collaboration completion:(id)completion;
- (void)sendCompositionIfAllowed:(id)allowed;
- (void)sendCompositionWithoutThrow:(id)throw;
- (void)sendCustomAcknowledgementMessage:(id)message;
- (void)sendEmailFromBuddyMenu:(id)menu;
- (void)sendFileFromBuddyMenu:(id)menu;
- (void)sendMessageAcknowledgment:(int64_t)acknowledgment chatItem:(id)item previewController:(id)controller;
- (void)sendSelectedSuggestedReply:(id)reply messageGUID:(id)d;
- (void)sendSticker:(id)sticker toCoordinate:(CGPoint)coordinate withInitialSize:(CGSize)size dropPreviewTransform:(CGAffineTransform *)transform isRepositioningSticker:(BOOL)repositioningSticker localStickerChatItem:(id)item;
- (void)sendSticker:(id)sticker withDragTarget:(id)target draggedSticker:(id)draggedSticker;
- (void)sendSticker:(id)sticker withMediaObject:(id)object composition:(id)composition parentMessagePartChatItem:(id)item messageSummaryInfo:(id)info;
- (void)setCollaborationNoticeSuggestions:(id)suggestions;
- (void)setCollectionViewController:(id)controller;
- (void)setComposition:(id)composition;
- (void)setConversation:(id)conversation forceReload:(BOOL)reload;
- (void)setCustomAcknowledgementConversation:(id)conversation;
- (void)setEditing:(BOOL)editing animated:(BOOL)animated;
- (void)setEffectPickerIsPresented:(BOOL)presented;
- (void)setEntryView:(id)view;
- (void)setEntryViewOverrideForNewCompose:(id)compose;
- (void)setIgnoresAutomaticScrollsTowardBottom:(BOOL)bottom;
- (void)setKeyboardAlpha:(double)alpha;
- (void)setLocalUserIsComposing:(BOOL)composing withPluginBundleID:(id)d typingIndicatorData:(id)data;
- (void)setPickerContainerAccessoryView:(id)view;
- (void)setSendingCompositionBackgroundTask:(unint64_t)task;
- (void)setSendingMessage:(BOOL)message;
- (void)setShouldShowAudioButtonInEntryView:(BOOL)view;
- (void)setTargetFirstResponder:(int64_t)responder;
- (void)setUpEntryViewLayoutConstraintsIfNecessary;
- (void)setUpFilteringButtonTapped;
- (void)setUpStyleForDarkEffect;
- (void)setupClickyOrbForConversation:(id)conversation;
- (void)setupScrollingForKeyboardInteraction;
- (void)setupStateForLaunchAudio;
- (void)setupStateForLaunchPluginWithBundleID:(id)d pluginPayload:(id)payload;
- (void)setupStateForLaunchURL:(id)l;
- (void)setupThrowBalloonsInSendAnimationContext:(id)context;
- (void)showAcknowledgmentsAssociatedWithChatItem:(id)item;
- (void)showAlternateViewerForMediaObject:(id)object;
- (void)showAssociatedCellsForChatItem:(id)item animated:(BOOL)animated completion:(id)completion;
- (void)showBannerForGroupUpdate:(id)update;
- (void)showCheckInTips:(id)tips;
- (void)showContactCardFromBuddyMenu:(id)menu;
- (void)showEffectPicker;
- (void)showFullScreenBalloonFocusForChatItem:(id)item;
- (void)showInlineReplyControllerForChatItem:(id)item presentKeyboard:(BOOL)keyboard;
- (void)showInlineReplyControllerForChatItem:(id)item presentKeyboard:(BOOL)keyboard replyTransitionProperties:(id)properties;
- (void)showKeyboard;
- (void)showMediaPicker:(id)picker animated:(BOOL)animated;
- (void)showMessageEditingViewControllerForChatItem:(id)item presentKeyboard:(BOOL)keyboard;
- (void)showMessageHistoryViewController;
- (void)showModalInlineReplyControllerForChatItem:(id)item fromViewController:(id)controller;
- (void)showOrHideAcceptedContactBannerIfNeeded;
- (void)showPayloadValidationAlertWithDescription:(id)description;
- (void)showSMSReportSpamExtensionControllerForMessages:(id)messages;
- (void)showScreenTimeShieldIfNeeded;
- (void)showTranslationTips:(id)tips;
- (void)showUpdatePromptForNicknameUpdate:(id)update sourceView:(id)view completionBlock:(id)block;
- (void)showViewerForMediaObject:(id)object;
- (void)spacePressed:(id)pressed;
- (void)stageAssetArchive:(id)archive skipShelf:(BOOL)shelf completionHandler:(id)handler;
- (void)stageCurrentLocationComposition;
- (void)stageFindMyCompositionWithShareType:(int64_t)type;
- (void)stageLocationRequestComposition;
- (void)stageSelectedSuggestedReply:(id)reply;
- (void)startCommitPayload:(id)payload forConversation:(id)conversation;
- (void)startDeferredEditingPayload:(id)payload forConversation:(id)conversation;
- (void)startDownloadFor:(NSArray *)for completionHandler:(id)handler;
- (void)startDownloadingTranslationAssetsForLanguageCodes:(NSArray *)codes completion:(id)completion;
- (void)startTrimmingMediaObjectsInComposition:(id)composition;
- (void)stickerDetailViewController:(id)controller selectedStickerPackWithAdamID:(id)d;
- (void)stopForcingOrientation;
- (void)suggestionPresenterWantsToHideBanner:(id)banner;
- (void)suggestionPresenterWantsToShowBanner:(id)banner;
- (void)tapGestureRecognized:(id)recognized;
- (void)tapbackPickerBalloonParentView:(id)view didInsertTapback:(id)tapback;
- (void)tapbackPickerBalloonParentView:(id)view requestedPresentPlugin:(id)plugin payloadID:(id)d;
- (void)tapbackPickerBalloonParentViewRequestedAppCardDismiss:(id)dismiss;
- (void)tapbackPickerViewController:(id)controller didDeselectTapback:(id)tapback;
- (void)tapbackPickerViewController:(id)controller didSelectTapback:(id)tapback;
- (void)tapbackPileViewTapped:(id)tapped asset:(id)asset;
- (void)testEmphasis;
- (void)textDroppableView:(id)view dropSessionDidEnd:(id)end;
- (void)textDroppableView:(id)view dropSessionDidEnter:(id)enter;
- (void)textPasteConfigurationSupporting:(id)supporting transformPasteItem:(id)item;
- (void)throwAnimationManager:(id)manager canNowSendMessages:(id)messages;
- (void)throwAnimationManagerPrepareForThrowAnimation:(id)animation context:(id)context;
- (void)tipManagerDidDismissTranscriptBannerTip;
- (void)tipManagerDidShowTranscriptBannerTip;
- (void)toggleDetailsFromConversationsMenu:(id)menu;
- (void)toggleHideAlerts:(id)alerts;
- (void)toggleUnreadState:(id)state;
- (void)traitCollectionDidChange:(id)change;
- (void)transcriptCollectionViewController:(id)controller backgroundScrollVelocityThresholdChanged:(BOOL)changed;
- (void)transcriptCollectionViewController:(id)controller balloonView:(id)view didRequestPresentationStyle:(unint64_t)style forChatItem:(id)item allowAllStyles:(BOOL)styles;
- (void)transcriptCollectionViewController:(id)controller balloonView:(id)view didRequestReaderViewControllerForChatItem:(id)item;
- (void)transcriptCollectionViewController:(id)controller balloonView:(id)view doubleTappedItemAtIndexPath:(id)path;
- (void)transcriptCollectionViewController:(id)controller balloonView:(id)view selectedItemAtIndexPath:(id)path;
- (void)transcriptCollectionViewController:(id)controller balloonView:(id)view tappedForChatItem:(id)item;
- (void)transcriptCollectionViewController:(id)controller balloonViewDidRequestStartEditingPayload:(id)payload forPlugin:(id)plugin allowAllCommits:(BOOL)commits completionHandler:(id)handler;
- (void)transcriptCollectionViewController:(id)controller balloonViewWillDismissEditMenu:(id)menu;
- (void)transcriptCollectionViewController:(id)controller didEndImpactEffectAnimationWithSendAnimationContext:(id)context;
- (void)transcriptCollectionViewController:(id)controller didInsertChatItems:(id)items associatedChatItems:(id)chatItems;
- (void)transcriptCollectionViewController:(id)controller didScroll:(CGPoint)scroll;
- (void)transcriptCollectionViewController:(id)controller didTapAttributionButtonForChatItem:(id)item parentIndexPath:(id)path sender:(id)sender;
- (void)transcriptCollectionViewController:(id)controller didTapAttributionLinkTextForChatItem:(id)item atIndexPath:(id)path sender:(id)sender;
- (void)transcriptCollectionViewController:(id)controller didTapIntroductionsButton:(id)button ofType:(int64_t)type;
- (void)transcriptCollectionViewController:(id)controller didTapPluginStatusButtonForChatItem:(id)item;
- (void)transcriptCollectionViewController:(id)controller didTapReplyCountStatusButtonForChatItem:(id)item;
- (void)transcriptCollectionViewController:(id)controller didTapTruncatedCaptionForRichCard:(id)card onBalloonView:(id)view;
- (void)transcriptCollectionViewController:(id)controller saveLastTappedChatItemWithDataDetector:(id)detector;
- (void)transcriptCollectionViewController:(id)controller selectedChipAction:(id)action;
- (void)transcriptCollectionViewController:(id)controller selectedPollAddChoice:(id)choice;
- (void)transcriptCollectionViewController:(id)controller sendQuickReplyComposition:(id)composition withSourceView:(id)view;
- (void)transcriptCollectionViewController:(id)controller unknownSenderButtonTapped:(id)tapped forChatItem:(id)item;
- (void)transcriptCollectionViewController:(id)controller willBeginImpactEffectAnimationWithSendAnimationContext:(id)context;
- (void)transcriptCollectionViewController:(id)controller willDisplayBalloonForGUID:(id)d withIndexPath:(id)path withOriginY:(double)y;
- (void)transcriptCollectionViewController:(id)controller willDisplayContextMenuWithConfiguration:(id)configuration animator:(id)animator;
- (void)transcriptCollectionViewController:(id)controller willEndContextMenuInteractionWithConfiguration:(id)configuration animator:(id)animator;
- (void)transcriptCollectionViewController:(id)controller willPerformPreviewActionForMenuWithConfiguration:(id)configuration animator:(id)animator;
- (void)transcriptCollectionViewControllerDidChangeAssociatedChatItem:(id)item chatItemDiff:(id)diff;
- (void)transcriptCollectionViewControllerDidInset:(id)inset;
- (void)transcriptCollectionViewControllerDidSetChatItems:(id)items;
- (void)transcriptCollectionViewControllerDidUpdateTranscriptChatItems:(id)items;
- (void)transcriptCollectionViewControllerDisplaySMSSpamReporting:(id)reporting;
- (void)transcriptCollectionViewControllerNeedsChatItemLayoutInvalidation:(id)invalidation;
- (void)transcriptCollectionViewControllerPerformBatchUpdateCompleted:(id)completed;
- (void)transcriptCollectionViewControllerWillDisplayLastBalloon:(id)balloon;
- (void)transcriptCollectionViewControllerWillUpdateTranscriptChatItems:(id)items;
- (void)transcriptNavigationBar:(id)bar didTapToPerformAction:(int64_t)action;
- (void)transcriptOverlayViewController:(id)controller visibleGUIDsDidChange:(id)change;
- (void)transcriptOverlayViewControllerDidAnimateIn:(id)in;
- (void)transcriptOverlayViewControllerDidAnimateOut:(id)out;
- (void)transcriptOverlayViewControllerIsAnimatingIn:(id)in;
- (void)transcriptOverlayViewControllerIsAnimatingOut:(id)out;
- (void)transcriptOverlayViewControllerWillAnimateIn:(id)in;
- (void)transcriptOverlayViewControllerWillAnimateOut:(id)out;
- (void)transcriptScrollWithConfiguration:(id)configuration;
- (void)transcriptSharingBannerWillDismiss:(id)dismiss;
- (void)transcriptStopSharingButtonTapped:(id)tapped;
- (void)translateConversationForChatItem:(id)item;
- (void)trimController:(id)controller didFinishTrimmingMediaObject:(id)object withReplacementMediaObject:(id)mediaObject;
- (void)trimControllerDidCancel:(id)cancel;
- (void)unregisterChatForScreenTime:(id)time;
- (void)updateActiveEntryViewPositioningGuide;
- (void)updateChatControllerForRecoveredJunkConversation;
- (void)updateChatItemBalloonViewAndStickerViews:(id)views hidden:(BOOL)hidden;
- (void)updateCompositionInEntryViewWithComposition:(id)composition;
- (void)updateContact:(id)contact withHandle:(id)handle;
- (void)updateContact:(id)contact withNicknameUpdate:(id)update updateType:(unint64_t)type addHandleToContact:(BOOL)toContact presentationMode:(unint64_t)mode;
- (void)updateContactQuietlyForNicknameUpdate:(id)update updateType:(unint64_t)type;
- (void)updateEmphasis;
- (void)updateEntryViewHeightWithContentChange:(BOOL)change animated:(BOOL)animated completionHandler:(id)handler;
- (void)updateFTButton;
- (void)updateFoundInSuggestionPresenter;
- (void)updateInterfaceSelectedAction:(unint64_t)action forUpdate:(id)update;
- (void)updateNumberOfUnknownChatsOpenedIfNeeded;
- (void)updateQLPreviewControllerBarButtonItemsIfVisible;
- (void)updateQLPreviewControllerIfVisible;
- (void)updateRaiseGesture;
- (void)updateScreenTimeShieldIfNeededForChat:(id)chat;
- (void)updateSendMenuShouldElevateCheckIn;
- (void)updateSendProgress:(double)progress progressColor:(id)color animation:(id)animation;
- (void)updateStyleForCurrentEffect;
- (void)updateSupportedInterfaceOrientations:(unint64_t)orientations;
- (void)updateTyping;
- (void)validateCommand:(id)command;
- (void)viewDidAppear:(BOOL)appear;
- (void)viewDidAppearDeferredSetup;
- (void)viewDidDisappear:(BOOL)disappear;
- (void)viewDidLayoutSubviews;
- (void)viewDidLayoutSubviewsForTranscriptCollectionViewController:(id)controller;
- (void)viewDidLoad;
- (void)viewDidMoveToWindow:(id)window shouldAppearOrDisappear:(BOOL)disappear;
- (void)viewSafeAreaInsetsDidChange;
- (void)viewWillAppear:(BOOL)appear;
- (void)viewWillDisappear:(BOOL)disappear;
- (void)viewWillLayoutSubviews;
- (void)viewWillTransitionToSize:(CGSize)size withTransitionCoordinator:(id)coordinator;
- (void)willDismissFunCamera:(id)camera;
- (void)willMoveToParentViewController:(id)controller;
- (void)willPresentPreviewViewController:(id)controller forLocation:(CGPoint)location inSourceView:(id)view;
- (void)windowDidResignKey:(id)key;
@end

@implementation CKChatController

- (BOOL)prefersStatusBarHidden
{
  inputController = [(CKCoreChatController *)self inputController];
  shouldSuppressStatusBarForHandwriting = [inputController shouldSuppressStatusBarForHandwriting];

  if (shouldSuppressStatusBarForHandwriting)
  {
    return 1;
  }

  inputController2 = [(CKCoreChatController *)self inputController];
  shouldSuppressStatusBarForSendMenu = [inputController2 shouldSuppressStatusBarForSendMenu];

  if (shouldSuppressStatusBarForSendMenu)
  {
    return 1;
  }

  v8.receiver = self;
  v8.super_class = CKChatController;
  return [(CKChatController *)&v8 prefersStatusBarHidden];
}

- (id)inputViewController
{
  if ([(CKChatController *)self isShowingPreview])
  {
    inputViewController = 0;
  }

  else
  {
    inputController = [(CKCoreChatController *)self inputController];
    inputViewController = [inputController inputViewController];
  }

  return inputViewController;
}

- (int64_t)preferredStatusBarStyle
{
  inputController = [(CKCoreChatController *)self inputController];
  statusBarStyleViewController = [inputController statusBarStyleViewController];

  if (statusBarStyleViewController)
  {
    preferredStatusBarStyle = [statusBarStyleViewController preferredStatusBarStyle];
  }

  else
  {
    v5 = +[CKUIBehavior sharedBehaviors];
    theme = [v5 theme];
    preferredStatusBarStyle = [theme statusBarStyle];
  }

  return preferredStatusBarStyle;
}

- (id)inputAccessoryView
{
  v57 = *MEMORY[0x1E69E9840];
  if (-[CKChatController inputAccessoryViewControllerEnabled](self, "inputAccessoryViewControllerEnabled") || -[CKCoreChatController isShowingLockoutView](self, "isShowingLockoutView") || (+[CKUIBehavior sharedBehaviors](CKUIBehavior, "sharedBehaviors"), v3 = objc_claimAutoreleasedReturnValue(), v4 = [v3 isEntryViewInputAccessory], v3, !v4))
  {
    entryView = 0;
  }

  else
  {
    if ([(CKChatController *)self shouldShowEntryView])
    {
      entryView = [(CKChatController *)self entryView];
    }

    else
    {
      entryView = 0;
    }

    inputController = [(CKCoreChatController *)self inputController];
    [inputController setEntryView:entryView];

    if ([(CKChatController *)self appManagerDisplayedInMessages])
    {
      presentedViewController = [(CKChatController *)self presentedViewController];
      isBeingDismissed = [presentedViewController isBeingDismissed];

      if ((isBeingDismissed & 1) == 0)
      {
        if (IMOSLoggingEnabled())
        {
          v10 = OSLogHandleForIMFoundationCategory();
          if (os_log_type_enabled(v10, OS_LOG_TYPE_INFO))
          {
            *buf = 0;
            _os_log_impl(&dword_19020E000, v10, OS_LOG_TYPE_INFO, "EntryView Debug - Not vending IAV, -appManagerDisplayedInMessages is YES", buf, 2u);
          }
        }

        entryView = 0;
      }
    }

    if ([(CKChatController *)self appModalIsDisplayed])
    {
      inputController2 = [(CKCoreChatController *)self inputController];
      isDismissingAppModal = [inputController2 isDismissingAppModal];

      if ((isDismissingAppModal & 1) == 0)
      {
        if (IMOSLoggingEnabled())
        {
          v13 = OSLogHandleForIMFoundationCategory();
          if (os_log_type_enabled(v13, OS_LOG_TYPE_INFO))
          {
            *buf = 0;
            _os_log_impl(&dword_19020E000, v13, OS_LOG_TYPE_INFO, "EntryView Debug - Not vending IAV, -appModalIsDisplayed is YES", buf, 2u);
          }
        }

        entryView = 0;
      }
    }

    presentedViewController2 = [(CKChatController *)self presentedViewController];
    v15 = presentedViewController2;
    if (presentedViewController2 && ([presentedViewController2 isBeingDismissed] & 1) == 0)
    {
      if (IMOSLoggingEnabled())
      {
        v16 = OSLogHandleForIMFoundationCategory();
        if (os_log_type_enabled(v16, OS_LOG_TYPE_INFO))
        {
          *buf = 0;
          _os_log_impl(&dword_19020E000, v16, OS_LOG_TYPE_INFO, "EntryView Debug - Not vending IAV, presenting view controller", buf, 2u);
        }
      }

      entryView = 0;
    }

    if (IMOSLoggingEnabled())
    {
      v17 = OSLogHandleForIMFoundationCategory();
      if (os_log_type_enabled(v17, OS_LOG_TYPE_INFO))
      {
        v18 = objc_opt_class();
        v38 = NSStringFromClass(v18);
        [entryView alpha];
        v20 = v19;
        [entryView frame];
        v36 = NSStringFromCGRect(v59);
        window = [entryView window];
        v21 = objc_opt_class();
        v35 = NSStringFromClass(v21);
        window2 = [entryView window];
        view = [(CKChatController *)self view];
        window3 = [view window];
        firstResponder = [window3 firstResponder];
        v23 = objc_opt_class();
        v24 = NSStringFromClass(v23);
        view2 = [(CKChatController *)self view];
        window4 = [view2 window];
        firstResponder2 = [window4 firstResponder];
        view3 = [(CKChatController *)self view];
        window5 = [view3 window];
        isKeyWindow = [window5 isKeyWindow];
        v31 = @"NO";
        *buf = 138414338;
        v40 = v38;
        v41 = 2048;
        if (isKeyWindow)
        {
          v31 = @"YES";
        }

        v42 = entryView;
        v43 = 2048;
        v44 = v20;
        v45 = 2112;
        v46 = v36;
        v47 = 2112;
        v48 = v35;
        v49 = 2048;
        v50 = window2;
        v51 = 2112;
        v52 = v24;
        v53 = 2048;
        v54 = firstResponder2;
        v55 = 2112;
        v56 = v31;
        _os_log_impl(&dword_19020E000, v17, OS_LOG_TYPE_INFO, "EntryView Debug - IAV %@ <%p> Alpha %f Frame %@ IAV Window %@ <%p>  Current FR %@ <%p> View window is key - %@", buf, 0x5Cu);
      }
    }
  }

  return entryView;
}

- (BOOL)inputAccessoryViewControllerEnabled
{
  mEMORY[0x1E69A8070] = [MEMORY[0x1E69A8070] sharedFeatureFlags];
  isTranscriptSharingEnabled = [mEMORY[0x1E69A8070] isTranscriptSharingEnabled];

  if (isTranscriptSharingEnabled && (-[CKCoreChatController conversation](self, "conversation"), v5 = objc_claimAutoreleasedReturnValue(), [v5 chat], v6 = objc_claimAutoreleasedReturnValue(), v7 = objc_msgSend(v6, "isStewieSharingChat"), v6, v5, (v7 & 1) != 0))
  {
    LOBYTE(v8) = 0;
  }

  else
  {
    v8 = CKInputAccessoryViewControllerEnabled();
    if (v8)
    {
      LOBYTE(v8) = ![(CKCoreChatController *)self isShowingLockoutView];
    }
  }

  return v8;
}

- (double)_maxEntryViewHeight
{
  v92 = *MEMORY[0x1E69E9840];
  frozenEntryViewHeightDuringDismissAnimation = self->_frozenEntryViewHeightDuringDismissAnimation;
  if (!frozenEntryViewHeightDuringDismissAnimation)
  {
    entryView = [(CKChatController *)self entryView];
    view = [(CKChatController *)self view];
    [view bounds];
    v80 = v8;
    v81 = v7;
    rect = v9;
    v11 = v10;

    [(CKScrollViewController *)self navigationBarInsets];
    v13 = v12;
    [(CKChatController *)self _entryViewTopInsetPadding];
    v15 = v14;
    if (IMOSLoggingEnabled())
    {
      v16 = OSLogHandleForIMFoundationCategory();
      if (os_log_type_enabled(v16, OS_LOG_TYPE_INFO))
      {
        v94.origin.y = v80;
        v94.origin.x = v81;
        v94.size.width = rect;
        v94.size.height = v11;
        NSStringFromCGRect(v94);
        v17 = COERCE_DOUBLE(objc_claimAutoreleasedReturnValue());
        [(CKScrollViewController *)self navigationBarInsets];
        v19 = v18;
        [(CKChatController *)self _entryViewTopInsetPadding];
        *buf = 138412802;
        v83 = v17;
        v84 = 2048;
        v85 = v19;
        v86 = 2048;
        v87 = v20;
        _os_log_impl(&dword_19020E000, v16, OS_LOG_TYPE_INFO, "entryView: Calculating max entry view height. Bounds: %@, navbar top inset: %f, entryView top inset: %f", buf, 0x20u);
      }
    }

    catchUpButton = [(CKChatController *)self catchUpButton];

    v22 = v13 + v15;
    if (catchUpButton)
    {
      catchUpButton2 = [(CKChatController *)self catchUpButton];
      [catchUpButton2 frame];
      v25 = v24;
      catchUpButton3 = [(CKChatController *)self catchUpButton];
      [catchUpButton3 frame];
      v28 = v27;

      if (v22 < v25 + v28)
      {
        v22 = v25 + v28;
      }
    }

    view2 = [(CKChatController *)self view];
    [view2 bounds];
    Width = CGRectGetWidth(v95);

    mEMORY[0x1E69A8070] = [MEMORY[0x1E69A8070] sharedFeatureFlags];
    isModernSplitViewControllerEnabled = [mEMORY[0x1E69A8070] isModernSplitViewControllerEnabled];

    if (isModernSplitViewControllerEnabled)
    {
      view3 = [(CKChatController *)self view];
      [view3 safeAreaInsets];
      v35 = v34;
      v37 = v36;

      Width = Width - (v35 + v37);
    }

    [entryView sizeThatFits:{Width, 1.79769313e308}];
    v39 = v38;
    window = [entryView window];
    v41 = window == 0;

    if (v41)
    {
      if (IMOSLoggingEnabled())
      {
        v51 = OSLogHandleForIMFoundationCategory();
        if (os_log_type_enabled(v51, OS_LOG_TYPE_INFO))
        {
          *buf = 134217984;
          v83 = v39;
          _os_log_impl(&dword_19020E000, v51, OS_LOG_TYPE_INFO, "entryView: Entry does not have a window, return maxEntryViewHeight: %f", buf, 0xCu);
        }

        goto LABEL_58;
      }

      goto LABEL_67;
    }

    view4 = [(CKChatController *)self view];
    if ([entryView isDescendantOfView:view4])
    {
      [entryView frame];
      v44 = v43;
      v46 = v45;
      v48 = v47;
      v50 = v49;
    }

    else
    {
      [entryView bounds];
      v53 = v52;
      v55 = v54;
      v57 = v56;
      v59 = v58;
      view5 = [(CKChatController *)self view];
      [entryView convertRect:view5 toView:{v53, v55, v57, v59}];
      v44 = v61;
      v46 = v62;
      v48 = v63;
      v50 = v64;
    }

    if (v46 == 0.0)
    {
      v96.origin.y = v80;
      v96.origin.x = v81;
      v96.size.width = rect;
      v96.size.height = v11;
      MaxY = CGRectGetMaxY(v96);
      if (IMOSLoggingEnabled())
      {
        v66 = OSLogHandleForIMFoundationCategory();
        if (os_log_type_enabled(v66, OS_LOG_TYPE_INFO))
        {
          v97.origin.x = v44;
          v97.origin.y = v46;
          v97.size.width = v48;
          v97.size.height = v50;
          NSStringFromCGRect(v97);
          v67 = COERCE_DOUBLE(objc_claimAutoreleasedReturnValue());
          v98.origin.y = v80;
          v98.origin.x = v81;
          v98.size.width = rect;
          v98.size.height = v11;
          v68 = CGRectGetMaxY(v98);
          *buf = 138412546;
          v83 = v67;
          v84 = 2048;
          v85 = v68;
          _os_log_impl(&dword_19020E000, v66, OS_LOG_TYPE_INFO, "entryView: entryViewCurrentBoundsInViewControllerCoordinates.origin.y (%@) is <= 0, setting entryViewCurrentMaxY to max y: %f", buf, 0x16u);
        }
      }
    }

    else
    {
      if (IMOSLoggingEnabled())
      {
        v69 = OSLogHandleForIMFoundationCategory();
        if (os_log_type_enabled(v69, OS_LOG_TYPE_INFO))
        {
          v99.origin.x = v44;
          v99.origin.y = v46;
          v99.size.width = v48;
          v99.size.height = v50;
          NSStringFromCGRect(v99);
          v70 = COERCE_DOUBLE(objc_claimAutoreleasedReturnValue());
          v100.origin.x = v44;
          v100.origin.y = v46;
          v100.size.width = v48;
          v100.size.height = v50;
          v71 = CGRectGetMaxY(v100);
          *buf = 138412546;
          v83 = v70;
          v84 = 2048;
          v85 = v71;
          _os_log_impl(&dword_19020E000, v69, OS_LOG_TYPE_INFO, "entryView: entryViewCurrentBoundsInViewControllerCoordinates.origin.y (%@) is not 0, setting entryViewCurrentMaxY to max y: %f", buf, 0x16u);
        }
      }

      v101.origin.x = v44;
      v101.origin.y = v46;
      v101.size.width = v48;
      v101.size.height = v50;
      MaxY = CGRectGetMaxY(v101);
    }

    isInHardwareKeyboardMode = [MEMORY[0x1E69DCBB8] isInHardwareKeyboardMode];
    v73 = MaxY - v39;
    if (MaxY - v39 > v22)
    {
      if (IMOSLoggingEnabled())
      {
        v51 = OSLogHandleForIMFoundationCategory();
        if (os_log_type_enabled(v51, OS_LOG_TYPE_INFO))
        {
          *buf = 134217984;
          v83 = v39;
          _os_log_impl(&dword_19020E000, v51, OS_LOG_TYPE_INFO, "entryView: There is still room for the entry view to expand, return maxEntryViewHeight: %f", buf, 0xCu);
        }

LABEL_58:

        goto LABEL_67;
      }

      goto LABEL_67;
    }

    v74 = MaxY - v22;
    if (v73 < 0.0)
    {
      if (IMOSLoggingEnabled())
      {
        v75 = OSLogHandleForIMFoundationCategory();
        if (os_log_type_enabled(v75, OS_LOG_TYPE_INFO))
        {
          if (v74 >= v39)
          {
            v76 = v39;
          }

          else
          {
            v76 = MaxY - v22;
          }

          [(CKScrollViewController *)self keyboardFrameInViewCoordinates];
          v77 = NSStringFromCGRect(v102);
          *buf = 134219010;
          v83 = v73;
          v84 = 2048;
          v85 = v74;
          v86 = 2048;
          v87 = v39;
          v88 = 2048;
          v89 = v76;
          v90 = 2112;
          v91 = v77;
          _os_log_impl(&dword_19020E000, v75, OS_LOG_TYPE_INFO, "entryView: entryViewOriginYAtFittingSize(%f) is negative, return min of availableHeight(%f) and entryViewFittingHeight(%f): %f. KeyboardFrameInViewCoordinates: %@", buf, 0x34u);
        }
      }

      if (v74 >= 0.0)
      {
        if (v74 < v39)
        {
          v39 = v74;
        }

        goto LABEL_67;
      }

      if (IMOSLoggingEnabled())
      {
        v51 = OSLogHandleForIMFoundationCategory();
        if (os_log_type_enabled(v51, OS_LOG_TYPE_INFO))
        {
          *buf = 134218240;
          v83 = v74;
          v84 = 2048;
          v85 = v39;
          _os_log_impl(&dword_19020E000, v51, OS_LOG_TYPE_INFO, "entryView: availableHeight(%f) is negative, returning entryViewFittingHeight(%f)", buf, 0x16u);
        }

        goto LABEL_58;
      }

LABEL_67:

      return v39;
    }

    if (isInHardwareKeyboardMode)
    {
      if (IMOSLoggingEnabled())
      {
        v78 = OSLogHandleForIMFoundationCategory();
        if (os_log_type_enabled(v78, OS_LOG_TYPE_INFO))
        {
          *buf = 134217984;
          v83 = MaxY - v22;
          _os_log_impl(&dword_19020E000, v78, OS_LOG_TYPE_INFO, "entryView: Is in hardware keyboard mode, return availableHeight: %f", buf, 0xCu);
        }

LABEL_65:
      }
    }

    else
    {
      if (v74 < 0.0)
      {
        v51 = IMLogHandleForCategory();
        if (os_log_type_enabled(v51, OS_LOG_TYPE_ERROR))
        {
          [CKChatController _maxEntryViewHeight];
        }

        goto LABEL_58;
      }

      if (IMOSLoggingEnabled())
      {
        v78 = OSLogHandleForIMFoundationCategory();
        if (os_log_type_enabled(v78, OS_LOG_TYPE_INFO))
        {
          *buf = 134217984;
          v83 = MaxY - v22;
          _os_log_impl(&dword_19020E000, v78, OS_LOG_TYPE_INFO, "entryView: Found max height in view controller, return entryViewMaxHeightInViewController: %f", buf, 0xCu);
        }

        goto LABEL_65;
      }
    }

    v39 = MaxY - v22;
    goto LABEL_67;
  }

  [(NSNumber *)frozenEntryViewHeightDuringDismissAnimation doubleValue];
  return result;
}

- (CKMessageEntryView)entryView
{
  entryViewController = [(CKChatController *)self entryViewController];
  entryView = [entryViewController entryView];

  return entryView;
}

- (CKChatControllerSendMenuDelegate)sendMenuDelegate
{
  WeakRetained = objc_loadWeakRetained(&self->_sendMenuDelegate);

  return WeakRetained;
}

- (BOOL)isUsingVisibleInputViewHeightWhenUpdatingScrollGeometry
{
  entryViewContainerView = [(CKChatController *)self entryViewContainerView];
  entryViewStuckToChatControllerBottomLayoutConstraint = [entryViewContainerView entryViewStuckToChatControllerBottomLayoutConstraint];
  isActive = [entryViewStuckToChatControllerBottomLayoutConstraint isActive];

  return isActive ^ 1;
}

- (double)visibleInputViewHeight
{
  if ([(NSLayoutConstraint *)self->_entryViewAppCardLayoutConstraint isActive])
  {
    entryViewAppCardLayoutConstraint = self->_entryViewAppCardLayoutConstraint;

    [(NSLayoutConstraint *)entryViewAppCardLayoutConstraint constant];
  }

  else
  {
    isInHardwareKeyboardMode = [MEMORY[0x1E69DCBB8] isInHardwareKeyboardMode];
    collectionView = [(CKChatController *)self collectionView];
    isDragging = [collectionView isDragging];

    view = [(CKChatController *)self view];
    window = [view window];
    windowScene = [window windowScene];
    _enhancedWindowingEnabled = [windowScene _enhancedWindowingEnabled];

    if (isInHardwareKeyboardMode & 1) != 0 || (isDragging & 1) != 0 || (([(CKChatController *)self dismissingContextMenu]| _enhancedWindowingEnabled))
    {

      [(CKChatController *)self _keyboardHeightFromLayoutGuide];
    }

    else
    {
      v12.receiver = self;
      v12.super_class = CKChatController;
      [(CKScrollViewController *)&v12 visibleInputViewHeight];
    }
  }

  return result;
}

- (double)bottomInsetPadding
{
  v3 = +[CKUIBehavior sharedBehaviors];
  entryViewFollowsKeyboardLayoutGuide = [v3 entryViewFollowsKeyboardLayoutGuide];

  entryView = [(CKChatController *)self entryView];
  window = [entryView window];
  v7 = window;
  if (entryViewFollowsKeyboardLayoutGuide)
  {

    if (v7)
    {
      heightConstraint = [entryView heightConstraint];
      [heightConstraint constant];
      v10 = v9;
    }

    else
    {
      heightConstraint = [(CKChatController *)self view];
      [heightConstraint safeAreaInsets];
      v10 = v12;
    }

    goto LABEL_8;
  }

  v10 = 0.0;
  if (!v7)
  {
    entryView = [(CKChatController *)self view];
    [entryView safeAreaInsets];
    v10 = v11;
LABEL_8:
  }

  return v10;
}

- (double)minimumBottomInset
{
  footerViewController = [(CKChatController *)self footerViewController];
  v4 = footerViewController;
  if (footerViewController)
  {
    view = [footerViewController view];
    [view frame];
    v7 = v6;
    view2 = [(CKChatController *)self view];
    [view2 safeAreaInsets];
    Height = v7 + v9;
LABEL_11:

    goto LABEL_12;
  }

  if ([(CKChatController *)self inputAccessoryViewControllerEnabled])
  {
    inputAccessoryViewController = [(CKChatController *)self inputAccessoryViewController];
    view = [inputAccessoryViewController view];

    if (view)
    {
LABEL_5:
      [view frame];
      Height = CGRectGetHeight(v16);
      goto LABEL_8;
    }
  }

  else
  {
    view = [(CKChatController *)self inputAccessoryView];
    if (view)
    {
      goto LABEL_5;
    }
  }

  Height = 0.0;
LABEL_8:
  view2 = +[CKUIBehavior sharedBehaviors];
  if (![view2 transcriptMinBottomInsetIsEntryViewHeight])
  {
    goto LABEL_11;
  }

  entryView = [(CKChatController *)self entryView];
  window = [entryView window];

  if (window)
  {
    view2 = [(CKChatController *)self entryView];
    [view2 frame];
    Height = v14;
    goto LABEL_11;
  }

LABEL_12:

  return Height;
}

- (void)computedInsetsDidChange
{
  collectionViewController = [(CKCoreChatController *)self collectionViewController];
  [collectionViewController updateDockingMetricsIfNeeded];
}

- (CKTapbackPickerContainerAccessoryView)pickerContainerAccessoryView
{
  WeakRetained = objc_loadWeakRetained(&self->_pickerContainerAccessoryView);

  return WeakRetained;
}

- (CKTranscriptCollectionView)collectionView
{
  collectionViewController = [(CKCoreChatController *)self collectionViewController];
  collectionView = [collectionViewController collectionView];

  return collectionView;
}

- (double)topInsetPadding
{
  tipManager = [(CKChatController *)self tipManager];
  presentingTopAlignedTip = [tipManager presentingTopAlignedTip];

  if (!presentingTopAlignedTip)
  {
    nicknameBanner = [(CKChatController *)self nicknameBanner];

    if (nicknameBanner)
    {
      v39.receiver = self;
      v39.super_class = CKChatController;
      [(CKScrollViewController *)&v39 topInsetPadding];
      v6 = v10;
      nicknameBanner2 = [(CKChatController *)self nicknameBanner];
      [nicknameBanner2 bounds];
      Height = CGRectGetHeight(v41);
      goto LABEL_5;
    }

    acceptedContactBanner = [(CKChatController *)self acceptedContactBanner];

    if (acceptedContactBanner)
    {
      v38.receiver = self;
      v38.super_class = CKChatController;
      [(CKScrollViewController *)&v38 topInsetPadding];
      v15 = v14;
      acceptedContactBanner2 = [(CKChatController *)self acceptedContactBanner];
LABEL_10:
      nicknameBanner2 = acceptedContactBanner2;
      [acceptedContactBanner2 frame];
      v11 = v15 + v17;
      goto LABEL_6;
    }

    if ([(CKChatController *)self _anySuggestionPresenterWantsToShowBanner])
    {
      collectionView = [(CKChatController *)self collectionView];
      [collectionView contentInset];
      v20 = v19;
      v22 = v21;

      collectionView2 = [(CKChatController *)self collectionView];
      [collectionView2 bounds];
      v25 = v24 - v20 - v22;

      collectionView3 = [(CKChatController *)self collectionView];
      [collectionView3 contentSize];
      v28 = v27;

      if (v28 < v25)
      {
        v37.receiver = self;
        v37.super_class = CKChatController;
        [(CKScrollViewController *)&v37 topInsetPadding];
        v30 = v29;
        [(CKChatController *)self suggestionBannerHeight];
        return v30 + v31;
      }
    }

    else
    {
      notificationBannerView = [(CKChatController *)self notificationBannerView];

      if (notificationBannerView)
      {
        v36.receiver = self;
        v36.super_class = CKChatController;
        [(CKScrollViewController *)&v36 topInsetPadding];
        v15 = v33;
        acceptedContactBanner2 = [(CKChatController *)self notificationBannerView];
        goto LABEL_10;
      }
    }

    v35.receiver = self;
    v35.super_class = CKChatController;
    [(CKScrollViewController *)&v35 topInsetPadding];
    return v34;
  }

  v40.receiver = self;
  v40.super_class = CKChatController;
  [(CKScrollViewController *)&v40 topInsetPadding];
  v6 = v5;
  nicknameBanner2 = [(CKChatController *)self tipManager];
  [nicknameBanner2 tipHeight];
LABEL_5:
  v11 = v6 + Height;
LABEL_6:

  return v11;
}

- (BOOL)_anySuggestionPresenterWantsToShowBanner
{
  standardSuggestionPresenter = [(CKChatController *)self standardSuggestionPresenter];
  if ([standardSuggestionPresenter wantsToShowBanner])
  {
    wantsToShowBanner = 1;
  }

  else
  {
    foundInSuggestionPresenter = [(CKChatController *)self foundInSuggestionPresenter];
    wantsToShowBanner = [foundInSuggestionPresenter wantsToShowBanner];
  }

  return wantsToShowBanner;
}

- (double)gradientBottomPlaceholderHeight
{
  entryView = [(CKChatController *)self entryView];
  [entryView placeholderHeight];
  v4 = v3;

  return v4;
}

- (void)_updateBannerNotifications
{
  [(CKChatController *)self _updateAccountRegistrationFailureNotification];
  [(CKChatController *)self _updateLogoutBannerNotification];

  [(CKChatController *)self _updateNotDefaultTextingAppNotification];
}

- (void)_updateAccountRegistrationFailureNotification
{
  if (CKIsAppleIDNotUpdated())
  {
    v3 = 0;
    v4 = 3;
  }

  else
  {
    v5 = CKIsWaitingForCloud();
    v3 = v5 ^ 1;
    if (v5)
    {
      v4 = 2;
    }

    else
    {
      v4 = 0;
    }
  }

  if ([(CKChatController *)self notificationBannerType]!= v4 && ([(CKChatController *)self notificationBannerType]& 0xFFFFFFFFFFFFFFFELL) == 2)
  {
    [(CKChatController *)self _updateNotificationBannerOfType:[(CKChatController *)self notificationBannerType] show:0];
  }

  v6 = (v3 & 1) == 0 && [(CKChatController *)self _chatShowsAccountRegistrationFailureBanner];

  [(CKChatController *)self _updateNotificationBannerOfType:v4 show:v6];
}

- (void)_updateLogoutBannerNotification
{
  if (CKIsRunningInMessages() && !CKIsRunningUITests() && !CKIsRunningForDevelopmentOnSimulator())
  {
    v8 = +[CKUIBehavior sharedBehaviors];
    if ([v8 isRunningInStoreDemoMode])
    {
    }

    else
    {
      _isRunningPPT = [(CKChatController *)self _isRunningPPT];

      if (!_isRunningPPT)
      {
        chat = [(CKCoreChatController *)self chat];
        isStewieChat = [chat isStewieChat];

        if ((isStewieChat & 1) == 0)
        {
          if (CKIsUnexpectedlyLoggedOut() && [(CKChatController *)self _chatShowsAccountRegistrationFailureBanner])
          {
            selfCopy2 = self;
            v7 = 1;
          }

          else
          {
            selfCopy2 = self;
            v7 = 0;
          }

          [(CKChatController *)selfCopy2 _updateNotificationBannerOfType:1 show:v7];
        }
      }
    }
  }
}

- (void)_updateNotDefaultTextingAppNotification
{
  mEMORY[0x1E69A8070] = [MEMORY[0x1E69A8070] sharedFeatureFlags];
  isTextAccessFor3rdPartyEnabled = [mEMORY[0x1E69A8070] isTextAccessFor3rdPartyEnabled];

  if (isTextAccessFor3rdPartyEnabled)
  {
    conversation = [(CKCoreChatController *)self conversation];
    chat = [conversation chat];
    if (chat)
    {
      v6 = chat;
      conversation2 = [(CKCoreChatController *)self conversation];
      sendingService = [conversation2 sendingService];

      if (sendingService)
      {
        objc_opt_class();
        if ((objc_opt_isKindOfClass() & 1) != 0 || !CKIsRunningInMessages())
        {
          v13 = 0;
        }

        else
        {
          conversation3 = [(CKCoreChatController *)self conversation];
          sendingService2 = [conversation3 sendingService];
          conversation4 = [(CKCoreChatController *)self conversation];
          chat2 = [conversation4 chat];
          v13 = [sendingService2 __ck_isSendingAllowedForChat:chat2] ^ 1;
        }

        [(CKChatController *)self _updateNotificationBannerOfType:4 show:v13];
      }
    }

    else
    {
    }
  }
}

- (void)scrollTranscriptToAlignWithMessageEditingBalloonView
{
  messageEditingViewController = [(CKChatController *)self messageEditingViewController];
  v4 = messageEditingViewController;
  if (messageEditingViewController)
  {
    transitionContext = [messageEditingViewController transitionContext];
    anchorChatItemGUID = [transitionContext anchorChatItemGUID];

    balloonViewForAlignment = [v4 balloonViewForAlignment];
    collectionViewController = [(CKCoreChatController *)self collectionViewController];
    v9 = [collectionViewController chatItemForGUID:anchorChatItemGUID];

    v10 = v9;
    message = [v10 message];
    index = [v10 index];
    objc_initWeak(&location, self);
    collectionView = [(CKChatController *)self collectionView];
    v16[0] = MEMORY[0x1E69E9820];
    v16[1] = 3221225472;
    v16[2] = __72__CKChatController_scrollTranscriptToAlignWithMessageEditingBalloonView__block_invoke;
    v16[3] = &unk_1E72EB918;
    objc_copyWeak(v19, &location);
    v14 = message;
    v17 = v14;
    v19[1] = index;
    v15 = balloonViewForAlignment;
    v18 = v15;
    [collectionView performContentOffsetUpdateTemporarilyOverridingHoldStatus:v16];

    objc_destroyWeak(v19);
    objc_destroyWeak(&location);
  }
}

- (void)setupScrollingForKeyboardInteraction
{
  collectionViewController = [(CKCoreChatController *)self collectionViewController];
  collectionView = [collectionViewController collectionView];
  [collectionView contentSize];
  v6 = v5;

  collectionViewController2 = [(CKCoreChatController *)self collectionViewController];
  [collectionViewController2 setScrollAnchor:v6];
}

- (void)_layoutEntryViewSuperview
{
  entryView = [(CKChatController *)self entryView];
  superview = [entryView superview];

  [superview setNeedsLayout];
  if ([(CKCoreChatController *)self initialLayoutComplete])
  {
    if (IMOSLoggingEnabled())
    {
      v5 = OSLogHandleForIMFoundationCategory();
      if (os_log_type_enabled(v5, OS_LOG_TYPE_INFO))
      {
        *v6 = 0;
        _os_log_impl(&dword_19020E000, v5, OS_LOG_TYPE_INFO, "Triggering layout for entry view positioning change", v6, 2u);
      }
    }

    [superview layoutIfNeeded];
  }
}

- (void)updateActiveEntryViewPositioningGuide
{
  v31 = *MEMORY[0x1E69E9840];
  entryView = [(CKChatController *)self entryView];
  window = [entryView window];

  if (!window)
  {
    return;
  }

  _determineEntryViewPositioningGuideToActivate = [(CKChatController *)self _determineEntryViewPositioningGuideToActivate];
  if (IMOSLoggingEnabled())
  {
    v6 = OSLogHandleForIMFoundationCategory();
    if (os_log_type_enabled(v6, OS_LOG_TYPE_INFO))
    {
      v29 = 134217984;
      v30 = _determineEntryViewPositioningGuideToActivate;
      _os_log_impl(&dword_19020E000, v6, OS_LOG_TYPE_INFO, "positioningGuideToActivate: %lu", &v29, 0xCu);
    }
  }

  if (_determineEntryViewPositioningGuideToActivate <= 1)
  {
    if (_determineEntryViewPositioningGuideToActivate)
    {
      if (_determineEntryViewPositioningGuideToActivate != 1)
      {
        return;
      }

      if (IMOSLoggingEnabled())
      {
        v12 = OSLogHandleForIMFoundationCategory();
        if (os_log_type_enabled(v12, OS_LOG_TYPE_INFO))
        {
          LOWORD(v29) = 0;
          _os_log_impl(&dword_19020E000, v12, OS_LOG_TYPE_INFO, "Updating entry view positioning guide to follow Keyboard Snapshot", &v29, 2u);
        }
      }

      [(NSLayoutConstraint *)self->_entryViewFauxKeyboardLayoutConstraint setActive:0];
      [(NSLayoutConstraint *)self->_entryViewKeyboardLayoutConstraint setActive:0];
      [(NSLayoutConstraint *)self->_entryViewAppCardLayoutConstraint setActive:0];
      [(NSLayoutConstraint *)self->_entryViewChatFooterViewLayoutConstraint setActive:0];
      entryViewStuckToChatControllerBottomLayoutConstraint = [(CKMessageEntryViewContainerView *)self->_entryViewContainerView entryViewStuckToChatControllerBottomLayoutConstraint];
      isActive = [entryViewStuckToChatControllerBottomLayoutConstraint isActive];

      if (isActive)
      {
        entryViewStuckToChatControllerBottomLayoutConstraint2 = [(CKMessageEntryViewContainerView *)self->_entryViewContainerView entryViewStuckToChatControllerBottomLayoutConstraint];
        [entryViewStuckToChatControllerBottomLayoutConstraint2 setActive:0];
      }

      isActive2 = [(NSLayoutConstraint *)self->_entryViewKeyboardSnapshotLayoutConstraint isActive];
      [(NSLayoutConstraint *)self->_entryViewKeyboardSnapshotLayoutConstraint setActive:1];
    }

    else
    {
      if (IMOSLoggingEnabled())
      {
        v23 = OSLogHandleForIMFoundationCategory();
        if (os_log_type_enabled(v23, OS_LOG_TYPE_INFO))
        {
          LOWORD(v29) = 0;
          _os_log_impl(&dword_19020E000, v23, OS_LOG_TYPE_INFO, "Updating entry view positioning guide to follow Keyboard", &v29, 2u);
        }
      }

      [(NSLayoutConstraint *)self->_entryViewKeyboardSnapshotLayoutConstraint setActive:0];
      [(NSLayoutConstraint *)self->_entryViewAppCardLayoutConstraint setActive:0];
      [(NSLayoutConstraint *)self->_entryViewChatFooterViewLayoutConstraint setActive:0];
      entryViewStuckToChatControllerBottomLayoutConstraint3 = [(CKMessageEntryViewContainerView *)self->_entryViewContainerView entryViewStuckToChatControllerBottomLayoutConstraint];
      isActive = [entryViewStuckToChatControllerBottomLayoutConstraint3 isActive];

      if (isActive)
      {
        entryViewStuckToChatControllerBottomLayoutConstraint4 = [(CKMessageEntryViewContainerView *)self->_entryViewContainerView entryViewStuckToChatControllerBottomLayoutConstraint];
        [entryViewStuckToChatControllerBottomLayoutConstraint4 setActive:0];
      }

      entryViewFauxKeyboardLayoutConstraint = self->_entryViewFauxKeyboardLayoutConstraint;
      if (entryViewFauxKeyboardLayoutConstraint)
      {
        isActive2 = [(NSLayoutConstraint *)entryViewFauxKeyboardLayoutConstraint isActive];
        [(NSLayoutConstraint *)self->_entryViewFauxKeyboardLayoutConstraint setActive:1];
      }

      else
      {
        isActive2 = [(NSLayoutConstraint *)self->_entryViewKeyboardLayoutConstraint isActive];
        [(NSLayoutConstraint *)self->_entryViewKeyboardLayoutConstraint setActive:1];
      }
    }

LABEL_60:
    if (((!isActive2 | isActive) & 1) == 0)
    {
      return;
    }

    goto LABEL_61;
  }

  if (_determineEntryViewPositioningGuideToActivate == 2)
  {
    if (IMOSLoggingEnabled())
    {
      v17 = OSLogHandleForIMFoundationCategory();
      if (os_log_type_enabled(v17, OS_LOG_TYPE_INFO))
      {
        LOWORD(v29) = 0;
        _os_log_impl(&dword_19020E000, v17, OS_LOG_TYPE_INFO, "Updating entry view positioning guide to follow App Card", &v29, 2u);
      }
    }

    [(NSLayoutConstraint *)self->_entryViewFauxKeyboardLayoutConstraint setActive:0];
    [(NSLayoutConstraint *)self->_entryViewKeyboardLayoutConstraint setActive:0];
    [(NSLayoutConstraint *)self->_entryViewKeyboardSnapshotLayoutConstraint setActive:0];
    [(NSLayoutConstraint *)self->_entryViewChatFooterViewLayoutConstraint setActive:0];
    entryViewStuckToChatControllerBottomLayoutConstraint5 = [(CKMessageEntryViewContainerView *)self->_entryViewContainerView entryViewStuckToChatControllerBottomLayoutConstraint];
    isActive = [entryViewStuckToChatControllerBottomLayoutConstraint5 isActive];

    if (isActive)
    {
      entryViewStuckToChatControllerBottomLayoutConstraint6 = [(CKMessageEntryViewContainerView *)self->_entryViewContainerView entryViewStuckToChatControllerBottomLayoutConstraint];
      [entryViewStuckToChatControllerBottomLayoutConstraint6 setActive:0];
    }

    isActive2 = [(NSLayoutConstraint *)self->_entryViewAppCardLayoutConstraint isActive];
    [(NSLayoutConstraint *)self->_entryViewAppCardLayoutConstraint setActive:1];
    goto LABEL_60;
  }

  if (_determineEntryViewPositioningGuideToActivate == 4)
  {
    if (IMOSLoggingEnabled())
    {
      v20 = OSLogHandleForIMFoundationCategory();
      if (os_log_type_enabled(v20, OS_LOG_TYPE_INFO))
      {
        LOWORD(v29) = 0;
        _os_log_impl(&dword_19020E000, v20, OS_LOG_TYPE_INFO, "Updating entry view positioning guide to stick to chat footer view", &v29, 2u);
      }
    }

    [(NSLayoutConstraint *)self->_entryViewFauxKeyboardLayoutConstraint setActive:0];
    [(NSLayoutConstraint *)self->_entryViewKeyboardLayoutConstraint setActive:0];
    [(NSLayoutConstraint *)self->_entryViewKeyboardSnapshotLayoutConstraint setActive:0];
    [(NSLayoutConstraint *)self->_entryViewAppCardLayoutConstraint setActive:0];
    entryViewStuckToChatControllerBottomLayoutConstraint7 = [(CKMessageEntryViewContainerView *)self->_entryViewContainerView entryViewStuckToChatControllerBottomLayoutConstraint];
    isActive = [entryViewStuckToChatControllerBottomLayoutConstraint7 isActive];

    if (isActive)
    {
      entryViewStuckToChatControllerBottomLayoutConstraint8 = [(CKMessageEntryViewContainerView *)self->_entryViewContainerView entryViewStuckToChatControllerBottomLayoutConstraint];
      [entryViewStuckToChatControllerBottomLayoutConstraint8 setActive:0];
    }

    isActive2 = [(NSLayoutConstraint *)self->_entryViewChatFooterViewLayoutConstraint isActive];
    [(NSLayoutConstraint *)self->_entryViewChatFooterViewLayoutConstraint setActive:1];
    goto LABEL_60;
  }

  if (_determineEntryViewPositioningGuideToActivate != 3)
  {
    return;
  }

  if (IMOSLoggingEnabled())
  {
    v7 = OSLogHandleForIMFoundationCategory();
    if (os_log_type_enabled(v7, OS_LOG_TYPE_INFO))
    {
      LOWORD(v29) = 0;
      _os_log_impl(&dword_19020E000, v7, OS_LOG_TYPE_INFO, "Updating entry view positioning guide to align to the bottom of the entry view container", &v29, 2u);
    }
  }

  entryViewStuckToChatControllerBottomLayoutConstraint9 = [(CKMessageEntryViewContainerView *)self->_entryViewContainerView entryViewStuckToChatControllerBottomLayoutConstraint];
  isActive3 = [entryViewStuckToChatControllerBottomLayoutConstraint9 isActive];

  if ((isActive3 & 1) == 0)
  {
    entryViewStuckToChatControllerBottomLayoutConstraint10 = [(CKMessageEntryViewContainerView *)self->_entryViewContainerView entryViewStuckToChatControllerBottomLayoutConstraint];
    [entryViewStuckToChatControllerBottomLayoutConstraint10 setActive:1];
  }

  if ([(NSLayoutConstraint *)self->_entryViewKeyboardSnapshotLayoutConstraint isActive])
  {
    [(NSLayoutConstraint *)self->_entryViewKeyboardSnapshotLayoutConstraint setActive:0];
    v11 = 1;
  }

  else
  {
    v11 = isActive3 ^ 1;
  }

  if ([(NSLayoutConstraint *)self->_entryViewAppCardLayoutConstraint isActive])
  {
    [(NSLayoutConstraint *)self->_entryViewAppCardLayoutConstraint setActive:0];
    v11 = 1;
  }

  if ([(NSLayoutConstraint *)self->_entryViewFauxKeyboardLayoutConstraint isActive])
  {
    [(NSLayoutConstraint *)self->_entryViewFauxKeyboardLayoutConstraint setActive:0];
    v11 = 1;
  }

  if ([(NSLayoutConstraint *)self->_entryViewKeyboardLayoutConstraint isActive])
  {
    [(NSLayoutConstraint *)self->_entryViewKeyboardLayoutConstraint setActive:0];
    p_entryViewChatFooterViewLayoutConstraint = &self->_entryViewChatFooterViewLayoutConstraint;
    if (![(NSLayoutConstraint *)self->_entryViewChatFooterViewLayoutConstraint isActive])
    {
      goto LABEL_61;
    }
  }

  else
  {
    p_entryViewChatFooterViewLayoutConstraint = &self->_entryViewChatFooterViewLayoutConstraint;
    if (![(NSLayoutConstraint *)self->_entryViewChatFooterViewLayoutConstraint isActive])
    {
      if (!v11)
      {
        return;
      }

      goto LABEL_61;
    }
  }

  [(NSLayoutConstraint *)*p_entryViewChatFooterViewLayoutConstraint setActive:0];
LABEL_61:
  if (IMOSLoggingEnabled())
  {
    v28 = OSLogHandleForIMFoundationCategory();
    if (os_log_type_enabled(v28, OS_LOG_TYPE_INFO))
    {
      LOWORD(v29) = 0;
      _os_log_impl(&dword_19020E000, v28, OS_LOG_TYPE_INFO, "Active entry view positioning guide did change", &v29, 2u);
    }
  }

  [(CKChatController *)self _layoutEntryViewSuperview];
}

- (int64_t)_determineEntryViewPositioningGuideToActivate
{
  inputController = [(CKCoreChatController *)self inputController];
  isAppCardPresented = [inputController isAppCardPresented];
  isAppCardAppearing = [inputController isAppCardAppearing];
  isAppCardDismissing = [inputController isAppCardDismissing];
  isAppCardUsingSheetPresentation = [inputController isAppCardUsingSheetPresentation];
  isKeyboardVisible = [(CKScrollViewController *)self isKeyboardVisible];
  isKeyboardSnapshotted = [(CKChatController *)self isKeyboardSnapshotted];
  v6 = isKeyboardVisible | [(CKChatController *)self isKeyboardSnapshotVisible];
  traitCollection = [(CKChatController *)self traitCollection];
  verticalSizeClass = [traitCollection verticalSizeClass];

  traitCollection2 = [(CKChatController *)self traitCollection];
  horizontalSizeClass = [traitCollection2 horizontalSizeClass];

  isAppCardUsingPopoverPresentation = [inputController isAppCardUsingPopoverPresentation];
  hasStickerReactionSession = [inputController hasStickerReactionSession];
  isFullScreenBalloonViewOnScreen = [(CKChatController *)self isFullScreenBalloonViewOnScreen];
  chatFooterView = [(CKChatController *)self chatFooterView];
  if (chatFooterView)
  {
    if ((v6 | isAppCardPresented))
    {
      if ([inputController keyboardIsHiding])
      {
        v14 = 4;
      }

      else
      {
        v14 = 0;
      }
    }

    else
    {
      v14 = 4;
    }
  }

  else
  {
    v14 = 0;
  }

  if ((hasStickerReactionSession | isAppCardUsingPopoverPresentation))
  {
    entryViewPositioningGuideForCurrentTapbackPickerPresentation = 3;
  }

  else if (isFullScreenBalloonViewOnScreen)
  {
    entryViewPositioningGuideForCurrentTapbackPickerPresentation = [(CKChatController *)self entryViewPositioningGuideForCurrentTapbackPickerPresentation];
  }

  else if (((horizontalSizeClass != 1 || (isAppCardPresented & isAppCardUsingSheetPresentation & 1) == 0) | (isAppCardAppearing | isAppCardDismissing) & 1 || verticalSizeClass == 1) && ((horizontalSizeClass != 1 || (isAppCardDismissing & isAppCardUsingSheetPresentation & 1) == 0) | v6 & 1 || verticalSizeClass == 1))
  {
    if (isKeyboardSnapshotted)
    {
      v16 = 1;
    }

    else
    {
      v16 = v14;
    }

    if ((horizontalSizeClass != 1 || (isAppCardAppearing & isAppCardUsingSheetPresentation & 1) == 0) | v6 & 1 | (verticalSizeClass == 1))
    {
      entryViewPositioningGuideForCurrentTapbackPickerPresentation = v16;
    }

    else
    {
      entryViewPositioningGuideForCurrentTapbackPickerPresentation = 2;
    }
  }

  else
  {
    entryViewPositioningGuideForCurrentTapbackPickerPresentation = 2;
  }

  return entryViewPositioningGuideForCurrentTapbackPickerPresentation;
}

- (BOOL)isKeyboardSnapshotted
{
  keyboardSnapshotView = [(CKChatController *)self keyboardSnapshotView];
  v3 = keyboardSnapshotView != 0;

  return v3;
}

- (BOOL)isKeyboardSnapshotVisible
{
  keyboardSnapshotView = [(CKChatController *)self keyboardSnapshotView];
  v3 = keyboardSnapshotView;
  if (keyboardSnapshotView)
  {
    window = [keyboardSnapshotView window];
    [v3 frame];
    v6 = v5;
    [window bounds];
    v7 = v6 < CGRectGetMaxY(v9);
  }

  else
  {
    v7 = 0;
  }

  return v7;
}

- (BOOL)isFullScreenBalloonViewOnScreen
{
  inlineReplyController = [(CKChatController *)self inlineReplyController];

  if (inlineReplyController)
  {
    inlineReplyController2 = [(CKChatController *)self inlineReplyController];
    isFullScreenBalloonViewOnScreen = [inlineReplyController2 isFullScreenBalloonViewOnScreen];

    return isFullScreenBalloonViewOnScreen;
  }

  else
  {
    v7.receiver = self;
    v7.super_class = CKChatController;
    return [(CKCoreChatController *)&v7 isFullScreenBalloonViewOnScreen];
  }
}

- (void)_inheritHiddenKeyboardAppearanceIfNeeded
{
  keyboardSnapshotView = [(CKChatController *)self keyboardSnapshotView];
  if (keyboardSnapshotView)
  {
    keyboardSnapshotView2 = [(CKChatController *)self keyboardSnapshotView];
    window = [keyboardSnapshotView2 window];
    v6 = window != 0;
  }

  else
  {
    v6 = 0;
  }

  keyboardSnapshotView3 = [(CKChatController *)self keyboardSnapshotView];
  [keyboardSnapshotView3 alpha];
  v9 = v8;

  if (v6 && v9 > 0.99)
  {
    if (IMOSLoggingEnabled())
    {
      v10 = OSLogHandleForIMFoundationCategory();
      if (os_log_type_enabled(v10, OS_LOG_TYPE_INFO))
      {
        *buf = 0;
        _os_log_impl(&dword_19020E000, v10, OS_LOG_TYPE_INFO, "Keyboard will show while keyboard snapshot is in use. Will hide new keyboard view.", buf, 2u);
      }
    }

    v11[0] = MEMORY[0x1E69E9820];
    v11[1] = 3221225472;
    v11[2] = __60__CKChatController__inheritHiddenKeyboardAppearanceIfNeeded__block_invoke;
    v11[3] = &unk_1E72EBA18;
    v11[4] = self;
    [MEMORY[0x1E69DD250] performWithoutAnimation:v11];
  }
}

- (BOOL)_wantsThreeColumnLayout
{
  v2 = +[CKUIBehavior sharedBehaviors];
  wantsUniversalThreeColumn = [v2 wantsUniversalThreeColumn];

  return wantsUniversalThreeColumn;
}

- (void)registerForTextInputPayloadHandling
{
  inputController = [(CKCoreChatController *)self inputController];
  conversation = [(CKCoreChatController *)self conversation];
  chat = [conversation chat];
  v6 = [chat isFiltered] != 0;
  conversation2 = [(CKCoreChatController *)self conversation];
  chat2 = [conversation2 chat];
  [inputController registerForTextInputPayloadHandling:v6 isGroupChat:{objc_msgSend(chat2, "isGroupChat")}];

  conversation3 = [(CKCoreChatController *)self conversation];
  [(CKChatController *)self registerForTextinputPayloadHandlingForCheckInForConversation:conversation3];
}

- (void)configureMacToolbarProperties
{
  v3 = objc_alloc_init(CKMacToolBarImageProperties);
  [(CKChatController *)self setMacToolbarFaceTimeButtonProps:v3];

  v4 = objc_alloc_init(CKMacToolBarImageProperties);
  [(CKChatController *)self setMacToolbarDetailsButtonProps:v4];

  [(CKChatController *)self _configureMacFaceTimeButtonMenu];
  [(CKChatController *)self _configureFaceTimeStartCallToolbarItem];
  [(CKChatController *)self _configureMacFaceTimeJoinCallToolbarItem];
  [(CKChatController *)self _configureMacFaceTimeJoinedCallToolbarItem];

  [(CKChatController *)self _configureNewComposeToolbarItem];
}

- (void)_configureMacFaceTimeButtonMenu
{
  v53[1] = *MEMORY[0x1E69E9840];
  objc_initWeak(&location, self);
  v3 = MEMORY[0x1E69DC628];
  v4 = CKFrameworkBundle();
  v5 = [v4 localizedStringForKey:@"FACETIME_AUDIO" value:&stru_1F04268F8 table:@"ChatKit"];
  v6 = +[CKUIBehavior sharedBehaviors];
  navBarAudioImage = [v6 navBarAudioImage];
  v46[0] = MEMORY[0x1E69E9820];
  v46[1] = 3221225472;
  v46[2] = __63__CKChatController_MacToolbar___configureMacFaceTimeButtonMenu__block_invoke;
  v46[3] = &unk_1E72EBCD8;
  objc_copyWeak(&v47, &location);
  v38 = [v3 actionWithTitle:v5 image:navBarAudioImage identifier:0 handler:v46];

  v8 = MEMORY[0x1E69DC628];
  v9 = CKFrameworkBundle();
  v10 = [v9 localizedStringForKey:@"FACETIME_VIDEO" value:&stru_1F04268F8 table:@"ChatKit"];
  v11 = +[CKUIBehavior sharedBehaviors];
  navBarVideoImage = [v11 navBarVideoImage];
  v44[0] = MEMORY[0x1E69E9820];
  v44[1] = 3221225472;
  v44[2] = __63__CKChatController_MacToolbar___configureMacFaceTimeButtonMenu__block_invoke_2;
  v44[3] = &unk_1E72EBCD8;
  objc_copyWeak(&v45, &location);
  v39 = [v8 actionWithTitle:v10 image:navBarVideoImage identifier:0 handler:v44];

  v13 = MEMORY[0x1E69DC628];
  v14 = CKFrameworkBundle();
  v15 = [v14 localizedStringForKey:@"INVITE_TO_SHARE_MY_SCREEN" value:&stru_1F04268F8 table:@"ChatKit"];
  v42[0] = MEMORY[0x1E69E9820];
  v42[1] = 3221225472;
  v42[2] = __63__CKChatController_MacToolbar___configureMacFaceTimeButtonMenu__block_invoke_3;
  v42[3] = &unk_1E72EBCD8;
  objc_copyWeak(&v43, &location);
  v36 = [v13 actionWithTitle:v15 image:0 identifier:0 handler:v42];

  v16 = MEMORY[0x1E69DC628];
  v17 = CKFrameworkBundle();
  v18 = [v17 localizedStringForKey:@"ASK_TO_SHARE_THEIR_SCREEN" value:&stru_1F04268F8 table:@"ChatKit"];
  v40[0] = MEMORY[0x1E69E9820];
  v40[1] = 3221225472;
  v40[2] = __63__CKChatController_MacToolbar___configureMacFaceTimeButtonMenu__block_invoke_4;
  v40[3] = &unk_1E72EBCD8;
  objc_copyWeak(&v41, &location);
  v19 = [v16 actionWithTitle:v18 image:0 identifier:0 handler:v40];

  if (IMDeviceIsGreenTea())
  {
    conversation = [(CKCoreChatController *)self conversation];
    isGroupConversation = [conversation isGroupConversation];

    if (isGroupConversation)
    {
      v22 = MEMORY[0x1E695E0F0];
    }

    else
    {
      v53[0] = v39;
      v22 = [MEMORY[0x1E695DEC8] arrayWithObjects:v53 count:1];
    }
  }

  else
  {
    v23 = MEMORY[0x1E69DCC60];
    v52[0] = v38;
    v52[1] = v39;
    v24 = [MEMORY[0x1E695DEC8] arrayWithObjects:v52 count:2];
    v25 = [v23 menuWithTitle:&stru_1F04268F8 image:0 identifier:0 options:1 children:v24];

    v26 = MEMORY[0x1E69DCC60];
    v51[0] = v36;
    v51[1] = v19;
    v27 = [MEMORY[0x1E695DEC8] arrayWithObjects:v51 count:2];
    v28 = [v26 menuWithTitle:&stru_1F04268F8 image:0 identifier:0 options:1 children:v27];

    detailsContactsManager = [(CKChatController *)self detailsContactsManager];
    conversation2 = [(CKCoreChatController *)self conversation];
    recipient = [conversation2 recipient];
    v32 = [detailsContactsManager showScreenSharingButtonForEntity:recipient];

    if (v32)
    {
      v50[0] = v25;
      v50[1] = v28;
      v33 = v50;
      v34 = 2;
    }

    else
    {
      v49 = v25;
      v33 = &v49;
      v34 = 1;
    }

    v22 = [MEMORY[0x1E695DEC8] arrayWithObjects:v33 count:{v34, v36}];
  }

  v35 = [MEMORY[0x1E69DCC60] menuWithChildren:{v22, v36}];
  [(CKChatController *)self setMacFaceTimeButtonMenu:v35];

  objc_destroyWeak(&v41);
  objc_destroyWeak(&v43);

  objc_destroyWeak(&v45);
  objc_destroyWeak(&v47);
  objc_destroyWeak(&location);
}

void __63__CKChatController_MacToolbar___configureMacFaceTimeButtonMenu__block_invoke(uint64_t a1)
{
  WeakRetained = objc_loadWeakRetained((a1 + 32));
  v1 = [WeakRetained conversation];
  v2 = [v1 chat];
  [v2 initiateTUConversationWithVideoEnabled:0];
}

void __63__CKChatController_MacToolbar___configureMacFaceTimeButtonMenu__block_invoke_2(uint64_t a1)
{
  IsGreenTea = IMDeviceIsGreenTea();
  WeakRetained = objc_loadWeakRetained((a1 + 32));
  v3 = [WeakRetained conversation];
  v4 = [v3 chat];
  v5 = v4;
  if (IsGreenTea)
  {
    [v4 initiateTUDialRequestWithVideoEnabled:1];
  }

  else
  {
    [v4 initiateTUConversationWithVideoEnabled:1];
  }
}

void __63__CKChatController_MacToolbar___configureMacFaceTimeButtonMenu__block_invoke_3(uint64_t a1)
{
  WeakRetained = objc_loadWeakRetained((a1 + 32));
  v2 = [WeakRetained detailsContactsManager];
  v3 = objc_loadWeakRetained((a1 + 32));
  v4 = [v3 conversation];
  v5 = [v4 recipient];
  [v2 shareMyScreenWithEntity:v5];
}

void __63__CKChatController_MacToolbar___configureMacFaceTimeButtonMenu__block_invoke_4(uint64_t a1)
{
  WeakRetained = objc_loadWeakRetained((a1 + 32));
  v2 = [WeakRetained detailsContactsManager];
  v3 = objc_loadWeakRetained((a1 + 32));
  v4 = [v3 conversation];
  v5 = [v4 recipient];
  [v2 inviteEntityToShareTheirScreen:v5];
}

- (BOOL)shouldUseMacConversationAvatarTitleView
{
  v2 = +[CKUIBehavior sharedBehaviors];
  useMacToolbar = [v2 useMacToolbar];

  return useMacToolbar;
}

- (id)innermostToolbarItemIdentifier
{
  v3 = @"CKMacToolbarChatDetailsItemIdentifier";
  if ([(CKChatController *)self _macShouldShowFaceTimeButtonInToolbar])
  {
    _canStartCall = [(CKChatController *)self _canStartCall];
    _hasJoinableCall = [(CKChatController *)self _hasJoinableCall];
    _hasJoinedCall = [(CKChatController *)self _hasJoinedCall];
    v7 = @"CKMacToolbarFacetimeJoinedCallItemIdentifier";
    if (!_hasJoinedCall)
    {
      v7 = @"CKMacToolbarChatDetailsItemIdentifier";
    }

    if (_hasJoinableCall)
    {
      v7 = @"CKMacToolbarFacetimeJoinCallItemIdentifier";
    }

    if (_canStartCall)
    {
      return @"CKMacToolbarFacetimeStartCallItemIdentifier";
    }

    else
    {
      return v7;
    }
  }

  return v3;
}

- (void)macRecipientsControllerDidUpdateToFieldSizing:(id)sizing
{
  sizingCopy = sizing;
  macRecipientsController = [(CKChatController *)self macRecipientsController];

  if (macRecipientsController == sizingCopy)
  {
    v6 = +[CKUIBehavior sharedBehaviors];
    useMacToolbar = [v6 useMacToolbar];

    if (useMacToolbar)
    {
      view = [(CKChatController *)self view];
      window = [view window];
      [window frame];
      v11 = v10;
      v13 = v12;
      v15 = v14;
      v17 = v16;

      macToolbarController = [(CKCoreChatController *)self macToolbarController];
      [macToolbarController updateWithFrame:{v11, v13, v15, v17}];
    }
  }
}

- (void)refreshMacToolbar
{
  macToolbarController = [(CKCoreChatController *)self macToolbarController];
  [macToolbarController reloadToolbarItems];

  macToolbarController2 = [(CKCoreChatController *)self macToolbarController];
  [macToolbarController2 updateVirtualViewForProvider:self];
}

- (id)_newImageConfiguredForNSToolbarWithName:(id)name tintColor:(id)color
{
  colorCopy = color;
  nameCopy = name;
  v8 = +[CKUIBehavior sharedBehaviors];
  macToolbarSymbolConfiguration = [v8 macToolbarSymbolConfiguration];

  v10 = objc_alloc_init(MEMORY[0x1E69DCA80]);
  traitCollection = [(CKChatController *)self traitCollection];
  [traitCollection displayScale];
  [v10 setScale:?];

  v12 = [MEMORY[0x1E69DCAB8] systemImageNamed:nameCopy withConfiguration:macToolbarSymbolConfiguration];

  v13 = objc_alloc(MEMORY[0x1E69DCA78]);
  [v12 size];
  v14 = [v13 initWithSize:v10 format:?];
  v21[0] = MEMORY[0x1E69E9820];
  v21[1] = 3221225472;
  v21[2] = __82__CKChatController_MacToolbar___newImageConfiguredForNSToolbarWithName_tintColor___block_invoke;
  v21[3] = &unk_1E72EBBE8;
  v22 = v12;
  v15 = [v14 imageWithActions:v21];
  v16 = [v15 imageWithRenderingMode:2];

  if (colorCopy)
  {
    v18[0] = MEMORY[0x1E69E9820];
    v18[1] = 3221225472;
    v18[2] = __82__CKChatController_MacToolbar___newImageConfiguredForNSToolbarWithName_tintColor___block_invoke_2;
    v18[3] = &unk_1E72EBD00;
    v19 = v16;
    v20 = colorCopy;
    v16 = [v14 imageWithActions:v18];
  }

  return v16;
}

void __82__CKChatController_MacToolbar___newImageConfiguredForNSToolbarWithName_tintColor___block_invoke_2(uint64_t a1)
{
  v1 = [*(a1 + 32) imageWithTintColor:*(a1 + 40)];
  [v1 drawAtPoint:{*MEMORY[0x1E695EFF8], *(MEMORY[0x1E695EFF8] + 8)}];
}

- (id)_updatedFaceTimeToolbarItemImage
{
  macToolbarFaceTimeButtonProps = [(CKChatController *)self macToolbarFaceTimeButtonProps];
  image = [macToolbarFaceTimeButtonProps image];
  macJoinStyle = [(CKChatController *)self macJoinStyle];
  if (macJoinStyle <= 3)
  {
    if (macJoinStyle == 1)
    {
      v6 = +[CKUIBehavior sharedBehaviors];
      macToolbarJoinableFaceTimeAudioImageName = [v6 macToolbarJoinableFaceTimeAudioImageName];
      goto LABEL_10;
    }

    if (macJoinStyle == 3)
    {
      v6 = +[CKUIBehavior sharedBehaviors];
      macToolbarJoinableFaceTimeAudioImageName = [v6 macToolbarJoinableFaceTimeVideoImageName];
LABEL_10:
      v10 = macToolbarJoinableFaceTimeAudioImageName;
      v8 = 0;
      goto LABEL_13;
    }

LABEL_8:
    v6 = +[CKUIBehavior sharedBehaviors];
    macToolbarJoinableFaceTimeAudioImageName = [v6 macToolbarFaceTimeImageName];
    goto LABEL_10;
  }

  if (macJoinStyle == 4)
  {
    v8 = [MEMORY[0x1E69DC888] ckColorNamed:@"CKSystemGreenColor"];
    v6 = +[CKUIBehavior sharedBehaviors];
    macToolbarJoinedFaceTimeAudioImageName = [v6 macToolbarJoinedFaceTimeAudioImageName];
  }

  else
  {
    if (macJoinStyle != 6)
    {
      goto LABEL_8;
    }

    v8 = [MEMORY[0x1E69DC888] ckColorNamed:@"CKSystemGreenColor"];
    v6 = +[CKUIBehavior sharedBehaviors];
    macToolbarJoinedFaceTimeAudioImageName = [v6 macToolbarJoinedFaceTimeVideoImageName];
  }

  v10 = macToolbarJoinedFaceTimeAudioImageName;
LABEL_13:

  if (!image)
  {
LABEL_20:
    v18 = [(CKChatController *)self _newImageConfiguredForNSToolbarWithName:v10 tintColor:v8];

    [macToolbarFaceTimeButtonProps setTintColor:v8];
    [macToolbarFaceTimeButtonProps setImage:v18];
    image = v18;
    goto LABEL_21;
  }

  tintColor = [macToolbarFaceTimeButtonProps tintColor];
  if (![tintColor isEqual:v8])
  {
LABEL_19:

    goto LABEL_20;
  }

  imageName = [macToolbarFaceTimeButtonProps imageName];
  if (([imageName isEqualToString:v10] & 1) == 0)
  {

    goto LABEL_19;
  }

  traitCollection = [(CKChatController *)self traitCollection];
  [traitCollection displayScale];
  v15 = v14;
  [image scale];
  v17 = v16;

  if (v15 != v17)
  {
    goto LABEL_20;
  }

LABEL_21:

  return image;
}

- (void)configureWithToolbarController:(id)controller
{
  controllerCopy = controller;
  conversation = [(CKCoreChatController *)self conversation];
  [conversation isBusinessConversation];

  if ([(CKChatController *)self shouldUseMacRecipientsView])
  {
    v8 = [CKMacRecipientsController alloc];
    conversation2 = [(CKCoreChatController *)self conversation];
    v10 = [(CKMacRecipientsController *)v8 initWithConversation:conversation2];
    [(CKChatController *)self setMacRecipientsController:v10];

    macRecipientsController = [(CKChatController *)self macRecipientsController];
    [macRecipientsController setDelegate:self];
  }

  v18.receiver = self;
  v18.super_class = CKChatController;
  [(CKCoreChatController *)&v18 configureWithToolbarController:controllerCopy];
  conversation3 = [(CKCoreChatController *)self conversation];
  chat = [conversation3 chat];
  allowedByScreenTime = [chat allowedByScreenTime];
  if (allowedByScreenTime)
  {
    v15 = 1;
  }

  else
  {
    conversation4 = [(CKCoreChatController *)self conversation];
    chat2 = [conversation4 chat];
    v15 = chat2 == 0;
  }

  macToolbarController = [(CKCoreChatController *)self macToolbarController];
  [macToolbarController setShouldDrawSecondaryBlur:v15];

  if ((allowedByScreenTime & 1) == 0)
  {
  }

  macToolbarController2 = [(CKCoreChatController *)self macToolbarController];
  [macToolbarController2 updateVirtualViewForProvider:self];
}

- (void)providerWillBeRemovedFromToolbarController:(id)controller
{
  recipientsVirtualToolbarItem = [(CKChatController *)self recipientsVirtualToolbarItem];

  if (recipientsVirtualToolbarItem)
  {
    recipientsVirtualToolbarItem2 = [(CKChatController *)self recipientsVirtualToolbarItem];
    [recipientsVirtualToolbarItem2 removeFromSuperview];
  }
}

- (BOOL)_macShouldShowFaceTimeButtonInToolbar
{
  conversation = [(CKCoreChatController *)self conversation];
  chat = [conversation chat];
  v5 = [chat supportsCapabilities:1024];

  if (!v5)
  {
    return 0;
  }

  conversation2 = [(CKCoreChatController *)self conversation];
  isGroupConversation = [conversation2 isGroupConversation];

  if (isGroupConversation)
  {
    if (IMDeviceIsGreenTea())
    {
      return 0;
    }
  }

  else
  {
    conversation3 = [(CKCoreChatController *)self conversation];
    chat2 = [conversation3 chat];
    isSMS = [chat2 isSMS];

    if (isSMS)
    {
      return 0;
    }
  }

  conversation4 = [(CKCoreChatController *)self conversation];
  if ([conversation4 isBusinessConversation])
  {
    v8 = 0;
  }

  else
  {
    conversation5 = [(CKCoreChatController *)self conversation];
    v8 = [CKFaceTimeUtilities isFaceTimeVideoAvailable:conversation5];
  }

  return v8;
}

- (void)composeButtonClicked:(id)clicked
{
  clickedCopy = clicked;
  delegate = [(CKCoreChatController *)self delegate];
  v5 = objc_opt_respondsToSelector();

  if (v5)
  {
    delegate2 = [(CKCoreChatController *)self delegate];
    [delegate2 chatController:self didRequestNewComposePresentationWithSender:clickedCopy];
  }
}

- (UIEdgeInsets)virtualToolbarContentInsets
{
  v2 = *MEMORY[0x1E69DDCE0];
  v3 = *(MEMORY[0x1E69DDCE0] + 8);
  v4 = *(MEMORY[0x1E69DDCE0] + 16);
  v5 = *(MEMORY[0x1E69DDCE0] + 24);
  result.right = v5;
  result.bottom = v4;
  result.left = v3;
  result.top = v2;
  return result;
}

- (id)virtualView
{
  if (([MEMORY[0x1E69A5B68] isContactLimitsFeatureEnabled] & 1) == 0)
  {
    [(CKChatController *)self effectPickerIsPresented];
LABEL_6:
    macToolbarController = [(CKCoreChatController *)self macToolbarController];
    [macToolbarController setShouldDrawSecondaryBlur:0];

    goto LABEL_7;
  }

  if ([MEMORY[0x1E69A5B68] isContactLimitsFeatureEnabled])
  {
    conversation = [(CKCoreChatController *)self conversation];
    chat = [conversation chat];
    if (chat)
    {
      conversation2 = [(CKCoreChatController *)self conversation];
      chat2 = [conversation2 chat];
      v7 = [chat2 allowedByScreenTime] ^ 1;
    }

    else
    {
      v7 = 0;
    }
  }

  else
  {
    v7 = 0;
  }

  if ([(CKChatController *)self effectPickerIsPresented]|| v7)
  {
    goto LABEL_6;
  }

  if (![(CKChatController *)self _shouldUseBusinessToolbarAsVirtualView])
  {
    if ([(CKChatController *)self shouldUseMacRecipientsView])
    {
      recipientsVirtualToolbarItem = [(CKChatController *)self recipientsVirtualToolbarItem];
      goto LABEL_20;
    }

    [(CKChatController *)self shouldUseMacConversationAvatarTitleView];
LABEL_7:
    recipientsVirtualToolbarItem = 0;
    goto LABEL_8;
  }

  businessMacToolbarController = [(CKChatController *)self businessMacToolbarController];
  recipientsVirtualToolbarItem = [businessMacToolbarController view];

LABEL_20:
  macToolbarController2 = [(CKCoreChatController *)self macToolbarController];
  [macToolbarController2 setShouldDrawSecondaryBlur:1];

LABEL_8:

  return recipientsVirtualToolbarItem;
}

- (BOOL)prefersBottomDividerHidden
{
  [(CKChatController *)self preferredMacToolbarHeight];
  v4 = v3;
  v5 = +[CKUIBehavior sharedBehaviors];
  [v5 macAppKitToolbarHeight];
  v7 = v6;

  result = [(CKChatController *)self effectPickerIsPresented];
  if (v4 > v7)
  {
    return 1;
  }

  return result;
}

- (BOOL)_hasJoinableCall
{
  if ([(CKChatController *)self currentCallMode]== 3)
  {
    LOBYTE(currentCallMode) = 1;
  }

  else
  {
    currentCallMode = [(CKChatController *)self currentCallMode];
    if (currentCallMode != 1)
    {
      LOBYTE(currentCallMode) = [(CKChatController *)self currentCallMode]== 5;
    }
  }

  return currentCallMode;
}

- (id)transcriptCollectionViewController:(id)controller contextMenuConfigurationForItemAtIndexPath:(id)path point:(CGPoint)point interaction:(id)interaction
{
  y = point.y;
  x = point.x;
  v114 = *MEMORY[0x1E69E9840];
  controllerCopy = controller;
  pathCopy = path;
  interactionCopy = interaction;
  if ([(CKChatController *)self _clickyOrbEnabled])
  {
    if (CKIsRunningInMacCatalyst() && [(CKChatController *)self contextMenuInteractionIsOutsideOfVisibleBalloonCells:interactionCopy])
    {
      if (IMOSLoggingEnabled())
      {
        v13 = OSLogHandleForIMFoundationCategory();
        if (os_log_type_enabled(v13, OS_LOG_TYPE_INFO))
        {
          *buf = 0;
          _os_log_impl(&dword_19020E000, v13, OS_LOG_TYPE_INFO, "clicky orb: enabled - context menu interaction is outside of visible balloonCell", buf, 2u);
        }
      }

      contextMenuInteractionOutsideOfVisibleBalloonCells = [(CKChatController *)self contextMenuInteractionOutsideOfVisibleBalloonCells];
      goto LABEL_80;
    }

    v91 = [(CKChatController *)self _parentChatItemForIndexPath:pathCopy];
    v16 = [(CKCoreChatController *)self indexPathOfParentChatItemForIndexPath:pathCopy];
    v17 = [(CKChatController *)self _balloonViewForCellAtIndexPath:v16];
    if (IMOSLoggingEnabled())
    {
      v18 = OSLogHandleForIMFoundationCategory();
      if (os_log_type_enabled(v18, OS_LOG_TYPE_INFO))
      {
        iMChatItem = [v91 IMChatItem];
        guid = [iMChatItem guid];
        iMChatItem2 = [v91 IMChatItem];
        guid2 = [iMChatItem2 guid];
        *buf = 138413058;
        v105 = guid;
        v106 = 2112;
        v107 = guid2;
        v108 = 2112;
        v109 = v16;
        v110 = 2112;
        v111 = v17;
        _os_log_impl(&dword_19020E000, v18, OS_LOG_TYPE_INFO, "clicky orb: initial values of chatItem.guid: %@, parentChatItem.guid: %@, parentIndexPath: %@, parentBalloonView: %@", buf, 0x2Au);
      }
    }

    if (!CKIsRunningInMacCatalyst())
    {
      objc_opt_class();
      if ((objc_opt_isKindOfClass() & (v17 != 0)) == 1)
      {
        objc_opt_class();
        if (objc_opt_isKindOfClass())
        {
          if (IMOSLoggingEnabled())
          {
            v23 = OSLogHandleForIMFoundationCategory();
            if (os_log_type_enabled(v23, OS_LOG_TYPE_INFO))
            {
              *buf = 0;
              _os_log_impl(&dword_19020E000, v23, OS_LOG_TYPE_INFO, "clicky orb: disabled because no context menu for the moment share placeholder item", buf, 2u);
            }
          }

          contextMenuInteractionOutsideOfVisibleBalloonCells = 0;
          v24 = v91;
          goto LABEL_79;
        }
      }
    }

    v90 = controllerCopy;
    mEMORY[0x1E69A8070] = [MEMORY[0x1E69A8070] sharedFeatureFlags];
    isStickerRepositioningEnabled = [mEMORY[0x1E69A8070] isStickerRepositioningEnabled];

    if (isStickerRepositioningEnabled && [v90 pointIntersectsRepositionEnabledSticker:v91 chatItem:{x, y}])
    {
      if (IMOSLoggingEnabled())
      {
        v27 = OSLogHandleForIMFoundationCategory();
        if (os_log_type_enabled(v27, OS_LOG_TYPE_INFO))
        {
          *buf = 0;
          _os_log_impl(&dword_19020E000, v27, OS_LOG_TYPE_INFO, "clicky orb: disabled because touch intersects a repositionable sticker", buf, 2u);
        }
      }
    }

    else if (CKIsRunningInMacCatalyst() || ([v90 selectionManager], v73 = objc_claimAutoreleasedReturnValue(), v74 = objc_msgSend(v73, "selectedGuidCount") == 0, v73, v74) || (objc_msgSend(v91, "IMChatItem"), v75 = objc_claimAutoreleasedReturnValue(), objc_msgSend(v75, "guid"), v76 = objc_claimAutoreleasedReturnValue(), v75, objc_msgSend(v90, "selectionManager"), v77 = objc_claimAutoreleasedReturnValue(), LOBYTE(v75) = objc_msgSend(v77, "isMessageGuidSelected:", v76), v77, v76, (v75 & 1) == 0))
    {
      currentAssetChatItem = v91;
      if (!CKIsRunningInMacCatalyst())
      {
        objc_opt_class();
        currentAssetChatItem = v91;
        if ((objc_opt_isKindOfClass() & (v17 != 0)) == 1)
        {
          objc_opt_class();
          currentAssetChatItem = v91;
          if (objc_opt_isKindOfClass())
          {
            v29 = v17;
            currentAssetChatItem = [v29 currentAssetChatItem];

            if (IMOSLoggingEnabled())
            {
              v30 = OSLogHandleForIMFoundationCategory();
              if (os_log_type_enabled(v30, OS_LOG_TYPE_INFO))
              {
                *buf = 138412290;
                v105 = currentAssetChatItem;
                _os_log_impl(&dword_19020E000, v30, OS_LOG_TYPE_INFO, "clicky orb: found photo stack. updating target chatItem to chatItem: %@", buf, 0xCu);
              }
            }
          }
        }
      }

      objc_opt_class();
      if ((objc_opt_isKindOfClass() & 1) == 0 || (-[CKChatController collectionView](self, "collectionView"), v31 = objc_claimAutoreleasedReturnValue(), [v17 frame], v33 = v32, v35 = v34, v37 = v36, v39 = v38, objc_msgSend(v17, "superview"), v40 = objc_claimAutoreleasedReturnValue(), objc_msgSend(v31, "convertRect:fromView:", v40, v33, v35, v37, v39), v42 = v41, v44 = v43, v46 = v45, v48 = v47, v40, v31, v118.origin.x = v42, v118.origin.y = v44, v118.size.width = v46, v118.size.height = v48, v116.x = x, v116.y = y, CGRectContainsPoint(v118, v116)) || objc_msgSend(pathCopy, "row") < 1)
      {
        v68 = v17;
        v67 = v16;
        v24 = currentAssetChatItem;
      }

      else
      {
        v89 = [MEMORY[0x1E696AC88] indexPathForRow:objc_msgSend(pathCopy inSection:{"row") - 1, objc_msgSend(pathCopy, "section")}];
        v87 = [(CKChatController *)self _parentChatItemForIndexPath:v89];
        v88 = [(CKCoreChatController *)self indexPathOfParentChatItemForIndexPath:v89];
        v86 = [(CKChatController *)self _balloonViewForCellAtIndexPath:v88];
        objc_opt_class();
        if ((objc_opt_isKindOfClass() & 1) != 0 && (-[CKChatController collectionView](self, "collectionView"), v49 = objc_claimAutoreleasedReturnValue(), [v86 frame], v51 = v50, v53 = v52, v55 = v54, v57 = v56, objc_msgSend(v86, "superview"), v58 = objc_claimAutoreleasedReturnValue(), objc_msgSend(v49, "convertRect:fromView:", v58, v51, v53, v55, v57), v60 = v59, v62 = v61, v64 = v63, v66 = v65, v58, v49, v119.origin.x = v60, v119.origin.y = v62, v119.size.width = v64, v119.size.height = v66, v117.x = x, v117.y = y, CGRectContainsPoint(v119, v117)))
        {
          v24 = v87;

          v67 = v88;
          v68 = v86;

          if (IMOSLoggingEnabled())
          {
            v69 = OSLogHandleForIMFoundationCategory();
            if (os_log_type_enabled(v69, OS_LOG_TYPE_INFO))
            {
              *buf = 138412290;
              v105 = v24;
              _os_log_impl(&dword_19020E000, v69, OS_LOG_TYPE_INFO, "clicky orb: found orangic layout. updating target chatItem to chatItem: %@", buf, 0xCu);
            }
          }
        }

        else
        {
          v68 = v17;
          v67 = v16;
          v24 = currentAssetChatItem;
        }
      }

      if (v24)
      {
        isReplyContextPreview = [v24 isReplyContextPreview];
        v71 = IMOSLoggingEnabled();
        if (!isReplyContextPreview)
        {
          if (v71)
          {
            v79 = OSLogHandleForIMFoundationCategory();
            if (os_log_type_enabled(v79, OS_LOG_TYPE_INFO))
            {
              *buf = 0;
              _os_log_impl(&dword_19020E000, v79, OS_LOG_TYPE_INFO, "clicky orb: enabled", buf, 2u);
            }
          }

          if (!CKIsRunningInMacCatalyst() && [interactionCopy menuAppearance] == 1)
          {
            [v68 setIsBeingShownAsPreview:1];
          }

          [(CKChatController *)self setClickyOrbChatItem:v24];
          entryView = [(CKChatController *)self entryView];
          contentView = [entryView contentView];
          -[CKChatController setEntryViewWasActiveOnContextMenuPresentation:](self, "setEntryViewWasActiveOnContextMenuPresentation:", [contentView isActive]);

          [(CKChatController *)self hideAssociatedCellsForChatItem:v91];
          objc_initWeak(&location, self);
          v82 = MEMORY[0x1E69DC8D8];
          v98[0] = MEMORY[0x1E69E9820];
          v98[1] = 3221225472;
          v98[2] = __138__CKChatController_ClickyOrbConformance__transcriptCollectionViewController_contextMenuConfigurationForItemAtIndexPath_point_interaction___block_invoke;
          v98[3] = &unk_1E72EBEA8;
          v83 = v24;
          v99 = v83;
          objc_copyWeak(&v102, &location);
          v17 = v68;
          v100 = v17;
          v16 = v67;
          v101 = v16;
          v93[0] = MEMORY[0x1E69E9820];
          v93[1] = 3221225472;
          v93[2] = __138__CKChatController_ClickyOrbConformance__transcriptCollectionViewController_contextMenuConfigurationForItemAtIndexPath_point_interaction___block_invoke_221;
          v93[3] = &unk_1E72EBED0;
          objc_copyWeak(&v97, &location);
          v24 = v83;
          v94 = v24;
          v95 = v91;
          v96 = interactionCopy;
          contextMenuInteractionOutsideOfVisibleBalloonCells = [v82 configurationWithIdentifier:pathCopy previewProvider:v98 actionProvider:v93];
          if (IMOSLoggingEnabled())
          {
            v84 = OSLogHandleForIMFoundationCategory();
            if (os_log_type_enabled(v84, OS_LOG_TYPE_INFO))
            {
              *buf = 138413314;
              v105 = contextMenuInteractionOutsideOfVisibleBalloonCells;
              v106 = 2112;
              v107 = v24;
              v108 = 2112;
              v109 = pathCopy;
              v110 = 2112;
              v111 = v16;
              v112 = 2112;
              v113 = v17;
              _os_log_impl(&dword_19020E000, v84, OS_LOG_TYPE_INFO, "clicky orb: configuration:%@ made from chatItem:%@, at indexPath:%@, with parentIndexPath:%@, parentBalloonView:%@", buf, 0x34u);
            }
          }

          objc_destroyWeak(&v97);
          objc_destroyWeak(&v102);

          objc_destroyWeak(&location);
          goto LABEL_78;
        }

        if (v71)
        {
          v72 = OSLogHandleForIMFoundationCategory();
          if (os_log_type_enabled(v72, OS_LOG_TYPE_INFO))
          {
            *buf = 0;
            _os_log_impl(&dword_19020E000, v72, OS_LOG_TYPE_INFO, "clicky orb: disabled because chatItem isReplyContextPreview=YES", buf, 2u);
          }
        }
      }

      else
      {
        if (IMOSLoggingEnabled())
        {
          v78 = OSLogHandleForIMFoundationCategory();
          if (os_log_type_enabled(v78, OS_LOG_TYPE_INFO))
          {
            *buf = 138412290;
            v105 = pathCopy;
            _os_log_impl(&dword_19020E000, v78, OS_LOG_TYPE_INFO, "clicky orb: disabled because nil chatItem from indexPath: %@", buf, 0xCu);
          }
        }

        v24 = 0;
      }

      contextMenuInteractionOutsideOfVisibleBalloonCells = 0;
      v17 = v68;
      v16 = v67;
LABEL_78:

LABEL_79:
      goto LABEL_80;
    }

    contextMenuInteractionOutsideOfVisibleBalloonCells = 0;
    v24 = v91;
    goto LABEL_78;
  }

  if (IMOSLoggingEnabled())
  {
    v15 = OSLogHandleForIMFoundationCategory();
    if (os_log_type_enabled(v15, OS_LOG_TYPE_INFO))
    {
      *buf = 0;
      _os_log_impl(&dword_19020E000, v15, OS_LOG_TYPE_INFO, "clicky orb: disabled. Returning nil configuration", buf, 2u);
    }
  }

  contextMenuInteractionOutsideOfVisibleBalloonCells = 0;
LABEL_80:

  return contextMenuInteractionOutsideOfVisibleBalloonCells;
}

id __138__CKChatController_ClickyOrbConformance__transcriptCollectionViewController_contextMenuConfigurationForItemAtIndexPath_point_interaction___block_invoke(uint64_t a1)
{
  v9 = *MEMORY[0x1E69E9840];
  objc_opt_class();
  if (objc_opt_isKindOfClass())
  {
    v2 = [*(a1 + 32) mediaObject];
    objc_opt_class();
    if (objc_opt_isKindOfClass() & 1) != 0 && ([v2 needsAnimation])
    {

      v3 = 0;
      goto LABEL_10;
    }
  }

  WeakRetained = objc_loadWeakRetained((a1 + 56));
  v3 = [WeakRetained _previewingViewControllerForHitView:*(a1 + 40) indexPath:*(a1 + 48)];

  if (IMOSLoggingEnabled())
  {
    v5 = OSLogHandleForIMFoundationCategory();
    if (os_log_type_enabled(v5, OS_LOG_TYPE_INFO))
    {
      v7 = 138412290;
      v8 = v3;
      _os_log_impl(&dword_19020E000, v5, OS_LOG_TYPE_INFO, "clicky orb: providing previewingViewController: %@", &v7, 0xCu);
    }
  }

LABEL_10:

  return v3;
}

id __138__CKChatController_ClickyOrbConformance__transcriptCollectionViewController_contextMenuConfigurationForItemAtIndexPath_point_interaction___block_invoke_221(uint64_t a1)
{
  WeakRetained = objc_loadWeakRetained((a1 + 56));
  v3 = [WeakRetained _menuForChatItem:*(a1 + 32) withParentChatItem:*(a1 + 40) menuAppearance:{objc_msgSend(*(a1 + 48), "menuAppearance")}];

  return v3;
}

- (void)transcriptCollectionViewController:(id)controller willPerformPreviewActionForMenuWithConfiguration:(id)configuration animator:(id)animator
{
  v34 = *MEMORY[0x1E69E9840];
  controllerCopy = controller;
  configurationCopy = configuration;
  animatorCopy = animator;
  previewViewController = [animatorCopy previewViewController];
  identifier = [configurationCopy identifier];
  objc_opt_class();
  isKindOfClass = objc_opt_isKindOfClass();

  if (isKindOfClass)
  {
    identifier2 = [configurationCopy identifier];
    v15 = [(CKCoreChatController *)self indexPathOfParentChatItemForIndexPath:identifier2];
    v16 = [(CKChatController *)self _balloonViewForCellAtIndexPath:v15];
    v25 = [(CKChatController *)self _chatItemForContextMenuWithConfiguration:configurationCopy];
  }

  else
  {
    v25 = 0;
    v16 = 0;
    v15 = 0;
  }

  if (IMOSLoggingEnabled())
  {
    v17 = OSLogHandleForIMFoundationCategory();
    if (os_log_type_enabled(v17, OS_LOG_TYPE_INFO))
    {
      v22 = controllerCopy;
      iMChatItem = [v25 IMChatItem];
      guid = [iMChatItem guid];
      clickyOrbChatItem = [(CKChatController *)self clickyOrbChatItem];
      iMChatItem2 = [clickyOrbChatItem IMChatItem];
      guid2 = [iMChatItem2 guid];
      *buf = 138412546;
      v31 = guid;
      v32 = 2112;
      v33 = guid2;
      _os_log_impl(&dword_19020E000, v17, OS_LOG_TYPE_INFO, " willPerformPreviewActionForMenuWithConfiguration chatItem: %@, self.clickyOrb:%@", buf, 0x16u);

      controllerCopy = v22;
    }
  }

  if (!previewViewController && v16 && v15)
  {
    previewViewController = [(CKChatController *)self _previewingViewControllerForHitView:v16 indexPath:v15];
  }

  if (previewViewController)
  {
    mEMORY[0x1E69A8168] = [MEMORY[0x1E69A8168] sharedInstance];
    [mEMORY[0x1E69A8168] trackEvent:*MEMORY[0x1E69A7588]];

    [animatorCopy setPreferredCommitStyle:1];
    v26[0] = MEMORY[0x1E69E9820];
    v26[1] = 3221225472;
    v26[2] = __135__CKChatController_ClickyOrbConformance__transcriptCollectionViewController_willPerformPreviewActionForMenuWithConfiguration_animator___block_invoke;
    v26[3] = &unk_1E72EBEF8;
    v26[4] = self;
    v27 = previewViewController;
    v28 = v15;
    v29 = v25;
    [animatorCopy addCompletion:v26];
  }
}

void __135__CKChatController_ClickyOrbConformance__transcriptCollectionViewController_willPerformPreviewActionForMenuWithConfiguration_animator___block_invoke(uint64_t a1)
{
  [*(a1 + 32) setIsShowingPreview:1];
  if (IMOSLoggingEnabled())
  {
    v2 = OSLogHandleForIMFoundationCategory();
    if (os_log_type_enabled(v2, OS_LOG_TYPE_INFO))
    {
      *buf = 0;
      _os_log_impl(&dword_19020E000, v2, OS_LOG_TYPE_INFO, "willPerformPreviewActionForMenuWithConfiguration: Setting showing preview to YES", buf, 2u);
    }
  }

  v3 = *(a1 + 40);
  v4 = [*(a1 + 32) previewController];

  if (v3 == v4)
  {
    v11.receiver = *(a1 + 32);
    v11.super_class = CKChatController;
    objc_msgSendSuper2(&v11, sel_becomeFirstResponder);
    [*(a1 + 32) presentViewController:*(a1 + 40) animated:1 completion:0];
    return;
  }

  [*(a1 + 32) restoreEntryViewAfterPreview];
  if (!*(a1 + 48))
  {
    goto LABEL_13;
  }

  objc_opt_class();
  if ((objc_opt_isKindOfClass() & 1) == 0)
  {
    goto LABEL_13;
  }

  v5 = *(a1 + 56);
  v6 = [*(a1 + 32) collectionViewController];
  v7 = [v6 transcriptIdentifier];
  v8 = [v5 balloonControllerForContext:v7];

  if ((objc_opt_respondsToSelector() & 1) == 0)
  {

    goto LABEL_13;
  }

  v9 = [v8 handlePresentationAction];

  if ((v9 & 1) == 0)
  {
LABEL_13:
    v10 = [*(a1 + 32) navigationController];
    [v10 pushViewController:*(a1 + 40) animated:0];
  }
}

- (id)transcriptCollectionViewController:(id)controller previewForHighlightingContextMenuWithConfiguration:(id)configuration
{
  v168 = *MEMORY[0x1E69E9840];
  controllerCopy = controller;
  configurationCopy = configuration;
  if (IMOSLoggingEnabled())
  {
    v7 = OSLogHandleForIMFoundationCategory();
    if (os_log_type_enabled(v7, OS_LOG_TYPE_INFO))
    {
      *buf = 0;
      _os_log_impl(&dword_19020E000, v7, OS_LOG_TYPE_INFO, "generating reviewForHighlightingContextMenuWithConfiguration", buf, 2u);
    }
  }

  identifier = [configurationCopy identifier];
  objc_opt_class();
  isKindOfClass = objc_opt_isKindOfClass();

  if (isKindOfClass)
  {
    identifier2 = [configurationCopy identifier];
    v156 = [(CKChatController *)self _parentChatItemForIndexPath:identifier2];
    v157 = [(CKCoreChatController *)self indexPathOfParentChatItemForIndexPath:identifier2];
    v10 = [(CKChatController *)self _balloonViewForCellAtIndexPath:v157];
    fullScreenBalloonViewController = [(CKCoreChatController *)self fullScreenBalloonViewController];
    displayConfiguration = [fullScreenBalloonViewController displayConfiguration];
    v13 = [displayConfiguration type] == 2;

    if (v13)
    {
      fullScreenBalloonViewController2 = [(CKCoreChatController *)self fullScreenBalloonViewController];
      balloonView = [fullScreenBalloonViewController2 balloonView];
      objc_opt_class();
      v15 = objc_opt_isKindOfClass();

      if ((v15 & 1) == 0)
      {
        balloonView2 = [fullScreenBalloonViewController2 balloonView];
        [balloonView2 bounds];
        v21 = v20;
        v23 = v22;
        v25 = v24;
        v27 = v26;

        objc_opt_class();
        if (objc_opt_isKindOfClass())
        {
          v28 = +[CKUIBehavior sharedBehaviors];
          [v28 dragBalloonTailCropWidth];
          v30 = v29;

          if (!v10 || ([v10 balloonDescriptor], !v161))
          {
            v21 = v21 + v30;
          }

          v25 = v25 - v30;
        }

        v85 = objc_alloc_init(MEMORY[0x1E69DCE28]);
        v132 = +[CKUIBehavior sharedBehaviors];
        [v132 dragBalloonCornerRadius];
        v134 = v133;

        v135 = [MEMORY[0x1E69DC728] bezierPathWithRoundedRect:v21 cornerRadius:{v23, v25, v27, v134}];
        [v85 setVisiblePath:v135];

        balloonView3 = [fullScreenBalloonViewController2 balloonView];
        v18 = [objc_alloc(MEMORY[0x1E69DD070]) initWithView:balloonView3 parameters:v85];
        [v18 _setOverridePositionTrackingView:balloonView3];
        if (objc_opt_respondsToSelector())
        {
          [v18 _setPrefersUnmaskedPlatterStyle:1];
        }

        if (IMOSLoggingEnabled())
        {
          v137 = OSLogHandleForIMFoundationCategory();
          if (os_log_type_enabled(v137, OS_LOG_TYPE_INFO))
          {
            *buf = 138412546;
            v163 = v18;
            v164 = 2112;
            v165 = balloonView3;
            _os_log_impl(&dword_19020E000, v137, OS_LOG_TYPE_INFO, "previewForHighlightingContextMenuWithConfiguration returning preview for add sticker configuration: %@, trackingView: %@", buf, 0x16u);
          }
        }

        goto LABEL_114;
      }

      if (fullScreenBalloonViewController2)
      {
        balloonView4 = [fullScreenBalloonViewController2 balloonView];
      }

      else
      {
        balloonView4 = v10;
      }
    }

    else
    {
      balloonView4 = v10;
    }

    fullScreenBalloonViewController2 = [(CKChatController *)self _chatItemForContextMenuWithConfiguration:configurationCopy];
    if (IMOSLoggingEnabled())
    {
      v31 = OSLogHandleForIMFoundationCategory();
      if (os_log_type_enabled(v31, OS_LOG_TYPE_INFO))
      {
        iMChatItem = [fullScreenBalloonViewController2 IMChatItem];
        guid = [iMChatItem guid];
        clickyOrbChatItem = [(CKChatController *)self clickyOrbChatItem];
        iMChatItem2 = [clickyOrbChatItem IMChatItem];
        guid2 = [iMChatItem2 guid];
        *buf = 138412802;
        v163 = guid;
        v164 = 2112;
        v165 = guid2;
        v166 = 2112;
        v167 = v156;
        _os_log_impl(&dword_19020E000, v31, OS_LOG_TYPE_INFO, "previewForHighlightingContextMenuWithConfiguration contextMenuChatItem: %@, self.clickyOrb:%@, chatItem: %@", buf, 0x20u);
      }
    }

    if (!fullScreenBalloonViewController2)
    {
      objc_opt_class();
      if (objc_opt_isKindOfClass())
      {
        v37 = balloonView4;
        [v37 setCanUseOpaqueMask:1];
        [v37 prepareForDisplayIfNeeded];
      }
    }

    objc_opt_class();
    if (objc_opt_isKindOfClass())
    {
      collectionView = [controllerCopy collectionView];
      [balloonView4 frame];
      v40 = v39;
      v42 = v41;
      v44 = v43;
      v46 = v45;
      superview = [balloonView4 superview];
      [collectionView convertRect:superview fromView:{v40, v42, v44, v46}];
      v49 = v48;
      v51 = v50;
      v53 = v52;
      v55 = v54;

      contextMenuInteraction = [collectionView contextMenuInteraction];
      [contextMenuInteraction locationInView:collectionView];
      v58 = v57;
      v60 = v59;

      v172.origin.x = v49;
      v172.origin.y = v51;
      v172.size.width = v53;
      v172.size.height = v55;
      v170.x = v58;
      v170.y = v60;
      if (CGRectContainsPoint(v172, v170) || [identifier2 row] < 1)
      {
        v10 = balloonView4;
      }

      else
      {
        v61 = [MEMORY[0x1E696AC88] indexPathForRow:objc_msgSend(identifier2 inSection:{"row") - 1, objc_msgSend(identifier2, "section")}];
        v62 = [(CKChatController *)self _parentChatItemForIndexPath:v61];
        v63 = [(CKCoreChatController *)self indexPathOfParentChatItemForIndexPath:v61];
        v64 = [(CKChatController *)self _balloonViewForCellAtIndexPath:v63];
        objc_opt_class();
        if ((objc_opt_isKindOfClass() & 1) != 0 && ([v64 frame], v66 = v65, v68 = v67, v70 = v69, v72 = v71, objc_msgSend(v64, "superview"), v73 = objc_claimAutoreleasedReturnValue(), objc_msgSend(collectionView, "convertRect:fromView:", v73, v66, v68, v70, v72), v75 = v74, v77 = v76, v79 = v78, v81 = v80, v73, v173.origin.x = v75, v173.origin.y = v77, v173.size.width = v79, v173.size.height = v81, v171.x = v58, v171.y = v60, CGRectContainsPoint(v173, v171)))
        {
          v10 = v64;

          if (IMOSLoggingEnabled())
          {
            v82 = OSLogHandleForIMFoundationCategory();
            if (os_log_type_enabled(v82, OS_LOG_TYPE_INFO))
            {
              *buf = 138412290;
              v163 = v10;
              _os_log_impl(&dword_19020E000, v82, OS_LOG_TYPE_INFO, "previewForHighlightingContextMenuWithConfiguration updating parentBalloonView: %@", buf, 0xCu);
            }
          }
        }

        else
        {
          v10 = balloonView4;
        }
      }
    }

    else
    {
      v10 = balloonView4;
    }

    if (v10)
    {
      window = [v10 window];
      v84 = window == 0;

      if (v84)
      {
        v85 = IMLogHandleForCategory();
        if (os_log_type_enabled(v85, OS_LOG_TYPE_ERROR))
        {
          [CKChatController(ClickyOrbConformance) transcriptCollectionViewController:previewForHighlightingContextMenuWithConfiguration:];
        }
      }

      else
      {
        objc_opt_class();
        if (objc_opt_isKindOfClass())
        {
          v85 = v10;
          if (IMOSLoggingEnabled())
          {
            v86 = OSLogHandleForIMFoundationCategory();
            if (os_log_type_enabled(v86, OS_LOG_TYPE_INFO))
            {
              *buf = 138412290;
              v163 = v85;
              _os_log_impl(&dword_19020E000, v86, OS_LOG_TYPE_INFO, "previewForHighlightingContextMenuWithConfiguration generating preview from photoStackBalloonView: %@", buf, 0xCu);
            }
          }

          stackView = [v85 stackView];
          currentAssetReference = [stackView currentAssetReference];
          v88 = [stackView regionOfInterestForAssetReference:currentAssetReference];
          v89 = v88;
          if (v88 && (([v88 placeholderViewFactory], v90 = objc_claimAutoreleasedReturnValue(), v90, v90) && (objc_msgSend(v89, "placeholderViewFactory"), v91 = objc_claimAutoreleasedReturnValue(), (v91)[2](v91, v89), v92 = objc_claimAutoreleasedReturnValue(), v91, v92) || (-[CKChatController view](self, "view"), v93 = objc_claimAutoreleasedReturnValue(), objc_msgSend(v89, "rectInCoordinateSpace:", v93), v95 = v94, v97 = v96, v99 = v98, v101 = v100, v93, -[CKChatController view](self, "view"), v102 = objc_claimAutoreleasedReturnValue(), objc_msgSend(v102, "resizableSnapshotViewFromRect:afterScreenUpdates:withCapInsets:", 0, v95, v97, v99, v101, *MEMORY[0x1E69DDCE0], *(MEMORY[0x1E69DDCE0] + 8), *(MEMORY[0x1E69DDCE0] + 16), *(MEMORY[0x1E69DDCE0] + 24)), v92 = objc_claimAutoreleasedReturnValue(), v102, v92)))
          {
            if ((objc_opt_respondsToSelector() & 1) != 0 && ([v89 trackingContainerView], view = objc_claimAutoreleasedReturnValue(), objc_msgSend(v92, "bounds"), v107 = CGRectPxCenterPoint(v103, v104, v105, v106), view))
            {
              v109 = v107;
              v110 = v108;
              v111 = 0;
            }

            else
            {
              view = [(CKChatController *)self view];
              coordinateSpace = [view coordinateSpace];
              [v89 rectInCoordinateSpace:coordinateSpace];
              v109 = CGRectPxCenterPoint(v120, v121, v122, v123);
              v110 = v124;

              v111 = 1;
            }

            v125 = [objc_alloc(MEMORY[0x1E69DCE38]) initWithContainer:view center:{v109, v110}];
            v126 = objc_alloc_init(MEMORY[0x1E69DCE28]);
            v127 = +[CKUIBehavior sharedBehaviors];
            [v127 dragBalloonCornerRadius];

            v128 = MEMORY[0x1E69DC728];
            [v92 bounds];
            v129 = [v128 bezierPathWithRoundedRect:? cornerRadius:?];
            [v126 setVisiblePath:v129];

            v130 = [objc_alloc(MEMORY[0x1E69DD070]) initWithView:v92 parameters:v126 target:v125];
            v18 = v130;
            if (v111)
            {
              [v130 _setOverridePositionTrackingView:v85];
            }

            if (objc_opt_respondsToSelector())
            {
              [v18 _setPrefersUnmaskedPlatterStyle:1];
            }

            if (IMOSLoggingEnabled())
            {
              v131 = OSLogHandleForIMFoundationCategory();
              if (os_log_type_enabled(v131, OS_LOG_TYPE_INFO))
              {
                *buf = 138412290;
                v163 = v18;
                _os_log_impl(&dword_19020E000, v131, OS_LOG_TYPE_INFO, "previewForHighlightingContextMenuWithConfiguration generated photoStackBalloonView preview: %@", buf, 0xCu);
              }
            }
          }

          else
          {
            v18 = 0;
          }

          v10 = v85;
          goto LABEL_114;
        }

        objc_opt_class();
        if (objc_opt_isKindOfClass())
        {
          if (IMOSLoggingEnabled())
          {
            v112 = OSLogHandleForIMFoundationCategory();
            if (os_log_type_enabled(v112, OS_LOG_TYPE_INFO))
            {
              *buf = 138412290;
              v163 = v10;
              _os_log_impl(&dword_19020E000, v112, OS_LOG_TYPE_INFO, "previewForHighlightingContextMenuWithConfiguration generated parentBalloonView preview: %@", buf, 0xCu);
            }
          }

          if (((fullScreenBalloonViewController2 != 0) & [v10 canUseOpaqueMask]) == 1)
          {
            [v10 setCanUseOpaqueMask:0];
            [v10 setNeedsPrepareForDisplay];
            [v10 prepareForDisplayIfNeeded];
            [v10 layoutIfNeeded];
            [MEMORY[0x1E6979518] flush];
          }

          v85 = objc_alloc_init(MEMORY[0x1E69DCE28]);
          bezierPathForDragPreview = [v10 bezierPathForDragPreview];
          [v85 setVisiblePath:bezierPathForDragPreview];
          objc_opt_class();
          if (objc_opt_isKindOfClass())
          {
            dataSource = [v10 dataSource];
            pluginPayload = [dataSource pluginPayload];
            pluginBundleID = [pluginPayload pluginBundleID];
            v117 = IMBalloonExtensionIDWithSuffix();
            v118 = [pluginBundleID isEqualToString:v117];
          }

          else
          {
            v118 = 0;
          }

          objc_opt_class();
          if ((objc_opt_isKindOfClass() & 1) != 0 && [v10 shouldProvideDragPreview])
          {
            v138 = v10;
            attachmentBalloonViewPreview = [v138 attachmentBalloonViewPreview];
            v140 = attachmentBalloonViewPreview;
            if (attachmentBalloonViewPreview)
            {
              v141 = attachmentBalloonViewPreview;
            }

            else
            {
              v141 = v138;
            }

            v142 = v141;

            superview2 = [v138 superview];
            v144 = objc_alloc(MEMORY[0x1E69DCE38]);
            [v138 frame];
            v149 = [v144 initWithContainer:superview2 center:{CGRectPxCenterPoint(v145, v146, v147, v148)}];
            v18 = [objc_alloc(MEMORY[0x1E69DD070]) initWithView:v142 parameters:v85 target:v149];
            if (IMOSLoggingEnabled())
            {
              v150 = OSLogHandleForIMFoundationCategory();
              if (os_log_type_enabled(v150, OS_LOG_TYPE_INFO))
              {
                *buf = 138412802;
                v163 = v142;
                v164 = 2112;
                v165 = superview2;
                v166 = 2112;
                v167 = v18;
                _os_log_impl(&dword_19020E000, v150, OS_LOG_TYPE_INFO, "previewForHighlightingContextMenuWithConfiguration previewContentView: %@, containerView: %@, preview: %@", buf, 0x20u);
              }
            }
          }

          else if (v118)
          {
            [v85 setShadowPath:0];
            clearColor = [MEMORY[0x1E69DC888] clearColor];
            [v85 setBackgroundColor:clearColor];

            v18 = [objc_alloc(MEMORY[0x1E69DD070]) initWithView:v10 parameters:v85];
          }

          else
          {
            v18 = [objc_alloc(MEMORY[0x1E69DD070]) initWithView:v10 parameters:v85];
            if (IMOSLoggingEnabled())
            {
              v152 = OSLogHandleForIMFoundationCategory();
              if (os_log_type_enabled(v152, OS_LOG_TYPE_INFO))
              {
                *buf = 138412546;
                v163 = v18;
                v164 = 2112;
                v165 = v10;
                _os_log_impl(&dword_19020E000, v152, OS_LOG_TYPE_INFO, "previewForHighlightingContextMenuWithConfiguration generated preview: %@, parentBalloonView: %@", buf, 0x16u);
              }
            }
          }

          [v18 _setOverridePositionTrackingView:v10];
          if (objc_opt_respondsToSelector())
          {
            [v18 _setPrefersUnmaskedPlatterStyle:1];
          }

          goto LABEL_114;
        }

        v85 = IMLogHandleForCategory();
        if (os_log_type_enabled(v85, OS_LOG_TYPE_ERROR))
        {
          [CKChatController(ClickyOrbConformance) transcriptCollectionViewController:previewForHighlightingContextMenuWithConfiguration:];
        }
      }
    }

    else
    {
      v85 = IMLogHandleForCategory();
      if (os_log_type_enabled(v85, OS_LOG_TYPE_ERROR))
      {
        [CKChatController(ClickyOrbConformance) transcriptCollectionViewController:previewForHighlightingContextMenuWithConfiguration:];
      }
    }

    v18 = 0;
LABEL_114:

    goto LABEL_115;
  }

  if (IMOSLoggingEnabled())
  {
    v17 = OSLogHandleForIMFoundationCategory();
    if (os_log_type_enabled(v17, OS_LOG_TYPE_INFO))
    {
      *buf = 0;
      _os_log_impl(&dword_19020E000, v17, OS_LOG_TYPE_INFO, "previewForHighlightingContextMenuWithConfiguration unknown indexPath. No preview available", buf, 2u);
    }
  }

  v18 = 0;
LABEL_115:

  return v18;
}

- (id)transcriptCollectionViewController:(id)controller previewForDismissingContextMenuWithConfiguration:(id)configuration
{
  v16 = *MEMORY[0x1E69E9840];
  controllerCopy = controller;
  configurationCopy = configuration;
  if (IMOSLoggingEnabled())
  {
    v8 = OSLogHandleForIMFoundationCategory();
    if (os_log_type_enabled(v8, OS_LOG_TYPE_INFO))
    {
      pickerContainerAccessoryView = [(CKChatController *)self pickerContainerAccessoryView];
      v12 = 136315394;
      v13 = "[CKChatController(ClickyOrbConformance) transcriptCollectionViewController:previewForDismissingContextMenuWithConfiguration:]";
      v14 = 2112;
      v15 = pickerContainerAccessoryView;
      _os_log_impl(&dword_19020E000, v8, OS_LOG_TYPE_INFO, "%s clearing TapbackContainerAccessoryView: %@", &v12, 0x16u);
    }
  }

  [(CKChatController *)self setClickyOrbChatItem:0];
  [(CKChatController *)self setPickerContainerAccessoryView:0];
  v10 = [(CKChatController *)self transcriptCollectionViewController:controllerCopy previewForHighlightingContextMenuWithConfiguration:configurationCopy];

  return v10;
}

- (id)contextMenuAccessoryViewsForChatItem:(id)item containingViewController:(id)controller
{
  itemCopy = item;
  controllerCopy = controller;
  v8 = objc_alloc_init(MEMORY[0x1E695DF70]);
  if ([(CKChatController *)self shouldShowTapbackPickerForChatItem:itemCopy])
  {
    v9 = [(CKChatController *)self pickerAccessoryViewForChatItem:itemCopy containingViewController:controllerCopy];
    [v8 addObject:v9];
    [(CKChatController *)self setPickerContainerAccessoryView:v9];
  }

  if ([(CKCoreChatController *)self shouldShowTapbackAttributionForChatItem:itemCopy])
  {
    v10 = [(CKChatController *)self _votingViewForChatItem:itemCopy containingViewController:controllerCopy];
    [v8 addObject:v10];
  }

  return v8;
}

- (id)transcriptCollectionViewController:(id)controller styleForContextMenuWithConfiguration:(id)configuration
{
  v65 = *MEMORY[0x1E69E9840];
  controllerCopy = controller;
  configurationCopy = configuration;
  v8 = [(CKChatController *)self _chatItemForContextMenuWithConfiguration:configurationCopy];
  if (IMOSLoggingEnabled())
  {
    v9 = OSLogHandleForIMFoundationCategory();
    if (os_log_type_enabled(v9, OS_LOG_TYPE_INFO))
    {
      iMChatItem = [v8 IMChatItem];
      guid = [iMChatItem guid];
      clickyOrbChatItem = [(CKChatController *)self clickyOrbChatItem];
      iMChatItem2 = [clickyOrbChatItem IMChatItem];
      guid2 = [iMChatItem2 guid];
      v61 = 138412546;
      v62 = guid;
      v63 = 2112;
      v64 = guid2;
      _os_log_impl(&dword_19020E000, v9, OS_LOG_TYPE_INFO, " styleForContextMenuWithConfiguration chatItem: %@, self.clickyOrb:%@", &v61, 0x16u);
    }
  }

  defaultStyle = [MEMORY[0x1E69DD440] defaultStyle];
  collectionView = [(CKChatController *)self collectionView];
  [collectionView layoutMargins];
  v18 = v17;
  v20 = v19;
  v22 = v21;

  v23 = 0.0;
  if ([(CKChatController *)self shouldShowTapbackPickerForChatItem:v8])
  {
    +[CKTapbackPickerBalloonLayoutTemplate requiredDisplayHeight];
    v25 = v24;
    v26 = +[CKUIBehavior sharedBehaviors];
    [v26 orbPreviewAdditionalTopInsetForTapbackPicker];
    v28 = v27;

    v23 = v25 + v28 + 0.0;
  }

  if ([(CKCoreChatController *)self shouldShowTapbackAttributionForChatItem:v8])
  {
    v29 = +[CKUIBehavior sharedBehaviors];
    [v29 attributionViewHeight];
    v31 = v30;
    v32 = +[CKUIBehavior sharedBehaviors];
    [v32 attributionViewMinPadding];
    v34 = v33;

    v23 = v23 + v31 + v34;
  }

  +[CKTapbackPickerBalloonLayoutTemplate emojiTailBubbleMargin];
  v36 = v35;
  +[CKTapbackPickerBalloonLayoutTemplate selectionTailSize];
  v38 = v37;
  +[CKTapbackPickerBalloonLayoutTemplate emojiTailBubbleMargin];
  v40 = v36 + v38 + v39;
  if (![v8 isFromMe] || (+[CKUIBehavior sharedBehaviors](CKUIBehavior, "sharedBehaviors"), v41 = objc_claimAutoreleasedReturnValue(), v42 = objc_msgSend(v41, "orbPreviewUsesLeftInsetForTapbackPicker"), v41, v43 = v40, (v42 & 1) == 0))
  {
    if (![v8 isFromMe])
    {
      v22 = v40;
    }

    v43 = v18;
  }

  v44 = +[CKUIBehavior sharedBehaviors];
  orbPreviewOverridesLeftInsetForSplitView = [v44 orbPreviewOverridesLeftInsetForSplitView];

  if (orbPreviewOverridesLeftInsetForSplitView)
  {
    view = [(CKChatController *)self view];
    _shouldReverseLayoutDirection = [view _shouldReverseLayoutDirection];

    if (_shouldReverseLayoutDirection)
    {
      if ([v8 isFromMe])
      {
        v48 = v40;
      }

      else
      {
        v48 = v43;
      }

      collectionView2 = [(CKChatController *)self collectionView];
      [collectionView2 safeAreaInsets];
      v51 = v50;

      v22 = fmax(v22 - v51, 0.0);
    }

    else
    {
      collectionView3 = [(CKChatController *)self collectionView];
      [collectionView3 safeAreaInsets];
      v56 = v55;

      v48 = fmax(v43 - v56, 0.0);
    }
  }

  else
  {
    collectionView4 = [(CKChatController *)self collectionView];
    _flipsHorizontalAxis = [collectionView4 _flipsHorizontalAxis];

    if (_flipsHorizontalAxis)
    {
      v48 = v22;
    }

    else
    {
      v48 = v43;
    }

    if (_flipsHorizontalAxis)
    {
      v22 = v43;
    }
  }

  [defaultStyle preferredEdgeInsets];
  [defaultStyle setPreferredEdgeInsets:{fmax(v57, v23), v48, v20, v22}];
  traitCollection = [controllerCopy traitCollection];
  [defaultStyle setPreventPreviewRasterization:{objc_msgSend(traitCollection, "isTranscriptBackgroundActive")}];

  if (objc_opt_respondsToSelector())
  {
    v59 = [objc_alloc(MEMORY[0x1E69DD818]) initWithVariant:0];
    [v59 setSubvariant:@"messagesTapback"];
    [defaultStyle setPreferredMenuMaterial:v59];
  }

  return defaultStyle;
}

- (void)transcriptCollectionViewController:(id)controller balloonViewWillDismissEditMenu:(id)menu
{
  v4 = [(CKCoreChatController *)self chat:controller];
  [v4 endHoldingChatItemsUpdatesForReason:*MEMORY[0x1E69A57D8]];
}

- (void)clearEntryViewPasteConfiguration
{
  entryView = [(CKChatController *)self entryView];
  contentView = [entryView contentView];
  textView = [contentView textView];

  v4 = objc_alloc_init(MEMORY[0x1E69DCD38]);
  [textView setPasteConfiguration:v4];
}

- (void)restoreEntryViewPasteConfiguration
{
  entryView = [(CKChatController *)self entryView];
  contentView = [entryView contentView];
  textView = [contentView textView];

  chat = [(CKCoreChatController *)self chat];
  LODWORD(entryView) = [chat supportsCapabilities:0x8000];

  v6 = +[CKUIBehavior sharedBehaviors];
  v7 = [v6 pasteConfigurationDisablingKeyboardStickers:entryView ^ 1];

  [textView setPasteConfiguration:v7];
}

- (void)transcriptCollectionViewController:(id)controller willEndContextMenuInteractionWithConfiguration:(id)configuration animator:(id)animator
{
  v52 = *MEMORY[0x1E69E9840];
  controllerCopy = controller;
  configurationCopy = configuration;
  animatorCopy = animator;
  v10 = [(CKChatController *)self _chatItemForContextMenuWithConfiguration:configurationCopy];
  if (IMOSLoggingEnabled())
  {
    v11 = OSLogHandleForIMFoundationCategory();
    if (os_log_type_enabled(v11, OS_LOG_TYPE_INFO))
    {
      iMChatItem = [v10 IMChatItem];
      guid = [iMChatItem guid];
      clickyOrbChatItem = [(CKChatController *)self clickyOrbChatItem];
      iMChatItem2 = [clickyOrbChatItem IMChatItem];
      guid2 = [iMChatItem2 guid];
      *buf = 138412546;
      v49 = guid;
      v50 = 2112;
      v51 = guid2;
      _os_log_impl(&dword_19020E000, v11, OS_LOG_TYPE_INFO, " willEndContextMenuInteractionWithConfiguration chatItem: %@, self.clickyOrb:%@", buf, 0x16u);
    }
  }

  if (IMOSLoggingEnabled())
  {
    v17 = OSLogHandleForIMFoundationCategory();
    if (os_log_type_enabled(v17, OS_LOG_TYPE_INFO))
    {
      entryView = [(CKChatController *)self entryView];
      contentView = [entryView contentView];
      isActive = [contentView isActive];
      *buf = 67109120;
      LODWORD(v49) = isActive;
      _os_log_impl(&dword_19020E000, v17, OS_LOG_TYPE_INFO, "Was keyboard shown before context menu DISMISSED? %{BOOL}d", buf, 8u);
    }
  }

  transcriptBackground = [(CKCoreChatController *)self transcriptBackground];
  entryView2 = [(CKChatController *)self entryView];
  contentView2 = [entryView2 contentView];
  [transcriptBackground setKeyboardWasUpBeforeTapbackContext:{objc_msgSend(contentView2, "isActive")}];

  messageEditingViewController = [(CKChatController *)self messageEditingViewController];
  v25 = messageEditingViewController != 0;

  if (v25)
  {
    [(CKScrollViewController *)self endHoldingScrollGeometryUpdatesForReason:@"ContextMenu"];
  }

  identifier = [configurationCopy identifier];
  objc_opt_class();
  isKindOfClass = objc_opt_isKindOfClass();

  if (isKindOfClass)
  {
    identifier2 = [configurationCopy identifier];
    v29 = [(CKCoreChatController *)self indexPathOfParentChatItemForIndexPath:identifier2];
    v30 = [(CKChatController *)self _balloonViewForCellAtIndexPath:v29];
    [v30 setIsBeingShownAsPreview:0];
  }

  else
  {
    v30 = 0;
    identifier2 = 0;
  }

  [v30 setIsBeingShownAsPreview:0];
  aBlock[0] = MEMORY[0x1E69E9820];
  aBlock[1] = 3221225472;
  aBlock[2] = __133__CKChatController_ClickyOrbConformance__transcriptCollectionViewController_willEndContextMenuInteractionWithConfiguration_animator___block_invoke;
  aBlock[3] = &unk_1E72EBF20;
  aBlock[4] = self;
  v43 = v10;
  v47 = v25;
  v44 = controllerCopy;
  v31 = identifier2;
  v45 = v31;
  v32 = v30;
  v46 = v32;
  v33 = controllerCopy;
  v34 = v10;
  v35 = _Block_copy(aBlock);
  v40[0] = MEMORY[0x1E69E9820];
  v40[1] = 3221225472;
  v40[2] = __133__CKChatController_ClickyOrbConformance__transcriptCollectionViewController_willEndContextMenuInteractionWithConfiguration_animator___block_invoke_253;
  v40[3] = &unk_1E72EB8D0;
  v40[4] = self;
  v41 = v31;
  v36 = v31;
  v37 = _Block_copy(v40);
  v38 = v37;
  if (animatorCopy)
  {
    [animatorCopy addAnimations:v37];
    [animatorCopy addCompletion:v35];
  }

  else
  {
    (*(v37 + 2))(v37);
    v35[2](v35);
  }

  [(CKChatController *)self restoreEntryViewPasteConfiguration];
  [(CKChatController *)self restoreInputAfterPreviewPresentation];
}

void __133__CKChatController_ClickyOrbConformance__transcriptCollectionViewController_willEndContextMenuInteractionWithConfiguration_animator___block_invoke(uint64_t a1)
{
  v20 = *MEMORY[0x1E69E9840];
  if (IMOSLoggingEnabled())
  {
    v2 = OSLogHandleForIMFoundationCategory();
    if (os_log_type_enabled(v2, OS_LOG_TYPE_INFO))
    {
      v3 = [*(a1 + 32) pickerContainerAccessoryView];
      v16 = 136315394;
      v17 = "[CKChatController(ClickyOrbConformance) transcriptCollectionViewController:willEndContextMenuInteractionWithConfiguration:animator:]_block_invoke";
      v18 = 2112;
      v19 = v3;
      _os_log_impl(&dword_19020E000, v2, OS_LOG_TYPE_INFO, "%s completion called, clearing TapbackContainerAccessoryView: %@", &v16, 0x16u);
    }
  }

  [*(a1 + 32) setClickyOrbChatItem:0];
  [*(a1 + 32) setPickerContainerAccessoryView:0];
  [*(a1 + 32) setDismissingContextMenu:1];
  if ([*(a1 + 32) acknowledgmentToSend])
  {
    v4 = [*(a1 + 32) chat];
    [v4 sendMessageAcknowledgment:objc_msgSend(*(a1 + 32) forChatItem:{"acknowledgmentToSend"), *(a1 + 40)}];

    [*(a1 + 32) setAcknowledgmentToSend:0];
  }

  v5 = [*(a1 + 32) chat];
  [v5 endHoldingChatItemsUpdatesForReason:*MEMORY[0x1E69A5788]];
  if ((*(a1 + 72) & 1) == 0)
  {
    [*(a1 + 32) endHoldingScrollGeometryUpdatesForReason:@"ContextMenu"];
  }

  if ([*(a1 + 32) wasKeyboardShowingWithApp])
  {
    [*(a1 + 32) setWasKeyboardShowingWithApp:0];
    v6 = [*(a1 + 32) presentedViewController];
    if (v6)
    {
    }

    else if (([*(a1 + 32) isEditing] & 1) == 0)
    {
      [*(a1 + 32) reloadInputViews];
      [*(a1 + 32) becomeFirstResponder];
    }

    v7 = [*(a1 + 48) collectionView];
    [v7 endHoldingContentOffsetUpdatesForReason:@"ChatControllerClickyOrb"];
  }

  if ([*(a1 + 32) wantsInlineOverlay])
  {
    if (CKIsRunningInMacCatalyst())
    {
      v8 = [*(a1 + 32) collectionViewController];
      v9 = [v8 selectedChatItems];
      v10 = [v9 firstObject];

      v11 = v10;
      if (!v10)
      {
        v11 = *(a1 + 40);
      }

      v12 = v11;
    }

    else
    {
      v12 = *(a1 + 40);
    }

    [*(a1 + 32) showInlineReplyControllerForChatItem:v12 presentKeyboard:1];
    [*(a1 + 32) setWantsInlineOverlay:0];
  }

  else
  {
    v13 = [*(a1 + 32) wantsStickerDetails];
    v14 = *(a1 + 32);
    if (v13)
    {
      [v14 setWantsStickerDetails:0];
      [*(a1 + 32) presentStickerDetailControllerWithIndexPath:*(a1 + 56)];
    }

    else if ([v14 wantsEmojiDetails])
    {
      [*(a1 + 32) setWantsEmojiDetails:0];
      [*(a1 + 32) presentEmojiDetailsControllerWithIndexPath:*(a1 + 56)];
    }
  }

  objc_opt_class();
  if (objc_opt_isKindOfClass())
  {
    v15 = *(a1 + 64);
    [v15 setCanUseOpaqueMask:1];
    [v15 prepareForDisplayIfNeeded];
  }

  [*(a1 + 32) setDismissingContextMenu:0];
}

void __133__CKChatController_ClickyOrbConformance__transcriptCollectionViewController_willEndContextMenuInteractionWithConfiguration_animator___block_invoke_253(uint64_t a1)
{
  v2 = [*(a1 + 32) fullScreenBalloonViewController];
  v3 = [v2 displayConfiguration];
  v4 = [v3 shouldShowStickers];

  if ((v4 & 1) == 0)
  {
    v5 = [*(a1 + 32) _parentChatItemForIndexPath:*(a1 + 40)];
    [*(a1 + 32) showAssociatedCellsForChatItem:v5 animated:1 completion:0];
  }
}

- (void)transcriptCollectionViewController:(id)controller willDisplayContextMenuWithConfiguration:(id)configuration animator:(id)animator
{
  v27 = *MEMORY[0x1E69E9840];
  controllerCopy = controller;
  configurationCopy = configuration;
  animatorCopy = animator;
  [(CKChatController *)self clearEntryViewPasteConfiguration];
  [(CKChatController *)self prepareInputForPreviewPresentation];
  identifier = [configurationCopy identifier];
  objc_opt_class();
  isKindOfClass = objc_opt_isKindOfClass();

  if (isKindOfClass)
  {
    identifier2 = [configurationCopy identifier];
    v14 = [(CKCoreChatController *)self indexPathOfParentChatItemForIndexPath:identifier2];
    v15 = [(CKChatController *)self _balloonViewForCellAtIndexPath:v14];
  }

  else
  {
    v15 = 0;
    identifier2 = 0;
  }

  if ([v15 canUseOpaqueMask])
  {
    [v15 setCanUseOpaqueMask:0];
    [v15 setNeedsPrepareForDisplay];
    [v15 prepareForDisplayIfNeeded];
    [v15 layoutIfNeeded];
    [MEMORY[0x1E6979518] flush];
  }

  chat = [(CKCoreChatController *)self chat];
  [chat beginHoldingChatItemsUpdatesForReason:*MEMORY[0x1E69A5788]];
  [(CKScrollViewController *)self beginHoldingScrollGeometryUpdatesForReason:@"ContextMenu"];
  delegate = [(CKCoreChatController *)self delegate];
  v18 = objc_opt_respondsToSelector();

  if (v18)
  {
    delegate2 = [(CKCoreChatController *)self delegate];
    [delegate2 willDisplayContextMenuForChatController:self];

    transcriptBackground = [(CKCoreChatController *)self transcriptBackground];
    entryView = [(CKChatController *)self entryView];
    contentView = [entryView contentView];
    [transcriptBackground setKeyboardWasUpBeforeTapbackContext:{objc_msgSend(contentView, "isActive")}];

    if (IMOSLoggingEnabled())
    {
      v23 = OSLogHandleForIMFoundationCategory();
      if (os_log_type_enabled(v23, OS_LOG_TYPE_INFO))
      {
        entryView2 = [(CKChatController *)self entryView];
        contentView2 = [entryView2 contentView];
        v26[0] = 67109120;
        v26[1] = [contentView2 isActive];
        _os_log_impl(&dword_19020E000, v23, OS_LOG_TYPE_INFO, "Was keyboard shown before context menu SHOWN? %{BOOL}d", v26, 8u);
      }
    }
  }
}

- (id)transcriptCollectionViewController:(id)controller accessoriesForContextMenuWithConfiguration:(id)configuration
{
  v21 = *MEMORY[0x1E69E9840];
  controllerCopy = controller;
  configurationCopy = configuration;
  v8 = [(CKChatController *)self _chatItemForContextMenuWithConfiguration:configurationCopy];
  if (IMOSLoggingEnabled())
  {
    v9 = OSLogHandleForIMFoundationCategory();
    if (os_log_type_enabled(v9, OS_LOG_TYPE_INFO))
    {
      iMChatItem = [v8 IMChatItem];
      guid = [iMChatItem guid];
      clickyOrbChatItem = [(CKChatController *)self clickyOrbChatItem];
      iMChatItem2 = [clickyOrbChatItem IMChatItem];
      guid2 = [iMChatItem2 guid];
      v17 = 138412546;
      v18 = guid;
      v19 = 2112;
      v20 = guid2;
      _os_log_impl(&dword_19020E000, v9, OS_LOG_TYPE_INFO, " accessoriesForContextMenuWithConfiguration chatItem: %@, self.clickyOrb:%@", &v17, 0x16u);
    }
  }

  v15 = [(CKChatController *)self contextMenuAccessoryViewsForChatItem:v8 containingViewController:self];

  return v15;
}

- (id)_chatItemForContextMenuWithConfiguration:(id)configuration
{
  v18 = *MEMORY[0x1E69E9840];
  configurationCopy = configuration;
  identifier = [configurationCopy identifier];
  objc_opt_class();
  isKindOfClass = objc_opt_isKindOfClass();

  if (isKindOfClass)
  {
    identifier2 = [configurationCopy identifier];
    if (identifier2)
    {
      v8 = [(CKChatController *)self _parentChatItemForIndexPath:identifier2];
      goto LABEL_6;
    }
  }

  else
  {
    identifier2 = 0;
  }

  v8 = 0;
LABEL_6:
  objc_opt_class();
  if (objc_opt_isKindOfClass())
  {
    v9 = [(CKCoreChatController *)self indexPathOfParentChatItemForIndexPath:identifier2];
    v10 = [(CKChatController *)self _balloonViewForCellAtIndexPath:v9];
    if (v10)
    {
      objc_opt_class();
      if (objc_opt_isKindOfClass())
      {
        currentAssetChatItem = [v10 currentAssetChatItem];

        v8 = currentAssetChatItem;
      }
    }
  }

  if (IMOSLoggingEnabled())
  {
    v12 = OSLogHandleForIMFoundationCategory();
    if (os_log_type_enabled(v12, OS_LOG_TYPE_INFO))
    {
      v14 = 138412546;
      v15 = v8;
      v16 = 2112;
      v17 = identifier2;
      _os_log_impl(&dword_19020E000, v12, OS_LOG_TYPE_INFO, "clickyOrbConformance: found chatItem:%@ at indexPath:%@", &v14, 0x16u);
    }
  }

  return v8;
}

- (void)dismissContextMenuInteractionMenu
{
  if ([(CKChatController *)self photosGridViewPresented])
  {
    photosGridViewController = [(CKChatController *)self photosGridViewController];
    v4 = objc_opt_respondsToSelector();

    if ((v4 & 1) == 0)
    {
      return;
    }

    photosGridViewController2 = [(CKChatController *)self photosGridViewController];
  }

  else
  {
    photosGridViewController2 = [(CKChatController *)self collectionView];
  }

  v7 = photosGridViewController2;
  contextMenuInteraction = [photosGridViewController2 contextMenuInteraction];
  [contextMenuInteraction dismissMenu];
}

- (id)_menuForChatItem:(id)item withParentChatItem:(id)chatItem menuAppearance:(int64_t)appearance
{
  v69[1] = *MEMORY[0x1E69E9840];
  itemCopy = item;
  chatItemCopy = chatItem;
  v10 = +[CKUIBehavior sharedBehaviors];
  disableTranscriptClickyOrbContextMenu = [v10 disableTranscriptClickyOrbContextMenu];

  if (disableTranscriptClickyOrbContextMenu)
  {
    v12 = 0;
  }

  else
  {
    isReadOnly = [(CKCoreChatController *)self isReadOnly];
    array = [MEMORY[0x1E695DF70] array];
    if ([(CKChatController *)self _shouldConfigureChatItemMenuForCommSafety:itemCopy])
    {
      if (CKIsRunningInMacCatalyst())
      {
        [(CKChatController *)self _deleteMenuForChatItem:itemCopy];
      }

      else
      {
        [(CKChatController *)self _moreActionForChatItem:itemCopy configureForCommSafety:1];
      }
      v22 = ;
      __93__CKChatController_ClickyOrbConformance___menuForChatItem_withParentChatItem_menuAppearance___block_invoke(v22, v22, array);

      if ([array count])
      {
        v12 = [MEMORY[0x1E69DCC60] menuWithTitle:&stru_1F04268F8 children:array];
      }

      else
      {
        v12 = 0;
      }
    }

    else
    {
      collectionViewController = [(CKCoreChatController *)self collectionViewController];
      v64 = [collectionViewController balloonViewForChatItem:chatItemCopy];

      v16 = [(CKChatController *)self _addPollDetailsActionForChatItem:itemCopy parentChatItem:chatItemCopy sourceView:v64];
      v63 = v16;
      v17 = v16;
      if (v16)
      {
        if (CKIsRunningInMessagesViewService())
        {
          [v17 setAttributes:1];
        }

        v18 = MEMORY[0x1E69DCC60];
        v69[0] = v17;
        v19 = [MEMORY[0x1E695DEC8] arrayWithObjects:v69 count:1];
        v20 = [v18 menuWithTitle:&stru_1F04268F8 image:0 identifier:0 options:1 children:v19];

        v21 = v20;
      }

      else
      {
        v21 = 0;
      }

      v59 = v21;
      __93__CKChatController_ClickyOrbConformance___menuForChatItem_withParentChatItem_menuAppearance___block_invoke(v16, v21, array);
      if (!isReadOnly)
      {
        v23 = [(CKChatController *)self _responsesSubmenuForChatItem:itemCopy withParentChatItem:chatItemCopy menuAppearance:appearance];
        __93__CKChatController_ClickyOrbConformance___menuForChatItem_withParentChatItem_menuAppearance___block_invoke(v23, v23, array);
      }

      if (CKIsRunningInMacCatalyst())
      {
        [(CKChatController *)self _exportMenuForChatItem:itemCopy];
      }

      else
      {
        [(CKChatController *)self _exportActionForChatItem:itemCopy shouldUseTopMostChatItemIfAggregateChatItem:1];
      }
      v62 = ;
      __93__CKChatController_ClickyOrbConformance___menuForChatItem_withParentChatItem_menuAppearance___block_invoke(v62, v62, array);
      v61 = [(CKChatController *)self _saveStickerActionForChatItem:itemCopy sourceView:v64];
      __93__CKChatController_ClickyOrbConformance___menuForChatItem_withParentChatItem_menuAppearance___block_invoke(v61, v61, array);
      conversation = [(CKCoreChatController *)self conversation];
      v24 = objc_opt_new();
      chat = [(CKCoreChatController *)self chat];
      v26 = [chat supportsCapabilities:1];

      if (((v26 | isReadOnly) & 1) != 0 && [itemCopy canEditMessageText] && !(isReadOnly | ((objc_msgSend(conversation, "supportsMessageEditing") & 1) == 0)))
      {
        objc_initWeak(&location, self);
        v58 = MEMORY[0x1E69DC628];
        v27 = CKFrameworkBundle();
        v28 = [v27 localizedStringForKey:@"EDIT_ORB_MENU" value:&stru_1F04268F8 table:@"ChatKit"];
        v29 = [MEMORY[0x1E69DCAB8] systemImageNamed:@"pencil"];
        v65[0] = MEMORY[0x1E69E9820];
        v65[1] = 3221225472;
        v65[2] = __93__CKChatController_ClickyOrbConformance___menuForChatItem_withParentChatItem_menuAppearance___block_invoke_2;
        v65[3] = &unk_1E72EBF48;
        objc_copyWeak(&v67, &location);
        v66 = itemCopy;
        v30 = [v58 actionWithTitle:v28 image:v29 identifier:0 handler:v65];

        [v24 addObject:v30];
        objc_destroyWeak(&v67);
        objc_destroyWeak(&location);
      }

      if ([itemCopy canRetract] && !(isReadOnly | ((objc_msgSend(conversation, "supportsMessageEditing") & 1) == 0)))
      {
        v31 = [(CKChatController *)self _retractionActionForChatItem:itemCopy];
        [v24 addObject:v31];
      }

      if ([v24 count])
      {
        v32 = [MEMORY[0x1E69DCC60] menuWithTitle:&stru_1F04268F8 image:0 identifier:0 options:1 children:v24];
        __93__CKChatController_ClickyOrbConformance___menuForChatItem_withParentChatItem_menuAppearance___block_invoke(v32, v32, array);
      }

      if (CKIsRunningInMacCatalyst())
      {
        [(CKChatController *)self _forwardAndCopyMenuForChatItem:itemCopy];
      }

      else
      {
        [(CKChatController *)self _forwardAndCopyActionsForChatItem:itemCopy];
      }
      v33 = ;
      __93__CKChatController_ClickyOrbConformance___menuForChatItem_withParentChatItem_menuAppearance___block_invoke(v33, v33, array);
      if ([MEMORY[0x1E69A8020] supportsSharedWithYou])
      {
        v34 = [(CKChatController *)self _highlightActionForChatItem:itemCopy];
        __93__CKChatController_ClickyOrbConformance___menuForChatItem_withParentChatItem_menuAppearance___block_invoke(v34, v34, array);
      }

      if ([CKTranslatorUtilities shouldShowTranslateMenuOption:itemCopy])
      {
        v35 = [CKTranslationMenu translateOrbActionForChatItem:itemCopy forController:self];
        __93__CKChatController_ClickyOrbConformance___menuForChatItem_withParentChatItem_menuAppearance___block_invoke(v35, v35, array);
      }

      mEMORY[0x1E69A8070] = [MEMORY[0x1E69A8070] sharedFeatureFlags];
      isTextSelectionEnabled = [mEMORY[0x1E69A8070] isTextSelectionEnabled];

      if (isTextSelectionEnabled && !CKIsRunningInMacCatalyst())
      {
        v38 = [(CKChatController *)self textSelectionActionWithChatItem:itemCopy];
        __93__CKChatController_ClickyOrbConformance___menuForChatItem_withParentChatItem_menuAppearance___block_invoke(v38, v38, array);
      }

      if (CKIsRunningInMacCatalyst())
      {
        chat2 = [(CKCoreChatController *)self chat];
        isStewieSharingChat = [chat2 isStewieSharingChat];

        if ((isStewieSharingChat & 1) == 0 && [itemCopy canDelete])
        {
          v41 = [(CKChatController *)self _deleteMenuForChatItem:itemCopy];
          __93__CKChatController_ClickyOrbConformance___menuForChatItem_withParentChatItem_menuAppearance___block_invoke(v41, v41, array);
        }

        _showTimestampsAction = [(CKChatController *)self _showTimestampsAction];
        __93__CKChatController_ClickyOrbConformance___menuForChatItem_withParentChatItem_menuAppearance___block_invoke(_showTimestampsAction, _showTimestampsAction, array);
      }

      if (!isReadOnly)
      {
        v43 = [(CKChatController *)self _downgradeMessageActionForChatItem:itemCopy];
        __93__CKChatController_ClickyOrbConformance___menuForChatItem_withParentChatItem_menuAppearance___block_invoke(v43, v43, array);
      }

      v44 = [(CKChatController *)self _emojiDetailsActionForChatItem:chatItemCopy];
      __93__CKChatController_ClickyOrbConformance___menuForChatItem_withParentChatItem_menuAppearance___block_invoke(v44, v44, array);

      v45 = [(CKChatController *)self _stickerDetailsActionForChatItem:chatItemCopy];
      __93__CKChatController_ClickyOrbConformance___menuForChatItem_withParentChatItem_menuAppearance___block_invoke(v45, v45, array);

      v46 = [(CKChatController *)self _mediaAttributionActionForChatItem:itemCopy];
      __93__CKChatController_ClickyOrbConformance___menuForChatItem_withParentChatItem_menuAppearance___block_invoke(v46, v46, array);

      mEMORY[0x1E69A8070]2 = [MEMORY[0x1E69A8070] sharedFeatureFlags];
      isTranscriptBackgroundsEnabled = [mEMORY[0x1E69A8070]2 isTranscriptBackgroundsEnabled];

      if (isTranscriptBackgroundsEnabled)
      {
        v49 = [(CKChatController *)self setBackgroundActionForChatItem:itemCopy];
        __93__CKChatController_ClickyOrbConformance___menuForChatItem_withParentChatItem_menuAppearance___block_invoke(v49, v49, array);
      }

      v50 = [(CKChatController *)self _moreActionForChatItem:itemCopy];
      __93__CKChatController_ClickyOrbConformance___menuForChatItem_withParentChatItem_menuAppearance___block_invoke(v50, v50, array);

      standardUserDefaults = [MEMORY[0x1E695E000] standardUserDefaults];
      v52 = [standardUserDefaults BOOLForKey:@"CKInternalInstallShouldHideDebugMenu"];

      mEMORY[0x1E69A60F0] = [MEMORY[0x1E69A60F0] sharedInstance];
      isInternalInstall = [mEMORY[0x1E69A60F0] isInternalInstall];

      if (!(v52 & 1 | ((isInternalInstall & 1) == 0)))
      {
        v55 = [(CKChatController *)self _internalMenuForChatItem:itemCopy];
        [array addObject:v55];
      }

      v56 = [array count];
      if (v56)
      {
        v56 = [MEMORY[0x1E69DCC60] menuWithTitle:&stru_1F04268F8 children:array];
      }

      v12 = v56;
    }
  }

  return v12;
}

void __93__CKChatController_ClickyOrbConformance___menuForChatItem_withParentChatItem_menuAppearance___block_invoke(uint64_t a1, void *a2, void *a3)
{
  v5 = a2;
  v4 = a3;
  if (v5)
  {
    objc_opt_class();
    if (objc_opt_isKindOfClass())
    {
      [v4 addObjectsFromArray:v5];
    }

    else
    {
      [v4 addObject:v5];
    }
  }
}

void __93__CKChatController_ClickyOrbConformance___menuForChatItem_withParentChatItem_menuAppearance___block_invoke_2(uint64_t a1)
{
  WeakRetained = objc_loadWeakRetained((a1 + 40));
  [WeakRetained actionEditIsTappedForChatItem:*(a1 + 32)];
}

- (BOOL)_shouldConfigureChatItemMenuForCommSafety:(id)safety
{
  v39 = *MEMORY[0x1E69E9840];
  safetyCopy = safety;
  mEMORY[0x1E69A7FC8] = [MEMORY[0x1E69A7FC8] sharedManager];
  isFeatureEnabled = [mEMORY[0x1E69A7FC8] isFeatureEnabled];

  if (isFeatureEnabled && (([safetyCopy supportsCommunicationSafety] & 1) != 0 || (objc_msgSend(safetyCopy, "visibleAssociatedMessageChatItems"), v5 = objc_claimAutoreleasedReturnValue(), v6 = objc_msgSend(v5, "count"), v5, v6)))
  {
    mEMORY[0x1E69A5B80] = [MEMORY[0x1E69A5B80] sharedInstance];
    commSafetyTransferGUID = [safetyCopy commSafetyTransferGUID];
    v24 = [mEMORY[0x1E69A5B80] transferForGUID:commSafetyTransferGUID];

    if ([CKCommSafetyHelper shouldDisableTranscriptCapabilitiesForFileTransfer:v24])
    {
LABEL_22:
      v22 = 1;
    }

    else
    {
      v36 = 0u;
      v37 = 0u;
      v34 = 0u;
      v35 = 0u;
      visibleAssociatedMessageChatItems = [safetyCopy visibleAssociatedMessageChatItems];
      v9 = [visibleAssociatedMessageChatItems countByEnumeratingWithState:&v34 objects:v38 count:16];
      if (v9)
      {
        v10 = *v35;
        while (2)
        {
          for (i = 0; i != v9; ++i)
          {
            if (*v35 != v10)
            {
              objc_enumerationMutation(visibleAssociatedMessageChatItems);
            }

            v12 = *(*(&v34 + 1) + 8 * i);
            supportsCommunicationSafety = [v12 supportsCommunicationSafety];
            commSafetyTransferGUID2 = [v12 commSafetyTransferGUID];
            if (commSafetyTransferGUID2)
            {
              v15 = supportsCommunicationSafety;
            }

            else
            {
              v15 = 0;
            }

            if (v15 == 1)
            {
              mEMORY[0x1E69A5B80]2 = [MEMORY[0x1E69A5B80] sharedInstance];
              commSafetyTransferGUID3 = [v12 commSafetyTransferGUID];
              v18 = [mEMORY[0x1E69A5B80]2 transferForGUID:commSafetyTransferGUID3];

              LOBYTE(mEMORY[0x1E69A5B80]2) = [CKCommSafetyHelper shouldDisableTranscriptCapabilitiesForFileTransfer:v18];
              if (mEMORY[0x1E69A5B80]2)
              {

                goto LABEL_22;
              }
            }
          }

          v9 = [visibleAssociatedMessageChatItems countByEnumeratingWithState:&v34 objects:v38 count:16];
          if (v9)
          {
            continue;
          }

          break;
        }
      }

      v30 = 0;
      v31 = &v30;
      v32 = 0x2020000000;
      v33 = 0;
      objc_opt_class();
      if (objc_opt_isKindOfClass())
      {
        v19 = safetyCopy;
        aBlock[0] = MEMORY[0x1E69E9820];
        aBlock[1] = 3221225472;
        aBlock[2] = __84__CKChatController_ClickyOrbConformance___shouldConfigureChatItemMenuForCommSafety___block_invoke;
        aBlock[3] = &unk_1E72EBF70;
        v29 = mEMORY[0x1E69A5B80];
        v20 = _Block_copy(aBlock);
        text = [v19 text];
        v27[0] = MEMORY[0x1E69E9820];
        v27[1] = 3221225472;
        v27[2] = __84__CKChatController_ClickyOrbConformance___shouldConfigureChatItemMenuForCommSafety___block_invoke_2;
        v27[3] = &unk_1E72EBF98;
        v27[4] = &v30;
        [text __im_enumerateAdaptiveImageGlyphFileTransfersUsingFileTransferProvider:v20 block:v27];
      }

      v22 = *(v31 + 24);
      _Block_object_dispose(&v30, 8);
    }
  }

  else
  {
    v22 = 0;
  }

  return v22 & 1;
}

BOOL __84__CKChatController_ClickyOrbConformance___shouldConfigureChatItemMenuForCommSafety___block_invoke_2(uint64_t a1, uint64_t a2, uint64_t a3, uint64_t a4, _BYTE *a5)
{
  result = [CKCommSafetyHelper shouldDisableTranscriptCapabilitiesForFileTransfer:a2];
  *(*(*(a1 + 32) + 8) + 24) = result;
  if (*(*(*(a1 + 32) + 8) + 24) == 1)
  {
    *a5 = 1;
  }

  return result;
}

- (id)_highlightActionForChatItem:(id)item
{
  itemCopy = item;
  if ([itemCopy syndicationBehavior] == 1 && (-[CKCoreChatController chat](self, "chat"), v5 = objc_claimAutoreleasedReturnValue(), v6 = objc_msgSend(v5, "isBusinessChat"), v5, (v6 & 1) == 0))
  {
    isHighlighted = [itemCopy isHighlighted];
    v9 = CKFrameworkBundle();
    v10 = v9;
    if (isHighlighted)
    {
      v11 = @"REMOVE_PIN_ACTION";
    }

    else
    {
      v11 = @"ADD_PIN_ACTION";
    }

    v12 = [v9 localizedStringForKey:v11 value:&stru_1F04268F8 table:@"ChatKit"];

    if ([itemCopy isHighlighted])
    {
      v13 = @"pin.slash";
    }

    else
    {
      v13 = @"pin";
    }

    v14 = [MEMORY[0x1E69DCAB8] systemImageNamed:v13];
    objc_initWeak(&location, self);
    v15 = MEMORY[0x1E69DC628];
    v17[0] = MEMORY[0x1E69E9820];
    v17[1] = 3221225472;
    v17[2] = __70__CKChatController_ClickyOrbConformance___highlightActionForChatItem___block_invoke;
    v17[3] = &unk_1E72EBFC0;
    v18 = itemCopy;
    objc_copyWeak(&v20, &location);
    selfCopy = self;
    v7 = [v15 actionWithTitle:v12 image:v14 identifier:0 handler:v17];
    objc_destroyWeak(&v20);

    objc_destroyWeak(&location);
  }

  else
  {
    v7 = 0;
  }

  return v7;
}

void __70__CKChatController_ClickyOrbConformance___highlightActionForChatItem___block_invoke(id *a1)
{
  v2 = [a1[4] isHighlighted];
  WeakRetained = objc_loadWeakRetained(a1 + 6);
  v4 = [WeakRetained conversation];
  v5 = [v4 chat];
  v6 = [a1[4] IMChatItem];
  v7 = [v6 guid];
  v9 = [a1[4] messagePartRange];
  if (v2)
  {
    v10 = 8;
  }

  else
  {
    v10 = 4;
  }

  [v5 sendSyndicationAction:v10 forMessagePartGUID:v7 syndicatedMessagePartRange:{v9, v8}];

  v11 = [a1[4] IMChatItem];
  objc_opt_class();
  isKindOfClass = objc_opt_isKindOfClass();

  if (isKindOfClass)
  {
    v13 = [a1[4] IMChatItem];
    v22 = [v13 messageItem];

    v14 = [v22 swyAppName];
    v15 = [v22 swyBundleID];
    v16 = v15;
    if (v14 && v15)
    {
      v17 = [MEMORY[0x1E69A8288] sharedManager];
      v18 = v17;
      if (v2)
      {
        [v17 decrementPinCountForBundleID:v16];
      }

      else
      {
        [v17 incrementPinCountForBundleID:v16];

        v19 = [MEMORY[0x1E69A8288] sharedManager];
        v20 = [v19 getPinCountForBundleID:v16];

        v21 = [MEMORY[0x1E69A8288] isSharedWithYouEnabledForApplicationWithBundleID:v16];
        if (v20 >= 3 && (v21 & 1) == 0)
        {
          [a1[5] _showAutoDonationAlertForAppName:v14 bundleID:v16];
        }
      }
    }
  }
}

- (void)_showAutoDonationAlertForAppName:(id)name bundleID:(id)d
{
  nameCopy = name;
  dCopy = d;
  if ([nameCopy length] && objc_msgSend(dCopy, "length"))
  {
    v8 = MEMORY[0x1E696AEC0];
    v9 = CKFrameworkBundle();
    v10 = [v9 localizedStringForKey:@"SHARED_WITH_YOU_AUTO_DONATION_ALERT" value:&stru_1F04268F8 table:@"ChatKit"];
    nameCopy = [v8 stringWithFormat:v10, nameCopy, nameCopy];

    mEMORY[0x1E69DC668] = [MEMORY[0x1E69DC668] sharedApplication];
    userInterfaceLayoutDirection = [mEMORY[0x1E69DC668] userInterfaceLayoutDirection];

    if (userInterfaceLayoutDirection == 1)
    {
      v14 = @"\u200F";
    }

    else
    {
      v14 = @"\u200E";
    }

    v15 = [(__CFString *)v14 stringByAppendingString:nameCopy];

    v16 = [CKAlertController alertControllerWithTitle:v15 message:0 preferredStyle:0];
    v17 = CKFrameworkBundle();
    v18 = [v17 localizedStringForKey:@"SHARED_WITH_YOU_OK_TITLE" value:&stru_1F04268F8 table:@"ChatKit"];
    v23[0] = MEMORY[0x1E69E9820];
    v23[1] = 3221225472;
    v23[2] = __84__CKChatController_ClickyOrbConformance___showAutoDonationAlertForAppName_bundleID___block_invoke;
    v23[3] = &unk_1E72EBFE8;
    v24 = dCopy;
    v19 = [CKAlertAction actionWithTitle:v18 style:0 handler:v23];
    [v16 addAction:v19];

    v20 = CKFrameworkBundle();
    v21 = [v20 localizedStringForKey:@"SHARED_WITH_YOU_CANCEL_TITLE" value:&stru_1F04268F8 table:@"ChatKit"];
    v22 = [CKAlertAction actionWithTitle:v21 style:1 handler:0];
    [v16 addAction:v22];

    [(CKChatController *)self presentViewController:v16 animated:1 completion:0];
  }

  else
  {
    v15 = IMLogHandleForCategory();
    if (os_log_type_enabled(v15, OS_LOG_TYPE_ERROR))
    {
      [(CKChatController(ClickyOrbConformance) *)nameCopy _showAutoDonationAlertForAppName:dCopy bundleID:v15];
    }
  }
}

- (id)_responsesSubmenuForChatItem:(id)item withParentChatItem:(id)chatItem menuAppearance:(int64_t)appearance
{
  itemCopy = item;
  v9 = MEMORY[0x1E695DF70];
  chatItemCopy = chatItem;
  array = [v9 array];
  if (appearance == 2 || CKIsRunningInMacCatalyst())
  {
    v12 = [(CKChatController *)self tapbackMenuElementsForChatItem:itemCopy];
    v13 = v12;
    if (v12 && [v12 count])
    {
      if (CKIsRunningInMacCatalyst())
      {
        [array addObjectsFromArray:v13];
      }

      else
      {
        v14 = [MEMORY[0x1E69DCC60] menuWithTitle:&stru_1F04268F8 image:0 identifier:0 options:1 children:v13];
        [array addObject:v14];
      }
    }
  }

  v15 = [(CKChatController *)self _inlineReplyActionForChatItem:itemCopy];
  if (v15)
  {
    [array addObject:v15];
  }

  collectionViewController = [(CKCoreChatController *)self collectionViewController];
  v17 = [collectionViewController balloonViewForChatItem:chatItemCopy];

  v18 = [(CKChatController *)self _addStickerActionForChatItem:itemCopy parentChatItem:chatItemCopy sourceView:v17];

  if (v18)
  {
    if (CKIsRunningInMessagesViewService())
    {
      [v18 setAttributes:1];
    }

    [array addObject:v18];
  }

  if ([array count])
  {
    v19 = [MEMORY[0x1E69DCC60] menuWithTitle:&stru_1F04268F8 image:0 identifier:0 options:1 children:array];
  }

  else
  {
    v19 = 0;
  }

  return v19;
}

- (id)_inlineReplyActionForChatItem:(id)item
{
  itemCopy = item;
  if ([(CKCoreChatController *)self wantsReplyButton])
  {
    objc_initWeak(&location, self);
    if (CKIsRunningInMacCatalyst())
    {
      v5 = CKFrameworkBundle();
      [v5 localizedStringForKey:@"INLINE_REPLY_MENU" value:&stru_1F04268F8 table:@"ChatKit"];
    }

    else
    {
      v5 = CKFrameworkBundle();
      [v5 localizedStringForKey:@"INLINE_REPLY_ORB_TITLE" value:&stru_1F04268F8 table:@"ChatKit"];
    }
    v7 = ;

    v8 = MEMORY[0x1E69DC628];
    v9 = [MEMORY[0x1E69DCAB8] systemImageNamed:@"arrowshape.turn.up.backward"];
    v11 = MEMORY[0x1E69E9820];
    v12 = 3221225472;
    v13 = __72__CKChatController_ClickyOrbConformance___inlineReplyActionForChatItem___block_invoke;
    v14 = &unk_1E72EBCD8;
    objc_copyWeak(&v15, &location);
    v6 = [v8 actionWithTitle:v7 image:v9 identifier:0 handler:&v11];

    if (([itemCopy canInlineReply] & 1) == 0)
    {
      [v6 setAttributes:1];
    }

    objc_destroyWeak(&v15);

    objc_destroyWeak(&location);
  }

  else
  {
    v6 = 0;
  }

  return v6;
}

void __72__CKChatController_ClickyOrbConformance___inlineReplyActionForChatItem___block_invoke(uint64_t a1)
{
  WeakRetained = objc_loadWeakRetained((a1 + 32));
  v5 = [WeakRetained collectionViewController];

  if (CKIsRunningInMacCatalyst())
  {
    [v5 hideTranscriptTimestampsIfNeeded];
  }

  v3 = [v5 collectionView];
  [v3 beginHoldingContentOffsetUpdatesForReason:@"ChatControllerClickyOrb"];

  v4 = objc_loadWeakRetained((a1 + 32));
  [v4 setWantsInlineOverlay:1];
}

- (BOOL)_shouldShowSaveStickerActionForChatItem:(id)item
{
  v3 = [CKUtilities saveableStickerFromChatItem:item];

  return v3 != 0;
}

- (id)_saveStickerActionForChatItem:(id)item sourceView:(id)view
{
  itemCopy = item;
  viewCopy = view;
  if ([(CKChatController *)self _shouldShowSaveStickerActionForChatItem:itemCopy])
  {
    v8 = CKFrameworkBundle();
    v9 = [v8 localizedStringForKey:@"SAVE_TO_STICKERS" value:&stru_1F04268F8 table:@"ChatKit"];

    v10 = [MEMORY[0x1E69DCAB8] _systemImageNamed:@"square.and.arrow.down"];
    objc_initWeak(&location, self);
    v11 = MEMORY[0x1E69DC628];
    v14[0] = MEMORY[0x1E69E9820];
    v14[1] = 3221225472;
    v14[2] = __83__CKChatController_ClickyOrbConformance___saveStickerActionForChatItem_sourceView___block_invoke;
    v14[3] = &unk_1E72EBFC0;
    v15 = viewCopy;
    objc_copyWeak(&v17, &location);
    v16 = itemCopy;
    v12 = [v11 actionWithTitle:v9 image:v10 identifier:0 handler:v14];

    objc_destroyWeak(&v17);
    objc_destroyWeak(&location);
  }

  else
  {
    v12 = 0;
  }

  return v12;
}

void __83__CKChatController_ClickyOrbConformance___saveStickerActionForChatItem_sourceView___block_invoke(uint64_t a1)
{
  v2 = +[CKUIBehavior sharedBehaviors];
  v3 = [v2 shouldAnimateStickerOnSave];

  if (v3)
  {
    v4 = 0;
  }

  else
  {
    v4 = *(a1 + 32);
  }

  v5 = v4;
  WeakRetained = objc_loadWeakRetained((a1 + 48));
  [WeakRetained saveStickerFromChatItem:*(a1 + 40) pluginSourceView:v5 animateFlyIn:v3];
}

- (id)_addStickerActionForChatItem:(id)item parentChatItem:(id)chatItem sourceView:(id)view
{
  itemCopy = item;
  chatItemCopy = chatItem;
  viewCopy = view;
  mEMORY[0x1E69A8070] = [MEMORY[0x1E69A8070] sharedFeatureFlags];
  isReactWithAStickerEnabled = [mEMORY[0x1E69A8070] isReactWithAStickerEnabled];

  if (!isReactWithAStickerEnabled || [(CKChatController *)self _shouldShowSaveStickerActionForChatItem:itemCopy])
  {
    goto LABEL_11;
  }

  chat = [(CKCoreChatController *)self chat];
  if (![chat supportsCapabilities:0x8000] || !objc_msgSend(itemCopy, "canAttachStickers"))
  {
    goto LABEL_10;
  }

  chat2 = [(CKCoreChatController *)self chat];
  if (([chat2 canSend] & 1) == 0)
  {

LABEL_10:
    goto LABEL_11;
  }

  isReadOnly = [(CKCoreChatController *)self isReadOnly];

  if (!isReadOnly)
  {
    objc_initWeak(&location, self);
    if (CKIsRunningInMacCatalyst())
    {
      v16 = CKFrameworkBundle();
      [v16 localizedStringForKey:@"ATTACH_STICKER_ELLIPSIS" value:&stru_1F04268F8 table:@"ChatKit"];
    }

    else
    {
      v16 = CKFrameworkBundle();
      [v16 localizedStringForKey:@"ATTACH_STICKER" value:&stru_1F04268F8 table:@"ChatKit"];
    }
    v19 = ;

    v20 = MEMORY[0x1E69DC628];
    v21 = [MEMORY[0x1E69DCAB8] _systemImageNamed:@"sticker.badge.plus"];
    v22[0] = MEMORY[0x1E69E9820];
    v22[1] = 3221225472;
    v22[2] = __97__CKChatController_ClickyOrbConformance___addStickerActionForChatItem_parentChatItem_sourceView___block_invoke;
    v22[3] = &unk_1E72EC010;
    objc_copyWeak(&v26, &location);
    v23 = itemCopy;
    v24 = chatItemCopy;
    v25 = viewCopy;
    v17 = [v20 actionWithTitle:v19 image:v21 identifier:0 handler:v22];

    objc_destroyWeak(&v26);
    objc_destroyWeak(&location);
    goto LABEL_12;
  }

LABEL_11:
  v17 = 0;
LABEL_12:

  return v17;
}

void __97__CKChatController_ClickyOrbConformance___addStickerActionForChatItem_parentChatItem_sourceView___block_invoke(uint64_t a1)
{
  v2 = IMStickersExtensionIdentifier();
  v22 = IMBalloonExtensionIDWithSuffix();

  WeakRetained = objc_loadWeakRetained((a1 + 56));
  v4 = [WeakRetained inputController];
  v5 = [v4 appPresentationStyleForShowingPluginID:v22];

  v6 = objc_loadWeakRetained((a1 + 56));
  [v6 setIgnoresAutomaticScrollsTowardBottom:1];

  if (!v5)
  {
    v7 = objc_loadWeakRetained((a1 + 56));
    [v7 updateChatItemBalloonViewAndStickerViews:*(a1 + 32) hidden:1];

    v8 = objc_loadWeakRetained((a1 + 56));
    [v8 showFullScreenBalloonFocusForChatItem:*(a1 + 40)];
  }

  v9 = objc_loadWeakRetained((a1 + 56));
  [v9 dismissKeyboard];

  v10 = objc_loadWeakRetained((a1 + 56));
  v11 = [v10 inputController];
  v12 = *(a1 + 32);
  v13 = objc_loadWeakRetained((a1 + 56));
  v14 = [v13 collectionViewController];
  v15 = [v14 cellForChatItem:*(a1 + 32)];
  [v11 beginStickerReactionSessionWithChatItem:v12 cell:v15];

  v16 = objc_loadWeakRetained((a1 + 56));
  v17 = [v16 inputController];
  [v17 showPluginWithExtensionIdentifier:v22 sourceView:*(a1 + 48)];

  v18 = objc_loadWeakRetained((a1 + 56));
  v19 = [v18 inputController];
  [v19 setStickerPickerMessagePartChatItem:*(a1 + 32)];

  v20 = objc_loadWeakRetained((a1 + 56));
  v21 = [v20 inputController];
  [v21 setStickerPickerMessagePartParentChatItem:*(a1 + 40)];
}

- (id)_addPollDetailsActionForChatItem:(id)item parentChatItem:(id)chatItem sourceView:(id)view
{
  itemCopy = item;
  chatItemCopy = chatItem;
  viewCopy = view;
  mEMORY[0x1E69A8070] = [MEMORY[0x1E69A8070] sharedFeatureFlags];
  isPollsEnabled = [mEMORY[0x1E69A8070] isPollsEnabled];

  if (isPollsEnabled && [(CKChatController *)self _shouldShowPollDetailsActionForChatItem:itemCopy])
  {
    objc_initWeak(&location, self);
    v13 = CKFrameworkBundle();
    v14 = [v13 localizedStringForKey:@"POLL_DETAILS" value:&stru_1F04268F8 table:@"ChatKit"];

    v15 = MEMORY[0x1E69DC628];
    v16 = [MEMORY[0x1E69DCAB8] _systemImageNamed:@"info.circle"];
    v19[0] = MEMORY[0x1E69E9820];
    v19[1] = 3221225472;
    v19[2] = __101__CKChatController_ClickyOrbConformance___addPollDetailsActionForChatItem_parentChatItem_sourceView___block_invoke;
    v19[3] = &unk_1E72EC038;
    objc_copyWeak(&v22, &location);
    v20 = itemCopy;
    v21 = viewCopy;
    v17 = [v15 actionWithTitle:v14 image:v16 identifier:0 handler:v19];

    objc_destroyWeak(&v22);
    objc_destroyWeak(&location);
  }

  else
  {
    v17 = 0;
  }

  return v17;
}

void __101__CKChatController_ClickyOrbConformance___addPollDetailsActionForChatItem_parentChatItem_sourceView___block_invoke(uint64_t a1)
{
  WeakRetained = objc_loadWeakRetained((a1 + 48));
  [WeakRetained displayPollDetailsForChatItem:*(a1 + 32) sourceView:*(a1 + 40)];
}

- (id)_retractionActionForChatItem:(id)item
{
  itemCopy = item;
  objc_initWeak(&location, self);
  if ([itemCopy scheduleType] == 2 && objc_msgSend(itemCopy, "scheduleState") == 2)
  {
    v5 = CKFrameworkBundle();
    v6 = [v5 localizedStringForKey:@"DELETE_SCHEDULED_ACTION" value:&stru_1F04268F8 table:@"ChatKit"];

    v7 = +[CKUIBehavior sharedBehaviors];
    contextMenuCancelScheduledMessageIcon = [v7 contextMenuCancelScheduledMessageIcon];

    v9 = MEMORY[0x1E69DC628];
    v20[0] = MEMORY[0x1E69E9820];
    v20[1] = 3221225472;
    v20[2] = __71__CKChatController_ClickyOrbConformance___retractionActionForChatItem___block_invoke;
    v20[3] = &unk_1E72EBF48;
    v10 = &v22;
    objc_copyWeak(&v22, &location);
    v21 = itemCopy;
    v11 = [v9 actionWithTitle:v6 image:contextMenuCancelScheduledMessageIcon identifier:0 handler:v20];
    v12 = &v21;
    if (!CKIsRunningInMacCatalyst())
    {
      [v11 setAttributes:2];
    }
  }

  else
  {
    v13 = CKFrameworkBundle();
    v6 = [v13 localizedStringForKey:@"UNDO_SEND_ACTION" value:&stru_1F04268F8 table:@"ChatKit"];

    v14 = +[CKUIBehavior sharedBehaviors];
    contextMenuCancelScheduledMessageIcon = [v14 contextMenuUndoSendIcon];

    v15 = MEMORY[0x1E69DC628];
    v17[0] = MEMORY[0x1E69E9820];
    v17[1] = 3221225472;
    v17[2] = __71__CKChatController_ClickyOrbConformance___retractionActionForChatItem___block_invoke_2;
    v17[3] = &unk_1E72EBF48;
    v10 = &v19;
    objc_copyWeak(&v19, &location);
    v18 = itemCopy;
    v11 = [v15 actionWithTitle:v6 image:contextMenuCancelScheduledMessageIcon identifier:0 handler:v17];
    v12 = &v18;
  }

  objc_destroyWeak(v10);
  objc_destroyWeak(&location);

  return v11;
}

void __71__CKChatController_ClickyOrbConformance___retractionActionForChatItem___block_invoke(uint64_t a1)
{
  WeakRetained = objc_loadWeakRetained((a1 + 40));
  [WeakRetained actionCancelIsTappedForChatItem:*(a1 + 32)];
}

void __71__CKChatController_ClickyOrbConformance___retractionActionForChatItem___block_invoke_2(uint64_t a1)
{
  WeakRetained = objc_loadWeakRetained((a1 + 40));
  [WeakRetained actionRetractIsTappedForChatItem:*(a1 + 32)];
}

- (void)showFullScreenBalloonFocusForChatItem:(id)item
{
  v27 = *MEMORY[0x1E69E9840];
  itemCopy = item;
  if (IMOSLoggingEnabled())
  {
    v5 = OSLogHandleForIMFoundationCategory();
    if (os_log_type_enabled(v5, OS_LOG_TYPE_INFO))
    {
      v25 = 138412290;
      v26 = itemCopy;
      _os_log_impl(&dword_19020E000, v5, OS_LOG_TYPE_INFO, "showFullScreenBalloonFocusForChatItem, chatItem: %@", &v25, 0xCu);
    }
  }

  chat = [(CKCoreChatController *)self chat];
  [chat beginHoldingChatItemsUpdatesForReason:*MEMORY[0x1E69A57A0]];
  [(CKScrollViewController *)self beginHoldingScrollGeometryUpdatesForReason:@"FullscreenBalloonMenuVisible"];
  inputController = [(CKCoreChatController *)self inputController];
  isAppCardPresented = [inputController isAppCardPresented];

  v9 = [CKFullScreenBalloonViewDisplayConfiguration addStickerContextDismissingAppCardOnExit:isAppCardPresented ^ 1u];
  v10 = [(CKCoreChatController *)self generateFullScreenBalloonViewControllerWithChatItem:itemCopy displayConfiguration:v9];
  [(CKCoreChatController *)self setFullScreenBalloonViewController:v10];
  v11 = +[CKUIBehavior sharedBehaviors];
  if ([v11 canPresentOverKeyboard])
  {
    v12 = 0;
  }

  else
  {
    v12 = 6;
  }

  [v10 setModalPresentationStyle:v12];

  [(CKChatController *)self addChildViewController:v10];
  view = [(CKChatController *)self view];
  view2 = [v10 view];
  [view addSubview:view2];

  [v10 didMoveToParentViewController:self];
  view3 = [(CKChatController *)self view];
  [view3 bounds];
  v17 = v16;
  view4 = [(CKChatController *)self view];
  [view4 bounds];
  v20 = v19;
  view5 = [v10 view];
  [view5 setFrame:{0.0, 0.0, v17, v20}];

  view6 = [v10 view];
  [view6 setNeedsLayout];

  view7 = [v10 view];
  [view7 layoutIfNeeded];

  if (![(CKCoreChatController *)self isInline])
  {
    [(CKChatController *)self _updateNavigationButtons];
  }

  if (IMOSLoggingEnabled())
  {
    v24 = OSLogHandleForIMFoundationCategory();
    if (os_log_type_enabled(v24, OS_LOG_TYPE_INFO))
    {
      LOWORD(v25) = 0;
      _os_log_impl(&dword_19020E000, v24, OS_LOG_TYPE_INFO, "showFullScreenBalloonFocusForChatItem: _fullScreenBalloonViewController has been presented", &v25, 2u);
    }
  }
}

- (id)_forwardAndCopyMenuForChatItem:(id)item
{
  v3 = [(CKChatController *)self _forwardAndCopyActionsForChatItem:item];
  if ([v3 count])
  {
    v4 = [MEMORY[0x1E69DCC60] menuWithTitle:&stru_1F04268F8 image:0 identifier:0 options:1 children:v3];
  }

  else
  {
    v4 = 0;
  }

  return v4;
}

- (id)_forwardAndCopyActionsForChatItem:(id)item
{
  itemCopy = item;
  array = [MEMORY[0x1E695DF70] array];
  v6 = [(CKChatController *)self _forwardActionForChatItem:itemCopy];
  if (v6)
  {
    [array addObject:v6];
  }

  v7 = [(CKChatController *)self _copyActionForChatItem:itemCopy shouldUseTopMostChatItemIfAggregateChatItem:1];
  if (v7)
  {
    [array addObject:v7];
  }

  if (CKIsRunningInMacCatalyst())
  {
    objc_opt_class();
    if (objc_opt_isKindOfClass())
    {
      v8 = [(CKChatController *)self _copyActionForChatItem:itemCopy shouldUseTopMostChatItemIfAggregateChatItem:0];
      if (v8)
      {
        [array addObject:v8];
      }
    }
  }

  return array;
}

- (id)_forwardActionForChatItem:(id)item
{
  itemCopy = item;
  objc_initWeak(&location, self);
  if (CKIsRunningInMacCatalyst() && !-[CKCoreChatController isInline](self, "isInline") && [itemCopy canForward])
  {
    v5 = MEMORY[0x1E69DC628];
    v6 = CKFrameworkBundle();
    v7 = [v6 localizedStringForKey:@"FORWARD_ELLIPSIS" value:&stru_1F04268F8 table:@"ChatKit"];
    v8 = [MEMORY[0x1E69DCAB8] systemImageNamed:@"arrowshape.turn.up.forward"];
    v11[0] = MEMORY[0x1E69E9820];
    v11[1] = 3221225472;
    v11[2] = __68__CKChatController_ClickyOrbConformance___forwardActionForChatItem___block_invoke;
    v11[3] = &unk_1E72EBF48;
    objc_copyWeak(&v13, &location);
    v12 = itemCopy;
    v9 = [v5 actionWithTitle:v7 image:v8 identifier:0 handler:v11];

    objc_destroyWeak(&v13);
  }

  else
  {
    v9 = 0;
  }

  objc_destroyWeak(&location);

  return v9;
}

void __68__CKChatController_ClickyOrbConformance___forwardActionForChatItem___block_invoke(uint64_t a1)
{
  v25[1] = *MEMORY[0x1E69E9840];
  WeakRetained = objc_loadWeakRetained((a1 + 40));
  [WeakRetained setIsShowingPreview:0];

  v3 = +[CKUIBehavior sharedBehaviors];
  v4 = [v3 enableBalloonTextSelection];

  if (v4)
  {
    v5 = objc_loadWeakRetained((a1 + 40));
    v6 = [v5 collectionViewController];
    v7 = [v6 selectedChatItems];

    if (![v7 count])
    {
      v25[0] = *(a1 + 32);
      v8 = [MEMORY[0x1E695DEC8] arrayWithObjects:v25 count:1];

      v7 = v8;
    }

    v9 = objc_loadWeakRetained((a1 + 40));
    v10 = [v9 entryView];
    v11 = [v10 shouldShowSubject];
    v12 = objc_loadWeakRetained((a1 + 40));
    v13 = [v12 chatInputTranscriptIdentifier];
    v14 = [CKComposition compositionForMessageParts:v7 preserveSubject:v11 contextIdentifier:v13];

    v15 = objc_loadWeakRetained((a1 + 40));
    v16 = [v15 delegate];
    v17 = objc_loadWeakRetained((a1 + 40));
    [v16 chatController:v17 forwardComposition:v14];
  }

  else
  {
    v24 = *(a1 + 32);
    v18 = [MEMORY[0x1E695DEC8] arrayWithObjects:&v24 count:1];
    v19 = objc_loadWeakRetained((a1 + 40));
    v20 = [v19 entryView];
    v21 = [v20 shouldShowSubject];
    v22 = objc_loadWeakRetained((a1 + 40));
    v23 = [v22 chatInputTranscriptIdentifier];
    v7 = [CKComposition compositionForMessageParts:v18 preserveSubject:v21 contextIdentifier:v23];

    v14 = objc_loadWeakRetained((a1 + 40));
    v15 = [v14 delegate];
    v16 = objc_loadWeakRetained((a1 + 40));
    [v15 chatController:v16 forwardComposition:v7];
  }
}

- (id)_copyActionForChatItem:(id)item shouldUseTopMostChatItemIfAggregateChatItem:(BOOL)chatItem
{
  chatItemCopy = chatItem;
  v35 = *MEMORY[0x1E69E9840];
  itemCopy = item;
  if ([itemCopy canCopy])
  {
    v7 = itemCopy;
    if (chatItemCopy)
    {
      objc_opt_class();
      if (objc_opt_isKindOfClass())
      {
        v8 = [(CKChatController *)self currentTopChatItemForAggregateChatItem:v7];

        v7 = v8;
      }
    }

    v9 = CKFrameworkBundle();
    v10 = [v9 localizedStringForKey:@"COPY" value:&stru_1F04268F8 table:@"ChatKit"];

    if (!chatItemCopy)
    {
      objc_opt_class();
      if (objc_opt_isKindOfClass())
      {
        selfCopy = self;
        v27 = v10;
        v30 = 0u;
        v31 = 0u;
        v32 = 0u;
        v33 = 0u;
        v25 = v7;
        mediaObjects = [v25 mediaObjects];
        v12 = [mediaObjects countByEnumeratingWithState:&v30 objects:v34 count:16];
        if (v12)
        {
          v13 = v12;
          v14 = 0;
          v15 = 0;
          v16 = 0;
          v17 = *v31;
          do
          {
            for (i = 0; i != v13; ++i)
            {
              if (*v31 != v17)
              {
                objc_enumerationMutation(mediaObjects);
              }

              v19 = *(*(&v30 + 1) + 8 * i);
              if ([v19 mediaType] == 2)
              {
                ++v15;
              }

              else if ([v19 mediaType] == 3)
              {
                ++v14;
              }

              else
              {
                ++v16;
              }
            }

            v13 = [mediaObjects countByEnumeratingWithState:&v30 objects:v34 count:16];
          }

          while (v13);
        }

        else
        {
          v14 = 0;
          v15 = 0;
          v16 = 0;
        }

        v10 = [(CKChatController *)selfCopy _localizedTitleStringForAggregateAction:0 numberOfPhotos:v14 numberOfVideos:v15 numberOfOther:v16];
      }
    }

    v21 = [MEMORY[0x1E69DCAB8] systemImageNamed:@"doc.on.doc"];
    v22 = MEMORY[0x1E69DC628];
    v28[0] = MEMORY[0x1E69E9820];
    v28[1] = 3221225472;
    v28[2] = __109__CKChatController_ClickyOrbConformance___copyActionForChatItem_shouldUseTopMostChatItemIfAggregateChatItem___block_invoke;
    v28[3] = &unk_1E72EC060;
    v29 = v7;
    v23 = v7;
    v20 = [v22 actionWithTitle:v10 image:v21 identifier:0 handler:v28];
  }

  else
  {
    v20 = 0;
  }

  return v20;
}

void __109__CKChatController_ClickyOrbConformance___copyActionForChatItem_shouldUseTopMostChatItemIfAggregateChatItem___block_invoke(uint64_t a1)
{
  v2 = [*(a1 + 32) pasteboardItemProviders];
  v1 = [MEMORY[0x1E69DCD50] generalPasteboard];
  [v1 setItemProviders:v2];
}

- (id)_deleteMenuForChatItem:(id)item
{
  v3 = [(CKChatController *)self _deleteActionsForChatItem:item];
  if ([v3 count])
  {
    v4 = [MEMORY[0x1E69DCC60] menuWithTitle:&stru_1F04268F8 image:0 identifier:0 options:1 children:v3];
  }

  else
  {
    v4 = 0;
  }

  return v4;
}

- (id)_deleteActionsForChatItem:(id)item
{
  itemCopy = item;
  array = [MEMORY[0x1E695DF70] array];
  v6 = [(CKChatController *)self _deleteActionForChatItem:itemCopy shouldUseTopMostChatItemIfAggregateChatItem:1];
  if (v6)
  {
    [array addObject:v6];
  }

  if (CKIsRunningInMacCatalyst())
  {
    objc_opt_class();
    if (objc_opt_isKindOfClass())
    {
      v7 = [(CKChatController *)self _deleteActionForChatItem:itemCopy shouldUseTopMostChatItemIfAggregateChatItem:0];
      if (v7)
      {
        [array addObject:v7];
      }
    }
  }

  return array;
}

- (id)_deleteActionForChatItem:(id)item shouldUseTopMostChatItemIfAggregateChatItem:(BOOL)chatItem
{
  chatItemCopy = chatItem;
  v35 = *MEMORY[0x1E69E9840];
  itemCopy = item;
  v6 = itemCopy;
  if (chatItemCopy)
  {
    objc_opt_class();
    v6 = itemCopy;
    if (objc_opt_isKindOfClass())
    {
      v6 = [(CKChatController *)self currentTopChatItemForAggregateChatItem:itemCopy];
    }
  }

  if (v6)
  {
    v7 = CKFrameworkBundle();
    v25 = [v7 localizedStringForKey:@"DELETE_ELLIPSIS" value:&stru_1F04268F8 table:@"ChatKit"];

    if (!chatItemCopy)
    {
      objc_opt_class();
      if (objc_opt_isKindOfClass())
      {
        v30 = 0u;
        v31 = 0u;
        v32 = 0u;
        v33 = 0u;
        v23 = v6;
        mediaObjects = [v23 mediaObjects];
        v9 = 0;
        v10 = 0;
        v11 = 0;
        v12 = [mediaObjects countByEnumeratingWithState:&v30 objects:v34 count:16];
        if (v12)
        {
          v13 = *v31;
          do
          {
            for (i = 0; i != v12; ++i)
            {
              if (*v31 != v13)
              {
                objc_enumerationMutation(mediaObjects);
              }

              v15 = *(*(&v30 + 1) + 8 * i);
              if ([v15 mediaType] == 2)
              {
                ++v10;
              }

              else if ([v15 mediaType] == 3)
              {
                ++v9;
              }

              else
              {
                ++v11;
              }
            }

            v12 = [mediaObjects countByEnumeratingWithState:&v30 objects:v34 count:16];
          }

          while (v12);
        }

        v16 = [(CKChatController *)self _localizedTitleStringForAggregateAction:1 numberOfPhotos:v9 numberOfVideos:v10 numberOfOther:v11];

        v25 = v16;
      }
    }

    v17 = [MEMORY[0x1E69DCAB8] systemImageNamed:@"trash"];
    objc_initWeak(&location, self);
    v18 = MEMORY[0x1E69DC628];
    v26[0] = MEMORY[0x1E69E9820];
    v26[1] = 3221225472;
    v26[2] = __111__CKChatController_ClickyOrbConformance___deleteActionForChatItem_shouldUseTopMostChatItemIfAggregateChatItem___block_invoke;
    v26[3] = &unk_1E72EBF48;
    objc_copyWeak(&v28, &location);
    v27 = v6;
    v19 = [v18 actionWithTitle:v25 image:v17 identifier:0 handler:v26];
    [v19 setAttributes:2];

    objc_destroyWeak(&v28);
    objc_destroyWeak(&location);

    v20 = v25;
  }

  else
  {
    v21 = IMLogHandleForCategory();
    v20 = v21;
    if (os_log_type_enabled(v21, OS_LOG_TYPE_ERROR))
    {
      [CKChatController(ClickyOrbConformance) _deleteActionForChatItem:shouldUseTopMostChatItemIfAggregateChatItem:];
      v19 = 0;
      v20 = v21;
    }

    else
    {
      v19 = 0;
    }
  }

  return v19;
}

void __111__CKChatController_ClickyOrbConformance___deleteActionForChatItem_shouldUseTopMostChatItemIfAggregateChatItem___block_invoke(uint64_t a1)
{
  v5[1] = *MEMORY[0x1E69E9840];
  WeakRetained = objc_loadWeakRetained((a1 + 40));
  v3 = [WeakRetained collectionViewController];
  v5[0] = *(a1 + 32);
  v4 = [MEMORY[0x1E695DEC8] arrayWithObjects:v5 count:1];
  [v3 deleteChatItems:v4 sender:0];
}

- (id)_exportMenuForChatItem:(id)item
{
  v3 = [(CKChatController *)self _exportActionsForChatItem:item];
  if ([v3 count])
  {
    v4 = [MEMORY[0x1E69DCC60] menuWithTitle:&stru_1F04268F8 image:0 identifier:0 options:1 children:v3];
  }

  else
  {
    v4 = 0;
  }

  return v4;
}

- (id)_exportActionsForChatItem:(id)item
{
  itemCopy = item;
  array = [MEMORY[0x1E695DF70] array];
  v6 = [(CKChatController *)self _exportActionForChatItem:itemCopy shouldUseTopMostChatItemIfAggregateChatItem:1];
  if (v6)
  {
    [array addObject:v6];
  }

  if (CKIsRunningInMacCatalyst())
  {
    objc_opt_class();
    if (objc_opt_isKindOfClass())
    {
      v7 = [(CKChatController *)self _exportActionForChatItem:itemCopy shouldUseTopMostChatItemIfAggregateChatItem:0];
      if (v7)
      {
        [array addObject:v7];
      }
    }
  }

  return array;
}

- (id)_exportActionForChatItem:(id)item shouldUseTopMostChatItemIfAggregateChatItem:(BOOL)chatItem
{
  chatItemCopy = chatItem;
  v54 = *MEMORY[0x1E69E9840];
  itemCopy = item;
  v40 = [MEMORY[0x1E69DCAB8] systemImageNamed:@"square.and.arrow.down"];
  if (![itemCopy canExport])
  {
    v9 = 0;
    goto LABEL_49;
  }

  v5 = itemCopy;
  if (chatItemCopy && (objc_opt_class(), (objc_opt_isKindOfClass() & 1) != 0))
  {
    v6 = [(CKChatController *)self currentTopChatItemForAggregateChatItem:v5];

    if (IMOSLoggingEnabled())
    {
      v7 = OSLogHandleForIMFoundationCategory();
      if (os_log_type_enabled(v7, OS_LOG_TYPE_INFO))
      {
        *buf = 138412290;
        v53 = v5;
        _os_log_impl(&dword_19020E000, v7, OS_LOG_TYPE_INFO, "Request to export top-most chat item for chatItem: %@", buf, 0xCu);
      }
    }

    if (IMOSLoggingEnabled())
    {
      v8 = OSLogHandleForIMFoundationCategory();
      if (os_log_type_enabled(v8, OS_LOG_TYPE_INFO))
      {
        *buf = 138412290;
        v53 = v6;
        _os_log_impl(&dword_19020E000, v8, OS_LOG_TYPE_INFO, "Request to export top-most chat item for chatItemToExport: %@", buf, 0xCu);
      }
    }
  }

  else
  {
    v6 = v5;
  }

  objc_opt_class();
  if (objc_opt_isKindOfClass())
  {
    v10 = v6;
    mediaObjects = [v10 mediaObjects];
    momentShareURL = [v10 momentShareURL];
  }

  else
  {
    objc_opt_class();
    if (objc_opt_isKindOfClass())
    {
      v10 = v6;
      mediaObject = [v10 mediaObject];
      v12 = mediaObject;
      if (mediaObject)
      {
        v51 = mediaObject;
        mediaObjects = [MEMORY[0x1E695DEC8] arrayWithObjects:&v51 count:1];
        momentShareURL = CKMomentShareURLForMediaObjects(mediaObjects);
      }

      else
      {
        v13 = IMLogHandleForCategory();
        if (os_log_type_enabled(v13, OS_LOG_TYPE_ERROR))
        {
          [CKChatController(ClickyOrbConformance) _exportActionForChatItem:shouldUseTopMostChatItemIfAggregateChatItem:];
        }

        momentShareURL = 0;
        mediaObjects = 0;
      }
    }

    else
    {
      v10 = IMLogHandleForCategory();
      if (os_log_type_enabled(v10, OS_LOG_TYPE_ERROR))
      {
        [CKChatController(ClickyOrbConformance) _exportActionForChatItem:shouldUseTopMostChatItemIfAggregateChatItem:];
      }

      momentShareURL = 0;
      mediaObjects = 0;
    }
  }

  objc_opt_class();
  if ((objc_opt_isKindOfClass() & 1) == 0)
  {
    if (CKIsRunningInMacCatalyst())
    {
      v48 = 0u;
      v49 = 0u;
      v46 = 0u;
      v47 = 0u;
      v17 = mediaObjects;
      v18 = [v17 countByEnumeratingWithState:&v46 objects:v50 count:16];
      if (v18)
      {
        v19 = 0;
        v20 = 0;
        v21 = 0;
        v22 = *v47;
        do
        {
          for (i = 0; i != v18; ++i)
          {
            if (*v47 != v22)
            {
              objc_enumerationMutation(v17);
            }

            v24 = *(*(&v46 + 1) + 8 * i);
            if ([v24 mediaType] == 2)
            {
              ++v20;
            }

            else if ([v24 mediaType] == 3)
            {
              ++v19;
            }

            else
            {
              ++v21;
            }
          }

          v18 = [v17 countByEnumeratingWithState:&v46 objects:v50 count:16];
        }

        while (v18);

        if (v21)
        {
          v16 = CKFrameworkBundle();
          v25 = [v16 localizedStringForKey:@"SAVE_TO_DOWNLOADS" value:&stru_1F04268F8 table:@"ChatKit"];
LABEL_47:
          v15 = v25;
          goto LABEL_48;
        }
      }

      else
      {

        v20 = 0;
        v19 = 0;
      }

      if (!chatItemCopy)
      {
        if (v20)
        {
          v31 = 1;
        }

        else
        {
          v31 = v19 == 0;
        }

        if (v19 == 0 && v20 != 0)
        {
          v32 = @"_VIDEOS";
        }

        else
        {
          v32 = @"_ITEMS";
        }

        if (v31)
        {
          v33 = v32;
        }

        else
        {
          v33 = @"_PHOTOS";
        }

        v16 = [@"ADD_ALL_TO_PHOTOS_LIBRARY" stringByAppendingFormat:v33];
        v34 = CKFrameworkBundle();
        v15 = [v34 localizedStringForKey:v16 value:&stru_1F04268F8 table:@"ChatKit"];

        v35 = [MEMORY[0x1E69DCAB8] systemImageNamed:@"square.and.arrow.down.on.square"];

        v40 = v35;
        goto LABEL_48;
      }

      v16 = CKFrameworkBundle();
      v25 = [v16 localizedStringForKey:@"ADD_TO_PHOTOS_LIBRARY" value:&stru_1F04268F8 table:@"ChatKit"];
      goto LABEL_47;
    }

    v16 = CKFrameworkBundle();
    v25 = [v16 localizedStringForKey:@"BALLOON_EXPORT_CALLOUT" value:&stru_1F04268F8 table:@"ChatKit"];
    goto LABEL_47;
  }

  v14 = CKFrameworkBundle();
  v15 = [v14 localizedStringForKey:@"AUDIO_MESSAGE_SAVE" value:&stru_1F04268F8 table:@"ChatKit"];

  [MEMORY[0x1E69DCAB8] systemImageNamed:@"waveform.badge.plus"];
  v40 = v16 = v40;
LABEL_48:

  v26 = MEMORY[0x1E69DC628];
  v41[0] = MEMORY[0x1E69E9820];
  v41[1] = 3221225472;
  v41[2] = __111__CKChatController_ClickyOrbConformance___exportActionForChatItem_shouldUseTopMostChatItemIfAggregateChatItem___block_invoke;
  v41[3] = &unk_1E72EC0B0;
  v42 = v6;
  v43 = mediaObjects;
  v44 = momentShareURL;
  selfCopy = self;
  v27 = momentShareURL;
  v28 = mediaObjects;
  v29 = v6;
  v9 = [v26 actionWithTitle:v15 image:v40 identifier:0 handler:v41];

LABEL_49:

  return v9;
}

void __111__CKChatController_ClickyOrbConformance___exportActionForChatItem_shouldUseTopMostChatItemIfAggregateChatItem___block_invoke(uint64_t a1, void *a2)
{
  v15 = *MEMORY[0x1E69E9840];
  v3 = a2;
  v4 = [*(a1 + 32) canPerformQuickAction];
  v5 = IMOSLoggingEnabled();
  if (v4)
  {
    if (v5)
    {
      v6 = OSLogHandleForIMFoundationCategory();
      if (os_log_type_enabled(v6, OS_LOG_TYPE_INFO))
      {
        v7 = [*(a1 + 40) count];
        *buf = 134217984;
        v14 = v7;
        _os_log_impl(&dword_19020E000, v6, OS_LOG_TYPE_INFO, "Will quick save %tu items", buf, 0xCu);
      }
    }

    v8 = [CKUtilities quickSaveConfirmationAlertForMediaObjects:*(a1 + 40) momentShareURL:*(a1 + 48) popoverSource:0 metricsSource:*MEMORY[0x1E69A7658] cancelHandler:0 preSaveHandler:0 postSaveHandler:0 postAnyActionHandler:0];
    if (v8)
    {
      [*(a1 + 56) presentViewController:v8 animated:1 completion:0];
    }
  }

  else
  {
    if (v5)
    {
      v9 = OSLogHandleForIMFoundationCategory();
      if (os_log_type_enabled(v9, OS_LOG_TYPE_INFO))
      {
        v10 = [*(a1 + 40) count];
        *buf = 134217984;
        v14 = v10;
        _os_log_impl(&dword_19020E000, v9, OS_LOG_TYPE_INFO, "Will save %tu items", buf, 0xCu);
      }
    }

    v8 = [[CKMediaObjectExportManager alloc] initWithMediaObjects:*(a1 + 40)];
    [(CKMediaObjectExportManager *)v8 setMetricsSource:*MEMORY[0x1E69A7658]];
    v11[0] = MEMORY[0x1E69E9820];
    v11[1] = 3221225472;
    v11[2] = __111__CKChatController_ClickyOrbConformance___exportActionForChatItem_shouldUseTopMostChatItemIfAggregateChatItem___block_invoke_412;
    v11[3] = &unk_1E72EC088;
    v12 = *(a1 + 40);
    [(CKMediaObjectExportManager *)v8 exportQueuedMediaObjectsWithCompletion:v11];
  }
}

void __111__CKChatController_ClickyOrbConformance___exportActionForChatItem_shouldUseTopMostChatItemIfAggregateChatItem___block_invoke_412(uint64_t a1, int a2, void *a3)
{
  v11 = *MEMORY[0x1E69E9840];
  v5 = a3;
  if (a2)
  {
    if (IMOSLoggingEnabled())
    {
      v6 = OSLogHandleForIMFoundationCategory();
      if (os_log_type_enabled(v6, OS_LOG_TYPE_INFO))
      {
        v7 = [*(a1 + 32) count];
        v9 = 134217984;
        v10 = v7;
        _os_log_impl(&dword_19020E000, v6, OS_LOG_TYPE_INFO, "Successfully saved %tu items", &v9, 0xCu);
      }
    }
  }

  else
  {
    v8 = IMLogHandleForCategory();
    if (os_log_type_enabled(v8, OS_LOG_TYPE_ERROR))
    {
      __111__CKChatController_ClickyOrbConformance___exportActionForChatItem_shouldUseTopMostChatItemIfAggregateChatItem___block_invoke_412_cold_1(v5, a1, v8);
    }
  }
}

- (id)_downgradeMessageActionForChatItem:(id)item
{
  itemCopy = item;
  objc_initWeak(&location, self);
  if (![itemCopy canSendAsTextMessage])
  {
    v11 = 0;
    goto LABEL_11;
  }

  iMChatItem = [itemCopy IMChatItem];
  iMChatItem2 = [itemCopy IMChatItem];
  objc_opt_class();
  isKindOfClass = objc_opt_isKindOfClass();

  if ((isKindOfClass & 1) == 0)
  {
    v11 = 0;
    goto LABEL_10;
  }

  message = [iMChatItem message];
  v9 = objc_loadWeakRetained(&location);
  conversation = [v9 conversation];

  if (!-[CKChatController _smsEnabled](self, "_smsEnabled") || ![message isFromMe] || (objc_msgSend(message, "isDelivered") & 1) != 0)
  {
    goto LABEL_6;
  }

  error = [message error];
  if (error)
  {
    v11 = 0;
LABEL_16:

    goto LABEL_7;
  }

  if (([conversation isGroupConversation] & 1) == 0)
  {
    v14 = objc_loadWeakRetained(&location);
    collectionViewController = [v14 collectionViewController];
    chatItems = [collectionViewController chatItems];

    guid = [message guid];
    v18 = [chatItems __ck_indexesOfPartsOfMessageWithGUID:guid];
    v19 = [chatItems objectsAtIndexes:v18];

    v20 = objc_loadWeakRetained(&location);
    textInputContextIdentifier = [v20 textInputContextIdentifier];
    v22 = [CKComposition compositionForMessageParts:v19 preserveSubject:1 contextIdentifier:textInputContextIdentifier];

    LOBYTE(v20) = [conversation canSendComposition:v22 error:0];
    if (v20)
    {
      error = [conversation fallbackSendString];
      v23 = MEMORY[0x1E69DC628];
      v24 = [MEMORY[0x1E69DCAB8] systemImageNamed:@"arrow.up.circle"];
      v25[0] = MEMORY[0x1E69E9820];
      v25[1] = 3221225472;
      v25[2] = __77__CKChatController_ClickyOrbConformance___downgradeMessageActionForChatItem___block_invoke;
      v25[3] = &unk_1E72EC0D8;
      v26 = message;
      v27 = conversation;
      objc_copyWeak(&v28, &location);
      v11 = [v23 actionWithTitle:error image:v24 identifier:0 handler:v25];

      objc_destroyWeak(&v28);
      goto LABEL_16;
    }
  }

LABEL_6:
  v11 = 0;
LABEL_7:

LABEL_10:
LABEL_11:
  objc_destroyWeak(&location);

  return v11;
}

void __77__CKChatController_ClickyOrbConformance___downgradeMessageActionForChatItem___block_invoke(id *a1, void *a2)
{
  v22 = *MEMORY[0x1E69E9840];
  v3 = a2;
  if (IMOSLoggingEnabled())
  {
    CKLogCStringForType(29);
    v4 = OSLogHandleForIMFoundationCategory();
    if (os_log_type_enabled(v4, OS_LOG_TYPE_INFO))
    {
      v5 = [a1[4] guid];
      v6 = a1[5];
      *buf = 138412546;
      v19 = v5;
      v20 = 2112;
      v21 = v6;
      _os_log_impl(&dword_19020E000, v4, OS_LOG_TYPE_INFO, "Manually downgrading message with GUID {%@} -- conversation:%@", buf, 0x16u);
    }
  }

  if (os_log_shim_legacy_logging_enabled() && _CKShouldLogExternal())
  {
    v13 = [a1[4] guid];
    v14 = a1[5];
    _CKLogExternal();
  }

  v7 = a1 + 5;
  v8 = [a1[5] chat];
  [v8 downgradeMessage:a1[4] manualDowngrade:1];

  v9 = [a1[4] __ck_downgradedMessage];
  WeakRetained = objc_loadWeakRetained(a1 + 6);
  v11 = [WeakRetained collectionViewController];
  v15[0] = MEMORY[0x1E69E9820];
  v15[1] = 3221225472;
  v15[2] = __77__CKChatController_ClickyOrbConformance___downgradeMessageActionForChatItem___block_invoke_421;
  v15[3] = &unk_1E72EB8D0;
  v16 = *v7;
  v17 = v9;
  v12 = v9;
  [v11 updateTranscript:v15 animated:0 completion:0];
}

void __77__CKChatController_ClickyOrbConformance___downgradeMessageActionForChatItem___block_invoke_421(uint64_t a1)
{
  v1 = *(a1 + 32);
  v2 = *(a1 + 40);
  v3 = [MEMORY[0x1E69A5C90] smsService];
  [v1 sendMessage:v2 onService:v3 newComposition:0];
}

- (id)_stickerDetailsActionForChatItem:(id)item
{
  itemCopy = item;
  objc_initWeak(&location, self);
  visibleAssociatedMessageChatItems = [itemCopy visibleAssociatedMessageChatItems];

  if (visibleAssociatedMessageChatItems)
  {
    v6 = objc_alloc_init(MEMORY[0x1E695DF70]);
    visibleAssociatedMessageChatItems2 = [itemCopy visibleAssociatedMessageChatItems];
    v17[0] = MEMORY[0x1E69E9820];
    v17[1] = 3221225472;
    v17[2] = __75__CKChatController_ClickyOrbConformance___stickerDetailsActionForChatItem___block_invoke;
    v17[3] = &unk_1E72EC100;
    v8 = v6;
    v18 = v8;
    [visibleAssociatedMessageChatItems2 enumerateObjectsUsingBlock:v17];

    if ([v8 count])
    {
      v9 = MEMORY[0x1E69DC628];
      v10 = CKFrameworkBundle();
      v11 = [v10 localizedStringForKey:@"BALLOON_STICKER_CALLOUT" value:&stru_1F04268F8 table:@"ChatKit"];
      v12 = [MEMORY[0x1E69DCAB8] systemImageNamed:@"info.circle"];
      v15[0] = MEMORY[0x1E69E9820];
      v15[1] = 3221225472;
      v15[2] = __75__CKChatController_ClickyOrbConformance___stickerDetailsActionForChatItem___block_invoke_2;
      v15[3] = &unk_1E72EBCD8;
      objc_copyWeak(&v16, &location);
      v13 = [v9 actionWithTitle:v11 image:v12 identifier:0 handler:v15];

      objc_destroyWeak(&v16);
    }

    else
    {
      v13 = 0;
    }
  }

  else
  {
    v13 = 0;
  }

  objc_destroyWeak(&location);

  return v13;
}

void __75__CKChatController_ClickyOrbConformance___stickerDetailsActionForChatItem___block_invoke(uint64_t a1, void *a2)
{
  v3 = a2;
  objc_opt_class();
  if (objc_opt_isKindOfClass())
  {
    [*(a1 + 32) addObject:v3];
  }
}

void __75__CKChatController_ClickyOrbConformance___stickerDetailsActionForChatItem___block_invoke_2(uint64_t a1)
{
  WeakRetained = objc_loadWeakRetained((a1 + 32));
  [WeakRetained setWantsStickerDetails:1];
}

- (id)_emojiDetailsActionForChatItem:(id)item
{
  itemCopy = item;
  objc_opt_class();
  if (objc_opt_isKindOfClass())
  {
    v5 = itemCopy;
    emojiImageMediaObjectsInMessagePartText = [v5 emojiImageMediaObjectsInMessagePartText];
    if ([emojiImageMediaObjectsInMessagePartText count])
    {
      v7 = CKFrameworkBundle();
      v8 = [v7 localizedStringForKey:@"EMOJI_DETAILS_CONTEXT_MENU_ACTION_TITLE" value:&stru_1F04268F8 table:@"ChatKit"];

      v9 = [MEMORY[0x1E69DCAB8] _systemImageNamed:@"info.circle"];
      objc_initWeak(&location, self);
      v10 = MEMORY[0x1E69DC628];
      v13[0] = MEMORY[0x1E69E9820];
      v13[1] = 3221225472;
      v13[2] = __73__CKChatController_ClickyOrbConformance___emojiDetailsActionForChatItem___block_invoke;
      v13[3] = &unk_1E72EBCD8;
      objc_copyWeak(&v14, &location);
      v11 = [v10 actionWithTitle:v8 image:v9 identifier:0 handler:v13];
      objc_destroyWeak(&v14);
      objc_destroyWeak(&location);
    }

    else
    {
      v11 = 0;
    }
  }

  else
  {
    v11 = 0;
  }

  return v11;
}

void __73__CKChatController_ClickyOrbConformance___emojiDetailsActionForChatItem___block_invoke(uint64_t a1)
{
  WeakRetained = objc_loadWeakRetained((a1 + 32));
  [WeakRetained setWantsEmojiDetails:1];
}

- (id)_showTimestampsAction
{
  collectionViewController = [(CKCoreChatController *)self collectionViewController];
  toggleTimeStampAction = [collectionViewController toggleTimeStampAction];

  return toggleTimeStampAction;
}

- (id)_mediaAttributionActionForChatItem:(id)item
{
  itemCopy = item;
  objc_opt_class();
  if (objc_opt_isKindOfClass())
  {
    mediaObject = [itemCopy mediaObject];
    transfer = [mediaObject transfer];
    attributionInfo = [transfer attributionInfo];

    if (attributionInfo)
    {
      v8 = [attributionInfo objectForKeyedSubscript:@"bundle-id"];
      if ([v8 isEqualToString:@"com.apple.messages.MSMessageExtensionBalloonPlugin:0000000000:com.apple.Stickers.UserGenerated.MessagesExtension"])
      {
        if (IMOSLoggingEnabled())
        {
          v9 = OSLogHandleForIMFoundationCategory();
          if (os_log_type_enabled(v9, OS_LOG_TYPE_INFO))
          {
            LOWORD(buf[0]) = 0;
            _os_log_impl(&dword_19020E000, v9, OS_LOG_TYPE_INFO, "Not showing media attribution action: user generation sticker plugin", buf, 2u);
          }
        }

        v10 = 0;
      }

      else
      {
        __ck_localizedAppNameForTranscriptAttribution = [attributionInfo __ck_localizedAppNameForTranscriptAttribution];
        if (__ck_localizedAppNameForTranscriptAttribution)
        {
          objc_initWeak(buf, self);
          v14 = MEMORY[0x1E69DC628];
          v15 = MEMORY[0x1E696AEC0];
          v16 = CKFrameworkBundle();
          v17 = [v16 localizedStringForKey:@"MEDIA_ATTRIBUTION_TITLE_FORMAT" value:&stru_1F04268F8 table:@"ChatKit"];
          v18 = [v15 stringWithFormat:v17, __ck_localizedAppNameForTranscriptAttribution];

          mEMORY[0x1E69DC668] = [MEMORY[0x1E69DC668] sharedApplication];
          userInterfaceLayoutDirection = [mEMORY[0x1E69DC668] userInterfaceLayoutDirection];

          if (userInterfaceLayoutDirection == 1)
          {
            v21 = @"\u200F";
          }

          else
          {
            v21 = @"\u200E";
          }

          v22 = [(__CFString *)v21 stringByAppendingString:v18];

          v23 = [MEMORY[0x1E69DCAB8] _systemImageNamed:@"appstore.capsule"];
          v26[0] = MEMORY[0x1E69E9820];
          v26[1] = 3221225472;
          v26[2] = __77__CKChatController_ClickyOrbConformance___mediaAttributionActionForChatItem___block_invoke;
          v26[3] = &unk_1E72EC0D8;
          v27 = attributionInfo;
          v28 = mediaObject;
          objc_copyWeak(&v29, buf);
          v10 = [v14 actionWithTitle:v22 image:v23 identifier:0 handler:v26];

          objc_destroyWeak(&v29);
          objc_destroyWeak(buf);
        }

        else
        {
          if (IMOSLoggingEnabled())
          {
            v24 = OSLogHandleForIMFoundationCategory();
            if (os_log_type_enabled(v24, OS_LOG_TYPE_INFO))
            {
              LOWORD(buf[0]) = 0;
              _os_log_impl(&dword_19020E000, v24, OS_LOG_TYPE_INFO, "Not showing media attribution action: title is nil", buf, 2u);
            }
          }

          v10 = 0;
        }
      }
    }

    else
    {
      if (IMOSLoggingEnabled())
      {
        v12 = OSLogHandleForIMFoundationCategory();
        if (os_log_type_enabled(v12, OS_LOG_TYPE_INFO))
        {
          LOWORD(buf[0]) = 0;
          _os_log_impl(&dword_19020E000, v12, OS_LOG_TYPE_INFO, "Not showing media attribution action: no attribution", buf, 2u);
        }
      }

      v10 = 0;
    }
  }

  else
  {
    if (IMOSLoggingEnabled())
    {
      v11 = OSLogHandleForIMFoundationCategory();
      if (os_log_type_enabled(v11, OS_LOG_TYPE_INFO))
      {
        LOWORD(buf[0]) = 0;
        _os_log_impl(&dword_19020E000, v11, OS_LOG_TYPE_INFO, "Not showing media attribution action: not a CKAttachmentMessagePartChatItem", buf, 2u);
      }
    }

    v10 = 0;
  }

  return v10;
}

void __77__CKChatController_ClickyOrbConformance___mediaAttributionActionForChatItem___block_invoke(id *a1)
{
  v2 = dispatch_time(0, 200000000);
  block[0] = MEMORY[0x1E69E9820];
  block[1] = 3221225472;
  block[2] = __77__CKChatController_ClickyOrbConformance___mediaAttributionActionForChatItem___block_invoke_2;
  block[3] = &unk_1E72EC128;
  v4 = a1[4];
  v5 = a1[5];
  objc_copyWeak(&v6, a1 + 6);
  dispatch_after(v2, MEMORY[0x1E69E96A0], block);
  objc_destroyWeak(&v6);
}

void __77__CKChatController_ClickyOrbConformance___mediaAttributionActionForChatItem___block_invoke_2(id *a1)
{
  v8 = [a1[4] objectForKey:*MEMORY[0x1E69A6FA0]];
  v2 = [a1[4] objectForKey:*MEMORY[0x1E69A6FB0]];
  objc_opt_class();
  if (objc_opt_isKindOfClass())
  {
    v3 = [MEMORY[0x1E696AD98] numberWithLongLong:{objc_msgSend(v8, "longLongValue")}];

    v8 = v3;
  }

  v4 = [a1[4] objectForKey:*MEMORY[0x1E69A6FF0]];
  v5 = [a1[5] transfer];
  v6 = [v5 isSticker];

  WeakRetained = objc_loadWeakRetained(a1 + 6);
  [WeakRetained _presentBrowserOrAppStoreForAdamID:v8 url:v4 identifier:v2 isForSticker:v6];
}

- (id)_moreActionForChatItem:(id)item configureForCommSafety:(BOOL)safety
{
  safetyCopy = safety;
  itemCopy = item;
  if (![itemCopy wantsMoreMenu])
  {
    v9 = 0;
    goto LABEL_12;
  }

  v7 = objc_initWeak(&location, self);
  conversation = [(CKCoreChatController *)self conversation];
  if ([conversation isPending])
  {
    v9 = 0;
LABEL_10:

    goto LABEL_11;
  }

  v10 = objc_loadWeakRetained(&location);
  isInline = [v10 isInline];

  if ((isInline & 1) == 0)
  {
    v12 = CKFrameworkBundle();
    self = [v12 localizedStringForKey:@"BALLOON_MORE_CALLOUT" value:&stru_1F04268F8 table:@"ChatKit"];

    conversation = [MEMORY[0x1E69DCAB8] systemImageNamed:@"ellipsis.circle"];
    if (safetyCopy)
    {
      v13 = CKFrameworkBundle();
      v14 = [v13 localizedStringForKey:@"DELETE_ELLIPSIS" value:&stru_1F04268F8 table:@"ChatKit"];

      self = v14;
    }

    v15 = MEMORY[0x1E69DC628];
    v17[0] = MEMORY[0x1E69E9820];
    v17[1] = 3221225472;
    v17[2] = __88__CKChatController_ClickyOrbConformance___moreActionForChatItem_configureForCommSafety___block_invoke;
    v17[3] = &unk_1E72EBF48;
    objc_copyWeak(&v19, &location);
    v18 = itemCopy;
    v9 = [v15 actionWithTitle:self image:conversation identifier:0 handler:v17];

    objc_destroyWeak(&v19);
    goto LABEL_10;
  }

  v9 = 0;
LABEL_11:
  objc_destroyWeak(&location);
LABEL_12:

  return v9;
}

void __88__CKChatController_ClickyOrbConformance___moreActionForChatItem_configureForCommSafety___block_invoke(uint64_t a1)
{
  WeakRetained = objc_loadWeakRetained((a1 + 40));
  [WeakRetained actionMoreIsTappedForChatItem:*(a1 + 32)];
}

- (BOOL)_shouldShowPollDetailsActionForChatItem:(id)item
{
  itemCopy = item;
  mEMORY[0x1E69A8070] = [MEMORY[0x1E69A8070] sharedFeatureFlags];
  isPollsEnabled = [mEMORY[0x1E69A8070] isPollsEnabled];

  v9 = 0;
  if (isPollsEnabled)
  {
    objc_opt_class();
    if (objc_opt_isKindOfClass())
    {
      bundleIdentifier = [itemCopy bundleIdentifier];
      v7 = IMBalloonExtensionIDWithSuffix();
      v8 = [bundleIdentifier isEqualToString:v7];

      if (v8)
      {
        v9 = 1;
      }
    }
  }

  return v9;
}

- (id)_votingViewForChatItem:(id)item containingViewController:(id)controller
{
  itemCopy = item;
  controllerCopy = controller;
  view = [controllerCopy view];
  safeAreaLayoutGuide = [view safeAreaLayoutGuide];
  [safeAreaLayoutGuide layoutFrame];
  v11 = v10;
  v13 = v12;
  v15 = v14;
  v17 = v16;

  presentedViewController = [(CKChatController *)self presentedViewController];
  objc_opt_class();
  if (objc_opt_isKindOfClass())
  {
    presentedViewController2 = [(CKChatController *)self presentedViewController];
    view2 = [presentedViewController2 view];
  }

  else
  {
    view2 = [(CKChatController *)self view];
  }

  window = [view2 window];
  view3 = [(CKChatController *)self view];
  [window convertRect:view3 fromView:{v11, v13, v15, v17}];
  v48 = v24;
  v49 = v23;
  v46 = v26;
  v47 = v25;

  window2 = [view2 window];
  [window2 bounds];
  v29 = v28;
  v31 = v30;

  [(CKChatController *)self systemMinimumLayoutMargins];
  v33 = v32;
  v35 = v34;
  view4 = [(CKChatController *)self view];
  [view4 effectiveUserInterfaceLayoutDirection];

  v54.origin.x = v11;
  v54.origin.y = v13;
  v54.size.width = v15;
  v54.size.height = v17;
  Width = CGRectGetWidth(v54);
  objc_initWeak(&location, self);
  v38 = +[CKUIBehavior sharedBehaviors];
  [v38 attributionViewHeight];
  v40 = v39;

  v41 = [CKAttributionViewAccessoryView alloc];
  v42 = *MEMORY[0x1E695F058];
  v43 = *(MEMORY[0x1E695F058] + 8);
  v50[0] = MEMORY[0x1E69E9820];
  v50[1] = 3221225472;
  v50[2] = __90__CKChatController_ClickyOrbConformance___votingViewForChatItem_containingViewController___block_invoke;
  v50[3] = &unk_1E72EC150;
  objc_copyWeak(&v51, &location);
  v44 = [(CKAttributionViewAccessoryView *)v41 initWithFrame:itemCopy chatItem:v50 layoutBounds:v42 windowSize:v43 saveStickerHandler:Width - (v33 + v35), v40, v49, v48, v47, v46, v29, v31];
  objc_destroyWeak(&v51);
  objc_destroyWeak(&location);

  return v44;
}

void __90__CKChatController_ClickyOrbConformance___votingViewForChatItem_containingViewController___block_invoke(uint64_t a1, void *a2)
{
  v3 = a2;
  WeakRetained = objc_loadWeakRetained((a1 + 32));
  [WeakRetained dismissContextMenuInteractionMenu];

  v5 = objc_loadWeakRetained((a1 + 32));
  [v5 saveStickerFromTapbackAttributionFlow:v3];
}

- (id)_localizedTitleStringForAggregateAction:(int64_t)action numberOfPhotos:(int64_t)photos numberOfVideos:(int64_t)videos numberOfOther:(int64_t)other
{
  v8 = @"_ITEMS";
  if (other <= 0)
  {
    if (!photos || videos)
    {
      if (videos)
      {
        v9 = photos == 0;
      }

      else
      {
        v9 = 0;
      }

      if (v9)
      {
        v8 = @"_VIDEOS";
      }
    }

    else
    {
      v8 = @"_PHOTOS";
    }
  }

  v10 = @"DELETE";
  if (action != 1)
  {
    v10 = 0;
  }

  if (action)
  {
    v11 = v10;
  }

  else
  {
    v11 = @"COPY";
  }

  v12 = videos + photos + other;
  v13 = [(__CFString *)v11 stringByAppendingFormat:v8];
  v14 = MEMORY[0x1E696AEC0];
  v15 = CKFrameworkBundle();
  v16 = [v15 localizedStringForKey:v13 value:&stru_1F04268F8 table:@"ChatKit"];
  v17 = [v14 localizedStringWithFormat:v16, v12];

  mEMORY[0x1E69DC668] = [MEMORY[0x1E69DC668] sharedApplication];
  userInterfaceLayoutDirection = [mEMORY[0x1E69DC668] userInterfaceLayoutDirection];

  if (userInterfaceLayoutDirection == 1)
  {
    v20 = @"\u200F";
  }

  else
  {
    v20 = @"\u200E";
  }

  v21 = [(__CFString *)v20 stringByAppendingString:v17];

  return v21;
}

- (id)_balloonViewForCellAtIndexPath:(id)path
{
  v14 = *MEMORY[0x1E69E9840];
  pathCopy = path;
  collectionView = [(CKChatController *)self collectionView];
  v6 = [collectionView cellForItemAtIndexPath:pathCopy];

  if (objc_opt_respondsToSelector())
  {
    balloonView = [v6 balloonView];
  }

  else
  {
    if (IMOSLoggingEnabled())
    {
      v8 = OSLogHandleForIMFoundationCategory();
      if (os_log_type_enabled(v8, OS_LOG_TYPE_INFO))
      {
        v9 = objc_opt_class();
        v10 = NSStringFromClass(v9);
        v12 = 138412290;
        v13 = v10;
        _os_log_impl(&dword_19020E000, v8, OS_LOG_TYPE_INFO, "_balloonViewForCellAtIndexPath will return nil for class: %@", &v12, 0xCu);
      }
    }

    balloonView = 0;
  }

  return balloonView;
}

- (id)_parentChatItemForIndexPath:(id)path
{
  v24 = *MEMORY[0x1E69E9840];
  pathCopy = path;
  v5 = [(CKCoreChatController *)self indexPathOfParentChatItemForIndexPath:pathCopy];
  collectionViewController = [(CKCoreChatController *)self collectionViewController];
  chatItems = [collectionViewController chatItems];

  if (v5)
  {
    item = [v5 item];
    if (item < [chatItems count])
    {
      collectionViewController2 = [(CKCoreChatController *)self collectionViewController];
      chatItems2 = [collectionViewController2 chatItems];
      v11 = [chatItems2 objectAtIndex:{objc_msgSend(v5, "item")}];

      objc_opt_class();
      if (objc_opt_isKindOfClass())
      {
        goto LABEL_17;
      }

      if (IMOSLoggingEnabled())
      {
        v12 = OSLogHandleForIMFoundationCategory();
        if (os_log_type_enabled(v12, OS_LOG_TYPE_INFO))
        {
          v18 = 138412290;
          v19 = v11;
          _os_log_impl(&dword_19020E000, v12, OS_LOG_TYPE_INFO, "_parentChatItemForIndexPath will return nil. chatItem: %@ is not of class CKMessagePartChatItem", &v18, 0xCu);
        }
      }
    }
  }

  if (IMOSLoggingEnabled())
  {
    v13 = OSLogHandleForIMFoundationCategory();
    if (os_log_type_enabled(v13, OS_LOG_TYPE_INFO))
    {
      if (v5)
      {
        v14 = @"NO";
      }

      else
      {
        v14 = @"YES";
      }

      item2 = [v5 item];
      v16 = [chatItems count];
      v18 = 138412802;
      v19 = v14;
      v20 = 2048;
      v21 = item2;
      v22 = 2048;
      v23 = v16;
      _os_log_impl(&dword_19020E000, v13, OS_LOG_TYPE_INFO, "_parentChatItemForIndexPath returning nil. ParentIndexPath is nil: %@; ParentIndexPath.item: %ld; chatItems.count: %ld", &v18, 0x20u);
    }
  }

  v11 = 0;
LABEL_17:

  return v11;
}

- (BOOL)_hasPreviewViewControllerForChatItem:(id)item
{
  itemCopy = item;
  objc_opt_class();
  if (objc_opt_isKindOfClass())
  {
    mediaObject = [itemCopy mediaObject];
    if ([mediaObject shouldBeQuickLooked])
    {
      isKindOfClass = 1;
    }

    else
    {
      objc_opt_class();
      isKindOfClass = objc_opt_isKindOfClass();
    }
  }

  else
  {
    objc_opt_class();
    isKindOfClass = objc_opt_isKindOfClass();
  }

  return isKindOfClass & 1;
}

- (BOOL)_clickyOrbEnabled
{
  v3 = +[CKUIBehavior sharedBehaviors];
  disableTranscriptInteractions = [v3 disableTranscriptInteractions];

  if (disableTranscriptInteractions)
  {
    v5 = IMOSLoggingEnabled();
    if (v5)
    {
      v6 = OSLogHandleForIMFoundationCategory();
      if (os_log_type_enabled(v6, OS_LOG_TYPE_INFO))
      {
        v17 = 0;
        v7 = "clicky orb: disabled because transcript interactions disabled";
        v8 = &v17;
LABEL_13:
        _os_log_impl(&dword_19020E000, v6, OS_LOG_TYPE_INFO, v7, v8, 2u);
        goto LABEL_14;
      }

      goto LABEL_14;
    }
  }

  else
  {
    v9 = +[CKUIBehavior sharedBehaviors];
    disableTranscriptClickyOrbContextMenu = [v9 disableTranscriptClickyOrbContextMenu];

    if (disableTranscriptClickyOrbContextMenu)
    {
      v5 = IMOSLoggingEnabled();
      if (v5)
      {
        v6 = OSLogHandleForIMFoundationCategory();
        if (os_log_type_enabled(v6, OS_LOG_TYPE_INFO))
        {
          v16 = 0;
          v7 = "clicky orb: disabled because transcript context menu disabled";
          v8 = &v16;
          goto LABEL_13;
        }

LABEL_14:

        LOBYTE(v5) = 0;
      }
    }

    else if ([(CKChatController *)self isEditing])
    {
      v5 = IMOSLoggingEnabled();
      if (v5)
      {
        v6 = OSLogHandleForIMFoundationCategory();
        if (os_log_type_enabled(v6, OS_LOG_TYPE_INFO))
        {
          *buf = 0;
          v7 = "clicky orb: disabled because transcript is editing";
          v8 = buf;
          goto LABEL_13;
        }

        goto LABEL_14;
      }
    }

    else
    {
      mEMORY[0x1E69A8070] = [MEMORY[0x1E69A8070] sharedFeatureFlags];
      isModernFilteringEnabled = [mEMORY[0x1E69A8070] isModernFilteringEnabled];

      if ((isModernFilteringEnabled & 1) == 0 && [(CKChatController *)self isShowingOscarChat])
      {
        v5 = IMOSLoggingEnabled();
        if (!v5)
        {
          return v5;
        }

        v6 = OSLogHandleForIMFoundationCategory();
        if (!os_log_type_enabled(v6, OS_LOG_TYPE_INFO))
        {
          goto LABEL_14;
        }

        v14 = 0;
        v7 = "clicky orb: disabled because showing oscar chat";
        v8 = &v14;
        goto LABEL_13;
      }

      LOBYTE(v5) = 1;
    }
  }

  return v5;
}

- (BOOL)_balloonViewOfCell:(id)cell containsPoint:(CGPoint)point fromView:(id)view
{
  y = point.y;
  x = point.x;
  viewCopy = view;
  cellCopy = cell;
  balloonView = [cellCopy balloonView];
  [balloonView frame];
  [viewCopy convertRect:cellCopy fromView:?];
  v12 = v11;
  v14 = v13;
  v16 = v15;
  v18 = v17;

  v21.origin.x = v12;
  v21.origin.y = v14;
  v21.size.width = v16;
  v21.size.height = v18;
  v20.x = x;
  v20.y = y;
  LOBYTE(cellCopy) = CGRectContainsPoint(v21, v20);

  return cellCopy;
}

- (BOOL)_point:(CGPoint)_point visuallyIntersectsBalloonViewInCollectionView:(id)view
{
  y = _point.y;
  x = _point.x;
  v26 = *MEMORY[0x1E69E9840];
  viewCopy = view;
  v8 = [viewCopy indexPathForItemAtPoint:{x, y}];
  v9 = [viewCopy cellForItemAtIndexPath:v8];

  v10 = [viewCopy hitTest:0 withEvent:{x, y}];
  if (v9)
  {
    objc_opt_class();
    if (objc_opt_isKindOfClass() & 1) != 0 && v10 && ([v9 balloonView], v11 = objc_claimAutoreleasedReturnValue(), v12 = objc_msgSend(v10, "isDescendantOfView:", v11), v11, (v12))
    {
      v13 = 1;
    }

    else
    {
      v23 = 0u;
      v24 = 0u;
      v21 = 0u;
      v22 = 0u;
      visibleCells = [viewCopy visibleCells];
      v15 = [visibleCells countByEnumeratingWithState:&v21 objects:v25 count:16];
      if (v15)
      {
        v16 = v15;
        v17 = *v22;
        while (2)
        {
          for (i = 0; i != v16; ++i)
          {
            if (*v22 != v17)
            {
              objc_enumerationMutation(visibleCells);
            }

            v19 = *(*(&v21 + 1) + 8 * i);
            objc_opt_class();
            if ((objc_opt_isKindOfClass() & 1) != 0 && [(CKChatController *)self _balloonViewOfCell:v19 containsPoint:viewCopy fromView:x, y])
            {
              v13 = 1;
              goto LABEL_18;
            }
          }

          v16 = [visibleCells countByEnumeratingWithState:&v21 objects:v25 count:16];
          if (v16)
          {
            continue;
          }

          break;
        }
      }

      v13 = 0;
LABEL_18:
    }
  }

  else
  {
    v13 = 0;
  }

  return v13;
}

- (BOOL)contextMenuInteractionIsOutsideOfVisibleBalloonCells:(id)cells
{
  cellsCopy = cells;
  collectionView = [(CKChatController *)self collectionView];
  [cellsCopy locationInView:collectionView];
  v7 = v6;
  v9 = v8;

  collectionView2 = [(CKChatController *)self collectionView];
  LOBYTE(self) = [(CKChatController *)self _point:collectionView2 visuallyIntersectsBalloonViewInCollectionView:v7, v9];

  return self ^ 1;
}

- (void)contextMenuInteraction:(id)interaction willDisplayMenuForConfiguration:(id)configuration animator:(id)animator
{
  if ([(CKChatController *)self contextMenuInteractionIsOutsideOfVisibleBalloonCells:interaction, configuration, animator])
  {

    [(CKChatController *)self clearEntryViewPasteConfiguration];
  }
}

- (void)contextMenuInteraction:(id)interaction willEndForConfiguration:(id)configuration animator:(id)animator
{
  if ([(CKChatController *)self contextMenuInteractionIsOutsideOfVisibleBalloonCells:interaction, configuration, animator])
  {

    [(CKChatController *)self restoreEntryViewPasteConfiguration];
  }
}

- (id)contextMenuInteraction:(id)interaction configurationForMenuAtLocation:(CGPoint)location
{
  v11 = *MEMORY[0x1E69E9840];
  interactionCopy = interaction;
  if ([(CKChatController *)self contextMenuInteractionIsOutsideOfVisibleBalloonCells:interactionCopy])
  {
    if (IMOSLoggingEnabled())
    {
      v6 = OSLogHandleForIMFoundationCategory();
      if (os_log_type_enabled(v6, OS_LOG_TYPE_INFO))
      {
        v9 = 136315138;
        v10 = "[CKChatController(ClickyOrbConformance) contextMenuInteraction:configurationForMenuAtLocation:]";
        _os_log_impl(&dword_19020E000, v6, OS_LOG_TYPE_INFO, "%s - context menu interaction is outside of visible balloonCell", &v9, 0xCu);
      }
    }

    contextMenuInteractionOutsideOfVisibleBalloonCells = [(CKChatController *)self contextMenuInteractionOutsideOfVisibleBalloonCells];
  }

  else
  {
    contextMenuInteractionOutsideOfVisibleBalloonCells = 0;
  }

  return contextMenuInteractionOutsideOfVisibleBalloonCells;
}

- (id)contextMenuInteractionOutsideOfVisibleBalloonCells
{
  v12[1] = *MEMORY[0x1E69E9840];
  v2 = MEMORY[0x1E69DCC60];
  _showTimestampsAction = [(CKChatController *)self _showTimestampsAction];
  v12[0] = _showTimestampsAction;
  v4 = [MEMORY[0x1E695DEC8] arrayWithObjects:v12 count:1];
  v5 = [v2 menuWithTitle:&stru_1F04268F8 children:v4];

  v6 = MEMORY[0x1E69DC8D8];
  v10[0] = MEMORY[0x1E69E9820];
  v10[1] = 3221225472;
  v10[2] = __92__CKChatController_ClickyOrbConformance__contextMenuInteractionOutsideOfVisibleBalloonCells__block_invoke;
  v10[3] = &unk_1E72EC178;
  v11 = v5;
  v7 = v5;
  v8 = [v6 configurationWithIdentifier:@"CKTranscriptContextMenuConfigurationIdentifier" previewProvider:0 actionProvider:v10];

  return v8;
}

- (void)setupClickyOrbForConversation:(id)conversation
{
  if (CKIsRunningInMacCatalyst())
  {
    collectionViewController = [(CKCoreChatController *)self collectionViewController];
    collectionView = [collectionViewController collectionView];

    v5 = [objc_alloc(MEMORY[0x1E69DC8E0]) initWithDelegate:self];
    v6 = objc_alloc_init(MEMORY[0x1E69DD250]);
    [collectionView setBackgroundView:v6];
    [collectionView addInteraction:v5];
  }
}

- (CGAffineTransform)stickerPreviewTransform
{
  v4 = MEMORY[0x193AF5EC0](@"_MSStickerDragPreviewContainerView", @"Messages");
  if (v4 && (v5 = v4, (objc_opt_respondsToSelector() & 1) != 0))
  {

    return [v5 targetPreviewTransform];
  }

  else
  {

    return CGAffineTransformMakeScale(retstr, 1.25, 1.25);
  }
}

- (id)_stickerDragPreviewForDragItem:(id)item defaultPreview:(id)preview
{
  v31 = *MEMORY[0x1E69E9840];
  itemCopy = item;
  previewCopy = preview;
  dropSession = [(CKChatController *)self dropSession];
  v9 = [(CKChatController *)self _stickerDropProposalForItem:itemCopy inSession:dropSession];

  if (IMOSLoggingEnabled())
  {
    v10 = OSLogHandleForIMFoundationCategory();
    if (os_log_type_enabled(v10, OS_LOG_TYPE_INFO))
    {
      dropSession2 = [(CKChatController *)self dropSession];
      dragItem = [v9 dragItem];
      [v9 previewCenter];
      v13 = NSStringFromCGPoint(v33);
      targetBalloonIndex = [v9 targetBalloonIndex];
      LODWORD(v29[0]) = 138413314;
      *(v29 + 4) = itemCopy;
      WORD2(v29[1]) = 2112;
      *(&v29[1] + 6) = dropSession2;
      HIWORD(v29[2]) = 2112;
      v29[3] = dragItem;
      *v30 = 2112;
      *&v30[2] = v13;
      *&v30[10] = 2112;
      *&v30[12] = targetBalloonIndex;
      _os_log_impl(&dword_19020E000, v10, OS_LOG_TYPE_INFO, "_stickerDragPreviewForDragItem: got dropProposal for item: %@, session: %@, dragItem: %@, previewCenter: %@, targetBalloonIndex: %@", v29, 0x34u);
    }
  }

  targetBalloonIndex2 = [v9 targetBalloonIndex];

  if (targetBalloonIndex2)
  {
    v16 = [objc_alloc(MEMORY[0x193AF5EC0](@"_MSStickerDragPreviewContainerView" @"Messages"))];
    target = [previewCopy target];
    v18 = objc_alloc(MEMORY[0x1E69DC9A8]);
    container = [target container];
    [target center];
    v21 = v20;
    v23 = v22;
    if (itemCopy)
    {
      [itemCopy _suggestedTransform];
    }

    else
    {
      *v30 = 0u;
      memset(v29, 0, sizeof(v29));
    }

    v27 = [v18 initWithContainer:container center:v29 transform:{v21, v23}];

    v26 = [previewCopy retargetedPreviewWithTarget:v27];
    [v26 _setPreviewContainer:v16];
    [(CKChatController *)self _prepareForDropAnimationWithItem:itemCopy preview:v26];
  }

  else
  {
    if (IMOSLoggingEnabled())
    {
      v24 = OSLogHandleForIMFoundationCategory();
      if (os_log_type_enabled(v24, OS_LOG_TYPE_INFO))
      {
        dropSession3 = [(CKChatController *)self dropSession];
        LODWORD(v29[0]) = 138412546;
        *(v29 + 4) = itemCopy;
        WORD2(v29[1]) = 2112;
        *(&v29[1] + 6) = dropSession3;
        _os_log_impl(&dword_19020E000, v24, OS_LOG_TYPE_INFO, "_stickerDragPreviewForDragItem: Not returning a UITargetedDragPreview which will abort the stick animation. There was no valid target balloon sufficiently close to the drop preview for item: %@, drop session: %@.", v29, 0x16u);
      }
    }

    v26 = 0;
  }

  return v26;
}

- (id)hashKeyForDragItem:(id)item
{
  if (item)
  {
    v4 = [MEMORY[0x1E696AEC0] stringWithFormat:@"%lu", objc_msgSend(item, "hash")];
  }

  else
  {
    v4 = &stru_1F04268F8;
  }

  return v4;
}

- (void)_prepareForDropAnimationWithItem:(id)item preview:(id)preview
{
  v23 = *MEMORY[0x1E69E9840];
  itemCopy = item;
  previewCopy = preview;
  v8 = IMLogHandleForCategory();
  if (os_log_type_enabled(v8, OS_LOG_TYPE_INFO))
  {
    _previewContainer = [previewCopy _previewContainer];
    v17 = 138412802;
    v18 = itemCopy;
    v19 = 2112;
    v20 = previewCopy;
    v21 = 2112;
    v22 = _previewContainer;
    _os_log_impl(&dword_19020E000, v8, OS_LOG_TYPE_INFO, "_prepareForDropAnimationWithItem dragItem: %@, dragPreview: %@, container: %@", &v17, 0x20u);
  }

  v10 = [(CKChatController *)self hashKeyForDragItem:itemCopy];
  activeDropPreviews = [(CKChatController *)self activeDropPreviews];
  [activeDropPreviews setObject:previewCopy forKey:v10];

  _previewContainer2 = [previewCopy _previewContainer];
  v13 = objc_opt_respondsToSelector();

  if (v13)
  {
    _previewContainer3 = [previewCopy _previewContainer];
    [_previewContainer3 setDefersFinalDropAnimationCompletion:1];
  }

  _previewContainer4 = [previewCopy _previewContainer];

  if (!_previewContainer4)
  {
    v16 = IMLogHandleForCategory();
    if (os_log_type_enabled(v16, OS_LOG_TYPE_ERROR))
    {
      [CKChatController(CKChatController_Stickers) _prepareForDropAnimationWithItem:preview:];
    }
  }
}

- (id)_stickerDropProposalForSession:(id)session
{
  v19 = *MEMORY[0x1E69E9840];
  sessionCopy = session;
  v14 = 0u;
  v15 = 0u;
  v16 = 0u;
  v17 = 0u;
  items = [sessionCopy items];
  v6 = [items countByEnumeratingWithState:&v14 objects:v18 count:16];
  if (v6)
  {
    v7 = v6;
    v8 = 0;
    v9 = *v15;
LABEL_3:
    v10 = 0;
    v11 = v8;
    while (1)
    {
      if (*v15 != v9)
      {
        objc_enumerationMutation(items);
      }

      v8 = [(CKChatController *)self _stickerDropProposalForItem:*(*(&v14 + 1) + 8 * v10) inSession:sessionCopy];

      targetBalloonIndex = [v8 targetBalloonIndex];

      if (targetBalloonIndex)
      {
        break;
      }

      ++v10;
      v11 = v8;
      if (v7 == v10)
      {
        v7 = [items countByEnumeratingWithState:&v14 objects:v18 count:16];
        if (v7)
        {
          goto LABEL_3;
        }

        break;
      }
    }
  }

  else
  {
    v8 = 0;
  }

  return v8;
}

- (id)_stickerDropProposalForItem:(id)item inSession:(id)session
{
  itemCopy = item;
  sessionCopy = session;
  collectionViewController = [(CKCoreChatController *)self collectionViewController];
  collectionView = [collectionViewController collectionView];
  v10 = *MEMORY[0x1E695EFF8];
  v11 = *(MEMORY[0x1E695EFF8] + 8);
  if (objc_opt_respondsToSelector() & 1) != 0 && (objc_opt_respondsToSelector())
  {
    v12 = IMLogHandleForCategory();
    if (os_log_type_enabled(v12, OS_LOG_TYPE_INFO))
    {
      LOWORD(buf.a) = 0;
      _os_log_impl(&dword_19020E000, v12, OS_LOG_TYPE_INFO, "_stickerDropProposalForItem:inSession: checking view geometry", &buf, 2u);
    }

    view = [(CKChatController *)self view];
    window = [view window];
    [sessionCopy _previewCenterForVisibleItem:itemCopy inView:window];
    v10 = v15;
    v11 = v16;

    [sessionCopy _previewSizeForVisibleItem:itemCopy];
    v18 = v17;
    v20 = v19;
    memset(&buf, 0, sizeof(buf));
    [(CKChatController *)self stickerPreviewTransform];
    CGAffineTransformInvert(&buf, &v32);
    memset(&v32, 0, sizeof(v32));
    if (itemCopy)
    {
      [itemCopy _suggestedTransform];
    }

    else
    {
      memset(&t2, 0, sizeof(t2));
    }

    t1 = buf;
    CGAffineTransformConcat(&v32, &t1, &t2);
    t2 = v32;
    CGAffineTransformDecompose(&v29, &t2);
    window2 = [(CKChatController *)self selectedBalloonIntersectingRect:v10 - v18 * v29.scale.width * 0.5, v11 - v20 * v29.scale.width * 0.5];
    if (!window2)
    {
      v28 = IMLogHandleForCategory();
      if (os_log_type_enabled(v28, OS_LOG_TYPE_INFO))
      {
        LOWORD(t2.a) = 0;
        _os_log_impl(&dword_19020E000, v28, OS_LOG_TYPE_INFO, "_stickerDropProposalForItem:inSession: no view geometry; will try touch rect", &t2, 2u);
      }
    }
  }

  else
  {
    window2 = 0;
  }

  if (!window2)
  {
    if (collectionView)
    {
      window2 = [collectionView window];

      if (window2)
      {
        v22 = IMLogHandleForCategory();
        if (os_log_type_enabled(v22, OS_LOG_TYPE_INFO))
        {
          LOWORD(buf.a) = 0;
          _os_log_impl(&dword_19020E000, v22, OS_LOG_TYPE_INFO, "_stickerDropProposalForItem:inSession: no view geometry; trying touch rect", &buf, 2u);
        }

        window2 = [(CKChatController *)self _selectedBalloonFromTouchForDropSession:sessionCopy];
        window3 = [collectionView window];
        [sessionCopy locationInView:window3];
        v10 = v24;
        v11 = v25;
      }
    }
  }

  v26 = [[CKTranscriptStickerDropProposal alloc] initWithDragItem:itemCopy previewCenter:window2 targetBalloonIndex:v10, v11];

  return v26;
}

- (id)_selectedBalloonFromTouchForDropSession:(id)session
{
  sessionCopy = session;
  collectionViewController = [(CKCoreChatController *)self collectionViewController];
  collectionView = [collectionViewController collectionView];
  v7 = collectionView;
  if (collectionView && ([collectionView window], v8 = objc_claimAutoreleasedReturnValue(), v8, v8))
  {
    window = [v7 window];
    [sessionCopy locationInView:window];
    v11 = v10;
    v13 = v12;

    v14 = *MEMORY[0x1E695F058];
    v15 = *(MEMORY[0x1E695F058] + 8);
    v20.origin.x = *MEMORY[0x1E695F058];
    v20.origin.y = v15;
    v20.size.width = 44.0;
    v20.size.height = 44.0;
    v16 = v11 - CGRectGetWidth(v20) * 0.5;
    v21.origin.x = v14;
    v21.origin.y = v15;
    v21.size.width = 44.0;
    v21.size.height = 44.0;
    v17 = [(CKChatController *)self selectedBalloonIntersectingRect:v16, v13 - CGRectGetHeight(v21) * 0.5, 44.0, 44.0];
  }

  else
  {
    v17 = 0;
  }

  return v17;
}

- (void)_sendStickerForDragItem:(id)item previewSize:(CGSize)size dropLocation:(CGPoint)location
{
  y = location.y;
  x = location.x;
  height = size.height;
  width = size.width;
  v83 = *MEMORY[0x1E69E9840];
  itemCopy = item;
  v11 = IMLogHandleForCategory();
  if (os_log_type_enabled(v11, OS_LOG_TYPE_INFO))
  {
    v84.x = x;
    v84.y = y;
    v12 = NSStringFromCGPoint(v84);
    *buf = 138412546;
    *&buf[4] = itemCopy;
    *&buf[12] = 2112;
    *&buf[14] = v12;
    _os_log_impl(&dword_19020E000, v11, OS_LOG_TYPE_INFO, "_sendStickerForDragItem: dragItem: %@, dropLocation %@", buf, 0x16u);
  }

  *buf = 0;
  *&buf[8] = buf;
  *&buf[16] = 0x5010000000;
  v79 = &unk_190F92BB2;
  v80 = 0u;
  v81 = 0u;
  v82 = 0u;
  if (itemCopy)
  {
    [itemCopy _suggestedTransform];
  }

  v76[0] = 0;
  v76[1] = v76;
  v76[2] = 0x3032000000;
  v76[3] = __Block_byref_object_copy__5;
  v76[4] = __Block_byref_object_dispose__5;
  v77 = [(CKChatController *)self hashKeyForDragItem:itemCopy];
  aBlock[0] = MEMORY[0x1E69E9820];
  aBlock[1] = 3221225472;
  aBlock[2] = __96__CKChatController_CKChatController_Stickers___sendStickerForDragItem_previewSize_dropLocation___block_invoke;
  aBlock[3] = &unk_1E72ECE40;
  aBlock[4] = self;
  v72 = v76;
  v13 = itemCopy;
  v74 = x;
  v75 = y;
  v71 = v13;
  v73 = buf;
  v14 = _Block_copy(aBlock);
  itemProvider = [v13 itemProvider];
  v16 = [itemProvider hasItemConformingToTypeIdentifier:@"com.apple.sticker.mediaPayload"];

  if (v16)
  {
    v17 = MEMORY[0x193AF5EC0](@"_MSMessageMediaPayload", @"Messages");
    itemProvider2 = [v13 itemProvider];
    v68[0] = MEMORY[0x1E69E9820];
    v68[1] = 3221225472;
    v68[2] = __96__CKChatController_CKChatController_Stickers___sendStickerForDragItem_previewSize_dropLocation___block_invoke_275;
    v68[3] = &unk_1E72ECE90;
    v69 = v14;
    v19 = [itemProvider2 loadObjectOfClass:v17 completionHandler:v68];
  }

  else
  {
    itemProvider3 = [v13 itemProvider];
    v21 = [itemProvider3 hasItemConformingToTypeIdentifier:@"com.apple.sticker"];

    if (v21)
    {
      v66[0] = 0;
      v66[1] = v66;
      v66[2] = 0x3032000000;
      v66[3] = __Block_byref_object_copy__5;
      v66[4] = __Block_byref_object_dispose__5;
      v67 = 0;
      v64[0] = 0;
      v64[1] = v64;
      v64[2] = 0x3032000000;
      v64[3] = __Block_byref_object_copy__5;
      v64[4] = __Block_byref_object_dispose__5;
      v65 = 0;
      v62[0] = 0;
      v62[1] = v62;
      v62[2] = 0x3032000000;
      v62[3] = __Block_byref_object_copy__5;
      v62[4] = __Block_byref_object_dispose__5;
      v63 = &stru_1F04268F8;
      v60[0] = 0;
      v60[1] = v60;
      v60[2] = 0x3032000000;
      v60[3] = __Block_byref_object_copy__5;
      v60[4] = __Block_byref_object_dispose__5;
      v61 = 0;
      itemProvider4 = [v13 itemProvider];
      v23 = *MEMORY[0x1E6982F28];
      identifier = [*MEMORY[0x1E6982F28] identifier];
      v25 = [itemProvider4 hasRepresentationConformingToTypeIdentifier:identifier fileOptions:0];

      itemProvider5 = [v13 itemProvider];
      v27 = *MEMORY[0x1E6983020];
      identifier2 = [*MEMORY[0x1E6983020] identifier];
      v29 = [itemProvider5 hasRepresentationConformingToTypeIdentifier:identifier2 fileOptions:0];

      v58[0] = 0;
      v58[1] = v58;
      v58[2] = 0x2020000000;
      v59 = 0;
      v50[0] = MEMORY[0x1E69E9820];
      v50[1] = 3221225472;
      v50[2] = __96__CKChatController_CKChatController_Stickers___sendStickerForDragItem_previewSize_dropLocation___block_invoke_2;
      v50[3] = &unk_1E72ECEB8;
      v52 = v64;
      v53 = v66;
      v54 = v62;
      v55 = v60;
      v51 = v14;
      v56 = width;
      v57 = height;
      v30 = _Block_copy(v50);
      if (v25)
      {
        if (v29)
        {
          itemProvider6 = [v13 itemProvider];
          identifier3 = [v27 identifier];
          v44[0] = MEMORY[0x1E69E9820];
          v44[1] = 3221225472;
          v44[2] = __96__CKChatController_CKChatController_Stickers___sendStickerForDragItem_previewSize_dropLocation___block_invoke_282;
          v44[3] = &unk_1E72ECEE0;
          v46 = v60;
          v47 = v62;
          v48 = v58;
          v49 = v25;
          v45 = v30;
          v33 = [itemProvider6 loadDataRepresentationForTypeIdentifier:identifier3 completionHandler:v44];
        }

        itemProvider7 = [v13 itemProvider];
        identifier4 = [v23 identifier];
        v38[0] = MEMORY[0x1E69E9820];
        v38[1] = 3221225472;
        v38[2] = __96__CKChatController_CKChatController_Stickers___sendStickerForDragItem_previewSize_dropLocation___block_invoke_288;
        v38[3] = &unk_1E72ECF08;
        v40 = v66;
        v41 = v64;
        v42 = v58;
        v43 = v29;
        v39 = v30;
        v36 = [itemProvider7 loadFileRepresentationForTypeIdentifier:identifier4 completionHandler:v38];

        v37 = v39;
      }

      else
      {
        v37 = IMLogHandleForCategory();
        if (os_log_type_enabled(v37, OS_LOG_TYPE_ERROR))
        {
          [CKChatController(CKChatController_Stickers) _sendStickerForDragItem:previewSize:dropLocation:];
        }
      }

      _Block_object_dispose(v58, 8);
      _Block_object_dispose(v60, 8);

      _Block_object_dispose(v62, 8);
      _Block_object_dispose(v64, 8);

      _Block_object_dispose(v66, 8);
    }
  }

  _Block_object_dispose(v76, 8);
  _Block_object_dispose(buf, 8);
}

void __96__CKChatController_CKChatController_Stickers___sendStickerForDragItem_previewSize_dropLocation___block_invoke(uint64_t a1, void *a2, CGFloat a3, CGFloat a4)
{
  v32 = *MEMORY[0x1E69E9840];
  v7 = a2;
  v8 = [*(a1 + 32) activeDropPreviews];
  v9 = [v8 objectForKey:*(*(*(a1 + 48) + 8) + 40)];

  v10 = [v9 _previewContainer];
  if (objc_opt_respondsToSelector())
  {
    v11 = [v9 _previewContainer];

    objc_initWeak(&location, *(a1 + 32));
    if (v11)
    {
      v12 = IMLogHandleForCategory();
      if (os_log_type_enabled(v12, OS_LOG_TYPE_INFO))
      {
        v33.width = a3;
        v33.height = a4;
        v13 = NSStringFromCGSize(v33);
        *buf = 138412546;
        v29 = v7;
        v30 = 2112;
        v31 = v13;
        _os_log_impl(&dword_19020E000, v12, OS_LOG_TYPE_INFO, "Scheduling performAfterDropAnimation to commit sticker %@, size: %@", buf, 0x16u);
      }

      goto LABEL_9;
    }
  }

  else
  {

    objc_initWeak(&location, *(a1 + 32));
  }

  v12 = IMLogHandleForCategory();
  if (os_log_type_enabled(v12, OS_LOG_TYPE_ERROR))
  {
    __96__CKChatController_CKChatController_Stickers___sendStickerForDragItem_previewSize_dropLocation___block_invoke_cold_1();
  }

  v11 = 0;
LABEL_9:

  v18[0] = MEMORY[0x1E69E9820];
  v18[1] = 3221225472;
  v18[2] = __96__CKChatController_CKChatController_Stickers___sendStickerForDragItem_previewSize_dropLocation___block_invoke_263;
  v18[3] = &unk_1E72ECE18;
  v14 = v7;
  v19 = v14;
  objc_copyWeak(&v23, &location);
  v15 = *(a1 + 40);
  v16 = *(a1 + 48);
  v24 = *(a1 + 64);
  v25 = a3;
  v26 = a4;
  v17 = *(a1 + 32);
  v20 = v15;
  v21 = v17;
  v22 = vextq_s8(v16, v16, 8uLL);
  [v11 performAfterDropAnimation:v18];

  objc_destroyWeak(&v23);
  objc_destroyWeak(&location);
}

void __96__CKChatController_CKChatController_Stickers___sendStickerForDragItem_previewSize_dropLocation___block_invoke_263(uint64_t a1)
{
  v21 = *MEMORY[0x1E69E9840];
  v2 = IMLogHandleForCategory();
  if (os_log_type_enabled(v2, OS_LOG_TYPE_INFO))
  {
    v3 = *(a1 + 32);
    LODWORD(v20[0]) = 138412290;
    *(v20 + 4) = v3;
    _os_log_impl(&dword_19020E000, v2, OS_LOG_TYPE_INFO, "performAfterDropAnimation: callback for sticker: %@", v20, 0xCu);
  }

  WeakRetained = objc_loadWeakRetained((a1 + 72));
  [MEMORY[0x1E6979518] begin];
  [MEMORY[0x1E6979518] setDisableActions:1];
  v5 = [*(a1 + 32) stickerPackGUID];

  if (v5)
  {
    v6 = [*(a1 + 32) stickerPackGUID];
    v7 = [v6 length];

    if (!v7)
    {
      v8 = IMLogHandleForCategory();
      if (os_log_type_enabled(v8, OS_LOG_TYPE_ERROR))
      {
        __96__CKChatController_CKChatController_Stickers___sendStickerForDragItem_previewSize_dropLocation___block_invoke_263_cold_1();
      }
    }

    v9 = *(*(a1 + 56) + 8);
    v10 = *(a1 + 32);
    v11 = [MEMORY[0x1E69A82C0] dragItemIsRepositioningSticker:*(a1 + 40)];
    v12 = [*(a1 + 48) _stickerChatItemForDragItem:*(a1 + 40)];
    v13 = *(a1 + 80);
    v14 = *(a1 + 88);
    v15 = *(a1 + 96);
    v16 = *(a1 + 104);
    v17 = v9[3];
    v20[0] = v9[2];
    v20[1] = v17;
    v20[2] = v9[4];
    [WeakRetained _commitSticker:v10 toCoordinate:v20 withInitialSize:v11 dropPreviewTransform:v12 isRepositioningSticker:v13 localStickerChatItem:{v14, v15, v16}];
  }

  else
  {
    v12 = IMLogHandleForCategory();
    if (os_log_type_enabled(v12, OS_LOG_TYPE_ERROR))
    {
      __96__CKChatController_CKChatController_Stickers___sendStickerForDragItem_previewSize_dropLocation___block_invoke_263_cold_2((a1 + 32), a1, v12);
    }
  }

  [MEMORY[0x1E6979518] commit];
  v18 = [WeakRetained activeDropPreviews];
  [v18 removeObjectForKey:*(*(*(a1 + 64) + 8) + 40)];

  v19 = [WeakRetained inputController];
  [v19 stickerDropAnimationFinished];

  [WeakRetained setIgnoresAutomaticScrollsTowardBottom:0];
}

void __96__CKChatController_CKChatController_Stickers___sendStickerForDragItem_previewSize_dropLocation___block_invoke_275(uint64_t a1, void *a2, void *a3)
{
  v5 = a3;
  v6 = a2;
  v7 = IMLogHandleForCategory();
  v8 = v7;
  if (v5)
  {
    if (os_log_type_enabled(v7, OS_LOG_TYPE_ERROR))
    {
      __96__CKChatController_CKChatController_Stickers___sendStickerForDragItem_previewSize_dropLocation___block_invoke_275_cold_1();
    }
  }

  else if (os_log_type_enabled(v7, OS_LOG_TYPE_INFO))
  {
    *buf = 0;
    _os_log_impl(&dword_19020E000, v8, OS_LOG_TYPE_INFO, "Finished loading _MSMessageMediaPayload from item provider.", buf, 2u);
  }

  v9 = [MEMORY[0x1E69A82C0] stickerWithMSMessageMediaPayload:v6];
  [v6 sourceFrame];
  v11 = v10;
  v13 = v12;

  v16[0] = MEMORY[0x1E69E9820];
  v16[1] = 3221225472;
  v16[2] = __96__CKChatController_CKChatController_Stickers___sendStickerForDragItem_previewSize_dropLocation___block_invoke_276;
  v16[3] = &unk_1E72ECE68;
  v14 = *(a1 + 32);
  v17 = v9;
  v18 = v14;
  v19 = v11;
  v20 = v13;
  v15 = v9;
  dispatch_async(MEMORY[0x1E69E96A0], v16);
}

void __96__CKChatController_CKChatController_Stickers___sendStickerForDragItem_previewSize_dropLocation___block_invoke_2(uint64_t a1)
{
  v2 = objc_alloc(MEMORY[0x1E69A82C0]);
  v3 = *(*(*(a1 + 40) + 8) + 40);
  v4 = [MEMORY[0x1E69A8058] defaultEmojiStickerPackID];
  v5 = [v2 initWithStickerID:v3 stickerPackID:v4 fileURL:*(*(*(a1 + 48) + 8) + 40) accessibilityLabel:*(*(*(a1 + 56) + 8) + 40) accessibilityName:0 searchText:0 sanitizedPrompt:0 moodCategory:0 stickerName:0];

  [v5 setExternalURI:*(*(*(a1 + 64) + 8) + 40)];
  block[0] = MEMORY[0x1E69E9820];
  block[1] = 3221225472;
  block[2] = __96__CKChatController_CKChatController_Stickers___sendStickerForDragItem_previewSize_dropLocation___block_invoke_3;
  block[3] = &unk_1E72ECE68;
  v6 = *(a1 + 32);
  v9 = v5;
  v10 = v6;
  v11 = *(a1 + 72);
  v7 = v5;
  dispatch_async(MEMORY[0x1E69E96A0], block);
}

void __96__CKChatController_CKChatController_Stickers___sendStickerForDragItem_previewSize_dropLocation___block_invoke_282(uint64_t a1, void *a2, void *a3)
{
  v23 = *MEMORY[0x1E69E9840];
  v5 = a2;
  v6 = a3;
  if (v5)
  {
    v7 = [MEMORY[0x1E695DF58] currentLocale];
    [v7 localeIdentifier];
    v8 = CEMCreateEmojiLocaleData();

    v9 = [objc_alloc(MEMORY[0x1E696AEC0]) initWithData:v5 encoding:4];
    if (v9)
    {
      v10 = v8 == 0;
    }

    else
    {
      v10 = 1;
    }

    if (v10)
    {
      if (!v8)
      {
        goto LABEL_15;
      }
    }

    else
    {
      v12 = [MEMORY[0x1E696AEC0] stringWithFormat:@"sticker:///emoji/identifier/%@", v9];
      v13 = *(*(a1 + 40) + 8);
      v14 = *(v13 + 40);
      *(v13 + 40) = v12;

      v15 = CEMEmojiTokenCreateWithString();
      if (v15)
      {
        v16 = v15;
        v17 = CEMEmojiTokenCopyName();
        v18 = *(*(a1 + 48) + 8);
        v19 = *(v18 + 40);
        *(v18 + 40) = v17;

        CFRelease(v16);
      }
    }

    CFRelease(v8);
LABEL_15:

    goto LABEL_16;
  }

  v11 = IMLogHandleForCategory();
  if (os_log_type_enabled(v11, OS_LOG_TYPE_INFO))
  {
    *buf = 138412290;
    v22 = v6;
    _os_log_impl(&dword_19020E000, v11, OS_LOG_TYPE_INFO, "emoji sticker drag failed with error: %@", buf, 0xCu);
  }

LABEL_16:
  add = atomic_fetch_add((*(*(a1 + 56) + 8) + 24), 1u);
  if (*(a1 + 64) != 1 || add >= 1)
  {
    (*(*(a1 + 32) + 16))();
  }
}

void __96__CKChatController_CKChatController_Stickers___sendStickerForDragItem_previewSize_dropLocation___block_invoke_288(uint64_t a1, void *a2, void *a3)
{
  v24 = *MEMORY[0x1E69E9840];
  v5 = a2;
  v6 = a3;
  v7 = IMLogHandleForCategory();
  v8 = os_log_type_enabled(v7, OS_LOG_TYPE_INFO);
  if (v5)
  {
    if (v8)
    {
      *buf = 138412290;
      v23 = v5;
      _os_log_impl(&dword_19020E000, v7, OS_LOG_TYPE_INFO, "received emoji sticker drag: %@", buf, 0xCu);
    }

    v9 = MEMORY[0x1E696AEC0];
    v10 = [v5 path];
    v11 = IMSharedHelperMD5HashOfFileAtPath();
    v7 = [v9 stringWithFormat:@"%@-sticker", v11];

    v12 = [v5 pathExtension];
    if (v12)
    {
      v13 = [v7 stringByAppendingPathExtension:v12];

      v7 = v13;
    }

    v14 = [MEMORY[0x1E696AC08] defaultManager];
    v15 = [v14 im_randomTemporaryFileURLWithFileName:v7];

    v16 = [MEMORY[0x1E696AC08] defaultManager];
    v21 = 0;
    v17 = [v16 copyItemAtURL:v5 toURL:v15 error:&v21];
    v18 = v21;

    if ((v17 & 1) == 0)
    {
      v19 = IMLogHandleForCategory();
      if (os_log_type_enabled(v19, OS_LOG_TYPE_ERROR))
      {
        __96__CKChatController_CKChatController_Stickers___sendStickerForDragItem_previewSize_dropLocation___block_invoke_288_cold_1();
      }
    }

    objc_storeStrong((*(*(a1 + 40) + 8) + 40), v15);
    objc_storeStrong((*(*(a1 + 48) + 8) + 40), v7);
    add = atomic_fetch_add((*(*(a1 + 56) + 8) + 24), 1u);
    if (*(a1 + 64) != 1 || add >= 1)
    {
      (*(*(a1 + 32) + 16))();
    }
  }

  else if (v8)
  {
    *buf = 138412290;
    v23 = v6;
    _os_log_impl(&dword_19020E000, v7, OS_LOG_TYPE_INFO, "emoji sticker drag failed with error: %@", buf, 0xCu);
  }
}

- (void)_commitSticker:(id)sticker toCoordinate:(CGPoint)coordinate withInitialSize:(CGSize)size dropPreviewTransform:(CGAffineTransform *)transform
{
  v6 = *&transform->c;
  v7[0] = *&transform->a;
  v7[1] = v6;
  v7[2] = *&transform->tx;
  [(CKChatController *)self _commitSticker:sticker toCoordinate:v7 withInitialSize:0 dropPreviewTransform:0 isRepositioningSticker:coordinate.x localStickerChatItem:coordinate.y, size.width, size.height];
}

- (void)sendSticker:(id)sticker toCoordinate:(CGPoint)coordinate withInitialSize:(CGSize)size dropPreviewTransform:(CGAffineTransform *)transform isRepositioningSticker:(BOOL)repositioningSticker localStickerChatItem:(id)item
{
  v8 = *&transform->c;
  v9[0] = *&transform->a;
  v9[1] = v8;
  v9[2] = *&transform->tx;
  [(CKChatController *)self _commitSticker:sticker toCoordinate:v9 withInitialSize:repositioningSticker dropPreviewTransform:item isRepositioningSticker:coordinate.x localStickerChatItem:coordinate.y, size.width, size.height];
}

- (void)_commitSticker:(id)sticker toCoordinate:(CGPoint)coordinate withInitialSize:(CGSize)size dropPreviewTransform:(CGAffineTransform *)transform isRepositioningSticker:(BOOL)repositioningSticker localStickerChatItem:(id)item
{
  repositioningStickerCopy = repositioningSticker;
  height = size.height;
  width = size.width;
  y = coordinate.y;
  x = coordinate.x;
  v32 = *MEMORY[0x1E69E9840];
  stickerCopy = sticker;
  itemCopy = item;
  v18 = IMLogHandleForCategory();
  if (os_log_type_enabled(v18, OS_LOG_TYPE_INFO))
  {
    v33.x = x;
    v33.y = y;
    v19 = NSStringFromCGPoint(v33);
    v34.width = width;
    v34.height = height;
    v20 = NSStringFromCGSize(v34);
    v21 = NSStringFromBOOL();
    LODWORD(buf.a) = 138413058;
    *(&buf.a + 4) = stickerCopy;
    WORD2(buf.b) = 2112;
    *(&buf.b + 6) = v19;
    HIWORD(buf.c) = 2112;
    *&buf.d = v20;
    LOWORD(buf.tx) = 2112;
    *(&buf.tx + 2) = v21;
    _os_log_impl(&dword_19020E000, v18, OS_LOG_TYPE_INFO, "_commitSticker: %@, coordinate: %@, initialSize: %@ repositioning: %@", &buf, 0x2Au);
  }

  memset(&buf, 0, sizeof(buf));
  [(CKChatController *)self stickerPreviewTransform];
  CGAffineTransformInvert(&buf, &v30);
  t1 = buf;
  memset(&v30, 0, sizeof(v30));
  v22 = *&transform->c;
  *&v28.a = *&transform->a;
  *&v28.c = v22;
  *&v28.tx = *&transform->tx;
  CGAffineTransformConcat(&v30, &t1, &v28);
  v28 = v30;
  memset(&t1, 0, sizeof(t1));
  CGAffineTransformDecompose(&t1, &v28);
  v23 = fmax(t1.a, 0.0);
  if (v23 <= 0.0)
  {
    v24 = 1.0;
  }

  else
  {
    v24 = v23;
  }

  [stickerCopy calculatePreviewScaleWithTargetSize:{width, height}];
  v26 = [CKBrowserDragControllerTarget targetWithScreenCoordinate:0 initialSize:repositioningStickerCopy scale:itemCopy meshScaleFactor:x rotation:y associatedLayoutIntent:width stickerIsRepositioning:height stickerChatItem:v25 * v24, 0.4, t1.d];

  inputController = [(CKCoreChatController *)self inputController];
  [inputController commitSticker:stickerCopy withDragTarget:v26 draggedSticker:0];
}

- (void)_sendNewStickerFromDropSession:(id)session
{
  v37 = *MEMORY[0x1E69E9840];
  sessionCopy = session;
  v5 = [(CKChatController *)self _stickerDropProposalForSession:sessionCopy];
  if (IMOSLoggingEnabled())
  {
    v6 = OSLogHandleForIMFoundationCategory();
    if (os_log_type_enabled(v6, OS_LOG_TYPE_INFO))
    {
      dropSession = [(CKChatController *)self dropSession];
      dragItem = [v5 dragItem];
      [v5 previewCenter];
      v9 = NSStringFromCGPoint(v38);
      targetBalloonIndex = [v5 targetBalloonIndex];
      v29 = 138413058;
      v30 = dropSession;
      v31 = 2112;
      v32 = dragItem;
      v33 = 2112;
      v34 = v9;
      v35 = 2112;
      v36 = targetBalloonIndex;
      _os_log_impl(&dword_19020E000, v6, OS_LOG_TYPE_INFO, "_sendNewStickerFromDropSession: got dropProposal for session: %@, dragItem: %@, previewCenter: %@, targetBalloonIndex: %@", &v29, 0x2Au);
    }
  }

  targetBalloonIndex2 = [v5 targetBalloonIndex];

  if (!targetBalloonIndex2)
  {
    if (IMOSLoggingEnabled())
    {
      v20 = OSLogHandleForIMFoundationCategory();
      if (os_log_type_enabled(v20, OS_LOG_TYPE_INFO))
      {
        dragItem2 = [v5 dragItem];
        dropSession2 = [(CKChatController *)self dropSession];
        v29 = 138412546;
        v30 = dragItem2;
        v31 = 2112;
        v32 = dropSession2;
        _os_log_impl(&dword_19020E000, v20, OS_LOG_TYPE_INFO, "_sendNewStickerFromDropSession: Aborting the sticker drop because there was no valid target balloon sufficiently close to the drop preview for item: %@, drop session: %@.", &v29, 0x16u);
      }
    }

    dragItem3 = [v5 dragItem];
    dragItem5 = [(CKChatController *)self hashKeyForDragItem:dragItem3];

    activeDropPreviews = [(CKChatController *)self activeDropPreviews];
    v25 = [activeDropPreviews objectForKey:dragItem5];

    _previewContainer = [v25 _previewContainer];
    if (objc_opt_respondsToSelector())
    {
      _previewContainer2 = [v25 _previewContainer];

      if (!_previewContainer2)
      {
LABEL_16:
        activeDropPreviews2 = [(CKChatController *)self activeDropPreviews];
        [activeDropPreviews2 removeObjectForKey:dragItem5];

        goto LABEL_17;
      }

      [_previewContainer2 setDefersFinalDropAnimationCompletion:0];
    }

    else
    {
      _previewContainer2 = _previewContainer;
    }

    goto LABEL_16;
  }

  dragItem4 = [v5 dragItem];
  [sessionCopy _previewSizeForVisibleItem:dragItem4];
  v14 = v13;
  v16 = v15;

  dragItem5 = [v5 dragItem];
  [v5 previewCenter];
  [(CKChatController *)self _sendStickerForDragItem:dragItem5 previewSize:v14 dropLocation:v16, v18, v19];
LABEL_17:
}

- (id)cellIndexPathForDragTarget:(id)target
{
  v24 = *MEMORY[0x1E69E9840];
  targetCopy = target;
  collectionViewController = [(CKCoreChatController *)self collectionViewController];
  collectionView = [collectionViewController collectionView];

  window = [collectionView window];
  [targetCopy screenCoordinate];
  [window convertPoint:collectionView toView:?];
  v9 = v8;
  v11 = v10;

  v21 = 0u;
  v22 = 0u;
  v19 = 0u;
  v20 = 0u;
  indexPathsForVisibleItems = [collectionView indexPathsForVisibleItems];
  v13 = [indexPathsForVisibleItems countByEnumeratingWithState:&v19 objects:v23 count:16];
  if (v13)
  {
    v14 = *v20;
    while (2)
    {
      for (i = 0; i != v13; i = i + 1)
      {
        if (*v20 != v14)
        {
          objc_enumerationMutation(indexPathsForVisibleItems);
        }

        v16 = *(*(&v19 + 1) + 8 * i);
        if (![v16 section])
        {
          v17 = [collectionView cellForItemAtIndexPath:v16];
          [v17 frame];
          v26.x = v9;
          v26.y = v11;
          if (CGRectContainsPoint(v27, v26))
          {
            v13 = v16;

            goto LABEL_13;
          }
        }
      }

      v13 = [indexPathsForVisibleItems countByEnumeratingWithState:&v19 objects:v23 count:16];
      if (v13)
      {
        continue;
      }

      break;
    }
  }

LABEL_13:

  return v13;
}

- (void)sendSticker:(id)sticker withMediaObject:(id)object composition:(id)composition parentMessagePartChatItem:(id)item messageSummaryInfo:(id)info
{
  v37 = *MEMORY[0x1E69E9840];
  stickerCopy = sticker;
  objectCopy = object;
  compositionCopy = composition;
  itemCopy = item;
  infoCopy = info;
  if (stickerCopy)
  {
    if (objectCopy)
    {
      if (compositionCopy)
      {
        conversation = [(CKCoreChatController *)self conversation];
        v30 = 0;
        v18 = [conversation canSendComposition:compositionCopy error:&v30];
        v19 = v30;

        if (v18)
        {
          v20 = [CKStickerDropCommSafetySendContext contextWithSticker:stickerCopy composition:compositionCopy mediaObject:objectCopy parentMessagePartChatItem:itemCopy messageSummaryInfo:infoCopy];
          transfer = [objectCopy transfer];
          fileURL = [transfer fileURL];
          v23[0] = MEMORY[0x1E69E9820];
          v23[1] = 3221225472;
          v23[2] = __132__CKChatController_CKChatController_Stickers__sendSticker_withMediaObject_composition_parentMessagePartChatItem_messageSummaryInfo___block_invoke;
          v23[3] = &unk_1E72ECF30;
          v24 = stickerCopy;
          selfCopy = self;
          v26 = objectCopy;
          v27 = compositionCopy;
          v28 = itemCopy;
          v29 = infoCopy;
          [(CKCoreChatController *)self presentCommSafetyInterventionIfNecessaryForFileURL:fileURL withSendContext:v20 completion:v23];
        }

        else
        {
          v20 = IMLogHandleForCategory();
          if (os_log_type_enabled(v20, OS_LOG_TYPE_ERROR))
          {
            *buf = 138412802;
            v32 = compositionCopy;
            v33 = 2112;
            v34 = itemCopy;
            v35 = 2112;
            v36 = v19;
            _os_log_error_impl(&dword_19020E000, v20, OS_LOG_TYPE_ERROR, "Unable to send composition: %@ for messageItem: %@ with error: %@", buf, 0x20u);
          }
        }
      }

      else
      {
        v19 = IMLogHandleForCategory();
        if (os_log_type_enabled(v19, OS_LOG_TYPE_ERROR))
        {
          [CKChatController(CKChatController_Stickers) sendSticker:withMediaObject:composition:parentMessagePartChatItem:messageSummaryInfo:];
        }
      }
    }

    else
    {
      v19 = IMLogHandleForCategory();
      if (os_log_type_enabled(v19, OS_LOG_TYPE_ERROR))
      {
        [CKChatController(CKChatController_Stickers) sendSticker:withMediaObject:composition:parentMessagePartChatItem:messageSummaryInfo:];
      }
    }
  }

  else
  {
    v19 = IMLogHandleForCategory();
    if (os_log_type_enabled(v19, OS_LOG_TYPE_ERROR))
    {
      [CKChatController(CKChatController_Stickers) sendSticker:withMediaObject:composition:parentMessagePartChatItem:messageSummaryInfo:];
    }
  }
}

void __132__CKChatController_CKChatController_Stickers__sendSticker_withMediaObject_composition_parentMessagePartChatItem_messageSummaryInfo___block_invoke(void *a1, int a2)
{
  v13 = *MEMORY[0x1E69E9840];
  if (a2)
  {
    v3 = IMLogHandleForCategory();
    if (os_log_type_enabled(v3, OS_LOG_TYPE_INFO))
    {
      v4 = a1[4];
      v11 = 138412290;
      v12 = v4;
      _os_log_impl(&dword_19020E000, v3, OS_LOG_TYPE_INFO, "Sticker was sensitive, deferring send for intervention: %@", &v11, 0xCu);
    }
  }

  else
  {
    v6 = a1[4];
    v5 = a1[5];
    v7 = a1[6];
    v8 = a1[7];
    v9 = a1[8];
    v10 = a1[9];

    [v5 _sendCommSafetyVerifiedSticker:v6 withMediaObject:v7 composition:v8 parentMessagePartChatItem:v9 messageSummaryInfo:v10];
  }
}

- (void)handleStickerDropConfirmCommSafetySendContext:(id)context
{
  contextCopy = context;
  sticker = [contextCopy sticker];
  mediaObject = [contextCopy mediaObject];
  composition = [contextCopy composition];
  parentMessagePartChatItem = [contextCopy parentMessagePartChatItem];
  messageSummaryInfo = [contextCopy messageSummaryInfo];

  [(CKChatController *)self _sendCommSafetyVerifiedSticker:sticker withMediaObject:mediaObject composition:composition parentMessagePartChatItem:parentMessagePartChatItem messageSummaryInfo:messageSummaryInfo];
}

- (void)_sendCommSafetyVerifiedSticker:(id)sticker withMediaObject:(id)object composition:(id)composition parentMessagePartChatItem:(id)item messageSummaryInfo:(id)info
{
  compositionCopy = composition;
  itemCopy = item;
  infoCopy = info;
  objectCopy = object;
  stickerCopy = sticker;
  objc_opt_class();
  if (objc_opt_isKindOfClass())
  {
    aggregateChatItems = [itemCopy aggregateChatItems];
    firstObject = [aggregateChatItems firstObject];

    itemCopy = firstObject;
  }

  v35 = 0;
  v30 = [compositionCopy superFormatText:&v35];
  v16 = v35;
  v29 = objc_alloc(MEMORY[0x1E69A5BD8]);
  date = [MEMORY[0x1E695DF00] date];
  stringGUID = [MEMORY[0x1E696AEC0] stringGUID];
  iMChatItem = [itemCopy IMChatItem];
  guid = [iMChatItem guid];
  if ([stickerCopy isEmojiSticker])
  {
    v20 = 1001;
  }

  else
  {
    v20 = 1000;
  }

  v31 = compositionCopy;
  messagePartRange = [itemCopy messagePartRange];
  v23 = v22;
  threadIdentifier = [itemCopy threadIdentifier];
  v25 = [v29 initWithSender:0 time:date text:v30 messageSubject:0 fileTransferGUIDs:v16 flags:5 error:0 guid:stringGUID subject:0 associatedMessageGUID:guid associatedMessageType:v20 associatedMessageRange:messagePartRange messageSummaryInfo:v23 threadIdentifier:{infoCopy, threadIdentifier}];

  transfer = [objectCopy transfer];

  [transfer setIMMessage:v25];
  [CKAssociatedStickerChatItem addDroppedSticker:stickerCopy];
  conversation = [(CKCoreChatController *)self conversation];
  [(CKChatController *)self sendMessage:v25 forConversation:conversation newComposition:0];

  [objc_opt_class() donateStickerToRecents:stickerCopy];
}

- (BOOL)repositionSticker:(id)sticker stickerChatItem:(id)item parentMessagePartChatItem:(id)chatItem stickerPositioningInfo:(id)info
{
  v61[1] = *MEMORY[0x1E69E9840];
  stickerCopy = sticker;
  itemCopy = item;
  chatItemCopy = chatItem;
  infoCopy = info;
  mEMORY[0x1E69A8070] = [MEMORY[0x1E69A8070] sharedFeatureFlags];
  LOBYTE(chatItem) = [mEMORY[0x1E69A8070] isStickerRepositioningEnabled];

  if (chatItem)
  {
    v13 = 0;
    if (stickerCopy)
    {
      goto LABEL_3;
    }
  }

  else
  {
    v14 = IMLogHandleForCategory();
    if (os_log_type_enabled(v14, OS_LOG_TYPE_ERROR))
    {
      [CKChatController(CKChatController_Stickers) repositionSticker:stickerChatItem:parentMessagePartChatItem:stickerPositioningInfo:];
    }

    v13 = [MEMORY[0x1E696ABC0] errorWithDomain:@"CKChatControllerStickerErrorDomain" code:1 userInfo:0];
    if (stickerCopy)
    {
LABEL_3:
      if (itemCopy)
      {
        goto LABEL_14;
      }

      goto LABEL_11;
    }
  }

  v15 = IMLogHandleForCategory();
  if (os_log_type_enabled(v15, OS_LOG_TYPE_ERROR))
  {
    [CKChatController(CKChatController_Stickers) repositionSticker:stickerChatItem:parentMessagePartChatItem:stickerPositioningInfo:];
  }

  v16 = [MEMORY[0x1E696ABC0] errorWithDomain:@"CKChatControllerStickerErrorDomain" code:2 userInfo:0];

  v13 = v16;
  if (!itemCopy)
  {
LABEL_11:
    v17 = IMLogHandleForCategory();
    if (os_log_type_enabled(v17, OS_LOG_TYPE_ERROR))
    {
      [CKChatController(CKChatController_Stickers) repositionSticker:stickerChatItem:parentMessagePartChatItem:stickerPositioningInfo:];
    }

    v18 = [MEMORY[0x1E696ABC0] errorWithDomain:@"CKChatControllerStickerErrorDomain" code:3 userInfo:0];

    v13 = v18;
  }

LABEL_14:
  if (!infoCopy)
  {
    v19 = IMLogHandleForCategory();
    if (os_log_type_enabled(v19, OS_LOG_TYPE_ERROR))
    {
      [CKChatController(CKChatController_Stickers) repositionSticker:stickerChatItem:parentMessagePartChatItem:stickerPositioningInfo:];
    }

    v20 = [MEMORY[0x1E696ABC0] errorWithDomain:@"CKChatControllerStickerErrorDomain" code:4 userInfo:0];

    v13 = v20;
  }

  v21 = IMSharedHelperMissingKeysInStickerUserInfo();
  v57 = v21;
  if ([v21 count])
  {
    v22 = IMLogHandleForCategory();
    if (os_log_type_enabled(v22, OS_LOG_TYPE_ERROR))
    {
      [CKChatController(CKChatController_Stickers) repositionSticker:stickerChatItem:parentMessagePartChatItem:stickerPositioningInfo:];
    }

    v23 = [v21 componentsJoinedByString:@" "];
    v24 = MEMORY[0x1E696ABC0];
    v60 = *MEMORY[0x1E696A278];
    v25 = [MEMORY[0x1E696AEC0] stringWithFormat:@"Missing keys: %@", v23];
    v61[0] = v25;
    v26 = [MEMORY[0x1E695DF20] dictionaryWithObjects:v61 forKeys:&v60 count:1];
    v27 = [v24 errorWithDomain:@"CKChatControllerStickerErrorDomain" code:5 userInfo:v26];

    v13 = v27;
  }

  if (v13)
  {
    mEMORY[0x1E69A8168] = [MEMORY[0x1E69A8168] sharedInstance];
    [mEMORY[0x1E69A8168] forceAutoBugCaptureWithSubType:@"Invalid Sticker Reposition" errorPayload:v13];
  }

  else
  {
    selfCopy = self;
    chat = [(CKCoreChatController *)self chat];
    iMChatItem = [itemCopy IMChatItem];
    guid = [iMChatItem guid];
    _stripFZIDPrefix = [guid _stripFZIDPrefix];
    v54 = [chat messageItemForGUID:_stripFZIDPrefix];

    message = [v54 message];
    messageSummaryInfo = [message messageSummaryInfo];
    v56 = [messageSummaryInfo mutableCopy];

    [v56 setValue:infoCopy forKey:*MEMORY[0x1E69A7258]];
    v51 = objc_alloc(MEMORY[0x1E69A5BD8]);
    sender = [message sender];
    time = [message time];
    text = [message text];
    messageSubject = [message messageSubject];
    fileTransferGUIDs = [message fileTransferGUIDs];
    [message guid];
    v35 = v55 = stickerCopy;
    subject = [message subject];
    associatedMessageGUID = [message associatedMessageGUID];
    if ([v55 isEmojiSticker])
    {
      v38 = 1001;
    }

    else
    {
      v38 = 1000;
    }

    messagePartRange = [chatItemCopy messagePartRange];
    v41 = v40;
    threadIdentifier = [message threadIdentifier];
    v52 = [v51 initWithSender:sender time:time text:text messageSubject:messageSubject fileTransferGUIDs:fileTransferGUIDs flags:5 error:0 guid:v35 subject:subject associatedMessageGUID:associatedMessageGUID associatedMessageType:v38 associatedMessageRange:messagePartRange messageSummaryInfo:v41 threadIdentifier:{v56, threadIdentifier}];

    stickerCopy = v55;
    [CKAssociatedStickerChatItem addDroppedSticker:v55];
    conversation = [(CKCoreChatController *)selfCopy conversation];
    iMChatItem2 = [itemCopy IMChatItem];
    [conversation repositionSticker:v52 associatedChatItem:iMChatItem2];

    mEMORY[0x1E69A8168] = v54;
  }

  return v13 == 0;
}

- (id)_originalIndexPathForRepositioningDropSession:(id)session
{
  v19 = *MEMORY[0x1E69E9840];
  v14 = 0u;
  v15 = 0u;
  v16 = 0u;
  v17 = 0u;
  items = [session items];
  v4 = [items countByEnumeratingWithState:&v14 objects:v18 count:16];
  if (v4)
  {
    v5 = v4;
    v6 = *v15;
LABEL_3:
    v7 = 0;
    while (1)
    {
      if (*v15 != v6)
      {
        objc_enumerationMutation(items);
      }

      v8 = *(*(&v14 + 1) + 8 * v7);
      if ([MEMORY[0x1E69A82C0] dragItemIsRepositioningSticker:v8])
      {
        localObject = [v8 localObject];
        objc_opt_class();
        isKindOfClass = objc_opt_isKindOfClass();

        if ((isKindOfClass & 1) == 0)
        {
          goto LABEL_11;
        }

        localObject2 = [v8 localObject];
        v12 = [localObject2 objectForKey:@"kStickerDragItemOriginalIndexPathKey"];

        if (v12)
        {
          break;
        }
      }

      if (v5 == ++v7)
      {
        v5 = [items countByEnumeratingWithState:&v14 objects:v18 count:16];
        if (v5)
        {
          goto LABEL_3;
        }

        goto LABEL_11;
      }
    }
  }

  else
  {
LABEL_11:
    v12 = 0;
  }

  return v12;
}

- (id)_stickerChatItemForDragItem:(id)item
{
  itemCopy = item;
  if ([MEMORY[0x1E69A82C0] dragItemIsRepositioningSticker:itemCopy] && (objc_msgSend(itemCopy, "localObject"), v4 = objc_claimAutoreleasedReturnValue(), objc_opt_class(), isKindOfClass = objc_opt_isKindOfClass(), v4, (isKindOfClass & 1) != 0))
  {
    localObject = [itemCopy localObject];
    v7 = [localObject objectForKey:@"kStickerDragItemChatItemKey"];
  }

  else
  {
    v7 = 0;
  }

  return v7;
}

- (BOOL)_dropSessionIsNewSticker:(id)sticker
{
  v14 = *MEMORY[0x1E69E9840];
  v9 = 0u;
  v10 = 0u;
  v11 = 0u;
  v12 = 0u;
  items = [sticker items];
  v4 = [items countByEnumeratingWithState:&v9 objects:v13 count:16];
  if (v4)
  {
    v5 = *v10;
    while (2)
    {
      for (i = 0; i != v4; ++i)
      {
        if (*v10 != v5)
        {
          objc_enumerationMutation(items);
        }

        v7 = *(*(&v9 + 1) + 8 * i);
        if ([MEMORY[0x1E69A82C0] dragItemIsSticker:v7] && !objc_msgSend(MEMORY[0x1E69A82C0], "dragItemIsRepositioningSticker:", v7))
        {
          LOBYTE(v4) = 1;
          goto LABEL_12;
        }
      }

      v4 = [items countByEnumeratingWithState:&v9 objects:v13 count:16];
      if (v4)
      {
        continue;
      }

      break;
    }
  }

LABEL_12:

  return v4;
}

- (void)_registerRepresentationsInItemProvider:(id)provider sticker:(id)sticker
{
  v21 = *MEMORY[0x1E69E9840];
  providerCopy = provider;
  v16 = 0u;
  v17 = 0u;
  v18 = 0u;
  v19 = 0u;
  representations = [sticker representations];
  v7 = [representations countByEnumeratingWithState:&v16 objects:v20 count:16];
  if (v7)
  {
    v8 = v7;
    v9 = *v17;
    do
    {
      for (i = 0; i != v8; ++i)
      {
        if (*v17 != v9)
        {
          objc_enumerationMutation(representations);
        }

        v11 = *(*(&v16 + 1) + 8 * i);
        type = [v11 type];
        v13 = [providerCopy hasItemConformingToTypeIdentifier:type];

        if ((v13 & 1) == 0)
        {
          type2 = [v11 type];
          v15[0] = MEMORY[0x1E69E9820];
          v15[1] = 3221225472;
          v15[2] = __94__CKChatController_CKChatController_Stickers___registerRepresentationsInItemProvider_sticker___block_invoke;
          v15[3] = &unk_1E72ECF58;
          v15[4] = v11;
          [providerCopy registerItemForTypeIdentifier:type2 loadHandler:v15];
        }
      }

      v8 = [representations countByEnumeratingWithState:&v16 objects:v20 count:16];
    }

    while (v8);
  }
}

void __94__CKChatController_CKChatController_Stickers___registerRepresentationsInItemProvider_sticker___block_invoke(uint64_t a1, void (**a2)(void, void, void))
{
  v3 = *(a1 + 32);
  v4 = a2;
  v5 = [v3 data];
  (a2)[2](v4, v5, 0);
}

- (void)_registerStandardRepresentationsInItemProvider:(id)provider sticker:(id)sticker effectView:(id)view
{
  providerCopy = provider;
  stickerCopy = sticker;
  viewCopy = view;
  v11 = MEMORY[0x193AF5EC0](@"MSSticker", @"Messages");
  fileURL = [stickerCopy fileURL];

  if (fileURL)
  {
    identifier = [*MEMORY[0x1E6982F28] identifier];
    v45[0] = MEMORY[0x1E69E9820];
    v45[1] = 3221225472;
    v45[2] = __113__CKChatController_CKChatController_Stickers___registerStandardRepresentationsInItemProvider_sticker_effectView___block_invoke;
    v45[3] = &unk_1E72ECF80;
    v46 = stickerCopy;
    selfCopy = self;
    [providerCopy registerItemForTypeIdentifier:identifier loadHandler:v45];

    firstObject = v46;
  }

  else
  {
    representations = [stickerCopy representations];
    firstObject = [representations firstObject];

    v16 = [(CKChatController *)self representationForRole:*MEMORY[0x1E69DEA88] sticker:stickerCopy];
    v17 = [(CKChatController *)self representationForRole:*MEMORY[0x1E69DEA78] sticker:stickerCopy];
    if (firstObject && firstObject == v16)
    {
      type = [firstObject type];
      v43[0] = MEMORY[0x1E69E9820];
      v43[1] = 3221225472;
      v43[2] = __113__CKChatController_CKChatController_Stickers___registerStandardRepresentationsInItemProvider_sticker_effectView___block_invoke_2;
      v43[3] = &unk_1E72ECF58;
      v44 = firstObject;
      [providerCopy registerItemForTypeIdentifier:type loadHandler:v43];
    }

    if (v17)
    {
      v30 = v11;
      v32 = v16;
      effect = [viewCopy effect];
      v19 = MEMORY[0x1E69DCAB8];
      data = [v17 data];
      window = [viewCopy window];
      screen = [window screen];
      [screen scale];
      v23 = [v19 imageWithData:data scale:?];

      type2 = [v17 type];
      identifier2 = [*MEMORY[0x1E6982E00] identifier];
      LODWORD(window) = [type2 isEqualToString:identifier2];

      if (window)
      {
        type3 = [v17 type];
        v37[0] = MEMORY[0x1E69E9820];
        v37[1] = 3221225472;
        v37[2] = __113__CKChatController_CKChatController_Stickers___registerStandardRepresentationsInItemProvider_sticker_effectView___block_invoke_3;
        v37[3] = &unk_1E72ECFD0;
        v38 = effect;
        v42 = v30;
        v39 = v23;
        selfCopy2 = self;
        v41 = v17;
        [providerCopy registerItemForTypeIdentifier:type3 loadHandler:v37];
      }

      identifier3 = [*MEMORY[0x1E6982F28] identifier];
      v33[0] = MEMORY[0x1E69E9820];
      v33[1] = 3221225472;
      v33[2] = __113__CKChatController_CKChatController_Stickers___registerStandardRepresentationsInItemProvider_sticker_effectView___block_invoke_5;
      v33[3] = &unk_1E72ECFF8;
      v34 = effect;
      v35 = v23;
      selfCopy3 = self;
      v28 = v23;
      v29 = effect;
      [providerCopy registerItemForTypeIdentifier:identifier3 loadHandler:v33];

      v16 = v32;
    }
  }
}

void __113__CKChatController_CKChatController_Stickers___registerStandardRepresentationsInItemProvider_sticker_effectView___block_invoke(uint64_t a1, void *a2)
{
  v3 = MEMORY[0x1E69DCAB8];
  v4 = *(a1 + 32);
  v5 = a2;
  v6 = [v4 fileURL];
  v7 = [v6 path];
  v8 = [v3 imageWithContentsOfFile:v7];

  [*(a1 + 40) addPNGImage:v8 completion:v5];
}

void __113__CKChatController_CKChatController_Stickers___registerStandardRepresentationsInItemProvider_sticker_effectView___block_invoke_2(uint64_t a1, void (**a2)(void, void, void))
{
  v3 = *(a1 + 32);
  v4 = a2;
  v5 = [v3 data];
  (a2)[2](v4, v5, 0);
}

void __113__CKChatController_CKChatController_Stickers___registerStandardRepresentationsInItemProvider_sticker_effectView___block_invoke_3(uint64_t a1, void *a2, uint64_t a3, void *a4)
{
  v6 = a2;
  v7 = a4;
  if (*(a1 + 32) && [*(a1 + 64) _isHEICSupported])
  {
    v8 = [MEMORY[0x1E69A8070] sharedFeatureFlags];
    v9 = [v8 isStickersAppEnabled];

    if (v9)
    {
      v10 = *(a1 + 32);
      v11 = *(a1 + 40);
      v13[0] = MEMORY[0x1E69E9820];
      v13[1] = 3221225472;
      v13[2] = __113__CKChatController_CKChatController_Stickers___registerStandardRepresentationsInItemProvider_sticker_effectView___block_invoke_4;
      v13[3] = &unk_1E72ECFA8;
      v13[4] = *(a1 + 48);
      v14 = v6;
      [v10 applyToImage:v11 completion:v13];
    }
  }

  else
  {
    v12 = [*(a1 + 56) data];
    (*(v6 + 2))(v6, v12, 0);
  }
}

void __113__CKChatController_CKChatController_Stickers___registerStandardRepresentationsInItemProvider_sticker_effectView___block_invoke_5(uint64_t a1, void *a2, uint64_t a3, void *a4)
{
  v6 = a2;
  v7 = a4;
  if (*(a1 + 32))
  {
    v8 = [MEMORY[0x1E69A8070] sharedFeatureFlags];
    v9 = [v8 isStickersAppEnabled];

    if (v9)
    {
      v10 = *(a1 + 32);
      v11 = *(a1 + 40);
      v12[0] = MEMORY[0x1E69E9820];
      v12[1] = 3221225472;
      v12[2] = __113__CKChatController_CKChatController_Stickers___registerStandardRepresentationsInItemProvider_sticker_effectView___block_invoke_6;
      v12[3] = &unk_1E72ECFA8;
      v12[4] = *(a1 + 48);
      v13 = v6;
      [v10 applyToImage:v11 completion:v12];
    }
  }

  else
  {
    [*(a1 + 48) addPNGImage:*(a1 + 40) completion:v6];
  }
}

- (id)representationForRole:(id)role sticker:(id)sticker
{
  v19 = *MEMORY[0x1E69E9840];
  roleCopy = role;
  v14 = 0u;
  v15 = 0u;
  v16 = 0u;
  v17 = 0u;
  representations = [sticker representations];
  v7 = [representations countByEnumeratingWithState:&v14 objects:v18 count:16];
  if (v7)
  {
    v8 = *v15;
    while (2)
    {
      for (i = 0; i != v7; i = i + 1)
      {
        if (*v15 != v8)
        {
          objc_enumerationMutation(representations);
        }

        v10 = *(*(&v14 + 1) + 8 * i);
        role = [v10 role];
        v12 = [role isEqualToString:roleCopy];

        if (v12)
        {
          v7 = v10;
          goto LABEL_11;
        }
      }

      v7 = [representations countByEnumeratingWithState:&v14 objects:v18 count:16];
      if (v7)
      {
        continue;
      }

      break;
    }
  }

LABEL_11:

  return v7;
}

- (void)addHEICImage:(id)image completion:(id)completion
{
  imageCopy = image;
  completionCopy = completion;
  [image CGImage];
  v8 = IMCreateHEICSImageDataFromCGImageRef();
  completionCopy[2](completionCopy, v8, 0);
}

- (void)addPNGImage:(id)image completion:(id)completion
{
  imageCopy = image;
  completionCopy = completion;
  [image CGImage];
  v8 = IMCreatePNGImageDataFromCGImageRef();
  completionCopy[2](completionCopy, v8, 0);
}

- (void)saveStickerFromChatItem:(id)item pluginSourceView:(id)view animateFlyIn:(BOOL)in
{
  itemCopy = item;
  viewCopy = view;
  if (itemCopy)
  {
    [(CKChatController *)self dismissKeyboard];
    v10 = IMStickersExtensionIdentifier();
    v11 = IMBalloonExtensionIDWithSuffix();

    inputController = [(CKCoreChatController *)self inputController];
    [inputController showPluginWithExtensionIdentifier:v11 sourceView:viewCopy];

    collectionViewController = [(CKCoreChatController *)self collectionViewController];
    collectionView = [collectionViewController collectionView];
    v15 = +[CKUIBehavior sharedBehaviors];
    shouldScrollToSavedSticker = [v15 shouldScrollToSavedSticker];

    if (shouldScrollToSavedSticker)
    {
      [collectionView setIgnoresAutomaticScrollsTowardBottom:1];
      inputController2 = [(CKCoreChatController *)self inputController];
      [inputController2 _appCardHeightWithSafeArea];
      v19 = v18;
      entryView = [(CKChatController *)self entryView];
      [entryView frame];
      v22 = v19 + v21;

      collectionViewController2 = [(CKCoreChatController *)self collectionViewController];
      collectionView2 = [collectionViewController2 collectionView];
      [collectionView2 contentInset];
      v26 = v25;
      v28 = v27;
      v30 = v29;

      [collectionView bounds];
      v61.origin.x = v28 + v31;
      v32 = 0.0;
      v61.origin.y = v26 + 0.0;
      v61.size.width = v33 - (v28 + v30);
      v61.size.height = v34 - (v22 + v26);
      MidY = CGRectGetMidY(v61);
      v36 = [collectionViewController balloonViewForChatItem:itemCopy];
      if (v36)
      {
        view = [(CKChatController *)self view];
        [v36 frame];
        v39 = v38;
        v41 = v40;
        v43 = v42;
        v45 = v44;
        superview = [v36 superview];
        [view convertRect:superview fromView:{v39, v41, v43, v45}];
        v48 = v47;
        v50 = v49;
        v52 = v51;
        v54 = v53;

        *&v62.origin.x = v48;
        *&v62.origin.y = v50;
        *&v62.size.width = v52;
        *&v62.size.height = v54;
        v32 = CGRectGetMidY(v62) - MidY;
      }

      else
      {
        v48 = *MEMORY[0x1E695F058];
        v50 = *(MEMORY[0x1E695F058] + 8);
        v52 = *(MEMORY[0x1E695F058] + 16);
        v54 = *(MEMORY[0x1E695F058] + 24);
      }

      objc_initWeak(location, self);
      v56[0] = MEMORY[0x1E69E9820];
      v56[1] = 3221225472;
      v56[2] = __101__CKChatController_CKChatController_Stickers__saveStickerFromChatItem_pluginSourceView_animateFlyIn___block_invoke;
      v56[3] = &unk_1E72ED020;
      objc_copyWeak(v58, location);
      inCopy = in;
      v58[1] = v48;
      v58[2] = v50;
      v58[3] = v52;
      v58[4] = v54;
      v58[5] = 0;
      v58[6] = *&MidY;
      v57 = itemCopy;
      [(CKChatController *)self fullScreenBalloonViewController:0 verticallyScrollTranscriptByAmount:1 animated:v56 duration:v32 completion:0.3];

      objc_destroyWeak(v58);
      objc_destroyWeak(location);
    }

    else
    {
      v55 = [CKUtilities saveableStickerFromChatItem:itemCopy];
      [(CKChatController *)self saveSticker:v55 sourceRect:*MEMORY[0x1E695F058], *(MEMORY[0x1E695F058] + 8), *(MEMORY[0x1E695F058] + 16), *(MEMORY[0x1E695F058] + 24)];
    }
  }
}

void __101__CKChatController_CKChatController_Stickers__saveStickerFromChatItem_pluginSourceView_animateFlyIn___block_invoke(uint64_t a1)
{
  WeakRetained = objc_loadWeakRetained((a1 + 40));
  v3 = [WeakRetained collectionViewController];
  v4 = [v3 collectionView];
  [v4 setIgnoresAutomaticScrollsTowardBottom:0];

  v5 = (MEMORY[0x1E695F058] + 24);
  v6 = (MEMORY[0x1E695F058] + 16);
  v7 = (MEMORY[0x1E695F058] + 8);
  v8 = (a1 + 48);
  if (*(a1 + 96) == 1)
  {
    v7 = (a1 + 88);
    v6 = (a1 + 64);
    v5 = (a1 + 72);
  }

  else
  {
    v8 = MEMORY[0x1E695F058];
  }

  v9 = *v8;
  v10 = *v5;
  v11 = *v6;
  v12 = *v7;
  v14 = [CKUtilities saveableStickerFromChatItem:*(a1 + 32)];
  v13 = objc_loadWeakRetained((a1 + 40));
  [v13 saveSticker:v14 sourceRect:{v9, v12, v11, v10}];
}

- (void)saveStickerFromTapbackAttributionFlow:(id)flow
{
  flowCopy = flow;
  v5 = IMStickersExtensionIdentifier();
  v7 = IMBalloonExtensionIDWithSuffix();

  inputController = [(CKCoreChatController *)self inputController];
  [inputController showPluginWithExtensionIdentifier:v7 sourceView:0];

  [(CKChatController *)self saveSticker:flowCopy sourceRect:*MEMORY[0x1E695F058], *(MEMORY[0x1E695F058] + 8), *(MEMORY[0x1E695F058] + 16), *(MEMORY[0x1E695F058] + 24)];
}

- (void)saveStickerFromEmojiDetails:(id)details
{
  detailsCopy = details;
  v5 = IMStickersExtensionIdentifier();
  v7 = IMBalloonExtensionIDWithSuffix();

  inputController = [(CKCoreChatController *)self inputController];
  [inputController showPluginWithExtensionIdentifier:v7 sourceView:0];

  [(CKChatController *)self saveSticker:detailsCopy sourceRect:*MEMORY[0x1E695F058], *(MEMORY[0x1E695F058] + 8), *(MEMORY[0x1E695F058] + 16), *(MEMORY[0x1E695F058] + 24)];
}

- (void)saveSticker:(id)sticker sourceRect:(CGRect)rect
{
  height = rect.size.height;
  width = rect.size.width;
  y = rect.origin.y;
  x = rect.origin.x;
  stickerCopy = sticker;
  v10 = stickerCopy;
  if (stickerCopy)
  {
    uiSticker = [stickerCopy uiSticker];
    if (uiSticker)
    {
      v24 = 0;
      v25 = &v24;
      v26 = 0x3032000000;
      v27 = __Block_byref_object_copy__5;
      v28 = __Block_byref_object_dispose__5;
      v29 = 0;
      inputController = [(CKCoreChatController *)self inputController];
      appCardPresentationOverseer = [inputController appCardPresentationOverseer];

      browserViewController = [appCardPresentationOverseer browserViewController];
      v15 = v25[5];
      v25[5] = browserViewController;

      if (v25[5])
      {
        v16 = dispatch_time(0, 500000000);
        block[0] = MEMORY[0x1E69E9820];
        block[1] = 3221225472;
        block[2] = __70__CKChatController_CKChatController_Stickers__saveSticker_sourceRect___block_invoke;
        block[3] = &unk_1E72ED048;
        block[4] = self;
        v20 = x;
        v21 = y;
        v22 = width;
        v23 = height;
        v18 = uiSticker;
        v19 = &v24;
        dispatch_after(v16, MEMORY[0x1E69E96A0], block);
      }

      _Block_object_dispose(&v24, 8);
    }
  }
}

void __112__CKChatController_CKChatController_Stickers___addStickerToStoreWithUISticker_sourceRect_browserViewController___block_invoke(uint64_t a1, void *a2, void *a3)
{
  v12 = *MEMORY[0x1E69E9840];
  v4 = a2;
  v5 = a3;
  if (v5 && IMOSLoggingEnabled())
  {
    v6 = OSLogHandleForIMFoundationCategory();
    if (os_log_type_enabled(v6, OS_LOG_TYPE_INFO))
    {
      v7 = [v5 description];
      v10 = 138412290;
      v11 = v7;
      _os_log_impl(&dword_19020E000, v6, OS_LOG_TYPE_INFO, "Unable to save sticker with error: %@", &v10, 0xCu);
    }
  }

  if (v4 && IMOSLoggingEnabled())
  {
    v8 = OSLogHandleForIMFoundationCategory();
    if (os_log_type_enabled(v8, OS_LOG_TYPE_INFO))
    {
      v9 = [v4 description];
      v10 = 138412290;
      v11 = v9;
      _os_log_impl(&dword_19020E000, v8, OS_LOG_TYPE_INFO, "Stickers added: %@", &v10, 0xCu);
    }
  }
}

- (id)_stickerFromChatItem:(id)item
{
  itemCopy = item;
  if (itemCopy && (objc_opt_class(), (objc_opt_isKindOfClass() & 1) != 0))
  {
    mediaObject = [itemCopy mediaObject];
    objc_opt_class();
    if (objc_opt_isKindOfClass() & 1) != 0 || (objc_opt_class(), (objc_opt_isKindOfClass()))
    {
      sticker = [mediaObject sticker];
    }

    else
    {
      sticker = 0;
    }
  }

  else
  {
    sticker = 0;
  }

  return sticker;
}

- (id)_dragItemsIfRepositioningForInteraction:(id)interaction
{
  v80[4] = *MEMORY[0x1E69E9840];
  interactionCopy = interaction;
  mEMORY[0x1E69A8070] = [MEMORY[0x1E69A8070] sharedFeatureFlags];
  isStickerRepositioningEnabled = [mEMORY[0x1E69A8070] isStickerRepositioningEnabled];

  if (!isStickerRepositioningEnabled)
  {
    selfCopy = 0;
    goto LABEL_18;
  }

  v7 = [(CKChatController *)self _transcriptStickerCellContainingInteraction:interactionCopy];
  if (v7)
  {
    collectionView = [(CKChatController *)self collectionView];
    v9 = [collectionView indexPathForCell:v7];

    collectionViewController = [(CKCoreChatController *)self collectionViewController];
    v11 = [collectionViewController chatItemAtIndexPath:v9];

    associatedItemView = [v7 associatedItemView];
    effectView = [v7 effectView];
    if (!v11 || (objc_opt_class(), (objc_opt_isKindOfClass() & 1) == 0) || ![v11 itemIsFromMe])
    {
      v34 = 1;
LABEL_13:

      if (v34)
      {
        selfCopy = 0;
      }

      else
      {
        selfCopy = self;
      }

      goto LABEL_17;
    }

    v56 = v11;
    sticker = [v56 sticker];
    attributionInfo = [v56 attributionInfo];
    [sticker setAttributionInfo:attributionInfo];

    attributionInfo2 = [v56 attributionInfo];
    v17 = [attributionInfo2 objectForKey:*MEMORY[0x1E69A6F98]];
    [sticker setAccessibilityLabel:v17];

    v58 = objc_alloc_init(MEMORY[0x1E696ACA0]);
    [effectView bounds];
    v19 = *MEMORY[0x1E695F060];
    if (v20 == *MEMORY[0x1E695F060] && (v21 = *(MEMORY[0x1E695F060] + 8), v18 == v21))
    {
      [associatedItemView bounds];
      if (v23 == v19 && v22 == v21)
      {
        superview = [associatedItemView superview];
        [superview frame];
        v26 = v25;
        v28 = v27;
        v30 = v29;
        v32 = v31;

LABEL_24:
        v45 = MEMORY[0x193AF5EC0](@"_MSMessageMediaPayload", @"Messages");
        v46 = objc_opt_class();
        v68[0] = MEMORY[0x1E69E9820];
        v68[1] = 3221225472;
        v68[2] = __87__CKChatController_CKChatController_Stickers___dragItemsIfRepositioningForInteraction___block_invoke;
        v68[3] = &unk_1E72ED090;
        v71 = v45;
        v72 = v26;
        v73 = v28;
        v74 = v30;
        v75 = v32;
        v55 = sticker;
        v69 = v55;
        selfCopy2 = self;
        [v58 registerObjectOfClass:v46 visibility:0 loadHandler:v68];
        [(CKChatController *)self _registerStandardRepresentationsInItemProvider:v58 sticker:v55 effectView:effectView];
        [(CKChatController *)self _registerRepresentationsInItemProvider:v58 sticker:v55];
        [v58 registerItemForTypeIdentifier:@"com.apple.sticker" loadHandler:&__block_literal_global_338];
        v62 = 0;
        v63 = &v62;
        v64 = 0x3032000000;
        v65 = __Block_byref_object_copy__5;
        v66 = __Block_byref_object_dispose__5;
        v67 = 0;
        collectionViewController2 = [(CKCoreChatController *)self collectionViewController];
        chatItems = [collectionViewController2 chatItems];
        v59[0] = MEMORY[0x1E69E9820];
        v59[1] = 3221225472;
        v59[2] = __87__CKChatController_CKChatController_Stickers___dragItemsIfRepositioningForInteraction___block_invoke_3;
        v59[3] = &unk_1E72ED100;
        v54 = v56;
        v60 = v54;
        v61 = &v62;
        [chatItems enumerateObjectsUsingBlock:v59];

        v57 = [objc_alloc(MEMORY[0x1E69DC990]) initWithItemProvider:v58];
        if (v63[5])
        {
          collectionViewController3 = [(CKCoreChatController *)self collectionViewController];
          v50 = [collectionViewController3 cellForChatItem:v63[5]];

          v79[0] = @"kStickerDragItemImageViewKey";
          v79[1] = @"kStickerDragItemChatItemKey";
          v80[0] = associatedItemView;
          v80[1] = v54;
          v79[2] = @"kStickerDragItemOriginalIndexPathKey";
          collectionView2 = [(CKChatController *)self collectionView];
          v52 = [collectionView2 indexPathForCell:v50];
          v79[3] = @"kStickerIsRepositioningKey";
          v80[2] = v52;
          v80[3] = MEMORY[0x1E695E118];
          v53 = [MEMORY[0x1E695DF20] dictionaryWithObjects:v80 forKeys:v79 count:4];
          [v57 setLocalObject:v53];
        }

        else
        {
          v77[0] = @"kStickerDragItemImageViewKey";
          v77[1] = @"kStickerDragItemChatItemKey";
          v78[0] = associatedItemView;
          v78[1] = v54;
          v77[2] = @"kStickerIsRepositioningKey";
          v78[2] = MEMORY[0x1E695E118];
          v50 = [MEMORY[0x1E695DF20] dictionaryWithObjects:v78 forKeys:v77 count:3];
          [v57 setLocalObject:v50];
        }

        v76 = v57;
        self = [MEMORY[0x1E695DEC8] arrayWithObjects:&v76 count:1];

        _Block_object_dispose(&v62, 8);
        v34 = 0;
        goto LABEL_13;
      }

      [associatedItemView center];
      [associatedItemView convertPoint:0 toView:?];
      v37 = v41;
      v39 = v42;
      v40 = associatedItemView;
    }

    else
    {
      [effectView center];
      [effectView convertPoint:0 toView:?];
      v37 = v36;
      v39 = v38;
      v40 = effectView;
    }

    [v40 bounds];
    v30 = v43;
    v32 = v44;
    v26 = v37 - v43 * 0.5;
    v28 = v39 - v44 * 0.5;
    goto LABEL_24;
  }

  selfCopy = 0;
LABEL_17:

LABEL_18:

  return selfCopy;
}

uint64_t __87__CKChatController_CKChatController_Stickers___dragItemsIfRepositioningForInteraction___block_invoke(uint64_t a1, void *a2)
{
  v3 = *(a1 + 48);
  v4 = a2;
  v5 = [[v3 alloc] initWithIMSticker:*(a1 + 32)];
  [v5 setSourceFrame:{*(a1 + 56), *(a1 + 64), *(a1 + 72), *(a1 + 80)}];
  v6 = [*(a1 + 40) initialFrameIndexForCurrentDrag];
  if (v6 != 0x7FFFFFFFFFFFFFFFLL)
  {
    [v5 setInitialFrameIndex:v6];
  }

  [*(a1 + 40) setInitialFrameIndexForCurrentDrag:0x7FFFFFFFFFFFFFFFLL];
  v4[2](v4, v5, 0);

  return 0;
}

void __87__CKChatController_CKChatController_Stickers___dragItemsIfRepositioningForInteraction___block_invoke_2(uint64_t a1, void (**a2)(void, void, void))
{
  v3 = MEMORY[0x1E695DEF0];
  v4 = a2;
  v5 = [v3 data];
  (a2)[2](v4, v5, 0);
}

void __87__CKChatController_CKChatController_Stickers___dragItemsIfRepositioningForInteraction___block_invoke_3(uint64_t a1, void *a2, uint64_t a3, uint64_t a4)
{
  v6 = a2;
  v7 = [v6 visibleAssociatedMessageChatItems];
  v8 = [v7 count];

  if (v8)
  {
    v9 = [v6 visibleAssociatedMessageChatItems];
    v12[0] = MEMORY[0x1E69E9820];
    v12[1] = 3221225472;
    v12[2] = __87__CKChatController_CKChatController_Stickers___dragItemsIfRepositioningForInteraction___block_invoke_4;
    v12[3] = &unk_1E72ED0D8;
    v10 = *(a1 + 32);
    v11 = *(a1 + 40);
    v13 = v10;
    v15 = v11;
    v14 = v6;
    v16 = a4;
    [v9 enumerateObjectsUsingBlock:v12];
  }
}

void __87__CKChatController_CKChatController_Stickers___dragItemsIfRepositioningForInteraction___block_invoke_4(uint64_t a1, void *a2, uint64_t a3, _BYTE *a4)
{
  if ([a2 isEqual:*(a1 + 32)])
  {
    objc_storeStrong((*(*(a1 + 48) + 8) + 40), *(a1 + 40));
    **(a1 + 56) = 1;
    *a4 = 1;
  }
}

- (id)_transcriptStickerCellContainingInteraction:(id)interaction
{
  v23 = *MEMORY[0x1E69E9840];
  interactionCopy = interaction;
  collectionView = [(CKChatController *)self collectionView];
  visibleCells = [collectionView visibleCells];

  v20 = 0u;
  v21 = 0u;
  v18 = 0u;
  v19 = 0u;
  v7 = visibleCells;
  v8 = [v7 countByEnumeratingWithState:&v18 objects:v22 count:16];
  if (v8)
  {
    v9 = v8;
    v10 = *v19;
    do
    {
      for (i = 0; i != v9; ++i)
      {
        if (*v19 != v10)
        {
          objc_enumerationMutation(v7);
        }

        v12 = *(*(&v18 + 1) + 8 * i);
        objc_opt_class();
        if (objc_opt_isKindOfClass())
        {
          v13 = v12;
          associatedItemView = [v13 associatedItemView];
          interactions = [associatedItemView interactions];
          v16 = [interactions containsObject:interactionCopy];

          if (v16)
          {
            goto LABEL_12;
          }
        }
      }

      v9 = [v7 countByEnumeratingWithState:&v18 objects:v22 count:16];
    }

    while (v9);
  }

  v13 = 0;
LABEL_12:

  return v13;
}

- (void)presentStickerDetailControllerWithIndexPath:(id)path
{
  v4 = MEMORY[0x1E695DF70];
  pathCopy = path;
  v6 = objc_alloc_init(v4);
  v7 = [(CKChatController *)self _parentChatItemForIndexPath:pathCopy];

  visibleAssociatedMessageChatItems = [v7 visibleAssociatedMessageChatItems];

  if (visibleAssociatedMessageChatItems)
  {
    visibleAssociatedMessageChatItems2 = [v7 visibleAssociatedMessageChatItems];
    v11[0] = MEMORY[0x1E69E9820];
    v11[1] = 3221225472;
    v11[2] = __103__CKChatController_CKStickerDetailViewControllerDelegate__presentStickerDetailControllerWithIndexPath___block_invoke;
    v11[3] = &unk_1E72EC100;
    v12 = v6;
    [visibleAssociatedMessageChatItems2 enumerateObjectsUsingBlock:v11];
  }

  if ([v6 count])
  {
    v10 = [[CKStickerDetailViewController alloc] initWithStickerChatItems:v6];
    [(CKChatController *)self presentStickerDetailsViewController:v10 fromChatItem:v7];
  }
}

void __103__CKChatController_CKStickerDetailViewControllerDelegate__presentStickerDetailControllerWithIndexPath___block_invoke(uint64_t a1, void *a2)
{
  v3 = a2;
  objc_opt_class();
  if (objc_opt_isKindOfClass())
  {
    [*(a1 + 32) addObject:v3];
  }
}

- (void)presentEmojiDetailsControllerWithIndexPath:(id)path
{
  v9 = [(CKChatController *)self _parentChatItemForIndexPath:path];
  objc_opt_class();
  isKindOfClass = objc_opt_isKindOfClass();
  v5 = v9;
  if (isKindOfClass)
  {
    v6 = v9;
    emojiImageMediaObjectsInMessagePartText = [v6 emojiImageMediaObjectsInMessagePartText];
    if ([emojiImageMediaObjectsInMessagePartText count])
    {
      v8 = [[CKStickerDetailViewController alloc] initWithEmojiImageMediaObjects:emojiImageMediaObjectsInMessagePartText];
      [(CKChatController *)self presentStickerDetailsViewController:v8 fromChatItem:v6];
    }

    v5 = v9;
  }
}

- (void)presentStickerDetailsViewController:(id)controller fromChatItem:(id)item
{
  itemCopy = item;
  controllerCopy = controller;
  [controllerCopy setDelegate:self];
  v12 = [objc_alloc(MEMORY[0x1E69DCCD8]) initWithRootViewController:controllerCopy];

  if (CKIsRunningInMacCatalyst())
  {
    v8 = 7;
  }

  else
  {
    v8 = 2;
  }

  [v12 setModalPresentationStyle:v8];
  collectionViewController = [(CKCoreChatController *)self collectionViewController];
  v10 = [collectionViewController balloonViewForChatItem:itemCopy];

  if (v10)
  {
    popoverPresentationController = [v12 popoverPresentationController];
    [popoverPresentationController setSourceView:v10];

    [(CKChatController *)self presentViewController:v12 animated:1 completion:0];
  }
}

- (void)stickerDetailViewController:(id)controller selectedStickerPackWithAdamID:(id)d
{
  dCopy = d;
  v7[0] = MEMORY[0x1E69E9820];
  v7[1] = 3221225472;
  v7[2] = __117__CKChatController_CKStickerDetailViewControllerDelegate__stickerDetailViewController_selectedStickerPackWithAdamID___block_invoke;
  v7[3] = &unk_1E72EB8D0;
  v7[4] = self;
  v8 = dCopy;
  v6 = dCopy;
  [(CKChatController *)self dismissViewControllerAnimated:1 completion:v7];
}

- (void)saveStickerFromDetailViewController:(id)controller chatItemContainingSticker:(id)sticker
{
  if (sticker)
  {
    [(CKChatController *)self saveStickerFromChatItem:sticker pluginSourceView:0 animateFlyIn:0];
  }
}

- (void)_dealloc
{
  effectPickerViewController = [(CKChatController *)self effectPickerViewController];
  [effectPickerViewController dismissViewControllerAnimated:0 completion:0];

  conversation = [(CKCoreChatController *)self conversation];
  [conversation updateLastViewedDate];

  chat = [(CKCoreChatController *)self chat];
  [chat dismissInlineReplies];

  [(CKScheduledUpdater *)self->_transcriptInlineNotificationUpdater invalidate];
  [(CADisplayLink *)self->_stickerTranscriptScrollDisplayLink invalidate];
  [(CKChatController *)self setStickerTranscriptScrollDisplayLink:0];
  autorotationUpdater = [(CKChatController *)self autorotationUpdater];
  [autorotationUpdater invalidate];

  [(CKChatController *)self setAutorotationUpdater:0];
  typingUpdater = [(CKChatController *)self typingUpdater];
  [typingUpdater invalidate];

  [(CKChatController *)self setTypingUpdater:0];
  [(CKChatController *)self hideMediaPickerAnimated:0];
  collectionViewController = [(CKCoreChatController *)self collectionViewController];
  [collectionViewController setDragInteractionDelegate:0];

  currentDevice = [MEMORY[0x1E69DC938] currentDevice];
  if ([currentDevice _supportsForceTouch])
  {
    v10 = +[CKUIBehavior sharedBehaviors];
    disableTranscriptOrb = [v10 disableTranscriptOrb];

    if (disableTranscriptOrb)
    {
      goto LABEL_5;
    }

    currentDevice = [(CKChatController *)self view];
    [(CKChatController *)self unregisterPreviewSourceView:currentDevice];
  }

LABEL_5:
  v12 = [MEMORY[0x193AF5EC0](@"AFContextManager" @"AssistantServices")];
  [v12 removeContextProvider:self];

  funCameraViewController = [(CKChatController *)self funCameraViewController];

  if (funCameraViewController)
  {
    funCameraViewController2 = [(CKChatController *)self funCameraViewController];
    [funCameraViewController2 dismiss];
  }

  DarwinNotifyCenter = CFNotificationCenterGetDarwinNotifyCenter();
  CFNotificationCenterRemoveObserver(DarwinNotifyCenter, self, @"CKDraftManagerSavedDraft", 0);
  if (!CKIsRunningInMessagesViewService() && !CKIsRunningInMessagesNotificationExtension())
  {
    v16 = +[CKBalloonPluginManager sharedInstance];
    [v16 invalidateAllActivePlugins];

    v17 = +[CKBalloonPluginManager sharedInstance];
    [v17 forceKillRemoteExtensionsWithDelay:1];
  }

  [(CKChatController *)self clearTranslationCache];
}

- (void)dealloc
{
  [(CKChatController *)self _dealloc];
  v3.receiver = self;
  v3.super_class = CKChatController;
  [(CKCoreChatController *)&v3 dealloc];
}

- (void)prepareToDismissForSecondInstance
{
  inputController = [(CKCoreChatController *)self inputController];
  [inputController dismiss];
}

- (CKChatController)initWithConversation:(id)conversation
{
  v48.receiver = self;
  v48.super_class = CKChatController;
  v3 = [(CKCoreChatController *)&v48 initWithConversation:conversation];
  v4 = v3;
  if (v3)
  {
    v3->_keyboardSnapshotReason = 0;
    [(CKChatController *)v3 _updateRecipientCapabilities];
    v5 = [objc_alloc(MEMORY[0x1E69A6158]) initWithTarget:v4 action:sel__autorotationUpdaterFired];
    [(CKChatController *)v4 setAutorotationUpdater:v5];
    [(CKChatController *)v4 setTargetFirstResponder:0];
    v6 = [[CKScheduledUpdater alloc] initWithTarget:v4 action:sel_updateTyping];
    [(CKChatController *)v4 setTypingUpdater:v6];
    if (CKIsRunningInMessages())
    {
      v7 = [[CKScheduledUpdater alloc] initWithTarget:v4 action:sel__updateBannerNotifications];
      transcriptInlineNotificationUpdater = v4->_transcriptInlineNotificationUpdater;
      v4->_transcriptInlineNotificationUpdater = v7;

      [(CKScheduledUpdater *)v4->_transcriptInlineNotificationUpdater setUpdateSynchronouslyIfPossible:1];
      defaultCenter = [MEMORY[0x1E696AD88] defaultCenter];
      [defaultCenter addObserver:v4 selector:sel__handleIsUnexpectedlyLoggedOutChanged_ name:@"com.apple.ChatKit.IsUnexpectedlyLoggedOutChanged" object:0];

      defaultCenter2 = [MEMORY[0x1E696AD88] defaultCenter];
      [defaultCenter2 addObserver:v4 selector:sel_composeRecipientViewShouldResignFirstResponder name:@"com.apple.ChatKit.CKComposeRecipientView.BecameFirstResponder" object:0];

      defaultCenter3 = [MEMORY[0x1E696AD88] defaultCenter];
      [defaultCenter3 addObserver:v4 selector:sel_keyboardShouldShowPredictions_ name:*MEMORY[0x1E69DE048] object:0];

      defaultCenter4 = [MEMORY[0x1E696AD88] defaultCenter];
      [defaultCenter4 addObserver:v4 selector:sel_keyboardShouldShowCandidates_ name:*MEMORY[0x1E69DE040] object:0];

      defaultCenter5 = [MEMORY[0x1E696AD88] defaultCenter];
      [defaultCenter5 addObserver:v4 selector:sel_keyboardWillBeginInteractiveDismissal_ name:*MEMORY[0x1E69DE010] object:0];

      defaultCenter6 = [MEMORY[0x1E696AD88] defaultCenter];
      [defaultCenter6 addObserver:v4 selector:sel_windowDidResignKey_ name:*MEMORY[0x1E69DE7C8] object:0];

      defaultCenter7 = [MEMORY[0x1E696AD88] defaultCenter];
      [defaultCenter7 addObserver:v4 selector:sel__balloonPluginExtensionsLoaded_ name:*MEMORY[0x1E69A56C8] object:0];

      defaultCenter8 = [MEMORY[0x1E696AD88] defaultCenter];
      [defaultCenter8 addObserver:v4 selector:sel__prewarmBalloonPluginViewCacheCompleted_ name:@"__kCKPrewarmBalloonPluginViewCacheCompletedNotification" object:0];

      defaultCenter9 = [MEMORY[0x1E696AD88] defaultCenter];
      [defaultCenter9 addObserver:v4 selector:sel__messageReceived_ name:*MEMORY[0x1E69A5828] object:0];

      defaultCenter10 = [MEMORY[0x1E696AD88] defaultCenter];
      [defaultCenter10 addObserver:v4 selector:sel__handleGroupPhotoChanged_ name:@"CKConversationShowGroupPhotoBannersNotification" object:0];

      defaultCenter11 = [MEMORY[0x1E696AD88] defaultCenter];
      [defaultCenter11 addObserver:v4 selector:sel__handleGroupNameChanged_ name:@"CKConversationShowGroupNameBannersNotification" object:0];

      defaultCenter12 = [MEMORY[0x1E696AD88] defaultCenter];
      [defaultCenter12 addObserver:v4 selector:sel__transferFileTooLarge_ name:@"CKTransferFileTooLargeNotification" object:0];

      defaultCenter13 = [MEMORY[0x1E696AD88] defaultCenter];
      [defaultCenter13 addObserver:v4 selector:sel__handleCollaborationNoticesChanged_ name:*MEMORY[0x1E69A5950] object:0];

      defaultCenter14 = [MEMORY[0x1E696AD88] defaultCenter];
      [defaultCenter14 addObserver:v4 selector:sel__handleTranslationSupportChanged_ name:*MEMORY[0x1E69A6AC0] object:0];

      defaultCenter15 = [MEMORY[0x1E696AD88] defaultCenter];
      [defaultCenter15 addObserver:v4 selector:sel__handleTranslationSettingChanged_ name:*MEMORY[0x1E69A56F0] object:0];

      defaultCenter16 = [MEMORY[0x1E696AD88] defaultCenter];
      [defaultCenter16 addObserver:v4 selector:sel__updateForNewPreferredService name:*MEMORY[0x1E69A5908] object:0];

      defaultCenter17 = [MEMORY[0x1E696AD88] defaultCenter];
      [defaultCenter17 addObserver:v4 selector:sel__updateForNewPreferredService name:*MEMORY[0x1E69A7050] object:0];

      mEMORY[0x1E69A8070] = [MEMORY[0x1E69A8070] sharedFeatureFlags];
      isIntroductionsEnabled = [mEMORY[0x1E69A8070] isIntroductionsEnabled];

      if (isIntroductionsEnabled)
      {
        defaultCenter18 = [MEMORY[0x1E696AD88] defaultCenter];
        [defaultCenter18 addObserver:v4 selector:sel__handleIsFilteredChange name:*MEMORY[0x1E69A5740] object:0];
      }

      DarwinNotifyCenter = CFNotificationCenterGetDarwinNotifyCenter();
      CFNotificationCenterAddObserver(DarwinNotifyCenter, v4, _restoreDraftFromMessagesNotificationExtension, @"CKDraftManagerSavedDraft", v4, CFNotificationSuspensionBehaviorDeliverImmediately);
    }

    defaultCenter19 = [MEMORY[0x1E696AD88] defaultCenter];
    [defaultCenter19 addObserver:v4 selector:sel__handleDictationStarted_ name:@"UIKeyboardDidBeginDictationNotification" object:0];

    defaultCenter20 = [MEMORY[0x1E696AD88] defaultCenter];
    [defaultCenter20 addObserver:v4 selector:sel__handleDictationEnded_ name:*MEMORY[0x1E69DDCC8] object:0];

    defaultCenter21 = [MEMORY[0x1E696AD88] defaultCenter];
    [defaultCenter21 addObserver:v4 selector:sel_keyboardWillChangeFrame_ name:*MEMORY[0x1E69DE068] object:0];

    v4->_shouldBecomeFirstResponderWhenDismissingModalBrowser = 1;
    v33 = objc_opt_new();
    standardSuggestionPresenter = v4->_standardSuggestionPresenter;
    v4->_standardSuggestionPresenter = v33;

    [(SGSuggestionPresenter *)v4->_standardSuggestionPresenter setDelegate:v4];
    v35 = +[CKUIBehavior sharedBehaviors];
    supportsFoundInSuggestions = [v35 supportsFoundInSuggestions];

    if (supportsFoundInSuggestions)
    {
      v37 = objc_opt_new();
      foundInSuggestionPresenter = v4->_foundInSuggestionPresenter;
      v4->_foundInSuggestionPresenter = v37;

      [(SGFoundInSuggestionPresenter *)v4->_foundInSuggestionPresenter setDelegate:v4];
    }

    v39 = [[_TtC7ChatKit16CKChatTipManager alloc] initWithChatController:v4];
    tipManager = v4->_tipManager;
    v4->_tipManager = v39;

    [(CKChatTipManager *)v4->_tipManager setDelegate:v4];
    mEMORY[0x1E69A7FD0] = [MEMORY[0x1E69A7FD0] sharedInstance];
    v4->_shouldFetchCollaborationNotices = [mEMORY[0x1E69A7FD0] isBatchFetchingForLaunchCompleted];

    mEMORY[0x1E69A5B28] = [MEMORY[0x1E69A5B28] sharedInstance];
    [(CKChatController *)v4 setEffectPickerIsPresented:0];
    v43 = objc_alloc_init(MEMORY[0x1E695DF90]);
    [(CKChatController *)v4 setFileURLKeyToGuidMapping:v43];

    dictionary = [MEMORY[0x1E695DF90] dictionary];
    [(CKChatController *)v4 setActiveDropPreviews:dictionary];

    v45 = objc_alloc_init(_TtC7ChatKit25CKSuggestedActionsHandler);
    [(CKChatController *)v4 setSuggestedActionsHandler:v45];

    suggestedActionsHandler = [(CKChatController *)v4 suggestedActionsHandler];
    [suggestedActionsHandler setDelegate:v4];

    [(CKChatController *)v4 setIsWebViewVisible:0];
    [(CKChatController *)v4 setSendingCompositionBackgroundTask:*MEMORY[0x1E69DDBE8]];
  }

  return v4;
}

- (void)_handleGroupPhotoChanged:(id)changed
{
  v28[1] = *MEMORY[0x1E69E9840];
  changedCopy = changed;
  object = [changedCopy object];
  conversation = [(CKCoreChatController *)self conversation];
  shouldDisplayGroupIdentity = [conversation shouldDisplayGroupIdentity];

  if (shouldDisplayGroupIdentity)
  {
    chatIdentifier = [object chatIdentifier];
    chat = [(CKCoreChatController *)self chat];
    chatIdentifier2 = [chat chatIdentifier];
    v11 = [chatIdentifier isEqualToString:chatIdentifier2];

    if (v11)
    {
      userInfo = [changedCopy userInfo];
      v13 = [userInfo valueForKey:@"CKGroupPhotoUpdate"];
      groupPhotoUpdateBanner = [(CKChatController *)self groupPhotoUpdateBanner];

      if (groupPhotoUpdateBanner)
      {
        groupPhotoUpdateBanner2 = [(CKChatController *)self groupPhotoUpdateBanner];
        groupUpdates = [groupPhotoUpdateBanner2 groupUpdates];
        firstObject = [groupUpdates firstObject];
        handleID = [firstObject handleID];

        handleID2 = [v13 handleID];
        v20 = [handleID isEqualToString:handleID2];
        groupPhotoUpdateBanner3 = [(CKChatController *)self groupPhotoUpdateBanner];
        updateBannerType = [groupPhotoUpdateBanner3 updateBannerType];

        if (updateBannerType != 2 && updateBannerType != 4 && v20)
        {
          groupUpdateType = [v13 groupUpdateType];
          v24 = 3;
          v25 = 3;
          if (updateBannerType == 5)
          {
            v25 = 6;
          }

          if (updateBannerType == 1)
          {
            v25 = 7;
          }

          v26 = 3;
          if (updateBannerType == 5)
          {
            v26 = 8;
          }

          if (groupUpdateType == 2)
          {
            v24 = v26;
          }

          if (groupUpdateType == 4)
          {
            v27 = v25;
          }

          else
          {
            v27 = v24;
          }

          [v13 setGroupUpdateType:v27];
        }

        [(CKChatController *)self dimsmissCurrentBannerAndShowNewBannerForGroupUpdate:v13];
      }

      else
      {
        v28[0] = v13;
        handleID = [MEMORY[0x1E695DEC8] arrayWithObjects:v28 count:1];
        [(CKChatController *)self showBannerForGroupUpdate:handleID];
      }
    }
  }
}

- (void)_handleGroupNameChanged:(id)changed
{
  v30[1] = *MEMORY[0x1E69E9840];
  changedCopy = changed;
  object = [changedCopy object];
  chatIdentifier = [object chatIdentifier];
  chat = [(CKCoreChatController *)self chat];
  chatIdentifier2 = [chat chatIdentifier];
  v9 = [chatIdentifier isEqualToString:chatIdentifier2];

  if (v9)
  {
    [(CKChatController *)self _updateTitleAnimated:1];
    if ([(CKChatController *)self shouldUseMacRecipientsView])
    {
      macRecipientsController = [(CKChatController *)self macRecipientsController];
      [macRecipientsController refreshRecipients];
    }

    userInfo = [changedCopy userInfo];
    v12 = [userInfo valueForKey:@"GroupNameUpdate"];
    if (v12)
    {
      null = [MEMORY[0x1E695DFB0] null];

      if (v12 != null)
      {
        groupPhotoUpdateBanner = [(CKChatController *)self groupPhotoUpdateBanner];

        if (groupPhotoUpdateBanner)
        {
          groupPhotoUpdateBanner2 = [(CKChatController *)self groupPhotoUpdateBanner];
          groupUpdates = [groupPhotoUpdateBanner2 groupUpdates];
          firstObject = [groupUpdates firstObject];
          handleID = [firstObject handleID];

          handleID2 = [v12 handleID];
          v20 = [handleID isEqualToString:handleID2];
          groupPhotoUpdateBanner3 = [(CKChatController *)self groupPhotoUpdateBanner];
          updateBannerType = [groupPhotoUpdateBanner3 updateBannerType];

          if ((updateBannerType & 0xFFFFFFFFFFFFFFFBLL) != 1 && v20)
          {
            groupPhotoUpdateBanner4 = [(CKChatController *)self groupPhotoUpdateBanner];
            updateBannerType2 = [groupPhotoUpdateBanner4 updateBannerType];

            groupUpdateType = [v12 groupUpdateType];
            v26 = 3;
            v27 = 3;
            if (updateBannerType2 == 4)
            {
              v27 = 6;
            }

            if (updateBannerType2 == 2)
            {
              v27 = 8;
            }

            v28 = 3;
            if (updateBannerType2 == 4)
            {
              v28 = 7;
            }

            if (groupUpdateType == 1)
            {
              v26 = v28;
            }

            if (groupUpdateType == 5)
            {
              v29 = v27;
            }

            else
            {
              v29 = v26;
            }

            [v12 setGroupUpdateType:v29];
          }

          [(CKChatController *)self dimsmissCurrentBannerAndShowNewBannerForGroupUpdate:v12];
        }

        else
        {
          v30[0] = v12;
          handleID = [MEMORY[0x1E695DEC8] arrayWithObjects:v30 count:1];
          [(CKChatController *)self showBannerForGroupUpdate:handleID];
        }
      }
    }
  }
}

- (void)_messageReceived:(id)received
{
  v28 = *MEMORY[0x1E69E9840];
  receivedCopy = received;
  object = [receivedCopy object];
  personCentricID = [object personCentricID];
  chat = [(CKCoreChatController *)self chat];
  personCentricID2 = [chat personCentricID];
  v9 = [personCentricID isEqualToString:personCentricID2];

  if (v9)
  {
    userInfo = [receivedCopy userInfo];
    v11 = [userInfo objectForKey:*MEMORY[0x1E69A5928]];

    sender = [v11 sender];
    account = [sender account];
    service = [account service];

    if (service)
    {
      conversation = [(CKCoreChatController *)self conversation];
      sendingService = [conversation sendingService];

      if (service != sendingService)
      {
        if (IMOSLoggingEnabled())
        {
          v17 = OSLogHandleForIMFoundationCategory();
          if (os_log_type_enabled(v17, OS_LOG_TYPE_INFO))
          {
            sender2 = [v11 sender];
            account2 = [sender2 account];
            service2 = [account2 service];
            conversation2 = [(CKCoreChatController *)self conversation];
            sendingService2 = [conversation2 sendingService];
            *buf = 138412546;
            v25 = service2;
            v26 = 2112;
            v27 = sendingService2;
            _os_log_impl(&dword_19020E000, v17, OS_LOG_TYPE_INFO, "Refresh service: received a message with service %@ different than current chat service %@", buf, 0x16u);
          }
        }

        chat2 = [(CKCoreChatController *)self chat];
        [chat2 refreshServiceForSending];
      }
    }
  }
}

- (void)_transferFileTooLarge:(id)large
{
  largeCopy = large;
  v5 = CKFrameworkBundle();
  v6 = [v5 localizedStringForKey:@"FILE_TOO_LARGE_TITLE" value:&stru_1F04268F8 table:@"ChatKit"];

  userInfo = [largeCopy userInfo];

  v8 = [userInfo objectForKey:@"kCKTransferFileTooLargeAttachmentURLKey"];
  lastPathComponent = [v8 lastPathComponent];

  if (lastPathComponent)
  {
    v10 = MEMORY[0x1E696AEC0];
    v11 = CKFrameworkBundle();
    v12 = [v11 localizedStringForKey:@"FILE_TOO_LARGE_DESC" value:&stru_1F04268F8 table:@"ChatKit"];
    v13 = [v10 stringWithFormat:v12, lastPathComponent];

    mEMORY[0x1E69DC668] = [MEMORY[0x1E69DC668] sharedApplication];
    userInterfaceLayoutDirection = [mEMORY[0x1E69DC668] userInterfaceLayoutDirection];

    if (userInterfaceLayoutDirection == 1)
    {
      v16 = @"\u200F";
    }

    else
    {
      v16 = @"\u200E";
    }

    v17 = [(__CFString *)v16 stringByAppendingString:v13];
  }

  else
  {
    v13 = CKFrameworkBundle();
    v17 = [v13 localizedStringForKey:@"FILE_TOO_LARGE_NO_NAME_DESC" value:&stru_1F04268F8 table:@"ChatKit"];
  }

  v18 = v17;

  v19 = [CKAlertController alertControllerWithTitle:v6 message:v18 preferredStyle:1];
  v20 = CKFrameworkBundle();
  v21 = [v20 localizedStringForKey:@"OK" value:&stru_1F04268F8 table:@"ChatKit"];
  v22 = [CKAlertAction actionWithTitle:v21 style:1 handler:0];

  [v19 addAction:v22];
  block[0] = MEMORY[0x1E69E9820];
  block[1] = 3221225472;
  block[2] = __42__CKChatController__transferFileTooLarge___block_invoke;
  block[3] = &unk_1E72EB8D0;
  v25 = v19;
  selfCopy = self;
  v23 = v19;
  dispatch_async(MEMORY[0x1E69E96A0], block);
}

- (void)dimsmissCurrentBannerAndShowNewBannerForGroupUpdate:(id)update
{
  updateCopy = update;
  groupPhotoUpdateBanner = [(CKChatController *)self groupPhotoUpdateBanner];
  v7[0] = MEMORY[0x1E69E9820];
  v7[1] = 3221225472;
  v7[2] = __72__CKChatController_dimsmissCurrentBannerAndShowNewBannerForGroupUpdate___block_invoke;
  v7[3] = &unk_1E72EB8D0;
  v7[4] = self;
  v8 = updateCopy;
  v6 = updateCopy;
  [(CKChatController *)self _dismissBannerView:groupPhotoUpdateBanner completion:v7];
}

void __72__CKChatController_dimsmissCurrentBannerAndShowNewBannerForGroupUpdate___block_invoke(uint64_t a1)
{
  v7[1] = *MEMORY[0x1E69E9840];
  [*(a1 + 32) setGroupPhotoUpdateBanner:0];
  [*(a1 + 32) updateScrollGeometryWithoutAnimationForReason:@"BannerDismissed"];
  v2 = [*(a1 + 32) conversation];
  [v2 setShouldShowGroupNameUpdateBanner:0];

  v3 = [*(a1 + 32) conversation];
  [v3 setShouldShowGroupPhotoUpdateBanner:0];

  v4 = *(a1 + 40);
  if (v4)
  {
    v5 = *(a1 + 32);
    v7[0] = v4;
    v6 = [MEMORY[0x1E695DEC8] arrayWithObjects:v7 count:1];
    [v5 showBannerForGroupUpdate:v6];
  }
}

- (id)createBannerForGroupUpdates:(id)updates
{
  v20[1] = *MEMORY[0x1E69E9840];
  updatesCopy = updates;
  firstObject = [updatesCopy firstObject];
  mEMORY[0x1E69A7FD0] = [MEMORY[0x1E69A7FD0] sharedInstance];
  handleID = [firstObject handleID];
  v8 = [mEMORY[0x1E69A7FD0] fetchCNContactForHandleWithID:handleID];

  if (v8)
  {
    v20[0] = v8;
    v9 = [MEMORY[0x1E695DEC8] arrayWithObjects:v20 count:1];
  }

  else
  {
    v9 = MEMORY[0x1E695E0F0];
  }

  v10 = [CKNicknameUtility groupPhotoUpdateTitleForUpdate:firstObject];
  v11 = [CKNicknameUtility groupPhotoUpdateSubtitleForUpdate:firstObject];
  objc_initWeak(&location, self);
  aBlock[0] = MEMORY[0x1E69E9820];
  aBlock[1] = 3221225472;
  aBlock[2] = __48__CKChatController_createBannerForGroupUpdates___block_invoke;
  aBlock[3] = &unk_1E72ED4D8;
  objc_copyWeak(&v18, &location);
  v12 = firstObject;
  v17 = v12;
  v13 = _Block_copy(aBlock);
  v14 = [(CKNicknameBannerView *)[CKGroupUpdateBannerView alloc] initWithStyle:7 updates:0 useNamedTitles:1 avatarImages:0 contacts:v9 customImage:0 titleString:v10 subtitleString:v11 actionButtonTitle:0 actionButtonHandler:0 actionButtonMenuItems:0 xButtonHandler:v13];
  [(CKGroupUpdateBannerView *)v14 setGroupUpdates:updatesCopy];
  -[CKGroupUpdateBannerView setUpdateBannerType:](v14, "setUpdateBannerType:", [v12 groupUpdateType]);

  objc_destroyWeak(&v18);
  objc_destroyWeak(&location);

  return v14;
}

void __48__CKChatController_createBannerForGroupUpdates___block_invoke(uint64_t a1, void *a2)
{
  v3 = a2;
  WeakRetained = objc_loadWeakRetained((a1 + 40));
  [WeakRetained groupPhotoUpdateBanner:v3 dismissedUpdate:*(a1 + 32)];
}

- (void)showBannerForGroupUpdate:(id)update
{
  updateCopy = update;
  firstObject = [updateCopy firstObject];

  if (firstObject)
  {
    v6 = [(CKChatController *)self createBannerForGroupUpdates:updateCopy];
    [(CKChatController *)self setGroupPhotoUpdateBanner:v6];
    firstObject2 = [updateCopy firstObject];
    groupUpdateType = [firstObject2 groupUpdateType];
    groupPhotoUpdateBanner = [(CKChatController *)self groupPhotoUpdateBanner];
    [groupPhotoUpdateBanner setUpdateBannerType:groupUpdateType];

    [(CKChatController *)self showGroupBannerUpdateIfNeeded];
  }

  else if (IMOSLoggingEnabled())
  {
    v10 = OSLogHandleForIMFoundationCategory();
    if (os_log_type_enabled(v10, OS_LOG_TYPE_INFO))
    {
      *v11 = 0;
      _os_log_impl(&dword_19020E000, v10, OS_LOG_TYPE_INFO, "Attempting to show banner for group update, but groupUpdates is empty", v11, 2u);
    }
  }
}

- (void)windowDidResignKey:(id)key
{
  inputController = [(CKCoreChatController *)self inputController];
  if ([inputController isInputViewVisible])
  {
    view = [(CKChatController *)self view];
    window = [view window];
    windowScene = [window windowScene];
    _isKeyWindowScene = [windowScene _isKeyWindowScene];

    if (_isKeyWindowScene)
    {
      return;
    }

    v8 = CKIsAppCardsEnabled();
    inputController2 = [(CKCoreChatController *)self inputController];
    inputController = inputController2;
    if (v8)
    {
      [inputController2 dismissAppCardIfNecessaryAnimated:0 completion:0];
    }

    else
    {
      [inputController2 forceDismissBrowserWithoutAnimation];
    }
  }
}

- (void)registerChatForScreenTime:(id)time
{
  timeCopy = time;
  if (timeCopy)
  {
    v7 = timeCopy;
    isContactLimitsFeatureEnabled = [MEMORY[0x1E69A5B68] isContactLimitsFeatureEnabled];
    timeCopy = v7;
    if (isContactLimitsFeatureEnabled)
    {
      defaultCenter = [MEMORY[0x1E696AD88] defaultCenter];
      [defaultCenter addObserver:self selector:sel_chatAllowedByScreenTimeChanged_ name:*MEMORY[0x1E69A56E8] object:v7];

      [(CKChatController *)self updateScreenTimeShieldIfNeededForChat:v7];
      timeCopy = v7;
    }
  }
}

- (void)unregisterChatForScreenTime:(id)time
{
  timeCopy = time;
  if ([MEMORY[0x1E69A5B68] isContactLimitsFeatureEnabled])
  {
    [(CKChatController *)self removeLockoutControllerIfNeeded];
    if (timeCopy)
    {
      defaultCenter = [MEMORY[0x1E696AD88] defaultCenter];
      [defaultCenter removeObserver:self name:*MEMORY[0x1E69A56E8] object:timeCopy];
    }
  }
}

- (void)chatAllowedByScreenTimeChanged:(id)changed
{
  v13 = *MEMORY[0x1E69E9840];
  changedCopy = changed;
  if ([MEMORY[0x1E69A5B68] isContactLimitsFeatureEnabled])
  {
    object = [changedCopy object];
    objc_opt_class();
    if (objc_opt_isKindOfClass())
    {
      v6 = object;
      if (IMOSLoggingEnabled())
      {
        v7 = OSLogHandleForIMFoundationCategory();
        if (os_log_type_enabled(v7, OS_LOG_TYPE_INFO))
        {
          v8 = [MEMORY[0x1E696AD98] numberWithBool:{objc_msgSend(v6, "allowedByScreenTime")}];
          v9 = 138412546;
          v10 = v6;
          v11 = 2112;
          v12 = v8;
          _os_log_impl(&dword_19020E000, v7, OS_LOG_TYPE_INFO, "chat: %@ received IMChatAllowedByScreenTimeChangedNotification notification, allowed = %@", &v9, 0x16u);
        }
      }

      [(CKChatController *)self updateScreenTimeShieldIfNeededForChat:v6];
    }
  }
}

- (void)updateScreenTimeShieldIfNeededForChat:(id)chat
{
  chatCopy = chat;
  if (chatCopy)
  {
    v5 = chatCopy;
    if ([(CKChatController *)self isChatAllowedByScreenTime:chatCopy])
    {
      [(CKChatController *)self removeLockoutControllerIfNeeded];
    }

    else
    {
      [(CKChatController *)self showScreenTimeShieldIfNeeded];
    }

    chatCopy = v5;
  }
}

- (void)lockoutViewControllerDidFinishDismissing:(id)dismissing
{
  delegate = [(CKCoreChatController *)self delegate];
  v5 = objc_opt_respondsToSelector();

  if (v5)
  {
    delegate2 = [(CKCoreChatController *)self delegate];
    [delegate2 screenTimeOKPressedForChatController:self];
  }

  [(CKChatController *)self _doneButtonPressed];
}

- (void)communicationLimitsDeleteButtonPressed:(id)pressed
{
  v4 = [(CKChatController *)self deleteAlertFor:2];
  [(CKChatController *)self presentViewController:v4 animated:1 completion:0];
}

- (void)communicationLimitsPreviewMessageButtonPressed:(id)pressed
{
  if ([MEMORY[0x1E69A5B68] isContactLimitsFeatureEnabled])
  {
    if ([(CKCoreChatController *)self isShowingLockoutView])
    {
      [(CKCoreChatController *)self setPreviewingChatForScreenTime:1];
      lockoutViewController = [(CKCoreChatController *)self lockoutViewController];
      view = [lockoutViewController view];
      [view removeFromSuperview];

      [lockoutViewController removeFromParentViewController];
      [(CKCoreChatController *)self setLockoutViewController:0];
      [(CKChatController *)self setLockoutView:0];
      [(CKCoreChatController *)self setIsShowingLockoutView:0];
      [(CKChatController *)self reloadFooterViewControllerIfNecessary];
      conversation = [(CKCoreChatController *)self conversation];
      v17.receiver = self;
      v17.super_class = CKChatController;
      [(CKCoreChatController *)&v17 setConversation:conversation forceReload:0];

      view2 = [(CKChatController *)self view];
      chatFooterView = [(CKChatController *)self chatFooterView];
      [view2 bringSubviewToFront:chatFooterView];

      [(CKCoreChatController *)self setMediaObjectToDownload:0];
      [(CKChatController *)self _updateRecipientCapabilities];
      conversation2 = [(CKCoreChatController *)self conversation];
      [(CKChatController *)self setupClickyOrbForConversation:conversation2];

      transcriptNavigationBarController = [(CKChatController *)self transcriptNavigationBarController];
      v11 = +[_TtC7ChatKit29TranscriptNavigationBarChange conversationChange];
      [transcriptNavigationBarController applyChange:v11];

      mEMORY[0x1E69A7FD0] = [MEMORY[0x1E69A7FD0] sharedInstance];
      -[CKChatController setShouldFetchCollaborationNotices:](self, "setShouldFetchCollaborationNotices:", [mEMORY[0x1E69A7FD0] isBatchFetchingForLaunchCompleted]);

      [(CKChatController *)self setEditing:0 animated:0];
      chat = [(CKCoreChatController *)self chat];
      firstUnreadMessageItem = [chat firstUnreadMessageItem];

      guid = [firstUnreadMessageItem guid];
      [(CKChatController *)self setFirstUnreadMessageGUID:guid];

      guid2 = [firstUnreadMessageItem guid];
      [(CKChatController *)self setFirstUnreadMessageGUIDForTextEffects:guid2];

      [(CKChatController *)self addOrRemoveEntryViewIfNeeded];
      [(CKChatController *)self becomeFirstResponder];
      [(CKChatController *)self refreshMacToolbar];
      [(CKChatController *)self reloadInputViews];
    }
  }
}

- (void)_stageFindMyLocationRequest
{
  mEMORY[0x1E69A8070] = [MEMORY[0x1E69A8070] sharedFeatureFlags];
  isWaldoEnabled = [mEMORY[0x1E69A8070] isWaldoEnabled];

  if (isWaldoEnabled)
  {
    v10 = 0;
    v11 = &v10;
    v12 = 0x2050000000;
    v5 = getMSMessageClass_softClass_0;
    v13 = getMSMessageClass_softClass_0;
    if (!getMSMessageClass_softClass_0)
    {
      v9[0] = MEMORY[0x1E69E9820];
      v9[1] = 3221225472;
      v9[2] = __getMSMessageClass_block_invoke_0;
      v9[3] = &unk_1E72EB968;
      v9[4] = &v10;
      __getMSMessageClass_block_invoke_0(v9);
      v5 = v11[3];
    }

    v6 = v5;
    _Block_object_dispose(&v10, 8);
    if (objc_opt_respondsToSelector())
    {
      findMyLocationRequestMessage = [v5 findMyLocationRequestMessage];
      v8 = [CKComposition compositionWithMSMessage:findMyLocationRequestMessage appExtensionIdentifier:*MEMORY[0x1E69A6938]];
      [(CKChatController *)self setComposition:v8];
    }
  }
}

- (void)setConversation:(id)conversation forceReload:(BOOL)reload
{
  reloadCopy = reload;
  conversationCopy = conversation;
  conversation = [(CKCoreChatController *)self conversation];
  chat = [conversation chat];
  [(CKChatController *)self unregisterChatForScreenTime:chat];

  v20.receiver = self;
  v20.super_class = CKChatController;
  [(CKCoreChatController *)&v20 setConversation:conversationCopy forceReload:reloadCopy];
  [(CKCoreChatController *)self setMediaObjectToDownload:0];
  chat2 = [conversationCopy chat];
  [(CKChatController *)self registerChatForScreenTime:chat2];

  customAcknowledgementDebouncer = [(CKChatController *)self customAcknowledgementDebouncer];

  if (!customAcknowledgementDebouncer)
  {
    v11 = objc_alloc_init(CKCustomAcknowledgementDebouncer);
    [(CKChatController *)self setCustomAcknowledgementDebouncer:v11];
  }

  conversation2 = [(CKCoreChatController *)self conversation];
  [(CKChatController *)self setCustomAcknowledgementConversation:conversation2];

  [(CKChatController *)self _updateRecipientCapabilities];
  [(CKChatController *)self setupClickyOrbForConversation:conversationCopy];
  transcriptNavigationBarController = [(CKChatController *)self transcriptNavigationBarController];
  v14 = +[_TtC7ChatKit29TranscriptNavigationBarChange conversationChange];
  [transcriptNavigationBarController applyChange:v14];

  mEMORY[0x1E69A7FD0] = [MEMORY[0x1E69A7FD0] sharedInstance];
  -[CKChatController setShouldFetchCollaborationNotices:](self, "setShouldFetchCollaborationNotices:", [mEMORY[0x1E69A7FD0] isBatchFetchingForLaunchCompleted]);

  [(CKChatController *)self setEditing:0 animated:0];
  chat3 = [(CKCoreChatController *)self chat];
  firstUnreadMessageItem = [chat3 firstUnreadMessageItem];

  guid = [firstUnreadMessageItem guid];
  [(CKChatController *)self setFirstUnreadMessageGUID:guid];

  guid2 = [firstUnreadMessageItem guid];
  [(CKChatController *)self setFirstUnreadMessageGUIDForTextEffects:guid2];
}

- (id)viewToInsertTranscriptCollectionViewBelow
{
  inlineReplyController = [(CKChatController *)self inlineReplyController];

  if (inlineReplyController)
  {
    inlineReplyController2 = [(CKChatController *)self inlineReplyController];
LABEL_5:
    v6 = inlineReplyController2;
    view = [inlineReplyController2 view];

    goto LABEL_6;
  }

  messageEditingViewController = [(CKChatController *)self messageEditingViewController];

  if (messageEditingViewController)
  {
    inlineReplyController2 = [(CKChatController *)self messageEditingViewController];
    goto LABEL_5;
  }

  v9.receiver = self;
  v9.super_class = CKChatController;
  view = [(CKCoreChatController *)&v9 viewToInsertTranscriptCollectionViewBelow];
LABEL_6:

  return view;
}

- (void)forciblyUnloadChatInputController
{
  inputController = [(CKCoreChatController *)self inputController];
  inputViewController = [inputController inputViewController];
  objc_opt_class();
  isKindOfClass = objc_opt_isKindOfClass();

  if (isKindOfClass)
  {
    inputController2 = [(CKCoreChatController *)self inputController];
    inputViewController2 = [inputController2 inputViewController];
    [inputViewController2 setViewController:0];
  }

  [(CKCoreChatController *)self setInputController:0];

  [(CKChatController *)self setEntryView:0];
}

- (BOOL)isHandwritingLandscape
{
  inputController = [(CKCoreChatController *)self inputController];
  isHandwritingLandscape = [inputController isHandwritingLandscape];

  return isHandwritingLandscape;
}

- (void)removeLockoutControllerIfNeeded
{
  v10 = *MEMORY[0x1E69E9840];
  if ([MEMORY[0x1E69A5B68] isContactLimitsFeatureEnabled] && -[CKCoreChatController isShowingLockoutView](self, "isShowingLockoutView"))
  {
    if (IMOSLoggingEnabled())
    {
      v3 = OSLogHandleForIMFoundationCategory();
      if (os_log_type_enabled(v3, OS_LOG_TYPE_INFO))
      {
        chat = [(CKCoreChatController *)self chat];
        v8 = 138412290;
        v9 = chat;
        _os_log_impl(&dword_19020E000, v3, OS_LOG_TYPE_INFO, "removing ScreenTime blocking shield for chat: %@", &v8, 0xCu);
      }
    }

    lockoutViewController = [(CKCoreChatController *)self lockoutViewController];
    view = [lockoutViewController view];
    [view removeFromSuperview];

    [lockoutViewController removeFromParentViewController];
    [(CKCoreChatController *)self setLockoutViewController:0];
    [(CKChatController *)self setLockoutView:0];
    [(CKCoreChatController *)self setIsShowingLockoutView:0];
    conversation = [(CKCoreChatController *)self conversation];
    [(CKChatController *)self setConversation:conversation];

    [(CKChatController *)self addOrRemoveEntryViewIfNeeded];
    [(CKChatController *)self becomeFirstResponder];
    [(CKChatController *)self refreshMacToolbar];
    [(CKChatController *)self reloadInputViews];
  }
}

- (void)showScreenTimeShieldIfNeeded
{
  v31 = *MEMORY[0x1E69E9840];
  if ([MEMORY[0x1E69A5B68] isContactLimitsFeatureEnabled] && -[CKChatController shouldPresentBlockingDowntimeViewController](self, "shouldPresentBlockingDowntimeViewController") && !-[CKCoreChatController isShowingLockoutView](self, "isShowingLockoutView"))
  {
    if (IMOSLoggingEnabled())
    {
      v3 = OSLogHandleForIMFoundationCategory();
      if (os_log_type_enabled(v3, OS_LOG_TYPE_INFO))
      {
        chat = [(CKCoreChatController *)self chat];
        *buf = 138412290;
        v30 = chat;
        _os_log_impl(&dword_19020E000, v3, OS_LOG_TYPE_INFO, "showing ScreenTime blocking shield for chat: %@", buf, 0xCu);
      }
    }

    mEMORY[0x1E69A7FD0] = [MEMORY[0x1E69A7FD0] sharedInstance];
    getContactStore = [mEMORY[0x1E69A7FD0] getContactStore];

    if (!showScreenTimeShieldIfNeeded_CKSTLockoutViewController)
    {
      showScreenTimeShieldIfNeeded_CKSTLockoutViewController = MEMORY[0x193AF5EC0](@"STLockoutViewController", @"ScreenTimeUI");
    }

    conversation = [(CKCoreChatController *)self conversation];
    chat2 = [conversation chat];

    if (chat2)
    {
      v9 = IMSharedDowntimeController();
      conversation2 = [(CKCoreChatController *)self conversation];
      chat3 = [conversation2 chat];
      v12 = [v9 conversationContextForChat:chat3];
      [(CKChatController *)self setConversationContext:v12];
    }

    else if (IMOSLoggingEnabled())
    {
      v13 = OSLogHandleForIMFoundationCategory();
      if (os_log_type_enabled(v13, OS_LOG_TYPE_INFO))
      {
        *buf = 0;
        _os_log_impl(&dword_19020E000, v13, OS_LOG_TYPE_INFO, "Chat is nil when attempting to show screentime shield", buf, 2u);
      }
    }

    conversationContext = [(CKChatController *)self conversationContext];
    if (conversationContext)
    {
      v15 = getContactStore == 0;
    }

    else
    {
      v15 = 1;
    }

    v16 = !v15;

    v17 = showScreenTimeShieldIfNeeded_CKSTLockoutViewController;
    if (v16)
    {
      conversationContext2 = [(CKChatController *)self conversationContext];
      conversation3 = [(CKCoreChatController *)self conversation];
      contactNameByHandle = [conversation3 contactNameByHandle];
      [v17 lockoutViewControllerWithConversationContext:conversationContext2 bundleIdentifier:@"com.apple.MobileSMS" contactStore:getContactStore applicationName:0 contactNameByHandle:contactNameByHandle];
    }

    else
    {
      conversationContext2 = [(CKCoreChatController *)self _handleIDsForCurrentConversation];
      conversation3 = [(CKCoreChatController *)self conversation];
      contactNameByHandle = [conversation3 contactNameByHandle];
      [v17 lockoutViewControllerWithBundleIdentifier:@"com.apple.MobileSMS" contactsHandles:conversationContext2 contactNameByHandle:contactNameByHandle];
    }
    v21 = ;

    if ([(CKCoreChatController *)self isCollapsed])
    {
      [v21 setOkButtonAction:1];
    }

    else
    {
      [v21 setOkButtonAlwaysHidden:1];
    }

    [v21 setViewControllerDelegate:self];
    if (objc_opt_respondsToSelector())
    {
      [v21 setCommunicationLimitsDelegate:self];
    }

    view = [v21 view];
    [(CKChatController *)self setLockoutView:view];

    [(CKCoreChatController *)self setLockoutViewController:v21];
    view2 = [(CKChatController *)self view];
    lockoutView = [(CKChatController *)self lockoutView];
    [view2 addSubview:lockoutView];

    [(CKChatController *)self addChildViewController:v21];
    [(CKCoreChatController *)self setIsShowingLockoutView:1];
    [(CKChatController *)self addOrRemoveEntryViewIfNeeded];
    view3 = [(CKChatController *)self view];
    [view3 setNeedsLayout];

    view4 = [(CKChatController *)self view];
    [view4 layoutIfNeeded];

    [(CKChatController *)self reloadInputViews];
    objc_initWeak(buf, self);
    block[0] = MEMORY[0x1E69E9820];
    block[1] = 3221225472;
    block[2] = __48__CKChatController_showScreenTimeShieldIfNeeded__block_invoke;
    block[3] = &unk_1E72EC460;
    objc_copyWeak(&v28, buf);
    dispatch_async(MEMORY[0x1E69E96A0], block);
    [(CKChatController *)self refreshMacToolbar];
    objc_destroyWeak(&v28);
    objc_destroyWeak(buf);
  }
}

void __48__CKChatController_showScreenTimeShieldIfNeeded__block_invoke(uint64_t a1)
{
  WeakRetained = objc_loadWeakRetained((a1 + 32));
  v1 = [WeakRetained view];
  v2 = [v1 window];
  v3 = [v2 firstResponder];
  [v3 resignFirstResponder];
}

- (void)setCollectionViewController:(id)controller
{
  controllerCopy = controller;
  v11.receiver = self;
  v11.super_class = CKChatController;
  [(CKCoreChatController *)&v11 setCollectionViewController:controllerCopy];
  collectionViewController = [(CKCoreChatController *)self collectionViewController];
  [collectionViewController setDragInteractionDelegate:self];

  entryView = [(CKChatController *)self entryView];
  if (entryView)
  {
    v7 = entryView;
    collectionView = [controllerCopy collectionView];

    if (collectionView)
    {
      entryView2 = [(CKChatController *)self entryView];
      collectionView2 = [controllerCopy collectionView];
      [entryView2 configurePocketInteractionForScrollView:collectionView2];
    }
  }
}

- (void)loadView
{
  v10.receiver = self;
  v10.super_class = CKChatController;
  [(CKCoreChatController *)&v10 loadView];
  currentDevice = [MEMORY[0x1E69DC938] currentDevice];
  if (![currentDevice _supportsForceTouch])
  {
    goto LABEL_4;
  }

  v4 = +[CKUIBehavior sharedBehaviors];
  disableTranscriptOrb = [v4 disableTranscriptOrb];

  if ((disableTranscriptOrb & 1) == 0)
  {
    currentDevice = [(CKChatController *)self view];
    [(CKChatController *)self registerPreviewSourceView:currentDevice previewingDelegate:self];
LABEL_4:
  }

  navigationItem = [(CKChatController *)self navigationItem];
  [navigationItem setLargeTitleDisplayMode:2];

  [(CKChatController *)self _updateNavigationUI];
  v7 = [objc_alloc(MEMORY[0x1E69DC9B8]) initWithDelegate:self];
  [v7 setAllowsSimultaneousDropSessions:1];
  view = [(CKChatController *)self view];
  [view addInteraction:v7];

  transcriptInlineNotificationUpdater = [(CKChatController *)self transcriptInlineNotificationUpdater];
  [transcriptInlineNotificationUpdater setNeedsUpdate];
}

- (void)viewDidLoad
{
  v12[1] = *MEMORY[0x1E69E9840];
  v10.receiver = self;
  v10.super_class = CKChatController;
  [(CKCoreChatController *)&v10 viewDidLoad];
  [(CKChatController *)self _prepareNavigationBarOnLoad];
  v3 = +[CKBalloonPluginManager sharedInstance];
  [v3 addExtensionConsumer:self];

  v12[0] = objc_opt_class();
  v4 = [MEMORY[0x1E695DEC8] arrayWithObjects:v12 count:1];
  v5 = [(CKChatController *)self registerForTraitChanges:v4 withHandler:&__block_literal_global_30];

  mEMORY[0x1E69A8070] = [MEMORY[0x1E69A8070] sharedFeatureFlags];
  isTranscriptBackgroundsEnabled = [mEMORY[0x1E69A8070] isTranscriptBackgroundsEnabled];

  if (isTranscriptBackgroundsEnabled)
  {
    v11[0] = objc_opt_class();
    v11[1] = objc_opt_class();
    v11[2] = objc_opt_class();
    v11[3] = objc_opt_class();
    v8 = [MEMORY[0x1E695DEC8] arrayWithObjects:v11 count:4];
    v9 = [(CKChatController *)self registerForTraitChanges:v8 withHandler:&__block_literal_global_669];
  }
}

void __31__CKChatController_viewDidLoad__block_invoke(uint64_t a1, void *a2)
{
  v2 = a2;
  [v2 _updateEntryViewConstraintsIfNeeded];
  [v2 _setUpEntryViewAppCardLayoutConstraint];
  [v2 updateActiveEntryViewPositioningGuide];
}

- (void)transcriptCollectionViewControllerDidInset:(id)inset
{
  v5.receiver = self;
  v5.super_class = CKChatController;
  [(CKCoreChatController *)&v5 transcriptCollectionViewControllerDidInset:inset];
  transcriptInlineNotificationUpdater = [(CKChatController *)self transcriptInlineNotificationUpdater];
  [transcriptInlineNotificationUpdater setNeedsUpdate];

  [(CKChatController *)self scrollTranscriptToAlignWithMessageEditingBalloonView];
}

- (void)_traitsAffectingBarAppearanceDidChange
{
  [(CKChatController *)self _updateNavigationButtons];
  traitCollection = [(CKChatController *)self traitCollection];
  isTranscriptBackgroundActive = [traitCollection isTranscriptBackgroundActive];
  isDiffusedSystemGlassSettingEnabled = [traitCollection isDiffusedSystemGlassSettingEnabled];
  ck_systemUserInterfaceStyle = 0;
  if (isTranscriptBackgroundActive && isDiffusedSystemGlassSettingEnabled)
  {
    traitCollection2 = [(CKChatController *)self traitCollection];
    ck_systemUserInterfaceStyle = [traitCollection2 ck_systemUserInterfaceStyle];
  }

  transcriptNavigationBarController = [(CKChatController *)self transcriptNavigationBarController];
  [transcriptNavigationBarController setOverrideUserInterfaceStyle:ck_systemUserInterfaceStyle];

  collectionView = [(CKChatController *)self collectionView];
  bottomEdgeEffect = [collectionView bottomEdgeEffect];

  if (objc_opt_respondsToSelector())
  {
    [bottomEdgeEffect _setFixedUserInterfaceStyle:ck_systemUserInterfaceStyle];
  }
}

- (void)_updateNotificationBannerOfType:(int64_t)type show:(BOOL)show
{
  showCopy = show;
  v58 = *MEMORY[0x1E69E9840];
  if (IMOSLoggingEnabled())
  {
    v8 = OSLogHandleForIMFoundationCategory();
    if (os_log_type_enabled(v8, OS_LOG_TYPE_INFO))
    {
      v9 = [MEMORY[0x1E696AD98] numberWithInteger:type];
      v55[0] = 67109378;
      v55[1] = showCopy;
      v56 = 2112;
      v57 = v9;
      _os_log_impl(&dword_19020E000, v8, OS_LOG_TYPE_INFO, "Update banner notification show:%d type:%@", v55, 0x12u);
    }
  }

  if (!showCopy)
  {
    if ([(CKChatController *)self notificationBannerType]!= type)
    {
      if ([(CKChatController *)self notificationBannerType]!= type)
      {
        return;
      }

LABEL_17:
      notificationBannerView = [(CKChatController *)self notificationBannerView];
      if (notificationBannerView)
      {
        v12 = [(CKChatController *)self notificationBannerType]== type;

        if (!v12)
        {
          notificationBannerView2 = [(CKChatController *)self notificationBannerView];
          [notificationBannerView2 removeFromSuperview];

          [(CKChatController *)self setNotificationBannerView:0];
        }
      }

      [(CKChatController *)self setNotificationBannerType:type];
      notificationBannerView3 = [(CKChatController *)self notificationBannerView];
      v15 = notificationBannerView3 == 0;

      if (!v15)
      {
LABEL_35:
        view = [(CKChatController *)self view];
        notificationBannerView4 = [(CKChatController *)self notificationBannerView];
        [view bringSubviewToFront:notificationBannerView4];

        view2 = [(CKChatController *)self view];
        [view2 bounds];
        v25 = v24;
        v27 = v26;

        view3 = [(CKChatController *)self view];
        [view3 safeAreaInsets];
        v30 = v29;
        view4 = [(CKChatController *)self view];
        [view4 safeAreaInsets];
        v33 = v32;

        view5 = [(CKChatController *)self view];
        [view5 safeAreaInsets];
        v36 = v35;
        view6 = [(CKChatController *)self view];
        [view6 safeAreaInsets];
        v39 = v38;

        notificationBannerView5 = [(CKChatController *)self notificationBannerView];
        [notificationBannerView5 sizeThatFits:{v25 - (v30 + v33), v27 - (v36 + v39)}];
        v42 = v41;
        v44 = v43;

        scrollView = [(CKCoreChatController *)self scrollView];
        [scrollView contentInset];
        v47 = v46;

        mEMORY[0x1E69A8070] = [MEMORY[0x1E69A8070] sharedFeatureFlags];
        LODWORD(scrollView) = [mEMORY[0x1E69A8070] isModernSplitViewControllerEnabled];

        v49 = v47 - v44;
        if (scrollView)
        {
          view7 = [(CKChatController *)self view];
          [view7 safeAreaInsets];
          v52 = v51;
          notificationBannerView6 = [(CKChatController *)self notificationBannerView];
          [notificationBannerView6 setFrame:{v52, v49, v42, v44}];
        }

        else
        {
          notificationBannerView7 = [(CKChatController *)self notificationBannerView];
          [notificationBannerView7 setFrame:{0.0, v49, v42, v44}];
        }

        return;
      }

      if (type <= 1)
      {
        if (!type)
        {
          currentHandler = [MEMORY[0x1E696AAA8] currentHandler];
          [currentHandler handleFailureInMethod:a2 object:self file:@"CKChatController.m" lineNumber:2067 description:@"This case should have been already filtered out"];
          goto LABEL_32;
        }

        if (type == 1)
        {
          currentHandler = +[_TtC7ChatKit19CKBannerViewFactory unexpectedlyLoggedOutBanner];
          [(CKChatController *)self setNotificationBannerView:currentHandler];
          goto LABEL_32;
        }
      }

      else
      {
        switch(type)
        {
          case 4:
            currentHandler = +[_TtC7ChatKit19CKBannerViewFactory notDefaultTextingAppBanner];
            [(CKChatController *)self setNotificationBannerView:currentHandler];
            goto LABEL_32;
          case 3:
            currentHandler = +[_TtC7ChatKit19CKBannerViewFactory updateAppleIDSettingsBanner];
            [(CKChatController *)self setNotificationBannerView:currentHandler];
            goto LABEL_32;
          case 2:
            currentHandler = +[_TtC7ChatKit19CKBannerViewFactory waitingForCloudBanner];
            [(CKChatController *)self setNotificationBannerView:currentHandler];
LABEL_32:

            break;
        }
      }

      notificationBannerView8 = [(CKChatController *)self notificationBannerView];
      v18 = notificationBannerView8 == 0;

      if (v18)
      {
        return;
      }

      view8 = [(CKChatController *)self view];
      notificationBannerView9 = [(CKChatController *)self notificationBannerView];
      [view8 addSubview:notificationBannerView9];

      goto LABEL_35;
    }

LABEL_15:
    notificationBannerView10 = [(CKChatController *)self notificationBannerView];
    [notificationBannerView10 removeFromSuperview];

    [(CKChatController *)self setNotificationBannerView:0];
    [(CKChatController *)self setNotificationBannerType:0];
    return;
  }

  if (!type)
  {
    goto LABEL_15;
  }

  if ([(CKChatController *)self notificationBannerType]<= type && (type != 1 || (CKIsAppleIDNotUpdated() & 1) == 0 && (CKIsWaitingForCloud() & 1) == 0 && (IMGetUserIgnoreFailureWaitingForCloudIntent() & 1) == 0 && (IMGetUserIgnoreFailureUpdateAppleIDIntent() & 1) == 0))
  {
    goto LABEL_17;
  }
}

- (void)insertInitialCompositionIfNeeded
{
  initialComposition = [(CKChatController *)self initialComposition];
  if (initialComposition)
  {
    v4 = initialComposition;
    [(CKChatController *)self setInitialComposition:0];
    [(CKChatController *)self setComposition:v4];
    initialComposition = v4;
  }
}

- (void)viewDidLayoutSubviews
{
  initialLayoutComplete = [(CKCoreChatController *)self initialLayoutComplete];
  v102.receiver = self;
  v102.super_class = CKChatController;
  [(CKCoreChatController *)&v102 viewDidLayoutSubviews];
  if (__CurrentTestName && (objc_opt_respondsToSelector() & 1) != 0)
  {
    defaultCenter = [MEMORY[0x1E696AD88] defaultCenter];
    [defaultCenter postNotificationName:@"PPTDidLayoutConversationEvent" object:0 userInfo:0];
  }

  if ([(CKCoreChatController *)self initialLayoutComplete])
  {
    view = [(CKChatController *)self view];
    [view bounds];
    [(CKChatController *)self _invalidateChatItemLayoutIfNecessary:v6, v7];
  }

  macToolbarController2 = +[CKUIBehavior sharedBehaviors];
  if (![macToolbarController2 useMacToolbar])
  {
    goto LABEL_15;
  }

  showingInStandAloneWindow = [(CKCoreChatController *)self showingInStandAloneWindow];

  if (showingInStandAloneWindow)
  {
    view2 = [(CKChatController *)self view];
    window = [view2 window];
    [window frame];
    v13 = v12;
    v15 = v14;
    v17 = v16;
    v19 = v18;

    macToolbarController = [(CKCoreChatController *)self macToolbarController];
    [macToolbarController updateWithFrame:{v13, v15, v17, v19}];

    view3 = [(CKChatController *)self view];
    _shouldReverseLayoutDirection = [view3 _shouldReverseLayoutDirection];

    view4 = [(CKChatController *)self view];
    [view4 safeAreaInsets];
    if (_shouldReverseLayoutDirection)
    {
      v26 = v17;
    }

    else
    {
      v26 = 0.0;
    }

    if (_shouldReverseLayoutDirection)
    {
      v27 = v24;
    }

    else
    {
      v27 = v17 - v25;
    }

    macToolbarController2 = [(CKCoreChatController *)self macToolbarController];
    [macToolbarController2 updateDividersForSidebarPosition:v26 inspectorPosition:v27];
LABEL_15:
  }

  collectionViewController = [(CKCoreChatController *)self collectionViewController];
  collectionView = [collectionViewController collectionView];

  view5 = [(CKChatController *)self view];
  [view5 bounds];
  v32 = v31;
  v34 = v33;

  if ([(CKChatController *)self needToEnforceScrollIntent])
  {
    [(CKChatController *)self lastLaidOutSize];
    if (v32 != v36 || v34 != v35)
    {
      [(CKChatController *)self setNeedToEnforceScrollIntent:0];
      v37 = +[CKScrollViewAnimationProperties inheritedAnimation];
      [collectionView enforceTranscriptScrollIntentWithAnimationProperties:v37];
    }
  }

  [(CKChatController *)self setLastLaidOutSize:v32, v34];
  [(CKChatController *)self insertInitialCompositionIfNeeded];
  if ([(CKCoreChatController *)self viewIsVisible]&& [(CKChatController *)self targetFirstResponder]== 1)
  {
    [(CKChatController *)self becomeFirstResponder];
  }

  inlineReplyController = [(CKChatController *)self inlineReplyController];

  if (inlineReplyController)
  {
    inlineReplyController2 = [(CKChatController *)self inlineReplyController];
    view6 = [inlineReplyController2 view];
    view7 = [(CKChatController *)self view];
    [view7 bounds];
    [view6 setFrame:?];
  }

  messageEditingViewController = [(CKChatController *)self messageEditingViewController];

  if (messageEditingViewController)
  {
    view8 = [(CKChatController *)self view];
    [view8 bounds];
    v45 = v44;
    v47 = v46;
    v49 = v48;
    v51 = v50;

    messageEditingViewController2 = [(CKChatController *)self messageEditingViewController];
    view9 = [messageEditingViewController2 view];
    [view9 setFrame:{v45, v47, v49, v51}];
  }

  v54 = [(CKChatController *)self activeSendMenuPresentationForChatController:self];
  [v54 layout];
  view10 = [(CKChatController *)self view];
  [view10 bounds];
  v57 = v56;
  v59 = v58;
  v61 = v60;
  v63 = v62;

  entryViewContainerView = [(CKChatController *)self entryViewContainerView];
  [entryViewContainerView setFrame:{v57, v59, v61, v63}];

  [(CKChatController *)self _marginInsetsForEntryView];
  v66 = v65;
  v68 = v67;
  v70 = v69;
  v72 = v71;
  entryView = [(CKChatController *)self entryView];
  [entryView setMarginInsets:{v66, v68, v70, v72}];

  v74 = +[CKUIBehavior sharedBehaviors];
  entryViewFollowsKeyboardLayoutGuide = [v74 entryViewFollowsKeyboardLayoutGuide];

  if ((entryViewFollowsKeyboardLayoutGuide & 1) == 0)
  {
    entryView2 = [(CKChatController *)self entryView];
    entryView3 = [(CKChatController *)self entryView];
    [entryView3 frame];
    [entryView2 setFrame:?];
  }

  if (!initialLayoutComplete)
  {
    scrollBlock = [(CKChatController *)self scrollBlock];

    if (scrollBlock)
    {
      scrollBlock2 = [(CKChatController *)self scrollBlock];
      scrollBlock2[2]();

      [(CKChatController *)self setScrollBlock:0];
    }
  }

  transcriptInlineNotificationUpdater = [(CKChatController *)self transcriptInlineNotificationUpdater];
  [transcriptInlineNotificationUpdater setNeedsUpdate];

  currentNavigationBarBasedOnSizeClass = [(CKChatController *)self currentNavigationBarBasedOnSizeClass];
  v82 = +[CKUIBehavior sharedBehaviors];
  theme = [v82 theme];
  [currentNavigationBarBasedOnSizeClass setBarStyle:{objc_msgSend(theme, "navBarStyle")}];

  nicknameBanner = [(CKChatController *)self nicknameBanner];

  if (nicknameBanner)
  {
    nicknameBanner2 = [(CKChatController *)self nicknameBanner];
  }

  else
  {
    groupPhotoUpdateBanner = [(CKChatController *)self groupPhotoUpdateBanner];

    if (groupPhotoUpdateBanner)
    {
      nicknameBanner2 = [(CKChatController *)self groupPhotoUpdateBanner];
    }

    else
    {
      acceptedContactBanner = [(CKChatController *)self acceptedContactBanner];

      if (!acceptedContactBanner)
      {
        goto LABEL_41;
      }

      nicknameBanner2 = [(CKChatController *)self acceptedContactBanner];
    }
  }

  acceptedContactBanner = nicknameBanner2;
  if (nicknameBanner2 && !self->_shouldOverrideBannerFrameOnPopTransition)
  {
    [nicknameBanner2 setNeedsLayout];
    [acceptedContactBanner layoutIfNeeded];
    [(CKChatController *)self _layoutBannerView:acceptedContactBanner];
  }

LABEL_41:
  if ([(CKCoreChatController *)self isShowingLockoutView])
  {
    lockoutView = [(CKChatController *)self lockoutView];

    if (lockoutView)
    {
      [(CKChatController *)self layoutLockoutView];
    }
  }

  [(CKChatController *)self layoutFooterView];
  loadingIndicatorCoverView = [(CKChatController *)self loadingIndicatorCoverView];

  if (loadingIndicatorCoverView)
  {
    view11 = [(CKChatController *)self view];
    loadingIndicatorCoverView2 = [(CKChatController *)self loadingIndicatorCoverView];
    [view11 bringSubviewToFront:loadingIndicatorCoverView2];

    view12 = [(CKChatController *)self view];
    [view12 bounds];
    v94 = v93;
    v96 = v95;
    v98 = v97;
    v100 = v99;
    loadingIndicatorCoverView3 = [(CKChatController *)self loadingIndicatorCoverView];
    [loadingIndicatorCoverView3 setFrame:{v94, v96, v98, v100}];
  }
}

- (void)_layoutBannerView:(id)view
{
  viewCopy = view;
  [(CKCoreChatController *)self calculateTranscriptSafeAreaInsets];
  v5 = v4;
  v7 = v6;
  view = [(CKChatController *)self view];
  [view bounds];
  v10 = v9 - v5 - v7;

  [viewCopy sizeThatFits:{v10, 1.79769313e308}];
  v13 = v12;
  if (v11 < v10)
  {
    v10 = v11;
  }

  [(CKScrollViewController *)self navigationBarInsets];
  [viewCopy setFrame:{v5, v14, v10, v13}];
}

- (void)layoutLockoutView
{
  lockoutView = [(CKChatController *)self lockoutView];
  view = [(CKChatController *)self view];
  [view bounds];
  [lockoutView setFrame:?];
}

- (id)preferredFocusEnvironments
{
  array = [MEMORY[0x1E695DF70] array];
  entryView = [(CKChatController *)self entryView];
  contentView = [entryView contentView];
  textView = [contentView textView];

  if (textView)
  {
    entryView2 = [(CKChatController *)self entryView];
    contentView2 = [entryView2 contentView];
    textView2 = [contentView2 textView];
    [array addObject:textView2];
  }

  return array;
}

- (void)transcriptNavigationBar:(id)bar didTapToPerformAction:(int64_t)action
{
  barCopy = bar;
  if (action <= 2)
  {
    switch(action)
    {
      case 0:
        if (!IMOSLoggingEnabled())
        {
          break;
        }

        v7 = OSLogHandleForIMFoundationCategory();
        if (os_log_type_enabled(v7, OS_LOG_TYPE_INFO))
        {
          *v8 = 0;
          _os_log_impl(&dword_19020E000, v7, OS_LOG_TYPE_INFO, "Navigation bar tried invoking an action that is unknown.", v8, 2u);
        }

LABEL_16:

        break;
      case 1:
        [(CKChatController *)self _didTapNavigationBarAvatarView];
        break;
      case 2:
        [(CKChatController *)self _didTapNavigationBarToDismissReplies];
        break;
    }
  }

  else
  {
    if (action <= 4)
    {
      if (action == 3)
      {
        [(CKChatController *)self _doneButtonPressed];
      }

      else
      {
        [(CKChatController *)self _editCancelButtonPressed];
      }

      goto LABEL_20;
    }

    if (action == 5)
    {
      [(CKChatController *)self _didTapToPresentNewCompose];
      goto LABEL_20;
    }

    if (action == 6)
    {
      v7 = IMLogHandleForCategory();
      if (os_log_type_enabled(v7, OS_LOG_TYPE_ERROR))
      {
        [CKChatController transcriptNavigationBar:didTapToPerformAction:];
      }

      goto LABEL_16;
    }
  }

LABEL_20:
}

- (void)_didTapNavigationBarAvatarView
{
  delegate = [(CKCoreChatController *)self delegate];
  hasDetailsNavigationController = [delegate hasDetailsNavigationController];

  if (hasDetailsNavigationController)
  {
    delegate2 = [(CKCoreChatController *)self delegate];
    [delegate2 dismissDetailsNavigationController];
  }

  else
  {

    [(CKChatController *)self presentDetailsViewController];
  }
}

- (_TtC7ChatKit29CKNavBarPersistentMenuManager)chatBotPersistentMenuManager
{
  if (!self->_chatBotPersistentMenuManager && !CKIsRunningInMacCatalyst())
  {
    conversation = [(CKCoreChatController *)self conversation];
    chat = [conversation chat];
    persistentMenu = [chat persistentMenu];

    if (persistentMenu)
    {
      v6 = [[_TtC7ChatKit29CKNavBarPersistentMenuManager alloc] initWithDelegate:self];
      chatBotPersistentMenuManager = self->_chatBotPersistentMenuManager;
      self->_chatBotPersistentMenuManager = v6;
    }
  }

  v8 = self->_chatBotPersistentMenuManager;

  return v8;
}

- (CKCallButtonStateResolver)callStateResolver
{
  callStateResolver = self->_callStateResolver;
  if (!callStateResolver)
  {
    v4 = objc_alloc_init(CKCallButtonStateResolver);
    v5 = self->_callStateResolver;
    self->_callStateResolver = v4;

    callStateResolver = self->_callStateResolver;
  }

  return callStateResolver;
}

- (void)_didTapToPresentNewCompose
{
  delegate = [(CKCoreChatController *)self delegate];
  v4 = objc_opt_respondsToSelector();

  if (v4)
  {
    delegate2 = [(CKCoreChatController *)self delegate];
    [delegate2 chatController:self didRequestNewComposePresentationWithSender:0];
  }
}

- (void)_didTapNavigationBarToDismissReplies
{
  inlineReplyController = [(CKChatController *)self inlineReplyController];

  if (inlineReplyController)
  {
    inlineReplyController2 = [(CKChatController *)self inlineReplyController];
    [inlineReplyController2 dismissController];
  }

  else
  {
    objc_opt_class();
    if (objc_opt_isKindOfClass())
    {

      [(CKChatController *)self dismissController];
    }
  }
}

- (void)_setupModernTranscriptNavigationBar
{
  if ([(CKCoreChatController *)self isInline]&& ![(CKChatController *)self isModal])
  {
    v6 = IMLogHandleForCategory();
    if (os_log_type_enabled(v6, OS_LOG_TYPE_INFO))
    {
      *buf = 0;
      _os_log_impl(&dword_19020E000, v6, OS_LOG_TYPE_INFO, "Inline Reply Chat Controllers do not need their own bar controller", buf, 2u);
    }
  }

  else if (!self->_transcriptNavigationBarController)
  {
    delegate = [(CKCoreChatController *)self delegate];
    v4 = objc_opt_respondsToSelector();

    if (v4)
    {
      delegate2 = [(CKCoreChatController *)self delegate];
      v12 = [delegate2 backNavigationItemForChatController:self];
    }

    else
    {
      v12 = 0;
    }

    makeNavigationBarContext = [(CKChatController *)self makeNavigationBarContext];
    v8 = [CKTranscriptNavigationBarController alloc];
    navigationItem = [(CKChatController *)self navigationItem];
    v10 = [(CKTranscriptNavigationBarController *)v8 initWithDelegate:self contextProviders:makeNavigationBarContext navigationItem:navigationItem backNavigationItem:v12];

    [(CKChatController *)self setTranscriptNavigationBarController:v10];
    collectionView = [(CKChatController *)self collectionView];
    [(CKTranscriptNavigationBarController *)v10 configurePocketInteractionForScrollView:collectionView];
  }
}

- (void)viewWillAppear:(BOOL)appear
{
  v21.receiver = self;
  v21.super_class = CKChatController;
  [(CKCoreChatController *)&v21 viewWillAppear:appear];
  view = [(CKChatController *)self view];
  [view setNeedsLayout];

  [(CKScrollViewController *)self endHoldingScrollGeometryUpdatesForReason:@"ViewControllerNotVisible"];
  if (![(CKChatController *)self isTransitioningFromQLPreviewToGrid])
  {
    [(CKScrollViewController *)self endHoldingScrollGeometryUpdatesForReason:@"ShowingPhotoGridOverlay"];
  }

  navigationController = [(CKChatController *)self navigationController];
  navigationBar = [navigationController navigationBar];
  traitCollection = [navigationBar traitCollection];
  userInterfaceIdiom = [traitCollection userInterfaceIdiom];

  if ((userInterfaceIdiom - 4) <= 0xFFFFFFFFFFFFFFFDLL)
  {
    navigationController2 = [(CKChatController *)self navigationController];
    navigationBar2 = [navigationController2 navigationBar];
    navigationController3 = [(CKChatController *)self navigationController];
    navigationBar3 = [navigationController3 navigationBar];
    standardAppearance = [navigationBar3 standardAppearance];
    [navigationBar2 setScrollEdgeAppearance:standardAppearance];
  }

  [(CKChatController *)self _restoreDraftState];
  [(CKChatController *)self registerForTextInputPayloadHandling];
  currentNavigationBarBasedOnSizeClass = [(CKChatController *)self currentNavigationBarBasedOnSizeClass];
  [currentNavigationBarBasedOnSizeClass setAlpha:1.0];

  currentNavigationBarBasedOnSizeClass2 = [(CKChatController *)self currentNavigationBarBasedOnSizeClass];
  v16 = +[CKUIBehavior sharedBehaviors];
  theme = [v16 theme];
  [currentNavigationBarBasedOnSizeClass2 setBarStyle:{objc_msgSend(theme, "navBarStyle")}];

  [(CKChatController *)self _showOrHideNicknameBannerIfNeeded];
  [(CKChatController *)self showOrHideAcceptedContactBannerIfNeeded];
  if (IMOSLoggingEnabled())
  {
    v18 = OSLogHandleForIMFoundationCategory();
    if (os_log_type_enabled(v18, OS_LOG_TYPE_INFO))
    {
      *v20 = 0;
      _os_log_impl(&dword_19020E000, v18, OS_LOG_TYPE_INFO, "Ready to configure nav bar title view from viewWillAppear:.", v20, 2u);
    }
  }

  [(CKChatController *)self _setupModernTranscriptNavigationBar];
  [(CKChatController *)self _updateNavigationButtons];
  collectionView = [(CKChatController *)self collectionView];
  [collectionView beginDisablingTranscriptDynamicsForReason:16];

  [(CKChatController *)self presentLoadingIndicatorCoverIfNeeded];
}

- (void)viewWillLayoutSubviews
{
  v13.receiver = self;
  v13.super_class = CKChatController;
  [(CKChatController *)&v13 viewWillLayoutSubviews];
  collectionView = +[CKUIBehavior sharedBehaviors];
  if (([collectionView isEntryViewInputAccessory] & 1) == 0)
  {
    entryView = [(CKChatController *)self entryView];
    if (entryView)
    {
      v5 = entryView;
      view = [(CKChatController *)self view];
      [view bounds];
      v8 = v7;
      entryView2 = [(CKChatController *)self entryView];
      [entryView2 bounds];
      v11 = v10;

      if (v8 == v11)
      {
        return;
      }

      [(CKChatController *)self _updateEntryViewFrameIfNeeded:0];
      collectionViewController = [(CKCoreChatController *)self collectionViewController];
      collectionView = [collectionViewController collectionView];

      if (collectionView)
      {
        if ([collectionView numberOfItemsInSection:0] >= 1)
        {
          [(CKChatController *)self setNeedToEnforceScrollIntent:1];
        }
      }
    }
  }
}

- (void)viewDidMoveToWindow:(id)window shouldAppearOrDisappear:(BOOL)disappear
{
  v8.receiver = self;
  v8.super_class = CKChatController;
  [(CKChatController *)&v8 viewDidMoveToWindow:window shouldAppearOrDisappear:disappear];
  [(CKChatController *)self configureForCurrentTraitCollection];
  view = [(CKChatController *)self view];
  [view bounds];
  [(CKChatController *)self _invalidateChatItemLayoutIfNecessary:v6, v7];
}

- (void)viewDidAppear:(BOOL)appear
{
  v32[1] = *MEMORY[0x1E69E9840];
  v26.receiver = self;
  v26.super_class = CKChatController;
  [(CKCoreChatController *)&v26 viewDidAppear:appear];
  conversation = [(CKCoreChatController *)self conversation];
  chat = [conversation chat];
  v6 = chat == 0;

  if (!v6)
  {
    currentPosterBundleIdentifier = [(CKCoreChatController *)self currentPosterBundleIdentifier];
    v8 = currentPosterBundleIdentifier;
    if (currentPosterBundleIdentifier)
    {
      v31 = @"posterName";
      v32[0] = currentPosterBundleIdentifier;
      v9 = [MEMORY[0x1E695DF20] dictionaryWithObjects:v32 forKeys:&v31 count:1];
    }

    else
    {
      v9 = 0;
    }

    date = [MEMORY[0x1E695DF00] date];
    [CKPowerLog sendTranscriptVisibilityChangedEvent:date event:0 metadata:v9];
  }

  [(CKChatController *)self updateRaiseGesture];
  [(CKChatController *)self _setAvoidanceInsetsNeedsUpdate];
  if (__CurrentTestName && (objc_opt_respondsToSelector() & 1) != 0)
  {
    defaultCenter = [MEMORY[0x1E696AD88] defaultCenter];
    [defaultCenter postNotificationName:@"PPTDidShowConversationEvent" object:0 userInfo:0];
  }

  if (!CKIsRunningInMacCatalyst())
  {
    previewController = [(CKChatController *)self previewController];
    v13 = previewController;
    if (previewController && ([previewController transitionCoordinator], v14 = objc_claimAutoreleasedReturnValue(), v15 = objc_msgSend(v14, "isInteractive"), v14, (v15 & 1) == 0))
    {
      [(CKChatController *)self restoreEntryViewAfterPreview];
    }

    else if (IMOSLoggingEnabled())
    {
      v16 = OSLogHandleForIMFoundationCategory();
      if (os_log_type_enabled(v16, OS_LOG_TYPE_INFO))
      {
        transitionCoordinator = [v13 transitionCoordinator];
        isInteractive = [transitionCoordinator isInteractive];
        v19 = @"NO";
        if (isInteractive)
        {
          v19 = @"YES";
        }

        *buf = 138412546;
        v28 = v13;
        v29 = 2112;
        v30 = v19;
        _os_log_impl(&dword_19020E000, v16, OS_LOG_TYPE_INFO, "No preview controller: %@ - interactive: %@", buf, 0x16u);
      }
    }
  }

  activeKeyboard = [MEMORY[0x1E69DCBB8] activeKeyboard];
  effectPickerWindow = [(CKChatController *)self effectPickerWindow];
  [activeKeyboard setTypingEnabled:effectPickerWindow == 0];

  transcriptInlineNotificationUpdater = [(CKChatController *)self transcriptInlineNotificationUpdater];
  [transcriptInlineNotificationUpdater setNeedsUpdate];

  if (CKIsRunningInMacCatalyst() && [(CKCoreChatController *)self showingInStandAloneWindow])
  {
    entryView = [(CKChatController *)self entryView];
    contentView = [entryView contentView];
    [contentView makeActive];
  }

  collectionView = [(CKChatController *)self collectionView];
  [collectionView endDisablingTranscriptDynamicsForReason:16];
}

- (void)viewDidAppearDeferredSetup
{
  v67 = *MEMORY[0x1E69E9840];
  v64.receiver = self;
  v64.super_class = CKChatController;
  [(CKCoreChatController *)&v64 viewDidAppearDeferredSetup];
  currentDevice = [MEMORY[0x1E69DC938] currentDevice];
  if (![currentDevice userInterfaceIdiom])
  {
    v33 = +[CKUIBehavior sharedBehaviors];
    entryViewFollowsKeyboardLayoutGuide = [v33 entryViewFollowsKeyboardLayoutGuide];

    if (entryViewFollowsKeyboardLayoutGuide)
    {
      goto LABEL_3;
    }

    view = [(CKChatController *)self view];
    window = [view window];
    windowScene = [window windowScene];
    currentDevice = [windowScene keyboardSceneDelegate];

    view2 = [(CKChatController *)self view];
    [currentDevice visibleFrameInView:view2];
    v40 = v39;
    v42 = v41;
    v44 = v43;
    v46 = v45;

    LOBYTE(view2) = [(CKScrollViewController *)self manuallyUpdateKeyboardScreenFrameWithFrameIfNeeded:0 animationDuration:v40 animationCurve:v42, v44, v46, 0.3];
    if (![(CKScrollViewController *)self isHoldingScrollGeometryUpdates]&& (view2 & 1) != 0)
    {
      collectionViewController = [(CKCoreChatController *)self collectionViewController];
      [collectionViewController scrollTranscriptToEntryViewInsertionTimeWithAnimation:1];
    }
  }

LABEL_3:
  conversation = [(CKCoreChatController *)self conversation];
  if (conversation && (CKIsRunningInMacCatalyst() || _CKUIEnhancedMainMenuEnabled()))
  {
    v5 = [[CKDetailsContactsManager alloc] initWithConversation:conversation delegate:self];
    [(CKChatController *)self setDetailsContactsManager:v5];
  }

  else
  {
    [(CKChatController *)self setDetailsContactsManager:0];
  }

  chat = [conversation chat];
  [chat watermarkOutForScrutinyMode];

  if (IMOSLoggingEnabled())
  {
    v7 = OSLogHandleForIMFoundationCategory();
    if (os_log_type_enabled(v7, OS_LOG_TYPE_INFO))
    {
      chat2 = [(CKCoreChatController *)self chat];
      guid = [chat2 guid];
      *buf = 138412290;
      v66 = guid;
      _os_log_impl(&dword_19020E000, v7, OS_LOG_TYPE_INFO, "Reset load attempt count for chat GUID %@", buf, 0xCu);
    }
  }

  chat3 = [conversation chat];
  isInScrutinyMode = [chat3 isInScrutinyMode];

  if (isInScrutinyMode)
  {
    chat4 = [conversation chat];
    [chat4 clearScrutinyMode];

    if (IMOSLoggingEnabled())
    {
      v13 = OSLogHandleForIMFoundationCategory();
      if (os_log_type_enabled(v13, OS_LOG_TYPE_INFO))
      {
        chat5 = [(CKCoreChatController *)self chat];
        guid2 = [chat5 guid];
        *buf = 138412290;
        v66 = guid2;
        _os_log_impl(&dword_19020E000, v13, OS_LOG_TYPE_INFO, "Clearing scrutiny mode for chat GUID %@", buf, 0xCu);
      }
    }
  }

  [(CKChatController *)self _sizeEffectPickerWindow];
  objc_initWeak(buf, self);
  aBlock[0] = MEMORY[0x1E69E9820];
  aBlock[1] = 3221225472;
  aBlock[2] = __46__CKChatController_viewDidAppearDeferredSetup__block_invoke;
  aBlock[3] = &unk_1E72EBA18;
  aBlock[4] = self;
  v16 = _Block_copy(aBlock);
  v17 = dispatch_time(0, 200000000);
  block[0] = MEMORY[0x1E69E9820];
  block[1] = 3221225472;
  block[2] = __46__CKChatController_viewDidAppearDeferredSetup__block_invoke_2;
  block[3] = &unk_1E72ED520;
  objc_copyWeak(&v62, buf);
  v18 = v16;
  v61 = v18;
  v19 = conversation;
  v60 = v19;
  dispatch_after(v17, MEMORY[0x1E69E96A0], block);
  v20 = +[CKPreviewDispatchCache genmojiPreviewCache];
  [v20 resume];

  v21 = +[CKPreviewDispatchCache transcriptPreviewCache];
  [v21 resume];

  nicknameBanner = [(CKChatController *)self nicknameBanner];
  LODWORD(v21) = nicknameBanner == 0;

  if (v21)
  {
    [(CKChatController *)self _showOrHideNicknameBannerIfNeeded];
  }

  groupPhotoUpdateBanner = [(CKChatController *)self groupPhotoUpdateBanner];
  v24 = groupPhotoUpdateBanner == 0;

  if (v24)
  {
    [(CKChatController *)self showGroupBannerUpdateIfNeeded];
  }

  [(CKChatController *)self checkSuggestionsForBanner];
  v25 = [MEMORY[0x193AF5EC0](@"AFContextManager" @"AssistantServices")];
  [v25 addContextProvider:self];

  [(CKChatController *)self _kickPhotoKit];
  delegate = [(CKCoreChatController *)self delegate];
  [delegate prewarmCameraIfNecessaryForChatController:self];

  currentDevice2 = [MEMORY[0x1E69DC938] currentDevice];
  -[CKChatController setLastKnownDeviceOrientation:](self, "setLastKnownDeviceOrientation:", [currentDevice2 orientation]);

  if ([(CKCoreChatController *)self userInitiatedTranscriptPush])
  {
    [(CKChatController *)self _markMessagesAsReadOnPushIfNeeded];
  }

  [(CKChatController *)self _markVisibleMentionsAsRead];
  [(CKChatController *)self _retryGroupPhotoUploadIfNecessary];
  [(CKChatController *)self _retryTranscriptBackgroundUploadIfNecessary];
  transcriptNavigationBarController = [(CKChatController *)self transcriptNavigationBarController];
  [transcriptNavigationBarController configureFindMySessionCoordinatorIfNeededForConversation:v19];

  [(CKChatController *)self updateNumberOfUnknownChatsOpenedIfNeeded];
  tipManager = [(CKChatController *)self tipManager];
  [tipManager chatControllerDidAppear];

  if ([(CKChatController *)self shouldShowBanners])
  {
    v58[0] = MEMORY[0x1E69E9820];
    v58[1] = 3221225472;
    v58[2] = __46__CKChatController_viewDidAppearDeferredSetup__block_invoke_3;
    v58[3] = &unk_1E72ED548;
    v58[4] = self;
    [(CKChatController *)self showCheckInTips:v58];
    v57[0] = MEMORY[0x1E69E9820];
    v57[1] = 3221225472;
    v57[2] = __46__CKChatController_viewDidAppearDeferredSetup__block_invoke_4;
    v57[3] = &unk_1E72ED570;
    v57[4] = self;
    [(CKChatController *)self showTranslationTips:v57];
    tipManager2 = [(CKChatController *)self tipManager];
    [tipManager2 setMessageRequestsDelegate:self];

    tipManager3 = [(CKChatController *)self tipManager];
    [tipManager3 presentMessageRequestsTipIfNeeded];
  }

  v55[0] = MEMORY[0x1E69E9820];
  v55[1] = 3221225472;
  v55[2] = __46__CKChatController_viewDidAppearDeferredSetup__block_invoke_5;
  v55[3] = &unk_1E72EC460;
  objc_copyWeak(&v56, buf);
  v32 = _Block_copy(v55);
  if ([(CKChatController *)self canShowBusinessOnboarding])
  {
    if (+[CKBusinessOnboardingController shouldShowBusinessOnboarding])
    {
      v32[2](v32);
    }

    else
    {
      v50 = MEMORY[0x1E69E9820];
      v51 = 3221225472;
      v52 = __46__CKChatController_viewDidAppearDeferredSetup__block_invoke_2_741;
      v53 = &unk_1E72ED1F0;
      v54 = v32;
      [CKBusinessOnboardingController checkForBusinessAlertsIDSIssues:&v50];
    }
  }

  [(CKChatController *)self _autoAcceptNicknameIfNeeded:v50];
  catchUpButtonManager = [(CKChatController *)self catchUpButtonManager];
  [catchUpButtonManager animateInResumingFromBackground:0];

  if (__CurrentTestName && (objc_opt_respondsToSelector() & 1) != 0)
  {
    defaultCenter = [MEMORY[0x1E696AD88] defaultCenter];
    [defaultCenter postNotificationName:@"PPTDidExtendedShowConversationEvent" object:0 userInfo:0];
  }

  objc_destroyWeak(&v56);
  objc_destroyWeak(&v62);

  objc_destroyWeak(buf);
}

void __46__CKChatController_viewDidAppearDeferredSetup__block_invoke(uint64_t a1)
{
  v2 = [*(a1 + 32) transcriptNavigationBarController];
  v1 = +[_TtC7ChatKit29TranscriptNavigationBarChange nicknameOracleChange];
  [v2 applyChange:v1];
}

void __46__CKChatController_viewDidAppearDeferredSetup__block_invoke_2(uint64_t a1)
{
  WeakRetained = objc_loadWeakRetained((a1 + 48));
  v3 = [WeakRetained mentionsController];
  [v3 deferredSetup];

  v4 = objc_loadWeakRetained((a1 + 48));
  v5 = [v4 entryView];
  [v5 deferredSetup];

  v6 = objc_loadWeakRetained((a1 + 48));
  v7 = [v6 deferredPresentationBlock];

  if (v7)
  {
    v8 = objc_loadWeakRetained((a1 + 48));
    v9 = [v8 deferredPresentationBlock];
    v9[2]();

    v10 = objc_loadWeakRetained((a1 + 48));
    [v10 setDeferredPresentationBlock:0];
  }

  (*(*(a1 + 40) + 16))();
  v11 = [*(a1 + 32) chat];
  v12 = [v11 guid];

  if (v12)
  {
    v14 = [*(a1 + 32) chat];
    v13 = [v14 guid];
    [CKConversationUserInteractionManager enteredConversation:v13];
  }
}

void __46__CKChatController_viewDidAppearDeferredSetup__block_invoke_3(uint64_t a1, int a2, void *a3)
{
  if (a2 && [a3 length])
  {
    v4 = *(a1 + 32);
    v5 = [v4 tipManager];
    [v5 setCheckInDelegate:v4];

    v6 = [*(a1 + 32) tipManager];
    [v6 presentCheckInTip];
  }
}

void __46__CKChatController_viewDidAppearDeferredSetup__block_invoke_4(uint64_t a1, int a2, void *a3)
{
  v13[1] = *MEMORY[0x1E69E9840];
  if (a2)
  {
    v4 = *(a1 + 32);
    v5 = a3;
    v6 = [v4 tipManager];
    [v6 setTranslationDelegate:v4];

    v7 = [*(a1 + 32) tipManager];
    v8 = [v7 presentTranslationTipWithLanguages:v5];

    v9 = [v5 objectForKeyedSubscript:v8];

    [*(a1 + 32) prewarmTranslationCacheForMessagesWithGUIDs:v9 sourceLanguage:v8];
    v10 = [v8 localeIdentifier];
    v13[0] = v10;
    v11 = [MEMORY[0x1E695DEC8] arrayWithObjects:v13 count:1];
    v12 = [*(a1 + 32) conversation];
    [v12 setSuggestedTranslationLanguageCodes:v11];
  }
}

void __46__CKChatController_viewDidAppearDeferredSetup__block_invoke_5(uint64_t a1)
{
  v2 = [CKBusinessOnboardingController alloc];
  v11[0] = MEMORY[0x1E69E9820];
  v11[1] = 3221225472;
  v11[2] = __46__CKChatController_viewDidAppearDeferredSetup__block_invoke_6;
  v11[3] = &unk_1E72EC460;
  objc_copyWeak(&v12, (a1 + 32));
  v3 = [(CKBusinessOnboardingController *)v2 initWithCompletionHandler:v11];
  v6 = MEMORY[0x1E69E9820];
  v7 = 3221225472;
  v8 = __46__CKChatController_viewDidAppearDeferredSetup__block_invoke_2_738;
  v9 = &unk_1E72EC460;
  objc_copyWeak(&v10, (a1 + 32));
  [(CKBusinessOnboardingController *)v3 setupNotNowWithActionHandler:&v6];
  WeakRetained = objc_loadWeakRetained((a1 + 32));
  [WeakRetained dismissKeyboard];

  v5 = objc_loadWeakRetained((a1 + 32));
  [v5 presentViewController:v3 animated:1 completion:0];

  objc_destroyWeak(&v10);
  objc_destroyWeak(&v12);
}

void __46__CKChatController_viewDidAppearDeferredSetup__block_invoke_6(uint64_t a1)
{
  v2 = IMLogHandleForCategory();
  if (os_log_type_enabled(v2, OS_LOG_TYPE_INFO))
  {
    *buf = 0;
    _os_log_impl(&dword_19020E000, v2, OS_LOG_TYPE_INFO, "CKBusinessOnboardingController => Continue button completion handler called", buf, 2u);
  }

  WeakRetained = objc_loadWeakRetained((a1 + 32));
  v4[0] = MEMORY[0x1E69E9820];
  v4[1] = 3221225472;
  v4[2] = __46__CKChatController_viewDidAppearDeferredSetup__block_invoke_737;
  v4[3] = &unk_1E72EC460;
  objc_copyWeak(&v5, (a1 + 32));
  [WeakRetained dismissViewControllerAnimated:1 completion:v4];

  objc_destroyWeak(&v5);
}

void __46__CKChatController_viewDidAppearDeferredSetup__block_invoke_737(uint64_t a1)
{
  WeakRetained = objc_loadWeakRetained((a1 + 32));
  [WeakRetained didFinishShowingBusinessOnboarding];
}

void __46__CKChatController_viewDidAppearDeferredSetup__block_invoke_2_738(uint64_t a1)
{
  v17[1] = *MEMORY[0x1E69E9840];
  v2 = IMLogHandleForCategory();
  if (os_log_type_enabled(v2, OS_LOG_TYPE_INFO))
  {
    *buf = 0;
    _os_log_impl(&dword_19020E000, v2, OS_LOG_TYPE_INFO, "CKBusinessOnboardingController => Not Now button action handler called", buf, 2u);
  }

  WeakRetained = objc_loadWeakRetained((a1 + 32));
  v4 = [WeakRetained conversation];
  v5 = [v4 chat];
  if (!v5)
  {
    goto LABEL_6;
  }

  v6 = objc_loadWeakRetained((a1 + 32));
  v7 = [v6 conversation];
  v8 = [v7 chat];
  v9 = [v8 hasSentMessageToBusiness];

  if ((v9 & 1) == 0)
  {
    WeakRetained = +[CKConversationList sharedConversationList];
    v4 = objc_loadWeakRetained((a1 + 32));
    v10 = [v4 conversation];
    v17[0] = v10;
    v11 = [MEMORY[0x1E695DEC8] arrayWithObjects:v17 count:1];
    v12 = [MEMORY[0x1E695DF00] date];
    [WeakRetained recoverableDeleteForConversations:v11 deleteDate:v12 synchronousQuery:0 completionHandler:0];

LABEL_6:
  }

  v13 = objc_loadWeakRetained((a1 + 32));
  v14[0] = MEMORY[0x1E69E9820];
  v14[1] = 3221225472;
  v14[2] = __46__CKChatController_viewDidAppearDeferredSetup__block_invoke_740;
  v14[3] = &unk_1E72EC460;
  objc_copyWeak(&v15, (a1 + 32));
  [v13 dismissViewControllerAnimated:1 completion:v14];

  objc_destroyWeak(&v15);
}

void __46__CKChatController_viewDidAppearDeferredSetup__block_invoke_740(uint64_t a1)
{
  WeakRetained = objc_loadWeakRetained((a1 + 32));
  v3 = [WeakRetained delegate];
  [v3 cancelNewMessageCompositionAnimated:1];

  v5 = objc_loadWeakRetained((a1 + 32));
  v4 = [v5 delegate];
  [v4 showConversationList];
}

uint64_t __46__CKChatController_viewDidAppearDeferredSetup__block_invoke_2_741(uint64_t result, int a2)
{
  if (a2)
  {
    return (*(*(result + 32) + 16))();
  }

  return result;
}

void __53__CKChatController__markMessagesAsReadOnPushIfNeeded__block_invoke(uint64_t a1)
{
  v10 = *MEMORY[0x1E69E9840];
  v7 = [*(a1 + 32) chat];
  if ([v7 unreadMessageCount])
  {
    v2 = CKIsRunningInMessages();

    if (v2 && (!+[CKStarkManager isCarPlayConnected]|| !CKIsScreenLocked()))
    {
      if (IMOSLoggingEnabled())
      {
        v3 = OSLogHandleForIMFoundationCategory();
        if (os_log_type_enabled(v3, OS_LOG_TYPE_INFO))
        {
          v4 = [*(a1 + 32) chat];
          v5 = [v4 chatIdentifier];
          *buf = 138412290;
          v9 = v5;
          _os_log_impl(&dword_19020E000, v3, OS_LOG_TYPE_INFO, "Marking chat %@ as read on transcript push as this was a user initiated action", buf, 0xCu);
        }
      }

      v6 = [*(a1 + 32) conversation];
      [v6 markAllMessagesAsRead];
    }
  }

  else
  {
  }
}

- (BOOL)clearCommSafetyCompositionIfNecessary
{
  mEMORY[0x1E69A7FC8] = [MEMORY[0x1E69A7FC8] sharedManager];
  checksForSensitivityOnSend = [mEMORY[0x1E69A7FC8] checksForSensitivityOnSend];

  if (!checksForSensitivityOnSend)
  {
    return 0;
  }

  composition = [(CKChatController *)self composition];
  text = [composition text];
  string = [text string];
  v8 = IMSharedUtilitiesFrameworkBundle();
  v9 = [v8 localizedStringForKey:@"MESSAGE_GROWNUP_BODY" value:&stru_1F04268F8 table:@"CommSafetyLocalizable"];
  v10 = [string isEqualToString:v9];

  if (!v10)
  {
    return 0;
  }

  conversation = [(CKCoreChatController *)self conversation];
  [conversation setUnsentComposition:0];

  [(CKChatController *)self setComposition:0];
  return 1;
}

- (void)viewWillDisappear:(BOOL)disappear
{
  v24.receiver = self;
  v24.super_class = CKChatController;
  [(CKCoreChatController *)&v24 viewWillDisappear:disappear];
  mEMORY[0x1E69A8070] = [MEMORY[0x1E69A8070] sharedFeatureFlags];
  isSendAnimationRefreshEnabled = [mEMORY[0x1E69A8070] isSendAnimationRefreshEnabled];

  if (isSendAnimationRefreshEnabled)
  {
    throwSendAnimationManager = self->_throwSendAnimationManager;
    if (throwSendAnimationManager)
    {
      [(CKThrowAnimationManager *)throwSendAnimationManager sendAnimationContainingViewWillDisappear];
    }
  }

  [(CKChatController *)self setSuppressEntryViewKeyboardNotifications:1];
  [(CKScrollViewController *)self beginHoldingScrollGeometryUpdatesForReason:@"ViewControllerNotVisible"];
  entryView = [(CKChatController *)self entryView];
  contentView = [entryView contentView];
  [contentView setIgnoreEndEditing:1];

  [(CKChatController *)self resignFirstResponderOnEntryViewIfNeeded];
  v9 = [(CKChatController *)self activeSendMenuPresentationForChatController:self];
  v10 = v9;
  if (v9)
  {
    [v9 chatControllerWillDisappear:self];
  }

  entryView2 = [(CKChatController *)self entryView];
  isRecording = [entryView2 isRecording];

  if (isRecording)
  {
    entryView3 = [(CKChatController *)self entryView];
    [entryView3 stopRecording];

    entryView4 = [(CKChatController *)self entryView];
    recorder = [entryView4 recorder];
    [recorder setPaused:1];
  }

  if (![(CKChatController *)self clearCommSafetyCompositionIfNecessary])
  {
    [(CKChatController *)self _saveDraftState];
  }

  [(CKChatController *)self updateRaiseGesture];
  inputController = [(CKCoreChatController *)self inputController];
  [inputController unregisterForTextInputPayloadHandling];

  v17 = +[CKBalloonPluginManager sharedInstance];
  [v17 invalidatePhotosPlugin];

  v18 = [MEMORY[0x193AF5EC0](@"AFContextManager" @"AssistantServices")];
  [v18 removeContextProvider:self];

  nicknameBanner = [(CKChatController *)self nicknameBanner];
  if (nicknameBanner)
  {
    transitionCoordinator = [(CKChatController *)self transitionCoordinator];
    v22[0] = MEMORY[0x1E69E9820];
    v22[1] = 3221225472;
    v22[2] = __38__CKChatController_viewWillDisappear___block_invoke;
    v22[3] = &unk_1E72ED598;
    v22[4] = self;
    v23 = nicknameBanner;
    v21[0] = MEMORY[0x1E69E9820];
    v21[1] = 3221225472;
    v21[2] = __38__CKChatController_viewWillDisappear___block_invoke_2;
    v21[3] = &unk_1E72EC3E8;
    v21[4] = self;
    [transitionCoordinator animateAlongsideTransition:v22 completion:v21];
  }

  [(CKChatController *)self dimsmissCurrentBannerAndShowNewBannerForGroupUpdate:0];
  [(CKChatController *)self dismissCollaborationNoticeBannersIfNecessary];
  [(CKChatController *)self dismissBusinessOnboardingIfShowing];
}

void __38__CKChatController_viewWillDisappear___block_invoke(uint64_t a1, void *a2)
{
  v33 = [a2 viewControllerForKey:*MEMORY[0x1E69DE778]];
  objc_opt_class();
  isKindOfClass = objc_opt_isKindOfClass();
  v4 = v33;
  if (isKindOfClass)
  {
    v5 = v33;
    v6 = [v5 navigationItem];
    [v6 _manualScrollEdgeAppearanceProgress];
    v8 = v7;

    v9 = [*(a1 + 32) view];
    [v9 safeAreaInsets];
    v11 = v10;
    v12 = [v5 view];
    [v12 safeAreaInsets];
    v14 = v13;

    v15 = [*(a1 + 32) view];
    v16 = [v15 window];
    v17 = [v16 windowScene];
    v18 = [v17 interfaceOrientation] - 3;

    if (v18 > 1)
    {
      v19 = 0;
    }

    else
    {
      v19 = 0;
      if (v11 < v14 && v8 == 0.0)
      {
        v19 = [*(a1 + 32) _wantsThreeColumnLayout] ^ 1;
      }
    }

    if (v8 == 1.0 || (([v5 isSearchActive] | v19) & 1) != 0)
    {
      *(*(a1 + 32) + 1392) = 1;
      [*(a1 + 40) frame];
      v21 = v20;
      v23 = v22;
      v25 = v24;
      v26 = [v5 view];
      [v26 safeAreaInsets];
      v28 = v27;

      v29 = [MEMORY[0x1E69A8070] sharedFeatureFlags];
      v30 = [v29 isModernSplitViewControllerEnabled];

      if (v30)
      {
        v31 = [v5 view];
        [v31 safeAreaInsets];
        v21 = v32;
      }

      [*(a1 + 40) setFrame:{v21, v28, v23, v25}];
    }

    v4 = v33;
  }
}

- (void)viewDidDisappear:(BOOL)disappear
{
  v17[1] = *MEMORY[0x1E69E9840];
  v15.receiver = self;
  v15.super_class = CKChatController;
  [(CKViewController *)&v15 viewDidDisappear:disappear];
  conversation = [(CKCoreChatController *)self conversation];
  chat = [conversation chat];

  if (chat)
  {
    currentPosterBundleIdentifier = [(CKCoreChatController *)self currentPosterBundleIdentifier];
    v7 = currentPosterBundleIdentifier;
    if (currentPosterBundleIdentifier)
    {
      v16 = @"posterName";
      v17[0] = currentPosterBundleIdentifier;
      v8 = [MEMORY[0x1E695DF20] dictionaryWithObjects:v17 forKeys:&v16 count:1];
    }

    else
    {
      v8 = 0;
    }

    date = [MEMORY[0x1E695DF00] date];
    [CKPowerLog sendTranscriptVisibilityChangedEvent:date event:1 metadata:v8];
  }

  [(CKChatController *)self setSuppressEntryViewKeyboardNotifications:0];
  v10 = +[CKBalloonPluginManager sharedInstance];
  [v10 commitInteractionTimeOrderingChanges];

  [(CKChatController *)self setScrollBlock:0];
  [(CKChatController *)self setEditing:0 animated:0];
  [(CKChatController *)self setIsShowingCamera:0];
  tipManager = [(CKChatController *)self tipManager];
  [tipManager chatControllerDidDisappear];

  if ([MEMORY[0x1E69A5B68] isContactLimitsFeatureEnabled])
  {
    [(CKChatController *)self removeLockoutControllerIfNeeded];
  }

  v12 = [(CKChatController *)self activeSendMenuPresentationForChatController:self];
  v13 = v12;
  if (v12)
  {
    [v12 dismissAnimated:0 completion:0];
  }

  transcriptNavigationBarController = [(CKChatController *)self transcriptNavigationBarController];
  [transcriptNavigationBarController transcriptDidDismiss];
}

- (void)parentControllerDidBecomeActive
{
  v4.receiver = self;
  v4.super_class = CKChatController;
  [(CKCoreChatController *)&v4 parentControllerDidBecomeActive];
  collectionViewController = [(CKCoreChatController *)self collectionViewController];
  [collectionViewController parentControllerDidBecomeActive];
}

- (void)_performResume
{
  v28[1] = *MEMORY[0x1E69E9840];
  [(CKChatController *)self setIsCatchUpButtonNeededOnFirstLoad:0];
  [(CKChatController *)self setDidComputeInitiallyVisibleIndexPaths:0];
  [(CKChatController *)self setDidDisplayFirstUnreadMessage:0];
  [(CKChatController *)self _updateCatchUpButtonVisibilityResumingFromBackground:1];
  v24.receiver = self;
  v24.super_class = CKChatController;
  [(CKCoreChatController *)&v24 _performResume];
  currentPosterBundleIdentifier = [(CKCoreChatController *)self currentPosterBundleIdentifier];
  v4 = currentPosterBundleIdentifier;
  if (currentPosterBundleIdentifier)
  {
    v27 = @"posterName";
    v28[0] = currentPosterBundleIdentifier;
    v5 = [MEMORY[0x1E695DF20] dictionaryWithObjects:v28 forKeys:&v27 count:1];
  }

  else
  {
    v5 = 0;
  }

  date = [MEMORY[0x1E695DF00] date];
  [CKPowerLog sendTranscriptVisibilityChangedEvent:date event:0 metadata:v5];

  entryView = [(CKChatController *)self entryView];
  if ([entryView isHidden])
  {
    inputController = [(CKCoreChatController *)self inputController];
    appManagerIsDisplayed = [inputController appManagerIsDisplayed];

    if (appManagerIsDisplayed)
    {
      goto LABEL_8;
    }

    entryView2 = [(CKChatController *)self entryView];
    [entryView2 setHidden:0];

    entryView = [(CKChatController *)self entryView];
    [entryView setAlpha:1.0];
  }

LABEL_8:
  [(CKChatController *)self setEditing:0 animated:0];
  v11 = +[CKDraftManager sharedInstance];
  [v11 flushCache];

  conversation = [(CKCoreChatController *)self conversation];
  unsentComposition = [conversation unsentComposition];

  composition = [(CKChatController *)self composition];
  hasContent = [composition hasContent];

  if (hasContent)
  {
    if (IMOSLoggingEnabled())
    {
      v16 = OSLogHandleForIMFoundationCategory();
      if (os_log_type_enabled(v16, OS_LOG_TYPE_INFO))
      {
        *buf = 0;
        _os_log_impl(&dword_19020E000, v16, OS_LOG_TYPE_INFO, "Refreshing composition to establish connection to photo browser due to resume", buf, 2u);
      }
    }

    inputController2 = [(CKCoreChatController *)self inputController];
    composition2 = [(CKChatController *)self composition];
    [inputController2 requestPhotoBrowserInitFromDraft:composition2];
  }

  else
  {
    if (![unsentComposition hasContent])
    {
      goto LABEL_21;
    }

    if (IMOSLoggingEnabled())
    {
      v19 = OSLogHandleForIMFoundationCategory();
      if (os_log_type_enabled(v19, OS_LOG_TYPE_INFO))
      {
        *buf = 0;
        _os_log_impl(&dword_19020E000, v19, OS_LOG_TYPE_INFO, "Conversation has unsent content that is not in the current composition, restoring it", buf, 2u);
      }
    }

    [(CKChatController *)self setComposition:unsentComposition];
    inputController2 = [(CKCoreChatController *)self inputController];
    [inputController2 requestPhotoBrowserInitFromDraft:unsentComposition];
  }

LABEL_21:
  if (IMOSLoggingEnabled())
  {
    v20 = OSLogHandleForIMFoundationCategory();
    if (os_log_type_enabled(v20, OS_LOG_TYPE_INFO))
    {
      *buf = 136315138;
      v26 = "[CKChatController _performResume]";
      _os_log_impl(&dword_19020E000, v20, OS_LOG_TYPE_INFO, "reloadEntryViewIfNeeded called from %s", buf, 0xCu);
    }
  }

  [(CKChatController *)self reloadEntryViewIfNeeded];
  [(CKChatController *)self _sizeEffectPickerWindow];
  [(CKChatController *)self _reloadMentionsData];
  entryView3 = [(CKChatController *)self entryView];
  contentView = [entryView3 contentView];
  pluginEntryViewController = [contentView pluginEntryViewController];

  if (objc_opt_respondsToSelector())
  {
    [pluginEntryViewController performHostAppResume];
  }
}

- (void)prepareForSuspend
{
  v19 = *MEMORY[0x1E69E9840];
  if (IMOSLoggingEnabled())
  {
    v3 = OSLogHandleForIMFoundationCategory();
    if (os_log_type_enabled(v3, OS_LOG_TYPE_INFO))
    {
      *buf = 136315138;
      v18 = "[CKChatController prepareForSuspend]";
      _os_log_impl(&dword_19020E000, v3, OS_LOG_TYPE_INFO, "%s", buf, 0xCu);
    }
  }

  currentPosterBundleIdentifier = [(CKCoreChatController *)self currentPosterBundleIdentifier];
  v5 = currentPosterBundleIdentifier;
  if (currentPosterBundleIdentifier)
  {
    v15 = @"posterName";
    v16 = currentPosterBundleIdentifier;
    v6 = [MEMORY[0x1E695DF20] dictionaryWithObjects:&v16 forKeys:&v15 count:1];
  }

  else
  {
    v6 = 0;
  }

  date = [MEMORY[0x1E695DF00] date];
  [CKPowerLog sendTranscriptVisibilityChangedEvent:date event:1 metadata:v6];

  v8 = +[CKPluginExtensionStateObserver sharedInstance];
  passKitUIPresented = [v8 passKitUIPresented];

  if (passKitUIPresented)
  {
    if (IMOSLoggingEnabled())
    {
      v10 = OSLogHandleForIMFoundationCategory();
      if (os_log_type_enabled(v10, OS_LOG_TYPE_INFO))
      {
        *buf = 0;
        _os_log_impl(&dword_19020E000, v10, OS_LOG_TYPE_INFO, "prepareForSuspend not doing suspend work as we are suspending due to passkit UI", buf, 2u);
      }

LABEL_12:
    }
  }

  else
  {
    v11 = +[CKPluginExtensionStateObserver sharedInstance];
    iTunesStoreDialogPresented = [v11 iTunesStoreDialogPresented];

    if (!iTunesStoreDialogPresented)
    {
      v14[0] = MEMORY[0x1E69E9820];
      v14[1] = 3221225472;
      v14[2] = __37__CKChatController_prepareForSuspend__block_invoke;
      v14[3] = &unk_1E72EBA18;
      v14[4] = self;
      [MEMORY[0x1E69DD258] _performWithoutDeferringTransitions:v14];
      v13 = +[CKLinkIntentsManager sharedManager];
      [v13 purgeDependencies];

      goto LABEL_19;
    }

    if (IMOSLoggingEnabled())
    {
      v10 = OSLogHandleForIMFoundationCategory();
      if (os_log_type_enabled(v10, OS_LOG_TYPE_INFO))
      {
        *buf = 0;
        _os_log_impl(&dword_19020E000, v10, OS_LOG_TYPE_INFO, "prepareForSuspend not doing suspend work as we are suspending due to iTunesStore UI", buf, 2u);
      }

      goto LABEL_12;
    }
  }

LABEL_19:
}

void __37__CKChatController_prepareForSuspend__block_invoke(uint64_t a1)
{
  v2 = [MEMORY[0x1E69A7FC8] sharedManager];
  v3 = [v2 checksForSensitivityOnSend];

  v4 = *(a1 + 32);
  if (v3 && ([v4 composition], v5 = objc_claimAutoreleasedReturnValue(), objc_msgSend(v5, "text"), v6 = objc_claimAutoreleasedReturnValue(), objc_msgSend(v6, "string"), v7 = objc_claimAutoreleasedReturnValue(), IMSharedUtilitiesFrameworkBundle(), v8 = objc_claimAutoreleasedReturnValue(), objc_msgSend(v8, "localizedStringForKey:value:table:", @"MESSAGE_GROWNUP_BODY", &stru_1F04268F8, @"CommSafetyLocalizable"), v9 = objc_claimAutoreleasedReturnValue(), v10 = objc_msgSend(v7, "isEqualToString:", v9), v9, v8, v7, v6, v5, v4 = *(a1 + 32), v10))
  {
    v11 = [v4 conversation];
    [v11 setUnsentComposition:0];
  }

  else
  {
    [v4 _saveDraftState];
  }

  if (!CKIsRunningInMacCatalyst())
  {
    [*(a1 + 32) setEditing:0 animated:0];
    v12 = [*(a1 + 32) inputController];
    [v12 prepareForSuspend];

    v13 = +[CKBalloonPluginManager sharedInstance];
    [v13 prepareForSuspend];

    v14 = [*(a1 + 32) collectionViewController];
    [v14 prepareForSuspend];

    [*(a1 + 32) dismissContextMenuInteractionMenu];
    if ([*(a1 + 32) isFullScreenBalloonViewOnScreen])
    {
      if (IMOSLoggingEnabled())
      {
        v15 = OSLogHandleForIMFoundationCategory();
        if (os_log_type_enabled(v15, OS_LOG_TYPE_INFO))
        {
          *v26 = 0;
          _os_log_impl(&dword_19020E000, v15, OS_LOG_TYPE_INFO, "Dismissing fullscreen balloon view for suspend", v26, 2u);
        }
      }

      [*(a1 + 32) _dismissFullScreenBubbleViewControllerAnimated:0 withSendAnimation:0 completion:0];
    }

    v16 = +[CKAdaptivePresentationController sharedInstance];
    [v16 dismissViewControllerAnimated:0 completion:0];

    [*(a1 + 32) hideMediaPickerAnimated:0];
    [*(a1 + 32) updateRaiseGesture];
    v17 = [*(a1 + 32) navigationController];
    v18 = [v17 popToViewController:*(a1 + 32) animated:0];

    v19 = [*(a1 + 32) entryView];

    if (v19)
    {
      if (([*(a1 + 32) isFunCamPresented] & 1) == 0)
      {
        v20 = [*(a1 + 32) entryView];
        v21 = [v20 contentView];
        v22 = [v21 isActive];

        if ((v22 & 1) == 0)
        {
          [*(a1 + 32) becomeFirstResponder];
        }
      }
    }

    [*(a1 + 32) setTargetFirstResponder:0];
    v23 = [*(a1 + 32) entryView];
    v24 = [v23 contentView];
    v25 = [v24 pluginEntryViewController];

    if (objc_opt_respondsToSelector())
    {
      [v25 performHostAppSuspend];
    }
  }
}

- (void)didReceiveMemoryWarning
{
  v3.receiver = self;
  v3.super_class = CKChatController;
  [(CKChatController *)&v3 didReceiveMemoryWarning];
  [(CKChatController *)self setPreviewController:0];
}

- (void)viewWillTransitionToSize:(CGSize)size withTransitionCoordinator:(id)coordinator
{
  height = size.height;
  width = size.width;
  coordinatorCopy = coordinator;
  v26.receiver = self;
  v26.super_class = CKChatController;
  [(CKChatController *)&v26 viewWillTransitionToSize:coordinatorCopy withTransitionCoordinator:width, height];
  [(CKChatController *)self _hideCatchUpButtonIfNeededAndRemoveOnCompletion:0];
  [(CKChatController *)self setTransitioningSize:1];
  [(CKScrollViewController *)self beginHoldingScrollGeometryUpdatesForReason:@"ViewControllerSizeTransition"];
  aBlock[0] = MEMORY[0x1E69E9820];
  aBlock[1] = 3221225472;
  aBlock[2] = __71__CKChatController_viewWillTransitionToSize_withTransitionCoordinator___block_invoke;
  aBlock[3] = &unk_1E72EC3E8;
  aBlock[4] = self;
  v8 = _Block_copy(aBlock);
  collectionViewController = [(CKCoreChatController *)self collectionViewController];
  collectionView = [collectionViewController collectionView];

  if (collectionView && [collectionView numberOfItemsInSection:0] >= 1)
  {
    isEditing = [(CKChatController *)self isEditing];
    v12 = isEditing;
    if (isEditing)
    {
      collectionViewController2 = [(CKCoreChatController *)self collectionViewController];
      selectedItems = [collectionViewController2 selectedItems];
    }

    else
    {
      selectedItems = 0;
    }

    isCollapsed = [(CKCoreChatController *)self isCollapsed];
    v21[0] = MEMORY[0x1E69E9820];
    v21[1] = 3221225472;
    v21[2] = __71__CKChatController_viewWillTransitionToSize_withTransitionCoordinator___block_invoke_2;
    v21[3] = &unk_1E72ED5E8;
    v23 = isCollapsed;
    v24 = v12;
    v21[4] = self;
    v22 = selectedItems;
    v16 = selectedItems;
    [coordinatorCopy animateAlongsideTransition:v21 completion:v8];
  }

  else
  {
    v20[0] = MEMORY[0x1E69E9820];
    v20[1] = 3221225472;
    v20[2] = __71__CKChatController_viewWillTransitionToSize_withTransitionCoordinator___block_invoke_4;
    v20[3] = &unk_1E72EC3E8;
    v20[4] = self;
    [coordinatorCopy animateAlongsideTransition:v20 completion:v8];
  }

  fullScreenBalloonViewController = [(CKCoreChatController *)self fullScreenBalloonViewController];

  if (fullScreenBalloonViewController)
  {
    inputController = [(CKCoreChatController *)self inputController];
    [inputController endStickerReactionSession];

    [(CKChatController *)self _dismissFullScreenBubbleViewControllerAnimated:0 withSendAnimation:0 completion:0];
    [(CKChatController *)self updateActiveEntryViewPositioningGuide];
  }

  transcriptInlineNotificationUpdater = [(CKChatController *)self transcriptInlineNotificationUpdater];
  [transcriptInlineNotificationUpdater setNeedsUpdate];

  [MEMORY[0x1E6979518] addCommitHandler:&__block_literal_global_783_0 forPhase:2];
}

void __71__CKChatController_viewWillTransitionToSize_withTransitionCoordinator___block_invoke(uint64_t a1)
{
  [*(a1 + 32) setTransitioningSize:0];
  [*(a1 + 32) endHoldingScrollGeometryUpdatesForReason:@"ViewControllerSizeTransition"];
  if ([*(a1 + 32) viewDidMoveToWindowAndNeedsToScrollToInsertionTime])
  {
    [*(a1 + 32) updateScrollGeometryWithInheritedAnimationForReason:@"ViewSizeTransitionCompletion"];
    v2 = [*(a1 + 32) collectionViewController];
    v3 = +[CKScrollViewAnimationProperties unanimated];
    [v2 enforceTranscriptScrollIntentWithAnimationProperties:v3];

    [*(a1 + 32) setViewDidMoveToWindowAndNeedsToScrollToInsertionTime:0];
  }

  [*(a1 + 32) _sizeEffectPickerWindow];
  v4 = [MEMORY[0x1E69DC938] currentDevice];
  v5 = [v4 orientation];

  if ([*(a1 + 32) lastKnownDeviceOrientation] != v5)
  {
    v6 = [*(a1 + 32) inputController];
    [v6 didTransitionFromOrientation:objc_msgSend(*(a1 + 32) toOrientation:{"lastKnownDeviceOrientation"), v5}];

    [*(a1 + 32) setLastKnownDeviceOrientation:v5];
  }

  v7 = [MEMORY[0x1E696AD88] defaultCenter];
  [v7 postNotificationName:@"kPPTChatControllerDidRotateNotification" object:0];
}

void __71__CKChatController_viewWillTransitionToSize_withTransitionCoordinator___block_invoke_2(uint64_t a1)
{
  v1 = MEMORY[0x1E69DD250];
  v3[0] = MEMORY[0x1E69E9820];
  v3[1] = 3221225472;
  v3[2] = __71__CKChatController_viewWillTransitionToSize_withTransitionCoordinator___block_invoke_3;
  v3[3] = &unk_1E72ED5C0;
  v5 = *(a1 + 48);
  v2 = *(a1 + 40);
  v3[4] = *(a1 + 32);
  v4 = v2;
  [v1 performWithoutAnimation:v3];
}

void __71__CKChatController_viewWillTransitionToSize_withTransitionCoordinator___block_invoke_3(uint64_t a1)
{
  v2 = +[CKUIBehavior sharedBehaviors];
  if ([v2 canPresentOverKeyboard])
  {
  }

  else
  {
    v3 = *(a1 + 48);
    v4 = [*(a1 + 32) isCollapsed];

    if (v3 != v4)
    {
      v5 = [*(a1 + 32) imagePickerController];

      if (v5)
      {
        [*(a1 + 32) hideMediaPickerAnimated:0];
      }
    }
  }

  [*(a1 + 32) _updateEntryViewFrameIfNeeded:0];
  [*(a1 + 32) setEditing:*(a1 + 49) animated:0];
  v7 = [*(a1 + 32) collectionViewController];
  [v7 setSelectedItems:*(a1 + 40)];
  [*(a1 + 32) reloadFooterViewControllerIfNecessary];
  [*(a1 + 32) updateScrollGeometryWithInheritedAnimationForReason:@"ViewSizeTransitionAnimation"];
  v6 = +[CKScrollViewAnimationProperties unanimated];
  [v7 enforceTranscriptScrollIntentWithAnimationProperties:v6];

  [*(a1 + 32) _showCatchUpButtonIfNeeded];
}

uint64_t __71__CKChatController_viewWillTransitionToSize_withTransitionCoordinator___block_invoke_4(uint64_t a1)
{
  [*(a1 + 32) _updateEntryViewFrameIfNeeded:0];
  v2 = *(a1 + 32);

  return [v2 updateScrollGeometryWithInheritedAnimationForReason:@"ViewSizeTransitionAnimation"];
}

void __71__CKChatController_viewWillTransitionToSize_withTransitionCoordinator___block_invoke_5()
{
  v0 = [MEMORY[0x1E696AD88] defaultCenter];
  [v0 postNotificationName:@"kPPTChatControllerWillRotateNotification" object:0];
}

- (void)presentViewController:(id)controller animated:(BOOL)animated completion:(id)completion
{
  animatedCopy = animated;
  controllerCopy = controller;
  completionCopy = completion;
  presentationController = [controllerCopy presentationController];
  delegate = [presentationController delegate];

  if (!delegate)
  {
    presentationController2 = [controllerCopy presentationController];
    [presentationController2 setDelegate:self];
  }

  [(CKChatController *)self dismissTipIfPresented];
  v13 = [(CKChatController *)self _viewControllerForModalPresentationOfViewController:controllerCopy];
  v14 = v13;
  if (v13 == self)
  {
    v15.receiver = self;
    v15.super_class = CKChatController;
    [(CKChatController *)&v15 presentViewController:controllerCopy animated:animatedCopy completion:completionCopy];
  }

  else
  {
    [(CKChatController *)v13 presentViewController:controllerCopy animated:animatedCopy completion:completionCopy];
  }
}

- (id)_viewControllerForModalPresentationOfViewController:(id)controller
{
  inputController = [(CKCoreChatController *)self inputController];
  isAppCardPresented = [inputController isAppCardPresented];

  if (isAppCardPresented)
  {
    presentedViewController = [(CKChatController *)self presentedViewController];
    v7 = [presentedViewController conformsToProtocol:&unk_1F06826C0];

    if (v7)
    {
      inputController2 = [(CKCoreChatController *)self inputController];
      isAppCardDismissing = [inputController2 isAppCardDismissing];

      if ((isAppCardDismissing & 1) == 0)
      {
        selfCopy = [(CKChatController *)self presentedViewController];
        goto LABEL_7;
      }
    }

    v10 = [(CKChatController *)self activeSendMenuPresentationForChatInputController:0];
    if (v10)
    {
      v11 = v10;
      sendMenuViewController = [v10 sendMenuViewController];

      goto LABEL_8;
    }
  }

  selfCopy = self;
LABEL_7:
  sendMenuViewController = selfCopy;
LABEL_8:

  return sendMenuViewController;
}

- (void)dismissViewControllerAnimated:(BOOL)animated completion:(id)completion
{
  animatedCopy = animated;
  completionCopy = completion;
  presentedViewController = [(CKChatController *)self presentedViewController];
  nicknameUpdateController = [(CKChatController *)self nicknameUpdateController];

  if (presentedViewController == nicknameUpdateController)
  {
    [(CKChatController *)self setNicknameUpdateController:0];
  }

  v9.receiver = self;
  v9.super_class = CKChatController;
  [(CKChatController *)&v9 dismissViewControllerAnimated:animatedCopy completion:completionCopy];
}

- (void)presentationControllerDidDismiss:(id)dismiss
{
  dismissCopy = dismiss;
  presentedViewController = [(CKChatController *)self presentedViewController];

  if (!presentedViewController)
  {
    entryView = [(CKChatController *)self entryView];
    window = [entryView window];

    if (!window)
    {
      v8 = IMLogHandleForCategory();
      if (os_log_type_enabled(v8, OS_LOG_TYPE_ERROR))
      {
        [(CKChatController *)dismissCopy presentationControllerDidDismiss:v8];
      }

      [(CKChatController *)self reloadInputViews];
    }
  }

  presentedViewController2 = [dismissCopy presentedViewController];
  objc_opt_class();
  isKindOfClass = objc_opt_isKindOfClass();

  if (isKindOfClass)
  {
    [(CKChatController *)self didFinishShowingBusinessOnboarding];
  }

  presentedViewController3 = [dismissCopy presentedViewController];
  walletOrderImportViewController = [(CKChatController *)self walletOrderImportViewController];
  v13 = [presentedViewController3 isEqual:walletOrderImportViewController];

  if (v13)
  {
    [(CKChatController *)self _walletOrderImportControllerDismissed];
    delegate = [(CKCoreChatController *)self delegate];
    [delegate stopForcingOrientation];
  }
}

- (void)_reduceTransparencyStatusDidChange
{
  if (IMOSLoggingEnabled())
  {
    v3 = OSLogHandleForIMFoundationCategory();
    if (os_log_type_enabled(v3, OS_LOG_TYPE_INFO))
    {
      *v7 = 0;
      _os_log_impl(&dword_19020E000, v3, OS_LOG_TYPE_INFO, "Reduce Transparency Status Did Change", v7, 2u);
    }
  }

  [(CKChatController *)self reloadEntryViewIfNeeded];
  collectionViewController = [(CKCoreChatController *)self collectionViewController];
  collectionView = [collectionViewController collectionView];

  indexPathsForVisibleItems = [collectionView indexPathsForVisibleItems];
  [collectionView reloadItemsAtIndexPaths:indexPathsForVisibleItems];
}

- (void)_contactsListDidChange
{
  if (IMOSLoggingEnabled())
  {
    v3 = OSLogHandleForIMFoundationCategory();
    if (os_log_type_enabled(v3, OS_LOG_TYPE_INFO))
    {
      *v4 = 0;
      _os_log_impl(&dword_19020E000, v3, OS_LOG_TYPE_INFO, "Contacts list did change", v4, 2u);
    }
  }

  [(CKChatController *)self reloadEntryViewIfNeeded];
}

- (void)traitCollectionDidChange:(id)change
{
  v41 = *MEMORY[0x1E69E9840];
  changeCopy = change;
  v36.receiver = self;
  v36.super_class = CKChatController;
  [(CKChatController *)&v36 traitCollectionDidChange:changeCopy];
  if (IMOSLoggingEnabled())
  {
    v5 = OSLogHandleForIMFoundationCategory();
    if (os_log_type_enabled(v5, OS_LOG_TYPE_INFO))
    {
      v6 = [changeCopy description];
      *buf = 138412290;
      v38 = v6;
      _os_log_impl(&dword_19020E000, v5, OS_LOG_TYPE_INFO, "traitCollectionDidChange | previous: {%@}", buf, 0xCu);
    }
  }

  if (IMOSLoggingEnabled())
  {
    v7 = OSLogHandleForIMFoundationCategory();
    if (os_log_type_enabled(v7, OS_LOG_TYPE_INFO))
    {
      traitCollection = [(CKChatController *)self traitCollection];
      v9 = [traitCollection description];
      *buf = 138412290;
      v38 = v9;
      _os_log_impl(&dword_19020E000, v7, OS_LOG_TYPE_INFO, "traitCollectionDidChange | current: {%@}", buf, 0xCu);
    }
  }

  v10 = objc_autoreleasePoolPush();
  [(CKChatController *)self configureForCurrentTraitCollection];
  if (IMOSLoggingEnabled())
  {
    v11 = OSLogHandleForIMFoundationCategory();
    if (os_log_type_enabled(v11, OS_LOG_TYPE_INFO))
    {
      *buf = 0;
      _os_log_impl(&dword_19020E000, v11, OS_LOG_TYPE_INFO, "traitCollectionDidChange | Returned from configureForCurrentTraitCollection", buf, 2u);
    }
  }

  horizontalSizeClass = [changeCopy horizontalSizeClass];
  traitCollection2 = [(CKChatController *)self traitCollection];
  horizontalSizeClass2 = [traitCollection2 horizontalSizeClass];

  verticalSizeClass = [changeCopy verticalSizeClass];
  traitCollection3 = [(CKChatController *)self traitCollection];
  verticalSizeClass2 = [traitCollection3 verticalSizeClass];

  if (horizontalSizeClass != horizontalSizeClass2 || verticalSizeClass != verticalSizeClass2)
  {
    if (IMOSLoggingEnabled())
    {
      v18 = OSLogHandleForIMFoundationCategory();
      if (os_log_type_enabled(v18, OS_LOG_TYPE_INFO))
      {
        v19 = @"NO";
        if (horizontalSizeClass == horizontalSizeClass2)
        {
          v20 = @"NO";
        }

        else
        {
          v20 = @"YES";
        }

        if (verticalSizeClass != verticalSizeClass2)
        {
          v19 = @"YES";
        }

        *buf = 138412546;
        v38 = v20;
        v39 = 2112;
        v40 = v19;
        _os_log_impl(&dword_19020E000, v18, OS_LOG_TYPE_INFO, "> Detected a change to the chat controller's size class. horizontalSizeClassDidChange={%@} verticalSizeClassDidChange={%@}", buf, 0x16u);
      }
    }

    [(CKChatController *)self _hideCatchUpButtonIfNeededAndRemoveOnCompletion:0];
    [(CKChatController *)self setNeedsStatusBarAppearanceUpdate];
  }

  if (horizontalSizeClass != horizontalSizeClass2 && [changeCopy horizontalSizeClass] == 1)
  {
    if (+[CKUtilities isIpad])
    {
      inputController = [(CKCoreChatController *)self inputController];
      presentedAppBypassesSendMenu = [inputController presentedAppBypassesSendMenu];

      if ((presentedAppBypassesSendMenu & 1) == 0)
      {
        inputController2 = [(CKCoreChatController *)self inputController];
        [inputController2 dismissAppCardIfNecessaryAnimated:0 completion:0];
      }
    }
  }

  keyboardSnapshotView = [(CKChatController *)self keyboardSnapshotView];
  v25 = keyboardSnapshotView == 0;

  if (!v25)
  {
    traitCollection4 = [(CKChatController *)self traitCollection];
    userInterfaceStyle = [traitCollection4 userInterfaceStyle];
    LOBYTE(userInterfaceStyle) = userInterfaceStyle == [changeCopy userInterfaceStyle];

    if ((userInterfaceStyle & 1) == 0)
    {
      v28 = [(CKChatController *)self activeSendMenuPresentationForChatController:self];
      v29 = v28;
      if (v28)
      {
        [v28 dismissAnimated:1 completion:0];
      }
    }
  }

  [changeCopy displayScale];
  v31 = v30;
  traitCollection5 = [(CKChatController *)self traitCollection];
  [traitCollection5 displayScale];
  v34 = v31 != v33;

  if (v34)
  {
    [(CKChatController *)self refreshMacToolbar];
  }

  [(CKChatController *)self updateStyleForCurrentEffect];
  [(CKChatController *)self _dismissSendMenuIfNecessaryForChangedPresentationStyle];
  if (IMOSLoggingEnabled())
  {
    v35 = OSLogHandleForIMFoundationCategory();
    if (os_log_type_enabled(v35, OS_LOG_TYPE_INFO))
    {
      *buf = 0;
      _os_log_impl(&dword_19020E000, v35, OS_LOG_TYPE_INFO, "traitCollectionDidChange | Completed all configuration updates in response to traitCollection change.", buf, 2u);
    }
  }

  objc_autoreleasePoolPop(v10);
}

- (void)configureForCurrentTraitCollection
{
  traitCollection = [(CKChatController *)self traitCollection];
  entryView = [(CKChatController *)self entryView];
  [entryView setEntryViewTraitCollection:traitCollection];

  [(CKMessageEntryBackgroundViewProtocol *)self->_keyboardCandidateBarBackgroundView setEntryViewTraitCollection:traitCollection];
  tipManager = [(CKChatController *)self tipManager];
  presentingTip = [tipManager presentingTip];

  if (presentingTip)
  {
    traitCollection2 = [(CKChatController *)self traitCollection];
    verticalSizeClass = [traitCollection2 verticalSizeClass];

    if (verticalSizeClass == 1)
    {
      tipManager2 = [(CKChatController *)self tipManager];
      [tipManager2 dismissTipIfPresented];
    }
  }
}

- (void)willMoveToParentViewController:(id)controller
{
  if (controller)
  {
    return;
  }

  presentedViewController = [(CKChatController *)self presentedViewController];
  v5 = [presentedViewController _existingPresentationControllerImmediate:1 effective:0];
  presentingViewController = [v5 presentingViewController];

  objc_opt_class();
  isKindOfClass = objc_opt_isKindOfClass();
  if (!presentedViewController)
  {
    if (presentingViewController != self || ((isKindOfClass ^ 1) & 1) != 0)
    {
      goto LABEL_12;
    }

LABEL_9:
    v9 = presentedViewController;
    topViewController = [v9 topViewController];
    objc_opt_class();
    v11 = objc_opt_isKindOfClass();

    if (v11)
    {
      [v9 dismissViewControllerAnimated:0 completion:0];
    }

    goto LABEL_13;
  }

  inlineReplyController = [(CKChatController *)self inlineReplyController];

  if (presentingViewController == self && ((isKindOfClass ^ 1) & 1) == 0)
  {
    goto LABEL_9;
  }

  if (presentedViewController != inlineReplyController)
  {
LABEL_12:
    [(CKChatController *)self dismissBusinessOnboardingIfShowing];
    goto LABEL_13;
  }

  [presentedViewController dismissViewControllerAnimated:0 completion:0];
LABEL_13:
}

- (BOOL)isShowingOscarChat
{
  if (!IMIsOscarEnabled())
  {
    return 0;
  }

  v3 = +[CKConversationList sharedConversationList];
  conversation = [(CKCoreChatController *)self conversation];
  v5 = [v3 primaryFilterModeForConversation:conversation] == 9;

  return v5;
}

- (BOOL)isEditingMessage
{
  messageEditingViewController = [(CKChatController *)self messageEditingViewController];
  if (messageEditingViewController)
  {
    v4 = 1;
  }

  else
  {
    inlineReplyController = [(CKChatController *)self inlineReplyController];
    messageEditingViewController2 = [inlineReplyController messageEditingViewController];
    v4 = messageEditingViewController2 != 0;
  }

  return v4;
}

- (BOOL)isShowingReactWithAStickerOverlay
{
  fullScreenBalloonViewController = [(CKCoreChatController *)self fullScreenBalloonViewController];

  if (!fullScreenBalloonViewController)
  {
    return 0;
  }

  fullScreenBalloonViewController2 = [(CKCoreChatController *)self fullScreenBalloonViewController];
  displayConfiguration = [fullScreenBalloonViewController2 displayConfiguration];
  type = [displayConfiguration type];

  return type == 2;
}

- (id)splitViewController
{
  presentingViewController = [(CKChatController *)self presentingViewController];

  if (presentingViewController)
  {
    presentingViewController2 = [(CKChatController *)self presentingViewController];
    splitViewController = [presentingViewController2 splitViewController];
  }

  else
  {
    v7.receiver = self;
    v7.super_class = CKChatController;
    splitViewController = [(CKChatController *)&v7 splitViewController];
  }

  return splitViewController;
}

- (void)chatControllerWillBeginResizing
{
  fullScreenBalloonViewController = [(CKCoreChatController *)self fullScreenBalloonViewController];

  if (fullScreenBalloonViewController)
  {

    [(CKChatController *)self _dismissFullScreenBubbleViewControllerAnimated:0 withSendAnimation:0 completion:0];
  }
}

- (unint64_t)supportedInterfaceOrientations
{
  v3 = +[CKUIBehavior sharedBehaviors];
  supportedInterfaceOrientations = [v3 supportedInterfaceOrientations];
  inputController = [(CKCoreChatController *)self inputController];
  browserSupportedInterfaceOrientations = [inputController browserSupportedInterfaceOrientations];

  return browserSupportedInterfaceOrientations & supportedInterfaceOrientations;
}

- (void)performResumeDeferredSetup
{
  v7.receiver = self;
  v7.super_class = CKChatController;
  [(CKViewController *)&v7 performResumeDeferredSetup];
  deferredPresentationBlock = [(CKChatController *)self deferredPresentationBlock];

  if (deferredPresentationBlock)
  {
    v4 = dispatch_time(0, 200000000);
    deferredPresentationBlock2 = [(CKChatController *)self deferredPresentationBlock];
    dispatch_after(v4, MEMORY[0x1E69E96A0], deferredPresentationBlock2);

    [(CKChatController *)self setDeferredPresentationBlock:0];
  }

  collectionViewController = [(CKCoreChatController *)self collectionViewController];
  [collectionViewController performResumeDeferredSetup];
}

- (BOOL)shouldAutorotate
{
  autorotationUpdater = [(CKChatController *)self autorotationUpdater];
  isHoldingUpdates = [autorotationUpdater isHoldingUpdates];

  if (isHoldingUpdates)
  {
    return 0;
  }

  inputController = [(CKCoreChatController *)self inputController];
  browserShouldAutorotate = [inputController browserShouldAutorotate];

  return browserShouldAutorotate;
}

- (void)beginHoldingAutorotationForKey:(id)key
{
  keyCopy = key;
  autorotationUpdater = [(CKChatController *)self autorotationUpdater];
  [autorotationUpdater beginHoldingUpdatesForKey:keyCopy];

  autorotationUpdater2 = [(CKChatController *)self autorotationUpdater];
  [autorotationUpdater2 setNeedsUpdate];
}

- (void)endHoldingAutorotationForKey:(id)key
{
  keyCopy = key;
  autorotationUpdater = [(CKChatController *)self autorotationUpdater];
  [autorotationUpdater endHoldingUpdatesForKey:keyCopy];
}

- (void)sendComposition:(id)composition animations:(id)animations
{
  v74[1] = *MEMORY[0x1E69E9840];
  compositionCopy = composition;
  animationsCopy = animations;
  if (IMOSLoggingEnabled())
  {
    v7 = OSLogHandleForIMFoundationCategory();
    if (os_log_type_enabled(v7, OS_LOG_TYPE_INFO))
    {
      *buf = 0;
      _os_log_impl(&dword_19020E000, v7, OS_LOG_TYPE_INFO, "Sending composition from chat controller.", buf, 2u);
    }
  }

  v8 = _chatControllerTelemetryLogHandle();
  if (os_signpost_enabled(v8))
  {
    *buf = 0;
    _os_signpost_emit_with_name_impl(&dword_19020E000, v8, OS_SIGNPOST_INTERVAL_BEGIN, 0xEEEEB0B5B2B2EEEELL, "SendingMessage", " enableTelemetry=YES ", buf, 2u);
  }

  mEMORY[0x1E69DC668] = [MEMORY[0x1E69DC668] sharedApplication];
  -[CKChatController setSendingCompositionBackgroundTask:](self, "setSendingCompositionBackgroundTask:", [mEMORY[0x1E69DC668] beginBackgroundTaskWithName:@"CompositionSending" expirationHandler:&__block_literal_global_809]);

  inputController = [(CKCoreChatController *)self inputController];
  [inputController willSendComposition];

  inputController2 = [(CKCoreChatController *)self inputController];
  [inputController2 requestPhotoBrowserToPrepareForDraftClearingPhotoShelfViewController:0];

  if (![(CKChatController *)self showSendAlertIfNecessaryForComposition:compositionCopy])
  {
    inputController3 = [(CKCoreChatController *)self inputController];
    [inputController3 requestPhotoBrowserToAppendFinalImagesToComposition];

    conversation = [(CKCoreChatController *)self conversation];
    [conversation resetCaches];
    if ([(CKComposition *)compositionCopy hasContent])
    {
      v67 = [(CKChatController *)self nextMediaObjectToTrimInComposition:compositionCopy];
      if (v67)
      {
        shelfPluginPayload = [(CKComposition *)compositionCopy shelfPluginPayload];
        pluginBundleID = [shelfPluginPayload pluginBundleID];
        v15 = [pluginBundleID isEqualToString:*MEMORY[0x1E69A6A00]];

        pluginBundleID2 = [shelfPluginPayload pluginBundleID];
        v17 = IMBalloonExtensionIDWithSuffix();
        if ([pluginBundleID2 isEqualToString:v17] && (objc_opt_class(), (objc_opt_isKindOfClass() & 1) != 0))
        {
          shouldSendAsMediaObject = [shelfPluginPayload shouldSendAsMediaObject];
        }

        else
        {
          shouldSendAsMediaObject = 0;
        }

        if ((v15 | shouldSendAsMediaObject))
        {
          shelfPluginPayload2 = [(CKComposition *)compositionCopy shelfPluginPayload];
          __ck_photoCompositionString = [shelfPluginPayload2 __ck_photoCompositionString];

          text = [(CKComposition *)compositionCopy text];
          v23 = [text mutableCopy];

          if ([v23 length])
          {
            [v23 insertAttributedString:__ck_photoCompositionString atIndex:0];
          }

          else
          {
            v41 = [objc_alloc(MEMORY[0x1E696AAB0]) initWithAttributedString:__ck_photoCompositionString];
            v42 = [v41 mutableCopy];

            v23 = v42;
          }

          v43 = [CKComposition alloc];
          subject = [(CKComposition *)compositionCopy subject];
          v40 = [(CKComposition *)v43 initWithText:v23 subject:subject shelfPluginPayload:0];

          entryView = [(CKChatController *)self entryView];
          [entryView setComposition:v40];

          v46 = [(CKChatController *)self nextMediaObjectToTrimInComposition:v40];

          v67 = v46;
        }

        else
        {
          v40 = compositionCopy;
        }

        mediaObjects = [(CKComposition *)v40 mediaObjects];
        if ([mediaObjects count] == 1)
        {
          v47 = [mediaObjects objectAtIndex:0];
          v48 = [v47 mediaType] == 2;

          v49 = CKFrameworkBundle();
          v50 = v49;
          if (v48)
          {
            v64 = [v49 localizedStringForKey:@"TRIM_ONE_VIDEO_TITLE" value:&stru_1F04268F8 table:@"ChatKit"];
            v51 = @"TRIM_ONE_VIDEO_MESSAGE";
          }

          else
          {
            v64 = [v49 localizedStringForKey:@"TRIM_ONE_ATTACHMENT_TITLE" value:&stru_1F04268F8 table:@"ChatKit"];
            v51 = @"TRIM_ONE_ATTACHMENT_MESSAGE";
          }
        }

        else
        {
          v50 = CKFrameworkBundle();
          v64 = [v50 localizedStringForKey:@"TRIM_MANY_ATTACHMENTS_TITLE" value:&stru_1F04268F8 table:@"ChatKit"];
          v51 = @"TRIM_MANY_ATTACHMENTS_MESSAGE";
        }

        v52 = CKFrameworkBundle();
        v53 = [v52 localizedStringForKey:v51 value:&stru_1F04268F8 table:@"ChatKit"];

        v54 = [CKAlertController alertControllerWithTitle:v64 message:v53 preferredStyle:1];
        v55 = CKFrameworkBundle();
        v56 = [v55 localizedStringForKey:@"OK" value:&stru_1F04268F8 table:@"ChatKit"];
        v70[0] = MEMORY[0x1E69E9820];
        v70[1] = 3221225472;
        v70[2] = __47__CKChatController_sendComposition_animations___block_invoke_830;
        v70[3] = &unk_1E72EC710;
        v70[4] = self;
        compositionCopy = v40;
        v71 = compositionCopy;
        v57 = [CKAlertAction actionWithTitle:v56 style:0 handler:v70];
        [v54 addAction:v57];

        v58 = CKFrameworkBundle();
        v59 = [v58 localizedStringForKey:@"CANCEL" value:&stru_1F04268F8 table:@"ChatKit"];
        v60 = [CKAlertAction actionWithTitle:v59 style:1 handler:0];
        [v54 addAction:v60];

        [v54 presentFromViewController:self animated:1 completion:0];
        if (os_signpost_enabled(v8))
        {
          *buf = 0;
          _os_signpost_emit_with_name_impl(&dword_19020E000, v8, OS_SIGNPOST_INTERVAL_END, 0xEEEEB0B5B2B2EEEELL, "SendingMessage", "Send message failed: Bad attachment", buf, 2u);
        }

        if (IMOSLoggingEnabled())
        {
          v61 = OSLogHandleForIMFoundationCategory();
          if (os_log_type_enabled(v61, OS_LOG_TYPE_INFO))
          {
            *buf = 0;
            _os_log_impl(&dword_19020E000, v61, OS_LOG_TYPE_INFO, "Bad attachment, not sending message", buf, 2u);
          }
        }

        goto LABEL_62;
      }

      _isRunningPPT = [(CKChatController *)self _isRunningPPT];
      recipients = [conversation recipients];
      v26 = [conversation canSendToRecipients:recipients alertIfUnable:1];

      if ((v26 | _isRunningPPT))
      {
        activeKeyboard = [MEMORY[0x1E69DCBB8] activeKeyboard];
        [activeKeyboard removeAutocorrectPrompt];

        isSendingMessage = [(CKCoreChatController *)self isSendingMessage];
        [(CKChatController *)self setSendingMessage:1];
        [(CKChatController *)self _updateNavigationButtons];
        [(CKChatController *)self _willSendComposition:compositionCopy inConversation:conversation];
        shelfPluginPayload3 = [(CKComposition *)compositionCopy shelfPluginPayload];
        objc_opt_class();
        isKindOfClass = objc_opt_isKindOfClass();

        if ((isKindOfClass & 1) == 0 || (-[CKComposition shelfPluginPayload](compositionCopy, "shelfPluginPayload"), v31 = objc_claimAutoreleasedReturnValue(), v32 = [v31 useDirectSend], v31, (v32 & 1) == 0))
        {
          [conversation setUnsentComposition:0];
        }

        shareSheetHostBundleIdentifier = [(CKChatController *)self shareSheetHostBundleIdentifier];
        [(CKComposition *)compositionCopy evaluateSendMetricsWithConversation:conversation shareSheetHostBundleIdentifier:shareSheetHostBundleIdentifier];

        if (!CKIsRunningInMacCatalyst())
        {
          proofreadingInfo = [(CKComposition *)compositionCopy proofreadingInfo];
          if ([proofreadingInfo count])
          {
            conversation2 = [(CKCoreChatController *)self conversation];
            chat = [conversation2 chat];
            v73 = *MEMORY[0x1E69A5860];
            v74[0] = proofreadingInfo;
            v37 = [MEMORY[0x1E695DF20] dictionaryWithObjects:v74 forKeys:&v73 count:1];
            [chat setProofreadingInfo:v37];
          }
        }

        v38 = [(CKChatController *)self shouldUseThrowAnimationForComposition:compositionCopy];
        if (animationsCopy)
        {
          v39 = isSendingMessage;
        }

        else
        {
          v39 = 1;
        }

        if (!v38 || (v39 & 1) != 0)
        {
          if (IMOSLoggingEnabled())
          {
            v62 = OSLogHandleForIMFoundationCategory();
            if (os_log_type_enabled(v62, OS_LOG_TYPE_INFO))
            {
              *buf = 0;
              _os_log_impl(&dword_19020E000, v62, OS_LOG_TYPE_INFO, "Sending message without a throw animation.", buf, 2u);
            }
          }

          [(CKChatController *)self sendCompositionWithoutThrow:compositionCopy];
        }

        else
        {
          animationsCopy[2]();
        }

        [(CKChatController *)self _clearCompositionAndPendingConversation];
        if (IMOSLoggingEnabled())
        {
          v63 = OSLogHandleForIMFoundationCategory();
          if (os_log_type_enabled(v63, OS_LOG_TYPE_INFO))
          {
            *buf = 0;
            _os_log_impl(&dword_19020E000, v63, OS_LOG_TYPE_INFO, "Sending message complete.", buf, 2u);
          }
        }

        if (os_signpost_enabled(v8))
        {
          *buf = 0;
          _os_signpost_emit_with_name_impl(&dword_19020E000, v8, OS_SIGNPOST_INTERVAL_END, 0xEEEEB0B5B2B2EEEELL, "SendingMessage", " enableTelemetry=YES ", buf, 2u);
        }

        goto LABEL_62;
      }

      if (os_signpost_enabled(v8))
      {
        *buf = 0;
        _os_signpost_emit_with_name_impl(&dword_19020E000, v8, OS_SIGNPOST_INTERVAL_END, 0xEEEEB0B5B2B2EEEELL, "SendingMessage", "Send message failed: Cannot send", buf, 2u);
      }

      if (!IMOSLoggingEnabled())
      {
        goto LABEL_62;
      }

      v19 = OSLogHandleForIMFoundationCategory();
      if (os_log_type_enabled(v19, OS_LOG_TYPE_INFO))
      {
        *buf = 0;
        _os_log_impl(&dword_19020E000, v19, OS_LOG_TYPE_INFO, "Cannot send message to recipients. Not sending message", buf, 2u);
      }
    }

    else
    {
      [(CKChatController *)self messageEntryViewDidChange:0 isTextChange:1 isShelfChange:0 isTranslationChange:0];
      if (os_signpost_enabled(v8))
      {
        *buf = 0;
        _os_signpost_emit_with_name_impl(&dword_19020E000, v8, OS_SIGNPOST_INTERVAL_END, 0xEEEEB0B5B2B2EEEELL, "SendingMessage", "Send message failed: Empty message content", buf, 2u);
      }

      if (!IMOSLoggingEnabled())
      {
        goto LABEL_62;
      }

      v19 = OSLogHandleForIMFoundationCategory();
      if (os_log_type_enabled(v19, OS_LOG_TYPE_INFO))
      {
        *buf = 0;
        _os_log_impl(&dword_19020E000, v19, OS_LOG_TYPE_INFO, "Composition has no content. Not sending message", buf, 2u);
      }
    }

LABEL_62:
    goto LABEL_63;
  }

  if (IMOSLoggingEnabled())
  {
    v12 = OSLogHandleForIMFoundationCategory();
    if (os_log_type_enabled(v12, OS_LOG_TYPE_INFO))
    {
      *buf = 0;
      _os_log_impl(&dword_19020E000, v12, OS_LOG_TYPE_INFO, "Cannot send message. Showing send alert instead.", buf, 2u);
    }
  }

LABEL_63:
}

void __47__CKChatController_sendComposition_animations___block_invoke()
{
  v0 = IMLogHandleForCategory();
  if (os_log_type_enabled(v0, OS_LOG_TYPE_ERROR))
  {
    __47__CKChatController_sendComposition_animations___block_invoke_cold_1();
  }
}

- (BOOL)showSendAlertIfNecessaryForComposition:(id)composition
{
  compositionCopy = composition;
  conversation = [(CKCoreChatController *)self conversation];
  v20 = 0;
  v6 = [conversation canSendComposition:compositionCopy error:&v20];

  v7 = v20;
  if ((v6 & 1) != 0 || [(CKChatController *)self _isRunningPPT])
  {
    v8 = 0;
  }

  else
  {
    if (v7)
    {
      v9 = CKFrameworkBundle();
      v10 = [v9 localizedStringForKey:@"CANNOT_SEND_MESSAGE" value:&stru_1F04268F8 table:@"ChatKit"];

      v11 = CKFrameworkBundle();
      v12 = [v11 localizedStringForKey:@"OK" value:&stru_1F04268F8 table:@"ChatKit"];

      v13 = CKCreateAlertControllerWithError(v7, v10, 0, v12, 0);
      effectPickerViewController = [(CKChatController *)self effectPickerViewController];
      if (effectPickerViewController)
      {
        selfCopy = [(CKChatController *)self effectPickerViewController];
      }

      else
      {
        selfCopy = self;
      }

      v16 = selfCopy;

      [v13 presentFromViewController:v16 animated:1 completion:0];
    }

    v17 = _chatControllerTelemetryLogHandle();
    if (os_signpost_enabled(v17))
    {
      *v19 = 0;
      _os_signpost_emit_with_name_impl(&dword_19020E000, v17, OS_SIGNPOST_INTERVAL_END, 0xEEEEB0B5B2B2EEEELL, "SendingMessage", "Send message failed: Cannot send", v19, 2u);
    }

    v8 = 1;
  }

  return v8;
}

- (void)_clearCompositionAndPendingConversation
{
  dropComposition = self->_dropComposition;
  self->_dropComposition = 0;

  conversation = [(CKCoreChatController *)self conversation];
  chat = [conversation chat];
  guid = [chat guid];
  if (guid)
  {
    v6 = guid;
    conversation2 = [(CKCoreChatController *)self conversation];
    chat2 = [conversation2 chat];
    guid2 = [chat2 guid];
    v10 = +[CKConversationList sharedConversationList];
    pendingConversation = [v10 pendingConversation];
    chat3 = [pendingConversation chat];
    guid3 = [chat3 guid];
    v14 = [guid2 isEqualToString:guid3];

    if (!v14)
    {
      return;
    }

    conversation = +[CKConversationList sharedConversationList];
    [conversation unpendConversation];
  }

  else
  {
  }
}

- (void)sendComposition:(id)composition
{
  compositionCopy = composition;
  v6[0] = MEMORY[0x1E69E9820];
  v6[1] = 3221225472;
  v6[2] = __36__CKChatController_sendComposition___block_invoke;
  v6[3] = &unk_1E72EB8D0;
  v6[4] = self;
  v7 = compositionCopy;
  v5 = compositionCopy;
  [(CKChatController *)self sendComposition:v5 animations:v6];
}

- (void)beginThrowAnimationForComposition:(id)composition
{
  compositionCopy = composition;
  if (IMOSLoggingEnabled())
  {
    v5 = OSLogHandleForIMFoundationCategory();
    if (os_log_type_enabled(v5, OS_LOG_TYPE_INFO))
    {
      LOWORD(buf[0]) = 0;
      _os_log_impl(&dword_19020E000, v5, OS_LOG_TYPE_INFO, "Beginning throw animation.", buf, 2u);
    }
  }

  v6 = [(CKChatController *)self makeThrowAnimationManagerForComposition:compositionCopy];
  [(CKChatController *)self setThrowSendAnimationManager:v6];
  conversation = [(CKCoreChatController *)self conversation];
  v8 = [conversation messagesFromComposition:compositionCopy];
  objc_initWeak(buf, self);
  collectionViewController = [(CKCoreChatController *)self collectionViewController];
  updateAnimationGroup = [collectionViewController updateAnimationGroup];
  v14[0] = MEMORY[0x1E69E9820];
  v14[1] = 3221225472;
  v14[2] = __54__CKChatController_beginThrowAnimationForComposition___block_invoke;
  v14[3] = &unk_1E72ED610;
  objc_copyWeak(&v18, buf);
  v15 = compositionCopy;
  v16 = v6;
  v17 = v8;
  v11 = v8;
  v12 = v6;
  v13 = compositionCopy;
  dispatch_group_notify(updateAnimationGroup, MEMORY[0x1E69E96A0], v14);

  objc_destroyWeak(&v18);
  objc_destroyWeak(buf);
}

uint64_t __54__CKChatController_beginThrowAnimationForComposition___block_invoke(uint64_t a1)
{
  WeakRetained = objc_loadWeakRetained((a1 + 56));
  [WeakRetained flagSensitiveMediaObjects:*(a1 + 32)];

  [MEMORY[0x1E6979518] begin];
  [*(a1 + 40) animateMessages:*(a1 + 48)];
  v3 = MEMORY[0x1E6979518];

  return [v3 commit];
}

- (void)sendCompositionWithoutThrow:(id)throw
{
  v29 = *MEMORY[0x1E69E9840];
  throwCopy = throw;
  conversation = [(CKCoreChatController *)self conversation];
  [(CKChatController *)self flagSensitiveMediaObjects:throwCopy];
  v6 = [conversation messagesFromComposition:throwCopy];
  v23 = 0u;
  v24 = 0u;
  v25 = 0u;
  v26 = 0u;
  v7 = [v6 countByEnumeratingWithState:&v23 objects:v28 count:16];
  if (v7)
  {
    v8 = v7;
    v9 = *v24;
    do
    {
      v10 = 0;
      do
      {
        if (*v24 != v9)
        {
          objc_enumerationMutation(v6);
        }

        [(CKChatController *)self sendMessage:*(*(&v23 + 1) + 8 * v10++) forConversation:conversation newComposition:0];
      }

      while (v8 != v10);
      v8 = [v6 countByEnumeratingWithState:&v23 objects:v28 count:16];
    }

    while (v8);
  }

  shelfPluginPayload = [throwCopy shelfPluginPayload];
  objc_opt_class();
  isKindOfClass = objc_opt_isKindOfClass();

  if ((isKindOfClass & 1) == 0 || ([throwCopy shelfPluginPayload], v13 = objc_claimAutoreleasedReturnValue(), v14 = objc_msgSend(v13, "useDirectSend"), v13, (v14 & 1) == 0))
  {
    entryView = [(CKChatController *)self entryView];
    [entryView invalidateCompositionForReason:1];
  }

  [(CKChatController *)self _updateNavigationButtons];
  [conversation setIgnoringTypingUpdates:0];
  [(CKChatController *)self setSendingMessage:0];
  [(CKChatController *)self _didSendCompositionInConversation:conversation];
  expressiveSendStyleID = [throwCopy expressiveSendStyleID];
  if (![CKImpactEffectManager identifierIsAnimatedImpactEffect:expressiveSendStyleID])
  {

    goto LABEL_15;
  }

  collectionViewController = [(CKCoreChatController *)self collectionViewController];
  v18 = [(CKCoreChatController *)self transcriptCollectionViewControllerPlaybackForOutgoingEffectsIsAllowed:collectionViewController];

  if (!v18)
  {
LABEL_15:
    [(CKChatController *)self dismissEffectPickerAnimated:0];
    goto LABEL_16;
  }

  collectionViewController2 = [(CKCoreChatController *)self collectionViewController];
  impactEffectManager = [collectionViewController2 impactEffectManager];
  lastObject = [v6 lastObject];
  v27 = lastObject;
  v22 = [MEMORY[0x1E695DEC8] arrayWithObjects:&v27 count:1];
  [impactEffectManager animateMessages:v22];

LABEL_16:
}

- (BOOL)shouldUseThrowAnimationForComposition:(id)composition
{
  compositionCopy = composition;
  if (-[CKCoreChatController shouldDismissAfterSend](self, "shouldDismissAfterSend") || ![compositionCopy isSendAnimated])
  {
    v7 = 0;
  }

  else
  {
    v5 = +[CKUIBehavior sharedBehaviors];
    if ([v5 showsSendAnimation])
    {
      expressiveSendStyleID = [compositionCopy expressiveSendStyleID];
      if ([CKImpactEffectManager identifierIsValidImpactEffect:expressiveSendStyleID])
      {
        v7 = 0;
      }

      else
      {
        collectionViewController = [(CKCoreChatController *)self collectionViewController];
        v7 = collectionViewController != 0;
      }
    }

    else
    {
      v7 = 0;
    }
  }

  return v7;
}

- (void)updateChatControllerForRecoveredJunkConversation
{
  conversation = [(CKCoreChatController *)self conversation];
  chat = [conversation chat];
  [chat _reloadChatItemsForFilteringChange];

  [(CKChatController *)self addOrRemoveEntryViewIfNeeded];
  [(CKChatController *)self becomeFirstResponder];

  [(CKChatController *)self reloadInputViews];
}

- (void)performAnimatedJunkRecoveryTransition:(id)transition
{
  v45 = *MEMORY[0x1E69E9840];
  transitionCopy = transition;
  _currentPresentationController = [(CKChatController *)self _currentPresentationController];
  objc_opt_class();
  if (objc_opt_isKindOfClass())
  {
    if (IMOSLoggingEnabled())
    {
      v6 = OSLogHandleForIMFoundationCategory();
      if (os_log_type_enabled(v6, OS_LOG_TYPE_INFO))
      {
        *buf = 138412290;
        selfCopy = self;
        _os_log_impl(&dword_19020E000, v6, OS_LOG_TYPE_INFO, "Transitioning chatController: %@ to full screen presentation", buf, 0xCu);
      }
    }

    collectionViewController = [(CKCoreChatController *)self collectionViewController];
    [collectionViewController setTransitioningFromComposing:1];

    v8 = _currentPresentationController;
    v9 = +[CKUIBehavior sharedBehaviors];
    [v9 sendAnimationDuration];
    v11 = v10;

    containerView = [v8 containerView];
    _UISheetMinimumTopInset();
    v14 = v13;

    collectionView = [(CKChatController *)self collectionView];
    [collectionView beginDisablingTranscriptDynamicsForReason:3];
    collectionView2 = [(CKChatController *)self collectionView];
    [collectionView2 contentOffset];
    v18 = v17;
    v20 = v19;

    containerView2 = [v8 containerView];
    [containerView2 bounds];
    v23 = v22;
    v25 = v24;
    v27 = v26;
    v29 = v28;

    collectionView3 = [(CKChatController *)self collectionView];
    [collectionView3 setAutoresizingMask:0];

    collectionView4 = [(CKChatController *)self collectionView];
    [collectionView4 setFrame:{v23, v25 - v14, v27, v29}];

    collectionView5 = [(CKChatController *)self collectionView];
    [collectionView5 setContentOffset:{v18, v20 - v14}];

    collectionView6 = [(CKChatController *)self collectionView];
    [collectionView6 layoutIfNeeded];

    v34 = MEMORY[0x1E69DD250];
    v40[0] = MEMORY[0x1E69E9820];
    v40[1] = 3221225472;
    v40[2] = __58__CKChatController_performAnimatedJunkRecoveryTransition___block_invoke;
    v40[3] = &unk_1E72EB8D0;
    v41 = v8;
    selfCopy2 = self;
    v37[0] = MEMORY[0x1E69E9820];
    v37[1] = 3221225472;
    v37[2] = __58__CKChatController_performAnimatedJunkRecoveryTransition___block_invoke_2;
    v37[3] = &unk_1E72ED638;
    v38 = collectionView;
    v39 = transitionCopy;
    v35 = collectionView;
    v36 = v8;
    [v34 animateWithDuration:v40 animations:v37 completion:v11];
  }
}

void __58__CKChatController_performAnimatedJunkRecoveryTransition___block_invoke(uint64_t a1)
{
  [*(a1 + 32) _setWantsFullScreen:{objc_msgSend(*(a1 + 32), "_wantsFullScreen") ^ 1}];
  v2 = [*(a1 + 32) containerView];
  [v2 layoutIfNeeded];

  v3 = [*(a1 + 32) containerView];
  [v3 bounds];
  v5 = v4;
  v7 = v6;
  v9 = v8;
  v11 = v10;

  v12 = [*(a1 + 40) collectionView];
  [v12 setFrame:{v5, v7, v9, v11}];
}

uint64_t __58__CKChatController_performAnimatedJunkRecoveryTransition___block_invoke_2(uint64_t a1)
{
  [*(a1 + 32) endDisablingTranscriptDynamicsForReason:3];
  result = *(a1 + 40);
  if (result)
  {
    v3 = *(result + 16);

    return v3();
  }

  return result;
}

- (void)setupStateForLaunchURL:(id)l
{
  v35 = *MEMORY[0x1E69E9840];
  lCopy = l;
  scheme = [lCopy scheme];
  lowercaseString = [scheme lowercaseString];
  if ([lowercaseString isEqualToString:@"itms-messages"])
  {
  }

  else
  {
    scheme2 = [lCopy scheme];
    lowercaseString2 = [scheme2 lowercaseString];
    v8 = [lowercaseString2 isEqualToString:@"itms-messagess"];

    if (!v8)
    {
      goto LABEL_9;
    }
  }

  if (IMOSLoggingEnabled())
  {
    v9 = OSLogHandleForIMFoundationCategory();
    if (os_log_type_enabled(v9, OS_LOG_TYPE_INFO))
    {
      *buf = 136315138;
      v34 = "[CKChatController setupStateForLaunchURL:]";
      _os_log_impl(&dword_19020E000, v9, OS_LOG_TYPE_INFO, "reloadEntryViewIfNeeded called from (1) %s", buf, 0xCu);
    }
  }

  [(CKChatController *)self reloadEntryViewIfNeeded];
  inputController = [(CKCoreChatController *)self inputController];
  [inputController presentAppStoreForURL:lCopy];

  mEMORY[0x1E69A8168] = [MEMORY[0x1E69A8168] sharedInstance];
  [mEMORY[0x1E69A8168] trackEvent:*MEMORY[0x1E69A7310]];

LABEL_9:
  v12 = [MEMORY[0x1E696AF20] componentsWithURL:lCopy resolvingAgainstBaseURL:0];
  [v12 queryItems];
  v30 = 0u;
  v31 = 0u;
  v28 = 0u;
  v13 = v29 = 0u;
  v14 = [v13 countByEnumeratingWithState:&v28 objects:v32 count:16];
  if (v14)
  {
    v15 = *v29;
    while (2)
    {
      for (i = 0; i != v14; ++i)
      {
        if (*v29 != v15)
        {
          objc_enumerationMutation(v13);
        }

        v17 = *(*(&v28 + 1) + 8 * i);
        name = [v17 name];
        v19 = [name isEqualToString:@"inputmode"];

        if (v19)
        {
          if (IMOSLoggingEnabled())
          {
            v20 = OSLogHandleForIMFoundationCategory();
            if (os_log_type_enabled(v20, OS_LOG_TYPE_INFO))
            {
              *buf = 136315138;
              v34 = "[CKChatController setupStateForLaunchURL:]";
              _os_log_impl(&dword_19020E000, v20, OS_LOG_TYPE_INFO, "reloadEntryViewIfNeeded called from (2) %s", buf, 0xCu);
            }
          }

          [(CKChatController *)self reloadEntryViewIfNeeded];
          value = [v17 value];
          if ([value isEqualToString:@"photos"])
          {
            inputController2 = [(CKCoreChatController *)self inputController];
            [inputController2 showPhotosExtension];
          }

          else if ([value isEqualToString:@"camera"])
          {
            inputController3 = [(CKCoreChatController *)self inputController];
            [inputController3 showFunCamera];
          }

          else if ([value isEqualToString:@"dt"])
          {
            inputController4 = [(CKCoreChatController *)self inputController];
            [inputController4 showDTCompose];
          }

          else
          {
            [value isEqualToString:@"apps"];
          }

          goto LABEL_30;
        }
      }

      v14 = [v13 countByEnumeratingWithState:&v28 objects:v32 count:16];
      if (v14)
      {
        continue;
      }

      break;
    }
  }

LABEL_30:

  ckLaunchURLBalloonPluginBundleID = [lCopy ckLaunchURLBalloonPluginBundleID];
  if ([ckLaunchURLBalloonPluginBundleID length])
  {
    ckLaunchURLBalloonPluginPayload = [lCopy ckLaunchURLBalloonPluginPayload];
    [(CKChatController *)self setupStateForLaunchPluginWithBundleID:ckLaunchURLBalloonPluginBundleID pluginPayload:ckLaunchURLBalloonPluginPayload];
  }
}

- (void)setupStateForLaunchPluginWithBundleID:(id)d pluginPayload:(id)payload
{
  dCopy = d;
  payloadCopy = payload;
  if ([dCopy length])
  {
    objc_initWeak(&location, self);
    aBlock[0] = MEMORY[0x1E69E9820];
    aBlock[1] = 3221225472;
    aBlock[2] = __72__CKChatController_setupStateForLaunchPluginWithBundleID_pluginPayload___block_invoke;
    aBlock[3] = &unk_1E72ED660;
    v12 = dCopy;
    objc_copyWeak(&v14, &location);
    v13 = payloadCopy;
    v8 = _Block_copy(aBlock);
    if (CKIsRunningInMacCatalyst() && [(CKViewController *)self deferredAppeared])
    {
      block[0] = MEMORY[0x1E69E9820];
      block[1] = 3221225472;
      block[2] = __72__CKChatController_setupStateForLaunchPluginWithBundleID_pluginPayload___block_invoke_2;
      block[3] = &unk_1E72EBDB8;
      v10 = v8;
      dispatch_async(MEMORY[0x1E69E96A0], block);
    }

    else
    {
      [(CKChatController *)self setDeferredPresentationBlock:v8];
    }

    objc_destroyWeak(&v14);
    objc_destroyWeak(&location);
  }
}

void __72__CKChatController_setupStateForLaunchPluginWithBundleID_pluginPayload___block_invoke(uint64_t a1)
{
  v2 = [*(a1 + 32) isEqualToString:*MEMORY[0x1E69A69C0]];
  WeakRetained = objc_loadWeakRetained((a1 + 48));
  v3 = [WeakRetained inputController];
  v4 = v3;
  if (v2)
  {
    [v3 showFunCamera];
  }

  else
  {
    [v3 presentPluginWithBundleID:*(a1 + 32) appLaunchPayload:*(a1 + 40)];
  }
}

- (void)setupStateForLaunchAudio
{
  objc_initWeak(&location, self);
  v3[0] = MEMORY[0x1E69E9820];
  v3[1] = 3221225472;
  v3[2] = __44__CKChatController_setupStateForLaunchAudio__block_invoke;
  v3[3] = &unk_1E72EC460;
  objc_copyWeak(&v4, &location);
  [(CKChatController *)self setDeferredPresentationBlock:v3];
  objc_destroyWeak(&v4);
  objc_destroyWeak(&location);
}

void __44__CKChatController_setupStateForLaunchAudio__block_invoke(uint64_t a1)
{
  WeakRetained = objc_loadWeakRetained((a1 + 32));
  v1 = [WeakRetained inputController];
  v2 = [v1 entryView];
  [v2 startRecordingForAudioButtonInEntryView];
}

- (CKComposition)composition
{
  entryView = [(CKChatController *)self entryView];
  v4 = entryView;
  if (entryView)
  {
    [entryView composition];
  }

  else
  {
    [(CKChatController *)self initialComposition];
  }
  v5 = ;

  return v5;
}

- (void)setComposition:(id)composition
{
  v13 = *MEMORY[0x1E69E9840];
  compositionCopy = composition;
  [(CKChatController *)self setCollaborationFailureCount:0];
  if ([(CKCoreChatController *)self initialLayoutComplete])
  {
    entryView = [(CKChatController *)self entryView];

    if (!entryView)
    {
      if (IMOSLoggingEnabled())
      {
        v6 = OSLogHandleForIMFoundationCategory();
        if (os_log_type_enabled(v6, OS_LOG_TYPE_INFO))
        {
          LOWORD(v11) = 0;
          _os_log_impl(&dword_19020E000, v6, OS_LOG_TYPE_INFO, "entry view is nil", &v11, 2u);
        }
      }

      if (IMOSLoggingEnabled())
      {
        v7 = OSLogHandleForIMFoundationCategory();
        if (os_log_type_enabled(v7, OS_LOG_TYPE_INFO))
        {
          v11 = 136315138;
          v12 = "[CKChatController setComposition:]";
          _os_log_impl(&dword_19020E000, v7, OS_LOG_TYPE_INFO, "reloadEntryViewIfNeeded called from %s", &v11, 0xCu);
        }
      }

      [(CKChatController *)self reloadEntryViewIfNeeded];
    }
  }

  entryView2 = [(CKChatController *)self entryView];
  v9 = entryView2;
  if (entryView2)
  {
    [entryView2 setComposition:compositionCopy];
  }

  else
  {
    if (IMOSLoggingEnabled())
    {
      v10 = OSLogHandleForIMFoundationCategory();
      if (os_log_type_enabled(v10, OS_LOG_TYPE_INFO))
      {
        LOWORD(v11) = 0;
        _os_log_impl(&dword_19020E000, v10, OS_LOG_TYPE_INFO, "entry view is nil, set initial composition", &v11, 2u);
      }
    }

    [(CKChatController *)self setInitialComposition:compositionCopy];
  }
}

- (void)showKeyboard
{
  [(CKChatController *)self setTargetFirstResponder:1];

  [(CKChatController *)self becomeFirstResponder];
}

- (BOOL)showKeyboardForReply
{
  entryView = [(CKChatController *)self entryView];
  contentView = [entryView contentView];
  isActive = [contentView isActive];

  if ((isActive & 1) == 0)
  {
    [(CKChatController *)self setTargetFirstResponder:1];
    [(CKChatController *)self becomeFirstResponder];
  }

  return isActive ^ 1;
}

- (void)dismissKeyboard
{
  if ([(CKChatController *)self isKeyboardSnapshotted])
  {
    [(CKChatController *)self animatedDismissalOfKeyboardSnapshot];
  }

  v3.receiver = self;
  v3.super_class = CKChatController;
  [(CKChatController *)&v3 becomeFirstResponder];
}

- (void)scrollToMessage:(id)message atSpecificMessagePartIndex:(int64_t)index highlight:(BOOL)highlight withInlineReplyOverlay:(BOOL)overlay alignedWithView:(id)view allowOverScroll:(BOOL)scroll
{
  overlayCopy = overlay;
  highlightCopy = highlight;
  viewCopy = view;
  guid = [message guid];
  LOBYTE(v15) = scroll;
  [(CKChatController *)self scrollToMessageGUID:guid atSpecificMessagePartIndex:index highlight:highlightCopy autoDismissHighlight:1 withInlineReplyOverlay:overlayCopy alignedWithView:viewCopy allowOverScroll:v15 scrollPosition:2];
}

- (void)scrollToMessageGUID:(id)d atSpecificMessagePartIndex:(int64_t)index highlight:(BOOL)highlight autoDismissHighlight:(BOOL)dismissHighlight withInlineReplyOverlay:(BOOL)overlay alignedWithView:(id)view allowOverScroll:(BOOL)scroll scrollPosition:(unint64_t)self0
{
  overlayCopy = overlay;
  dismissHighlightCopy = dismissHighlight;
  highlightCopy = highlight;
  viewCopy = view;
  dCopy = d;
  v18 = objc_opt_new();
  [v18 setMessageGUID:dCopy];

  [v18 setHighlight:highlightCopy];
  [v18 setPartIndex:index];
  [v18 setAutoDismissHightlight:dismissHighlightCopy];
  [v18 setInlineReplyOverlay:overlayCopy];
  [v18 setViewToAlignWith:viewCopy];

  [v18 setAllowOverScroll:scroll];
  [v18 setScrollPosition:position];
  [(CKChatController *)self transcriptScrollWithConfiguration:v18];
}

- (void)transcriptScrollWithConfiguration:(id)configuration
{
  v32 = *MEMORY[0x1E69E9840];
  configurationCopy = configuration;
  if (IMOSLoggingEnabled())
  {
    v5 = OSLogHandleForIMFoundationCategory();
    if (os_log_type_enabled(v5, OS_LOG_TYPE_INFO))
    {
      *buf = 138412290;
      v31 = configurationCopy;
      _os_log_impl(&dword_19020E000, v5, OS_LOG_TYPE_INFO, "Requested scroll with configuration: %@", buf, 0xCu);
    }
  }

  messageGUID = [configurationCopy messageGUID];
  partIndex = [configurationCopy partIndex];
  highlight = [configurationCopy highlight];
  autoDismissHightlight = [configurationCopy autoDismissHightlight];
  inlineReplyOverlay = [configurationCopy inlineReplyOverlay];
  viewToAlignWith = [configurationCopy viewToAlignWith];
  allowOverScroll = [configurationCopy allowOverScroll];
  scrollPosition = [configurationCopy scrollPosition];
  animated = [configurationCopy animated];
  emphasize = [configurationCopy emphasize];
  objc_initWeak(buf, self);
  aBlock[0] = MEMORY[0x1E69E9820];
  aBlock[1] = 3221225472;
  aBlock[2] = __54__CKChatController_transcriptScrollWithConfiguration___block_invoke;
  aBlock[3] = &unk_1E72ED688;
  objc_copyWeak(v23, buf);
  v13 = messageGUID;
  v20 = v13;
  v23[1] = partIndex;
  v14 = viewToAlignWith;
  v24 = allowOverScroll;
  v23[2] = scrollPosition;
  v25 = animated;
  v26 = highlight;
  v27 = autoDismissHightlight;
  v28 = emphasize;
  v29 = inlineReplyOverlay;
  v21 = v14;
  selfCopy = self;
  v15 = _Block_copy(aBlock);
  if ([(CKCoreChatController *)self initialLayoutComplete])
  {
    v15[2](v15);
  }

  else
  {
    [(CKChatController *)self setScrollBlock:v15];
  }

  objc_destroyWeak(v23);
  objc_destroyWeak(buf);
}

void __54__CKChatController_transcriptScrollWithConfiguration___block_invoke(uint64_t a1)
{
  v20 = *MEMORY[0x1E69E9840];
  WeakRetained = objc_loadWeakRetained((a1 + 56));
  v3 = WeakRetained;
  if (WeakRetained)
  {
    v4 = [WeakRetained collectionViewController];
    v5 = [v4 collectionView];
    [v5 setTranscriptScrollIntent:2];
    v6 = [[CKTranscriptHighlightedMessageScrollContext alloc] initWithMessageGUID:*(a1 + 32) messagePartIndex:*(a1 + 64) viewToAlignWith:*(a1 + 40) allowOverScroll:*(a1 + 80) scrollPosition:*(a1 + 72)];
    [v5 setHighlightedMessageScrollContext:v6];

    v7 = [v3 indexPathForMessageGUID:*(a1 + 32) messagePartIndex:*(a1 + 64)];
    if (v7)
    {
      if (IMOSLoggingEnabled())
      {
        v8 = OSLogHandleForIMFoundationCategory();
        if (os_log_type_enabled(v8, OS_LOG_TYPE_INFO))
        {
          v9 = *(a1 + 32);
          v16 = 138412546;
          v17 = v9;
          v18 = 2112;
          v19 = v7;
          _os_log_impl(&dword_19020E000, v8, OS_LOG_TYPE_INFO, "Will scroll to messageGUID: %@, indexPath: %@", &v16, 0x16u);
        }
      }

      [v3 contentOffsetForIndexPath:v7 viewToAlignWith:*(a1 + 40) allowOverScroll:*(a1 + 80) scrollPosition:*(a1 + 72)];
      v11 = v10;
      v13 = v12;
      [v5 beginDisablingTranscriptDynamicsForReason:14];
      [v5 setContentOffset:*(a1 + 81) animated:{v11, v13}];
      [v5 endDisablingTranscriptDynamicsForReason:14];
      if (*(a1 + 82) == 1)
      {
        [v4 highlightItemAtIndexPathWhenDisplayed:v7 animated:1 autoDismiss:*(a1 + 83)];
      }

      else if (*(a1 + 84) == 1)
      {
        [v4 beginEmphasisWithMessageGUID:*(a1 + 32)];
      }

      if (*(a1 + 85) != 1)
      {
        goto LABEL_16;
      }

      v14 = [v4 chatItems];
      v15 = [CKSocialLayerChatController chatItemForMessageGUID:*(a1 + 32) messagePartIndex:*(a1 + 64) chatItems:v14];
      [*(a1 + 48) showInlineReplyControllerForChatItem:v15 presentKeyboard:1];
    }

    else
    {
      v14 = IMLogHandleForCategory();
      if (os_log_type_enabled(v14, OS_LOG_TYPE_ERROR))
      {
        __54__CKChatController_transcriptScrollWithConfiguration___block_invoke_cold_1();
      }
    }

LABEL_16:
  }
}

- (void)dismissInlineReplyIfNeededAndScrollToBottom
{
  inlineReplyController = [(CKChatController *)self inlineReplyController];

  if (inlineReplyController)
  {
    inlineReplyController2 = [(CKChatController *)self inlineReplyController];
    v6[0] = MEMORY[0x1E69E9820];
    v6[1] = 3221225472;
    v6[2] = __63__CKChatController_dismissInlineReplyIfNeededAndScrollToBottom__block_invoke;
    v6[3] = &unk_1E72EB9C8;
    v6[4] = self;
    [inlineReplyController2 dismissControllerWithCompletion:v6];
  }

  else
  {
    collectionViewController = [(CKCoreChatController *)self collectionViewController];
    [collectionViewController scrollTranscriptToEntryViewInsertionTimeWithAnimation:1];
  }
}

void __63__CKChatController_dismissInlineReplyIfNeededAndScrollToBottom__block_invoke(uint64_t a1)
{
  [*(a1 + 32) setInlineReplyController:0];
  v2 = [*(a1 + 32) chat];
  [v2 dismissInlineReplies];

  v3 = [*(a1 + 32) collectionViewController];
  [v3 scrollTranscriptToEntryViewInsertionTimeWithAnimation:1];
}

- (void)primeTranscriptWithInitialOffset:(CGPoint)offset inset:(UIEdgeInsets)inset
{
  right = inset.right;
  bottom = inset.bottom;
  left = inset.left;
  top = inset.top;
  y = offset.y;
  x = offset.x;
  [(CKChatController *)self setPrimeTranscriptWithInitialScrollGeometries:1];
  [(CKChatController *)self setInitialContentOffset:x, y];

  [(CKChatController *)self setInitialContentInset:top, left, bottom, right];
}

- (id)nextMediaObjectToTrimInComposition:(id)composition
{
  v32 = *MEMORY[0x1E69E9840];
  compositionCopy = composition;
  if (CKIsRunningInMacCatalyst())
  {
    if (IMOSLoggingEnabled())
    {
      v5 = OSLogHandleForIMFoundationCategory();
      if (os_log_type_enabled(v5, OS_LOG_TYPE_INFO))
      {
        *buf = 0;
        _os_log_impl(&dword_19020E000, v5, OS_LOG_TYPE_INFO, "Do not offer to trim - this is running on Mac.", buf, 2u);
      }
    }

    v6 = 0;
  }

  else
  {
    v27 = 0u;
    v28 = 0u;
    v25 = 0u;
    v26 = 0u;
    mediaObjects = [compositionCopy mediaObjects];
    v8 = [mediaObjects countByEnumeratingWithState:&v25 objects:v31 count:16];
    if (v8)
    {
      v9 = *v26;
      while (2)
      {
        for (i = 0; i != v8; ++i)
        {
          if (*v26 != v9)
          {
            objc_enumerationMutation(mediaObjects);
          }

          v11 = *(*(&v25 + 1) + 8 * i);
          if ([(CKChatController *)self _mediaObjectNeedsTrimming:v11])
          {
            v6 = v11;
            goto LABEL_17;
          }
        }

        v8 = [mediaObjects countByEnumeratingWithState:&v25 objects:v31 count:16];
        if (v8)
        {
          continue;
        }

        break;
      }
    }

    v6 = 0;
LABEL_17:

    shelfPluginPayload = [compositionCopy shelfPluginPayload];
    v13 = shelfPluginPayload;
    if (v6)
    {
      v14 = 1;
    }

    else
    {
      v14 = shelfPluginPayload == 0;
    }

    if (!v14)
    {
      v23 = 0u;
      v24 = 0u;
      v21 = 0u;
      v22 = 0u;
      fileURLKeyToGuidMapping = [(CKChatController *)self fileURLKeyToGuidMapping];
      v16 = [v13 __ck_photoCompositionMediaObjectsWithKeyToTrasferGUIDMap:fileURLKeyToGuidMapping];

      v6 = [v16 countByEnumeratingWithState:&v21 objects:v30 count:16];
      if (v6)
      {
        v17 = *v22;
        while (2)
        {
          for (j = 0; j != v6; j = j + 1)
          {
            if (*v22 != v17)
            {
              objc_enumerationMutation(v16);
            }

            v19 = *(*(&v21 + 1) + 8 * j);
            if ([(CKChatController *)self _mediaObjectNeedsTrimming:v19])
            {
              v6 = v19;
              goto LABEL_31;
            }
          }

          v6 = [v16 countByEnumeratingWithState:&v21 objects:v30 count:16];
          if (v6)
          {
            continue;
          }

          break;
        }
      }

LABEL_31:
    }
  }

  return v6;
}

- (void)_updateRecipientCapabilities
{
  [MEMORY[0x1E69E58C0] cancelPreviousPerformRequestsWithTarget:self selector:sel__fetchRecipientCapabilitiesDeferred object:0];

  [(CKChatController *)self performSelector:sel__fetchRecipientCapabilitiesDeferred withObject:0 afterDelay:0.0];
}

- (void)_fetchRecipientCapabilitiesDeferred
{
  v11[1] = *MEMORY[0x1E69E9840];
  mEMORY[0x1E69A5B50] = [MEMORY[0x1E69A5B50] sharedController];
  remoteDaemon = [mEMORY[0x1E69A5B50] remoteDaemon];
  v10 = *MEMORY[0x1E69A5060];
  v5 = [MEMORY[0x1E695DEC8] arrayWithObjects:&v10 count:1];
  v11[0] = v5;
  v6 = [MEMORY[0x1E695DEC8] arrayWithObjects:v11 count:1];
  chat = [(CKCoreChatController *)self chat];
  guid = [chat guid];
  v9[0] = MEMORY[0x1E69E9820];
  v9[1] = 3221225472;
  v9[2] = __55__CKChatController__fetchRecipientCapabilitiesDeferred__block_invoke;
  v9[3] = &unk_1E72ED570;
  v9[4] = self;
  [remoteDaemon fetchCommonCapabilities:v6 fromChatWithGUID:guid reply:v9];
}

void __55__CKChatController__fetchRecipientCapabilitiesDeferred__block_invoke(uint64_t a1, char a2, void *a3)
{
  v5 = a3;
  block[0] = MEMORY[0x1E69E9820];
  block[1] = 3221225472;
  block[2] = __55__CKChatController__fetchRecipientCapabilitiesDeferred__block_invoke_2;
  block[3] = &unk_1E72EBBC0;
  v11 = a2;
  v6 = *(a1 + 32);
  v9 = v5;
  v10 = v6;
  v7 = v5;
  dispatch_async(MEMORY[0x1E69E96A0], block);
}

void __55__CKChatController__fetchRecipientCapabilitiesDeferred__block_invoke_2(uint64_t a1)
{
  v10 = *MEMORY[0x1E69E9840];
  if (IMOSLoggingEnabled())
  {
    v2 = OSLogHandleForIMFoundationCategory();
    if (os_log_type_enabled(v2, OS_LOG_TYPE_INFO))
    {
      v3 = *(a1 + 32);
      if (*(a1 + 48))
      {
        v4 = @"YES";
      }

      else
      {
        v4 = @"NO";
      }

      v6 = 138412546;
      v7 = v4;
      v8 = 2112;
      v9 = v3;
      _os_log_impl(&dword_19020E000, v2, OS_LOG_TYPE_INFO, "Got HEIF response on capabilities: %@ %@", &v6, 0x16u);
    }
  }

  v5 = [*(a1 + 32) objectForKeyedSubscript:*MEMORY[0x1E69A5060]];
  [*(a1 + 40) setRecipientsAreHEIFCapable:{objc_msgSend(v5, "BOOLValue")}];
}

- (BOOL)_mediaObjectHasTrimMetadata:(id)metadata
{
  transcoderUserInfo = [metadata transcoderUserInfo];
  v4 = [transcoderUserInfo objectForKey:*MEMORY[0x1E69A6F90]];
  v5 = [transcoderUserInfo objectForKey:*MEMORY[0x1E69A6F68]];
  v6 = [transcoderUserInfo objectForKey:*MEMORY[0x1E69A6F60]];
  if (v4)
  {
    v7 = v5 == 0;
  }

  else
  {
    v7 = 1;
  }

  v9 = !v7 && v6 != 0;

  return v9;
}

- (BOOL)_mediaObjectNeedsTrimming:(id)trimming
{
  v34 = *MEMORY[0x1E69E9840];
  trimmingCopy = trimming;
  objc_opt_class();
  if ((objc_opt_isKindOfClass() & 1) == 0)
  {
    goto LABEL_16;
  }

  fileURL = [(__CFString *)trimmingCopy fileURL];
  v6 = IMIsAAVideoURL();

  if (v6)
  {
    if (![(CKChatController *)self recipientsAreHEIFCapable])
    {
      if (IMOSLoggingEnabled())
      {
        v7 = OSLogHandleForIMFoundationCategory();
        if (os_log_type_enabled(v7, OS_LOG_TYPE_INFO))
        {
          *buf = 0;
          _os_log_impl(&dword_19020E000, v7, OS_LOG_TYPE_INFO, "Not all recipients are HEIF capable, transcoding new media video", buf, 2u);
        }

        goto LABEL_15;
      }

LABEL_16:
      v13 = 0;
      goto LABEL_17;
    }

    if ([(CKChatController *)self _mediaObjectHasTrimMetadata:trimmingCopy])
    {
      if (IMOSLoggingEnabled())
      {
        v7 = OSLogHandleForIMFoundationCategory();
        if (os_log_type_enabled(v7, OS_LOG_TYPE_INFO))
        {
          *buf = 138412290;
          v29 = trimmingCopy;
          _os_log_impl(&dword_19020E000, v7, OS_LOG_TYPE_INFO, "Skipping already trimmed object, %@", buf, 0xCu);
        }

LABEL_15:

        goto LABEL_16;
      }

      goto LABEL_16;
    }

    defaultManager = [MEMORY[0x1E696AC08] defaultManager];
    fileURL2 = [(__CFString *)trimmingCopy fileURL];
    path = [fileURL2 path];
    v27 = 0;
    v18 = [defaultManager attributesOfItemAtPath:path error:&v27];
    v19 = v27;

    if (v19)
    {
      if (IMOSLoggingEnabled())
      {
        v20 = OSLogHandleForIMFoundationCategory();
        if (os_log_type_enabled(v20, OS_LOG_TYPE_INFO))
        {
          fileURL3 = [(__CFString *)trimmingCopy fileURL];
          *buf = 138412546;
          v29 = fileURL3;
          v30 = 2112;
          v31 = v19;
          _os_log_impl(&dword_19020E000, v20, OS_LOG_TYPE_INFO, "Failed to find new media at %@ to check size, error %@", buf, 0x16u);
        }
      }

      v13 = 0;
    }

    else
    {
      fileSize = [v18 fileSize];
      _maxAllowedSVSize = [(CKChatController *)self _maxAllowedSVSize];
      v13 = fileSize > _maxAllowedSVSize;
      if (IMOSLoggingEnabled())
      {
        v24 = OSLogHandleForIMFoundationCategory();
        if (os_log_type_enabled(v24, OS_LOG_TYPE_INFO))
        {
          _maxAllowedSVSize2 = [(CKChatController *)self _maxAllowedSVSize];
          v26 = @"NO";
          *buf = 138412802;
          if (fileSize > _maxAllowedSVSize)
          {
            v26 = @"YES";
          }

          v29 = v26;
          v30 = 2048;
          v31 = fileSize;
          v32 = 2048;
          v33 = _maxAllowedSVSize2;
          _os_log_impl(&dword_19020E000, v24, OS_LOG_TYPE_INFO, "Outgoing new media needs trim? %@ size: %lu limit %lu", buf, 0x20u);
        }
      }
    }
  }

  else
  {
    if (CKIsRunningInMacCatalyst())
    {
      goto LABEL_16;
    }

    [(__CFString *)trimmingCopy duration];
    v9 = v8;
    conversation = [(CKCoreChatController *)self conversation];
    [conversation maxTrimDurationForMedia:trimmingCopy];
    v12 = v11;

    if (v9 <= v12)
    {
      goto LABEL_16;
    }

    v13 = 1;
  }

LABEL_17:

  return v13;
}

- (void)startTrimmingMediaObjectsInComposition:(id)composition
{
  compositionCopy = composition;
  v4 = [(CKChatController *)self nextMediaObjectToTrimInComposition:?];
  if (v4)
  {
    [(CKChatController *)self setCompositionBeingTrimmed:compositionCopy];
    [(CKChatController *)self presentTrimControllerForMediaObject:v4];
  }

  else
  {
    [(CKChatController *)self setCompositionBeingTrimmed:0];
  }
}

- (void)presentTrimControllerForMediaObject:(id)object
{
  v24 = *MEMORY[0x1E69E9840];
  objectCopy = object;
  mediaType = [objectCopy mediaType];
  conversation = [(CKCoreChatController *)self conversation];
  [conversation maxTrimDurationForMedia:objectCopy];
  v8 = v7;

  if (mediaType != 1)
  {
    if (mediaType == 2)
    {
      v16 = MEMORY[0x1E69E9820];
      v17 = 3221225472;
      v18 = __56__CKChatController_presentTrimControllerForMediaObject___block_invoke;
      v19 = &unk_1E72ED6B0;
      selfCopy = self;
      v9 = objectCopy;
      v21 = v9;
      v10 = _Block_copy(&v16);
      fileURL = [v9 fileURL];
      v12 = IMIsAAVideoURL();

      if (v12)
      {
        fileURL2 = [v9 fileURL];
        v14 = CKAVURLAssetForURLWithWriteAccess(fileURL2);

        [(CKChatController *)self _maxAllowedSVSize];
        IMEstimateDurationForSize();
      }

      else
      {
        v10[2](v10, v8 * 0.95);
      }
    }

    else if (IMOSLoggingEnabled())
    {
      v15 = OSLogHandleForIMFoundationCategory();
      if (os_log_type_enabled(v15, OS_LOG_TYPE_INFO))
      {
        *buf = 138412290;
        v23 = objectCopy;
        _os_log_impl(&dword_19020E000, v15, OS_LOG_TYPE_INFO, "I don't know how to trim this media object [%@]", buf, 0xCu);
      }
    }
  }
}

void __56__CKChatController_presentTrimControllerForMediaObject___block_invoke(uint64_t a1, double a2)
{
  block[0] = MEMORY[0x1E69E9820];
  block[1] = 3221225472;
  block[2] = __56__CKChatController_presentTrimControllerForMediaObject___block_invoke_2;
  block[3] = &unk_1E72EBC38;
  v3 = *(a1 + 40);
  block[4] = *(a1 + 32);
  v5 = v3;
  v6 = a2;
  dispatch_async(MEMORY[0x1E69E96A0], block);
}

void __56__CKChatController_presentTrimControllerForMediaObject___block_invoke_2(uint64_t a1)
{
  v2 = *(a1 + 32);
  if (!*(v2 + 1904))
  {
    v3 = [[CKVideoTrimController alloc] initWithMediaObject:*(a1 + 40) maxTrimDuration:*(a1 + 48)];
    v4 = *(a1 + 32);
    v5 = *(v4 + 1904);
    *(v4 + 1904) = v3;

    [*(*(a1 + 32) + 1904) setDelegate:?];
    v2 = *(a1 + 32);
  }

  aBlock[0] = MEMORY[0x1E69E9820];
  aBlock[1] = 3221225472;
  aBlock[2] = __56__CKChatController_presentTrimControllerForMediaObject___block_invoke_3;
  aBlock[3] = &unk_1E72EC410;
  aBlock[4] = v2;
  v6 = _Block_copy(aBlock);
  v7 = [*(a1 + 32) view];
  v8 = [v7 window];
  v9 = [v8 windowScene];
  if (([v9 interfaceOrientation] - 3) >= 2)
  {
    v10 = 3;
  }

  else
  {
    v10 = 4;
  }

  v11 = [*(*(a1 + 32) + 1904) editVideoVC];
  v12 = [v11 popoverPresentationController];
  [v12 setPermittedArrowDirections:v10];

  v13 = +[CKAdaptivePresentationController sharedInstance];
  v14 = [*(*(a1 + 32) + 1904) editVideoVC];
  [v13 presentViewController:v14 fromViewController:*(a1 + 32) presentationHandler:v6 dismissalHandler:0 animated:1 completion:0];
}

void __56__CKChatController_presentTrimControllerForMediaObject___block_invoke_3(uint64_t a1, void *a2, void *a3)
{
  v10 = [*(a1 + 32) entryView];
  [v10 frame];
  *a2 = v5;
  a2[1] = v6;
  a2[2] = v7;
  a2[3] = v8;
  v9 = v10;
  *a3 = v10;
}

- (void)trimControllerDidCancel:(id)cancel
{
  cancelCopy = cancel;
  [(CKChatController *)self setCompositionBeingTrimmed:0];
  p_audioTrimController = &self->_audioTrimController;
  audioTrimController = self->_audioTrimController;
  if (audioTrimController == cancelCopy || (p_audioTrimController = &self->_videoTrimController, audioTrimController = self->_videoTrimController, audioTrimController == cancelCopy))
  {
    *p_audioTrimController = 0;
  }

  v7 = +[CKAdaptivePresentationController sharedInstance];
  v8[0] = MEMORY[0x1E69E9820];
  v8[1] = 3221225472;
  v8[2] = __44__CKChatController_trimControllerDidCancel___block_invoke;
  v8[3] = &unk_1E72EBA18;
  v8[4] = self;
  [v7 dismissViewControllerAnimated:1 completion:v8];
}

uint64_t __44__CKChatController_trimControllerDidCancel___block_invoke(uint64_t a1)
{
  [*(a1 + 32) reloadInputViews];
  v2 = *(a1 + 32);

  return [v2 becomeFirstResponder];
}

- (void)trimController:(id)controller didFinishTrimmingMediaObject:(id)object withReplacementMediaObject:(id)mediaObject
{
  v25 = *MEMORY[0x1E69E9840];
  controllerCopy = controller;
  objectCopy = object;
  mediaObjectCopy = mediaObject;
  p_audioTrimController = &self->_audioTrimController;
  audioTrimController = self->_audioTrimController;
  if (audioTrimController == controllerCopy || (p_audioTrimController = &self->_videoTrimController, audioTrimController = self->_videoTrimController, audioTrimController == controllerCopy))
  {
    *p_audioTrimController = 0;
  }

  if (objectCopy && mediaObjectCopy)
  {
    compositionBeingTrimmed = [(CKChatController *)self compositionBeingTrimmed];
    v14 = [compositionBeingTrimmed compositionByReplacingMediaObject:objectCopy withMediaObject:mediaObjectCopy];

    composition = [(CKChatController *)self composition];
    compositionBeingTrimmed2 = [(CKChatController *)self compositionBeingTrimmed];
    v17 = [composition isEqual:compositionBeingTrimmed2];

    if (v17)
    {
      [(CKChatController *)self setComposition:v14];
    }

    [(CKChatController *)self setCompositionBeingTrimmed:v14];
  }

  else if (IMOSLoggingEnabled())
  {
    v18 = OSLogHandleForIMFoundationCategory();
    if (os_log_type_enabled(v18, OS_LOG_TYPE_INFO))
    {
      *buf = 138412546;
      v22 = objectCopy;
      v23 = 2112;
      v24 = mediaObjectCopy;
      _os_log_impl(&dword_19020E000, v18, OS_LOG_TYPE_INFO, "Not replacing [%@] with [%@]", buf, 0x16u);
    }
  }

  v19 = +[CKAdaptivePresentationController sharedInstance];
  v20[0] = MEMORY[0x1E69E9820];
  v20[1] = 3221225472;
  v20[2] = __91__CKChatController_trimController_didFinishTrimmingMediaObject_withReplacementMediaObject___block_invoke;
  v20[3] = &unk_1E72EBA18;
  v20[4] = self;
  [v19 dismissViewControllerAnimated:1 completion:v20];
}

void __91__CKChatController_trimController_didFinishTrimmingMediaObject_withReplacementMediaObject___block_invoke(uint64_t a1)
{
  v2 = *(a1 + 32);
  v3 = [v2 compositionBeingTrimmed];
  v4 = [v2 nextMediaObjectToTrimInComposition:v3];

  if (v4)
  {
    [*(a1 + 32) presentTrimControllerForMediaObject:v4];
  }

  else
  {
    aBlock[0] = MEMORY[0x1E69E9820];
    aBlock[1] = 3221225472;
    aBlock[2] = __91__CKChatController_trimController_didFinishTrimmingMediaObject_withReplacementMediaObject___block_invoke_2;
    aBlock[3] = &unk_1E72ED6D8;
    aBlock[4] = *(a1 + 32);
    v5 = _Block_copy(aBlock);
    v6 = [*(a1 + 32) compositionBeingTrimmed];
    v7 = [*(a1 + 32) composition];
    if (v6 == v7)
    {
      v8 = [*(a1 + 32) entryView];
      v9[0] = MEMORY[0x1E69E9820];
      v9[1] = 3221225472;
      v9[2] = __91__CKChatController_trimController_didFinishTrimmingMediaObject_withReplacementMediaObject___block_invoke_3;
      v9[3] = &unk_1E72ED700;
      v10 = v5;
      [v8 compositionWithAcceptedAutocorrection:v9];
    }

    else
    {
      (*(v5 + 2))(v5, v6);
    }
  }
}

uint64_t __91__CKChatController_trimController_didFinishTrimmingMediaObject_withReplacementMediaObject___block_invoke_2(uint64_t a1, uint64_t a2)
{
  [*(a1 + 32) sendComposition:a2];
  [*(a1 + 32) setCompositionBeingTrimmed:0];
  [*(a1 + 32) reloadInputViews];
  v3 = *(a1 + 32);

  return [v3 becomeFirstResponder];
}

- (double)balloonMaxWidth
{
  [(CKCoreChatController *)self calculateTranscriptSafeAreaInsets];
  v4 = v3;
  v6 = v5;
  v8 = v7;
  v10 = v9;
  [(CKCoreChatController *)self calculateTranscriptMarginInsets];
  v12 = v11;
  v14 = v13;
  v16 = v15;
  v18 = v17;
  view = [(CKChatController *)self view];
  [view bounds];
  v29 = v20;

  chat = [(CKCoreChatController *)self chat];
  if ([chat isStewieChat])
  {
    __ck_isiMessageLite = 1;
  }

  else
  {
    conversation = [(CKCoreChatController *)self conversation];
    sendingService = [conversation sendingService];
    __ck_isiMessageLite = [sendingService __ck_isiMessageLite];
  }

  v25 = +[CKUIBehavior sharedBehaviors];
  [v25 balloonMaxWidthForTranscriptWidth:-[CKChatController pluginButtonsEnabled](self marginInsets:"pluginButtonsEnabled") shouldShowPluginButtons:CKShowCharacterCountEnabled(__ck_isiMessageLite) != 0 shouldShowCharacterCount:0 shouldCoverSendButton:__ck_isiMessageLite isStewieMode:{v29, v4 + v12, v6 + v14, v8 + v16, v10 + v18}];
  v27 = v26;

  return v27;
}

- (void)_setConversationDeferredSetup
{
  v39 = *MEMORY[0x1E69E9840];
  v36.receiver = self;
  v36.super_class = CKChatController;
  [(CKCoreChatController *)&v36 _setConversationDeferredSetup];
  if (IMOSLoggingEnabled())
  {
    v3 = OSLogHandleForIMFoundationCategory();
    if (os_log_type_enabled(v3, OS_LOG_TYPE_INFO))
    {
      *buf = 136315138;
      v38 = "[CKChatController _setConversationDeferredSetup]";
      _os_log_impl(&dword_19020E000, v3, OS_LOG_TYPE_INFO, "reloadEntryViewIfNeeded called from %s", buf, 0xCu);
    }
  }

  [(CKChatController *)self reloadEntryViewIfNeeded];
  [(CKChatController *)self cleanUpDarkEffectStyle];
  [(CKChatController *)self reloadFooterViewControllerIfNecessary];
  if (CKIsRunningInMacCatalyst())
  {
    if ([(CKChatController *)self shouldUseMacRecipientsView])
    {
      macRecipientsController = self->_macRecipientsController;
      if (macRecipientsController)
      {
        conversation = [(CKCoreChatController *)self conversation];
        [(CKMacRecipientsController *)macRecipientsController setConversation:conversation];

        view = [(CKMacRecipientsController *)self->_macRecipientsController view];
        view2 = [(CKChatController *)self view];
        [view2 bounds];
        [view setFrame:?];
      }
    }

    v8 = +[CKUIBehavior sharedBehaviors];
    useMacToolbar = [v8 useMacToolbar];

    if (useMacToolbar)
    {
      macToolbarController = [(CKCoreChatController *)self macToolbarController];
      [macToolbarController updateVirtualViewForProvider:self];
    }
  }

  collectionViewController = [(CKCoreChatController *)self collectionViewController];
  collectionView = [collectionViewController collectionView];

  if ([(CKChatController *)self primeTranscriptWithInitialScrollGeometries])
  {
    [collectionView layoutIfNeeded];
    [(CKChatController *)self setPrimeTranscriptWithInitialScrollGeometries:0];
    collectionViewController2 = [(CKCoreChatController *)self collectionViewController];
    [collectionViewController2 sizeFullTranscriptIfNecessary];

    [collectionView beginDisablingTranscriptDynamicsForReason:13];
    [(CKChatController *)self initialContentOffset];
    [collectionView setContentOffset:?];
    [(CKChatController *)self initialContentInset];
    [collectionView setContentInset:?];
    [collectionView endDisablingTranscriptDynamicsForReason:13];
  }

  tapGestureRecognizer = [(CKChatController *)self tapGestureRecognizer];
  if (!tapGestureRecognizer || (-[CKChatController tapGestureRecognizer](self, "tapGestureRecognizer"), v15 = objc_claimAutoreleasedReturnValue(), [v15 view], v16 = objc_claimAutoreleasedReturnValue(), v17 = v16 == collectionView, v16, v15, tapGestureRecognizer, !v17))
  {
    tapGestureRecognizer2 = [(CKChatController *)self tapGestureRecognizer];

    if (tapGestureRecognizer2)
    {
      tapGestureRecognizer3 = [(CKChatController *)self tapGestureRecognizer];
      view3 = [tapGestureRecognizer3 view];
      tapGestureRecognizer4 = [(CKChatController *)self tapGestureRecognizer];
      [view3 removeGestureRecognizer:tapGestureRecognizer4];
    }

    v22 = [objc_alloc(MEMORY[0x1E69DD060]) initWithTarget:self action:sel_tapGestureRecognized_];
    [v22 setDelegate:self];
    [collectionView addGestureRecognizer:v22];
    [(CKChatController *)self setTapGestureRecognizer:v22];
  }

  if (+[CKRaiseGesture isRaiseGestureSupported])
  {
    raiseGesture = [(CKChatController *)self raiseGesture];
    v24 = raiseGesture == 0;

    if (v24)
    {
      v25 = [[CKRaiseGesture alloc] initWithTarget:self action:sel_raiseGestureRecognized_];
      [(CKChatController *)self setRaiseGesture:v25];
    }

    [(CKChatController *)self updateRaiseGesture];
  }

  view4 = [(CKChatController *)self view];
  window = [view4 window];
  isKeyWindow = [window isKeyWindow];

  if ((isKeyWindow & 1) == 0)
  {
    if (IMOSLoggingEnabled())
    {
      v29 = OSLogHandleForIMFoundationCategory();
      if (os_log_type_enabled(v29, OS_LOG_TYPE_INFO))
      {
        keyWindow = [MEMORY[0x1E69DD2E8] keyWindow];
        *buf = 138412290;
        v38 = keyWindow;
        _os_log_impl(&dword_19020E000, v29, OS_LOG_TYPE_INFO, "CKChatController's window is not key, making it key again. Current key is %@", buf, 0xCu);
      }
    }

    view5 = [(CKChatController *)self view];
    window2 = [view5 window];
    [window2 makeKeyWindow];
  }

  nicknameBanner = [(CKChatController *)self nicknameBanner];

  if (nicknameBanner)
  {
    view6 = [(CKChatController *)self view];
    nicknameBanner2 = [(CKChatController *)self nicknameBanner];
    [view6 bringSubviewToFront:nicknameBanner2];
  }

  [(CKChatController *)self _configureCallStateResolverForCurrentConversation];
  [(CKChatController *)self updateSendMenuShouldElevateCheckIn];
  [(CKCoreChatController *)self setPreviewingChatForScreenTime:0];
}

- (void)_invalidateChatItemLayoutIfNecessary:(CGSize)necessary
{
  v4 = [CKApplicationState isResizing:necessary.width];
  collectionViewController = [(CKCoreChatController *)self collectionViewController];
  if (collectionViewController)
  {
    if (!v4)
    {
      [(CKCoreChatController *)self calculateTranscriptMarginInsets];
      v7 = v6;
      v9 = v8;
      v11 = v10;
      v13 = v12;
      [collectionViewController marginInsets];
      v15 = v14;
      v17 = v16;
      v32 = v18;
      v20 = v19;
      [(CKChatController *)self balloonMaxWidth];
      v22 = v21;
      [collectionViewController balloonMaxWidth];
      if (v9 != v17 || v7 != v15 || v13 != v20 || v11 != v32 || vabdd_f64(v22, v23) > 0.001)
      {
        collectionView = [collectionViewController collectionView];
        [collectionView beginDisablingTranscriptDynamicsForReason:9];
        traitCollection = [(CKChatController *)self traitCollection];
        [collectionViewController transcriptBackgroundLuminance];
        [collectionViewController invalidateChatItemLayoutWithNewBalloonMaxWidth:traitCollection marginInsets:v22 traitCollection:v7 transcriptBackgroundLuminance:{v9, v11, v13, v26}];

        v27 = +[CKScrollViewAnimationProperties systemDefaultScrollAnimation];
        [collectionViewController enforceTranscriptScrollIntentWithAnimationProperties:v27];
        propertyAnimator = [v27 propertyAnimator];
        [propertyAnimator duration];
        v30 = dispatch_time(0, (v29 * 1000000000.0));
        block[0] = MEMORY[0x1E69E9820];
        block[1] = 3221225472;
        block[2] = __57__CKChatController__invalidateChatItemLayoutIfNecessary___block_invoke;
        block[3] = &unk_1E72EBA18;
        v34 = collectionView;
        v31 = collectionView;
        dispatch_after(v30, MEMORY[0x1E69E96A0], block);
      }
    }
  }
}

- (CGRect)effectiveVisibleRectOfCollectionViewForTranscriptCollectionViewController:(id)controller
{
  collectionView = [(CKChatController *)self collectionView];
  [collectionView bounds];
  v6 = v5;
  v8 = v7;
  v10 = v9;
  v12 = v11;
  [collectionView adjustedContentInset];
  v14 = v13;
  v16 = v15;
  v18 = v17;
  v20 = v19;
  [(CKChatController *)self _currentlyVisibleBannerHeight];
  v22 = v14 + v21;
  v23 = v8 + v22;
  v24 = v12 - (v18 + v22);

  v25 = v6 + v16;
  v26 = v23;
  v27 = v10 - (v16 + v20);
  v28 = v24;
  result.size.height = v28;
  result.size.width = v27;
  result.origin.y = v26;
  result.origin.x = v25;
  return result;
}

- (id)firstUnreadMessageItemGUIDForTranscriptCollectionViewController:(id)controller
{
  firstUnreadMessageGUIDForTextEffects = [(CKChatController *)self firstUnreadMessageGUIDForTextEffects];

  if (firstUnreadMessageGUIDForTextEffects)
  {
    firstUnreadMessageGUIDForTextEffects2 = [(CKChatController *)self firstUnreadMessageGUIDForTextEffects];
  }

  else
  {
    chat = [(CKCoreChatController *)self chat];
    firstUnreadMessageItem = [chat firstUnreadMessageItem];

    guid = [firstUnreadMessageItem guid];
    [(CKChatController *)self setFirstUnreadMessageGUIDForTextEffects:guid];

    firstUnreadMessageGUIDForTextEffects2 = [(CKChatController *)self firstUnreadMessageGUIDForTextEffects];
  }

  return firstUnreadMessageGUIDForTextEffects2;
}

- (void)transcriptCollectionViewControllerNeedsChatItemLayoutInvalidation:(id)invalidation
{
  invalidationCopy = invalidation;
  [(CKChatController *)self balloonMaxWidth];
  v6 = v5;
  collectionViewController = [(CKCoreChatController *)self collectionViewController];
  [collectionViewController marginInsets];
  v8 = v7;
  v10 = v9;
  v12 = v11;
  v14 = v13;
  traitCollection = [(CKChatController *)self traitCollection];
  collectionViewController2 = [(CKCoreChatController *)self collectionViewController];
  [collectionViewController2 transcriptBackgroundLuminance];
  [invalidationCopy invalidateChatItemLayoutWithNewBalloonMaxWidth:traitCollection marginInsets:v6 traitCollection:v8 transcriptBackgroundLuminance:{v10, v12, v14, v17}];
}

- (void)transcriptCollectionViewController:(id)controller didInsertChatItems:(id)items associatedChatItems:(id)chatItems
{
  itemsCopy = items;
  chatItemsCopy = chatItems;
  v12.receiver = self;
  v12.super_class = CKChatController;
  [(CKCoreChatController *)&v12 transcriptCollectionViewController:controller didInsertChatItems:itemsCopy associatedChatItems:chatItemsCopy];
  insertItemsCallback = [(CKChatController *)self insertItemsCallback];

  if (insertItemsCallback)
  {
    insertItemsCallback2 = [(CKChatController *)self insertItemsCallback];
    (insertItemsCallback2)[2](insertItemsCallback2, itemsCopy, chatItemsCopy);

    [(CKChatController *)self setInsertItemsCallback:0];
  }
}

- (void)transcriptCollectionViewController:(id)controller didTapAttributionButtonForChatItem:(id)item parentIndexPath:(id)path sender:(id)sender
{
  controllerCopy = controller;
  pathCopy = path;
  senderCopy = sender;
  iMChatItem = [item IMChatItem];
  objc_opt_class();
  if (objc_opt_isKindOfClass())
  {
    v13 = iMChatItem;
    if ([v13 attributionType] == 6 && !CKIsRunningInMacCatalyst())
    {
      [(CKChatController *)self _presentSentWithSiriUI];
    }

    else if ([v13 isCommSafetySensitiveAttribution])
    {
      [controllerCopy didTapCommSafetyAttributionItemWithIndexPath:pathCopy sender:senderCopy];
    }

    else
    {
      attributionInfo = [v13 attributionInfo];
      v15 = [attributionInfo objectForKey:*MEMORY[0x1E69A6FA0]];
      if (v15)
      {
        -[CKChatController _presentBrowserOrAppStoreForAdamID:url:identifier:isForSticker:](self, "_presentBrowserOrAppStoreForAdamID:url:identifier:isForSticker:", v15, 0, 0, [v13 attributionType] == 3);
      }
    }
  }
}

- (void)transcriptCollectionViewController:(id)controller didTapAttributionLinkTextForChatItem:(id)item atIndexPath:(id)path sender:(id)sender
{
  controllerCopy = controller;
  pathCopy = path;
  senderCopy = sender;
  if ([item actionType] == 5)
  {
    [controllerCopy didTapCommSafetyAttributionItemWithIndexPath:pathCopy sender:senderCopy];
  }
}

- (int64_t)transcriptCollectionViewControllerWantsCurrentDesiredIntent:(id)intent
{
  entryView = [(CKChatController *)self entryView];
  sendLaterPluginInfo = [entryView sendLaterPluginInfo];

  if (sendLaterPluginInfo)
  {
    return 6;
  }

  else
  {
    return 0;
  }
}

- (void)transcriptCollectionViewController:(id)controller didTapPluginStatusButtonForChatItem:(id)item
{
  iMChatItem = [item IMChatItem];
  objc_opt_class();
  if (objc_opt_isKindOfClass())
  {
    dataSource = [iMChatItem dataSource];
    [dataSource didTapStatusItem];
  }
}

- (void)transcriptCollectionViewController:(id)controller didTapReplyCountStatusButtonForChatItem:(id)item
{
  itemCopy = item;
  chatItems = [controller chatItems];
  v9 = [(CKCoreChatController *)self _threadChatItemForReplyCountChatItem:itemCopy chatItems:chatItems];

  v8 = v9;
  if (v9)
  {
    [(CKChatController *)self showInlineReplyControllerForChatItem:v9 presentKeyboard:0];
    v8 = v9;
  }
}

- (void)transcriptCollectionViewController:(id)controller balloonView:(id)view tappedForChatItem:(id)item
{
  controllerCopy = controller;
  viewCopy = view;
  itemCopy = item;
  if ([(CKChatController *)self isFullScreenBalloonViewOnScreen])
  {
    goto LABEL_40;
  }

  if (CKIsRunningInMacCatalyst())
  {
    objc_opt_class();
    if (objc_opt_isKindOfClass())
    {
      objc_opt_class();
      if (objc_opt_isKindOfClass())
      {
        stackView = [viewCopy stackView];
        currentAssetReference = [(CKTranscriptPluginPresentationConfiguration *)stackView currentAssetReference];
        [(CKChatController *)self _presentViewerForChatItem:itemCopy assetReference:currentAssetReference];
LABEL_18:

LABEL_19:
        goto LABEL_40;
      }
    }
  }

  if ([itemCopy itemIsReplyContextPreview] && (-[CKChatController isEditing](self, "isEditing") & 1) == 0)
  {
LABEL_39:
    [(CKChatController *)self showInlineReplyControllerForChatItem:itemCopy presentKeyboard:0];
    goto LABEL_40;
  }

  objc_opt_class();
  if (objc_opt_isKindOfClass())
  {
    stackView = [itemCopy mediaObject];
    currentAssetReference = [(CKTranscriptPluginPresentationConfiguration *)stackView transfer];
    if ([currentAssetReference isDownloadable])
    {
      [(CKCoreChatController *)self setMediaObjectToDownload:stackView];
      conversation = [(CKCoreChatController *)self conversation];
      guid = [currentAssetReference guid];
      [conversation acceptTransferAndUpdateReasonForTapped:guid];
    }

    else
    {
      if (![(CKTranscriptPluginPresentationConfiguration *)stackView shouldShowViewer])
      {
        goto LABEL_18;
      }

      if ([currentAssetReference isRestoring])
      {
        fileURL = [(CKTranscriptPluginPresentationConfiguration *)stackView fileURL];
        path = [fileURL path];

        v17 = +[CKSyncController sharedInstance];
        [v17 prioritizeAttachmentAtPath:path];
      }

      [(CKChatController *)self showViewerForMediaObject:stackView];
      conversation = [MEMORY[0x1E69A8168] sharedInstance];
      [conversation trackEvent:*MEMORY[0x1E69A7588]];
    }

    goto LABEL_18;
  }

  objc_opt_class();
  if (objc_opt_isKindOfClass() & 1) != 0 || (objc_opt_class(), (objc_opt_isKindOfClass()) && [itemCopy isCorrupt])
  {
    [(CKChatController *)self _showReaderForAggregateChatItem:itemCopy balloonView:viewCopy];
    goto LABEL_40;
  }

  objc_opt_class();
  if (objc_opt_isKindOfClass())
  {
    if (!CKIsRunningInMacCatalyst())
    {
      [(CKChatController *)self _handleTranscriptPluginChatItem:itemCopy];
      goto LABEL_40;
    }

    if ([itemCopy balloonOrientation] == 1)
    {
      v18 = 8;
    }

    else
    {
      v18 = 4;
    }

    stackView = [[CKTranscriptPluginPresentationConfiguration alloc] initWithSourceView:viewCopy permittedArrowDirections:v18 shouldDisableSnapshotView:1];
    [(CKChatController *)self _handleTranscriptPluginChatItem:itemCopy presentationConfiguration:stackView];
    goto LABEL_19;
  }

  objc_opt_class();
  if ((objc_opt_isKindOfClass() & 1) == 0)
  {
    if (![itemCopy itemIsReply] || (objc_msgSend(itemCopy, "wantsOverlayLayout") & 1) != 0 || (-[CKChatController isEditing](self, "isEditing")) && (!objc_msgSend(itemCopy, "itemIsThreadOriginator") || (objc_msgSend(itemCopy, "wantsOverlayLayout") & 1) != 0 || CKIsRunningInMacCatalyst() || (-[CKChatController isEditing](self, "isEditing")))
    {
      v19.receiver = self;
      v19.super_class = CKChatController;
      [(CKCoreChatController *)&v19 transcriptCollectionViewController:controllerCopy balloonView:viewCopy tappedForChatItem:itemCopy];
      goto LABEL_40;
    }

    goto LABEL_39;
  }

  if ([itemCopy offerState] != 2)
  {
    [(CKChatController *)self presentDetailsViewController];
  }

LABEL_40:
}

- (void)transcriptCollectionViewController:(id)controller saveLastTappedChatItemWithDataDetector:(id)detector
{
  detectorCopy = detector;
  inputController = [(CKCoreChatController *)self inputController];

  if (inputController)
  {
    inputController2 = [(CKCoreChatController *)self inputController];
    [inputController2 setLastTappedChatItemWithDataDetector:detectorCopy];
  }
}

- (void)transcriptCollectionViewController:(id)controller balloonView:(id)view doubleTappedItemAtIndexPath:(id)path
{
  controllerCopy = controller;
  viewCopy = view;
  pathCopy = path;
  inlineReplyController = [(CKChatController *)self inlineReplyController];

  if (!inlineReplyController)
  {
    v12.receiver = self;
    v12.super_class = CKChatController;
    [(CKCoreChatController *)&v12 transcriptCollectionViewController:controllerCopy balloonView:viewCopy doubleTappedItemAtIndexPath:pathCopy];
  }
}

- (void)transcriptCollectionViewController:(id)controller balloonView:(id)view didRequestReaderViewControllerForChatItem:(id)item
{
  viewCopy = view;
  itemCopy = item;
  objc_opt_class();
  if (objc_opt_isKindOfClass())
  {
    v9 = [CKReaderViewController readerViewControllerForAudioChatItem:itemCopy];
    [v9 setDelegate:self];
    if (CKIsRunningInMacCatalyst())
    {
      [v9 setModalPresentationStyle:7];
      popoverPresentationController = [v9 popoverPresentationController];
      [popoverPresentationController setSourceView:viewCopy];

      [(CKChatController *)self presentViewController:v9 animated:1 completion:0];
    }

    else
    {
      [(CKChatController *)self showViewController:v9 sender:self];
    }
  }

  else
  {
    v11 = IMLogHandleForCategory();
    if (os_log_type_enabled(v11, OS_LOG_TYPE_ERROR))
    {
      [CKChatController transcriptCollectionViewController:balloonView:didRequestReaderViewControllerForChatItem:];
    }
  }
}

- (void)viewDidLayoutSubviewsForTranscriptCollectionViewController:(id)controller
{
  v4.receiver = self;
  v4.super_class = CKChatController;
  [(CKCoreChatController *)&v4 viewDidLayoutSubviewsForTranscriptCollectionViewController:controller];
  [(CKChatController *)self _updateCatchUpButtonVisibilityResumingFromBackground:0];
}

- (id)transcriptCollectionViewController:(id)controller addToContactsMenuForSenderChatItem:(id)item
{
  v25 = *MEMORY[0x1E69E9840];
  itemCopy = item;
  if (CKIsRunningInMacCatalyst())
  {
    v6 = 0;
  }

  else
  {
    iMChatItem = [itemCopy IMChatItem];
    handle = [iMChatItem handle];

    if (handle)
    {
      v9 = objc_alloc_init(CKNicknameUpdate);
      [(CKNicknameUpdate *)v9 setHandle:handle];
      nicknameObject = [handle nicknameObject];
      if (nicknameObject)
      {
        [(CKNicknameUpdate *)v9 setNickname:nicknameObject];
      }

      v11 = [CKNicknameUtility addContactOptionsMenuItemsWithTarget:self update:v9];
      array = [MEMORY[0x1E695DF70] array];
      v20 = 0u;
      v21 = 0u;
      v22 = 0u;
      v23 = 0u;
      v13 = v11;
      v14 = [v13 countByEnumeratingWithState:&v20 objects:v24 count:16];
      if (v14)
      {
        v15 = v14;
        v16 = *v21;
        do
        {
          for (i = 0; i != v15; ++i)
          {
            if (*v21 != v16)
            {
              objc_enumerationMutation(v13);
            }

            uiAction = [*(*(&v20 + 1) + 8 * i) uiAction];
            if (uiAction)
            {
              [array addObject:uiAction];
            }
          }

          v15 = [v13 countByEnumeratingWithState:&v20 objects:v24 count:16];
        }

        while (v15);
      }

      v6 = [MEMORY[0x1E69DCC60] menuWithTitle:&stru_1F04268F8 children:array];
    }

    else
    {
      v6 = 0;
    }
  }

  return v6;
}

- (void)transcriptCollectionViewController:(id)controller unknownSenderButtonTapped:(id)tapped forChatItem:(id)item
{
  tappedCopy = tapped;
  itemCopy = item;
  if (CKIsRunningInMacCatalyst())
  {
    iMChatItem = [itemCopy IMChatItem];
    handle = [iMChatItem handle];

    if (handle)
    {
      v10 = objc_alloc_init(CKNicknameUpdate);
      [(CKNicknameUpdate *)v10 setHandle:handle];
      nicknameObject = [handle nicknameObject];
      if (nicknameObject)
      {
        [(CKNicknameUpdate *)v10 setNickname:nicknameObject];
      }

      zoomTransitionSourceView = [tappedCopy zoomTransitionSourceView];
      [(CKChatController *)self showUnknownContactPopoverForNicknameUpdate:v10 presentingViewController:self sourceView:zoomTransitionSourceView];
    }
  }
}

- (void)transcriptCollectionViewController:(id)controller backgroundScrollVelocityThresholdChanged:(BOOL)changed
{
  changedCopy = changed;
  transcriptBackground = [(CKCoreChatController *)self transcriptBackground];
  [transcriptBackground backgroundIsScrolling:changedCopy];
}

- (void)_handleTranscriptPluginChatItem:(id)item presentationConfiguration:(id)configuration
{
  itemCopy = item;
  configurationCopy = configuration;
  v17 = itemCopy;
  iMChatItem = [v17 IMChatItem];
  dataSource = [iMChatItem dataSource];

  if (([dataSource wantsInteractiveContentView] & 1) == 0)
  {
    if ([dataSource wantsReplyFromContentView] && objc_msgSend(dataSource, "allowedByScreenTime"))
    {
      inputController = [(CKCoreChatController *)self inputController];
      [inputController presentViewControllerWithPluginChatItem:v17 presentationStyle:1 presentationConfiguration:configurationCopy];
    }

    else
    {
      collectionViewController = [(CKCoreChatController *)self collectionViewController];
      transcriptIdentifier = [collectionViewController transcriptIdentifier];
      inputController = [v17 balloonControllerForContext:transcriptIdentifier];

      if ((objc_opt_respondsToSelector() & 1) == 0 || ([inputController handlePresentationAction] & 1) == 0)
      {
        collectionViewController2 = [(CKCoreChatController *)self collectionViewController];
        transcriptIdentifier2 = [collectionViewController2 transcriptIdentifier];
        v15 = [v17 contentViewControllerForContext:transcriptIdentifier2];

        if (v15)
        {
          navigationController = [(CKChatController *)self navigationController];
          [navigationController pushViewController:v15 animated:1];
        }
      }
    }
  }
}

- (void)transcriptCollectionViewController:(id)controller balloonView:(id)view selectedItemAtIndexPath:(id)path
{
  v6.receiver = self;
  v6.super_class = CKChatController;
  [(CKCoreChatController *)&v6 transcriptCollectionViewController:controller balloonView:view selectedItemAtIndexPath:path];
  [(CKChatController *)self setTargetFirstResponder:0];
  [(CKChatController *)self becomeFirstResponder];
}

- (BOOL)transcriptCollectionViewController:(id)controller balloonView:(id)view shouldSelectChatItem:(id)item
{
  itemCopy = item;
  v6 = 0;
  if (CKIsRunningInMacCatalyst())
  {
    if (([itemCopy itemIsReplyContextPreview] & 1) == 0)
    {
      objc_opt_class();
      if ((objc_opt_isKindOfClass() & 1) == 0)
      {
        objc_opt_class();
        if ((objc_opt_isKindOfClass() & 1) == 0)
        {
          objc_opt_class();
          if ((objc_opt_isKindOfClass() & 1) == 0 || ([itemCopy mediaObject], v8 = objc_claimAutoreleasedReturnValue(), objc_msgSend(v8, "transfer"), v9 = objc_claimAutoreleasedReturnValue(), v10 = objc_msgSend(v9, "isDownloadable"), v9, v8, (v10 & 1) == 0))
          {
            v6 = 1;
          }
        }
      }
    }
  }

  return v6;
}

- (BOOL)transcriptCollectionViewControllerShouldShouldScrollToTopForStatusBarTap:(id)tap
{
  v4 = [(CKChatController *)self activeSendMenuPresentationForChatController:self];
  if (v4 || [(CKChatController *)self isFullScreenBalloonViewOnScreen])
  {
    v5 = 0;
  }

  else
  {
    v7 = IMGetCachedDomainBoolForKeyWithDefaultValue();
    if (v7)
    {
      [(CKChatController *)self showMessageHistoryViewController];
    }

    v5 = v7 ^ 1;
  }

  return v5;
}

- (BOOL)transcriptCollectionViewControllerShouldScrollToBottomForLocalSentMessage:(id)message
{
  inlineReplyController = [(CKChatController *)self inlineReplyController];
  v4 = inlineReplyController == 0;

  return v4;
}

- (BOOL)transcriptCollectionViewControllerShouldPlayAudio:(id)audio
{
  entryView = [(CKChatController *)self entryView];
  isRecording = [entryView isRecording];

  return isRecording ^ 1;
}

- (void)transcriptCollectionViewControllerDidSetChatItems:(id)items
{
  v4.receiver = self;
  v4.super_class = CKChatController;
  [(CKCoreChatController *)&v4 transcriptCollectionViewControllerDidSetChatItems:items];
  if ([(CKViewController *)self deferredAppeared])
  {
    [(CKChatController *)self _showOrHideNicknameBannerIfNeeded];
  }

  [(CKChatController *)self updateRaiseGesture];
  [(CKChatController *)self _updatePhotoGridIfNeeded];
  [(CKChatController *)self updateQLPreviewControllerBarButtonItemsIfVisible];
}

- (void)transcriptCollectionViewControllerDidChangeAssociatedChatItem:(id)item chatItemDiff:(id)diff
{
  v5.receiver = self;
  v5.super_class = CKChatController;
  [(CKCoreChatController *)&v5 transcriptCollectionViewControllerDidChangeAssociatedChatItem:item chatItemDiff:diff];
  [(CKChatController *)self updateQLPreviewControllerBarButtonItemsIfVisible];
}

- (void)_updatePhotoGridIfNeeded
{
  selfCopy = self;
  v24 = *MEMORY[0x1E69E9840];
  obj = [(CKChatController *)self photoGridDisplayedChatItemGUID];
  if ([obj length])
  {
    photoGridDataSourceManager = [(CKChatController *)selfCopy photoGridDataSourceManager];
    if (photoGridDataSourceManager)
    {
    }

    else
    {
      photoGridMomentShareChatItem = [(CKChatController *)selfCopy photoGridMomentShareChatItem];

      if (!photoGridMomentShareChatItem)
      {
        return;
      }
    }

    v21 = 0u;
    v22 = 0u;
    v19 = 0u;
    v20 = 0u;
    collectionViewController = [(CKCoreChatController *)selfCopy collectionViewController];
    chatItems = [collectionViewController chatItems];

    obja = chatItems;
    v7 = [chatItems countByEnumeratingWithState:&v19 objects:v23 count:16];
    if (v7)
    {
      v8 = v7;
      v9 = *v20;
      while (2)
      {
        for (i = 0; i != v8; ++i)
        {
          if (*v20 != v9)
          {
            objc_enumerationMutation(obja);
          }

          v11 = *(*(&v19 + 1) + 8 * i);
          objc_opt_class();
          if (objc_opt_isKindOfClass())
          {
            iMChatItem = [v11 IMChatItem];
            guid = [iMChatItem guid];
            [(CKChatController *)selfCopy photoGridDisplayedChatItemGUID];
            v15 = v14 = selfCopy;
            v16 = [guid isEqualToString:v15];

            selfCopy = v14;
            if (v16)
            {
              [(CKChatController *)v14 photoGridDisplayedChatItemChanged:v11];
              goto LABEL_19;
            }
          }
        }

        v8 = [obja countByEnumeratingWithState:&v19 objects:v23 count:16];
        if (v8)
        {
          continue;
        }

        break;
      }
    }

LABEL_19:
  }

  else
  {
  }
}

- (void)transcriptCollectionViewControllerPerformBatchUpdateCompleted:(id)completed
{
  v12.receiver = self;
  v12.super_class = CKChatController;
  [(CKCoreChatController *)&v12 transcriptCollectionViewControllerPerformBatchUpdateCompleted:completed];
  inlineReplyController = [(CKChatController *)self inlineReplyController];

  if (inlineReplyController)
  {
    collectionViewController = [(CKCoreChatController *)self collectionViewController];
    collectionView = [collectionViewController collectionView];
    [collectionView setNeedsLayout];

    collectionViewController2 = [(CKCoreChatController *)self collectionViewController];
    collectionView2 = [collectionViewController2 collectionView];
    [collectionView2 layoutIfNeeded];

    inlineReplyController2 = [(CKChatController *)self inlineReplyController];
    transitionContext = [inlineReplyController2 transitionContext];

    _visibleChatItemsToScreenFrameMap = [(CKChatController *)self _visibleChatItemsToScreenFrameMap];
    [transitionContext setVisibleChatItemToFrameMap:_visibleChatItemsToScreenFrameMap];
  }
}

- (void)transcriptCollectionViewController:(id)controller willBeginImpactEffectAnimationWithSendAnimationContext:(id)context
{
  contextCopy = context;
  if ([contextCopy isSender])
  {
    [(CKChatController *)self dismissEffectPickerAnimated:1];
  }

  impactIdentifier = [contextCopy impactIdentifier];
  v6 = [CKImpactEffectManager identifierShouldPlayInWindow:impactIdentifier];

  if (v6)
  {
    currentNavigationBarBasedOnSizeClass = [(CKChatController *)self currentNavigationBarBasedOnSizeClass];
    superview = [currentNavigationBarBasedOnSizeClass superview];
    [currentNavigationBarBasedOnSizeClass frame];
    [superview convertRect:0 toView:?];
    v10 = v9;
    v12 = v11;
    v14 = v13;
    v16 = v15;

    throwBalloonViews = [contextCopy throwBalloonViews];
    firstObject = [throwBalloonViews firstObject];

    superview2 = [firstObject superview];
    [firstObject frame];
    [superview2 convertRect:0 toView:?];
    v21 = v20;
    v23 = v22;
    v25 = v24;
    v27 = v26;

    collectionView = [(CKChatController *)self collectionView];
    [collectionView convertRect:0 toView:{v21, v23, v25, v27}];
    v30 = v29;
    v32 = v31;
    v34 = v33;
    v36 = v35;

    v39.origin.x = v10;
    v39.origin.y = v12;
    v39.size.width = v14;
    v39.size.height = v16;
    v40.origin.x = v30;
    v40.origin.y = v32;
    v40.size.width = v34;
    v40.size.height = v36;
    if (CGRectIntersectsRect(v39, v40))
    {
      [currentNavigationBarBasedOnSizeClass setAlpha:0.0];
    }
  }
}

- (void)transcriptCollectionViewController:(id)controller didEndImpactEffectAnimationWithSendAnimationContext:(id)context
{
  v4 = [(CKChatController *)self currentNavigationBarBasedOnSizeClass:controller];
  [v4 alpha];
  if (v5 != 1.0)
  {
    v6 = MEMORY[0x1E69DD250];
    v7[0] = MEMORY[0x1E69E9820];
    v7[1] = 3221225472;
    v7[2] = __107__CKChatController_transcriptCollectionViewController_didEndImpactEffectAnimationWithSendAnimationContext___block_invoke;
    v7[3] = &unk_1E72EBA18;
    v8 = v4;
    [v6 animateWithDuration:v7 animations:0.25];
  }
}

- (void)transcriptCollectionViewController:(id)controller balloonView:(id)view didRequestPresentationStyle:(unint64_t)style forChatItem:(id)item allowAllStyles:(BOOL)styles
{
  viewCopy = view;
  itemCopy = item;
  objc_opt_class();
  if (objc_opt_isKindOfClass())
  {
    v11 = itemCopy;
    if (CKIsRunningInMacCatalyst())
    {
      if ([v11 balloonOrientation] == 1)
      {
        v12 = 8;
      }

      else
      {
        v12 = 4;
      }

      inputController2 = [[CKTranscriptPluginPresentationConfiguration alloc] initWithSourceView:viewCopy permittedArrowDirections:v12 shouldDisableSnapshotView:1];
      inputController = [(CKCoreChatController *)self inputController];
      [inputController presentViewControllerWithPluginChatItem:v11 presentationStyle:style presentationConfiguration:inputController2];
    }

    else
    {
      inputController2 = [(CKCoreChatController *)self inputController];
      [(CKTranscriptPluginPresentationConfiguration *)inputController2 presentViewControllerWithPluginChatItem:v11 presentationStyle:style];
    }
  }
}

- (BOOL)transcriptCollectionViewController:(id)controller balloonViewDidRequestCommitPayload:(id)payload forPlugin:(id)plugin allowAllCommits:(BOOL)commits error:(id *)error
{
  commitsCopy = commits;
  controllerCopy = controller;
  payloadCopy = payload;
  pluginCopy = plugin;
  v15 = [controllerCopy isVisiblePlugin:pluginCopy];
  v16 = [controllerCopy hasRecentTouchForSendingPlugin:pluginCopy];
  if (![pluginCopy length] || !v15)
  {
    if (error)
    {
      v19 = MEMORY[0x1E696ABC0];
      v20 = 2;
LABEL_9:
      [v19 errorWithDomain:@"CKBrowserErrorDomain" code:v20 userInfo:0];
      *error = v18 = 0;
      goto LABEL_11;
    }

LABEL_10:
    v18 = 0;
    goto LABEL_11;
  }

  if (((commitsCopy | v16) & 1) == 0)
  {
    if (error)
    {
      v19 = MEMORY[0x1E696ABC0];
      v20 = 1;
      goto LABEL_9;
    }

    goto LABEL_10;
  }

  [controllerCopy clearRecentPluginTouch];
  inputController = [(CKCoreChatController *)self inputController];
  v18 = [inputController commitPayloadBypassingValidation:payloadCopy forPlugin:pluginCopy];

LABEL_11:
  return v18;
}

- (void)transcriptCollectionViewController:(id)controller balloonViewDidRequestStartEditingPayload:(id)payload forPlugin:(id)plugin allowAllCommits:(BOOL)commits completionHandler:(id)handler
{
  commitsCopy = commits;
  payloadCopy = payload;
  pluginCopy = plugin;
  handlerCopy = handler;
  controllerCopy = controller;
  v15 = [controllerCopy isVisiblePlugin:pluginCopy];
  v16 = [controllerCopy hasRecentTouchForSendingPlugin:pluginCopy];

  if (![pluginCopy length] || !v15)
  {
    if (!handlerCopy)
    {
      goto LABEL_11;
    }

    v18 = MEMORY[0x1E696ABC0];
    v19 = -1;
LABEL_9:
    inputController = [v18 errorWithDomain:@"CKBrowserErrorDomain" code:v19 userInfo:0];
    handlerCopy[2](handlerCopy, inputController);
    goto LABEL_10;
  }

  if (((commitsCopy | v16) & 1) == 0)
  {
    if (!handlerCopy)
    {
      goto LABEL_11;
    }

    v18 = MEMORY[0x1E696ABC0];
    v19 = 1;
    goto LABEL_9;
  }

  inputController = [(CKCoreChatController *)self inputController];
  [inputController startEditingPayloadBypassingValidation:payloadCopy forPlugin:pluginCopy completion:handlerCopy];
LABEL_10:

LABEL_11:
}

- (void)transcriptCollectionViewController:(id)controller selectedPollAddChoice:(id)choice
{
  controllerCopy = controller;
  choiceCopy = choice;
  dataSource = [choiceCopy dataSource];
  bundleID = [dataSource bundleID];
  v10 = IMBalloonExtensionIDWithSuffix();
  v11 = [bundleID isEqualToString:v10];

  if (v11)
  {
    v12 = IMBalloonExtensionIDWithSuffix();
    v13 = [controllerCopy isVisiblePlugin:v12];

    dataSource2 = [choiceCopy dataSource];
    pluginPayload = [dataSource2 pluginPayload];

    message = [choiceCopy message];
    associatedMessageGUID = [message associatedMessageGUID];
    [pluginPayload setAssociatedMessageGUID:associatedMessageGUID];

    [pluginPayload setLiveEditableInEntryView:1];
    [pluginPayload setUpdate:1];
    v18 = [CKBrowserItemPayload browserItemPayloadFromIMPluginPayload:pluginPayload];
    [v18 setRequiresValidation:1];
    [v18 setUpdate:1];
    dataSource3 = [choiceCopy dataSource];
    sessionGUID = [dataSource3 sessionGUID];
    [v18 setAssociatedMessageGUID:sessionGUID];

    dataSource4 = [choiceCopy dataSource];
    sessionGUID2 = [dataSource4 sessionGUID];
    [v18 setPluginSessionGUID:sessionGUID2];

    if (v13)
    {
      v23 = [[CKComposition alloc] initWithText:0 subject:0 shelfPluginPayload:v18];
      composition = [(CKChatController *)self composition];
      v25 = [composition compositionByAppendingComposition:v23];
      [(CKChatController *)self setComposition:v25];

      [(CKChatController *)self _updateEntryViewConstraintsIfNeeded];
    }
  }

  else
  {
    v26 = IMLogHandleForCategory();
    if (os_log_type_enabled(v26, OS_LOG_TYPE_ERROR))
    {
      [CKChatController transcriptCollectionViewController:selectedPollAddChoice:];
    }
  }
}

- (void)chatInputController:(id)controller didRequestAppendToCompositionForPayload:(id)payload
{
  payloadCopy = payload;
  entryView = [(CKChatController *)self entryView];
  composition = [entryView composition];

  mediaObjectFromPayload = [payloadCopy mediaObjectFromPayload];

  v8 = [composition compositionByAppendingMediaObject:mediaObjectFromPayload];

  if ([v8 hasContent])
  {
    entryView2 = [(CKChatController *)self entryView];
    [entryView2 setComposition:v8];

    [(CKChatController *)self _updateEntryViewFrameIfNeeded:1];
  }
}

- (BOOL)transcriptCollectionViewController:(id)controller balloonViewDidRequestCommitSticker:(id)sticker forPlugin:(id)plugin allowAllCommits:(BOOL)commits error:(id *)error
{
  commitsCopy = commits;
  controllerCopy = controller;
  stickerCopy = sticker;
  pluginCopy = plugin;
  v15 = [controllerCopy isVisiblePlugin:pluginCopy];
  v16 = [controllerCopy hasRecentTouchForSendingPlugin:pluginCopy];
  if (![pluginCopy length] || !v15)
  {
    if (!error)
    {
      goto LABEL_10;
    }

    v18 = MEMORY[0x1E696ABC0];
    v19 = 2;
LABEL_9:
    *error = [v18 errorWithDomain:@"CKBrowserErrorDomain" code:v19 userInfo:0];
    goto LABEL_10;
  }

  if (((commitsCopy | v16) & 1) == 0)
  {
    if (!error)
    {
      goto LABEL_10;
    }

    v18 = MEMORY[0x1E696ABC0];
    v19 = 1;
    goto LABEL_9;
  }

  [controllerCopy clearRecentPluginTouch];
  inputController = [(CKCoreChatController *)self inputController];
  [inputController commitStickerBypassingValidation:stickerCopy forPlugin:pluginCopy stickerFrame:{*MEMORY[0x1E695F058], *(MEMORY[0x1E695F058] + 8), *(MEMORY[0x1E695F058] + 16), *(MEMORY[0x1E695F058] + 24)}];

LABEL_10:
  return 1;
}

- (BOOL)transcriptCollectionViewController:(id)controller balloonViewDidRequestSendCustomAcknowledgementPayload:(id)payload forPlugin:(id)plugin error:(id *)error
{
  v37 = *MEMORY[0x1E69E9840];
  controllerCopy = controller;
  payloadCopy = payload;
  pluginCopy = plugin;
  v13 = [controllerCopy isVisiblePlugin:pluginCopy];
  v14 = [controllerCopy hasRecentTouchForSendingPlugin:pluginCopy];
  if (![pluginCopy length])
  {
    v18 = IMLogHandleForCategory();
    if (os_log_type_enabled(v18, OS_LOG_TYPE_ERROR))
    {
      [CKChatController transcriptCollectionViewController:balloonViewDidRequestSendCustomAcknowledgementPayload:forPlugin:error:];
    }

    v27 = 4;
    goto LABEL_24;
  }

  if ((v13 & 1) == 0)
  {
    v18 = IMLogHandleForCategory();
    if (os_log_type_enabled(v18, OS_LOG_TYPE_ERROR))
    {
      [CKChatController transcriptCollectionViewController:balloonViewDidRequestSendCustomAcknowledgementPayload:forPlugin:error:];
    }

    v27 = 2;
    goto LABEL_24;
  }

  if ((v14 & 1) == 0)
  {
    v18 = IMLogHandleForCategory();
    if (os_log_type_enabled(v18, OS_LOG_TYPE_ERROR))
    {
      [CKChatController transcriptCollectionViewController:balloonViewDidRequestSendCustomAcknowledgementPayload:forPlugin:error:];
    }

    v27 = 1;
    goto LABEL_24;
  }

  conversation = [(CKCoreChatController *)self conversation];

  if (!conversation)
  {
    v18 = IMLogHandleForCategory();
    if (os_log_type_enabled(v18, OS_LOG_TYPE_ERROR))
    {
      [CKChatController transcriptCollectionViewController:balloonViewDidRequestSendCustomAcknowledgementPayload:forPlugin:error:];
    }

    v27 = 6;
    goto LABEL_24;
  }

  [controllerCopy clearRecentPluginTouch];
  v16 = MEMORY[0x1E696AEC0];
  associatedMessageGUID = [payloadCopy associatedMessageGUID];
  v18 = [v16 stringWithFormat:@"bp:%@", associatedMessageGUID];

  collectionViewController = [(CKCoreChatController *)self collectionViewController];
  v19 = [collectionViewController chatItemForGUID:v18];
  if (!v19)
  {
    v28 = IMLogHandleForCategory();
    if (os_log_type_enabled(v28, OS_LOG_TYPE_ERROR))
    {
      [CKChatController transcriptCollectionViewController:balloonViewDidRequestSendCustomAcknowledgementPayload:forPlugin:error:];
    }

    v27 = 5;
LABEL_24:

    [MEMORY[0x1E696ABC0] errorWithDomain:@"CKBrowserErrorDomain" code:v27 userInfo:0];
    *error = v26 = 0;
    goto LABEL_25;
  }

  v20 = [MEMORY[0x1E69A5AE0] configureMessageSummaryInfoForChatItem:v19];
  v21 = MEMORY[0x1E69A5BD8];
  data = [payloadCopy data];
  associatedMessageGUID2 = [payloadCopy associatedMessageGUID];
  v24 = [v21 customAcknowledgementMessageWithPayloadData:data associatedMessageGUID:associatedMessageGUID2 balloonBundleID:pluginCopy messageSummaryInfo:v20 threadIdentifier:0];

  v25 = IMLogHandleForCategory();
  if (os_log_type_enabled(v25, OS_LOG_TYPE_ERROR))
  {
    [CKChatController transcriptCollectionViewController:? balloonViewDidRequestSendCustomAcknowledgementPayload:? forPlugin:? error:?];
  }

  [(CKChatController *)self sendCustomAcknowledgementMessage:v24];
  v26 = 1;
LABEL_25:
  if (IMOSLoggingEnabled())
  {
    v29 = OSLogHandleForIMFoundationCategory();
    if (os_log_type_enabled(v29, OS_LOG_TYPE_INFO))
    {
      v30 = @"NO";
      if (v26)
      {
        v30 = @"YES";
      }

      *buf = 136315394;
      v34 = "[CKChatController transcriptCollectionViewController:balloonViewDidRequestSendCustomAcknowledgementPayload:forPlugin:error:]";
      v35 = 2112;
      v36 = v30;
      _os_log_impl(&dword_19020E000, v29, OS_LOG_TYPE_INFO, "%s: sent acknowledgement? %@", buf, 0x16u);
    }
  }

  return v26;
}

- (void)transcriptCollectionViewControllerDisplaySMSSpamReporting:(id)reporting
{
  chat = [(CKCoreChatController *)self chat];
  allMessagesToReportAsSpam = [chat allMessagesToReportAsSpam];

  [(CKChatController *)self showSMSReportSpamExtensionControllerForMessages:allMessagesToReportAsSpam];
}

- (void)transcriptCollectionViewController:(id)controller willDisplayBalloonForGUID:(id)d withIndexPath:(id)path withOriginY:(double)y
{
  controllerCopy = controller;
  dCopy = d;
  pathCopy = path;
  firstUnreadMessageGUID = [(CKChatController *)self firstUnreadMessageGUID];

  if (firstUnreadMessageGUID)
  {
    if (![(CKChatController *)self didDisplayFirstUnreadMessage])
    {
      firstUnreadMessageGUID2 = [(CKChatController *)self firstUnreadMessageGUID];
      v15 = [dCopy isEqualToString:firstUnreadMessageGUID2];

      if (v15)
      {
        [(CKChatController *)self setDidDisplayFirstUnreadMessage:1];
        [(CKChatController *)self setFirstUnreadMessageCellOriginY:y];
        if (IMOSLoggingEnabled())
        {
          v16 = OSLogHandleForIMFoundationCategory();
          if (os_log_type_enabled(v16, OS_LOG_TYPE_INFO))
          {
            *v17 = 0;
            _os_log_impl(&dword_19020E000, v16, OS_LOG_TYPE_INFO, "First unread message has been displayed by collection view.", v17, 2u);
          }
        }
      }
    }
  }
}

- (void)transcriptCollectionViewController:(id)controller didScroll:(CGPoint)scroll
{
  y = scroll.y;
  x = scroll.x;
  controllerCopy = controller;
  if ([(CKChatController *)self didDisplayFirstUnreadMessage])
  {
    catchUpButton = [(CKChatController *)self catchUpButton];

    if (catchUpButton)
    {
      if ([(CKChatController *)self _isFirstUnreadMessageVisibleForContentOffset:x, y])
      {
        [(CKChatController *)self _hideCatchUpButtonIfNeededAndRemoveOnCompletion:1];
        indexPathForFirstUnreadMessage = [(CKChatController *)self indexPathForFirstUnreadMessage];
        [controllerCopy highlightItemAtIndexPathWhenDisplayed:indexPathForFirstUnreadMessage animated:1 autoDismiss:1];
      }
    }
  }
}

- (BOOL)_isFirstUnreadMessageVisibleForContentOffset:(CGPoint)offset
{
  y = offset.y;
  [(CKChatController *)self _currentlyVisibleBannerHeight];
  v6 = v5;
  collectionView = [(CKChatController *)self collectionView];
  [collectionView adjustedContentInset];
  v9 = v8;

  if (v9 >= v6)
  {
    v6 = v9;
  }

  [(CKChatController *)self firstUnreadMessageCellOriginY];
  return y <= v10 - v6;
}

- (void)transcriptCollectionViewControllerWillDisplayLastBalloon:(id)balloon
{
  v3.receiver = self;
  v3.super_class = CKChatController;
  [(CKCoreChatController *)&v3 transcriptCollectionViewControllerWillDisplayLastBalloon:balloon];
}

- (double)transcriptCollectionViewController:(id)controller targetAlphaForChatItem:(id)item
{
  itemCopy = item;
  v6 = -1.0;
  if (([itemCopy itemIsReplyContextPreview] & 1) == 0)
  {
    objc_opt_class();
    if ((objc_opt_isKindOfClass() & 1) == 0 || (-[CKChatController traitCollection](self, "traitCollection"), v7 = objc_claimAutoreleasedReturnValue(), v8 = [v7 isTranscriptBackgroundActive], v7, v6 = 0.5, v8))
    {
      inlineReplyController = [(CKChatController *)self inlineReplyController];
      if (!inlineReplyController)
      {
        goto LABEL_6;
      }

      v10 = inlineReplyController;
      inlineReplyController2 = [(CKChatController *)self inlineReplyController];
      animatingOut = [inlineReplyController2 animatingOut];

      if (animatingOut)
      {
        goto LABEL_6;
      }

      objc_opt_class();
      if (objc_opt_isKindOfClass() & 1) != 0 && [itemCopy color] == 1 || (objc_opt_class(), (objc_opt_isKindOfClass()) && (objc_msgSend(itemCopy, "latestIsFromMe"))
      {
        v6 = 0.699999988;
        goto LABEL_7;
      }

      objc_opt_class();
      v6 = 0.400000006;
      if ((objc_opt_isKindOfClass() & 1) == 0)
      {
        objc_opt_class();
        if ((objc_opt_isKindOfClass() & 1) == 0)
        {
          objc_opt_class();
          if ((objc_opt_isKindOfClass() & 1) == 0)
          {
LABEL_6:
            v6 = 1.0;
          }
        }
      }
    }
  }

LABEL_7:

  return v6;
}

- (void)transcriptCollectionViewController:(id)controller sendQuickReplyComposition:(id)composition withSourceView:(id)view
{
  controllerCopy = controller;
  compositionCopy = composition;
  viewCopy = view;
  collectionView = [controllerCopy collectionView];
  [collectionView beginHoldingContentOffsetUpdatesForReason:@"ChatControllerSendAnimation"];

  v12 = [(CKChatController *)self makeThrowAnimationManagerForComposition:compositionCopy];
  [viewCopy bounds];
  v14 = v13;
  v16 = v15;
  v18 = v17;
  v20 = v19;
  view = [(CKChatController *)self view];
  [viewCopy convertRect:view toView:{v14, v16, v18, v20}];
  v23 = v22;
  v25 = v24;
  v27 = v26;
  v29 = v28;

  [v12 setSourceRect:{v23, v25, v27, v29}];
  view2 = [(CKChatController *)self view];
  v31 = [controllerCopy quickReplySnapshotInView:view2];

  if (v31)
  {
    [v12 setQuickReplySnapshot:v31];
  }

  else if (IMOSLoggingEnabled())
  {
    v32 = OSLogHandleForIMFoundationCategory();
    if (os_log_type_enabled(v32, OS_LOG_TYPE_INFO))
    {
      *buf = 0;
      _os_log_impl(&dword_19020E000, v32, OS_LOG_TYPE_INFO, "CKChatController : Throw Animation Manager: No snapshot generated. Attempting graceful failure by continuing send.", buf, 2u);
    }
  }

  [(CKChatController *)self setThrowSendAnimationManager:v12];
  v35[0] = MEMORY[0x1E69E9820];
  v35[1] = 3221225472;
  v35[2] = __96__CKChatController_transcriptCollectionViewController_sendQuickReplyComposition_withSourceView___block_invoke;
  v35[3] = &unk_1E72EB880;
  v35[4] = self;
  v36 = compositionCopy;
  v37 = v12;
  v33 = v12;
  v34 = compositionCopy;
  [(CKChatController *)self sendComposition:v34 animations:v35];
}

void __96__CKChatController_transcriptCollectionViewController_sendQuickReplyComposition_withSourceView___block_invoke(uint64_t a1)
{
  v2 = [*(a1 + 32) conversation];
  v3 = [v2 messagesFromComposition:*(a1 + 40)];

  v4 = [*(a1 + 32) collectionViewController];
  v5 = [v4 updateAnimationGroup];
  v8[0] = MEMORY[0x1E69E9820];
  v8[1] = 3221225472;
  v8[2] = __96__CKChatController_transcriptCollectionViewController_sendQuickReplyComposition_withSourceView___block_invoke_2;
  v8[3] = &unk_1E72EBEF8;
  v6 = *(a1 + 40);
  v8[4] = *(a1 + 32);
  v9 = v6;
  v10 = *(a1 + 48);
  v11 = v3;
  v7 = v3;
  dispatch_group_notify(v5, MEMORY[0x1E69E96A0], v8);
}

uint64_t __96__CKChatController_transcriptCollectionViewController_sendQuickReplyComposition_withSourceView___block_invoke_2(uint64_t a1)
{
  [*(a1 + 32) flagSensitiveMediaObjects:*(a1 + 40)];
  v2 = *(a1 + 48);
  v3 = *(a1 + 56);

  return [v2 animateQuickReplyMessages:v3];
}

- (void)transcriptCollectionViewController:(id)controller didTapTruncatedCaptionForRichCard:(id)card onBalloonView:(id)view
{
  viewCopy = view;
  v7 = [CKReaderViewController readerViewControllerForRichCard:card];
  v8 = v7;
  if (v7)
  {
    [v7 setDelegate:self];
    if (CKIsRunningInMacCatalyst())
    {
      [v8 setModalPresentationStyle:7];
      popoverPresentationController = [v8 popoverPresentationController];
      [popoverPresentationController setSourceView:viewCopy];

      [(CKChatController *)self presentViewController:v8 animated:1 completion:0];
    }

    else
    {
      [(CKChatController *)self showViewController:v8 sender:self];
    }
  }
}

- (void)transcriptCollectionViewController:(id)controller selectedChipAction:(id)action
{
  actionCopy = action;
  suggestedActionsHandler = [(CKChatController *)self suggestedActionsHandler];
  [suggestedActionsHandler performChipAction:actionCopy];
}

- (void)transcriptCollectionViewControllerWillUpdateTranscriptChatItems:(id)items
{
  v9.receiver = self;
  v9.super_class = CKChatController;
  [(CKCoreChatController *)&v9 transcriptCollectionViewControllerWillUpdateTranscriptChatItems:items];
  fullScreenBalloonViewController = [(CKCoreChatController *)self fullScreenBalloonViewController];
  displayConfiguration = [fullScreenBalloonViewController displayConfiguration];
  type = [displayConfiguration type];

  if (type == 2)
  {
    collectionViewController = [(CKCoreChatController *)self collectionViewController];
    collectionView = [collectionViewController collectionView];
    [collectionView beginHoldingContentOffsetUpdatesForReason:@"TranscriptUpdatingForAddSticker"];
  }
}

- (void)transcriptCollectionViewControllerDidUpdateTranscriptChatItems:(id)items
{
  v10.receiver = self;
  v10.super_class = CKChatController;
  [(CKCoreChatController *)&v10 transcriptCollectionViewControllerDidUpdateTranscriptChatItems:items];
  if ([(CKViewController *)self deferredAppeared])
  {
    [(CKChatController *)self _showOrHideNicknameBannerIfNeeded];
  }

  [(CKChatController *)self updateRaiseGesture];
  [(CKChatController *)self _updatePhotoGridIfNeeded];
  fullScreenBalloonViewController = [(CKCoreChatController *)self fullScreenBalloonViewController];
  displayConfiguration = [fullScreenBalloonViewController displayConfiguration];
  type = [displayConfiguration type];

  if (type == 2)
  {
    collectionViewController = [(CKCoreChatController *)self collectionViewController];
    collectionView = [collectionViewController collectionView];
    [collectionView endHoldingContentOffsetUpdatesForReason:@"TranscriptUpdatingForAddSticker"];

    fullScreenBalloonViewController2 = [(CKCoreChatController *)self fullScreenBalloonViewController];
    [fullScreenBalloonViewController2 updateStickersAnimated:0];
  }
}

- (void)prepareInputForPreviewPresentation
{
  inputController = [(CKCoreChatController *)self inputController];
  isInputViewVisible = [inputController isInputViewVisible];

  if (isInputViewVisible)
  {
    entryView = [(CKChatController *)self entryView];
    contentView = [entryView contentView];
    -[CKChatController setEntryViewWasActiveOnPreview:](self, "setEntryViewWasActiveOnPreview:", [contentView isActive]);

    v7 = +[CKUIBehavior sharedBehaviors];
    LOBYTE(contentView) = [v7 isEntryViewInputAccessory];

    if ((contentView & 1) == 0)
    {
      collectionViewController = [(CKCoreChatController *)self collectionViewController];
      collectionView = [collectionViewController collectionView];
      [collectionView beginHoldingContentOffsetUpdatesForReason:@"ChatControllerPreviewPresentation"];
    }

    v10.receiver = self;
    v10.super_class = CKChatController;
    [(CKChatController *)&v10 becomeFirstResponder];
  }

  else
  {

    [(CKChatController *)self setWasKeyboardShowingWithApp:0];
  }
}

- (void)restoreInputAfterPreviewPresentation
{
  if ([(CKChatController *)self wasKeyboardShowingWithApp])
  {
    if ([(CKChatController *)self entryViewWasActiveOnPreview])
    {
      [(CKChatController *)self setEntryViewWasActiveOnPreview:0];
      v3 = 1;
    }

    else
    {
      v3 = 0;
    }

    [(CKChatController *)self setTargetFirstResponder:v3];
  }

  collectionViewController = [(CKCoreChatController *)self collectionViewController];
  collectionView = [collectionViewController collectionView];
  [collectionView endHoldingContentOffsetUpdatesForReason:@"ChatControllerPreviewPresentation"];
}

- (void)restoreInputAfterSearchPresentation
{
  if (CKIsRunningInMacCatalyst() && ![(CKChatController *)self targetFirstResponder])
  {
    [(CKChatController *)self setTargetFirstResponder:1];
  }

  [(CKChatController *)self becomeFirstResponder];
}

- (UIEdgeInsets)_avoidanceInsets
{
  v20.receiver = self;
  v20.super_class = CKChatController;
  [(CKChatController *)&v20 _avoidanceInsets];
  v4 = v3;
  v6 = v5;
  v8 = v7;
  v10 = v9;
  entryView = [(CKChatController *)self entryView];
  v12 = entryView;
  if (entryView)
  {
    contentView = [entryView contentView];
    isActive = [contentView isActive];

    if ((isActive & 1) == 0)
    {
      [v12 frame];
      v8 = v8 + v15;
    }
  }

  v16 = v4;
  v17 = v6;
  v18 = v8;
  v19 = v10;
  result.right = v19;
  result.bottom = v18;
  result.left = v17;
  result.top = v16;
  return result;
}

- (void)_presentSentWithSiriUI
{
  v3 = [CKSentWithSiriViewController alloc];
  conversation = [(CKCoreChatController *)self conversation];
  v9 = [(CKSentWithSiriViewController *)v3 initWithConversation:conversation];

  v5 = [objc_alloc(MEMORY[0x1E69DC708]) initWithBarButtonSystemItem:0 target:self action:sel__dismissSentWithSiriUI];
  navigationItem = [(CKSentWithSiriViewController *)v9 navigationItem];
  [navigationItem setRightBarButtonItem:v5];

  v7 = [[CKFullscreenBrowserNavigationController alloc] initWithRootViewController:v9];
  v8 = +[CKAdaptivePresentationController sharedInstance];
  [v8 presentViewController:v7 fromViewController:self presentationHandler:0 dismissalHandler:0 animated:1 completion:0];
}

- (void)_dismissSentWithSiriUI
{
  v2 = +[CKAdaptivePresentationController sharedInstance];
  [v2 dismissViewControllerAnimated:1 completion:0];
}

- (void)_presentBrowserForPlugin:(id)plugin
{
  pluginCopy = plugin;
  inputController = [(CKCoreChatController *)self inputController];
  [inputController launchAndShowBrowserForPlugin:pluginCopy dataSource:0 style:0];
}

- (void)_presentBrowserOrAppStoreForAdamID:(id)d url:(id)url identifier:(id)identifier isForSticker:(BOOL)sticker
{
  stickerCopy = sticker;
  v32 = *MEMORY[0x1E69E9840];
  dCopy = d;
  urlCopy = url;
  identifierCopy = identifier;
  v13 = identifierCopy;
  if (dCopy)
  {
    v14 = +[CKBalloonPluginManager sharedInstance];
    v15 = [v14 pluginForAdamID:dCopy];

    if (v15)
    {
      if (stickerCopy)
      {
        v16 = +[CKBalloonPluginManager sharedInstance];
        v17 = [v16 pluginForIdentifier:@"com.apple.messages.MSMessageExtensionBalloonPlugin:0000000000:com.apple.Stickers.UserGenerated.MessagesExtension"];

        if (v17)
        {
          v18 = v17;
        }

        else
        {
          v18 = v15;
        }

        v19 = v18;

        if (IMOSLoggingEnabled())
        {
          v20 = OSLogHandleForIMFoundationCategory();
          if (os_log_type_enabled(v20, OS_LOG_TYPE_INFO))
          {
            v28 = 138412290;
            v29 = v19;
            _os_log_impl(&dword_19020E000, v20, OS_LOG_TYPE_INFO, "We have a plugin: %@, we'll launch the stickers ultra extension instead of launching that plugin directly.", &v28, 0xCu);
          }
        }
      }

      else
      {
        v19 = v15;
      }

      [(CKChatController *)self _presentBrowserForPlugin:v19];
    }

    else
    {
      inputController = [(CKCoreChatController *)self inputController];
      [inputController presentAppStoreForAdamID:dCopy];

      mEMORY[0x1E69A8168] = [MEMORY[0x1E69A8168] sharedInstance];
      [mEMORY[0x1E69A8168] trackEvent:*MEMORY[0x1E69A72F0]];

      v19 = 0;
    }

    if (IMOSLoggingEnabled())
    {
      v25 = OSLogHandleForIMFoundationCategory();
      if (os_log_type_enabled(v25, OS_LOG_TYPE_INFO))
      {
        v28 = 138412546;
        v29 = dCopy;
        v30 = 2112;
        v31 = v19;
        _os_log_impl(&dword_19020E000, v25, OS_LOG_TYPE_INFO, "presenting browser or app store for ID: %@, plugin: %@", &v28, 0x16u);
      }
    }
  }

  else if (urlCopy)
  {
    v21 = [MEMORY[0x1E695DFF8] URLWithString:urlCopy];
    if (v21)
    {
      [*MEMORY[0x1E69DDA98] openURL:v21 withCompletionHandler:0];
    }

    if (IMOSLoggingEnabled())
    {
      v22 = OSLogHandleForIMFoundationCategory();
      if (os_log_type_enabled(v22, OS_LOG_TYPE_INFO))
      {
        v28 = 138412290;
        v29 = urlCopy;
        _os_log_impl(&dword_19020E000, v22, OS_LOG_TYPE_INFO, "presenting browser or app store for URL: %@", &v28, 0xCu);
      }
    }
  }

  else if (identifierCopy)
  {
    v26 = +[CKBalloonPluginManager sharedInstance];
    v27 = [v26 pluginForIdentifier:v13];

    if (v27)
    {
      [(CKChatController *)self _presentBrowserForPlugin:v27];
    }
  }
}

- (void)presentAppStoreForURL:(id)l fromSourceApplication:(id)application
{
  applicationCopy = application;
  lCopy = l;
  inputController = [(CKCoreChatController *)self inputController];
  [inputController presentAppStoreForURL:lCopy fromSourceApplication:applicationCopy];
}

- (void)_updateForNewPreferredService
{
  v5.receiver = self;
  v5.super_class = CKChatController;
  [(CKCoreChatController *)&v5 _updateForNewPreferredService];
  effectPickerViewController = [(CKChatController *)self effectPickerViewController];
  conversation = [(CKCoreChatController *)self conversation];
  [effectPickerViewController updateColor:{objc_msgSend(conversation, "sendButtonColor")}];

  [(CKChatController *)self _updateEntryViewPasteConfiguration];
  [(CKChatController *)self refreshMacToolbar];
}

- (void)_willSendComposition:(id)composition inConversation:(id)conversation
{
  compositionCopy = composition;
  v22.receiver = self;
  v22.super_class = CKChatController;
  [(CKCoreChatController *)&v22 _willSendComposition:compositionCopy inConversation:conversation];
  shelfPluginPayload = [compositionCopy shelfPluginPayload];
  objc_opt_class();
  if (objc_opt_isKindOfClass())
  {
    shouldSendAsMediaObject = [shelfPluginPayload shouldSendAsMediaObject];
  }

  else
  {
    shouldSendAsMediaObject = 0;
  }

  pluginBundleID = [shelfPluginPayload pluginBundleID];
  if ([pluginBundleID length])
  {
    pluginBundleID2 = [shelfPluginPayload pluginBundleID];
    if ([pluginBundleID2 rangeOfString:*MEMORY[0x1E69A69F0]] == 0x7FFFFFFFFFFFFFFFLL)
    {
      pluginBundleID3 = [shelfPluginPayload pluginBundleID];
      v12 = [pluginBundleID3 rangeOfString:*MEMORY[0x1E69A6A18]];

      if (v12 == 0x7FFFFFFFFFFFFFFFLL)
      {
        if (!shouldSendAsMediaObject)
        {
          goto LABEL_19;
        }

        goto LABEL_13;
      }
    }

    else
    {
    }

    if ((shouldSendAsMediaObject & 1) == 0)
    {
      shelfPluginPayload2 = [compositionCopy shelfPluginPayload];
      [(CKChatController *)self setExtensionPayloadBeingSent:shelfPluginPayload2];
LABEL_18:

      goto LABEL_19;
    }

LABEL_13:
    shelfPluginPayload2 = shelfPluginPayload;
    mediaObject = [shelfPluginPayload2 mediaObject];
    objc_opt_class();
    isKindOfClass = objc_opt_isKindOfClass();

    if (isKindOfClass)
    {
      mediaObject2 = [shelfPluginPayload2 mediaObject];
      sticker = [mediaObject2 sticker];

      if (sticker)
      {
        sticker2 = [mediaObject2 sticker];
        [CKChatController donateStickerToRecents:sticker2];
      }
    }

    goto LABEL_18;
  }

  if (shouldSendAsMediaObject)
  {
    goto LABEL_13;
  }

LABEL_19:
  entryView = [(CKChatController *)self entryView];
  contentView = [entryView contentView];
  pluginEntryViewController = [contentView pluginEntryViewController];

  if (objc_opt_respondsToSelector())
  {
    [pluginEntryViewController payloadWillSend];
  }
}

- (void)_didSendCompositionInConversation:(id)conversation
{
  v22 = *MEMORY[0x1E69E9840];
  conversationCopy = conversation;
  v19.receiver = self;
  v19.super_class = CKChatController;
  [(CKCoreChatController *)&v19 _didSendCompositionInConversation:conversationCopy];
  mEMORY[0x1E69A8070] = [MEMORY[0x1E69A8070] sharedFeatureFlags];
  isExpressiveTextEnabled = [mEMORY[0x1E69A8070] isExpressiveTextEnabled];

  if (isExpressiveTextEnabled)
  {
    entryView = [(CKChatController *)self entryView];
    contentView = [entryView contentView];
    textView = [contentView textView];

    [textView hideTextEffectsPickerIfNeededAndResetTypingAttributes];
  }

  extensionPayloadBeingSent = [(CKChatController *)self extensionPayloadBeingSent];
  if (IMOSLoggingEnabled())
  {
    v11 = OSLogHandleForIMFoundationCategory();
    if (os_log_type_enabled(v11, OS_LOG_TYPE_INFO))
    {
      *buf = 138412290;
      v21 = extensionPayloadBeingSent;
      _os_log_impl(&dword_19020E000, v11, OS_LOG_TYPE_INFO, "_didSendCompositionInConversation: %@", buf, 0xCu);
    }
  }

  if (extensionPayloadBeingSent)
  {
    [(CKChatController *)self setExtensionPayloadBeingSent:0];
    v12 = +[CKBalloonPluginManager sharedInstance];
    pluginBundleID = [extensionPayloadBeingSent pluginBundleID];
    v14 = [v12 viewControllerForPluginIdentifier:pluginBundleID];

    if (objc_opt_respondsToSelector())
    {
      senderIdentifier = [conversationCopy senderIdentifier];
      [v14 setSender:senderIdentifier];
    }

    if (objc_opt_respondsToSelector())
    {
      conversation = [(CKCoreChatController *)self conversation];
      recipientStrings = [conversation recipientStrings];

      [v14 setRecipients:recipientStrings];
    }

    if (objc_opt_respondsToSelector())
    {
      [v14 didStartSendingPluginPayload:extensionPayloadBeingSent];
    }

    balloonPluginDataSource = [v14 balloonPluginDataSource];
    [balloonPluginDataSource payloadWillSendFromShelf];
  }

  [(CKChatController *)self setSendingCompositionBackgroundTask:*MEMORY[0x1E69DDBE8]];
}

- (void)sendSelectedSuggestedReply:(id)reply messageGUID:(id)d
{
  dCopy = d;
  replyCopy = reply;
  v7 = [_CKSuggestedReplyComposition alloc];
  suggestedReplyBody = [replyCopy suggestedReplyBody];

  v9 = [(CKComposition *)v7 initWithText:suggestedReplyBody subject:0];
  if (dCopy)
  {
    chat = [(CKCoreChatController *)self chat];
    [chat markRepliedForMessageGUID:dCopy];
  }

  [(CKChatController *)self sendCompositionIfAllowed:v9];
}

- (void)stageSelectedSuggestedReply:(id)reply
{
  v16[1] = *MEMORY[0x1E69E9840];
  replyCopy = reply;
  suggestion = [replyCopy suggestion];
  displayText = [suggestion displayText];

  v7 = CKFrameworkBundle();
  v8 = [v7 localizedStringForKey:@"SELECTED_OPTION" value:&stru_1F04268F8 table:@"ChatKit"];

  v15 = @"suggestedReplyBody";
  suggestedReplyBody = [replyCopy suggestedReplyBody];

  v16[0] = suggestedReplyBody;
  v10 = [MEMORY[0x1E695DF20] dictionaryWithObjects:v16 forKeys:&v15 count:1];
  v11 = [_TtC7ChatKit25CKSuggestedActionsHandler pluginPayloadForShelfCardWithTitle:displayText summary:v8 userInfo:v10];

  v12 = [[CKComposition alloc] initWithText:0 subject:0 shelfPluginPayload:v11];
  composition = [(CKChatController *)self composition];
  v14 = [composition compositionByAppendingComposition:v12];
  [(CKChatController *)self setComposition:v14];
}

- (void)_showCatchUpButtonIfNeededResumingFromBackground:(BOOL)background
{
  backgroundCopy = background;
  if (CKIsCatchUpEnabled())
  {
    if ([(CKChatController *)self _wantsCatchUpAffordance])
    {
      catchUpButton = [(CKChatController *)self catchUpButton];

      if (!catchUpButton)
      {
        objc_initWeak(&location, self);
        aBlock[0] = MEMORY[0x1E69E9820];
        aBlock[1] = 3221225472;
        aBlock[2] = __69__CKChatController__showCatchUpButtonIfNeededResumingFromBackground___block_invoke;
        aBlock[3] = &unk_1E72EC460;
        objc_copyWeak(&v39, &location);
        v6 = _Block_copy(aBlock);
        v7 = [[_TtC7ChatKit22CKCatchUpButtonManager alloc] initWithDidTapButton:v6];
        [(CKChatController *)self setCatchUpButtonManager:v7];
        v37 = v6;
        catchUpButtonHost = [(CKCatchUpButtonManager *)v7 catchUpButtonHost];
        view = [catchUpButtonHost view];
        [(CKChatController *)self setCatchUpButton:view];

        [(CKChatController *)self addChildViewController:catchUpButtonHost];
        view2 = [(CKChatController *)self view];
        catchUpButton2 = [(CKChatController *)self catchUpButton];
        [view2 addSubview:catchUpButton2];

        [catchUpButtonHost didMoveToParentViewController:self];
        catchUpButton3 = [(CKChatController *)self catchUpButton];
        [catchUpButton3 setTranslatesAutoresizingMaskIntoConstraints:0];

        catchUpButton4 = [(CKChatController *)self catchUpButton];
        leadingAnchor = [catchUpButton4 leadingAnchor];
        view3 = [(CKChatController *)self view];
        leadingAnchor2 = [view3 leadingAnchor];
        v17 = [leadingAnchor constraintEqualToAnchor:leadingAnchor2];
        [v17 setActive:1];

        catchUpButton5 = [(CKChatController *)self catchUpButton];
        trailingAnchor = [catchUpButton5 trailingAnchor];
        view4 = [(CKChatController *)self view];
        trailingAnchor2 = [view4 trailingAnchor];
        v22 = [trailingAnchor constraintEqualToAnchor:trailingAnchor2];
        [v22 setActive:1];

        catchUpButton6 = [(CKChatController *)self catchUpButton];
        topAnchor = [catchUpButton6 topAnchor];
        view5 = [(CKChatController *)self view];
        safeAreaLayoutGuide = [view5 safeAreaLayoutGuide];
        topAnchor2 = [safeAreaLayoutGuide topAnchor];
        v28 = [topAnchor constraintEqualToAnchor:topAnchor2 constant:0.0];
        [(CKChatController *)self setCatchUpButtonTopConstraint:v28];

        catchUpButtonTopConstraint = [(CKChatController *)self catchUpButtonTopConstraint];
        [catchUpButtonTopConstraint setActive:1];

        objc_destroyWeak(&v39);
        objc_destroyWeak(&location);
      }

      [(CKChatController *)self _currentlyVisibleBannerHeight];
      v31 = v30;
      catchUpButtonTopConstraint2 = [(CKChatController *)self catchUpButtonTopConstraint];
      [catchUpButtonTopConstraint2 setConstant:v31];

      catchUpButton7 = [(CKChatController *)self catchUpButton];
      [catchUpButton7 setNeedsUpdateConstraints];

      view6 = [(CKChatController *)self view];
      catchUpButton8 = [(CKChatController *)self catchUpButton];
      [view6 bringSubviewToFront:catchUpButton8];

      catchUpButtonManager = [(CKChatController *)self catchUpButtonManager];
      [catchUpButtonManager animateInResumingFromBackground:backgroundCopy];
    }

    else
    {

      [(CKChatController *)self _hideCatchUpButtonIfNeededAndRemoveOnCompletion:1];
    }
  }
}

void __69__CKChatController__showCatchUpButtonIfNeededResumingFromBackground___block_invoke(uint64_t a1)
{
  WeakRetained = objc_loadWeakRetained((a1 + 32));
  [WeakRetained _catchUpButtonTapped];
}

- (void)_hideCatchUpButtonIfNeededAndRemoveOnCompletion:(BOOL)completion
{
  completionCopy = completion;
  catchUpButton = [(CKChatController *)self catchUpButton];

  if (catchUpButton)
  {
    if (completionCopy)
    {
      objc_initWeak(&location, self);
      aBlock[0] = MEMORY[0x1E69E9820];
      aBlock[1] = 3221225472;
      aBlock[2] = __68__CKChatController__hideCatchUpButtonIfNeededAndRemoveOnCompletion___block_invoke;
      aBlock[3] = &unk_1E72EC460;
      objc_copyWeak(&v10, &location);
      v6 = _Block_copy(aBlock);
      catchUpButtonManager = [(CKChatController *)self catchUpButtonManager];
      [catchUpButtonManager animateOutWithCompletion:v6];

      objc_destroyWeak(&v10);
      objc_destroyWeak(&location);
    }

    else
    {
      catchUpButtonManager2 = [(CKChatController *)self catchUpButtonManager];
      [catchUpButtonManager2 animateOutWithCompletion:0];
    }
  }

  else
  {
    [(CKChatController *)self setIndexPathForFirstUnreadMessage:0];

    [(CKChatController *)self setFirstUnreadMessageGUID:0];
  }
}

void __68__CKChatController__hideCatchUpButtonIfNeededAndRemoveOnCompletion___block_invoke(uint64_t a1)
{
  WeakRetained = objc_loadWeakRetained((a1 + 32));
  v3 = [WeakRetained catchUpButtonManager];
  v10 = [v3 catchUpButtonHost];

  [v10 willMoveToParentViewController:0];
  v4 = [v10 view];
  [v4 removeFromSuperview];

  [v10 removeFromParentViewController];
  v5 = objc_loadWeakRetained((a1 + 32));
  [v5 setCatchUpButton:0];

  v6 = objc_loadWeakRetained((a1 + 32));
  [v6 setCatchUpButtonManager:0];

  v7 = objc_loadWeakRetained((a1 + 32));
  [v7 setIsCatchUpButtonNeededOnFirstLoad:0];

  v8 = objc_loadWeakRetained((a1 + 32));
  [v8 setIndexPathForFirstUnreadMessage:0];

  v9 = objc_loadWeakRetained((a1 + 32));
  [v9 setFirstUnreadMessageGUID:0];
}

- (double)_currentlyVisibleBannerHeight
{
  suggestionBannerView = [(CKChatController *)self suggestionBannerView];

  if (suggestionBannerView)
  {
    suggestionBannerView2 = [(CKChatController *)self suggestionBannerView];
    [suggestionBannerView2 frame];
    v6 = v5;

    v7 = fmax(v6, 0.0);
  }

  else
  {
    v7 = 0.0;
  }

  nicknameBanner = [(CKChatController *)self nicknameBanner];

  if (nicknameBanner)
  {
    nicknameBanner2 = [(CKChatController *)self nicknameBanner];
    [nicknameBanner2 frame];
    v11 = v10;

    if (v7 < v11)
    {
      v7 = v11;
    }
  }

  groupPhotoUpdateBanner = [(CKChatController *)self groupPhotoUpdateBanner];

  if (groupPhotoUpdateBanner)
  {
    groupPhotoUpdateBanner2 = [(CKChatController *)self groupPhotoUpdateBanner];
    [groupPhotoUpdateBanner2 frame];
    v15 = v14;

    if (v7 < v15)
    {
      v7 = v15;
    }
  }

  acceptedContactBanner = [(CKChatController *)self acceptedContactBanner];

  if (acceptedContactBanner)
  {
    acceptedContactBanner2 = [(CKChatController *)self acceptedContactBanner];
    [acceptedContactBanner2 frame];
    v19 = v18;

    if (v7 < v19)
    {
      return v19;
    }
  }

  return v7;
}

- (void)handleContentSizeCategoryDidChangeNotification:(id)notification
{
  v5.receiver = self;
  v5.super_class = CKChatController;
  [(CKCoreChatController *)&v5 handleContentSizeCategoryDidChangeNotification:notification];
  [(CKChatController *)self _showCatchUpButtonIfNeeded];
  collectionViewController = [(CKCoreChatController *)self collectionViewController];
  [collectionViewController setNeedsChatItemLayoutInvalidation];
}

- (void)_catchUpButtonTapped
{
  collectionViewController = [(CKCoreChatController *)self collectionViewController];
  collectionView = [collectionViewController collectionView];
  [collectionView setTranscriptScrollIntent:2];
  v4 = [CKTranscriptHighlightedMessageScrollContext alloc];
  firstUnreadMessageGUID = [(CKChatController *)self firstUnreadMessageGUID];
  v6 = [(CKTranscriptHighlightedMessageScrollContext *)v4 initWithMessageGUID:firstUnreadMessageGUID messagePartIndex:0x7FFFFFFFFFFFFFFFLL viewToAlignWith:0 allowOverScroll:0 scrollPosition:1];
  [collectionView setHighlightedMessageScrollContext:v6];

  [collectionView beginDisablingTranscriptDynamicsForReason:14];
  [(CKChatController *)self contentOffsetForFirstUnreadMessage];
  v8 = v7;
  v10 = v9;
  if (_catchUpDecelerationAnimation_onceToken != -1)
  {
    [CKChatController _catchUpButtonTapped];
  }

  [collectionView _setContentOffset:1 animated:1 animationCurve:0 animationAdjustsForContentOffsetDelta:_catchUpDecelerationAnimation_spring animation:{v8, v10}];
  [collectionView endDisablingTranscriptDynamicsForReason:14];
  collectionViewController2 = [(CKCoreChatController *)self collectionViewController];
  [collectionViewController2 highlightItemAtIndexPathWhenDisplayed:self->_indexPathForFirstUnreadMessage animated:1 autoDismiss:1];

  [(CKChatController *)self _hideCatchUpButtonIfNeededAndRemoveOnCompletion:1];
}

- (void)_updateIndexPathForFirstUnreadMessage
{
  v21 = *MEMORY[0x1E69E9840];
  if (CKIsCatchUpEnabled())
  {
    firstUnreadMessageGUID = [(CKChatController *)self firstUnreadMessageGUID];

    if (!firstUnreadMessageGUID)
    {
      chat = [(CKCoreChatController *)self chat];
      firstUnreadMessageItem = [chat firstUnreadMessageItem];

      guid = [firstUnreadMessageItem guid];
      [(CKChatController *)self setFirstUnreadMessageGUID:guid];
    }

    firstUnreadMessageGUID2 = [(CKChatController *)self firstUnreadMessageGUID];
    if (firstUnreadMessageGUID2)
    {
      if (IMOSLoggingEnabled())
      {
        v8 = OSLogHandleForIMFoundationCategory();
        if (os_log_type_enabled(v8, OS_LOG_TYPE_INFO))
        {
          v17 = 138412290;
          v18 = firstUnreadMessageGUID2;
          _os_log_impl(&dword_19020E000, v8, OS_LOG_TYPE_INFO, "Determined first unread message GUID %@", &v17, 0xCu);
        }
      }

      collectionViewController = [(CKCoreChatController *)self collectionViewController];
      chatItems = [collectionViewController chatItems];
      v11 = [chatItems __ck_catchUpScrollTargetForMessageGUID:firstUnreadMessageGUID2];
      v13 = v12;

      if (v11 != 0x7FFFFFFFFFFFFFFFLL)
      {
        v14 = [MEMORY[0x1E696AC88] indexPathForItem:v13 inSection:0];
        v15 = [MEMORY[0x1E696AC88] indexPathForItem:v11 inSection:0];
        if (v14)
        {
          [(CKCoreChatController *)self contentOffsetForIndexPath:v14 viewToAlignWith:0 allowOverScroll:0 scrollPosition:1];
          [(CKChatController *)self setContentOffsetForFirstUnreadMessage:?];
        }

        if (v15)
        {
          [(CKChatController *)self setIndexPathForFirstUnreadMessage:v15];
        }

        if (IMOSLoggingEnabled())
        {
          v16 = OSLogHandleForIMFoundationCategory();
          if (os_log_type_enabled(v16, OS_LOG_TYPE_INFO))
          {
            v17 = 138412546;
            v18 = v14;
            v19 = 2112;
            v20 = v15;
            _os_log_impl(&dword_19020E000, v16, OS_LOG_TYPE_INFO, "Determined index path for first unread message: scrollTarget(%@) and highlightTarget(%@)", &v17, 0x16u);
          }
        }
      }
    }
  }
}

- (void)_updateCatchUpButtonVisibilityResumingFromBackground:(BOOL)background
{
  backgroundCopy = background;
  v66 = *MEMORY[0x1E69E9840];
  if (CKIsCatchUpEnabled() && ![(CKChatController *)self didComputeInitiallyVisibleIndexPaths])
  {
    v47 = backgroundCopy;
    collectionView = [(CKChatController *)self collectionView];
    [collectionView bounds];
    v6 = v5;
    v8 = v7;
    v10 = v9;
    obja = v11;
    [(CKScrollViewController *)self computedInsets];
    v13 = v12;
    v15 = v14;
    v17 = v16;
    v19 = v18;
    [(CKChatController *)self _currentlyVisibleBannerHeight];
    v21 = v20;
    collectionViewLayout = [collectionView collectionViewLayout];
    v49 = [collectionViewLayout layoutAttributesForElementsInRect:{v6 + v15, v8 + v13 + v21, v10 - (v15 + v19), *&obja - (v17 + v13 + v21)}];
    [(CKChatController *)self setDidComputeInitiallyVisibleIndexPaths:1];
    [(CKChatController *)self _updateIndexPathForFirstUnreadMessage];
    indexPathForFirstUnreadMessage = [(CKChatController *)self indexPathForFirstUnreadMessage];
    if (indexPathForFirstUnreadMessage)
    {
      v22 = [collectionView numberOfItemsInSection:0];
      if ([indexPathForFirstUnreadMessage item] <= v22)
      {
        [(CKChatController *)self setIsCatchUpButtonNeededOnFirstLoad:1];
        v25 = objc_alloc_init(MEMORY[0x1E695DF70]);
        v59 = 0u;
        v60 = 0u;
        v61 = 0u;
        v62 = 0u;
        v26 = v49;
        v27 = 0;
        v28 = [v26 countByEnumeratingWithState:&v59 objects:v65 count:16];
        if (v28)
        {
          v29 = *v60;
          do
          {
            for (i = 0; i != v28; ++i)
            {
              if (*v60 != v29)
              {
                objc_enumerationMutation(v26);
              }

              v31 = *(*(&v59 + 1) + 8 * i);
              indexPath = [v31 indexPath];
              [v25 addObject:indexPath];

              indexPathForFirstUnreadMessage2 = [(CKChatController *)self indexPathForFirstUnreadMessage];
              indexPath2 = [v31 indexPath];
              LOBYTE(indexPath) = [indexPathForFirstUnreadMessage2 isEqual:indexPath2];

              v27 |= indexPath;
            }

            v28 = [v26 countByEnumeratingWithState:&v59 objects:v65 count:16];
          }

          while (v28);
        }

        collectionViewController = [(CKCoreChatController *)self collectionViewController];
        chatItems = [collectionViewController chatItems];

        v36 = [v25 count];
        if ([chatItems count] <= v36)
        {
          v37 = chatItems;
        }

        else
        {
          v37 = [chatItems subarrayWithRange:{objc_msgSend(chatItems, "count") - v36, v36}];
        }

        v57 = 0u;
        v58 = 0u;
        v55 = 0u;
        v56 = 0u;
        obj = v37;
        v38 = [obj countByEnumeratingWithState:&v55 objects:v64 count:16];
        if (v38)
        {
          v39 = *v56;
          while (2)
          {
            for (j = 0; j != v38; ++j)
            {
              if (*v56 != v39)
              {
                objc_enumerationMutation(obj);
              }

              v41 = *(*(&v55 + 1) + 8 * j);
              objc_opt_class();
              if (objc_opt_isKindOfClass())
              {
                message = [v41 message];
                if ([message isFromMe])
                {
                  if (IMOSLoggingEnabled())
                  {
                    v46 = OSLogHandleForIMFoundationCategory();
                    if (os_log_type_enabled(v46, OS_LOG_TYPE_INFO))
                    {
                      *buf = 0;
                      _os_log_impl(&dword_19020E000, v46, OS_LOG_TYPE_INFO, "A message that I sent is visible on screen. Do not show catch up button.", buf, 2u);
                    }

LABEL_42:
                  }

LABEL_43:
                  [(CKChatController *)self setIsCatchUpButtonNeededOnFirstLoad:0];

                  goto LABEL_44;
                }

                if (v27)
                {
                  guid = [message guid];
                  firstUnreadMessageGUID = [(CKChatController *)self firstUnreadMessageGUID];
                  v45 = [guid isEqualToString:firstUnreadMessageGUID];

                  if (v45)
                  {
                    if (IMOSLoggingEnabled())
                    {
                      v46 = OSLogHandleForIMFoundationCategory();
                      if (os_log_type_enabled(v46, OS_LOG_TYPE_INFO))
                      {
                        *buf = 0;
                        _os_log_impl(&dword_19020E000, v46, OS_LOG_TYPE_INFO, "First unread message is visible on screen. Do not show catch up button.", buf, 2u);
                      }

                      goto LABEL_42;
                    }

                    goto LABEL_43;
                  }
                }
              }
            }

            v38 = [obj countByEnumeratingWithState:&v55 objects:v64 count:16];
            if (v38)
            {
              continue;
            }

            break;
          }
        }

LABEL_44:

        [(CKChatController *)self _showCatchUpButtonIfNeededResumingFromBackground:v47];
      }

      else
      {
        [(CKChatController *)self setIsCatchUpButtonNeededOnFirstLoad:0];
        v23 = IMLogHandleForCategory();
        if (os_log_type_enabled(v23, OS_LOG_TYPE_ERROR))
        {
          [CKChatController _updateCatchUpButtonVisibilityResumingFromBackground:indexPathForFirstUnreadMessage];
        }
      }
    }

    else if (IMOSLoggingEnabled())
    {
      v24 = OSLogHandleForIMFoundationCategory();
      if (os_log_type_enabled(v24, OS_LOG_TYPE_INFO))
      {
        *buf = 0;
      }
    }
  }
}

- (BOOL)_wantsCatchUpAffordance
{
  v3 = CKIsCatchUpEnabled();
  if (v3)
  {
    tipManager = [(CKChatController *)self tipManager];
    presentingTopAlignedTip = [tipManager presentingTopAlignedTip];

    if (presentingTopAlignedTip)
    {
      goto LABEL_3;
    }

    catchUpButton = [(CKChatController *)self catchUpButton];

    if (catchUpButton)
    {
      LOBYTE(v3) = 1;
      return v3;
    }

    indexPathForFirstUnreadMessage = [(CKChatController *)self indexPathForFirstUnreadMessage];

    if (!indexPathForFirstUnreadMessage)
    {
LABEL_3:
      LOBYTE(v3) = 0;
    }

    else
    {

      LOBYTE(v3) = [(CKChatController *)self isCatchUpButtonNeededOnFirstLoad];
    }
  }

  return v3;
}

- (BOOL)isSafeToMarkAsRead
{
  conversation = [(CKCoreChatController *)self conversation];
  chat = [conversation chat];

  if (chat && ![chat allowedByScreenTime])
  {
    v7 = 0;
  }

  else
  {
    v9.receiver = self;
    v9.super_class = CKChatController;
    isSafeToMarkAsRead = [(CKCoreChatController *)&v9 isSafeToMarkAsRead];
    if (+[CKStarkManager isCarPlayConnected])
    {
      v6 = !CKIsScreenLocked();
    }

    else
    {
      LOBYTE(v6) = 1;
    }

    v7 = isSafeToMarkAsRead & v6;
  }

  return v7;
}

- (void)_markAsReadIfNecessary
{
  v4.receiver = self;
  v4.super_class = CKChatController;
  [(CKCoreChatController *)&v4 _markAsReadIfNecessary];
  if ([(CKChatController *)self isSafeToMarkAsRead])
  {
    if (![(CKChatController *)self _shouldShowReadReceiptAlert])
    {
      if (CKIsRunningUnitTests())
      {
        [(CKChatController *)self _askToTurnOnSMSRelayIfNeeded];
      }

      else
      {
        [(CKChatController *)self performSelector:sel__askToTurnOnSMSRelayIfNeeded withObject:0 afterDelay:2.0];
      }
    }

    catchUpButton = [(CKChatController *)self catchUpButton];

    if (catchUpButton)
    {
      [(CKChatController *)self _updateIndexPathForFirstUnreadMessage];
    }

    [(CKChatController *)self _askToTurnOnReadReceiptsIfNeeded];
  }
}

- (void)_markVisibleMentionsAsRead
{
  v34 = *MEMORY[0x1E69E9840];
  array = [MEMORY[0x1E695DF70] array];
  collectionViewController = [(CKCoreChatController *)self collectionViewController];
  chatItems = [collectionViewController chatItems];

  if ([chatItems count])
  {
    collectionView = [(CKChatController *)self collectionView];
    indexPathsForVisibleItems = [collectionView indexPathsForVisibleItems];

    v30 = 0u;
    v31 = 0u;
    v28 = 0u;
    v29 = 0u;
    v8 = indexPathsForVisibleItems;
    v9 = [v8 countByEnumeratingWithState:&v28 objects:v33 count:16];
    if (v9)
    {
      v10 = v9;
      v11 = *v29;
      do
      {
        v12 = 0;
        do
        {
          if (*v29 != v11)
          {
            objc_enumerationMutation(v8);
          }

          item = [*(*(&v28 + 1) + 8 * v12) item];
          if (item < [chatItems count])
          {
            v14 = [chatItems objectAtIndex:item];
            objc_opt_class();
            if (objc_opt_isKindOfClass())
            {
              message = [v14 message];
              if ([message hasMention])
              {
                [array addObject:message];
              }
            }
          }

          ++v12;
        }

        while (v10 != v12);
        v10 = [v8 countByEnumeratingWithState:&v28 objects:v33 count:16];
      }

      while (v10);
    }
  }

  v26 = 0u;
  v27 = 0u;
  v24 = 0u;
  v25 = 0u;
  v16 = array;
  v17 = [v16 countByEnumeratingWithState:&v24 objects:v32 count:16];
  if (v17)
  {
    v18 = v17;
    v19 = *v25;
    do
    {
      v20 = 0;
      do
      {
        if (*v25 != v19)
        {
          objc_enumerationMutation(v16);
        }

        v21 = *(*(&v24 + 1) + 8 * v20);
        chat = [(CKCoreChatController *)self chat];
        guid = [v21 guid];
        [chat removeMentionMessageGUID:guid];

        ++v20;
      }

      while (v18 != v20);
      v18 = [v16 countByEnumeratingWithState:&v24 objects:v32 count:16];
    }

    while (v18);
  }
}

- (void)_retryGroupPhotoUploadIfNecessary
{
  chat = [(CKCoreChatController *)self chat];
  [chat retryGroupPhotoUploadIfNecessary];
}

- (CGRect)salientTranscriptBackgroundRect
{
  v30.receiver = self;
  v30.super_class = CKChatController;
  [(CKCoreChatController *)&v30 salientTranscriptBackgroundRect];
  v4 = v3;
  v6 = v5;
  v8 = v7;
  [(CKChatController *)self _currentlyVisibleBannerHeight];
  v10 = v9;
  if ([(CKScrollViewController *)self isKeyboardVisible])
  {
    collectionView = [(CKChatController *)self collectionView];
    [collectionView adjustedContentInset];
    v13 = v12;
    v15 = v14;
  }

  else
  {
    [(CKScrollViewController *)self computedInsets];
    v13 = v16;
    v15 = v17;
  }

  v18 = v10 + v13;
  v19 = v8 - v18;
  v20 = +[CKUIBehavior sharedBehaviors];
  entryViewlayoutMetrics = [v20 entryViewlayoutMetrics];
  [entryViewlayoutMetrics defaultEntryViewHeight];
  v23 = v22;

  entryView = [(CKChatController *)self entryView];
  [entryView bounds];
  v25 = v19 - (v23 + v15 - CGRectGetHeight(v31));

  v26 = v4;
  v27 = v18;
  v28 = v6;
  v29 = v25;
  result.size.height = v29;
  result.size.width = v28;
  result.origin.y = v27;
  result.origin.x = v26;
  return result;
}

- (void)_retryTranscriptBackgroundUploadIfNecessary
{
  conversation = [(CKCoreChatController *)self conversation];
  v4[0] = MEMORY[0x1E69E9820];
  v4[1] = 3221225472;
  v4[2] = __63__CKChatController__retryTranscriptBackgroundUploadIfNecessary__block_invoke;
  v4[3] = &unk_1E72EB9C8;
  v4[4] = self;
  [conversation generateMissingWatchAssetIfNecessaryWithCompletion:v4];
}

void __63__CKChatController__retryTranscriptBackgroundUploadIfNecessary__block_invoke(uint64_t a1)
{
  v1 = [*(a1 + 32) chat];
  [v1 retryTranscriptBackgroundUploadIfNecessary];
}

- (BOOL)_shouldShowReadReceiptAlert
{
  v34 = *MEMORY[0x1E69E9840];
  conversation = [(CKCoreChatController *)self conversation];
  chat = [conversation chat];
  lastIncomingMessage = [chat lastIncomingMessage];

  v5 = CKReadReceiptSettingsConfirmed();
  v6 = CKReadReceiptsEnabled();
  __ck_service = [lastIncomingMessage __ck_service];
  v8 = [__ck_service supportsCapability:*MEMORY[0x1E69A7A08]];

  isRead = [lastIncomingMessage isRead];
  v19 = 0u;
  v20 = 0u;
  v21 = 0u;
  v22 = 0u;
  mEMORY[0x1E69A5A80] = [MEMORY[0x1E69A5A80] sharedInstance];
  __ck_service2 = [lastIncomingMessage __ck_service];
  v12 = [mEMORY[0x1E69A5A80] accountsForService:__ck_service2];

  v13 = [v12 countByEnumeratingWithState:&v19 objects:v33 count:16];
  if (v13)
  {
    v14 = *v20;
    while (2)
    {
      for (i = 0; i != v13; ++i)
      {
        if (*v20 != v14)
        {
          objc_enumerationMutation(v12);
        }

        if ([*(*(&v19 + 1) + 8 * i) _isUsableForSending])
        {
          LODWORD(v13) = 1;
          goto LABEL_11;
        }
      }

      v13 = [v12 countByEnumeratingWithState:&v19 objects:v33 count:16];
      if (v13)
      {
        continue;
      }

      break;
    }
  }

LABEL_11:

  v16 = isRead ^ 1;
  if (IMOSLoggingEnabled())
  {
    v17 = OSLogHandleForIMFoundationCategory();
    if (os_log_type_enabled(v17, OS_LOG_TYPE_INFO))
    {
      *buf = 67110144;
      v24 = v13;
      v25 = 1024;
      v26 = !v5;
      v27 = 1024;
      v28 = !v6;
      v29 = 1024;
      v30 = v8;
      v31 = 1024;
      v32 = v16;
      _os_log_impl(&dword_19020E000, v17, OS_LOG_TYPE_INFO, "lastMessageServiceIsActive: %{BOOL}d, readReceiptSettingsNotConfirmed: %{BOOL}d, readReceiptSettingsNotEnabled: %{BOOL}d, lastSupportsReadReceipts: %{BOOL}d, lastMessageNotRead: %{BOOL}d", buf, 0x20u);
    }
  }

  return ((v13 ^ 1 | (v5 || v6)) ^ 1) & v8 & v16 & 1;
}

- (void)_askToTurnOnReadReceiptsIfNeeded
{
  if ([(CKChatController *)self _shouldShowReadReceiptAlert])
  {
    CKSetReadReceiptSettingsConfirmed(1);
    if (CKIsRunningUnitTests())
    {

      [(CKChatController *)self _confirmReadReceiptSettings];
    }

    else
    {
      [MEMORY[0x1E69E58C0] cancelPreviousPerformRequestsWithTarget:self selector:sel__confirmReadReceiptSettings object:0];

      [(CKChatController *)self performSelector:sel__confirmReadReceiptSettings withObject:0 afterDelay:2.0];
    }
  }
}

- (void)_confirmReadReceiptSettings
{
  v3 = CKFrameworkBundle();
  v4 = [v3 localizedStringForKey:@"READ_RECEIPTS_SETTINGS_CONFIRM_TITLE" value:&stru_1F04268F8 table:@"ChatKit"];
  v5 = CKFrameworkBundle();
  v6 = [v5 localizedStringForKey:@"READ_RECEIPTS_SETTINGS_CONFIRM_MESSAGE" value:&stru_1F04268F8 table:@"ChatKit"];
  v7 = [CKAlertController alertControllerWithTitle:v4 message:v6 preferredStyle:1];

  aBlock[0] = MEMORY[0x1E69E9820];
  aBlock[1] = 3221225472;
  aBlock[2] = __47__CKChatController__confirmReadReceiptSettings__block_invoke;
  aBlock[3] = &unk_1E72EBA18;
  aBlock[4] = self;
  v8 = _Block_copy(aBlock);
  v9 = CKFrameworkBundle();
  v10 = [v9 localizedStringForKey:@"NOT_NOW" value:&stru_1F04268F8 table:@"ChatKit"];
  v19[0] = MEMORY[0x1E69E9820];
  v19[1] = 3221225472;
  v19[2] = __47__CKChatController__confirmReadReceiptSettings__block_invoke_2;
  v19[3] = &unk_1E72EC218;
  v11 = v8;
  v20 = v11;
  v12 = [CKAlertAction actionWithTitle:v10 style:1 handler:v19];
  [v7 addAction:v12];

  v13 = CKFrameworkBundle();
  v14 = [v13 localizedStringForKey:@"ALLOW" value:&stru_1F04268F8 table:@"ChatKit"];
  v17[0] = MEMORY[0x1E69E9820];
  v17[1] = 3221225472;
  v17[2] = __47__CKChatController__confirmReadReceiptSettings__block_invoke_3;
  v17[3] = &unk_1E72EC218;
  v18 = v11;
  v15 = v11;
  v16 = [CKAlertAction actionWithTitle:v14 style:0 handler:v17];
  [v7 addAction:v16];

  [v7 presentFromViewController:self animated:1 completion:0];
}

void __47__CKChatController__confirmReadReceiptSettings__block_invoke(uint64_t a1)
{
  [*(a1 + 32) _askToTurnOnReadReceiptsIfNeeded];
  v2 = +[CKUIBehavior sharedBehaviors];
  v3 = [v2 canPresentOverKeyboard];

  if ((v3 & 1) == 0)
  {
    v4 = *(a1 + 32);

    [v4 becomeFirstResponder];
  }
}

uint64_t __47__CKChatController__confirmReadReceiptSettings__block_invoke_3(uint64_t a1)
{
  CKSetReadReceiptsEnabled(1);
  v2 = *(*(a1 + 32) + 16);

  return v2();
}

- (void)_askToTurnOnSMSRelayIfNeeded
{
  smsService = [MEMORY[0x1E69A5CA0] smsService];
  v4 = IMPreferredAccountForService();

  mEMORY[0x1E699BE70] = [MEMORY[0x1E699BE70] sharedInstance];
  supportsMMS = [mEMORY[0x1E699BE70] supportsMMS];

  if ((CKSMSRelaySettingsConfirmed() & 1) == 0)
  {
    conversation = [(CKCoreChatController *)self conversation];
    if (supportsMMS & 1 | (([conversation eligibleToSendWithMadrid] & 1) == 0) || (objc_msgSend(v4, "isSMSRelayCapable") & 1) == 0)
    {
    }

    else
    {
      allowsSMSRelay = [v4 allowsSMSRelay];

      if ((allowsSMSRelay & 1) == 0)
      {
        [MEMORY[0x1E69E58C0] cancelPreviousPerformRequestsWithTarget:self selector:sel__askToTurnOnSMSRelayIfNeeded object:0];
        CKSetSMSRelaySettingsConfirmed(1);
        v9 = +[CKUIBehavior sharedBehaviors];
        canPresentOverKeyboard = [v9 canPresentOverKeyboard];

        if (CKIsRunningInMacCatalyst())
        {
          v10 = CKFrameworkBundle();
          v11 = [v10 localizedStringForKey:@"SMS_RELAY_ALERT_TITLE_MAC" value:&stru_1F04268F8 table:@"ChatKit"];
        }

        else
        {
          v12 = MEMORY[0x1E696AEC0];
          v13 = CKFrameworkBundle();
          v14 = [v13 localizedStringForKey:@"SMS_RELAY_ALERT_TITLE" value:&stru_1F04268F8 table:@"ChatKit"];
          currentDevice = [MEMORY[0x1E69DC938] currentDevice];
          localizedModel = [currentDevice localizedModel];
          v10 = [v12 stringWithFormat:v14, localizedModel];

          mEMORY[0x1E69DC668] = [MEMORY[0x1E69DC668] sharedApplication];
          userInterfaceLayoutDirection = [mEMORY[0x1E69DC668] userInterfaceLayoutDirection];

          if (userInterfaceLayoutDirection == 1)
          {
            v19 = @"\u200F";
          }

          else
          {
            v19 = @"\u200E";
          }

          v11 = [(__CFString *)v19 stringByAppendingString:v10];
        }

        v20 = v11;

        v21 = CKFrameworkBundle();
        v22 = [v21 localizedStringForKey:@"SMS_RELAY_ALERT_BODY" value:&stru_1F04268F8 table:@"ChatKit"];

        v30 = v22;
        v23 = [CKAlertController alertControllerWithTitle:v20 message:v22 preferredStyle:1];
        v24 = CKFrameworkBundle();
        v25 = [v24 localizedStringForKey:@"SMS_RELAY_NOT_NOW" value:&stru_1F04268F8 table:@"ChatKit"];
        v36[0] = MEMORY[0x1E69E9820];
        v36[1] = 3221225472;
        v36[2] = __48__CKChatController__askToTurnOnSMSRelayIfNeeded__block_invoke;
        v36[3] = &unk_1E72ED728;
        v37 = canPresentOverKeyboard;
        v36[4] = self;
        v26 = [CKAlertAction actionWithTitle:v25 style:0 handler:v36];
        [v23 addAction:v26];

        v27 = CKFrameworkBundle();
        v28 = [v27 localizedStringForKey:@"SMS_RELAY_TURN_ON" value:&stru_1F04268F8 table:@"ChatKit"];
        v32[0] = MEMORY[0x1E69E9820];
        v32[1] = 3221225472;
        v32[2] = __48__CKChatController__askToTurnOnSMSRelayIfNeeded__block_invoke_2;
        v32[3] = &unk_1E72ED750;
        v35 = canPresentOverKeyboard;
        v33 = v4;
        selfCopy = self;
        v29 = [CKAlertAction actionWithTitle:v28 style:0 handler:v32];
        [v23 addAction:v29];

        if ((canPresentOverKeyboard & 1) == 0)
        {
          [(CKChatController *)self setTargetFirstResponder:0];
          [(CKChatController *)self becomeFirstResponder];
        }

        [v23 presentFromViewController:self animated:1 completion:0];
      }
    }
  }
}

uint64_t __48__CKChatController__askToTurnOnSMSRelayIfNeeded__block_invoke(uint64_t result)
{
  if ((*(result + 40) & 1) == 0)
  {
    return [*(result + 32) becomeFirstResponder];
  }

  return result;
}

uint64_t __48__CKChatController__askToTurnOnSMSRelayIfNeeded__block_invoke_2(uint64_t a1)
{
  result = [*(a1 + 32) enrollSelfDeviceInSMSRelay];
  if ((*(a1 + 48) & 1) == 0)
  {
    v3 = *(a1 + 40);

    return [v3 becomeFirstResponder];
  }

  return result;
}

- (void)keyboardWillShow:(id)show
{
  showCopy = show;
  view = [(CKChatController *)self view];
  window = [view window];
  if (window)
  {
    v7 = window;
    view2 = [(CKChatController *)self view];
    window2 = [view2 window];
    mEMORY[0x1E69DC668] = [MEMORY[0x1E69DC668] sharedApplication];
    keyWindow = [mEMORY[0x1E69DC668] keyWindow];

    if (window2 != keyWindow)
    {
      goto LABEL_12;
    }
  }

  else
  {
  }

  pickerContainerAccessoryView = [(CKChatController *)self pickerContainerAccessoryView];

  if (!pickerContainerAccessoryView)
  {
    collectionView = [(CKChatController *)self collectionView];
    v30.receiver = self;
    v30.super_class = CKChatController;
    [(CKScrollViewController *)&v30 keyboardWillShow:showCopy];
    entryView = [(CKChatController *)self entryView];
    [entryView setKeyboardVisible:1];

    if (![(CKChatController *)self suppressEntryViewKeyboardNotifications])
    {
      userInfo = [showCopy userInfo];
      v16 = [userInfo objectForKeyedSubscript:*MEMORY[0x1E69DDFA0]];
      [v16 CGRectValue];
      v18 = v17;

      entryView2 = [(CKChatController *)self entryView];
      [entryView2 frame];
      v21 = v20;

      if (v18 > v21)
      {
        presentedViewController = [(CKChatController *)self presentedViewController];
        if (presentedViewController)
        {
          v23 = presentedViewController;
          entryView3 = [(CKChatController *)self entryView];
          contentView = [entryView3 contentView];
          textView = [contentView textView];
          isFirstResponder = [textView isFirstResponder];

          if (isFirstResponder)
          {
            v28 = +[CKScrollViewAnimationProperties inheritedAnimation];
            [collectionView enforceTranscriptScrollIntentWithAnimationProperties:v28];
          }
        }
      }
    }

    [collectionView beginDisablingTranscriptDynamicsForReason:2];
    [(CKChatController *)self _updateFauxKeyboardLayoutGuideIfNeededForKeyboardAppearanceNotification:showCopy];
    inputController = [(CKCoreChatController *)self inputController];
    [inputController chatControllerReceivedKeyboardWillShowNotification:showCopy];
    [(CKChatController *)self _inheritHiddenKeyboardAppearanceIfNeeded];
    [(CKChatController *)self setSuppressEntryViewKeyboardNotifications:1];
  }

LABEL_12:
}

- (void)keyboardWillHide:(id)hide
{
  hideCopy = hide;
  view = [(CKChatController *)self view];
  window = [view window];
  mEMORY[0x1E69DC668] = [MEMORY[0x1E69DC668] sharedApplication];
  keyWindow = [mEMORY[0x1E69DC668] keyWindow];

  if (window == keyWindow)
  {
    v11.receiver = self;
    v11.super_class = CKChatController;
    [(CKScrollViewController *)&v11 keyboardWillHide:hideCopy];
    entryView = [(CKChatController *)self entryView];
    [entryView setKeyboardVisible:0];

    [(CKChatController *)self _updateFauxKeyboardLayoutGuideIfNeededForKeyboardAppearanceNotification:hideCopy];
    inputController = [(CKCoreChatController *)self inputController];
    [inputController chatControllerReceivedKeyboardWillHideNotification:hideCopy];
    [(CKChatController *)self setSuppressEntryViewKeyboardNotifications:1];
  }
}

- (void)keyboardDidShow:(id)show
{
  v7.receiver = self;
  v7.super_class = CKChatController;
  showCopy = show;
  [(CKScrollViewController *)&v7 keyboardDidShow:showCopy];
  if ([(CKChatController *)self _appearState:v7.receiver]!= 3)
  {
    [(CKChatController *)self setSuppressEntryViewKeyboardNotifications:0];
  }

  inputController = [(CKCoreChatController *)self inputController];
  [inputController chatControllerReceivedKeyboardDidShowNotification:showCopy];

  collectionView = [(CKChatController *)self collectionView];
  [collectionView endDisablingTranscriptDynamicsForReason:2];
}

- (void)keyboardDidHide:(id)hide
{
  v8.receiver = self;
  v8.super_class = CKChatController;
  hideCopy = hide;
  [(CKScrollViewController *)&v8 keyboardDidHide:hideCopy];
  if ([(CKChatController *)self _appearState:v8.receiver]!= 3)
  {
    [(CKChatController *)self setSuppressEntryViewKeyboardNotifications:0];
  }

  if ([(CKChatController *)self isShowingEmojiKeyboard])
  {
    mEMORY[0x1E69DCBF0] = [MEMORY[0x1E69DCBF0] sharedInputModeController];
    savedKeyboardInputMode = [(CKChatController *)self savedKeyboardInputMode];
    [mEMORY[0x1E69DCBF0] setCurrentInputMode:savedKeyboardInputMode];
  }

  inputController = [(CKCoreChatController *)self inputController];
  [inputController chatControllerReceivedKeyboardDidHideNotification:hideCopy];
}

- (void)keyboardDidChangeFrame:(id)frame
{
  frameCopy = frame;
  pickerContainerAccessoryView = [(CKChatController *)self pickerContainerAccessoryView];

  if (!pickerContainerAccessoryView)
  {
    v6.receiver = self;
    v6.super_class = CKChatController;
    [(CKScrollViewController *)&v6 keyboardDidChangeFrame:frameCopy];
    [(CKChatController *)self _updateFauxKeyboardLayoutGuideIfNeededForKeyboardAppearanceNotification:frameCopy];
  }
}

- (CGRect)screenFrameForNotification:(id)notification
{
  notificationCopy = notification;
  if (CKIsAppCardsEnabled())
  {
    entryView = [(CKChatController *)self entryView];
    entryViewKeyboardLayoutGuide = [entryView entryViewKeyboardLayoutGuide];

    owningView = [entryViewKeyboardLayoutGuide owningView];
    [entryViewKeyboardLayoutGuide layoutFrame];
    [owningView convertRect:0 toView:?];
    v9 = v8;
    v11 = v10;
    v13 = v12;
    v15 = v14;
  }

  else
  {
    v24.receiver = self;
    v24.super_class = CKChatController;
    [(CKScrollViewController *)&v24 screenFrameForNotification:notificationCopy];
    v9 = v16;
    v11 = v17;
    v13 = v18;
    v15 = v19;
  }

  v20 = v9;
  v21 = v11;
  v22 = v13;
  v23 = v15;
  result.size.height = v23;
  result.size.width = v22;
  result.origin.y = v21;
  result.origin.x = v20;
  return result;
}

- (void)contentInsetDidChangeWithAnimationProperties:(id)properties
{
  v5.receiver = self;
  v5.super_class = CKChatController;
  [(CKCoreChatController *)&v5 contentInsetDidChangeWithAnimationProperties:properties];
  messageEditingViewController = [(CKChatController *)self messageEditingViewController];
  [messageEditingViewController transcriptContentInsetsDidChange];
}

- (BOOL)keyboardIsQuickPathing
{
  activeInstance = [MEMORY[0x1E69DCBE0] activeInstance];
  continuousPathUnderway = [activeInstance continuousPathUnderway];

  return continuousPathUnderway;
}

- (void)keyboardWillChangeFrame:(id)frame
{
  [(CKChatController *)self _updateFauxKeyboardLayoutGuideIfNeededForKeyboardAppearanceNotification:frame];

  [(CKChatController *)self updateEntryViewHeightAnimated:0];
}

- (UIEdgeInsets)bannerInsets
{
  nicknameBanner = [(CKChatController *)self nicknameBanner];

  if (nicknameBanner)
  {
    nicknameBanner2 = [(CKChatController *)self nicknameBanner];
    [nicknameBanner2 bounds];
    v6 = v5;

    v7 = 0.0;
    v8 = 0.0;
    v9 = 0.0;
  }

  else
  {
    v6 = *MEMORY[0x1E69DDCE0];
    v7 = *(MEMORY[0x1E69DDCE0] + 8);
    v8 = *(MEMORY[0x1E69DDCE0] + 16);
    v9 = *(MEMORY[0x1E69DDCE0] + 24);
  }

  v10 = v6;
  result.right = v9;
  result.bottom = v8;
  result.left = v7;
  result.top = v10;
  return result;
}

- (UIEdgeInsets)additionalSafeAreaInsets
{
  v22.receiver = self;
  v22.super_class = CKChatController;
  [(CKChatController *)&v22 additionalSafeAreaInsets];
  v4 = v3;
  v6 = v5;
  v8 = v7;
  v10 = v9;
  if (CKIsRunningInMacCatalyst())
  {
    [(CKChatController *)self preferredMacToolbarHeight];
    v12 = v11;
    v13 = +[CKUIBehavior sharedBehaviors];
    [v13 macAppKitToolbarHeight];
    v15 = v14;

    if (v12 > v15)
    {
      v16 = +[CKUIBehavior sharedBehaviors];
      [v16 macAppKitToolbarHeight];
      v4 = v12 - v17;
    }
  }

  v18 = v4;
  v19 = v6;
  v20 = v8;
  v21 = v10;
  result.right = v21;
  result.bottom = v20;
  result.left = v19;
  result.top = v18;
  return result;
}

- (UIEdgeInsets)macToolbarInsets
{
  v3 = MEMORY[0x1E69DDCE0];
  v4 = *(MEMORY[0x1E69DDCE0] + 8);
  v5 = *(MEMORY[0x1E69DDCE0] + 16);
  v6 = *(MEMORY[0x1E69DDCE0] + 24);
  v7 = +[CKUIBehavior sharedBehaviors];
  useMacToolbar = [v7 useMacToolbar];

  if (useMacToolbar)
  {
    [(CKChatController *)self preferredMacToolbarHeight];
    v10 = v9;
    v11 = +[CKUIBehavior sharedBehaviors];
    [v11 macAppKitToolbarHeight];
    if (v10 > v12)
    {
      [(CKChatController *)self preferredMacToolbarHeight];
      v15 = v16;
    }

    else
    {
      v13 = +[CKUIBehavior sharedBehaviors];
      [v13 macAppKitToolbarHeight];
      v15 = v14;
    }
  }

  else
  {
    v15 = *v3;
  }

  v17 = v15;
  v18 = v4;
  v19 = v5;
  v20 = v6;
  result.right = v20;
  result.bottom = v19;
  result.left = v18;
  result.top = v17;
  return result;
}

- (id)_animationPropertiesToUseForUpdateAfterHoldForReason:(id)reason
{
  reasonCopy = reason;
  if ([reasonCopy isEqualToString:@"ThrowAnimation"])
  {
    v4 = 0.3;
LABEL_5:
    v5 = [CKScrollViewAnimationProperties animatedWithDuration:0 animationCurve:v4];
    goto LABEL_10;
  }

  if ([reasonCopy isEqualToString:@"MainTranscriptWhileInlineReplyControllerVisible"] || !objc_msgSend(reasonCopy, "isEqualToString:", @"ViewControllerNotVisible") && !objc_msgSend(reasonCopy, "isEqualToString:", @"NotificationChatControllerFixedLayout") && !objc_msgSend(reasonCopy, "isEqualToString:", @"InlineReplyAnimateOut") && !objc_msgSend(reasonCopy, "isEqualToString:", @"ViewControllerSizeTransition"))
  {
    v4 = 0.5;
    goto LABEL_5;
  }

  v5 = +[CKScrollViewAnimationProperties unanimated];
LABEL_10:
  v6 = v5;

  return v6;
}

- (id)_animationPropertiesToUseInUpdateForReasons:(id)reasons followingHoldForReason:(id)reason
{
  v22 = *MEMORY[0x1E69E9840];
  reasonsCopy = reasons;
  reasonCopy = reason;
  activeKeyboardAppearanceAnimationProperties = [(CKScrollViewController *)self activeKeyboardAppearanceAnimationProperties];

  if (activeKeyboardAppearanceAnimationProperties)
  {
    activeKeyboardAppearanceAnimationProperties2 = [(CKScrollViewController *)self activeKeyboardAppearanceAnimationProperties];
    anyObject = IMLogHandleForCategory();
    if (os_log_type_enabled(anyObject, OS_LOG_TYPE_INFO))
    {
      v18 = 138412546;
      v19 = activeKeyboardAppearanceAnimationProperties2;
      v20 = 2112;
      v21 = reasonCopy;
      v11 = "Using active keyboard appearance animation properties %@ following hold for reason: %@";
LABEL_7:
      _os_log_impl(&dword_19020E000, anyObject, OS_LOG_TYPE_INFO, v11, &v18, 0x16u);
      goto LABEL_8;
    }

    goto LABEL_8;
  }

  if (reasonCopy)
  {
    activeKeyboardAppearanceAnimationProperties2 = [(CKChatController *)self _animationPropertiesToUseForUpdateAfterHoldForReason:reasonCopy];
    anyObject = IMLogHandleForCategory();
    if (os_log_type_enabled(anyObject, OS_LOG_TYPE_INFO))
    {
      v18 = 138412546;
      v19 = activeKeyboardAppearanceAnimationProperties2;
      v20 = 2112;
      v21 = reasonCopy;
      v11 = "Using animation properties %@ following hold for reason: %@";
      goto LABEL_7;
    }

LABEL_8:

    goto LABEL_9;
  }

  if ([reasonsCopy count] == 1)
  {
    anyObject = [reasonsCopy anyObject];
    activeKeyboardAppearanceAnimationProperties2 = [anyObject animationProperties];
    v13 = IMLogHandleForCategory();
    if (os_log_type_enabled(v13, OS_LOG_TYPE_INFO))
    {
      reasonType = [anyObject reasonType];
      v18 = 138412546;
      v19 = activeKeyboardAppearanceAnimationProperties2;
      v20 = 2112;
      v21 = reasonType;
      _os_log_impl(&dword_19020E000, v13, OS_LOG_TYPE_INFO, "Using animation properties %@ following update for reasonType: %@", &v18, 0x16u);
    }

    goto LABEL_8;
  }

  v15 = [reasonsCopy count];
  v16 = IMLogHandleForCategory();
  v17 = os_log_type_enabled(v16, OS_LOG_TYPE_ERROR);
  if (v15 < 2)
  {
    if (v17)
    {
      [CKChatController _animationPropertiesToUseInUpdateForReasons:followingHoldForReason:];
    }
  }

  else if (v17)
  {
    [CKChatController _animationPropertiesToUseInUpdateForReasons:followingHoldForReason:];
  }

  activeKeyboardAppearanceAnimationProperties2 = +[CKScrollViewAnimationProperties unanimated];
LABEL_9:

  return activeKeyboardAppearanceAnimationProperties2;
}

- (void)scrollGeometryIsUpdatingForReasons:(id)reasons followingHoldForReason:(id)reason
{
  reasonCopy = reason;
  reasonsCopy = reasons;
  v10 = [(CKChatController *)self _animationPropertiesToUseInUpdateForReasons:reasonsCopy followingHoldForReason:reasonCopy];
  v8 = [(CKScrollViewController *)self scrollGeometryContentInsetIsUpdatingForReasons:reasonsCopy followingHoldForReason:reasonCopy withAnimationProperties:?];

  if (v8)
  {
    collectionView = [(CKChatController *)self collectionView];
    [collectionView enforceTranscriptScrollIntentWithAnimationProperties:v10];
  }
}

- (id)progressBar
{
  v24[4] = *MEMORY[0x1E69E9840];
  v23.receiver = self;
  v23.super_class = CKChatController;
  progressBar = [(CKCoreChatController *)&v23 progressBar];
  _progressBarHostView = [(CKChatController *)self _progressBarHostView];
  v5 = _progressBarHostView;
  if (progressBar)
  {
    v6 = _progressBarHostView == 0;
  }

  else
  {
    v6 = 1;
  }

  if (!v6)
  {
    superview = [progressBar superview];

    if (superview != v5)
    {
      [progressBar removeFromSuperview];
      [v5 addSubview:progressBar];
      [progressBar setTranslatesAutoresizingMaskIntoConstraints:0];
      v18 = MEMORY[0x1E696ACD8];
      leadingAnchor = [progressBar leadingAnchor];
      leadingAnchor2 = [v5 leadingAnchor];
      v20 = [leadingAnchor constraintEqualToAnchor:leadingAnchor2];
      v24[0] = v20;
      trailingAnchor = [progressBar trailingAnchor];
      trailingAnchor2 = [v5 trailingAnchor];
      v9 = [trailingAnchor constraintEqualToAnchor:trailingAnchor2];
      v24[1] = v9;
      bottomAnchor = [progressBar bottomAnchor];
      bottomAnchor2 = [v5 bottomAnchor];
      v12 = [bottomAnchor constraintEqualToAnchor:bottomAnchor2];
      v24[2] = v12;
      heightAnchor = [progressBar heightAnchor];
      [progressBar frame];
      v15 = [heightAnchor constraintEqualToConstant:v14];
      v24[3] = v15;
      v16 = [MEMORY[0x1E695DEC8] arrayWithObjects:v24 count:4];
      [v18 activateConstraints:v16];

      [v5 setNeedsLayout];
      [v5 layoutIfNeeded];
    }
  }

  return progressBar;
}

- (void)updateSendProgress:(double)progress progressColor:(id)color animation:(id)animation
{
  animationCopy = animation;
  v10 = [_TtC7ChatKit29TranscriptNavigationBarChange sendProgressChange:color color:progress];
  transcriptNavigationBarController = [(CKChatController *)self transcriptNavigationBarController];
  [transcriptNavigationBarController applyChange:v10 animation:animationCopy];
}

- (id)_progressBarHostView
{
  if (CKIsRunningInMacCatalyst())
  {
    macRecipientsController = [(CKChatController *)self macRecipientsController];
    view = [macRecipientsController view];
  }

  else
  {
    navigationItem = [(CKChatController *)self navigationItem];
    macRecipientsController = [navigationItem navigationBar];

    objc_opt_class();
    if (objc_opt_isKindOfClass())
    {
      navigationItem2 = [(CKChatController *)self navigationItem];
      titleView = [navigationItem2 titleView];

      goto LABEL_7;
    }

    view = [macRecipientsController _backgroundView];
  }

  titleView = view;
LABEL_7:

  return titleView;
}

- (void)_updateTitleAnimated:(BOOL)animated
{
  v6.receiver = self;
  v6.super_class = CKChatController;
  [(CKCoreChatController *)&v6 _updateTitleAnimated:animated];
  transcriptNavigationBarController = [(CKChatController *)self transcriptNavigationBarController];
  v5 = +[_TtC7ChatKit29TranscriptNavigationBarChange conversationTitleChange];
  [transcriptNavigationBarController applyChange:v5];
}

- (void)_updatePollSuggestionAvailability
{
  entryView = [(CKChatController *)self entryView];
  [entryView updateAllowPollSuggestions];
}

- (void)_setTitle:(id)title animated:(BOOL)animated
{
  titleCopy = title;
  conversation = [(CKCoreChatController *)self conversation];
  chat = [conversation chat];
  v7 = [chat valueForChatProperty:*MEMORY[0x1E69A5D50]];
  if ([v7 BOOLValue])
  {
    conversation2 = [(CKCoreChatController *)self conversation];
    chat2 = [conversation2 chat];
    v10 = [chat2 isFiltered] != 0;
  }

  else
  {
    v10 = 0;
  }

  conversation3 = [(CKCoreChatController *)self conversation];
  if ([conversation3 wasDetectedAsSMSSpam])
  {
    v12 = !+[CKConversation isSMSSpamFilteringEnabled];
  }

  else
  {
    LOBYTE(v12) = 0;
  }

  conversation4 = [(CKCoreChatController *)self conversation];
  chat3 = [conversation4 chat];
  if (([chat3 isRecovered] & 1) == 0)
  {

    if (((v10 | v12) & 1) == 0)
    {
      goto LABEL_14;
    }

    v15 = MEMORY[0x1E696AEC0];
    v16 = CKFrameworkBundle();
    v17 = [v16 localizedStringForKey:@"MAYBE_JUNK" value:&stru_1F04268F8 table:@"ChatKit"];
    chat3 = [v15 stringWithFormat:v17, titleCopy];

    mEMORY[0x1E69DC668] = [MEMORY[0x1E69DC668] sharedApplication];
    userInterfaceLayoutDirection = [mEMORY[0x1E69DC668] userInterfaceLayoutDirection];

    if (userInterfaceLayoutDirection == 1)
    {
      v20 = @"\u200F";
    }

    else
    {
      v20 = @"\u200E";
    }

    [(__CFString *)v20 stringByAppendingString:chat3];
    titleCopy = conversation4 = titleCopy;
  }

LABEL_14:
}

- (void)_handleIsFilteredChange
{
  conversation = [(CKCoreChatController *)self conversation];
  [conversation setNeedsUpdatedGroupPhotoForVisualIdentity];

  [(CKChatController *)self _updateTitleAnimated:1];
}

- (void)_updateNavigationButtons
{
  v9 = *MEMORY[0x1E69E9840];
  v3 = +[_TtC7ChatKit29TranscriptNavigationBarChange barButtonsChange];
  if (IMOSLoggingEnabled())
  {
    v4 = OSLogHandleForIMFoundationCategory();
    if (os_log_type_enabled(v4, OS_LOG_TYPE_INFO))
    {
      name = [v3 name];
      v7 = 138412290;
      v8 = name;
      _os_log_impl(&dword_19020E000, v4, OS_LOG_TYPE_INFO, "Applying navigation bar configuration change {%@}", &v7, 0xCu);
    }
  }

  transcriptNavigationBarController = [(CKChatController *)self transcriptNavigationBarController];
  [transcriptNavigationBarController applyChange:v3];
}

- (BOOL)_canShowBackButtonView
{
  if (CKIsRunningInMacCatalyst() || (IMIsRunningInScreenshotTesting_IsolatedTranscriptUI() & 1) != 0)
  {
    LOBYTE(isCollapsed) = 0;
  }

  else
  {
    isCollapsed = [(CKCoreChatController *)self isCollapsed];
    if (isCollapsed)
    {
      LOBYTE(isCollapsed) = [(CKChatController *)self isEditing]^ 1;
    }
  }

  return isCollapsed;
}

- (CKNavBarUnifiedCallButton)navBarFaceTimeCallButton
{
  navBarFaceTimeCallButton = self->_navBarFaceTimeCallButton;
  if (!navBarFaceTimeCallButton)
  {
    v4 = [CKNavBarUnifiedCallButton buttonWithType:1];
    [(CKNavBarUnifiedCallButton *)v4 setDelegate:self];
    v5 = self->_navBarFaceTimeCallButton;
    self->_navBarFaceTimeCallButton = v4;

    navBarFaceTimeCallButton = self->_navBarFaceTimeCallButton;
  }

  return navBarFaceTimeCallButton;
}

- (id)currentNavigationBarBasedOnSizeClass
{
  if (CKIsRunningInMessagesTranscriptExtension() || (-[CKChatController traitCollection](self, "traitCollection"), v3 = objc_claimAutoreleasedReturnValue(), v4 = [v3 horizontalSizeClass], v3, v4 != 1))
  {
    navigationController = [(CKChatController *)self navigationController];
    navigationBar = [navigationController navigationBar];
  }

  else
  {
    navigationController = [(CKChatController *)self parentViewController];
    v5NavigationController = [navigationController navigationController];
    navigationBar = [v5NavigationController navigationBar];
  }

  return navigationBar;
}

- (BOOL)shouldShowAvatarViewInNavBarCanvas
{
  v2 = +[CKUIBehavior sharedBehaviors];
  contactPhotosEnabled = [v2 contactPhotosEnabled];

  return contactPhotosEnabled;
}

- (void)persistentMenuManager:(id)manager selectedChipAction:(id)action
{
  actionCopy = action;
  suggestedActionsHandler = [(CKChatController *)self suggestedActionsHandler];
  [suggestedActionsHandler performChipAction:actionCopy];
}

- (BOOL)shouldUseMinimumSafeAreas
{
  delegate = [(CKCoreChatController *)self delegate];
  v4 = objc_opt_respondsToSelector();

  if ((v4 & 1) == 0)
  {
    return 0;
  }

  delegate2 = [(CKCoreChatController *)self delegate];
  shouldUseMinimumSafeAreas = [delegate2 shouldUseMinimumSafeAreas];

  return shouldUseMinimumSafeAreas;
}

- (void)keyCommandToggleDetails
{
  if (CKIsRunningInMacCatalyst())
  {

    [(CKChatController *)self _detailsButtonPressed];
  }

  else
  {

    [(CKChatController *)self presentDetailsViewController];
  }
}

- (void)keyCommandToggleUnreadState
{
  chat = [(CKCoreChatController *)self chat];
  unreadMessageCount = [chat unreadMessageCount];

  chat2 = [(CKCoreChatController *)self chat];
  v6 = chat2;
  if (unreadMessageCount)
  {
    [chat2 markAllMessagesAsRead];
  }

  else
  {
    [chat2 markLastMessageAsUnread];
  }
}

- (void)_detailsButtonPressed
{
  if (!IMIsOscarEnabled() || ![(CKChatController *)self isShowingOscarChat])
  {

    [(CKChatController *)self presentDetailsViewController];
  }
}

- (void)presentDetailsViewControllerAnimated:(BOOL)animated
{
  delegate = [(CKCoreChatController *)self delegate];
  v5 = objc_opt_respondsToSelector();

  if (v5)
  {
    delegate2 = [(CKCoreChatController *)self delegate];
    hasDetailsNavigationController = [delegate2 hasDetailsNavigationController];

    if (hasDetailsNavigationController)
    {
      delegate3 = [(CKCoreChatController *)self delegate];
      isDetailsNavigationControllerDetached = [delegate3 isDetailsNavigationControllerDetached];

      delegate4 = [(CKCoreChatController *)self delegate];
      v11 = delegate4;
      if (isDetailsNavigationControllerDetached)
      {
        [delegate4 dismissAndReopenDetailsNavigationController];
      }

      else
      {
        [delegate4 dismissDetailsNavigationController];
      }

      return;
    }
  }

  else if (!CKIsRunningInMessagesTranscriptExtension())
  {
    return;
  }

  [(CKChatController *)self _presentDetailsViewControllerAnimated:1];
}

- (void)_presentDetailsViewControllerAnimated:(BOOL)animated
{
  animatedCopy = animated;
  v46[1] = *MEMORY[0x1E69E9840];
  mEMORY[0x1E69DD0F0] = [MEMORY[0x1E69DD0F0] sharedInstance];
  [mEMORY[0x1E69DD0F0] setSupportedPayloadIds:MEMORY[0x1E695E0F0]];

  mEMORY[0x1E69DD0F0]2 = [MEMORY[0x1E69DD0F0] sharedInstance];
  [mEMORY[0x1E69DD0F0]2 setPayloadDelegate:0];

  conversation = [(CKCoreChatController *)self conversation];
  chat = [conversation chat];
  isStewieChat = [chat isStewieChat];

  if (isStewieChat)
  {
    if (!IMOSLoggingEnabled())
    {
      return;
    }

    v10 = OSLogHandleForIMFoundationCategory();
    if (os_log_type_enabled(v10, OS_LOG_TYPE_INFO))
    {
      v45[0] = 0;
      _os_log_impl(&dword_19020E000, v10, OS_LOG_TYPE_INFO, "Do not present Details view in Stewie chats", v45, 2u);
    }

    goto LABEL_5;
  }

  mEMORY[0x1E69A8070] = [MEMORY[0x1E69A8070] sharedFeatureFlags];
  isTranscriptSharingEnabled = [mEMORY[0x1E69A8070] isTranscriptSharingEnabled];

  if (!isTranscriptSharingEnabled || (-[CKCoreChatController conversation](self, "conversation"), v13 = objc_claimAutoreleasedReturnValue(), [v13 chat], v14 = objc_claimAutoreleasedReturnValue(), v15 = objc_msgSend(v14, "isStewieSharingChat"), v14, v13, !v15))
  {
    mEMORY[0x1E69A8070]2 = [MEMORY[0x1E69A8070] sharedFeatureFlags];
    isModernSplitViewControllerEnabled = [mEMORY[0x1E69A8070]2 isModernSplitViewControllerEnabled];

    if (isModernSplitViewControllerEnabled)
    {
      [(CKChatController *)self _dismissFullScreenBubbleViewControllerAnimated:0 withSendAnimation:0 completion:0];
    }

    mEMORY[0x1E69A8070]3 = [MEMORY[0x1E69A8070] sharedFeatureFlags];
    isRedesignedDetailsViewEnabled = [mEMORY[0x1E69A8070]3 isRedesignedDetailsViewEnabled];

    if (!isRedesignedDetailsViewEnabled)
    {
      goto LABEL_23;
    }

    mEMORY[0x1E69A8070]4 = [MEMORY[0x1E69A8070] sharedFeatureFlags];
    if ([mEMORY[0x1E69A8070]4 isBIAEnabled])
    {
      conversation2 = [(CKCoreChatController *)self conversation];
      if ([conversation2 isBusinessConversation])
      {

LABEL_23:
        v24 = [CKDetailsControllerAdapter alloc];
        conversation3 = [(CKCoreChatController *)self conversation];
        v26 = [(CKDetailsControllerAdapter *)v24 initWithConversation:conversation3 delegate:self];

        detailsController = [(CKDetailsControllerAdapter *)v26 detailsController];
        mEMORY[0x1E69A8070]5 = [MEMORY[0x1E69A8070] sharedFeatureFlags];
        isModernDetailsViewEnabled = [mEMORY[0x1E69A8070]5 isModernDetailsViewEnabled];

        if (isModernDetailsViewEnabled)
        {
          conversation4 = [(CKCoreChatController *)self conversation];
          v31 = [conversation4 isBusinessConversation] ^ 1;
        }

        else
        {
          v31 = 0;
        }

        v32 = [[CKDetailsNavigationController alloc] initWithNavigationBarClass:objc_opt_class() toolbarClass:0 shouldHideNavigationBar:v31];
        [(CKDetailsNavigationController *)v32 setDetailsAdapter:v26];
        if (detailsController)
        {
          v46[0] = detailsController;
          v33 = [MEMORY[0x1E695DEC8] arrayWithObjects:v46 count:1];
          [(CKDetailsNavigationController *)v32 setViewControllers:v33];
        }

        else
        {
          [(CKDetailsNavigationController *)v32 setViewControllers:MEMORY[0x1E695E0F0]];
        }

        [(CKDetailsNavigationController *)v32 setDelegate:detailsController];
        delegate = [(CKCoreChatController *)self delegate];
        [delegate presentDetailsNavigationController:v32];

        conversation5 = [(CKCoreChatController *)self conversation];
        isBusinessConversation = [conversation5 isBusinessConversation];

        if (isBusinessConversation)
        {
          view = [(CKDetailsNavigationController *)v32 view];
          systemBackgroundColor = [MEMORY[0x1E69DC888] systemBackgroundColor];
          [view setBackgroundColor:systemBackgroundColor];
        }

        currentDevice = [MEMORY[0x1E69DC938] currentDevice];
        userInterfaceIdiom = [currentDevice userInterfaceIdiom];

        if ((userInterfaceIdiom & 0xFFFFFFFFFFFFFFFBLL) == 1)
        {
          [(CKDetailsNavigationController *)v32 setModalPresentationStyle:2];
        }

        objc_opt_class();
        if (objc_opt_isKindOfClass())
        {
          v41 = +[CKLinkIntentsManager sharedManager];
          [v41 registerDependencyWithDetailsController:detailsController];
        }

        mEMORY[0x1E69A8070]6 = [MEMORY[0x1E69A8070] sharedFeatureFlags];
        isModernSplitViewControllerEnabled2 = [mEMORY[0x1E69A8070]6 isModernSplitViewControllerEnabled];

        if (isModernSplitViewControllerEnabled2)
        {
          [(CKChatController *)self performPlatformSpecificDetailsPresentation:v32];
        }

        else
        {
          [(CKChatController *)self presentViewController:v32 animated:animatedCopy completion:0];
        }

        return;
      }

      conversation6 = [(CKCoreChatController *)self conversation];
      isChatBot = [conversation6 isChatBot];

      if (isChatBot)
      {
        goto LABEL_23;
      }
    }

    else
    {
    }

    conversation7 = [(CKCoreChatController *)self conversation];
    [(CKChatController *)self presentRedesignedDetailsViewForConversation:conversation7];

    return;
  }

  if (IMOSLoggingEnabled())
  {
    v10 = OSLogHandleForIMFoundationCategory();
    if (os_log_type_enabled(v10, OS_LOG_TYPE_INFO))
    {
      v45[0] = 0;
      _os_log_impl(&dword_19020E000, v10, OS_LOG_TYPE_INFO, "Do not present Details view in Transcript Sharing chats", v45, 2u);
    }

LABEL_5:
  }
}

- (void)_backbuttonPressed
{
  _navigationControllerToPop = [(CKChatController *)self _navigationControllerToPop];
  v2 = [_navigationControllerToPop popViewControllerAnimated:1];
}

- (id)_navigationControllerToPop
{
  if (-[CKCoreChatController isCollapsed](self, "isCollapsed") && (-[CKChatController navigationController](self, "navigationController"), v3 = objc_claimAutoreleasedReturnValue(), [v3 topViewController], v4 = objc_claimAutoreleasedReturnValue(), v4, v3, v4 == self))
  {
    navigationController = [(CKChatController *)self navigationController];
    v7NavigationController = [navigationController navigationController];
  }

  else
  {
    v7NavigationController = [(CKChatController *)self navigationController];
  }

  return v7NavigationController;
}

- (void)dismissDetailsControllerAnimated:(BOOL)animated
{
  v3[0] = MEMORY[0x1E69E9820];
  v3[1] = 3221225472;
  v3[2] = __53__CKChatController_dismissDetailsControllerAnimated___block_invoke;
  v3[3] = &unk_1E72EBA18;
  v3[4] = self;
  [(CKChatController *)self dismissViewControllerAnimated:animated completion:v3];
}

uint64_t __53__CKChatController_dismissDetailsControllerAnimated___block_invoke(uint64_t a1)
{
  v2 = +[CKLinkIntentsManager sharedManager];
  [v2 purgeDependencies];

  [*(a1 + 32) setTargetFirstResponder:1];
  v3 = *(a1 + 32);

  return [v3 becomeFirstResponder];
}

- (id)detailsViewControllerForInspector
{
  mEMORY[0x1E69A8070] = [MEMORY[0x1E69A8070] sharedFeatureFlags];
  isRedesignedDetailsViewEnabled = [mEMORY[0x1E69A8070] isRedesignedDetailsViewEnabled];

  if (!isRedesignedDetailsViewEnabled)
  {
    v7 = 0;
    goto LABEL_11;
  }

  mEMORY[0x1E69A8070]2 = [MEMORY[0x1E69A8070] sharedFeatureFlags];
  if ([mEMORY[0x1E69A8070]2 isBIAEnabled])
  {
    conversation = [(CKCoreChatController *)self conversation];
    if ([conversation isBusinessConversation])
    {

LABEL_9:
      v12 = [CKDetailsControllerAdapter alloc];
      conversation2 = [(CKCoreChatController *)self conversation];
      conversation4 = [(CKDetailsControllerAdapter *)v12 initWithConversation:conversation2 delegate:self];

      detailsController = [(CKDetailsControllerAdapter *)conversation4 detailsController];
      goto LABEL_10;
    }

    conversation3 = [(CKCoreChatController *)self conversation];
    isChatBot = [conversation3 isChatBot];

    if (isChatBot)
    {
      goto LABEL_9;
    }
  }

  else
  {
  }

  conversation4 = [(CKCoreChatController *)self conversation];
  detailsController = [(CKChatController *)self redesignedDetailsViewForConversation:conversation4];
LABEL_10:
  v7 = detailsController;

LABEL_11:

  return v7;
}

- (void)_callButtonPressed
{
  conversation = [(CKCoreChatController *)self conversation];
  chat = [conversation chat];
  conversation2 = [chat conversation];

  -[CKChatController _callButtonPressedWithVideoEnabled:](self, "_callButtonPressedWithVideoEnabled:", [MEMORY[0x1E69A5B78] conversationIsVideoCall:conversation2]);
}

- (void)_callButtonPressedWithVideoEnabled:(BOOL)enabled
{
  enabledCopy = enabled;
  conversation = [(CKCoreChatController *)self conversation];
  chat = [conversation chat];
  conversation2 = [chat conversation];

  if (conversation2)
  {
    if ([conversation2 state])
    {
      [CKFaceTimeUtilities showCallControlsForConversation:conversation2];
      goto LABEL_7;
    }

    chat2 = [(CKCoreChatController *)self chat];
    [chat2 joinExistingTUConversation];
  }

  else
  {
    chat2 = [(CKCoreChatController *)self chat];
    [chat2 initiateTUConversationWithVideoEnabled:enabledCopy];
  }

LABEL_7:
}

- (CNContactPickerViewController)contactPicker
{
  contactPicker = self->_contactPicker;
  if (!contactPicker)
  {
    v4 = objc_alloc_init(MEMORY[0x1E695D120]);
    v5 = self->_contactPicker;
    self->_contactPicker = v4;

    [(CNContactPickerViewController *)self->_contactPicker setDelegate:self];
    contactPicker = self->_contactPicker;
  }

  return contactPicker;
}

- (BOOL)canPerformAction:(SEL)action withSender:(id)sender
{
  senderCopy = sender;
  entryView = [(CKChatController *)self entryView];
  contentView = [entryView contentView];
  textView = [contentView textView];

  objc_opt_class();
  if (objc_opt_isKindOfClass())
  {
    v10 = objc_opt_new();
LABEL_5:
    [textView setPasteConfiguration:v10];

    goto LABEL_6;
  }

  objc_opt_class();
  if (objc_opt_isKindOfClass())
  {
    chat = [(CKCoreChatController *)self chat];
    v12 = [chat supportsCapabilities:0x8000];

    v13 = +[CKUIBehavior sharedBehaviors];
    v10 = [v13 pasteConfigurationDisablingKeyboardStickers:v12 ^ 1u];

    goto LABEL_5;
  }

LABEL_6:
  mEMORY[0x1E69DCC68] = [MEMORY[0x1E69DCC68] sharedMenuController];

  if (mEMORY[0x1E69DCC68] == senderCopy || textView == senderCopy)
  {
    mEMORY[0x1E69A8070] = [MEMORY[0x1E69A8070] sharedFeatureFlags];
    isTextSelectionEnabled = [mEMORY[0x1E69A8070] isTextSelectionEnabled];

    if (!isTextSelectionEnabled || sel_captureTextFromCamera_ != action || [textView isFirstResponder])
    {
      v28 = [textView canPerformAction:action withSender:senderCopy];
LABEL_22:
      v25 = v28;
      goto LABEL_23;
    }

LABEL_19:
    v25 = 0;
    goto LABEL_23;
  }

  if (sel_copy_ == action || sel_delete_ == action)
  {
    selectedChatItems = [(CKChatController *)self selectedChatItems];
    v16 = [selectedChatItems count];

    if (!v16)
    {
      goto LABEL_19;
    }
  }

  if (sel_delete_ != action)
  {
    goto LABEL_21;
  }

  selectedChatItems2 = [(CKChatController *)self selectedChatItems];
  v18 = [selectedChatItems2 count];

  if (v18 != 1)
  {
    goto LABEL_21;
  }

  selectedChatItems3 = [(CKChatController *)self selectedChatItems];
  firstObject = [selectedChatItems3 firstObject];

  collectionViewController = [(CKCoreChatController *)self collectionViewController];
  v22 = [collectionViewController balloonViewForChatItem:firstObject];

  objc_opt_class();
  if ((objc_opt_isKindOfClass() & 1) == 0)
  {

LABEL_21:
    v30.receiver = self;
    v30.super_class = CKChatController;
    v28 = [(CKChatController *)&v30 canPerformAction:action withSender:senderCopy];
    goto LABEL_22;
  }

  textView2 = [v22 textView];
  selectedTextRange = [textView2 selectedTextRange];
  v25 = selectedTextRange == 0;

LABEL_23:
  return v25;
}

- (void)registerNotifications
{
  v29.receiver = self;
  v29.super_class = CKChatController;
  [(CKCoreChatController *)&v29 registerNotifications];
  defaultCenter = [MEMORY[0x1E696AD88] defaultCenter];
  [defaultCenter addObserver:self selector:sel__applicationDidBecomeActive_ name:*MEMORY[0x1E69DDAB0] object:0];

  defaultCenter2 = [MEMORY[0x1E696AD88] defaultCenter];
  [defaultCenter2 addObserver:self selector:sel__raiseToListenSettingChanged_ name:CKPreferenceRaiseToListenDidChangeNotification object:0];

  defaultCenter3 = [MEMORY[0x1E696AD88] defaultCenter];
  [defaultCenter3 addObserver:self selector:sel__applicationWillResignActive_ name:*MEMORY[0x1E69DDBC8] object:0];

  defaultCenter4 = [MEMORY[0x1E696AD88] defaultCenter];
  [defaultCenter4 addObserver:self selector:sel__textInputModeDidChange_ name:*MEMORY[0x1E69DE688] object:0];

  defaultCenter5 = [MEMORY[0x1E696AD88] defaultCenter];
  [defaultCenter5 addObserver:self selector:sel__reduceTransparencyStatusDidChange name:*MEMORY[0x1E69DD920] object:0];

  mEMORY[0x1E69A8070] = [MEMORY[0x1E69A8070] sharedFeatureFlags];
  isIntroductionsEnabled = [mEMORY[0x1E69A8070] isIntroductionsEnabled];

  if (isIntroductionsEnabled)
  {
    defaultCenter6 = [MEMORY[0x1E696AD88] defaultCenter];
    [defaultCenter6 addObserver:self selector:sel__blockListDidChange name:*MEMORY[0x1E69A6A58] object:0];

    defaultCenter7 = [MEMORY[0x1E696AD88] defaultCenter];
    [defaultCenter7 addObserver:self selector:sel__contactsListDidChange name:*MEMORY[0x1E69A6828] object:0];
  }

  defaultCenter8 = [MEMORY[0x1E696AD88] defaultCenter];
  [defaultCenter8 addObserver:self selector:sel_inputLanguageDidChange_ name:*MEMORY[0x1E69DE6B8] object:0];

  defaultCenter9 = [MEMORY[0x1E696AD88] defaultCenter];
  [defaultCenter9 addObserver:self selector:sel_nicknameStoreDidChange_ name:*MEMORY[0x1E69A59E0] object:0];

  defaultCenter10 = [MEMORY[0x1E696AD88] defaultCenter];
  [defaultCenter10 addObserver:self selector:sel_nicknameStoreDidChange_ name:*MEMORY[0x1E69A5A10] object:0];

  defaultCenter11 = [MEMORY[0x1E696AD88] defaultCenter];
  [defaultCenter11 addObserver:self selector:sel__switchedToEmojiKeyboard_ name:*MEMORY[0x1E69DDF88] object:0];

  defaultCenter12 = [MEMORY[0x1E696AD88] defaultCenter];
  [defaultCenter12 addObserver:self selector:sel__switchedAwayFromEmojiKeyboard_ name:*MEMORY[0x1E69DDF80] object:0];

  defaultCenter13 = [MEMORY[0x1E696AD88] defaultCenter];
  [defaultCenter13 addObserver:self selector:sel__transferUpdated_ name:@"CKFileTransferUpdatedNotification" object:0];

  defaultCenter14 = [MEMORY[0x1E696AD88] defaultCenter];
  [defaultCenter14 addObserver:self selector:sel__transferCompleted_ name:@"CKFileTransferFinishedNotification" object:0];

  defaultCenter15 = [MEMORY[0x1E696AD88] defaultCenter];
  [defaultCenter15 addObserver:self selector:sel__handleContactStoreBatchLoadCompleteNotification_ name:*MEMORY[0x1E69A6E10] object:0];

  defaultCenter16 = [MEMORY[0x1E696AD88] defaultCenter];
  [defaultCenter16 addObserver:self selector:sel__updateNavigationUI name:*MEMORY[0x1E69A6838] object:0];

  defaultCenter17 = [MEMORY[0x1E696AD88] defaultCenter];
  [defaultCenter17 addObserver:self selector:sel_presentCollaborationPopoverUI name:*MEMORY[0x1E69A56C0] object:0];

  defaultCenter18 = [MEMORY[0x1E696AD88] defaultCenter];
  [defaultCenter18 addObserver:self selector:sel__updateAccountRegistrationFailureNotification name:*MEMORY[0x1E69A56B0] object:0];

  if (CKIsRunningInMessages())
  {
    if (!registerNotifications__DDDetectionControllerWillPresentActionNotification)
    {
      v23 = MEMORY[0x193AF5ED0]("DDDetectionControllerWillPresentActionNotification", @"DataDetectorsUI");
      if (v23)
      {
        v24 = *v23;
      }

      else
      {
        v24 = 0;
      }

      objc_storeStrong(&registerNotifications__DDDetectionControllerWillPresentActionNotification, v24);
    }

    if (!registerNotifications__DDDetectionControllerDidDismissActionNotification)
    {
      v25 = MEMORY[0x193AF5ED0]("DDDetectionControllerDidDismissActionNotification", @"DataDetectorsUI");
      if (v25)
      {
        v26 = *v25;
      }

      else
      {
        v26 = 0;
      }

      objc_storeStrong(&registerNotifications__DDDetectionControllerDidDismissActionNotification, v26);
    }

    if (registerNotifications__DDDetectionControllerWillPresentActionNotification)
    {
      defaultCenter19 = [MEMORY[0x1E696AD88] defaultCenter];
      [defaultCenter19 addObserver:self selector:sel__dataDetectorsWillPresentNotification_ name:registerNotifications__DDDetectionControllerWillPresentActionNotification object:0];
    }

    if (registerNotifications__DDDetectionControllerDidDismissActionNotification)
    {
      defaultCenter20 = [MEMORY[0x1E696AD88] defaultCenter];
      [defaultCenter20 addObserver:self selector:sel__dataDetectorsDidDismissNotification_ name:registerNotifications__DDDetectionControllerDidDismissActionNotification object:0];
    }
  }
}

- (void)_registerSendProgressDelegate
{
  v2.receiver = self;
  v2.super_class = CKChatController;
  [(CKCoreChatController *)&v2 _registerSendProgressDelegate];
}

- (void)registerNotificationsForConversation:(id)conversation
{
  v16.receiver = self;
  v16.super_class = CKChatController;
  conversationCopy = conversation;
  [(CKCoreChatController *)&v16 registerNotificationsForConversation:conversationCopy];
  defaultCenter = [MEMORY[0x1E696AD88] defaultCenter];
  [defaultCenter addObserver:self selector:sel__conversationParticipantsChanged_ name:@"CKConversationParticipantsDidChangeNotification" object:conversationCopy];

  defaultCenter2 = [MEMORY[0x1E696AD88] defaultCenter];
  [defaultCenter2 addObserver:self selector:sel__conversationJoinStateDidChange_ name:@"CKConversationJoinStateDidChangeNotification" object:conversationCopy];

  defaultCenter3 = [MEMORY[0x1E696AD88] defaultCenter];
  v8 = *MEMORY[0x1E69A5748];
  chat = [conversationCopy chat];
  [defaultCenter3 addObserver:self selector:sel__handleChatItemDidChange_ name:v8 object:chat];

  defaultCenter4 = [MEMORY[0x1E696AD88] defaultCenter];
  v11 = *MEMORY[0x1E69A5808];
  chat2 = [conversationCopy chat];
  [defaultCenter4 addObserver:self selector:sel__handleKeyTransparencyShouldRefresh_ name:v11 object:chat2];

  defaultCenter5 = [MEMORY[0x1E696AD88] defaultCenter];
  v14 = *MEMORY[0x1E69A5730];
  chat3 = [conversationCopy chat];

  [defaultCenter5 addObserver:self selector:sel__handleInterworkingStateChanged_ name:v14 object:chat3];
}

- (void)_displayNameUpdatedNotification:(id)notification
{
  v3.receiver = self;
  v3.super_class = CKChatController;
  [(CKCoreChatController *)&v3 _displayNameUpdatedNotification:notification];
}

- (BOOL)shouldListParticipantsInTitle
{
  if ([(CKChatController *)self shouldShowAvatarViewInNavBarCanvas])
  {
    LOBYTE(v3) = 0;
  }

  else
  {
    splitViewController = [(CKChatController *)self splitViewController];
    v3 = [splitViewController isCollapsed] ^ 1;
  }

  return v3;
}

- (void)_transferFinishedNotification:(id)notification
{
  object = [notification object];
  collectionViewController = [(CKCoreChatController *)self collectionViewController];
  chatItems = [collectionViewController chatItems];
  v6 = [chatItems __ck_indexOfTransfer:object];

  if (v6 != 0x7FFFFFFFFFFFFFFFLL)
  {
    iMMessage = [object IMMessage];
    if ([iMMessage isFromMe])
    {
    }

    else
    {
      isFileDataReady = [object isFileDataReady];

      if (isFileDataReady)
      {
        [(CKChatController *)self updateQLPreviewControllerIfVisible];
      }
    }
  }
}

- (void)_transferRestoredNotification:(id)notification
{
  v16 = *MEMORY[0x1E69E9840];
  notificationCopy = notification;
  object = [notificationCopy object];
  collectionViewController = [(CKCoreChatController *)self collectionViewController];
  chatItems = [collectionViewController chatItems];
  v8 = [chatItems __ck_indexOfTransfer:object];

  if (v8 != 0x7FFFFFFFFFFFFFFFLL)
  {
    if (IMOSLoggingEnabled())
    {
      CKLogCStringForType(46);
      v9 = OSLogHandleForIMFoundationCategory();
      if (os_log_type_enabled(v9, OS_LOG_TYPE_DEBUG))
      {
        *buf = 138412546;
        v13 = object;
        v14 = 2048;
        v15 = v8;
        _os_log_impl(&dword_19020E000, v9, OS_LOG_TYPE_DEBUG, "Transfer %@ restored. Reload indexes %lu.", buf, 0x16u);
      }
    }

    if (os_log_shim_legacy_logging_enabled() && _CKShouldLog())
    {
      v10 = object;
      v11 = v8;
      _CKLog();
    }

    [(CKChatController *)self updateQLPreviewControllerIfVisible:v10];
  }
}

- (void)_handleAddressBookChangedNotification:(id)notification
{
  v4.receiver = self;
  v4.super_class = CKChatController;
  [(CKCoreChatController *)&v4 _handleAddressBookChangedNotification:notification];
  if ([(CKChatController *)self allowsMentions])
  {
    [(CKChatController *)self _reloadMentionsData];
  }
}

- (void)_reloadMentionsData
{
  entryView = [(CKChatController *)self entryView];
  contentView = [entryView contentView];
  textView = [contentView textView];
  [textView reloadMentionsData];
}

- (void)_raiseToListenSettingChanged:(id)changed
{
  [(CKChatController *)self updateRaiseGesture];
  v4 = +[CKConversationList sharedConversationList];
  [v4 setNeedsReload];

  conversation = [(CKCoreChatController *)self conversation];
  [conversation loadAllMessages];
}

- (void)_applicationWillResignActive:(id)active
{
  [(CKChatController *)self setIsShowingCamera:0];
  inputController = [(CKCoreChatController *)self inputController];
  if ([inputController isInputViewVisible])
  {
    entryView = [(CKChatController *)self entryView];
    contentView = [entryView contentView];
    activeView = [contentView activeView];
    isFirstResponder = [activeView isFirstResponder];

    if (isFirstResponder)
    {
      v9 = 1;
      goto LABEL_7;
    }
  }

  else
  {
  }

  if (![(CKChatController *)self appModalIsDisplayed])
  {
    return;
  }

  v9 = 4;
LABEL_7:

  [(CKChatController *)self setTargetFirstResponder:v9];
}

- (void)_applicationDidBecomeActive:(id)active
{
  [(CKChatController *)self updateRaiseGesture];
  inputController = [(CKCoreChatController *)self inputController];
  if ([inputController isInputViewVisible])
  {
    entryView = [(CKChatController *)self entryView];
    contentView = [entryView contentView];
    activeView = [contentView activeView];
    isFirstResponder = [activeView isFirstResponder];

    if (isFirstResponder)
    {
      goto LABEL_9;
    }
  }

  else
  {
  }

  if ([(CKChatController *)self targetFirstResponder]!= 1)
  {
LABEL_9:

    [(CKChatController *)self setTargetFirstResponder:0];
    return;
  }

  [(CKChatController *)self becomeFirstResponder];
}

- (void)_conversationParticipantsChanged:(id)changed
{
  [(CKChatController *)self _updateRecipientCapabilities];
  [(CKChatController *)self reloadInputViews];
  [(CKChatController *)self addOrRemoveEntryViewIfNeeded];
  if ([(CKChatController *)self shouldUseMacRecipientsView])
  {
    macRecipientsController = [(CKChatController *)self macRecipientsController];
    [macRecipientsController refreshRecipients];
  }

  conversation = [(CKCoreChatController *)self conversation];
  if ([conversation hasLeftGroupChat])
  {
    goto LABEL_6;
  }

  conversation2 = [(CKCoreChatController *)self conversation];
  if ([conversation2 isBusinessChatDisabled])
  {

LABEL_6:
LABEL_7:
    v8.receiver = self;
    v8.super_class = CKChatController;
    [(CKChatController *)&v8 becomeFirstResponder];
    goto LABEL_8;
  }

  isReadOnly = [(CKCoreChatController *)self isReadOnly];

  if (isReadOnly)
  {
    goto LABEL_7;
  }

  if ([(CKChatController *)self allowsMentions])
  {
    [(CKChatController *)self _reloadMentionsData];
  }

LABEL_8:
  [(CKChatController *)self _updateTitleAnimated:1];
}

- (void)_conversationJoinStateDidChange:(id)change
{
  [(CKChatController *)self reloadInputViews];
  [(CKChatController *)self addOrRemoveEntryViewIfNeeded];
  conversation = [(CKCoreChatController *)self conversation];
  if (([conversation hasLeftGroupChat] & 1) == 0)
  {
    conversation2 = [(CKCoreChatController *)self conversation];
    if (![conversation2 isBusinessChatDisabled])
    {
      isReadOnly = [(CKCoreChatController *)self isReadOnly];

      if (!isReadOnly)
      {
        goto LABEL_6;
      }

      goto LABEL_5;
    }
  }

LABEL_5:
  [(CKChatController *)self setTargetFirstResponder:0];
  [(CKChatController *)self becomeFirstResponder];
LABEL_6:
  if ([(CKChatController *)self shouldUseMacRecipientsView])
  {
    macRecipientsController = [(CKChatController *)self macRecipientsController];

    if (macRecipientsController)
    {
      macRecipientsController2 = [(CKChatController *)self macRecipientsController];
      [macRecipientsController2 refreshRecipients];
    }
  }
}

- (void)_dataDetectorsWillPresentNotification:(id)notification
{
  entryView = [(CKChatController *)self entryView];
  contentView = [entryView contentView];
  self->_entryViewWasActiveBeforePresentingDataDetector = [contentView isActive];

  if (self->_entryViewWasActiveBeforePresentingDataDetector)
  {
    entryView2 = [(CKChatController *)self entryView];
    contentView2 = [entryView2 contentView];
    activeView = [contentView2 activeView];
    [activeView resignFirstResponder];
  }
}

- (void)_dataDetectorsDidDismissNotification:(id)notification
{
  if (self->_entryViewWasActiveBeforePresentingDataDetector)
  {
    [(CKChatController *)self setTargetFirstResponder:1];
  }

  block[0] = MEMORY[0x1E69E9820];
  block[1] = 3221225472;
  block[2] = __57__CKChatController__dataDetectorsDidDismissNotification___block_invoke;
  block[3] = &unk_1E72EBA18;
  block[4] = self;
  dispatch_async(MEMORY[0x1E69E96A0], block);
}

- (void)_sizeEffectPickerWindow
{
  effectPickerWindow = [(CKChatController *)self effectPickerWindow];
  if (effectPickerWindow)
  {
    effectPickerViewController = [(CKChatController *)self effectPickerViewController];
    if ([MEMORY[0x1E69DC938] __ck_currentDeviceIsPadOrMac])
    {
      v20 = 0.0;
      v21 = 0.0;
      [(CKChatController *)self messageEntryViewWidth:&v21 andOffset:&v20];
      view = [(CKChatController *)self view];
      [view bounds];
      v7 = v6;
      v9 = v8;

      [effectPickerWindow setFrame:{v20, v7, v21, v9}];
      v10 = *MEMORY[0x1E69DE330];
      v11 = -1.0;
    }

    else
    {
      view2 = [(CKChatController *)self view];
      window = [view2 window];
      [window frame];
      [effectPickerWindow setFrame:?];

      v10 = *MEMORY[0x1E69DE330];
      v11 = 1.0;
    }

    [effectPickerWindow setLevel:v10 + v11];
    view3 = [effectPickerViewController view];
    [effectPickerWindow bounds];
    [view3 setFrame:?];

    entryView = [(CKChatController *)self entryView];
    [entryView sendButtonFrameInScreenCoordinates];
    v17 = v16;

    [effectPickerViewController setCloseButtonYPosition:v17];
    view4 = [effectPickerViewController view];
    [view4 setNeedsLayout];

    view5 = [effectPickerViewController view];
    [view5 layoutIfNeeded];
  }
}

- (void)_switchedToEmojiKeyboard:(id)keyboard
{
  entryView = [(CKChatController *)self entryView];
  contentView = [entryView contentView];
  activeView = [contentView activeView];
  isFirstResponder = [activeView isFirstResponder];

  if (isFirstResponder)
  {
    mEMORY[0x1E69DCBF0] = [MEMORY[0x1E69DCBF0] sharedInputModeController];
    currentInputModeInPreference = [mEMORY[0x1E69DCBF0] currentInputModeInPreference];
    [(CKChatController *)self setSavedKeyboardInputMode:currentInputModeInPreference];

    [(CKChatController *)self setIsShowingEmojiKeyboard:1];
  }
}

- (void)_switchedAwayFromEmojiKeyboard:(id)keyboard
{
  [(CKChatController *)self setIsShowingEmojiKeyboard:0];
  entryView = [(CKChatController *)self entryView];
  [(CKChatController *)self messageEntryViewDidChange:entryView isTextChange:0 isShelfChange:0 isTranslationChange:0];
}

- (void)_initializeEffectPicker
{
  entryView = [(CKChatController *)self entryView];
  [entryView sendButtonFrameInScreenCoordinates];
  v5 = v4;
  v7 = v6;
  v9 = v8;
  v11 = v10;

  gradientReferenceView = [(CKCoreChatController *)self gradientReferenceView];
  entryView2 = [(CKChatController *)self entryView];
  contentView = [entryView2 contentView];
  superview = [contentView superview];

  [superview frame];
  v17 = v16;
  v19 = v18;
  v15Superview = [superview superview];
  [v15Superview convertPoint:0 toView:{v17, v19}];
  v22 = v21;
  v24 = v23;

  v25 = v22 + 1.0;
  if ([MEMORY[0x1E69DC938] __ck_currentDeviceIsPadOrMac])
  {
    v44 = 0.0;
    *buf = 0;
    [(CKChatController *)self messageEntryViewWidth:buf andOffset:&v44];
    v5 = v5 - v44;
    v25 = v25 - v44;
  }

  v26 = v24 + 1.0;
  if (CKIsRunningInMacCatalyst())
  {
    v27 = [CKEffectPickerMacViewController alloc];
    entryView3 = [(CKChatController *)self entryView];
    composition = [entryView3 composition];
    conversation = [(CKCoreChatController *)self conversation];
    v31 = -[CKEffectPickerMacViewController initWithComposition:balloonViewOrigin:color:gradientReferenceView:](v27, "initWithComposition:balloonViewOrigin:color:gradientReferenceView:", composition, [conversation sendButtonColor], gradientReferenceView, v25, v26);

    [(CKEffectPickerMacViewController *)v31 setModalPresentationStyle:6];
    [(CKEffectPickerMacViewController *)v31 setShowingInStandAloneWindow:[(CKCoreChatController *)self showingInStandAloneWindow]];
  }

  else
  {
    v32 = [CKEffectPickerViewController alloc];
    entryView4 = [(CKChatController *)self entryView];
    composition2 = [entryView4 composition];
    entryView5 = [(CKChatController *)self entryView];
    v31 = -[CKEffectPickerViewController initWithComposition:sendButtonFrame:balloonViewOrigin:color:gradientReferenceView:](v32, "initWithComposition:sendButtonFrame:balloonViewOrigin:color:gradientReferenceView:", composition2, [entryView5 sendButtonColor], gradientReferenceView, v5, v7, v9, v11, v25, v26);
  }

  [(CKEffectPickerMacViewController *)v31 setDelegate:self];
  [(CKChatController *)self setEffectPickerViewController:v31];
  if (CKIsRunningInMacCatalyst())
  {
    v43[0] = MEMORY[0x1E69E9820];
    v43[1] = 3221225472;
    v43[2] = __43__CKChatController__initializeEffectPicker__block_invoke;
    v43[3] = &unk_1E72EBA18;
    v43[4] = self;
    [(CKChatController *)self presentViewController:v31 animated:0 completion:v43];
  }

  else
  {
    v36 = objc_alloc(MEMORY[0x1E69DD2E8]);
    view = [(CKChatController *)self view];
    window = [view window];
    windowScene = [window windowScene];
    v40 = [v36 initWithWindowScene:windowScene];

    [(CKChatController *)self setEffectPickerWindow:v40];
    [v40 setRootViewController:v31];
    [(CKChatController *)self _sizeEffectPickerWindow];
    [v40 setHidden:0];
    activeKeyboard = [MEMORY[0x1E69DCBB8] activeKeyboard];
    [activeKeyboard setTypingEnabled:0];

    [(CKChatController *)self requestShowKeyboardSnapshotForReason:4];
    if (IMOSLoggingEnabled())
    {
      v42 = OSLogHandleForIMFoundationCategory();
      if (os_log_type_enabled(v42, OS_LOG_TYPE_INFO))
      {
        *buf = 0;
        _os_log_impl(&dword_19020E000, v42, OS_LOG_TYPE_INFO, "Hiding entry view", buf, 2u);
      }
    }
  }
}

- (void)_handleIsUnexpectedlyLoggedOutChanged:(id)changed
{
  transcriptInlineNotificationUpdater = [(CKChatController *)self transcriptInlineNotificationUpdater];
  [transcriptInlineNotificationUpdater setNeedsUpdate];
}

- (void)_transferUpdated:(id)updated
{
  object = [updated object];
  if ([object updateReason] == 1)
  {
    v5 = 0;
    if (!object)
    {
      goto LABEL_11;
    }
  }

  else
  {
    v5 = [object updateReason] != 2;
    if (!object)
    {
      goto LABEL_11;
    }
  }

  if (!v5)
  {
    collectionViewController = [(CKCoreChatController *)self collectionViewController];
    associatedChatItems = [collectionViewController associatedChatItems];

    v8 = [associatedChatItems __ck_indexOfTransfer:object];
    if (v8 != 0x7FFFFFFFFFFFFFFFLL)
    {
      v9 = [associatedChatItems objectAtIndexedSubscript:v8];
      objc_opt_class();
      if (objc_opt_isKindOfClass())
      {
        chat = [(CKCoreChatController *)self chat];
        iMChatItem = [v9 IMChatItem];
        [chat stickerRepositionedForAssociatedChatItem:iMChatItem];
      }
    }
  }

LABEL_11:
  error = [object error];
  if (error)
  {
    v13 = error;
    updateReason = [object updateReason];

    if (updateReason == 3)
    {
      v15 = IMLogHandleForCategory();
      if (os_log_type_enabled(v15, OS_LOG_TYPE_ERROR))
      {
        [CKChatController _transferUpdated:];
      }

      [(CKCoreChatController *)self presentAttachmentDownloadFailedErrorForTransfer:object];
    }
  }
}

- (void)_transferCompleted:(id)completed
{
  v36 = *MEMORY[0x1E69E9840];
  completedCopy = completed;
  object = [completedCopy object];
  selfCopy = self;
  mediaObjectToDownload = [(CKCoreChatController *)self mediaObjectToDownload];
  v7 = mediaObjectToDownload;
  if (mediaObjectToDownload)
  {
    transferGUID = [mediaObjectToDownload transferGUID];
    guid = [object guid];
    v10 = [transferGUID isEqualToString:guid];

    if (v10)
    {
      [(CKCoreChatController *)self setMediaObjectToDownload:0];
      [(CKChatController *)self showViewerForMediaObject:v7];
    }
  }

  if (object && [object commSafetySensitive])
  {
    v25 = v7;
    v26 = completedCopy;
    v11 = object;
    object2 = [completedCopy object];
    guid2 = [object2 guid];

    collectionViewController = [(CKCoreChatController *)selfCopy collectionViewController];
    chatItems = [collectionViewController chatItems];

    v33 = 0u;
    v34 = 0u;
    v31 = 0u;
    v32 = 0u;
    v16 = chatItems;
    v17 = [v16 countByEnumeratingWithState:&v31 objects:v35 count:16];
    if (v17)
    {
      v18 = v17;
      v19 = *v32;
      do
      {
        for (i = 0; i != v18; ++i)
        {
          if (*v32 != v19)
          {
            objc_enumerationMutation(v16);
          }

          v21 = *(*(&v31 + 1) + 8 * i);
          if ([v21 supportsCommunicationSafety])
          {
            commSafetyTransferGUID = [v21 commSafetyTransferGUID];
            v23 = [guid2 isEqualToString:commSafetyTransferGUID];

            if (v23)
            {
              v24 = dispatch_time(0, 200000000);
              block[0] = MEMORY[0x1E69E9820];
              block[1] = 3221225472;
              block[2] = __39__CKChatController__transferCompleted___block_invoke;
              block[3] = &unk_1E72EB880;
              block[4] = selfCopy;
              v29 = v11;
              v30 = v21;
              dispatch_after(v24, MEMORY[0x1E69E96A0], block);
            }
          }
        }

        v18 = [v16 countByEnumeratingWithState:&v31 objects:v35 count:16];
      }

      while (v18);
    }

    v7 = v25;
    completedCopy = v26;
    object = v11;
  }
}

void __39__CKChatController__transferCompleted___block_invoke(id *a1)
{
  v4 = [a1[4] chat];
  v2 = [a1[5] commSafetySensitive];
  v3 = [a1[6] IMChatItem];
  [v4 updateCommSafety:v2 forChatItem:v3];
}

- (void)_textInputModeDidChange:(id)change
{
  v15[2] = *MEMORY[0x1E69E9840];
  changeCopy = change;
  userInfo = [changeCopy userInfo];
  v5 = [userInfo objectForKeyedSubscript:*MEMORY[0x1E69DE698]];

  userInfo2 = [changeCopy userInfo];
  v7 = [userInfo2 objectForKeyedSubscript:*MEMORY[0x1E69DE6A0]];

  userInfo3 = [changeCopy userInfo];

  v9 = [userInfo3 objectForKeyedSubscript:*MEMORY[0x1E69DE6A8]];

  if (v5)
  {
    v10 = v7 == 0;
  }

  else
  {
    v10 = 1;
  }

  if (!v10)
  {
    v11 = objc_alloc_init(MEMORY[0x193AF5EC0](@"NPSManager", @"NanoPreferencesSync"));
    v12 = MEMORY[0x1E695DFD8];
    v15[0] = v7;
    v15[1] = v9;
    v13 = [MEMORY[0x1E695DEC8] arrayWithObjects:v15 count:2];
    v14 = [v12 setWithArray:v13];
    [v11 synchronizeUserDefaultsDomain:v5 keys:v14];
  }
}

- (void)inputLanguageDidChange:(id)change
{
  block[0] = MEMORY[0x1E69E9820];
  block[1] = 3221225472;
  block[2] = __43__CKChatController_inputLanguageDidChange___block_invoke;
  block[3] = &unk_1E72EBA18;
  block[4] = self;
  dispatch_async(MEMORY[0x1E69E96A0], block);
}

void __43__CKChatController_inputLanguageDidChange___block_invoke(uint64_t a1)
{
  v2 = [*(a1 + 32) entryView];

  if (v2)
  {
    v3 = *(a1 + 32);

    [v3 updateEntryViewHeightAnimated:0];
  }
}

- (void)_configureCallStateResolverForCurrentConversation
{
  objc_initWeak(&location, self);
  callStateResolver = [(CKChatController *)self callStateResolver];
  conversation = [(CKCoreChatController *)self conversation];
  v5[0] = MEMORY[0x1E69E9820];
  v5[1] = 3221225472;
  v5[2] = __69__CKChatController__configureCallStateResolverForCurrentConversation__block_invoke;
  v5[3] = &unk_1E72EC460;
  objc_copyWeak(&v6, &location);
  [callStateResolver updateForConversation:conversation completion:v5];

  objc_destroyWeak(&v6);
  objc_destroyWeak(&location);
}

void __69__CKChatController__configureCallStateResolverForCurrentConversation__block_invoke(uint64_t a1)
{
  WeakRetained = objc_loadWeakRetained((a1 + 32));
  [WeakRetained _updateNavigationButtons];

  v3 = objc_loadWeakRetained((a1 + 32));
  [v3 _updateCallStateIfNeeded];
}

- (void)setEntryViewOverrideForNewCompose:(id)compose
{
  composeCopy = compose;
  [composeCopy setDelegate:self];
  [(CKChatController *)self setEntryView:composeCopy];
  [composeCopy _overrideInputAccessoryViewNextResponderWithResponder:self];

  self->_entryViewShouldBecomeTargetFirstResponderForPendingDraft = 1;
}

- (void)cleanupPostComposeTransitionWithKBFrame:(CGRect)frame
{
  [(CKScrollViewController *)self primeWithKeyboardFrame:frame.origin.x, frame.origin.y, frame.size.width, frame.size.height];
  entryView = [(CKChatController *)self entryView];
  [entryView setConversation:0];
  conversation = [(CKCoreChatController *)self conversation];
  [entryView setConversation:conversation];

  [entryView setDelegate:self];
  [entryView setClickInteractionDelegate:self];
  isKeyboardVisible = [(CKScrollViewController *)self isKeyboardVisible];
  conversation2 = [(CKCoreChatController *)self conversation];
  [entryView setConversation:conversation2];

  [entryView setKeyboardVisible:isKeyboardVisible];
  contentView = [entryView contentView];
  textView = [contentView textView];

  [textView setTextDropDelegate:self];
  [textView setPasteDelegate:self];
  chat = [(CKCoreChatController *)self chat];
  v10 = [chat supportsCapabilities:0x8000];

  v11 = +[CKUIBehavior sharedBehaviors];
  v12 = [v11 pasteConfigurationDisablingKeyboardStickers:v10 ^ 1u];

  [textView setPasteConfiguration:v12];
  inputController = [(CKCoreChatController *)self inputController];
  entryView2 = [(CKChatController *)self entryView];
  [inputController setEntryView:entryView2];
}

- (void)setEntryView:(id)view
{
  viewCopy = view;
  if (viewCopy)
  {
    v4 = [[CKMessageEntryViewController alloc] initWithEntryView:viewCopy];
    [(CKChatController *)self setEntryViewController:v4];
  }

  else
  {
    [(CKChatController *)self setEntryViewController:0];
  }

  entryViewController = [(CKChatController *)self entryViewController];
  [entryViewController setInputAccessoryViewControllerEnabled:{-[CKChatController inputAccessoryViewControllerEnabled](self, "inputAccessoryViewControllerEnabled")}];
}

- (void)resignFirstResponderOnEntryViewIfNeeded
{
  v3 = +[CKUIBehavior sharedBehaviors];
  isEntryViewInputAccessory = [v3 isEntryViewInputAccessory];

  if (isEntryViewInputAccessory)
  {
    currentDevice = [MEMORY[0x1E69DC938] currentDevice];
    userInterfaceIdiom = [currentDevice userInterfaceIdiom];

    mEMORY[0x1E69DCBE0] = [MEMORY[0x1E69DCBE0] sharedInstance];
    isInHardwareKeyboardMode = [mEMORY[0x1E69DCBE0] isInHardwareKeyboardMode];

    isCollapsed = [(CKCoreChatController *)self isCollapsed];
    isInline = [(CKCoreChatController *)self isInline];
    if (userInterfaceIdiom == 1 && isCollapsed && isInHardwareKeyboardMode && !isInline)
    {
      entryView = [(CKChatController *)self entryView];
      contentView = [entryView contentView];
      textView = [contentView textView];
      [textView resignFirstResponder];
    }
  }
}

- (BOOL)appManagerDisplayedInMessages
{
  v3 = CKIsRunningInMessages();
  if (v3)
  {
    inputController = [(CKCoreChatController *)self inputController];
    appManagerIsDisplayed = [inputController appManagerIsDisplayed];

    if (appManagerIsDisplayed)
    {
      if (IMOSLoggingEnabled())
      {
        v6 = OSLogHandleForIMFoundationCategory();
        if (os_log_type_enabled(v6, OS_LOG_TYPE_INFO))
        {
          *v8 = 0;
          _os_log_impl(&dword_19020E000, v6, OS_LOG_TYPE_INFO, "EntryView Debug - App Manager is displayed in Messages", v8, 2u);
        }
      }

      LOBYTE(v3) = 1;
    }

    else
    {
      LOBYTE(v3) = 0;
    }
  }

  return v3;
}

- (BOOL)appModalIsDisplayed
{
  v3 = CKIsRunningInMessages();
  if (v3)
  {
    inputController = [(CKCoreChatController *)self inputController];
    appModalIsDisplayed = [inputController appModalIsDisplayed];

    if (appModalIsDisplayed)
    {
      if (IMOSLoggingEnabled())
      {
        v6 = OSLogHandleForIMFoundationCategory();
        if (os_log_type_enabled(v6, OS_LOG_TYPE_INFO))
        {
          *v8 = 0;
          _os_log_impl(&dword_19020E000, v6, OS_LOG_TYPE_INFO, "EntryView Debug - App modal is displayed in Messages", v8, 2u);
        }
      }

      LOBYTE(v3) = 1;
    }

    else
    {
      LOBYTE(v3) = 0;
    }
  }

  return v3;
}

- (id)inputAccessoryViewController
{
  v55 = *MEMORY[0x1E69E9840];
  if ([(CKChatController *)self inputAccessoryViewControllerEnabled])
  {
    if ([(CKChatController *)self shouldShowEntryView])
    {
      entryViewController = [(CKChatController *)self entryViewController];
    }

    else
    {
      entryViewController = 0;
    }

    inputController = [(CKCoreChatController *)self inputController];
    entryView = [entryViewController entryView];
    [inputController setEntryView:entryView];

    if ([(CKChatController *)self appManagerDisplayedInMessages])
    {
      if (IMOSLoggingEnabled())
      {
        v6 = OSLogHandleForIMFoundationCategory();
        if (os_log_type_enabled(v6, OS_LOG_TYPE_INFO))
        {
          *buf = 0;
          _os_log_impl(&dword_19020E000, v6, OS_LOG_TYPE_INFO, "EntryView Debug - Not vending IAVC, -appManagerDisplayedInMessages is YES", buf, 2u);
        }
      }

      entryViewController = 0;
    }

    if ([(CKChatController *)self appModalIsDisplayed])
    {
      inputController2 = [(CKCoreChatController *)self inputController];
      isDismissingAppModal = [inputController2 isDismissingAppModal];

      if ((isDismissingAppModal & 1) == 0)
      {
        if (IMOSLoggingEnabled())
        {
          v9 = OSLogHandleForIMFoundationCategory();
          if (os_log_type_enabled(v9, OS_LOG_TYPE_INFO))
          {
            *buf = 0;
            _os_log_impl(&dword_19020E000, v9, OS_LOG_TYPE_INFO, "EntryView Debug - Not vending IAVC, -appModalIsDisplayed is YES", buf, 2u);
          }
        }

        entryViewController = 0;
      }
    }

    if (IMOSLoggingEnabled())
    {
      v10 = OSLogHandleForIMFoundationCategory();
      if (os_log_type_enabled(v10, OS_LOG_TYPE_INFO))
      {
        v11 = objc_opt_class();
        v36 = NSStringFromClass(v11);
        view = [entryViewController view];
        [view alpha];
        v13 = v12;
        view2 = [entryViewController view];
        [view2 frame];
        v34 = NSStringFromCGRect(v57);
        view3 = [entryViewController view];
        window = [view3 window];
        v14 = objc_opt_class();
        v33 = NSStringFromClass(v14);
        view4 = [entryViewController view];
        window2 = [view4 window];
        view5 = [(CKChatController *)self view];
        window3 = [view5 window];
        firstResponder = [window3 firstResponder];
        v17 = objc_opt_class();
        v18 = NSStringFromClass(v17);
        view6 = [(CKChatController *)self view];
        window4 = [view6 window];
        firstResponder2 = [window4 firstResponder];
        view7 = [(CKChatController *)self view];
        window5 = [view7 window];
        isKeyWindow = [window5 isKeyWindow];
        v25 = @"NO";
        *buf = 138414338;
        v38 = v36;
        v39 = 2048;
        if (isKeyWindow)
        {
          v25 = @"YES";
        }

        v40 = entryViewController;
        v41 = 2048;
        v42 = v13;
        v43 = 2112;
        v44 = v34;
        v45 = 2112;
        v46 = v33;
        v47 = 2048;
        v48 = window2;
        v49 = 2112;
        v50 = v18;
        v51 = 2048;
        v52 = firstResponder2;
        v53 = 2112;
        v54 = v25;
        _os_log_impl(&dword_19020E000, v10, OS_LOG_TYPE_INFO, "EntryView Debug - IAVC %@ <%p> Alpha %f Frame %@ IAV Window %@ <%p>  Current FR %@ <%p> View window is key - %@", buf, 0x5Cu);
      }
    }
  }

  else
  {
    entryViewController = 0;
  }

  return entryViewController;
}

- (UIEdgeInsets)_marginInsetsForEntryView
{
  [(CKChatController *)self systemMinimumLayoutMargins];
  v4 = v3;
  v29 = v6;
  v31 = v5;
  v8 = v7;
  view = [(CKChatController *)self view];
  effectiveUserInterfaceLayoutDirection = [view effectiveUserInterfaceLayoutDirection];
  if (effectiveUserInterfaceLayoutDirection)
  {
    v11 = v8;
  }

  else
  {
    v11 = v4;
  }

  v27 = v11;
  if (effectiveUserInterfaceLayoutDirection)
  {
    v12 = v4;
  }

  else
  {
    v12 = v8;
  }

  v25 = v12;

  v14 = v25;
  v13 = v27;
  v16 = v29;
  v15 = v31;
  v17.f64[0] = v31;
  v17.f64[1] = v27;
  v18.f64[0] = v29;
  v18.f64[1] = v25;
  if (vminv_u16(vmovn_s32(vuzp1q_s32(vceqq_f64(*MEMORY[0x1E69DDCE0], v17), vceqq_f64(*(MEMORY[0x1E69DDCE0] + 16), v18)))))
  {
    delegate = [(CKCoreChatController *)self delegate];

    v14 = v25;
    v13 = v27;
    v16 = v29;
    v15 = v31;
    if (delegate)
    {
      v20 = [(CKCoreChatController *)self delegate:v31];
      [v20 initialSystemMinimumLayoutMarginsForChatController:self];
      v30 = v22;
      v32 = v21;
      v26 = v24;
      v28 = v23;

      v14 = v26;
      v13 = v28;
      v16 = v30;
      v15 = v32;
    }
  }

  result.right = v14;
  result.bottom = v16;
  result.left = v13;
  result.top = v15;
  return result;
}

- (void)setSendingMessage:(BOOL)message
{
  v5.receiver = self;
  v5.super_class = CKChatController;
  [(CKCoreChatController *)&v5 setSendingMessage:message];
  entryView = [(CKChatController *)self entryView];
  [entryView updateEntryView];
}

- (void)_updateEntryViewPasteConfiguration
{
  v16 = *MEMORY[0x1E69E9840];
  entryView = [(CKChatController *)self entryView];
  contentView = [entryView contentView];
  textView = [contentView textView];

  if (!textView)
  {
    goto LABEL_20;
  }

  disableKeyboardStickers = [textView disableKeyboardStickers];
  chat = [(CKCoreChatController *)self chat];

  if (chat)
  {
    chat2 = [(CKCoreChatController *)self chat];
    v9 = [chat2 supportsCapabilities:0x8000] ^ 1;

    if (disableKeyboardStickers == v9)
    {
LABEL_14:
      [(CKChatController *)self setShouldUpdateEntryViewPasteConfiguration:0];
      if (IMOSLoggingEnabled())
      {
        v12 = OSLogHandleForIMFoundationCategory();
        if (os_log_type_enabled(v12, OS_LOG_TYPE_INFO))
        {
          v13 = @"NO";
          if (disableKeyboardStickers)
          {
            v13 = @"YES";
          }

          v14 = 138412290;
          v15 = v13;
          _os_log_impl(&dword_19020E000, v12, OS_LOG_TYPE_INFO, "Configuration of stickers in keyboard has already been updated to hide:(%@). Ignoring paste configuration update.", &v14, 0xCu);
        }
      }

      goto LABEL_20;
    }
  }

  else
  {
    if ((disableKeyboardStickers & 1) == 0)
    {
      goto LABEL_14;
    }

    v9 = 0;
  }

  if (IMOSLoggingEnabled())
  {
    v10 = OSLogHandleForIMFoundationCategory();
    if (os_log_type_enabled(v10, OS_LOG_TYPE_INFO))
    {
      v11 = @"NO";
      if (v9)
      {
        v11 = @"YES";
      }

      v14 = 138412290;
      v15 = v11;
      _os_log_impl(&dword_19020E000, v10, OS_LOG_TYPE_INFO, "Updating paste configuration of entry text view to hide stickers:(%@)", &v14, 0xCu);
    }
  }

  [(CKChatController *)self setShouldUpdateEntryViewPasteConfiguration:1];
  [(CKChatController *)self reloadEntryViewIfNeeded];
LABEL_20:
}

- (void)reloadEntryViewIfNeeded
{
  v132 = *MEMORY[0x1E69E9840];
  [CKPPTSubTest start:@"reloadEntryViewIfNeeded"];
  if (IMOSLoggingEnabled())
  {
    v3 = OSLogHandleForIMFoundationCategory();
    if (os_log_type_enabled(v3, OS_LOG_TYPE_INFO))
    {
      *buf = 136315138;
      v131 = "[CKChatController reloadEntryViewIfNeeded]";
      _os_log_impl(&dword_19020E000, v3, OS_LOG_TYPE_INFO, "CKMessageEntryView - %s", buf, 0xCu);
    }
  }

  inputController = [(CKCoreChatController *)self inputController];
  v5 = inputController == 0;

  if (v5)
  {
    [(CKChatController *)self loadChatInputController];
  }

  conversation = [(CKCoreChatController *)self conversation];

  if (conversation)
  {
    entryView = [(CKChatController *)self entryView];
    v8 = entryView == 0;

    if ([(CKChatController *)self needsEntryViewUpdateForDismissedFooter])
    {
      [(CKChatController *)self setNeedsEntryViewUpdateForDismissedFooter:0];
      v8 = 1;
    }

    if (IMOSLoggingEnabled())
    {
      v9 = OSLogHandleForIMFoundationCategory();
      if (os_log_type_enabled(v9, OS_LOG_TYPE_INFO))
      {
        *buf = 67109120;
        LODWORD(v131) = v8;
        _os_log_impl(&dword_19020E000, v9, OS_LOG_TYPE_INFO, "CKMessageEntryView - shouldUpdateEntryView = %d", buf, 8u);
      }
    }

    conversation2 = [(CKCoreChatController *)self conversation];
    lastAddressedHandle = [conversation2 lastAddressedHandle];

    conversation3 = [(CKCoreChatController *)self conversation];
    lastAddressedSIMID = [conversation3 lastAddressedSIMID];

    AddressedHandle = CKShowSubjectEnabledForLastAddressedHandle(lastAddressedHandle, lastAddressedSIMID);
    conversation4 = [(CKCoreChatController *)self conversation];
    isStewieConversation = [conversation4 isStewieConversation];

    conversation5 = [(CKCoreChatController *)self conversation];
    sendingService = [conversation5 sendingService];
    if (([sendingService __ck_isiMessageLite] & 1) == 0)
    {
      conversation6 = [(CKCoreChatController *)self conversation];
      sendingService2 = [conversation6 sendingService];
      if (([sendingService2 __ck_isSatelliteSMS] & 1) == 0)
      {
        conversation7 = [(CKCoreChatController *)self conversation];
        chat = [conversation7 chat];
        shouldDisplayOffGridModeStatus = [chat shouldDisplayOffGridModeStatus];

        if ((shouldDisplayOffGridModeStatus & 1) == 0)
        {
          v124 = 0;
          v18 = isStewieConversation;
          v126 = (isStewieConversation ^ 1) & AddressedHandle;
          goto LABEL_19;
        }

LABEL_18:
        v126 = 0;
        v18 = 1;
        v124 = 1;
LABEL_19:
        mEMORY[0x1E69A8070] = [MEMORY[0x1E69A8070] sharedFeatureFlags];
        isAutomaticOutgoingTranslationEnabled = [mEMORY[0x1E69A8070] isAutomaticOutgoingTranslationEnabled];

        if (isAutomaticOutgoingTranslationEnabled)
        {
          chat2 = [(CKCoreChatController *)self chat];
          translationLanguageCode = [chat2 translationLanguageCode];

          if ([translationLanguageCode length] && (-[CKCoreChatController chat](self, "chat"), v23 = objc_claimAutoreleasedReturnValue(), v24 = objc_msgSend(v23, "isAutomaticTranslationEnabled"), v23, v24))
          {
            v129 = [MEMORY[0x1E695DF58] localeWithLocaleIdentifier:translationLanguageCode];
          }

          else
          {
            v129 = 0;
          }
        }

        else
        {
          v129 = 0;
        }

        if (v8)
        {
          goto LABEL_77;
        }

        entryView2 = [(CKChatController *)self entryView];
        shouldShowSubject = [entryView2 shouldShowSubject];

        entryView3 = [(CKChatController *)self entryView];
        shouldShowPluginButtons = [entryView3 shouldShowPluginButtons];
        pluginButtonsEnabled = [(CKChatController *)self pluginButtonsEnabled];

        entryView4 = [(CKChatController *)self entryView];
        shouldShowCharacterCount = [entryView4 shouldShowCharacterCount];
        v119 = CKShowCharacterCountEnabled(v18);

        entryView5 = [(CKChatController *)self entryView];
        shouldDisableAttachments = [entryView5 shouldDisableAttachments];

        entryView6 = [(CKChatController *)self entryView];
        shouldReloadBackgroundView = [entryView6 shouldReloadBackgroundView];

        entryView7 = [(CKChatController *)self entryView];
        translationLanguage = [entryView7 translationLanguage];
        if (translationLanguage | v129)
        {
          entryView8 = [(CKChatController *)self entryView];
          translationLanguage2 = [entryView8 translationLanguage];
          v34 = [translationLanguage2 isEqual:v129];

          v117 = v34 ^ 1;
        }

        else
        {
          v117 = 0;
        }

        mEMORY[0x1E69A8070]2 = [MEMORY[0x1E69A8070] sharedFeatureFlags];
        isExpressiveTextEnabled = [mEMORY[0x1E69A8070]2 isExpressiveTextEnabled];

        entryView9 = [(CKChatController *)self entryView];
        contentView = [entryView9 contentView];
        textView = [contentView textView];
        v43 = textView;
        if (isExpressiveTextEnabled)
        {

          ck_containsStaleEntryViewFont = [v43 ck_containsStaleEntryViewFont];
        }

        else
        {
          font = [textView font];

          v46 = +[CKUIBehavior sharedBehaviors];
          balloonTextFont = [v46 balloonTextFont];
          if ([font isEqual:balloonTextFont])
          {
            ck_containsStaleEntryViewFont = 0;
          }

          else
          {
            v48 = +[CKUIBehavior sharedBehaviors];
            singleBigEmojiFont = [v48 singleBigEmojiFont];
            if ([font isEqual:singleBigEmojiFont])
            {
              ck_containsStaleEntryViewFont = 0;
            }

            else
            {
              v50 = +[CKUIBehavior sharedBehaviors];
              multipleBigEmojiFont = [v50 multipleBigEmojiFont];
              v52 = [font isEqual:multipleBigEmojiFont];

              ck_containsStaleEntryViewFont = v52 ^ 1;
            }
          }

          v43 = font;
        }

        if ((v43, (v126 ^ shouldShowSubject | shouldShowPluginButtons ^ pluginButtonsEnabled) & 1 | (v119 != shouldShowCharacterCount) | (ck_containsStaleEntryViewFont | shouldReloadBackgroundView) & 1 | v117 & 1) || v18 != shouldDisableAttachments && ![(CKScrollViewController *)self isKeyboardVisible]|| [(CKChatController *)self reloadEntryViewForStagedPluginMessage]|| [(CKChatController *)self shouldUpdateEntryViewPasteConfiguration]&& ![(CKScrollViewController *)self isKeyboardVisible])
        {
LABEL_77:
          if (IMOSLoggingEnabled())
          {
            v53 = OSLogHandleForIMFoundationCategory();
            if (os_log_type_enabled(v53, OS_LOG_TYPE_INFO))
            {
              *buf = 0;
              _os_log_impl(&dword_19020E000, v53, OS_LOG_TYPE_INFO, "CKMessageEntryView - CKChatController is creating a new CKMessageEntryView", buf, 2u);
            }
          }

          [(CKChatController *)self _marginInsetsForEntryView];
          v55 = v54;
          v57 = v56;
          v59 = v58;
          v61 = v60;
          entryView10 = [(CKChatController *)self entryView];
          composition = [entryView10 composition];

          entryView11 = [(CKChatController *)self entryView];
          [entryView11 removeFromSuperview];

          view = [(CKChatController *)self view];
          [view bounds];
          v67 = v66;
          v69 = v68;
          v71 = v70;
          v73 = v72;

          chat3 = [(CKCoreChatController *)self chat];

          if (chat3)
          {
            chat4 = [(CKCoreChatController *)self chat];
            v76 = [chat4 supportsCapabilities:0x8000];

            v77 = v76 ^ 1u;
          }

          else
          {
            v77 = 0;
          }

          conversation8 = [(CKCoreChatController *)self conversation];
          supportsPolls = [conversation8 supportsPolls];

          if (IMOSLoggingEnabled())
          {
            v80 = OSLogHandleForIMFoundationCategory();
            if (os_log_type_enabled(v80, OS_LOG_TYPE_INFO))
            {
              v81 = @"NO";
              if (supportsPolls)
              {
                v81 = @"YES";
              }

              *buf = 138412290;
              v131 = v81;
              _os_log_impl(&dword_19020E000, v80, OS_LOG_TYPE_INFO, "[Polls] CKMessageEntryView - Allow Poll Suggestions? %@", buf, 0xCu);
            }
          }

          [(CKChatController *)self _invalidateEntryViewConstraints];
          v82 = [CKMessageEntryView alloc];
          v83 = IMIsRunningInMessagesComposeViewService();
          pluginButtonsEnabled2 = [(CKChatController *)self pluginButtonsEnabled];
          v85 = CKShowCharacterCountEnabled(v18) != 0;
          traitCollection = [(CKChatController *)self traitCollection];
          BYTE4(v115) = supportsPolls;
          BYTE3(v115) = v77;
          BYTE2(v115) = v124;
          BYTE1(v115) = isStewieConversation;
          LOBYTE(v115) = v18;
          v129 = [(CKMessageEntryView *)v82 initWithFrame:v83 ^ 1u marginInsets:1 shouldAllowImpact:v126 shouldShowSendButton:pluginButtonsEnabled2 shouldShowSubject:v85 shouldShowPluginButtons:traitCollection shouldShowCharacterCount:v67 traitCollection:v69 shouldDisableAttachments:v71 shouldUseNonEmojiKeyboard:v73 shouldUseNonHandwritingKeyboard:v55 shouldDisableKeyboardStickers:v57 shouldAllowPollSuggestions:v59 translationLanguage:v61, v115, v129];

          mEMORY[0x1E69A8070]3 = [MEMORY[0x1E69A8070] sharedFeatureFlags];
          LODWORD(v82) = [mEMORY[0x1E69A8070]3 isEntryViewRefreshEnabled];

          if (v82)
          {
            collectionViewController = [(CKCoreChatController *)self collectionViewController];
            collectionView = [collectionViewController collectionView];
            [(CKMessageEntryView *)v129 configurePocketInteractionForScrollView:collectionView];
          }

          v91 = [CKMentionsController alloc];
          contentView2 = [(CKMessageEntryView *)v129 contentView];
          textView2 = [contentView2 textView];
          conversation9 = [(CKCoreChatController *)self conversation];
          v95 = [(CKMentionsController *)v91 initWithEntryTextView:textView2 conversation:conversation9];
          [(CKChatController *)self setMentionsController:v95];

          if (CKShouldUseModernRippleAnimation())
          {
            mentionsController = [(CKChatController *)self mentionsController];
            [mentionsController setTextEffectsDelegate:self];
          }

          [(CKChatController *)self setEntryView:v129];
          v97 = [[CKMessageEntryViewContainerView alloc] initWithFrame:v67, v69, v71, v73];
          [(CKMessageEntryViewContainerView *)v97 setEntryViewContainerViewDelegate:self];
          [(CKMessageEntryViewContainerView *)v97 setTranslatesAutoresizingMaskIntoConstraints:1];
          [(CKMessageEntryViewContainerView *)v97 setAutoresizingMask:18];
          [(CKMessageEntryViewContainerView *)v97 addSubview:v129];
          [(CKChatController *)self setEntryViewContainerView:v97];
          inlineReplyController = [(CKChatController *)self inlineReplyController];

          if (inlineReplyController)
          {
            inlineReplyController2 = [(CKChatController *)self inlineReplyController];
            [inlineReplyController2 setEntryView:v129];

            inlineReplyController3 = [(CKChatController *)self inlineReplyController];
            [(CKMessageEntryView *)v129 setDelegate:inlineReplyController3];
          }

          else
          {
            [(CKMessageEntryView *)v129 setDelegate:self];
          }

          [(CKMessageEntryView *)v129 setClickInteractionDelegate:self];
          isKeyboardVisible = [(CKScrollViewController *)self isKeyboardVisible];
          conversation10 = [(CKCoreChatController *)self conversation];
          [(CKMessageEntryView *)v129 setConversation:conversation10];

          [(CKMessageEntryView *)v129 setKeyboardVisible:isKeyboardVisible];
          contentView3 = [(CKMessageEntryView *)v129 contentView];
          textView3 = [contentView3 textView];

          [textView3 setTextDropDelegate:self];
          [textView3 setPasteDelegate:self];
          v105 = +[CKUIBehavior sharedBehaviors];
          v106 = [v105 pasteConfigurationDisablingKeyboardStickers:v77];

          [textView3 setPasteConfiguration:v106];
          delegate = [(CKCoreChatController *)self delegate];
          v108 = objc_opt_respondsToSelector();

          if (v108)
          {
            delegate2 = [(CKCoreChatController *)self delegate];
            v110 = [delegate2 navigationBarBackdropLayerGroupNameForChatController:self];

            [(CKMessageEntryView *)v129 setBackdropGroupName:v110];
          }

          if ([composition hasContent])
          {
            [(CKMessageEntryView *)v129 setComposition:composition];
          }

          [(CKChatController *)self _updateEntryViewFrameIfNeeded:0];
          [(CKChatController *)self becomeFirstResponder];
          firstResponder = [(CKChatController *)self firstResponder];
          [firstResponder reloadInputViews];

          inputController2 = [(CKCoreChatController *)self inputController];
          [inputController2 setEntryView:v129];
        }

        goto LABEL_71;
      }
    }

    goto LABEL_18;
  }

LABEL_71:
  [(CKChatController *)self addOrRemoveEntryViewIfNeeded];
  [(CKChatController *)self registerForTextInputPayloadHandling];
  entryView12 = [(CKChatController *)self entryView];
  conversation11 = [(CKCoreChatController *)self conversation];
  [entryView12 setConversation:conversation11];

  [CKPPTSubTest stop:@"reloadEntryViewIfNeeded"];
}

- (void)addOrRemoveEntryViewIfNeeded
{
  v56 = *MEMORY[0x1E69E9840];
  v53 = +[CKUIBehavior sharedBehaviors];
  if (([v53 isEntryViewInputAccessory] & 1) == 0)
  {
    v3 = CKIsRunningUITests();

    if (v3)
    {
      return;
    }

    if (IMOSLoggingEnabled())
    {
      v4 = OSLogHandleForIMFoundationCategory();
      if (os_log_type_enabled(v4, OS_LOG_TYPE_INFO))
      {
        *buf = 0;
        _os_log_impl(&dword_19020E000, v4, OS_LOG_TYPE_INFO, "entryView: addOrRemoveEntryViewIfNeeded", buf, 2u);
      }
    }

    view = [(CKChatController *)self view];
    entryViewContainerView = [(CKChatController *)self entryViewContainerView];
    currentDevice = [MEMORY[0x1E69DC938] currentDevice];
    v8 = [currentDevice userInterfaceIdiom] == 1;

    isInHardwareKeyboardMode = [MEMORY[0x1E69DCBB8] isInHardwareKeyboardMode];
    shouldShowEntryView = [(CKChatController *)self shouldShowEntryView];
    if (IMOSLoggingEnabled())
    {
      v11 = OSLogHandleForIMFoundationCategory();
      if (os_log_type_enabled(v11, OS_LOG_TYPE_INFO))
      {
        v12 = @"NO";
        if (shouldShowEntryView)
        {
          v12 = @"YES";
        }

        *buf = 138412290;
        v55 = v12;
        _os_log_impl(&dword_19020E000, v11, OS_LOG_TYPE_INFO, "entryView: shouldRemoveEntryView: %@", buf, 0xCu);
      }
    }

    v13 = isInHardwareKeyboardMode & v8;
    if (!shouldShowEntryView)
    {
      if (entryViewContainerView)
      {
        superview = [entryViewContainerView superview];
        v19 = superview == view;

        if (v19)
        {
          entryViewContainerView2 = [(CKChatController *)self entryViewContainerView];
          [entryViewContainerView2 removeFromSuperview];

          entryView = [(CKChatController *)self entryView];
          [entryView setEntryViewKeyboardLayoutGuide:0];

          if (IMOSLoggingEnabled())
          {
            v22 = OSLogHandleForIMFoundationCategory();
            if (os_log_type_enabled(v22, OS_LOG_TYPE_INFO))
            {
              *buf = 0;
              _os_log_impl(&dword_19020E000, v22, OS_LOG_TYPE_INFO, "entryView: Removed from super view", buf, 2u);
            }
          }
        }
      }

LABEL_34:
      mEMORY[0x1E69A8070] = [MEMORY[0x1E69A8070] sharedFeatureFlags];
      isEntryViewRefreshEnabled = [mEMORY[0x1E69A8070] isEntryViewRefreshEnabled];

      if ((isEntryViewRefreshEnabled & 1) == 0)
      {
        entryView2 = [(CKChatController *)self entryView];
        isInPencilMode = [entryView2 isInPencilMode];

        keyboardCandidateBarBackgroundView = self->_keyboardCandidateBarBackgroundView;
        if ((shouldShowEntryView & (v13 | isInPencilMode)) == 1)
        {
          if (keyboardCandidateBarBackgroundView || !entryViewContainerView)
          {
            goto LABEL_52;
          }

          if (IMOSLoggingEnabled())
          {
            v28 = OSLogHandleForIMFoundationCategory();
            if (os_log_type_enabled(v28, OS_LOG_TYPE_INFO))
            {
              *buf = 0;
              _os_log_impl(&dword_19020E000, v28, OS_LOG_TYPE_INFO, "Adding the keyboardCandidateBarBackgroundView", buf, 2u);
            }
          }

          v29 = +[CKUIBehavior sharedBehaviors];
          entryViewBackgroundClass = [v29 entryViewBackgroundClass];

          v31 = objc_alloc_init(entryViewBackgroundClass);
          delegate = [(CKCoreChatController *)self delegate];
          v33 = objc_opt_respondsToSelector();

          if (v33)
          {
            delegate2 = [(CKCoreChatController *)self delegate];
            v35 = [delegate2 navigationBarBackdropLayerGroupNameForChatController:self];

            [v31 setBackdropGroupName:v35];
          }

          entryView3 = [(CKChatController *)self entryView];
          entryViewTraitCollection = [entryView3 entryViewTraitCollection];
          [v31 setEntryViewTraitCollection:entryViewTraitCollection];

          [entryViewContainerView addSubview:v31];
          [v31 setTranslatesAutoresizingMaskIntoConstraints:0];
          bottomAnchor = [entryViewContainerView bottomAnchor];
          bottomAnchor2 = [v31 bottomAnchor];
          v40 = [bottomAnchor constraintEqualToAnchor:bottomAnchor2];
          [v40 setActive:1];

          leadingAnchor = [entryViewContainerView leadingAnchor];
          leadingAnchor2 = [v31 leadingAnchor];
          v43 = [leadingAnchor constraintEqualToAnchor:leadingAnchor2];
          [v43 setActive:1];

          trailingAnchor = [entryViewContainerView trailingAnchor];
          trailingAnchor2 = [v31 trailingAnchor];
          v46 = [trailingAnchor constraintEqualToAnchor:trailingAnchor2];
          [v46 setActive:1];

          keyboardLayoutGuide = [entryViewContainerView keyboardLayoutGuide];
          topAnchor = [keyboardLayoutGuide topAnchor];
          topAnchor2 = [v31 topAnchor];
          v50 = [topAnchor constraintEqualToAnchor:topAnchor2];
          [v50 setActive:1];

          goto LABEL_51;
        }

        if (keyboardCandidateBarBackgroundView)
        {
          if (IMOSLoggingEnabled())
          {
            v51 = OSLogHandleForIMFoundationCategory();
            if (os_log_type_enabled(v51, OS_LOG_TYPE_INFO))
            {
              *buf = 0;
              _os_log_impl(&dword_19020E000, v51, OS_LOG_TYPE_INFO, "Removing the keyboardCandidateBarBackgroundView", buf, 2u);
            }
          }

          [(CKMessageEntryBackgroundViewProtocol *)self->_keyboardCandidateBarBackgroundView removeFromSuperview];
          v31 = 0;
LABEL_51:
          v52 = self->_keyboardCandidateBarBackgroundView;
          self->_keyboardCandidateBarBackgroundView = v31;
        }
      }

LABEL_52:

      return;
    }

    if (!entryViewContainerView || ([view subviews], v14 = objc_claimAutoreleasedReturnValue(), v15 = objc_msgSend(v14, "containsObject:", entryViewContainerView), v14, (v15 & 1) != 0))
    {
LABEL_27:
      [view bringSubviewToFront:entryViewContainerView];
      goto LABEL_34;
    }

    [view addSubview:entryViewContainerView];
    [(CKChatController *)self setUpEntryViewLayoutConstraintsIfNecessary];
    v16 = +[CKUIBehavior sharedBehaviors];
    if (([v16 isEntryViewFirstResponderOnViewAppearance] & 1) != 0 || self->_entryViewShouldBecomeTargetFirstResponderForPendingDraft)
    {
    }

    else
    {

      if ((v13 & 1) == 0)
      {
LABEL_23:
        [(CKChatController *)self becomeFirstResponder];
        if (IMOSLoggingEnabled())
        {
          v17 = OSLogHandleForIMFoundationCategory();
          if (os_log_type_enabled(v17, OS_LOG_TYPE_INFO))
          {
            *buf = 0;
            _os_log_impl(&dword_19020E000, v17, OS_LOG_TYPE_INFO, "entryView: added to view", buf, 2u);
          }
        }

        goto LABEL_27;
      }
    }

    [(CKChatController *)self setTargetFirstResponder:1];
    self->_entryViewShouldBecomeTargetFirstResponderForPendingDraft = 0;
    goto LABEL_23;
  }
}

- (BOOL)shouldShowEntryView
{
  if (([(CKChatController *)self isViewLoaded]& 1) == 0)
  {
    if (!IMOSLoggingEnabled())
    {
      return 0;
    }

    v11 = OSLogHandleForIMFoundationCategory();
    if (!os_log_type_enabled(v11, OS_LOG_TYPE_INFO))
    {
      goto LABEL_31;
    }

    *v23 = 0;
    v12 = "Not inserting entry view because view is nil";
LABEL_30:
    _os_log_impl(&dword_19020E000, v11, OS_LOG_TYPE_INFO, v12, v23, 2u);
    goto LABEL_31;
  }

  entryView = [(CKChatController *)self entryView];

  if (!entryView)
  {
    if (!IMOSLoggingEnabled())
    {
      return 0;
    }

    v11 = OSLogHandleForIMFoundationCategory();
    if (!os_log_type_enabled(v11, OS_LOG_TYPE_INFO))
    {
      goto LABEL_31;
    }

    *v23 = 0;
    v12 = "Not inserting entry view because entryView is nil";
    goto LABEL_30;
  }

  if (![(CKChatController *)self entryViewRequiresCollectionView]|| ([(CKChatController *)self collectionView], v4 = objc_claimAutoreleasedReturnValue(), v4, v4))
  {
    conversation = [(CKCoreChatController *)self conversation];
    chat = [conversation chat];
    mEMORY[0x1E69A8070] = [MEMORY[0x1E69A8070] sharedFeatureFlags];
    isTranscriptSharingEnabled = [mEMORY[0x1E69A8070] isTranscriptSharingEnabled];

    if (isTranscriptSharingEnabled && [chat isStewieSharingChat])
    {
      if (IMOSLoggingEnabled())
      {
        v9 = OSLogHandleForIMFoundationCategory();
        if (os_log_type_enabled(v9, OS_LOG_TYPE_INFO))
        {
          *v23 = 0;
          v10 = "Hiding entry view for Stewie Transcript Sharing";
LABEL_73:
          _os_log_impl(&dword_19020E000, v9, OS_LOG_TYPE_INFO, v10, v23, 2u);
          goto LABEL_74;
        }

        goto LABEL_74;
      }
    }

    else if ([chat isStewieEmergencyChat] && (objc_msgSend(MEMORY[0x1E69A5B00], "sharedInstance"), v13 = objc_claimAutoreleasedReturnValue(), v14 = objc_msgSend(v13, "isStewieEmergencyActive"), v13, (v14 & 1) == 0))
    {
      if (IMOSLoggingEnabled())
      {
        v9 = OSLogHandleForIMFoundationCategory();
        if (os_log_type_enabled(v9, OS_LOG_TYPE_INFO))
        {
          *v23 = 0;
          v10 = "Hiding entry view for Stewie emergency";
          goto LABEL_73;
        }

        goto LABEL_74;
      }
    }

    else if ([chat isStewieRoadsideChat] && (objc_msgSend(MEMORY[0x1E69A5B00], "sharedInstance"), v15 = objc_claimAutoreleasedReturnValue(), v16 = objc_msgSend(v15, "isStewieRoadsideActive"), v15, (v16 & 1) == 0))
    {
      if (IMOSLoggingEnabled())
      {
        v9 = OSLogHandleForIMFoundationCategory();
        if (os_log_type_enabled(v9, OS_LOG_TYPE_INFO))
        {
          *v23 = 0;
          v10 = "Hiding entry view for Stewie roadside";
          goto LABEL_73;
        }

        goto LABEL_74;
      }
    }

    else
    {
      mEMORY[0x1E6994658] = [MEMORY[0x1E6994658] sharedSystemShellSwitcher];
      isClarityBoardEnabled = [mEMORY[0x1E6994658] isClarityBoardEnabled];

      if ((isClarityBoardEnabled & 1) == 0)
      {
        if (-[CKChatController isShowingOscarChat](self, "isShowingOscarChat") && ([chat isSMS] & 1) == 0 && objc_msgSend(chat, "allowsJunkConfiguration"))
        {
          if (IMOSLoggingEnabled())
          {
            v9 = OSLogHandleForIMFoundationCategory();
            if (os_log_type_enabled(v9, OS_LOG_TYPE_INFO))
            {
              *v23 = 0;
              v10 = "Hiding entry view for Oscar";
              goto LABEL_73;
            }

LABEL_74:
          }
        }

        else if ([conversation hasLeftGroupChat])
        {
          if (IMOSLoggingEnabled())
          {
            v9 = OSLogHandleForIMFoundationCategory();
            if (os_log_type_enabled(v9, OS_LOG_TYPE_INFO))
            {
              *v23 = 0;
              v10 = "Hiding entry view because the user has left the group chat";
              goto LABEL_73;
            }

            goto LABEL_74;
          }
        }

        else if ([(CKCoreChatController *)self isReadOnly])
        {
          if (IMOSLoggingEnabled())
          {
            v9 = OSLogHandleForIMFoundationCategory();
            if (os_log_type_enabled(v9, OS_LOG_TYPE_INFO))
            {
              *v23 = 0;
              v10 = "Hiding entry view because the chat is read only";
              goto LABEL_73;
            }

            goto LABEL_74;
          }
        }

        else if ([conversation isBusinessChatDisabled] && (objc_msgSend(conversation, "isChatBot") & 1) == 0)
        {
          if (IMOSLoggingEnabled())
          {
            v9 = OSLogHandleForIMFoundationCategory();
            if (os_log_type_enabled(v9, OS_LOG_TYPE_INFO))
            {
              *v23 = 0;
              v10 = "Hiding entry view because business chat is disabled";
              goto LABEL_73;
            }

            goto LABEL_74;
          }
        }

        else if ([conversation hasReplyEnabled])
        {
          if (chat && ([chat allowedByScreenTime] & 1) == 0)
          {
            if (IMOSLoggingEnabled())
            {
              v9 = OSLogHandleForIMFoundationCategory();
              if (os_log_type_enabled(v9, OS_LOG_TYPE_INFO))
              {
                *v23 = 0;
                v10 = "Hiding entry view because chat is screentime blocked";
                goto LABEL_73;
              }

              goto LABEL_74;
            }
          }

          else if ([(CKCoreChatController *)self isShowingLockoutView])
          {
            if (IMOSLoggingEnabled())
            {
              v9 = OSLogHandleForIMFoundationCategory();
              if (os_log_type_enabled(v9, OS_LOG_TYPE_INFO))
              {
                *v23 = 0;
                v10 = "Hiding entry view while the screentime lockout view is being shown";
                goto LABEL_73;
              }

              goto LABEL_74;
            }
          }

          else if ([(CKChatController *)self isEditing])
          {
            if (IMOSLoggingEnabled())
            {
              v9 = OSLogHandleForIMFoundationCategory();
              if (os_log_type_enabled(v9, OS_LOG_TYPE_INFO))
              {
                *v23 = 0;
                v10 = "Hiding entry view because the user is editing the chat";
                goto LABEL_73;
              }

              goto LABEL_74;
            }
          }

          else if ([(CKChatController *)self isShowingPreview])
          {
            if (IMOSLoggingEnabled())
            {
              v9 = OSLogHandleForIMFoundationCategory();
              if (os_log_type_enabled(v9, OS_LOG_TYPE_INFO))
              {
                *v23 = 0;
                v10 = "Hiding entry view while the user is viewing a preview";
                goto LABEL_73;
              }

              goto LABEL_74;
            }
          }

          else
          {
            if (![chat isGroupChat] || (objc_msgSend(chat, "participants"), v21 = objc_claimAutoreleasedReturnValue(), v22 = objc_msgSend(v21, "count"), v21, v22 != 1))
            {
              v19 = 1;
              goto LABEL_76;
            }

            if (IMOSLoggingEnabled())
            {
              v9 = OSLogHandleForIMFoundationCategory();
              if (!os_log_type_enabled(v9, OS_LOG_TYPE_INFO))
              {
                goto LABEL_74;
              }

              *v23 = 0;
              v10 = "Hiding entry view while the user is viewing an unnamed single-participant group";
              goto LABEL_73;
            }
          }
        }

        else if (IMOSLoggingEnabled())
        {
          v9 = OSLogHandleForIMFoundationCategory();
          if (os_log_type_enabled(v9, OS_LOG_TYPE_INFO))
          {
            *v23 = 0;
            v10 = "Hiding entry view because hasReplyEnabled is false";
            goto LABEL_73;
          }

          goto LABEL_74;
        }
      }
    }

    v19 = 0;
LABEL_76:

    return v19;
  }

  if (IMOSLoggingEnabled())
  {
    v11 = OSLogHandleForIMFoundationCategory();
    if (os_log_type_enabled(v11, OS_LOG_TYPE_INFO))
    {
      *v23 = 0;
      v12 = "Not inserting entry view because collectionView is nil";
      goto LABEL_30;
    }

LABEL_31:
  }

  return 0;
}

- (void)loadChatInputController
{
  mEMORY[0x1E69A8070] = [MEMORY[0x1E69A8070] sharedFeatureFlags];
  isTranscriptSharingEnabled = [mEMORY[0x1E69A8070] isTranscriptSharingEnabled];

  if (!isTranscriptSharingEnabled || (-[CKCoreChatController conversation](self, "conversation"), v5 = objc_claimAutoreleasedReturnValue(), [v5 chat], v6 = objc_claimAutoreleasedReturnValue(), v7 = objc_msgSend(v6, "isStewieSharingChat"), v6, v5, (v7 & 1) == 0))
  {
    inputController = [(CKCoreChatController *)self inputController];

    if (!inputController)
    {
      v10 = objc_alloc_init(CKChatInputController);
      [(CKChatInputController *)v10 set_isRunningPPT:[(CKChatController *)self _isRunningPPT]];
      [(CKCoreChatController *)self setInputController:v10];
      [(CKChatInputController *)v10 setDelegate:self];
      WeakRetained = objc_loadWeakRetained(&self->_externalPluginControllerProvider);
      [(CKChatInputController *)v10 setExternalPluginControllerProvider:WeakRetained];
    }
  }
}

- (BOOL)_CKRunningInSOSBuddy
{
  if (_CKRunningInSOSBuddy_onceToken != -1)
  {
    [CKChatController _CKRunningInSOSBuddy];
  }

  return _CKRunningInSOSBuddy_sIsRunningInSOSBuddy;
}

CFStringRef __40__CKChatController__CKRunningInSOSBuddy__block_invoke()
{
  MainBundle = CFBundleGetMainBundle();
  result = CFBundleGetIdentifier(MainBundle);
  if (result)
  {
    result = CFEqual(result, @"com.apple.SOSBuddy");
    v2 = result != 0;
  }

  else
  {
    v2 = 0;
  }

  _CKRunningInSOSBuddy_sIsRunningInSOSBuddy = v2;
  return result;
}

- (void)viewSafeAreaInsetsDidChange
{
  v6.receiver = self;
  v6.super_class = CKChatController;
  [(CKScrollViewController *)&v6 viewSafeAreaInsetsDidChange];
  [(CKChatController *)self _updateEntryViewFrameIfNeeded:0];
  view = [(CKChatController *)self view];
  [view bounds];
  [(CKChatController *)self _invalidateChatItemLayoutIfNecessary:v4, v5];
}

- (CGRect)inputAccessoryViewFrameForFloatingKeyboard
{
  entryView = [(CKChatController *)self entryView];
  [entryView frame];
  v4 = v3;
  v6 = v5;
  v8 = v7;
  v10 = v9;

  v11 = v4;
  v12 = v6;
  v13 = v8;
  v14 = v10;
  result.size.height = v14;
  result.size.width = v13;
  result.origin.y = v12;
  result.origin.x = v11;
  return result;
}

- (void)_updateEntryViewFrameIfNeeded:(BOOL)needed
{
  neededCopy = needed;
  entryView = [(CKChatController *)self entryView];
  window = [entryView window];

  if (window)
  {
    view = [(CKChatController *)self view];
    [view bounds];
    v8 = v7;

    [(CKChatController *)self _maxEntryViewHeight];
    v10 = v9;
    mEMORY[0x1E69A8070] = [MEMORY[0x1E69A8070] sharedFeatureFlags];
    isModernSplitViewControllerEnabled = [mEMORY[0x1E69A8070] isModernSplitViewControllerEnabled];

    if (isModernSplitViewControllerEnabled)
    {
      view2 = [(CKChatController *)self view];
      [view2 safeAreaInsets];
      v15 = v14;
      view3 = [(CKChatController *)self view];
      [view3 safeAreaInsets];
      v18 = v17;
      view4 = [(CKChatController *)self view];
      [view4 safeAreaInsets];
      v8 = v8 - (v18 + v20);
    }

    else
    {
      v15 = 0.0;
    }

    entryView2 = [(CKChatController *)self entryView];
    [entryView2 frame];
    v23 = v22;
    v25 = v24;

    if (v23 != v8 || v25 != v10)
    {
      [(CKChatController *)self _setAvoidanceInsetsNeedsUpdate];
      [(CKChatController *)self setupScrollingForKeyboardInteraction];
      isKeyboardFloating = [(CKScrollViewController *)self isKeyboardFloating];
      [(CKChatController *)self _setEntryViewFrame:neededCopy animated:v15, 0.0, v8, v10];
      if (isKeyboardFloating)
      {
        [(CKScrollViewController *)self inputAccessoryViewFrameUpdatedForFloatingKeyboard];
      }

      entryView3 = [(CKChatController *)self entryView];
      composition = [entryView3 composition];
      hasContent = [composition hasContent];

      if (hasContent)
      {
        [(CKChatController *)self dismissTipIfPresented];
      }
    }
  }
}

- (void)__setEntryViewFrame:(CGRect)frame
{
  height = frame.size.height;
  width = frame.size.width;
  y = frame.origin.y;
  x = frame.origin.x;
  entryView = [(CKChatController *)self entryView];
  v8 = +[CKUIBehavior sharedBehaviors];
  entryViewFollowsKeyboardLayoutGuide = [v8 entryViewFollowsKeyboardLayoutGuide];

  if (entryViewFollowsKeyboardLayoutGuide)
  {
    heightConstraint = [entryView heightConstraint];
    [heightConstraint constant];
    if (vabdd_f64(height, v11) <= 0.001)
    {

      goto LABEL_9;
    }

    [heightConstraint setConstant:height];
  }

  else
  {
    mEMORY[0x1E69A8070] = [MEMORY[0x1E69A8070] sharedFeatureFlags];
    isModernSplitViewControllerEnabled = [mEMORY[0x1E69A8070] isModernSplitViewControllerEnabled];

    if ((isModernSplitViewControllerEnabled & 1) == 0)
    {
      [entryView setFrame:{x, y, width, height}];
      goto LABEL_9;
    }

    [entryView frame];
    v18 = CKRectApproximatelyEqualToRectWithTolerance(v14, v15, v16, v17, x, y, width, height, 0.001);
    [entryView setFrame:{x, y, width, height}];
    v19 = entryView;
    if (v18)
    {
      goto LABEL_10;
    }
  }

  [entryView layoutIfNeeded];
  [(CKChatController *)self _layoutEntryViewSuperview];
LABEL_9:
  v19 = entryView;
LABEL_10:
}

- (void)_setEntryViewFrame:(CGRect)frame isContentChange:(BOOL)change animated:(BOOL)animated completionHandler:(id)handler
{
  animatedCopy = animated;
  changeCopy = change;
  height = frame.size.height;
  width = frame.size.width;
  y = frame.origin.y;
  x = frame.origin.x;
  v49 = *MEMORY[0x1E69E9840];
  handlerCopy = handler;
  entryView = [(CKChatController *)self entryView];
  if (IMOSLoggingEnabled())
  {
    v15 = OSLogHandleForIMFoundationCategory();
    if (os_log_type_enabled(v15, OS_LOG_TYPE_INFO))
    {
      v50.origin.x = x;
      v50.origin.y = y;
      v50.size.width = width;
      v50.size.height = height;
      v16 = NSStringFromCGRect(v50);
      *buf = 138412290;
      v48 = v16;
      _os_log_impl(&dword_19020E000, v15, OS_LOG_TYPE_INFO, "entryView: setting entry view frame: %@", buf, 0xCu);
    }
  }

  [entryView frame];
  if (v18 != width || v17 != height)
  {
    if (animatedCopy)
    {
      if (![(CKChatController *)self isEntryViewResizeAnimationRunning]&& changeCopy)
      {
        v20 = MEMORY[0x1E69DD250];
        v45[0] = MEMORY[0x1E69E9820];
        v45[1] = 3221225472;
        v45[2] = __82__CKChatController__setEntryViewFrame_isContentChange_animated_completionHandler___block_invoke;
        v45[3] = &unk_1E72EBA18;
        v46 = entryView;
        [v20 performWithoutAnimation:v45];
      }

      [(CKChatController *)self setEntryViewResizeAnimationRunning:1];
      if ([entryView shouldUseLinearResizeForAudioMessage])
      {
        v21 = +[CKUIBehavior sharedBehaviors];
        [v21 audioMessagePeakAnimationDuration];
        v23 = v22;

        v24 = [objc_alloc(MEMORY[0x1E69DC908]) initWithAnimationCurve:3];
      }

      else
      {
        v24 = objc_alloc_init(MEMORY[0x1E69DCF88]);
        [v24 settlingDuration];
        v23 = v26;
      }

      v27 = [objc_alloc(MEMORY[0x1E69DD278]) initWithDuration:v24 timingParameters:v23];
      v44[0] = MEMORY[0x1E69E9820];
      v44[1] = 3221225472;
      v44[2] = __82__CKChatController__setEntryViewFrame_isContentChange_animated_completionHandler___block_invoke_2;
      v44[3] = &unk_1E72EC7B0;
      v44[4] = self;
      *&v44[5] = x;
      *&v44[6] = y;
      *&v44[7] = width;
      *&v44[8] = height;
      [v27 addAnimations:v44];
      v42[0] = MEMORY[0x1E69E9820];
      v42[1] = 3221225472;
      v42[2] = __82__CKChatController__setEntryViewFrame_isContentChange_animated_completionHandler___block_invoke_3;
      v42[3] = &unk_1E72ED778;
      v42[4] = self;
      v43 = handlerCopy;
      [v27 addCompletion:v42];
      [v27 startAnimation];
    }

    else
    {
      [(CKChatController *)self setEntryViewResizeAnimationRunning:1];
      v25 = MEMORY[0x1E69DD250];
      v41[0] = MEMORY[0x1E69E9820];
      v41[1] = 3221225472;
      v41[2] = __82__CKChatController__setEntryViewFrame_isContentChange_animated_completionHandler___block_invoke_4;
      v41[3] = &unk_1E72EC7B0;
      v41[4] = self;
      *&v41[5] = x;
      *&v41[6] = y;
      *&v41[7] = width;
      *&v41[8] = height;
      v39[0] = MEMORY[0x1E69E9820];
      v39[1] = 3221225472;
      v39[2] = __82__CKChatController__setEntryViewFrame_isContentChange_animated_completionHandler___block_invoke_5;
      v39[3] = &unk_1E72ED638;
      v39[4] = self;
      v40 = handlerCopy;
      [v25 animateWithDuration:v41 animations:v39 completion:0.0];

      v23 = 0.0;
    }

    [(CKChatController *)self _setAvoidanceInsetsNeedsUpdate];
    entryView2 = [(CKChatController *)self entryView];
    entryViewKeyboardLayoutGuide = [entryView2 entryViewKeyboardLayoutGuide];

    [entryViewKeyboardLayoutGuide setKeyboardDismissPadding:height];
    inputController = [(CKCoreChatController *)self inputController];
    [inputController setAppCardDismissPadding:height];

    v31 = +[CKUIBehavior sharedBehaviors];
    isEntryViewInputAccessory = [v31 isEntryViewInputAccessory];

    if ((isEntryViewInputAccessory & 1) == 0)
    {
      collectionViewController = [(CKCoreChatController *)self collectionViewController];
      collectionView = [collectionViewController collectionView];

      [collectionView beginDisablingTranscriptDynamicsForReason:13];
      if (animatedCopy)
      {
        [(CKScrollViewController *)self updateScrollGeometryForReason:@"EntryViewFrameChanged" withDuration:3 animationCurve:v23];
        v35 = dispatch_time(0, (v23 * 1000000000.0));
        block[0] = MEMORY[0x1E69E9820];
        block[1] = 3221225472;
        block[2] = __82__CKChatController__setEntryViewFrame_isContentChange_animated_completionHandler___block_invoke_6;
        block[3] = &unk_1E72ED1C8;
        v37 = collectionView;
        v38 = handlerCopy;
        dispatch_after(v35, MEMORY[0x1E69E96A0], block);
      }

      else
      {
        [(CKScrollViewController *)self updateScrollGeometryWithoutAnimationForReason:@"EntryViewFrameChanged"];
        [collectionView endDisablingTranscriptDynamicsForReason:13];
        handlerCopy[2](handlerCopy);
      }
    }
  }
}

void __82__CKChatController__setEntryViewFrame_isContentChange_animated_completionHandler___block_invoke_2(uint64_t a1)
{
  [*(a1 + 32) __setEntryViewFrame:{*(a1 + 40), *(a1 + 48), *(a1 + 56), *(a1 + 64)}];
  v3 = [*(a1 + 32) entryView];
  v2 = [v3 contentView];
  [v2 setNeedsLayout];
}

void __82__CKChatController__setEntryViewFrame_isContentChange_animated_completionHandler___block_invoke_3(uint64_t a1)
{
  [*(a1 + 32) setEntryViewResizeAnimationRunning:0];
  v2 = +[CKUIBehavior sharedBehaviors];
  v3 = [v2 isEntryViewInputAccessory];

  if (v3)
  {
    v4 = *(*(a1 + 40) + 16);

    v4();
  }
}

void __82__CKChatController__setEntryViewFrame_isContentChange_animated_completionHandler___block_invoke_4(uint64_t a1)
{
  [*(a1 + 32) __setEntryViewFrame:{*(a1 + 40), *(a1 + 48), *(a1 + 56), *(a1 + 64)}];
  v3 = [*(a1 + 32) entryView];
  v2 = [v3 contentView];
  [v2 setNeedsLayout];
}

void __82__CKChatController__setEntryViewFrame_isContentChange_animated_completionHandler___block_invoke_5(uint64_t a1)
{
  [*(a1 + 32) setEntryViewResizeAnimationRunning:0];
  v2 = +[CKUIBehavior sharedBehaviors];
  v3 = [v2 isEntryViewInputAccessory];

  if (v3)
  {
    v4 = *(*(a1 + 40) + 16);

    v4();
  }
}

uint64_t __82__CKChatController__setEntryViewFrame_isContentChange_animated_completionHandler___block_invoke_6(uint64_t a1)
{
  [*(a1 + 32) endDisablingTranscriptDynamicsForReason:13];
  v2 = *(*(a1 + 40) + 16);

  return v2();
}

- (void)_setUpEntryViewChatFooterViewLayoutConstraint
{
  entryView = [(CKChatController *)self entryView];
  chatFooterView = [(CKChatController *)self chatFooterView];
  if (chatFooterView)
  {
    bottomAnchor = [entryView bottomAnchor];
    topAnchor = [chatFooterView topAnchor];
    v6 = [bottomAnchor constraintEqualToAnchor:topAnchor];
    entryViewChatFooterViewLayoutConstraint = self->_entryViewChatFooterViewLayoutConstraint;
    self->_entryViewChatFooterViewLayoutConstraint = v6;
  }

  else
  {
    bottomAnchor = self->_entryViewChatFooterViewLayoutConstraint;
    self->_entryViewChatFooterViewLayoutConstraint = 0;
  }
}

- (BOOL)_backgroundEligibleForTranscriptDocking
{
  v14.receiver = self;
  v14.super_class = CKChatController;
  _backgroundEligibleForTranscriptDocking = [(CKCoreChatController *)&v14 _backgroundEligibleForTranscriptDocking];
  if (_backgroundEligibleForTranscriptDocking)
  {
    if (([(CKChatController *)self isEditing]& 1) != 0 || [(CKScrollViewController *)self isKeyboardVisible])
    {
      LOBYTE(_backgroundEligibleForTranscriptDocking) = 0;
    }

    else
    {
      inputController = [(CKCoreChatController *)self inputController];
      isAppCardPresented = [inputController isAppCardPresented];

      inputController2 = [(CKCoreChatController *)self inputController];
      isAppCardAppearing = [inputController2 isAppCardAppearing];

      inputController3 = [(CKCoreChatController *)self inputController];
      isAppCardDismissing = [inputController3 isAppCardDismissing];

      LOBYTE(_backgroundEligibleForTranscriptDocking) = 0;
      if ((isAppCardPresented & 1) == 0 && (isAppCardAppearing & 1) == 0 && (isAppCardDismissing & 1) == 0)
      {
        dragSession = [(CKChatController *)self dragSession];

        dropSession = [(CKChatController *)self dropSession];
        v12 = dragSession | dropSession;

        LOBYTE(_backgroundEligibleForTranscriptDocking) = v12 == 0;
      }
    }
  }

  return _backgroundEligibleForTranscriptDocking;
}

- (UIEdgeInsets)adjustedContentInsetsForComputedInsets:(UIEdgeInsets)insets
{
  right = insets.right;
  bottom = insets.bottom;
  left = insets.left;
  top = insets.top;
  [(CKCoreChatController *)self _updateTranscriptDockingStateIfNeeded];
  if ([(CKCoreChatController *)self isTranscriptDockingEnabled])
  {
    collectionViewController = [(CKCoreChatController *)self collectionViewController];
    indexPathForLastMessagePart = [collectionViewController indexPathForLastMessagePart];

    collectionView = [(CKChatController *)self collectionView];
    collectionViewLayout = [collectionView collectionViewLayout];
    v12 = [collectionViewLayout layoutAttributesForItemAtIndexPath:indexPathForLastMessagePart];

    collectionView2 = [(CKChatController *)self collectionView];
    collectionViewLayout2 = [collectionView2 collectionViewLayout];
    [collectionViewLayout2 collectionViewContentSize];
    v16 = v15;
    v18 = v17;

    if (v12 && [(CKCoreChatController *)self _transcriptContentSizeEligibleForTranscriptDocking:v16, v18])
    {
      view = [(CKChatController *)self view];
      [view bounds];
      Height = CGRectGetHeight(v44);

      v41 = Height - top;
      [v12 frame];
      x = v45.origin.x;
      y = v45.origin.y;
      width = v45.size.width;
      v24 = v45.size.height;
      v43 = right;
      v25 = CGRectGetHeight(v45);
      v26 = +[CKUIBehavior sharedBehaviors];
      [v26 transcriptDockingMaximumBalloonHeight];
      v42 = left;
      v28 = v27;

      if (v25 >= v28)
      {
        v25 = v28;
      }

      v46.origin.x = x;
      v46.origin.y = y;
      v46.size.width = width;
      v46.size.height = v24;
      v29 = v18 - (y + CGRectGetHeight(v46) - v25);
      collectionView3 = [(CKChatController *)self collectionView];
      [collectionView3 bounds];
      v32 = v31;
      v33 = +[CKUIBehavior sharedBehaviors];
      [v33 transcriptDockingMaximumBalloonHeight];
      v35 = v32 - (top + v34 * 3.0);

      if (v29 >= v35)
      {
        v36 = v35;
      }

      else
      {
        v36 = v29;
      }

      left = v42;
      right = v43;
      bottom = v41 - v36;
    }
  }

  v37 = top;
  v38 = left;
  v39 = bottom;
  v40 = right;
  result.right = v40;
  result.bottom = v39;
  result.left = v38;
  result.top = v37;
  return result;
}

- (void)setUpEntryViewLayoutConstraintsIfNecessary
{
  v56 = *MEMORY[0x1E69E9840];
  if (IMOSLoggingEnabled())
  {
    v3 = OSLogHandleForIMFoundationCategory();
    if (os_log_type_enabled(v3, OS_LOG_TYPE_INFO))
    {
      LOWORD(v54) = 0;
      _os_log_impl(&dword_19020E000, v3, OS_LOG_TYPE_INFO, "setUpEntryViewLayoutConstraintsIfNecessary", &v54, 2u);
    }
  }

  v4 = +[CKUIBehavior sharedBehaviors];
  entryViewFollowsKeyboardLayoutGuide = [v4 entryViewFollowsKeyboardLayoutGuide];

  if (entryViewFollowsKeyboardLayoutGuide)
  {
    entryView = [(CKChatController *)self entryView];
    superview = [entryView superview];
    if (superview)
    {
      if (!self->_entryViewLeadingLayoutConstraint)
      {
        mEMORY[0x1E69A8070] = [MEMORY[0x1E69A8070] sharedFeatureFlags];
        isModernSplitViewControllerEnabled = [mEMORY[0x1E69A8070] isModernSplitViewControllerEnabled];

        if (isModernSplitViewControllerEnabled)
        {
          safeAreaLayoutGuide = [superview safeAreaLayoutGuide];
          leadingAnchor = [safeAreaLayoutGuide leadingAnchor];
        }

        else
        {
          leadingAnchor = [superview leadingAnchor];
        }

        leadingAnchor2 = [entryView leadingAnchor];
        v15 = [leadingAnchor2 constraintEqualToAnchor:leadingAnchor];
        entryViewLeadingLayoutConstraint = self->_entryViewLeadingLayoutConstraint;
        self->_entryViewLeadingLayoutConstraint = v15;

        [(NSLayoutConstraint *)self->_entryViewLeadingLayoutConstraint setActive:1];
      }

      if (!self->_entryViewTrailingLayoutConstraint)
      {
        mEMORY[0x1E69A8070]2 = [MEMORY[0x1E69A8070] sharedFeatureFlags];
        isModernSplitViewControllerEnabled2 = [mEMORY[0x1E69A8070]2 isModernSplitViewControllerEnabled];

        if (isModernSplitViewControllerEnabled2)
        {
          safeAreaLayoutGuide2 = [superview safeAreaLayoutGuide];
          trailingAnchor = [safeAreaLayoutGuide2 trailingAnchor];
        }

        else
        {
          trailingAnchor = [superview trailingAnchor];
        }

        trailingAnchor2 = [entryView trailingAnchor];
        v22 = [trailingAnchor2 constraintEqualToAnchor:trailingAnchor];
        entryViewTrailingLayoutConstraint = self->_entryViewTrailingLayoutConstraint;
        self->_entryViewTrailingLayoutConstraint = v22;

        [(NSLayoutConstraint *)self->_entryViewTrailingLayoutConstraint setActive:1];
      }

      mEMORY[0x1E69A8070]3 = [MEMORY[0x1E69A8070] sharedFeatureFlags];
      isEntryViewUsesKeyboardLayoutGuideEnabled = [mEMORY[0x1E69A8070]3 isEntryViewUsesKeyboardLayoutGuideEnabled];

      if (isEntryViewUsesKeyboardLayoutGuideEnabled)
      {
        keyboardLayoutGuide = [superview keyboardLayoutGuide];
        [keyboardLayoutGuide setFollowsUndockedKeyboard:0];
        [keyboardLayoutGuide followUndockedKeyboardOfTypes:28];
        v27 = +[CKUIBehavior sharedBehaviors];
        [keyboardLayoutGuide setIgnoresSafeArea:{objc_msgSend(v27, "entryFieldShouldUseBackdropView")}];

        entryView2 = [(CKChatController *)self entryView];
        [entryView2 setEntryViewKeyboardLayoutGuide:keyboardLayoutGuide];

        entryViewKeyboardLayoutConstraint = self->_entryViewKeyboardLayoutConstraint;
        if (entryViewKeyboardLayoutConstraint)
        {
          [(NSLayoutConstraint *)entryViewKeyboardLayoutConstraint setActive:0];
        }

        bottomAnchor = [entryView bottomAnchor];
        topAnchor = [keyboardLayoutGuide topAnchor];
        v32 = [bottomAnchor constraintEqualToAnchor:topAnchor];
        v33 = self->_entryViewKeyboardLayoutConstraint;
        self->_entryViewKeyboardLayoutConstraint = v32;

        if (self->_entryViewContainerView)
        {
          bottomAnchor2 = [entryView bottomAnchor];
          bottomAnchor3 = [(CKMessageEntryViewContainerView *)self->_entryViewContainerView bottomAnchor];
          v36 = [bottomAnchor2 constraintEqualToAnchor:bottomAnchor3];
          [(CKMessageEntryViewContainerView *)self->_entryViewContainerView setEntryViewStuckToChatControllerBottomLayoutConstraint:v36];
        }

        if (IMOSLoggingEnabled())
        {
          v37 = OSLogHandleForIMFoundationCategory();
          if (os_log_type_enabled(v37, OS_LOG_TYPE_INFO))
          {
            v54 = 138412290;
            v55 = keyboardLayoutGuide;
            _os_log_impl(&dword_19020E000, v37, OS_LOG_TYPE_INFO, "entryView: set entry view to keyboard top anchor: %@", &v54, 0xCu);
          }
        }
      }

      else
      {
        bottomAnchor4 = [superview bottomAnchor];
        bottomAnchor5 = [entryView bottomAnchor];
        v40 = [bottomAnchor4 constraintEqualToAnchor:bottomAnchor5 constant:0.0];
        entryViewFauxKeyboardLayoutConstraint = self->_entryViewFauxKeyboardLayoutConstraint;
        self->_entryViewFauxKeyboardLayoutConstraint = v40;

        [(CKScrollViewController *)self keyboardFrameInViewCoordinates];
        [(CKChatController *)self _updateFauxKeyboardLayoutGuideIfNeededWithKeyboardFrame:?];
      }

      [superview bounds];
      [entryView sizeThatFits:{v42, 1.79769313e308}];
      v44 = v43;
      heightConstraint = [entryView heightConstraint];
      v46 = heightConstraint == 0;

      if (v46)
      {
        heightAnchor = [entryView heightAnchor];
        v48 = [heightAnchor constraintEqualToConstant:v44];
        [entryView setHeightConstraint:v48];
      }

      else
      {
        heightAnchor = [entryView heightConstraint];
        [heightAnchor setConstant:v44];
      }

      if (IMOSLoggingEnabled())
      {
        v49 = OSLogHandleForIMFoundationCategory();
        if (os_log_type_enabled(v49, OS_LOG_TYPE_INFO))
        {
          v50 = MEMORY[0x1E696AD98];
          heightConstraint2 = [entryView heightConstraint];
          [heightConstraint2 constant];
          v52 = [v50 numberWithDouble:?];
          v54 = 138412290;
          v55 = v52;
          _os_log_impl(&dword_19020E000, v49, OS_LOG_TYPE_INFO, "entryView: heightConstraint.constant: %@", &v54, 0xCu);
        }
      }

      heightConstraint3 = [entryView heightConstraint];
      [heightConstraint3 setActive:1];

      [(CKChatController *)self _setUpEntryViewAppCardLayoutConstraint];
      [(CKChatController *)self _setUpEntryViewChatFooterViewLayoutConstraint];
      [(CKChatController *)self updateActiveEntryViewPositioningGuide];
      [superview layoutIfNeeded];
      [(CKScrollViewController *)self updateScrollGeometryWithoutAnimationForReason:@"EntryViewCreated"];
    }

    else if (IMOSLoggingEnabled())
    {
      v13 = OSLogHandleForIMFoundationCategory();
      if (os_log_type_enabled(v13, OS_LOG_TYPE_INFO))
      {
        LOWORD(v54) = 0;
        _os_log_impl(&dword_19020E000, v13, OS_LOG_TYPE_INFO, "entryView: not in view hierarchy", &v54, 2u);
      }
    }
  }

  else if (IMOSLoggingEnabled())
  {
    v12 = OSLogHandleForIMFoundationCategory();
    if (os_log_type_enabled(v12, OS_LOG_TYPE_INFO))
    {
      LOWORD(v54) = 0;
      _os_log_impl(&dword_19020E000, v12, OS_LOG_TYPE_INFO, "entryView: not using layout constraints", &v54, 2u);
    }
  }
}

- (void)_updateEntryViewConstraintsIfNeeded
{
  entryView = [(CKChatController *)self entryView];
  window = [entryView window];

  if (window)
  {

    [(CKChatController *)self setUpEntryViewLayoutConstraintsIfNecessary];
  }

  else
  {

    [(CKChatController *)self _invalidateEntryViewConstraints];
  }
}

- (void)_invalidateEntryViewConstraints
{
  if (IMOSLoggingEnabled())
  {
    v3 = OSLogHandleForIMFoundationCategory();
    if (os_log_type_enabled(v3, OS_LOG_TYPE_INFO))
    {
      *v12 = 0;
      _os_log_impl(&dword_19020E000, v3, OS_LOG_TYPE_INFO, "Invalidating entry view constraints.", v12, 2u);
    }
  }

  [(NSLayoutConstraint *)self->_entryViewFauxKeyboardLayoutConstraint setActive:0];
  [(NSLayoutConstraint *)self->_entryViewKeyboardLayoutConstraint setActive:0];
  [(NSLayoutConstraint *)self->_entryViewKeyboardSnapshotLayoutConstraint setActive:0];
  [(NSLayoutConstraint *)self->_entryViewAppCardLayoutConstraint setActive:0];
  [(NSLayoutConstraint *)self->_entryViewChatFooterViewLayoutConstraint setActive:0];
  [(NSLayoutConstraint *)self->_entryViewLeadingLayoutConstraint setActive:0];
  [(NSLayoutConstraint *)self->_entryViewTrailingLayoutConstraint setActive:0];
  entryViewStuckToChatControllerBottomLayoutConstraint = [(CKMessageEntryViewContainerView *)self->_entryViewContainerView entryViewStuckToChatControllerBottomLayoutConstraint];
  [entryViewStuckToChatControllerBottomLayoutConstraint setActive:0];

  entryViewFauxKeyboardLayoutConstraint = self->_entryViewFauxKeyboardLayoutConstraint;
  self->_entryViewFauxKeyboardLayoutConstraint = 0;

  entryViewKeyboardLayoutConstraint = self->_entryViewKeyboardLayoutConstraint;
  self->_entryViewKeyboardLayoutConstraint = 0;

  entryViewKeyboardSnapshotLayoutConstraint = self->_entryViewKeyboardSnapshotLayoutConstraint;
  self->_entryViewKeyboardSnapshotLayoutConstraint = 0;

  entryViewAppCardLayoutConstraint = self->_entryViewAppCardLayoutConstraint;
  self->_entryViewAppCardLayoutConstraint = 0;

  entryViewChatFooterViewLayoutConstraint = self->_entryViewChatFooterViewLayoutConstraint;
  self->_entryViewChatFooterViewLayoutConstraint = 0;

  entryViewLeadingLayoutConstraint = self->_entryViewLeadingLayoutConstraint;
  self->_entryViewLeadingLayoutConstraint = 0;

  entryViewTrailingLayoutConstraint = self->_entryViewTrailingLayoutConstraint;
  self->_entryViewTrailingLayoutConstraint = 0;

  [(CKMessageEntryViewContainerView *)self->_entryViewContainerView setEntryViewStuckToChatControllerBottomLayoutConstraint:0];
}

- (void)_setUpEntryViewAppCardLayoutConstraint
{
  entryView = [(CKChatController *)self entryView];
  window = [entryView window];
  entryViewAppCardLayoutConstraint = self->_entryViewAppCardLayoutConstraint;
  if (window)
  {
    firstItem = [(NSLayoutConstraint *)self->_entryViewAppCardLayoutConstraint firstItem];
    v6 = firstItem;
    if (window == firstItem)
    {
      secondItem = [(NSLayoutConstraint *)self->_entryViewAppCardLayoutConstraint secondItem];
      entryView2 = [(CKChatController *)self entryView];

      if (secondItem == entryView2)
      {
        goto LABEL_8;
      }
    }

    else
    {
    }

    entryViewAppCardLayoutConstraint = [window bottomAnchor];
    bottomAnchor = [entryView bottomAnchor];
    inputController = [(CKCoreChatController *)self inputController];
    [inputController _appCardHeightWithSafeArea];
    v11 = [entryViewAppCardLayoutConstraint constraintEqualToAnchor:bottomAnchor constant:?];
    v12 = self->_entryViewAppCardLayoutConstraint;
    self->_entryViewAppCardLayoutConstraint = v11;
  }

  else
  {
    self->_entryViewAppCardLayoutConstraint = 0;
  }

LABEL_8:
}

- (double)_expectedAppCardAndEntryViewHeight
{
  v24 = *MEMORY[0x1E69E9840];
  if (IMOSLoggingEnabled())
  {
    v3 = OSLogHandleForIMFoundationCategory();
    if (os_log_type_enabled(v3, OS_LOG_TYPE_INFO))
    {
      v4 = MEMORY[0x1E696AD98];
      inputController = [(CKCoreChatController *)self inputController];
      [inputController _appCardHeightWithSafeArea];
      v6 = [v4 numberWithDouble:?];
      v7 = MEMORY[0x1E696AD98];
      entryView = [(CKChatController *)self entryView];
      [entryView frame];
      v10 = [v7 numberWithDouble:v9];
      v18 = 136315650;
      v19 = "[CKChatController _expectedAppCardAndEntryViewHeight]";
      v20 = 2112;
      v21 = v6;
      v22 = 2112;
      v23 = v10;
      _os_log_impl(&dword_19020E000, v3, OS_LOG_TYPE_INFO, "[Tapbacks] %s, : %@ entryView.frame: %@", &v18, 0x20u);
    }
  }

  inputController2 = [(CKCoreChatController *)self inputController];
  [inputController2 _appCardHeightWithSafeArea];
  v13 = v12;
  entryView2 = [(CKChatController *)self entryView];
  [entryView2 frame];
  v16 = v15;

  return v13 + v16;
}

- (void)updateChatItemBalloonViewAndStickerViews:(id)views hidden:(BOOL)hidden
{
  hiddenCopy = hidden;
  viewsCopy = views;
  v7 = objc_opt_new();
  if (hiddenCopy)
  {
    collectionViewController = [(CKCoreChatController *)self collectionViewController];
    v9 = [collectionViewController balloonViewForChatItem:viewsCopy];
    v10 = [collectionViewController indexPathForBalloonView:v9];
    [v7 addIndex:{objc_msgSend(v10, "row")}];
  }

  collectionViewController2 = [(CKCoreChatController *)self collectionViewController];
  [collectionViewController2 setHiddenBalloonViews:v7];

  indexSet = [MEMORY[0x1E696AD50] indexSet];
  if (hiddenCopy)
  {
    visibleAssociatedMessageChatItems = [viewsCopy visibleAssociatedMessageChatItems];
    v15 = MEMORY[0x1E69E9820];
    v16 = 3221225472;
    v17 = __68__CKChatController_updateChatItemBalloonViewAndStickerViews_hidden___block_invoke;
    v18 = &unk_1E72ED7A0;
    selfCopy = self;
    v20 = indexSet;
    [visibleAssociatedMessageChatItems enumerateObjectsUsingBlock:&v15];
  }

  v14 = [(CKCoreChatController *)self collectionViewController:v15];
  [v14 setHiddenAssociatedItems:indexSet];
}

void __68__CKChatController_updateChatItemBalloonViewAndStickerViews_hidden___block_invoke(uint64_t a1, void *a2)
{
  v6 = a2;
  objc_opt_class();
  if (objc_opt_isKindOfClass())
  {
    v3 = [*(a1 + 32) collectionViewController];
    v4 = [v3 associatedChatItems];
    v5 = [v4 indexOfObject:v6];

    [*(a1 + 40) addIndex:v5];
  }
}

- (void)associatedStickerCells:(id *)cells stickerChatItems:(id *)items chatItemGUID:(id)d
{
  dCopy = d;
  collectionViewController = [(CKCoreChatController *)self collectionViewController];
  v10 = [collectionViewController chatItemForGUID:dCopy];

  array = [MEMORY[0x1E695DF70] array];
  array2 = [MEMORY[0x1E695DF70] array];
  visibleAssociatedMessageChatItems = [v10 visibleAssociatedMessageChatItems];
  v17[0] = MEMORY[0x1E69E9820];
  v17[1] = 3221225472;
  v17[2] = __73__CKChatController_associatedStickerCells_stickerChatItems_chatItemGUID___block_invoke;
  v17[3] = &unk_1E72ED7C8;
  v18 = collectionViewController;
  v14 = array;
  v19 = v14;
  v15 = array2;
  v20 = v15;
  v16 = collectionViewController;
  [visibleAssociatedMessageChatItems enumerateObjectsUsingBlock:v17];

  if (cells)
  {
    *cells = [v14 copy];
  }

  if (items)
  {
    *items = [v15 copy];
  }
}

void __73__CKChatController_associatedStickerCells_stickerChatItems_chatItemGUID___block_invoke(id *a1, void *a2)
{
  v8 = a2;
  objc_opt_class();
  isKindOfClass = objc_opt_isKindOfClass();
  v4 = v8;
  if (isKindOfClass)
  {
    v5 = v8;
    v6 = [a1[4] cellForAssociatedChatItem:v5];
    v7 = v6;
    if (v5 && v6)
    {
      [a1[5] addObject:v6];
      [a1[6] addObject:v5];
    }

    v4 = v8;
  }
}

- (void)_updateFauxKeyboardLayoutGuideIfNeededWithKeyboardFrame:(CGRect)frame
{
  height = frame.size.height;
  width = frame.size.width;
  y = frame.origin.y;
  x = frame.origin.x;
  v22 = *MEMORY[0x1E69E9840];
  if (IMOSLoggingEnabled())
  {
    v8 = OSLogHandleForIMFoundationCategory();
    if (os_log_type_enabled(v8, OS_LOG_TYPE_INFO))
    {
      v23.origin.x = x;
      v23.origin.y = y;
      v23.size.width = width;
      v23.size.height = height;
      v9 = NSStringFromCGRect(v23);
      v20 = 138412290;
      v21 = v9;
      _os_log_impl(&dword_19020E000, v8, OS_LOG_TYPE_INFO, "entryView: updating faux keyboard layout guide with keyboard frame: %@", &v20, 0xCu);
    }
  }

  v10 = +[CKUIBehavior sharedBehaviors];
  entryViewFollowsKeyboardLayoutGuide = [v10 entryViewFollowsKeyboardLayoutGuide];

  if (entryViewFollowsKeyboardLayoutGuide && self->_entryViewFauxKeyboardLayoutConstraint)
  {
    isKeyboardUndocked = [(CKScrollViewController *)self isKeyboardUndocked];
    v13 = height <= 0.0 || isKeyboardUndocked;
    v14 = 0.0;
    if ((v13 & 1) == 0)
    {
      view = [(CKChatController *)self view];
      [view bounds];
      v17 = v16;
      v24.origin.x = x;
      v24.origin.y = y;
      v24.size.width = width;
      v24.size.height = height;
      MinY = CGRectGetMinY(v24);

      v14 = v17 - MinY;
    }

    [(NSLayoutConstraint *)self->_entryViewFauxKeyboardLayoutConstraint constant];
    if (vabdd_f64(v19, v14) > 0.00000011920929)
    {
      [(NSLayoutConstraint *)self->_entryViewFauxKeyboardLayoutConstraint setConstant:v14];
    }
  }
}

- (void)_updateFauxKeyboardLayoutGuideIfNeededForKeyboardAppearanceNotification:(id)notification
{
  notificationCopy = notification;
  v5 = +[CKUIBehavior sharedBehaviors];
  entryViewFollowsKeyboardLayoutGuide = [v5 entryViewFollowsKeyboardLayoutGuide];

  if (entryViewFollowsKeyboardLayoutGuide && ![(CKChatController *)self suppressEntryViewKeyboardNotifications])
  {
    userInfo = [notificationCopy userInfo];
    v8 = *MEMORY[0x1E69DDFA0];
    v9 = [userInfo objectForKeyedSubscript:*MEMORY[0x1E69DDFA0]];

    if (!v9)
    {
      v30 = IMLogHandleForCategory();
      if (os_log_type_enabled(v30, OS_LOG_TYPE_ERROR))
      {
        [CKChatController _updateFauxKeyboardLayoutGuideIfNeededForKeyboardAppearanceNotification:];
      }

      goto LABEL_20;
    }

    [v9 CGRectValue];
    v11 = v10;
    v13 = v12;
    v15 = v14;
    v17 = v16;
    view = [(CKChatController *)self view];
    window = [view window];
    view2 = [(CKChatController *)self view];
    [window convertRect:view2 toView:{v11, v13, v15, v17}];
    v22 = v21;
    v24 = v23;
    v26 = v25;
    v28 = v27;

    userInfo2 = [notificationCopy userInfo];
    v30 = [userInfo2 objectForKeyedSubscript:*MEMORY[0x1E69DDF40]];

    [v30 doubleValue];
    v32 = v31;
    userInfo3 = [notificationCopy userInfo];
    v34 = [userInfo3 objectForKeyedSubscript:*MEMORY[0x1E69DDF38]];

    integerValue = [v34 integerValue];
    if ([objc_opt_class() supportsTranscriptBackground])
    {
      name = [notificationCopy name];
      v37 = [name isEqualToString:*MEMORY[0x1E69DDF68]];

      if (v37)
      {
        transcriptBackground = [(CKCoreChatController *)self transcriptBackground];
        [(CKChatController *)self _keyboardFrameAccountingForSalientTranscriptBackgroundRect:v22, v24, v26, v28];
        v40 = v39;
        v41 = v32;
        v42 = v22;
        v43 = v24;
        v44 = v26;
        v45 = v28;
        v144 = v41;
        v46 = v41;
        *&v131 = v46;
        v28 = v45;
        v26 = v44;
        v24 = v43;
        v22 = v42;
        [transcriptBackground keyboardFrameDidChange:integerValue accountingForSalientRectFrame:-[CKScrollViewController isKeyboardVisible](self duration:"isKeyboardVisible") curve:v42 isVisible:{v24, v26, v28, v40, v47, v48, v49, v131}];
LABEL_13:

        v32 = v144;
        goto LABEL_14;
      }

      name2 = [notificationCopy name];
      v51 = [name2 isEqualToString:*MEMORY[0x1E69DE080]];

      if (v51)
      {
        view3 = [(CKChatController *)self view];
        window2 = [view3 window];
        [notificationCopy userInfo];
        v53 = v142 = integerValue;
        v54 = [v53 objectForKeyedSubscript:*MEMORY[0x1E69DDF98]];
        [v54 CGRectValue];
        v144 = v32;
        v56 = v55;
        v58 = v57;
        v60 = v59;
        v62 = v61;
        view4 = [(CKChatController *)self view];
        [window2 convertRect:view4 toView:{v56, v58, v60, v62}];
        v134 = v64;
        v136 = v65;
        v138 = v67;
        v140 = v66;

        view5 = [(CKChatController *)self view];
        window3 = [view5 window];
        userInfo4 = [notificationCopy userInfo];
        v71 = [userInfo4 objectForKeyedSubscript:v8];
        [v71 CGRectValue];
        v73 = v72;
        v75 = v74;
        v77 = v76;
        v79 = v78;
        view6 = [(CKChatController *)self view];
        [window3 convertRect:view6 toView:{v73, v75, v77, v79}];
        v82 = v81;
        v84 = v83;
        v86 = v85;
        v88 = v87;

        integerValue = v142;
        transcriptBackground = [(CKCoreChatController *)self transcriptBackground];
        v89 = v144;
        *&v131 = v89;
        [transcriptBackground keyboardWillShowFromFrame:v142 toFrame:1 duration:v134 curve:v140 isVisible:{v138, v136, v82, v84, v86, v88, v131}];
        goto LABEL_13;
      }

      name3 = [notificationCopy name];
      v91 = [name3 isEqualToString:*MEMORY[0x1E69DE078]];

      if (v91)
      {
        view7 = [(CKChatController *)self view];
        window4 = [view7 window];
        userInfo5 = [notificationCopy userInfo];
        [userInfo5 objectForKeyedSubscript:*MEMORY[0x1E69DDF98]];
        v94 = v143 = integerValue;
        [v94 CGRectValue];
        v144 = v32;
        v96 = v95;
        v98 = v97;
        v100 = v99;
        v102 = v101;
        view8 = [(CKChatController *)self view];
        [window4 convertRect:view8 toView:{v96, v98, v100, v102}];
        v139 = v105;
        v141 = v104;
        v135 = v107;
        v137 = v106;

        view9 = [(CKChatController *)self view];
        window5 = [view9 window];
        userInfo6 = [notificationCopy userInfo];
        v111 = [userInfo6 objectForKeyedSubscript:v8];
        [v111 CGRectValue];
        v113 = v112;
        v115 = v114;
        v117 = v116;
        v119 = v118;
        view10 = [(CKChatController *)self view];
        [window5 convertRect:view10 toView:{v113, v115, v117, v119}];
        v122 = v121;
        v124 = v123;
        v126 = v125;
        v128 = v127;

        integerValue = v143;
        transcriptBackground = [(CKCoreChatController *)self transcriptBackground];
        v129 = v144;
        *&v131 = v129;
        [transcriptBackground keyboardWillHideFromFrame:v143 toFrame:0 duration:v141 curve:v139 isVisible:{v137, v135, v122, v124, v126, v128, v131}];
        goto LABEL_13;
      }
    }

LABEL_14:
    if (self->_entryViewFauxKeyboardLayoutConstraint)
    {
      if (v32 > 0.0 && [(CKCoreChatController *)self viewIsVisible])
      {
        v130 = [(CKChatController *)self _animationOptionsFromCurve:integerValue];
        v146[0] = MEMORY[0x1E69E9820];
        v146[1] = 3221225472;
        v146[2] = __92__CKChatController__updateFauxKeyboardLayoutGuideIfNeededForKeyboardAppearanceNotification___block_invoke;
        v146[3] = &unk_1E72EC7B0;
        v146[4] = self;
        *&v146[5] = v22;
        *&v146[6] = v24;
        *&v146[7] = v26;
        *&v146[8] = v28;
        [MEMORY[0x1E69DD250] animateWithDuration:v130 | 4 delay:v146 options:&__block_literal_global_1171_0 animations:v32 completion:0.0];
      }

      else
      {
        v145[0] = MEMORY[0x1E69E9820];
        v145[1] = 3221225472;
        v145[2] = __92__CKChatController__updateFauxKeyboardLayoutGuideIfNeededForKeyboardAppearanceNotification___block_invoke_3;
        v145[3] = &unk_1E72EC7B0;
        v145[4] = self;
        *&v145[5] = v22;
        *&v145[6] = v24;
        *&v145[7] = v26;
        *&v145[8] = v28;
        [MEMORY[0x1E69DD250] performWithoutAnimation:v145];
      }
    }

LABEL_20:
  }
}

void __92__CKChatController__updateFauxKeyboardLayoutGuideIfNeededForKeyboardAppearanceNotification___block_invoke(uint64_t a1)
{
  [*(a1 + 32) _updateFauxKeyboardLayoutGuideIfNeededWithKeyboardFrame:{*(a1 + 40), *(a1 + 48), *(a1 + 56), *(a1 + 64)}];
  v2 = [*(a1 + 32) view];
  [v2 setNeedsLayout];

  v3 = [*(a1 + 32) view];
  [v3 layoutIfNeeded];
}

void __92__CKChatController__updateFauxKeyboardLayoutGuideIfNeededForKeyboardAppearanceNotification___block_invoke_3(uint64_t a1)
{
  [*(a1 + 32) _updateFauxKeyboardLayoutGuideIfNeededWithKeyboardFrame:{*(a1 + 40), *(a1 + 48), *(a1 + 56), *(a1 + 64)}];
  v2 = [*(a1 + 32) view];
  [v2 setNeedsLayout];

  v3 = [*(a1 + 32) view];
  [v3 layoutIfNeeded];
}

- (CGRect)_keyboardFrameAccountingForSalientTranscriptBackgroundRect:(CGRect)rect
{
  width = rect.size.width;
  x = rect.origin.x;
  [(CKChatController *)self salientTranscriptBackgroundRect:rect.origin.x];
  height = v15.size.height;
  MaxY = CGRectGetMaxY(v15);
  view = [(CKChatController *)self view];
  [view frame];
  v10 = v9 - height;

  v11 = x;
  v12 = MaxY;
  v13 = width;
  v14 = v10;
  result.size.height = v14;
  result.size.width = v13;
  result.origin.y = v12;
  result.origin.x = v11;
  return result;
}

- (unint64_t)_animationOptionsFromCurve:(int64_t)curve
{
  if ((curve - 1) >= 3)
  {
    return 0;
  }

  else
  {
    return ((curve - 1) << 16) + 0x10000;
  }
}

- (BOOL)pluginButtonsEnabled
{
  conversation = [(CKCoreChatController *)self conversation];
  isStewieConversation = [conversation isStewieConversation];

  if (isStewieConversation)
  {
    return 0;
  }

  v6 = MEMORY[0x1E69A5CA0];
  conversation2 = [(CKCoreChatController *)self conversation];
  lastAddressedHandle = [conversation2 lastAddressedHandle];
  conversation3 = [(CKCoreChatController *)self conversation];
  lastAddressedSIMID = [conversation3 lastAddressedSIMID];
  LOBYTE(v6) = [v6 mmsEnabledforPhoneNumber:lastAddressedHandle simID:lastAddressedSIMID];

  return (v6 & 1) != 0 || CKiMessageSupported() != 0;
}

- (void)setTargetFirstResponder:(int64_t)responder
{
  v11 = *MEMORY[0x1E69E9840];
  if (self->_targetFirstResponder != responder)
  {
    if (IMOSLoggingEnabled())
    {
      v5 = OSLogHandleForIMFoundationCategory();
      if (os_log_type_enabled(v5, OS_LOG_TYPE_INFO))
      {
        targetFirstResponder = self->_targetFirstResponder;
        v7 = 134218240;
        v8 = targetFirstResponder;
        v9 = 2048;
        responderCopy = responder;
        _os_log_impl(&dword_19020E000, v5, OS_LOG_TYPE_INFO, "Target first responder changing from %lu to %lu", &v7, 0x16u);
      }
    }

    self->_targetFirstResponder = responder;
    self->_becomingFirstResponderInProgress = 0;
  }
}

- (BOOL)canBecomeFirstResponder
{
  shouldDisplayTextEntry = [(CKCoreChatController *)self shouldDisplayTextEntry];
  if (shouldDisplayTextEntry)
  {
    LOBYTE(shouldDisplayTextEntry) = ![(CKChatController *)self isShowingCamera];
  }

  return shouldDisplayTextEntry;
}

- (BOOL)becomeFirstResponder
{
  v24 = *MEMORY[0x1E69E9840];
  if (self->_becomingFirstResponderInProgress)
  {
    LOBYTE(becomeFirstResponder) = 0;
    return becomeFirstResponder;
  }

  self->_becomingFirstResponderInProgress = 1;
  targetFirstResponder = [(CKChatController *)self targetFirstResponder];
  v5 = targetFirstResponder;
  switch(targetFirstResponder)
  {
    case 3:
      messageEditingViewController = [(CKChatController *)self messageEditingViewController];
      becomeFirstResponder = [messageEditingViewController becomeFirstResponder];

      break;
    case 1:
      if (([(CKChatController *)self isEditing]& 1) == 0)
      {
        fullScreenBalloonViewController = [(CKCoreChatController *)self fullScreenBalloonViewController];

        if (!fullScreenBalloonViewController)
        {
          self->_nextEntryViewSafeAreaInsetUpdateIsSynchronous = 1;
          entryView = [(CKChatController *)self entryView];
          contentView = [entryView contentView];
          activeView = [contentView activeView];
          if ([activeView becomeFirstResponder])
          {
            becomeFirstResponder = 1;
          }

          else
          {
            v18.receiver = self;
            v18.super_class = CKChatController;
            becomeFirstResponder = [(CKChatController *)&v18 becomeFirstResponder];
          }

          break;
        }
      }

      break;
    case 0:
      if (IMOSLoggingEnabled())
      {
        v6 = OSLogHandleForIMFoundationCategory();
        if (os_log_type_enabled(v6, OS_LOG_TYPE_INFO))
        {
          *buf = 0;
          _os_log_impl(&dword_19020E000, v6, OS_LOG_TYPE_INFO, "No target FR, making chat controller FR", buf, 2u);
        }
      }

      inputController = [(CKCoreChatController *)self inputController];
      [inputController clearBrowserViewControllerIfNecessary];

      v19.receiver = self;
      v19.super_class = CKChatController;
      becomeFirstResponder = [(CKChatController *)&v19 becomeFirstResponder];
      break;
    default:
      becomeFirstResponder = 0;
      break;
  }

  if (IMOSLoggingEnabled())
  {
    v10 = OSLogHandleForIMFoundationCategory();
    if (os_log_type_enabled(v10, OS_LOG_TYPE_INFO))
    {
      v11 = [MEMORY[0x1E696AD98] numberWithInteger:v5];
      v12 = v11;
      v13 = @"NO";
      if (becomeFirstResponder)
      {
        v13 = @"YES";
      }

      *buf = 138412546;
      v21 = v11;
      v22 = 2112;
      v23 = v13;
      _os_log_impl(&dword_19020E000, v10, OS_LOG_TYPE_INFO, "targetFirstResponder: %@, didBecomeFirstResponder: %@", buf, 0x16u);
    }
  }

  self->_becomingFirstResponderInProgress = 0;
  return becomeFirstResponder;
}

- (id)consumingBundleIdentifiers
{
  v30 = *MEMORY[0x1E69E9840];
  array = [MEMORY[0x1E695DF70] array];
  inputController = [(CKCoreChatController *)self inputController];
  browserPlugin = [inputController browserPlugin];

  if (browserPlugin)
  {
    identifier = [browserPlugin identifier];
    [array addObject:identifier];
  }

  entryView = [(CKChatController *)self entryView];
  composition = [entryView composition];
  shelfPluginPayload = [composition shelfPluginPayload];

  if (shelfPluginPayload)
  {
    pluginBundleID = [shelfPluginPayload pluginBundleID];
    [array addObject:pluginBundleID];
  }

  collectionViewController = [(CKCoreChatController *)self collectionViewController];
  chatItems = [collectionViewController chatItems];

  if ([chatItems count])
  {
    v24 = browserPlugin;
    collectionView = [(CKChatController *)self collectionView];
    indexPathsForVisibleItems = [collectionView indexPathsForVisibleItems];

    v27 = 0u;
    v28 = 0u;
    v25 = 0u;
    v26 = 0u;
    v15 = indexPathsForVisibleItems;
    v16 = [v15 countByEnumeratingWithState:&v25 objects:v29 count:16];
    if (v16)
    {
      v17 = v16;
      v18 = *v26;
      do
      {
        for (i = 0; i != v17; ++i)
        {
          if (*v26 != v18)
          {
            objc_enumerationMutation(v15);
          }

          item = [*(*(&v25 + 1) + 8 * i) item];
          if (item < [chatItems count])
          {
            v21 = [chatItems objectAtIndex:item];
            objc_opt_class();
            if (objc_opt_isKindOfClass())
            {
              bundleIdentifier = [v21 bundleIdentifier];
              [array addObject:bundleIdentifier];
            }
          }
        }

        v17 = [v15 countByEnumeratingWithState:&v25 objects:v29 count:16];
      }

      while (v17);
    }

    browserPlugin = v24;
  }

  return array;
}

- (id)generatedSummary
{
  chat = [(CKCoreChatController *)self chat];
  chatSummary = [chat chatSummary];
  string = [chatSummary string];

  return string;
}

- (id)generativeContext
{
  collectionViewController = [(CKCoreChatController *)self collectionViewController];
  generativeContextHistory = [collectionViewController generativeContextHistory];

  return generativeContextHistory;
}

- (void)_addAppCardBackgroundView
{
  v30[4] = *MEMORY[0x1E69E9840];
  v3 = +[CKAppCardLoadingViewProvider spinnerViewController];
  [(CKChatController *)self setAppCardBackgroundViewController:v3];

  appCardBackgroundViewController = [(CKChatController *)self appCardBackgroundViewController];
  [(CKChatController *)self addChildViewController:appCardBackgroundViewController];

  view = [(CKChatController *)self view];
  appCardBackgroundViewController2 = [(CKChatController *)self appCardBackgroundViewController];
  view2 = [appCardBackgroundViewController2 view];
  [view addSubview:view2];

  appCardBackgroundViewController3 = [(CKChatController *)self appCardBackgroundViewController];
  [appCardBackgroundViewController3 didMoveToParentViewController:self];

  appCardBackgroundViewController4 = [(CKChatController *)self appCardBackgroundViewController];
  view3 = [appCardBackgroundViewController4 view];

  topAnchor = [view3 topAnchor];
  entryView = [(CKChatController *)self entryView];
  bottomAnchor = [entryView bottomAnchor];
  v26 = [topAnchor constraintEqualToAnchor:bottomAnchor];
  v30[0] = v26;
  leadingAnchor = [view3 leadingAnchor];
  view4 = [(CKChatController *)self view];
  leadingAnchor2 = [view4 leadingAnchor];
  v22 = [leadingAnchor constraintEqualToAnchor:leadingAnchor2];
  v30[1] = v22;
  trailingAnchor = [view3 trailingAnchor];
  view5 = [(CKChatController *)self view];
  trailingAnchor2 = [view5 trailingAnchor];
  v13 = [trailingAnchor constraintEqualToAnchor:trailingAnchor2];
  v30[2] = v13;
  bottomAnchor2 = [view3 bottomAnchor];
  view6 = [(CKChatController *)self view];
  bottomAnchor3 = [view6 bottomAnchor];
  v17 = [bottomAnchor2 constraintEqualToAnchor:bottomAnchor3];
  v30[3] = v17;
  v18 = [MEMORY[0x1E695DEC8] arrayWithObjects:v30 count:4];
  [(CKChatController *)self setAppCardBackgroundViewConstraints:v18];

  v19 = MEMORY[0x1E696ACD8];
  appCardBackgroundViewConstraints = [(CKChatController *)self appCardBackgroundViewConstraints];
  [v19 activateConstraints:appCardBackgroundViewConstraints];

  [view3 setTranslatesAutoresizingMaskIntoConstraints:0];
}

- (void)addAppCardBackgroundViewIfNecessary
{
  appCardBackgroundViewController = [(CKChatController *)self appCardBackgroundViewController];
  if (appCardBackgroundViewController)
  {
  }

  else
  {
    entryView = [(CKChatController *)self entryView];
    window = [entryView window];

    if (window)
    {
      inputController = [(CKCoreChatController *)self inputController];
      traitCollection = [(CKChatController *)self traitCollection];
      v8 = [inputController determineSendMenuPresentationStyleCompatibleWithTraitCollection:traitCollection];

      if (!v8)
      {

        [(CKChatController *)self _addAppCardBackgroundView];
      }
    }
  }
}

- (void)removeAppCardBackgroundViewIfNecessary
{
  appCardBackgroundViewController = [(CKChatController *)self appCardBackgroundViewController];

  if (appCardBackgroundViewController)
  {
    appCardBackgroundViewController2 = [(CKChatController *)self appCardBackgroundViewController];
    [appCardBackgroundViewController2 willMoveToParentViewController:0];

    appCardBackgroundViewController3 = [(CKChatController *)self appCardBackgroundViewController];
    view = [appCardBackgroundViewController3 view];
    [view removeFromSuperview];

    appCardBackgroundViewController4 = [(CKChatController *)self appCardBackgroundViewController];
    [appCardBackgroundViewController4 removeFromParentViewController];

    v8 = MEMORY[0x1E696ACD8];
    appCardBackgroundViewConstraints = [(CKChatController *)self appCardBackgroundViewConstraints];
    [v8 deactivateConstraints:appCardBackgroundViewConstraints];

    [(CKChatController *)self setAppCardBackgroundViewConstraints:0];

    [(CKChatController *)self setAppCardBackgroundViewController:0];
  }
}

- (void)appCardDidChangeEntryViewAlignmentHeight:(double)height animated:(BOOL)animated
{
  entryViewAppCardLayoutConstraint = self->_entryViewAppCardLayoutConstraint;
  if (!entryViewAppCardLayoutConstraint || ([(NSLayoutConstraint *)entryViewAppCardLayoutConstraint constant], vabdd_f64(height, v8) >= 0.001))
  {
    collectionViewController = [(CKCoreChatController *)self collectionViewController];
    collectionView = [collectionViewController collectionView];

    [(NSLayoutConstraint *)self->_entryViewAppCardLayoutConstraint setConstant:height];
    if (animated)
    {
      v11 = *MEMORY[0x1E69DDFD8];
      v12 = UIViewAnimationCurveForCKAnimationCurve(103);
    }

    else
    {
      [(CKChatController *)self _layoutEntryViewSuperview];
      v11 = 0.0;
      v12 = 3;
    }

    [(CKScrollViewController *)self updateScrollGeometryForReason:@"AppCardChangedHeight" withDuration:v12 animationCurve:v11];
    v14[0] = MEMORY[0x1E69E9820];
    v14[1] = 3221225472;
    v14[2] = __70__CKChatController_appCardDidChangeEntryViewAlignmentHeight_animated___block_invoke;
    v14[3] = &unk_1E72EBA18;
    v14[4] = self;
    [(CKScrollViewController *)self scrollWithDuration:v12 animationCurve:v14 scrollBlock:v11];
    v13 = [CKScrollViewAnimationProperties animatedWithDuration:v12 animationCurve:v11];
    [collectionView enforceTranscriptScrollIntentWithAnimationProperties:v13];
  }
}

void __70__CKChatController_appCardDidChangeEntryViewAlignmentHeight_animated___block_invoke(uint64_t a1)
{
  [*(a1 + 32) _layoutEntryViewSuperview];
  v2 = [*(a1 + 32) view];
  [v2 layoutIfNeeded];
}

- (void)appCardViewStateDidChange:(BOOL)change
{
  if (change)
  {
    [(CKChatController *)self removeAppCardBackgroundViewIfNecessary];
  }

  else
  {
    [(CKChatController *)self addAppCardBackgroundViewIfNecessary];
  }
}

- (void)appCardDidDismiss
{
  fullScreenBalloonViewController = [(CKCoreChatController *)self fullScreenBalloonViewController];
  if (([fullScreenBalloonViewController appeared] & 1) == 0)
  {
    goto LABEL_4;
  }

  inputController = [(CKCoreChatController *)self inputController];
  if ([inputController didDismissAppCardForStickerDrag])
  {

LABEL_4:
    goto LABEL_5;
  }

  fullScreenBalloonViewController2 = [(CKCoreChatController *)self fullScreenBalloonViewController];
  displayConfiguration = [fullScreenBalloonViewController2 displayConfiguration];
  shouldDismissWithAppCard = [displayConfiguration shouldDismissWithAppCard];

  if (shouldDismissWithAppCard)
  {
    [(CKChatController *)self _dismissFullScreenBubbleViewControllerAnimated:1 withSendAnimation:0 completion:0];
  }

LABEL_5:
  [(CKChatController *)self updateEntryViewHeightWithContentChange:0 animated:1];
  [(CKScrollViewController *)self updateScrollGeometryWithoutAnimationForReason:@"AppCardDismissed"];

  [(CKChatController *)self updateActiveEntryViewPositioningGuide];
}

- (double)_keyboardHeightFromLayoutGuide
{
  entryView = [(CKChatController *)self entryView];
  entryViewKeyboardLayoutGuide = [entryView entryViewKeyboardLayoutGuide];

  [entryViewKeyboardLayoutGuide layoutFrame];
  x = v14.origin.x;
  y = v14.origin.y;
  width = v14.size.width;
  height = v14.size.height;
  v9 = 0.0;
  if (!CGRectEqualToRect(v14, *MEMORY[0x1E695F058]))
  {
    owningView = [entryViewKeyboardLayoutGuide owningView];
    view = [(CKChatController *)self view];
    [view convertRect:owningView fromView:{x, y, width, height}];
    MinY = CGRectGetMinY(v15);
    [view bounds];
    v9 = CGRectGetMaxY(v16) - MinY;
  }

  return v9;
}

- (id)activeSendMenuPresentationForChatInputController:(id)controller
{
  sendMenuDelegate = [(CKChatController *)self sendMenuDelegate];
  v5 = [sendMenuDelegate activeSendMenuPresentationForChatController:self];

  return v5;
}

- (void)enforceSendMenuOrderingInWindowSubviews
{
  if (self->_keyboardSnapshotView)
  {
    view = [(CKChatController *)self view];
    window = [view window];
    [window bringSubviewToFront:self->_keyboardSnapshotView];
  }

  v5 = [(CKChatController *)self activeSendMenuPresentationForChatController:self];
  [v5 enforceSendMenuOrderingInWindowSubviews];
}

- (id)chatInputTranscriptIdentifier
{
  collectionViewController = [(CKCoreChatController *)self collectionViewController];
  transcriptIdentifier = [collectionViewController transcriptIdentifier];

  return transcriptIdentifier;
}

- (id)viewForDragAndChatInputDropTarget
{
  collectionViewController = [(CKCoreChatController *)self collectionViewController];
  view = [collectionViewController view];

  return view;
}

- (id)keyboardLayoutGuideForAppCardPresentation
{
  entryView = [(CKChatController *)self entryView];
  entryViewKeyboardLayoutGuide = [entryView entryViewKeyboardLayoutGuide];

  return entryViewKeyboardLayoutGuide;
}

- (void)chatInputSentComposition:(id)composition
{
  v14 = *MEMORY[0x1E69E9840];
  compositionCopy = composition;
  conversation = [(CKCoreChatController *)self conversation];
  recipients = [conversation recipients];
  if ([recipients count])
  {
    conversation2 = [(CKCoreChatController *)self conversation];
    v11 = 0;
    v8 = [conversation2 canSendComposition:compositionCopy error:&v11];
    v9 = v11;

    if (v8)
    {
      [(CKChatController *)self sendCompositionIfAllowed:compositionCopy];
      goto LABEL_9;
    }
  }

  else
  {

    v9 = 0;
  }

  if (IMOSLoggingEnabled())
  {
    v10 = OSLogHandleForIMFoundationCategory();
    if (os_log_type_enabled(v10, OS_LOG_TYPE_INFO))
    {
      *buf = 138412290;
      v13 = v9;
      _os_log_impl(&dword_19020E000, v10, OS_LOG_TYPE_INFO, "Failed to send composition with error: %@", buf, 0xCu);
    }
  }

LABEL_9:
}

- (BOOL)chatInputControllerCanSend:(id)send
{
  v24 = *MEMORY[0x1E69E9840];
  sendCopy = send;
  conversation = [(CKCoreChatController *)self conversation];
  if ([conversation hasLeftGroupChat])
  {
    goto LABEL_4;
  }

  conversation2 = [(CKCoreChatController *)self conversation];
  if ([conversation2 isBusinessChatDisabled])
  {

LABEL_4:
    goto LABEL_5;
  }

  isReadOnly = [(CKCoreChatController *)self isReadOnly];

  if (!isReadOnly)
  {
    v15 = 1;
    goto LABEL_19;
  }

LABEL_5:
  if (IMOSLoggingEnabled())
  {
    v7 = OSLogHandleForIMFoundationCategory();
    if (os_log_type_enabled(v7, OS_LOG_TYPE_INFO))
    {
      conversation3 = [(CKCoreChatController *)self conversation];
      if ([conversation3 hasLeftGroupChat])
      {
        v9 = @"YES";
      }

      else
      {
        v9 = @"NO";
      }

      conversation4 = [(CKCoreChatController *)self conversation];
      isBusinessChatDisabled = [conversation4 isBusinessChatDisabled];
      isReadOnly2 = [(CKCoreChatController *)self isReadOnly];
      if (isBusinessChatDisabled)
      {
        v13 = @"YES";
      }

      else
      {
        v13 = @"NO";
      }

      v18 = 138412802;
      if (isReadOnly2)
      {
        v14 = @"YES";
      }

      else
      {
        v14 = @"NO";
      }

      v19 = v9;
      v20 = 2112;
      v21 = v13;
      v22 = 2112;
      v23 = v14;
      _os_log_impl(&dword_19020E000, v7, OS_LOG_TYPE_INFO, "Cannot send, leftGroupChat: %@, isBusinessChatDisabled: %@, readOnlyChat: %@", &v18, 0x20u);
    }
  }

  v15 = 0;
LABEL_19:

  return v15;
}

- (void)sendSticker:(id)sticker withDragTarget:(id)target draggedSticker:(id)draggedSticker
{
  v73[12] = *MEMORY[0x1E69E9840];
  stickerCopy = sticker;
  targetCopy = target;
  [stickerCopy prepareToSend];
  mEMORY[0x1E69A8168] = [MEMORY[0x1E69A8168] sharedInstance];
  [mEMORY[0x1E69A8168] trackEvent:*MEMORY[0x1E69A7740]];

  stickerTranscriptScrollDisplayLink = [(CKChatController *)self stickerTranscriptScrollDisplayLink];
  [stickerTranscriptScrollDisplayLink invalidate];

  [(CKChatController *)self setStickerTranscriptScrollDisplayLink:0];
  [targetCopy screenCoordinate];
  v12 = v11;
  v14 = v13;
  [targetCopy scale];
  v16 = v15;
  [targetCopy rotation];
  if (targetCopy)
  {
    v18 = v17;
    collectionViewController = [(CKCoreChatController *)self collectionViewController];
    v20 = [(CKChatController *)self selectedBalloonForTarget:targetCopy];
    if (!v20)
    {
LABEL_21:

      goto LABEL_22;
    }

    chatItems = [collectionViewController chatItems];
    v22 = [chatItems objectAtIndex:{objc_msgSend(v20, "row")}];

    v23 = [collectionViewController balloonViewForChatItem:v22];
    v24 = v23;
    if (v23)
    {
      superview = [v23 superview];
      [v24 frame];
      [superview convertRect:0 toView:?];
      v27 = v26;
      v29 = v28;
      v31 = v30;
      v33 = v32;

      v34 = (v12 - v27) / v31;
      v35 = (v14 - v29) / v33;
      [v22 size];
      v37 = v36;
      mEMORY[0x1E69A8070] = [MEMORY[0x1E69A8070] sharedFeatureFlags];
      if ([mEMORY[0x1E69A8070] isStickerRepositioningEnabled])
      {
        stickerIsRepositioning = [targetCopy stickerIsRepositioning];

        if (stickerIsRepositioning)
        {
          stickerChatItem = [targetCopy stickerChatItem];
          stickerPositionVersion = [stickerChatItem stickerPositionVersion];

          v72[0] = *MEMORY[0x1E69A7C98];
          stickerGUID = [stickerCopy stickerGUID];
          v73[0] = stickerGUID;
          v72[1] = *MEMORY[0x1E69A7CB0];
          stickerPackGUID = [stickerCopy stickerPackGUID];
          v73[1] = stickerPackGUID;
          v72[2] = *MEMORY[0x1E69A7CA0];
          v68 = [MEMORY[0x1E696AEC0] stringWithFormat:@"%lu", objc_msgSend(stickerCopy, "hash")];
          v42 = *MEMORY[0x1E69A7CA8];
          v73[2] = v68;
          v73[3] = MEMORY[0x1E695E110];
          v43 = *MEMORY[0x1E69A7C88];
          v72[3] = v42;
          v72[4] = v43;
          v67 = [MEMORY[0x1E696AD98] numberWithInteger:{objc_msgSend(stickerCopy, "stickerEffectType")}];
          v73[4] = v67;
          v72[5] = *MEMORY[0x1E69A7CC8];
          v66 = [MEMORY[0x1E696AD98] numberWithDouble:v34];
          v73[5] = v66;
          v72[6] = *MEMORY[0x1E69A7CD0];
          v65 = [MEMORY[0x1E696AD98] numberWithDouble:v35];
          v73[6] = v65;
          v72[7] = *MEMORY[0x1E69A7C78];
          v64 = [MEMORY[0x1E696AD98] numberWithDouble:v16];
          v73[7] = v64;
          v72[8] = *MEMORY[0x1E69A7C70];
          v63 = [MEMORY[0x1E696AD98] numberWithDouble:v18];
          v73[8] = v63;
          v72[9] = *MEMORY[0x1E69A7C68];
          v62 = [MEMORY[0x1E696AD98] numberWithDouble:v37];
          v73[9] = v62;
          v72[10] = *MEMORY[0x1E69A7CB8];
          v44 = [MEMORY[0x1E696AD98] numberWithUnsignedInteger:stickerPositionVersion + 1];
          v72[11] = *MEMORY[0x1E69A7C60];
          v73[10] = v44;
          v73[11] = &unk_1F04E78A8;
          v45 = [MEMORY[0x1E695DF20] dictionaryWithObjects:v73 forKeys:v72 count:12];
          v46 = [v45 mutableCopy];

          ballonBundleID = [stickerCopy ballonBundleID];

          if (ballonBundleID)
          {
            ballonBundleID2 = [stickerCopy ballonBundleID];
            [v46 setObject:ballonBundleID2 forKey:*MEMORY[0x1E69A7C80]];
          }

          getSafeExternalURI = [stickerCopy getSafeExternalURI];
          [v46 setObject:getSafeExternalURI forKey:*MEMORY[0x1E69A7C90]];

          stickerChatItem2 = [targetCopy stickerChatItem];
          if (![(CKChatController *)self repositionSticker:stickerCopy stickerChatItem:stickerChatItem2 parentMessagePartChatItem:v22 stickerPositioningInfo:v46])
          {
            v71 = v46;
            collectionViewController2 = [(CKCoreChatController *)self collectionViewController];
            v52 = [collectionViewController2 cellForAssociatedChatItem:stickerChatItem2];

            if (v52)
            {
              collectionViewController3 = [(CKCoreChatController *)self collectionViewController];
              [collectionViewController3 setDragManagerCurrentDraggedStickerID:0];

              [v52 setHidden:0];
              [v52 setStickerViewHidden:0];
            }

            v46 = v71;
          }

          goto LABEL_20;
        }
      }

      else
      {
      }

      v54 = MEMORY[0x1E69A82C0];
      initialFrameIndex = [stickerCopy initialFrameIndex];
      getSafeExternalURI2 = [stickerCopy getSafeExternalURI];
      v57 = [v54 userInfoDictionaryWithLayoutIntent:0 parentPreviewWidth:initialFrameIndex xScalar:0 yScalar:getSafeExternalURI2 scale:v37 rotation:v34 initialFrameIndex:v35 stickerPositionVersion:v16 externalURI:v18];

      v58 = +[CKMediaObjectManager sharedInstance];
      v59 = [v58 mediaObjectWithSticker:stickerCopy stickerUserInfo:v57];

      if (v59)
      {
        v60 = [(CKChatController *)self compositionForSticker:stickerCopy mediaObject:v59];
        [(CKChatController *)self sendSticker:stickerCopy withMediaObject:v59 composition:v60 parentMessagePartChatItem:v22];
      }

      else
      {
        v61 = IMLogHandleForCategory();
        if (os_log_type_enabled(v61, OS_LOG_TYPE_ERROR))
        {
          [CKChatController sendSticker:stickerCopy withDragTarget:? draggedSticker:?];
        }
      }
    }

LABEL_20:

    goto LABEL_21;
  }

LABEL_22:
}

- (id)_compositionForEmojiSticker:(id)sticker mediaObject:(id)object
{
  v18 = *MEMORY[0x1E69E9840];
  objectCopy = object;
  v5 = MEMORY[0x1E695DEC8];
  objectCopy2 = object;
  stickerCopy = sticker;
  v8 = [v5 arrayWithObjects:&objectCopy count:1];
  v9 = [CKComposition stickerCompositionWithMediaObjects:v8, objectCopy, v18];

  v10 = [CKComposition alloc];
  v11 = objc_alloc(MEMORY[0x1E696AAB0]);

  emojiString = [stickerCopy emojiString];

  v13 = [v11 initWithString:emojiString];
  v14 = [(CKComposition *)v10 initWithText:v13 subject:0];

  v15 = [(CKComposition *)v14 compositionByAppendingComposition:v9];

  return v15;
}

- (id)compositionForSticker:(id)sticker mediaObject:(id)object
{
  v11[1] = *MEMORY[0x1E69E9840];
  stickerCopy = sticker;
  objectCopy = object;
  if ([stickerCopy isEmojiSticker])
  {
    v8 = [(CKChatController *)self _compositionForEmojiSticker:stickerCopy mediaObject:objectCopy];
  }

  else
  {
    v11[0] = objectCopy;
    v9 = [MEMORY[0x1E695DEC8] arrayWithObjects:v11 count:1];
    v8 = [CKComposition stickerCompositionWithMediaObjects:v9];
  }

  return v8;
}

- (void)updateSupportedInterfaceOrientations:(unint64_t)orientations
{
  delegate = [(CKCoreChatController *)self delegate];
  v6 = objc_opt_respondsToSelector();

  if (v6)
  {
    delegate2 = [(CKCoreChatController *)self delegate];
    [delegate2 updateSupportedInterfaceOrientations:orientations];
  }
}

- (void)stopForcingOrientation
{
  delegate = [(CKCoreChatController *)self delegate];
  v4 = objc_opt_respondsToSelector();

  if (v4)
  {
    delegate2 = [(CKCoreChatController *)self delegate];
    [delegate2 stopForcingOrientation];
  }
}

- (int64_t)sceneInterfaceOrientation
{
  viewIfLoaded = [(CKChatController *)self viewIfLoaded];
  window = [viewIfLoaded window];
  windowScene = [window windowScene];

  if (windowScene)
  {
    interfaceOrientation = [windowScene interfaceOrientation];
  }

  else
  {
    interfaceOrientation = 1;
  }

  return interfaceOrientation;
}

- (unint64_t)recipientsCount
{
  conversation = [(CKCoreChatController *)self conversation];
  recipients = [conversation recipients];
  v4 = [recipients count];

  return v4;
}

- (BOOL)commitStickerAsTapback:(id)tapback
{
  tapbackCopy = tapback;
  fullScreenBalloonViewController = [(CKCoreChatController *)self fullScreenBalloonViewController];
  displayConfiguration = [fullScreenBalloonViewController displayConfiguration];
  type = [displayConfiguration type];

  if (type == 1)
  {
    if (IMOSLoggingEnabled())
    {
      v8 = OSLogHandleForIMFoundationCategory();
      if (os_log_type_enabled(v8, OS_LOG_TYPE_INFO))
      {
        *buf = 0;
        _os_log_impl(&dword_19020E000, v8, OS_LOG_TYPE_INFO, "Inserting sticker as Tapback during double-tap", buf, 2u);
      }
    }

    fullScreenBalloonViewController2 = [(CKCoreChatController *)self fullScreenBalloonViewController];
  }

  else
  {
    pickerContainerAccessoryView = [(CKChatController *)self pickerContainerAccessoryView];

    if (!pickerContainerAccessoryView)
    {
      v13 = 0;
      goto LABEL_14;
    }

    if (IMOSLoggingEnabled())
    {
      v11 = OSLogHandleForIMFoundationCategory();
      if (os_log_type_enabled(v11, OS_LOG_TYPE_INFO))
      {
        *v15 = 0;
        _os_log_impl(&dword_19020E000, v11, OS_LOG_TYPE_INFO, "Inserting sticker as Tapback during long-press", v15, 2u);
      }
    }

    pickerContainerAccessoryView2 = [(CKChatController *)self pickerContainerAccessoryView];
    fullScreenBalloonViewController2 = [pickerContainerAccessoryView2 pickerBalloonParentView];
  }

  [fullScreenBalloonViewController2 insertSticker:tapbackCopy];

  v13 = 1;
LABEL_14:

  return v13;
}

- (void)setPickerContainerAccessoryView:(id)view
{
  v8 = *MEMORY[0x1E69E9840];
  viewCopy = view;
  if (IMOSLoggingEnabled())
  {
    v5 = OSLogHandleForIMFoundationCategory();
    if (os_log_type_enabled(v5, OS_LOG_TYPE_INFO))
    {
      v6 = 138412290;
      v7 = viewCopy;
      _os_log_impl(&dword_19020E000, v5, OS_LOG_TYPE_INFO, "preserving pickerContainerAccessoryView: %@", &v6, 0xCu);
    }
  }

  objc_storeWeak(&self->_pickerContainerAccessoryView, viewCopy);
}

- (BOOL)allowsMentions
{
  entryView = [(CKChatController *)self entryView];
  contentView = [entryView contentView];
  textView = [contentView textView];
  allowsMentions = [textView allowsMentions];

  return allowsMentions;
}

- (void)_dismissSendMenuIfNecessaryForChangedPresentationStyle
{
  v3 = [(CKChatController *)self activeSendMenuPresentationForChatController:self];
  v4 = v3;
  if (v3)
  {
    presentationStyle = [v3 presentationStyle];
    inputController = [(CKCoreChatController *)self inputController];
    traitCollection = [(CKChatController *)self traitCollection];
    v8 = [inputController determineSendMenuPresentationStyleCompatibleWithTraitCollection:traitCollection];

    if (presentationStyle != v8)
    {
      if (IMOSLoggingEnabled())
      {
        v9 = OSLogHandleForIMFoundationCategory();
        if (os_log_type_enabled(v9, OS_LOG_TYPE_INFO))
        {
          *v10 = 0;
          _os_log_impl(&dword_19020E000, v9, OS_LOG_TYPE_INFO, "Dismissing send menu due to a presentation style change (e.g. resizing the window on an iPad)", v10, 2u);
        }
      }

      [v4 dismissAnimated:0 completion:0];
    }
  }
}

- (id)activeSendMenuPresentationForChatController:(id)controller
{
  sendMenuDelegate = [(CKChatController *)self sendMenuDelegate];
  v5 = [sendMenuDelegate activeSendMenuPresentationForChatController:self];

  return v5;
}

- (void)chatController:(id)controller requestPresentSendMenu:(id)menu currentlyPresentedViewController:(id)viewController
{
  viewControllerCopy = viewController;
  v8 = MEMORY[0x1E69A8070];
  menuCopy = menu;
  controllerCopy = controller;
  sharedFeatureFlags = [v8 sharedFeatureFlags];
  isPopoverSendMenuEnabled = [sharedFeatureFlags isPopoverSendMenuEnabled];

  presentedViewController2 = viewControllerCopy;
  if (isPopoverSendMenuEnabled)
  {
    presentedViewController = [(CKChatController *)self presentedViewController];
    v15 = [presentedViewController conformsToProtocol:&unk_1F06826C0];

    presentedViewController2 = viewControllerCopy;
    if (v15)
    {
      presentedViewController2 = [(CKChatController *)self presentedViewController];
    }
  }

  sendMenuDelegate = [(CKChatController *)self sendMenuDelegate];
  [sendMenuDelegate chatController:controllerCopy requestPresentSendMenu:menuCopy currentlyPresentedViewController:presentedViewController2];
}

- (void)chatController:(id)controller didFinishDismissAnimationForSendMenuViewController:(id)viewController
{
  viewControllerCopy = viewController;
  controllerCopy = controller;
  sendMenuDelegate = [(CKChatController *)self sendMenuDelegate];
  [sendMenuDelegate chatController:controllerCopy didFinishDismissAnimationForSendMenuViewController:viewControllerCopy];
}

- (void)requestShowKeyboardSnapshotForReason:(unint64_t)reason
{
  v72 = *MEMORY[0x1E69E9840];
  if (!+[CKUtilities isIpad])
  {
    if (!reason)
    {
      [CKChatController requestShowKeyboardSnapshotForReason:];
    }

    keyboardSnapshotReason = self->_keyboardSnapshotReason;
    self->_keyboardSnapshotReason = keyboardSnapshotReason | reason;
    if (IMOSLoggingEnabled())
    {
      v7 = OSLogHandleForIMFoundationCategory();
      if (os_log_type_enabled(v7, OS_LOG_TYPE_INFO))
      {
        v8 = [MEMORY[0x1E696AD98] numberWithUnsignedInteger:reason];
        *v69 = 138412546;
        *&v69[4] = v8;
        v70 = 1024;
        v71 = keyboardSnapshotReason == 0;
        _os_log_impl(&dword_19020E000, v7, OS_LOG_TYPE_INFO, "request to show keyboardSnapshot with reason: %@, snapshotCreationNeeded: %{BOOL}d", v69, 0x12u);
      }
    }

    if (!keyboardSnapshotReason)
    {
      activeKeyboard = [MEMORY[0x1E69DCBB8] activeKeyboard];
      inputController = [(CKCoreChatController *)self inputController];
      isInputViewVisible = [inputController isInputViewVisible];

      if (isInputViewVisible)
      {
        inputViewController = [(CKChatController *)self inputViewController];
        view = [inputViewController view];

        v14 = [view snapshotViewAfterScreenUpdates:0];
        coordinateSpace = [view coordinateSpace];
        [view bounds];
        v17 = v16;
        v19 = v18;
        v21 = v20;
        v23 = v22;
        window = [view window];
        screen = [window screen];
        coordinateSpace2 = [screen coordinateSpace];
        [coordinateSpace convertRect:coordinateSpace2 toCoordinateSpace:{v17, v19, v21, v23}];
        v28 = v27;
        v30 = v29;
        v32 = v31;
        v34 = v33;

        [v14 setFrame:{v28, v30, v32, v34}];
      }

      else if ([MEMORY[0x1E69DCBB8] usesInputSystemUI])
      {
        v35 = IMLogHandleForCategory();
        if (os_log_type_enabled(v35, OS_LOG_TYPE_DEFAULT))
        {
          *v69 = 0;
          _os_log_impl(&dword_19020E000, v35, OS_LOG_TYPE_DEFAULT, "Requesting OOP keyboard snapshot.", v69, 2u);
        }

        v14 = [MEMORY[0x1E69DCBB8] snapshotViewForOptions:1];
        if (v14)
        {
          goto LABEL_27;
        }

        [(CKChatController *)a2 requestShowKeyboardSnapshotForReason:v69];
        v14 = 0;
        view = *v69;
      }

      else
      {
        v36 = self->_keyboardSnapshotReason;
        if ((v36 & 0x10) != 0)
        {
          v37 = IMLogHandleForCategory();
          if (os_log_type_enabled(v37, OS_LOG_TYPE_DEFAULT))
          {
            *v69 = 0;
            _os_log_impl(&dword_19020E000, v37, OS_LOG_TYPE_DEFAULT, "Forcing immediate keyboard snapshot for CKKeyboardSnapshotReasonSnapshotFullScreenBalloon", v69, 2u);
          }
        }

        v38 = IMLogHandleForCategory();
        if (os_log_type_enabled(v38, OS_LOG_TYPE_DEFAULT))
        {
          *v69 = 0;
          _os_log_impl(&dword_19020E000, v38, OS_LOG_TYPE_DEFAULT, "Requesting keyboard snapshot.", v69, 2u);
        }

        superview = [activeKeyboard superview];
        view = [superview superview];

        mEMORY[0x1E69A8070] = [MEMORY[0x1E69A8070] sharedFeatureFlags];
        isEntryViewRefreshEnabled = [mEMORY[0x1E69A8070] isEntryViewRefreshEnabled];

        if (isEntryViewRefreshEnabled)
        {
          [(CKChatController *)self _makeSnapshotForGlassKeyboardTargetView:view afterScreenUpdates:(v36 & 0x10) == 0];
        }

        else
        {
          [view snapshotViewAfterScreenUpdates:(v36 & 0x10) == 0];
        }
        v14 = ;
      }

LABEL_27:
      [(CKChatController *)self setKeyboardAlpha:0.0];
      [(CKChatController *)self setKeyboardSnapshotView:v14];
      keyboardSnapshotView = [(CKChatController *)self keyboardSnapshotView];
      [keyboardSnapshotView setUserInteractionEnabled:0];

      view2 = [(CKChatController *)self view];
      window2 = [view2 window];
      keyboardSnapshotView2 = [(CKChatController *)self keyboardSnapshotView];
      [window2 addSubview:keyboardSnapshotView2];

      [(CKChatController *)self enforceSendMenuOrderingInWindowSubviews];
      keyboardSnapshotView3 = [(CKChatController *)self keyboardSnapshotView];
      [keyboardSnapshotView3 frame];
      v48 = v47;
      v50 = v49;
      v52 = v51;
      v54 = v53;

      view3 = [(CKChatController *)self view];
      window3 = [view3 window];
      [window3 bounds];
      Height = CGRectGetHeight(v73);
      v74.origin.x = v48;
      v74.origin.y = v50;
      v74.size.width = v52;
      v74.size.height = v54;
      v58 = CGRectGetHeight(v74);

      keyboardSnapshotView4 = [(CKChatController *)self keyboardSnapshotView];
      [keyboardSnapshotView4 setFrame:{v48, Height - v58, v52, v54}];

      if ((isInputViewVisible & 1) == 0 && [activeKeyboard isMinimized])
      {
        v60 = IMLogHandleForCategory();
        if (os_log_type_enabled(v60, OS_LOG_TYPE_DEFAULT))
        {
          *v69 = 0;
          _os_log_impl(&dword_19020E000, v60, OS_LOG_TYPE_DEFAULT, "UIKeyboard is minimized e.g. due to a hardware keyboard. The snapshot we've taken may include a keyboard, but it is not visible to the user. Hiding the snapshot.", v69, 2u);
        }

        keyboardSnapshotView5 = [(CKChatController *)self keyboardSnapshotView];
        [keyboardSnapshotView5 setHidden:1];
      }

      entryView = [(CKChatController *)self entryView];
      [(CKScrollViewController *)self keyboardFrame];
      v63 = CGRectGetHeight(v75);
      window4 = [entryView window];
      bottomAnchor = [window4 bottomAnchor];
      bottomAnchor2 = [entryView bottomAnchor];
      v67 = [bottomAnchor constraintEqualToAnchor:bottomAnchor2 constant:v63];
      entryViewKeyboardSnapshotLayoutConstraint = self->_entryViewKeyboardSnapshotLayoutConstraint;
      self->_entryViewKeyboardSnapshotLayoutConstraint = v67;

      [(CKChatController *)self updateActiveEntryViewPositioningGuide];
    }
  }
}

- (id)_makeSnapshotForGlassKeyboardTargetView:(id)view afterScreenUpdates:(BOOL)updates
{
  updatesCopy = updates;
  v5 = MEMORY[0x1E69DCEB0];
  viewCopy = view;
  mainScreen = [v5 mainScreen];
  v8 = [mainScreen snapshotViewAfterScreenUpdates:updatesCopy];

  [viewCopy bounds];
  v10 = v9;
  v12 = v11;
  v14 = v13;
  v16 = v15;

  v17 = objc_alloc_init(MEMORY[0x1E69DD250]);
  [v17 setFrame:{v10, v12, v14, v16}];
  [v17 setClipsToBounds:1];
  [v17 addSubview:v8];
  [v8 bounds];
  v19 = -(v18 - v16);
  [v8 bounds];
  v21 = v20;
  [v8 bounds];
  [v8 setFrame:{0.0, v19, v21}];

  return v17;
}

- (void)setKeyboardAlpha:(double)alpha
{
  if ([MEMORY[0x1E69DCBB8] usesInputSystemUI])
  {
    [MEMORY[0x1E6979518] activate];
    aBlock[0] = MEMORY[0x1E69E9820];
    aBlock[1] = 3221225472;
    aBlock[2] = __37__CKChatController_setKeyboardAlpha___block_invoke;
    aBlock[3] = &unk_1E72ED810;
    *&aBlock[5] = alpha;
    aBlock[4] = self;
    v5 = _Block_copy(aBlock);
    [MEMORY[0x1E6979518] addCommitHandler:v5 forPhase:5];
  }

  else
  {
    [MEMORY[0x1E69DCBB8] setKeyboardAlpha:alpha];
    mEMORY[0x1E69A8070] = [MEMORY[0x1E69A8070] sharedFeatureFlags];
    isExpressiveTextEnabled = [mEMORY[0x1E69A8070] isExpressiveTextEnabled];

    if (isExpressiveTextEnabled)
    {
      entryView = [(CKChatController *)self entryView];
      contentView = [entryView contentView];
      textView = [contentView textView];
      [textView hideTextEffectsPickerIfNeeded];
    }
  }
}

void __37__CKChatController_setKeyboardAlpha___block_invoke(uint64_t a1)
{
  [MEMORY[0x1E69DCBB8] setKeyboardAlpha:*(a1 + 40)];
  v2 = [MEMORY[0x1E69A8070] sharedFeatureFlags];
  v3 = [v2 isExpressiveTextEnabled];

  if (v3)
  {
    v6 = [*(a1 + 32) entryView];
    v4 = [v6 contentView];
    v5 = [v4 textView];
    [v5 hideTextEffectsPickerIfNeeded];
  }
}

- (void)hideExistingKeyboardSnapshot
{
  keyboardSnapshotView = [(CKChatController *)self keyboardSnapshotView];
  [keyboardSnapshotView setAlpha:0.0];

  [(CKChatController *)self setKeyboardAlpha:1.0];
}

- (void)revealExistingKeyboardSnapshot
{
  keyboardSnapshotView = [(CKChatController *)self keyboardSnapshotView];
  [keyboardSnapshotView setAlpha:1.0];

  [(CKChatController *)self setKeyboardAlpha:0.0];
}

- (void)requestDismissKeyboardSnapshotForReason:(unint64_t)reason
{
  v14 = *MEMORY[0x1E69E9840];
  if (!+[CKUtilities isIpad])
  {
    if (!reason)
    {
      [CKChatController requestDismissKeyboardSnapshotForReason:];
    }

    v5 = self->_keyboardSnapshotReason & ~reason;
    self->_keyboardSnapshotReason = v5;
    if (IMOSLoggingEnabled())
    {
      v6 = OSLogHandleForIMFoundationCategory();
      if (os_log_type_enabled(v6, OS_LOG_TYPE_INFO))
      {
        v7 = [MEMORY[0x1E696AD98] numberWithUnsignedInteger:reason];
        v10 = 138412546;
        v11 = v7;
        v12 = 1024;
        v13 = v5 == 0;
        _os_log_impl(&dword_19020E000, v6, OS_LOG_TYPE_INFO, "request to dismiss keyboardSnapshot with reason: %@, snapshotRemovalNeeded: %{BOOL}d", &v10, 0x12u);
      }
    }

    if (!v5)
    {
      [MEMORY[0x1E69DCBB8] setKeyboardAlpha:1.0];
      keyboardSnapshotView = [(CKChatController *)self keyboardSnapshotView];
      [keyboardSnapshotView removeFromSuperview];

      [(CKChatController *)self setKeyboardSnapshotView:0];
      [(CKChatController *)self updateActiveEntryViewPositioningGuide];
      entryViewKeyboardSnapshotLayoutConstraint = self->_entryViewKeyboardSnapshotLayoutConstraint;
      self->_entryViewKeyboardSnapshotLayoutConstraint = 0;
    }
  }
}

- (void)animatedDismissalOfKeyboardSnapshot
{
  if (self->_keyboardSnapshotView)
  {
    [(CKChatController *)self requestShowKeyboardSnapshotForReason:8];
    v3 = objc_alloc_init(MEMORY[0x1E69DCF88]);
    v4 = objc_alloc(MEMORY[0x1E69DD278]);
    v5 = [v4 initWithDuration:v3 timingParameters:*MEMORY[0x1E69DDFD8]];
    v7[0] = MEMORY[0x1E69E9820];
    v7[1] = 3221225472;
    v7[2] = __55__CKChatController_animatedDismissalOfKeyboardSnapshot__block_invoke;
    v7[3] = &unk_1E72EBA18;
    v7[4] = self;
    [v5 addAnimations:v7];
    v6[0] = MEMORY[0x1E69E9820];
    v6[1] = 3221225472;
    v6[2] = __55__CKChatController_animatedDismissalOfKeyboardSnapshot__block_invoke_2;
    v6[3] = &unk_1E72ED838;
    v6[4] = self;
    [v5 addCompletion:v6];
    [v5 startAnimation];
  }
}

uint64_t __55__CKChatController_animatedDismissalOfKeyboardSnapshot__block_invoke(uint64_t a1)
{
  [*(*(a1 + 32) + 2168) frame];
  v3 = v2;
  v5 = v4;
  v7 = v6;
  v8 = [*(a1 + 32) view];
  v9 = [v8 window];
  [v9 bounds];
  Height = CGRectGetHeight(v14);

  [*(*(a1 + 32) + 2168) setFrame:{v3, Height, v5, v7}];
  v11 = *(*(a1 + 32) + 1808);

  return [v11 setConstant:0.0];
}

- (void)requestDismissKeyboardSnapshotForEffectPickerIfNeeded
{
  if ((self->_keyboardSnapshotReason & 4) != 0)
  {
    [(CKChatController *)self requestDismissKeyboardSnapshotForReason:4];
  }
}

+ (void)donateStickerToRecents:(id)recents
{
  v22 = *MEMORY[0x1E69E9840];
  recentsCopy = recents;
  v5 = IMLogHandleForCategory();
  if (os_log_type_enabled(v5, OS_LOG_TYPE_INFO))
  {
    v6 = [recentsCopy description];
    *buf = 138412290;
    v21 = v6;
    _os_log_impl(&dword_19020E000, v5, OS_LOG_TYPE_INFO, "Donating sticker to recents: %@", buf, 0xCu);
  }

  representations = [recentsCopy representations];
  if (representations)
  {
    goto LABEL_4;
  }

  fileURL = [recentsCopy fileURL];

  if (fileURL)
  {
    fileURL2 = [recentsCopy fileURL];
    v18 = [self representationFromFileURL:fileURL2];

    if (v18)
    {
      v19 = v18;
      representations = [MEMORY[0x1E695DEC8] arrayWithObjects:&v19 count:1];

LABEL_4:
      stickerGUID = [recentsCopy stickerGUID];
      stickerEffectType = [recentsCopy stickerEffectType];
      externalURI = [recentsCopy externalURI];
      stickerName = [recentsCopy stickerName];
      accessibilityLabel = [recentsCopy accessibilityLabel];
      attributionInfo = [recentsCopy attributionInfo];
      v14 = attributionInfo;
      v15 = MEMORY[0x1E695E0F8];
      if (attributionInfo)
      {
        v15 = attributionInfo;
      }

      [self donateStickerToRecentsWithIdentifier:stickerGUID representations:representations stickerEffectType:stickerEffectType externalURI:externalURI name:stickerName accessibilityLabel:accessibilityLabel metadata:0 ckAttributionInfo:v15];

      goto LABEL_7;
    }

    representations = IMLogHandleForCategory();
    if (os_log_type_enabled(representations, OS_LOG_TYPE_ERROR))
    {
      [CKChatController donateStickerToRecents:recentsCopy];
    }
  }

  else
  {
    representations = IMLogHandleForCategory();
    if (os_log_type_enabled(representations, OS_LOG_TYPE_ERROR))
    {
      [CKChatController donateStickerToRecents:recentsCopy];
    }
  }

LABEL_7:
}

+ (void)donateStickerToRecentsWithIdentifier:(id)identifier representations:(id)representations stickerEffectType:(int64_t)type externalURI:(id)i name:(id)name accessibilityLabel:(id)label metadata:(id)metadata ckAttributionInfo:(id)self0
{
  v60 = *MEMORY[0x1E69E9840];
  identifierCopy = identifier;
  representationsCopy = representations;
  iCopy = i;
  nameCopy = name;
  labelCopy = label;
  metadataCopy = metadata;
  infoCopy = info;
  v21 = IMLogHandleForCategory();
  if (os_log_type_enabled(v21, OS_LOG_TYPE_INFO))
  {
    LODWORD(buf) = 138412290;
    *(&buf + 4) = identifierCopy;
    _os_log_impl(&dword_19020E000, v21, OS_LOG_TYPE_INFO, "Donating sticker to recents with identifier: %@", &buf, 0xCu);
  }

  v52 = 0;
  v53 = &v52;
  v54 = 0x2050000000;
  v22 = get_STKMessagesObjCStoreFacadeClass_softClass;
  v55 = get_STKMessagesObjCStoreFacadeClass_softClass;
  if (!get_STKMessagesObjCStoreFacadeClass_softClass)
  {
    *&buf = MEMORY[0x1E69E9820];
    *(&buf + 1) = 3221225472;
    v57 = __get_STKMessagesObjCStoreFacadeClass_block_invoke;
    v58 = &unk_1E72EB968;
    v59 = &v52;
    StickersLibraryCore();
    Class = objc_getClass("_STKMessagesObjCStoreFacade");
    *(v59[1] + 24) = Class;
    get_STKMessagesObjCStoreFacadeClass_softClass = *(v59[1] + 24);
    v22 = v53[3];
  }

  typeCopy = type;
  v40 = identifierCopy;
  v24 = infoCopy;
  v25 = labelCopy;
  v26 = nameCopy;
  v27 = v22;
  _Block_object_dispose(&v52, 8);
  v52 = 0;
  v53 = &v52;
  v54 = 0x2050000000;
  v28 = get_STKStickerUIStickerRepresentationClass_softClass;
  v55 = get_STKStickerUIStickerRepresentationClass_softClass;
  if (!get_STKStickerUIStickerRepresentationClass_softClass)
  {
    *&buf = MEMORY[0x1E69E9820];
    *(&buf + 1) = 3221225472;
    v57 = __get_STKStickerUIStickerRepresentationClass_block_invoke;
    v58 = &unk_1E72EB968;
    v59 = &v52;
    StickersLibraryCore();
    v29 = objc_getClass("_STKStickerUIStickerRepresentation");
    *(v59[1] + 24) = v29;
    get_STKStickerUIStickerRepresentationClass_softClass = *(v59[1] + 24);
    v28 = v53[3];
  }

  v30 = iCopy;
  v31 = v28;
  _Block_object_dispose(&v52, 8);
  v52 = 0;
  v53 = &v52;
  v54 = 0x2050000000;
  v32 = get_STKStickerAttributionInfoClass_softClass;
  v55 = get_STKStickerAttributionInfoClass_softClass;
  if (!get_STKStickerAttributionInfoClass_softClass)
  {
    *&buf = MEMORY[0x1E69E9820];
    *(&buf + 1) = 3221225472;
    v57 = __get_STKStickerAttributionInfoClass_block_invoke;
    v58 = &unk_1E72EB968;
    v59 = &v52;
    StickersLibraryCore();
    v33 = objc_getClass("_STKStickerAttributionInfo");
    *(v59[1] + 24) = v33;
    get_STKStickerAttributionInfoClass_softClass = *(v59[1] + 24);
    v32 = v53[3];
  }

  v34 = v32;
  _Block_object_dispose(&v52, 8);
  if (v22 && v28 && v32)
  {
    v35 = dispatch_get_global_queue(25, 0);
    block[0] = MEMORY[0x1E69E9820];
    block[1] = 3221225472;
    block[2] = __154__CKChatController_donateStickerToRecentsWithIdentifier_representations_stickerEffectType_externalURI_name_accessibilityLabel_metadata_ckAttributionInfo___block_invoke;
    block[3] = &unk_1E72ED860;
    v48 = v22;
    v42 = representationsCopy;
    v49 = v28;
    v43 = v24;
    v50 = v32;
    v36 = v40;
    v44 = v40;
    v51 = typeCopy;
    v45 = v30;
    v46 = v26;
    v47 = v25;
    dispatch_async(v35, block);

    v37 = v42;
  }

  else
  {
    IMLogHandleForCategory();
    v37 = v36 = v40;
    if (os_log_type_enabled(v37, OS_LOG_TYPE_ERROR))
    {
      +[CKChatController donateStickerToRecentsWithIdentifier:representations:stickerEffectType:externalURI:name:accessibilityLabel:metadata:ckAttributionInfo:];
    }
  }
}

void __154__CKChatController_donateStickerToRecentsWithIdentifier_representations_stickerEffectType_externalURI_name_accessibilityLabel_metadata_ckAttributionInfo___block_invoke(uint64_t a1)
{
  v36 = *MEMORY[0x1E69E9840];
  v29 = objc_alloc_init(*(a1 + 80));
  v2 = [MEMORY[0x1E695DF70] arrayWithCapacity:{objc_msgSend(*(a1 + 32), "count")}];
  v31 = 0u;
  v32 = 0u;
  v33 = 0u;
  v34 = 0u;
  v3 = *(a1 + 32);
  v4 = [v3 countByEnumeratingWithState:&v31 objects:v35 count:16];
  if (v4)
  {
    v5 = v4;
    v6 = *v32;
    do
    {
      for (i = 0; i != v5; ++i)
      {
        if (*v32 != v6)
        {
          objc_enumerationMutation(v3);
        }

        v8 = *(*(&v31 + 1) + 8 * i);
        v9 = objc_alloc(*(a1 + 88));
        v10 = [v8 data];
        v11 = [v8 type];
        [v8 size];
        v13 = v12;
        v15 = v14;
        v16 = [v8 role];
        v17 = [v9 initWithData:v10 type:v11 size:v16 role:{v13, v15}];

        [v2 addObject:v17];
      }

      v5 = [v3 countByEnumeratingWithState:&v31 objects:v35 count:16];
    }

    while (v5);
  }

  v18 = [*(a1 + 40) objectForKeyedSubscript:*MEMORY[0x1E69A6FA0]];
  v19 = [*(a1 + 40) objectForKeyedSubscript:*MEMORY[0x1E69A6FB0]];
  v20 = [*(a1 + 40) objectForKeyedSubscript:*MEMORY[0x1E69A6FA8]];
  v21 = [objc_alloc(*(a1 + 96)) initWithAdamID:v18 bundleIdentifier:v19 name:v20];
  v22 = *(a1 + 104);
  v23 = *(a1 + 48);
  v24 = *(a1 + 56);
  v25 = *(a1 + 64);
  v26 = *(a1 + 72);
  v30 = 0;
  [v29 donateStickerToRecentsWithIdentifier:v23 representations:v2 stickerEffectEnum:v22 externalURI:v24 name:v25 accessibilityName:v26 metadata:0 attributionInfo:v21 error:&v30];
  v27 = v30;
  if (v27)
  {
    v28 = IMLogHandleForCategory();
    if (os_log_type_enabled(v28, OS_LOG_TYPE_ERROR))
    {
      __154__CKChatController_donateStickerToRecentsWithIdentifier_representations_stickerEffectType_externalURI_name_accessibilityLabel_metadata_ckAttributionInfo___block_invoke_cold_1();
    }
  }
}

+ (id)representationFromFileURL:(id)l
{
  lCopy = l;
  v4 = lCopy;
  if (lCopy)
  {
    v5 = MEMORY[0x1E69DCAB8];
    path = [(__CFURL *)lCopy path];
    v7 = [v5 imageWithContentsOfFile:path];

    if (v7 && (v8 = CGImageSourceCreateWithURL(v4, 0), Type = CGImageSourceGetType(v8), CFRelease(v8), Type))
    {
      v10 = objc_alloc_init(MEMORY[0x1E69DD760]);
      v16 = 0;
      v11 = [MEMORY[0x1E695DEF0] dataWithContentsOfURL:v4 options:1 error:&v16];
      v12 = v16;
      [v10 setData:v11];

      v13 = 0;
      if (!v12)
      {
        v14 = [(__CFString *)Type copy];
        [v10 setType:v14];

        [v7 size];
        [v10 setSize:?];
        v13 = v10;
      }
    }

    else
    {
      v13 = 0;
    }
  }

  else
  {
    v13 = 0;
  }

  return v13;
}

- (void)dragManagerDidBeginDragging:(id)dragging
{
  conversation = [(CKCoreChatController *)self conversation];
  chat = [conversation chat];

  [chat beginHoldingChatItemsUpdatesForReason:*MEMORY[0x1E69A57C8]];
  [(CKScrollViewController *)self beginHoldingScrollGeometryUpdatesForReason:@"StickerDrag"];
  [(CKChatController *)self setScrollDownIsValid:0];
  collectionView = [(CKChatController *)self collectionView];
  [collectionView beginDisablingTranscriptDynamicsForReason:4];
}

- (void)dragManager:(id)manager draggedItemWithTarget:(id)target
{
  targetCopy = target;
  collectionViewController = [(CKCoreChatController *)self collectionViewController];
  collectionView = [collectionViewController collectionView];

  v8 = [(CKChatController *)self selectedBalloonForTarget:targetCopy];
  [(CKChatController *)self _setOverlayForBalloonViewAtIndexPath:v8 animated:1];
  if (manager)
  {
    goto LABEL_17;
  }

  [targetCopy screenCoordinate];
  v10 = v9;
  v11 = +[CKUIBehavior sharedBehaviors];
  [v11 dragTranscriptScrollThreshold];
  v13 = v12;

  view = [(CKChatController *)self view];
  [view bounds];
  Height = CGRectGetHeight(v34);
  [collectionView contentInset];
  v17 = Height - v16;

  if (v10 >= v13 && v10 <= v17)
  {
    [(CKChatController *)self setScrollDownIsValid:1];
    goto LABEL_11;
  }

  v19 = +[CKUIBehavior sharedBehaviors];
  [v19 dragTranscriptScrollDisplayLinkMaxDelta];
  v21 = v20;

  if (v10 < v13)
  {
    v22 = (v13 - v10) / v13;
    v23 = -v22;
    v24 = v22 < 1.0;
    v25 = -1.0;
    if (v24)
    {
      v25 = v23;
    }

    goto LABEL_9;
  }

  v26 = 0.0;
  if (v10 > v17)
  {
    if ([(CKChatController *)self scrollDownIsValid])
    {
      v25 = fmin((v10 - v17) / v13, 1.0);
LABEL_9:
      v26 = v25 * v21;
      goto LABEL_15;
    }

    [(CKChatController *)self setStickerTranscriptScrollDelta:0.0];
LABEL_11:
    stickerTranscriptScrollDisplayLink = [(CKChatController *)self stickerTranscriptScrollDisplayLink];
    [stickerTranscriptScrollDisplayLink invalidate];

    [(CKChatController *)self setStickerTranscriptScrollDisplayLink:0];
    goto LABEL_17;
  }

LABEL_15:
  [(CKChatController *)self setStickerTranscriptScrollDelta:v26];
  stickerTranscriptScrollDisplayLink2 = [(CKChatController *)self stickerTranscriptScrollDisplayLink];

  if (!stickerTranscriptScrollDisplayLink2)
  {
    mainScreen = [MEMORY[0x1E69DCEB0] mainScreen];
    v30 = [mainScreen displayLinkWithTarget:self selector:sel__stickerTranscriptScrollDisplayLinkFired];

    mainRunLoop = [MEMORY[0x1E695DFD0] mainRunLoop];
    [v30 addToRunLoop:mainRunLoop forMode:*MEMORY[0x1E695DA28]];

    [(CKChatController *)self setStickerTranscriptScrollDisplayLink:v30];
  }

LABEL_17:
}

- (void)_stickerTranscriptScrollDisplayLinkFired
{
  collectionView = [(CKChatController *)self collectionView];
  [collectionView contentOffset];
  v4 = v3;
  v6 = v5;
  stickerTranscriptScrollDelta = self->_stickerTranscriptScrollDelta;
  inputController = [(CKCoreChatController *)self inputController];
  stickerPickerMessagePartChatItem = [inputController stickerPickerMessagePartChatItem];

  if (!stickerPickerMessagePartChatItem)
  {
    v10 = v6 + stickerTranscriptScrollDelta;
    [(CKScrollViewController *)self computedInsets];
    [collectionView __ck_bottomOffsetWithComputedInsets:?];
    if (v10 < v11)
    {
      [collectionView __ck_scrollToTopContentOffset];
      if (v10 > v12)
      {
        [collectionView setContentOffset:{v4, v10}];
      }
    }
  }
}

- (id)selectedBalloonForTarget:(id)target
{
  targetCopy = target;
  [targetCopy screenCoordinate];
  v6 = v5;
  v8 = v7;
  v9 = *MEMORY[0x1E695F058];
  v10 = *(MEMORY[0x1E695F058] + 8);
  [targetCopy initialSize];
  v12 = v11;
  v14 = v13;
  [targetCopy scale];
  v16 = v15;
  [targetCopy meshScaleFactor];
  v18 = v17;

  v19 = v12 * (v16 / v18);
  v20 = v14 * (v16 / v18);
  v25.origin.x = v9;
  v25.origin.y = v10;
  v25.size.width = v19;
  v25.size.height = v20;
  v21 = v6 - CGRectGetWidth(v25) * 0.5;
  v26.origin.x = v9;
  v26.origin.y = v10;
  v26.size.width = v19;
  v26.size.height = v20;
  v22 = v8 - CGRectGetHeight(v26) * 0.5;

  return [(CKChatController *)self selectedBalloonIntersectingRect:v21, v22, v19, v20];
}

- (id)selectedBalloonIntersectingRect:(CGRect)rect chatItemForRepositioning:(id)repositioning
{
  height = rect.size.height;
  width = rect.size.width;
  y = rect.origin.y;
  x = rect.origin.x;
  v86 = *MEMORY[0x1E69E9840];
  repositioningCopy = repositioning;
  v88.origin.x = x;
  v88.origin.y = y;
  v88.size.width = width;
  v88.size.height = height;
  MidX = CGRectGetMidX(v88);
  v55 = x;
  v89.origin.x = x;
  v56 = y;
  v57 = width;
  v89.origin.y = y;
  v89.size.width = width;
  v58 = height;
  v89.size.height = height;
  MidY = CGRectGetMidY(v89);
  collectionViewController = [(CKCoreChatController *)self collectionViewController];
  collectionView = [collectionViewController collectionView];
  indexPathsForVisibleItems = [collectionView indexPathsForVisibleItems];
  v59 = [objc_alloc(MEMORY[0x1E695DF90]) initWithCapacity:{objc_msgSend(indexPathsForVisibleItems, "count")}];
  v81 = 0u;
  v82 = 0u;
  v83 = 0u;
  v84 = 0u;
  v11 = indexPathsForVisibleItems;
  v12 = [v11 countByEnumeratingWithState:&v81 objects:v85 count:16];
  if (v12)
  {
    v13 = *v82;
    do
    {
      for (i = 0; i != v12; ++i)
      {
        if (*v82 != v13)
        {
          objc_enumerationMutation(v11);
        }

        v15 = *(*(&v81 + 1) + 8 * i);
        if (![v15 section])
        {
          chatItems = [collectionViewController chatItems];
          v17 = [chatItems objectAtIndex:{objc_msgSend(v15, "item")}];

          objc_opt_class();
          if ((objc_opt_isKindOfClass() & 1) != 0 && (!repositioningCopy || [repositioningCopy isEqual:v17]))
          {
            v18 = [collectionView cellForItemAtIndexPath:v15];
            objc_opt_class();
            if (objc_opt_isKindOfClass())
            {
              balloonView = [v18 balloonView];
              v20 = balloonView;
              if (balloonView)
              {
                superview = [balloonView superview];
                [v20 frame];
                [superview convertRect:collectionView toView:?];
                v60 = v23;
                v61 = v22;
                v25 = v24;
                v27 = v26;

                [collectionView frame];
                v29 = v28;
                v31 = v30;
                v33 = v32;
                v35 = v34;
                v90.origin.x = v25;
                v90.size.width = v60;
                v90.origin.y = v61;
                v90.size.height = v27;
                MinX = CGRectGetMinX(v90);
                v91.origin.x = v29;
                v91.origin.y = v31;
                v91.size.width = v33;
                v91.size.height = v35;
                v37 = CGRectGetMinX(v91);
                v92.origin.x = v29;
                v92.origin.y = v31;
                v92.size.width = v33;
                v92.size.height = v35;
                MaxX = CGRectGetMaxX(v92);
                v93.origin.x = v25;
                v93.size.width = v60;
                v93.origin.y = v61;
                v93.size.height = v27;
                v39 = CGRectGetMaxX(v93);
                v40 = fmin(MinX - v37, 75.0);
                [collectionView convertRect:0 toView:{v25 - v40, v61, v60 + v40 + fmin(MaxX - v39, 75.0), v27 + 0.0}];
                v41 = [MEMORY[0x1E696B098] valueWithCGRect:?];
                [v59 setObject:v41 forKey:v15];
              }
            }
          }
        }
      }

      v12 = [v11 countByEnumeratingWithState:&v81 objects:v85 count:16];
    }

    while (v12);
  }

  v42 = [v59 copy];
  allKeys = [v42 allKeys];
  v75[0] = MEMORY[0x1E69E9820];
  v75[1] = 3221225472;
  v75[2] = __77__CKChatController_selectedBalloonIntersectingRect_chatItemForRepositioning___block_invoke;
  v75[3] = &unk_1E72ED888;
  v44 = v59;
  v76 = v44;
  v77 = v55;
  v78 = v56;
  v79 = v57;
  v80 = v58;
  [allKeys enumerateObjectsUsingBlock:v75];

  allKeys2 = [v44 allKeys];
  v46 = [allKeys2 count];

  if (v46)
  {
    allKeys3 = [v44 allKeys];
    v48 = [allKeys3 count] == 1;

    if (v48)
    {
      allKeys4 = [v44 allKeys];
      firstObject = [allKeys4 firstObject];
    }

    else
    {
      v69 = 0;
      v70 = &v69;
      v71 = 0x3032000000;
      v72 = __Block_byref_object_copy__8;
      v73 = __Block_byref_object_dispose__8;
      v74 = 0;
      allKeys5 = [v44 allKeys];
      v64[0] = MEMORY[0x1E69E9820];
      v64[1] = 3221225472;
      v64[2] = __77__CKChatController_selectedBalloonIntersectingRect_chatItemForRepositioning___block_invoke_1208;
      v64[3] = &unk_1E72ED8B0;
      v67 = MidX;
      v68 = MidY;
      v65 = v44;
      v66 = &v69;
      [allKeys5 enumerateObjectsUsingBlock:v64];

      firstObject = v70[5];
      _Block_object_dispose(&v69, 8);
    }
  }

  else
  {
    firstObject = 0;
  }

  return firstObject;
}

void __77__CKChatController_selectedBalloonIntersectingRect_chatItemForRepositioning___block_invoke(uint64_t a1, void *a2)
{
  v12 = a2;
  v3 = [*(a1 + 32) objectForKey:?];
  [v3 CGRectValue];
  v5 = v4;
  v7 = v6;
  v9 = v8;
  v11 = v10;

  v14.origin.x = v5;
  v14.origin.y = v7;
  v14.size.width = v9;
  v14.size.height = v11;
  if (!CGRectIntersectsRect(v14, *(a1 + 40)))
  {
    [*(a1 + 32) removeObjectForKey:v12];
  }
}

void __77__CKChatController_selectedBalloonIntersectingRect_chatItemForRepositioning___block_invoke_1208(uint64_t a1, void *a2, uint64_t a3, _BYTE *a4)
{
  v18 = a2;
  v7 = [*(a1 + 32) objectForKey:?];
  [v7 CGRectValue];
  v9 = v8;
  v11 = v10;
  v13 = v12;
  v15 = v14;

  v16 = *(a1 + 56);
  v20.origin.x = v9;
  v20.origin.y = v11;
  v20.size.width = v13;
  v20.size.height = v15;
  if (v16 > CGRectGetMinY(v20))
  {
    v17 = *(a1 + 56);
    v21.origin.x = v9;
    v21.origin.y = v11;
    v21.size.width = v13;
    v21.size.height = v15;
    if (v17 < CGRectGetMaxY(v21))
    {
      objc_storeStrong((*(*(a1 + 40) + 8) + 40), a2);
      *a4 = 1;
    }
  }
}

- (void)dragManagerDidEndDragging:(id)dragging
{
  [(CKChatController *)self _clearBalloonViewOverlaysWithAnimation:1];
  stickerTranscriptScrollDisplayLink = [(CKChatController *)self stickerTranscriptScrollDisplayLink];
  [stickerTranscriptScrollDisplayLink invalidate];

  [(CKChatController *)self setStickerTranscriptScrollDisplayLink:0];
  collectionView = [(CKChatController *)self collectionView];
  conversation = [(CKCoreChatController *)self conversation];
  chat = [conversation chat];

  [collectionView endDisablingTranscriptDynamicsForReason:4];
  [(CKScrollViewController *)self endHoldingScrollGeometryUpdatesForReason:@"StickerDrag"];
  [chat endHoldingChatItemsUpdatesForReason:*MEMORY[0x1E69A57C8]];
  browserDragManager = self->_browserDragManager;
  self->_browserDragManager = 0;

  collectionViewController = [(CKCoreChatController *)self collectionViewController];
  v10 = dispatch_time(0, 250000000);
  block[0] = MEMORY[0x1E69E9820];
  block[1] = 3221225472;
  block[2] = __46__CKChatController_dragManagerDidEndDragging___block_invoke;
  block[3] = &unk_1E72EBA18;
  v13 = collectionViewController;
  v11 = collectionViewController;
  dispatch_after(v10, MEMORY[0x1E69E96A0], block);
}

- (int)dragManager:(id)manager dropAreaForDragTarget:(id)target
{
  targetCopy = target;
  [targetCopy screenCoordinate];
  v7 = v6;
  v9 = v8;
  inputController = [(CKCoreChatController *)self inputController];
  inputViewController = [inputController inputViewController];
  view = [inputViewController view];
  v13 = view;
  v51 = v9;
  v52 = v7;
  if (view)
  {
    view2 = view;
  }

  else
  {
    viewControllerForChatInputModalPresentation = [(CKChatController *)self viewControllerForChatInputModalPresentation];
    presentedViewController = [viewControllerForChatInputModalPresentation presentedViewController];
    view2 = [presentedViewController view];
  }

  superview = [view2 superview];
  [view2 frame];
  [superview convertRect:0 toView:?];
  v49 = v19;
  v50 = v18;
  v47 = v21;
  v48 = v20;

  entryView = [(CKChatController *)self entryView];
  superview2 = [entryView superview];
  entryView2 = [(CKChatController *)self entryView];
  [entryView2 frame];
  [superview2 convertRect:0 toView:?];
  v26 = v25;
  v28 = v27;
  v30 = v29;
  v32 = v31;

  collectionView = [(CKChatController *)self collectionView];
  superview3 = [collectionView superview];
  collectionView2 = [(CKChatController *)self collectionView];
  [collectionView2 frame];
  [superview3 convertRect:0 toView:?];
  v37 = v36;
  v39 = v38;
  v41 = v40;
  v43 = v42;

  v44 = [(CKChatController *)self selectedBalloonForTarget:targetCopy];

  v56.origin.x = v26;
  v56.origin.y = v28;
  v56.size.width = v30;
  v56.size.height = v32;
  v53.x = v52;
  v53.y = v51;
  if (CGRectContainsPoint(v56, v53))
  {
    v45 = 2;
  }

  else
  {
    v57.origin.y = v49;
    v57.origin.x = v50;
    v57.size.height = v47;
    v57.size.width = v48;
    v54.x = v52;
    v54.y = v51;
    if (CGRectContainsPoint(v57, v54))
    {
      v45 = 3;
    }

    else if (v44)
    {
      v45 = 4;
    }

    else
    {
      v58.origin.x = v37;
      v58.origin.y = v39;
      v58.size.width = v41;
      v58.size.height = v43;
      v55.x = v52;
      v55.y = v51;
      v45 = CGRectContainsPoint(v58, v55);
    }
  }

  return v45;
}

- (void)setLocalUserIsComposing:(BOOL)composing withPluginBundleID:(id)d typingIndicatorData:(id)data
{
  composingCopy = composing;
  dCopy = d;
  dataCopy = data;
  conversation = [(CKCoreChatController *)self conversation];
  v10 = conversation;
  if (composingCopy)
  {
    [conversation setLocalUserIsComposing:dCopy typingIndicatorIcon:dataCopy];
  }

  else
  {
    [conversation setLocalUserIsComposing:0];
  }
}

- (void)chatInputControllerRequestInputViewFocusFromFullscreen:(id)fullscreen
{
  self->_shouldBecomeFirstResponderWhenDismissingModalBrowser = 0;
  [(CKChatController *)self setTargetFirstResponder:1];

  [(CKChatController *)self becomeFirstResponder];
}

- (void)chatInputDidUpdateInputViewShowingBrowser:(BOOL)browser entryFieldCollapsed:(BOOL)collapsed animated:(BOOL)animated
{
  browserCopy = browser;
  v7 = [(CKChatController *)self entryView:browser];
  contentView = [v7 contentView];
  textView = [contentView textView];

  if (browserCopy)
  {
    view = [(CKChatController *)self view];
    window = [view window];
    isKeyWindow = [window isKeyWindow];

    if ((isKeyWindow & 1) == 0)
    {
      view2 = [(CKChatController *)self view];
      window2 = [view2 window];
      [window2 makeKeyWindow];
    }

    [textView becomeFirstResponder];
    [textView saveKeyboardInputMode];
  }

  firstResponder = [(CKChatController *)self firstResponder];
  [firstResponder reloadInputViews];

  v16 = MEMORY[0x1E69DD250];
  v18[0] = MEMORY[0x1E69E9820];
  v18[1] = 3221225472;
  v18[2] = __91__CKChatController_chatInputDidUpdateInputViewShowingBrowser_entryFieldCollapsed_animated___block_invoke;
  v18[3] = &unk_1E72ED8D8;
  v20 = browserCopy;
  v19 = textView;
  v17 = textView;
  [v16 performWithoutAnimation:v18];
}

uint64_t __91__CKChatController_chatInputDidUpdateInputViewShowingBrowser_entryFieldCollapsed_animated___block_invoke(uint64_t result)
{
  if ((*(result + 40) & 1) == 0)
  {
    return [*(result + 32) restoreKeyboardInputMode];
  }

  return result;
}

- (void)chatInputDidUpdateWithNewInputViewController:(id)controller
{
  firstResponder = [(CKChatController *)self firstResponder];
  [firstResponder reloadInputViews];
}

- (void)chatInputControllerWillPresentModalBrowserViewController:(id)controller
{
  entryView = [(CKChatController *)self entryView];
  contentView = [entryView contentView];
  isActive = [contentView isActive];

  [(CKChatController *)self setTargetFirstResponder:0];
  [(CKChatController *)self becomeFirstResponder];
  [(CKChatController *)self setTargetFirstResponder:isActive];
  collectionView = [(CKChatController *)self collectionView];
  [collectionView beginHoldingContentOffsetUpdatesForReason:@"ChatControllerModalBrowser"];

  collectionViewController = [(CKCoreChatController *)self collectionViewController];
  [collectionViewController setAllowsPluginPlayback:0];

  collectionViewController2 = [(CKCoreChatController *)self collectionViewController];
  [collectionViewController2 stopPluginPlayback];
}

- (void)chatInputControllerWillDismissModalBrowserViewController:(id)controller
{
  [(CKScrollViewController *)self endHoldingScrollGeometryUpdatesForReason:@"BrowserTransition"];
  collectionViewController = [(CKCoreChatController *)self collectionViewController];
  [collectionViewController scrollTranscriptToEntryViewInsertionTimeWithAnimation:0];

  collectionViewController2 = [(CKCoreChatController *)self collectionViewController];
  [collectionViewController2 setTranscriptUpdateAnimated:1];
}

- (void)chatInputControllerDidDismissModalBrowserViewController:(id)controller
{
  collectionView = [(CKChatController *)self collectionView];
  [collectionView endHoldingContentOffsetUpdatesForReason:@"ChatControllerModalBrowser"];

  if (self->_shouldDisplayKeyboardWhenDismissingModalBrowser)
  {
    entryView = [(CKChatController *)self entryView];
    contentView = [entryView contentView];
    isActive = [contentView isActive];

    if ((isActive & 1) == 0)
    {
      [(CKChatController *)self setTargetFirstResponder:1];
    }
  }

  if (self->_shouldBecomeFirstResponderWhenDismissingModalBrowser)
  {
    [(CKChatController *)self becomeFirstResponder];
  }

  [MEMORY[0x1E69DD258] attemptRotationToDeviceOrientation];
  self->_shouldBecomeFirstResponderWhenDismissingModalBrowser = 1;
  collectionViewController = [(CKCoreChatController *)self collectionViewController];
  [collectionViewController setAllowsPluginPlayback:1];

  collectionViewController2 = [(CKCoreChatController *)self collectionViewController];
  [collectionViewController2 startPluginPlaybackAfterDelay:0.0];

  entryView2 = [(CKChatController *)self entryView];
  [entryView2 setAlpha:1.0];

  delegate = [(CKCoreChatController *)self delegate];
  v12 = objc_opt_respondsToSelector();

  if (v12)
  {
    delegate2 = [(CKCoreChatController *)self delegate];
    [delegate2 stopForcingOrientation];
  }
}

- (void)chatInputControllerDidDismissCompactBrowserViewController:(id)controller
{
  collectionViewController = [(CKCoreChatController *)self collectionViewController];
  [collectionViewController scrollTranscriptToEntryViewInsertionTimeWithAnimation:1];

  entryView = [(CKChatController *)self entryView];
  [entryView setAlpha:1.0];
}

- (void)chatInputController:(id)controller willPresentStickerPickerForChatItem:(id)item
{
  itemCopy = item;
  if (!CKIsAppCardsEnabled())
  {
    collectionViewController = [(CKCoreChatController *)self collectionViewController];
    [collectionViewController beginPresentingChatItemForKeyboardPresentation:itemCopy layoutAreaContentInsets:0 completion:{40.0, 0.0, 40.0, 0.0}];
  }
}

- (void)chatInputControllerDidSelectRequestLocation:(id)location
{
  locationCopy = location;
  inputController = [(CKCoreChatController *)self inputController];

  if (inputController == locationCopy)
  {

    [(CKChatController *)self _stageFindMyLocationRequest];
  }
}

- (void)chatInputController:(id)controller didPresentStickerPickerForChatItem:(id)item
{
  itemCopy = item;
  if (!CKIsAppCardsEnabled())
  {
    collectionViewController = [(CKCoreChatController *)self collectionViewController];
    [collectionViewController endPresentingChatItemForKeyboardPresentation:itemCopy completion:0];
  }
}

- (void)chatInputDidSelectPhotoPicker
{
  v17[3] = *MEMORY[0x1E69E9840];
  v3 = objc_alloc_init(MEMORY[0x1E69DCAD0]);
  [(CKChatController *)self setImagePickerController:v3];
  [v3 setDelegate:self];
  v4 = *MEMORY[0x1E6963850];
  v17[0] = *MEMORY[0x1E69637F8];
  v17[1] = v4;
  v17[2] = *MEMORY[0x1E6963818];
  v5 = [MEMORY[0x1E695DEC8] arrayWithObjects:v17 count:3];
  [v3 setMediaTypes:v5];

  v6 = MEMORY[0x1E695E118];
  [v3 _setValue:MEMORY[0x1E695E118] forProperty:@"_UIImagePickerControllerSkipConfirmation"];
  [v3 _setValue:v6 forProperty:@"_UIImagePickerControllerMessagesLayout"];
  [v3 setSourceType:0];
  [v3 setModalPresentationStyle:7];
  [v3 setAllowsEditing:0];
  v7 = v3;
  popoverPresentationController = [v7 popoverPresentationController];
  [popoverPresentationController setPermittedArrowDirections:8];
  mEMORY[0x1E69A8070] = [MEMORY[0x1E69A8070] sharedFeatureFlags];
  isSendMenuEnabled = [mEMORY[0x1E69A8070] isSendMenuEnabled];

  if (isSendMenuEnabled)
  {
    inputController = [(CKCoreChatController *)self inputController];
    entryView = [inputController entryView];
    sendMenuSourceView = [entryView sendMenuSourceView];
    [popoverPresentationController setSourceView:sendMenuSourceView];

    inputController2 = [(CKCoreChatController *)self inputController];
    entryView2 = [inputController2 entryView];
    sendMenuSourceView2 = [entryView2 sendMenuSourceView];
    [sendMenuSourceView2 bounds];
    [popoverPresentationController setSourceRect:?];
  }

  else
  {
    inputController2 = [v7 presentationController];
    entryView2 = [(CKChatController *)self entryView];
    sendMenuSourceView2 = [entryView2 sendMenuSourceView];
    [inputController2 setSourceView:sendMenuSourceView2];
  }

  [(CKChatController *)self presentViewController:v7 animated:1 completion:0];
}

- (void)chatInputDidSelectEffectPicker
{
  entryView = [(CKChatController *)self entryView];
  composition = [entryView composition];
  hasContent = [composition hasContent];

  if (hasContent)
  {

    [(CKChatController *)self showEffectPicker];
  }

  else
  {
    entryView2 = [(CKChatController *)self entryView];
    [entryView2 showMessageEffectsHint];
  }
}

- (void)chatInputControllerWillSelectFunCamera:(id)camera
{
  cameraCopy = camera;
  v5 = +[CKBalloonPluginManager sharedInstance];
  isCameraAllowed = [v5 isCameraAllowed];

  if (isCameraAllowed)
  {
    inputController = [(CKCoreChatController *)self inputController];
    isInputViewVisible = [inputController isInputViewVisible];

    if ((isInputViewVisible & 1) == 0)
    {
      [(CKChatController *)self prewarmFunCamera];
    }
  }

  else if (IMOSLoggingEnabled())
  {
    v9 = OSLogHandleForIMFoundationCategory();
    if (os_log_type_enabled(v9, OS_LOG_TYPE_INFO))
    {
      *v10 = 0;
      _os_log_impl(&dword_19020E000, v9, OS_LOG_TYPE_INFO, "chatInputControllerWillSelectFunCamera: Not attempting to present Camera. Camera restriction in effect.", v10, 2u);
    }
  }
}

- (void)chatInputControllerCancelSelectFunCamera:(id)camera
{
  v4 = +[CKBalloonPluginManager sharedInstance];
  funCameraViewController = [(CKChatController *)self funCameraViewController];
  balloonPlugin = [funCameraViewController balloonPlugin];
  identifier = [balloonPlugin identifier];
  v8 = [v4 existingViewControllerForPluginIdentifier:identifier];

  [v8 beginAppearanceTransition:0 animated:0];
  [v8 endAppearanceTransition];
}

- (void)chatInputControllerDidSelectFunCamera:(id)camera
{
  cameraCopy = camera;
  if (CKIsRunningInMessagesTranscriptExtension())
  {
    [(CKChatController *)self openURLInExtensionContextForMode:@"photos"];
  }

  else
  {
    v5 = +[CKBalloonPluginManager sharedInstance];
    isCameraAllowed = [v5 isCameraAllowed];

    if (isCameraAllowed)
    {
      aBlock[0] = MEMORY[0x1E69E9820];
      aBlock[1] = 3221225472;
      aBlock[2] = __58__CKChatController_chatInputControllerDidSelectFunCamera___block_invoke;
      aBlock[3] = &unk_1E72EBA18;
      aBlock[4] = self;
      v7 = _Block_copy(aBlock);
      inputController = [(CKCoreChatController *)self inputController];
      isInputViewVisible = [inputController isInputViewVisible];

      if (isInputViewVisible)
      {
        inputController2 = [(CKCoreChatController *)self inputController];
        [inputController2 forceDismissBrowserWithoutAnimation];

        v11 = +[CKBalloonPluginManager sharedInstance];
        [v11 forceKillNonCameraRemoteExtensionsImmediately];
      }

      funCameraViewController = [(CKChatController *)self funCameraViewController];

      if (funCameraViewController)
      {
        v7[2](v7);
      }

      else
      {
        inputController3 = [(CKCoreChatController *)self inputController];
        isInputViewVisible2 = [inputController3 isInputViewVisible];

        if (isInputViewVisible2)
        {
          inputController4 = [(CKCoreChatController *)self inputController];
          [inputController4 forceDismissBrowserWithoutAnimation];

          v17 = +[CKBalloonPluginManager sharedInstance];
          [v17 forceKillNonCameraRemoteExtensionsImmediately];

          v18 = 50000000;
        }

        else
        {
          v18 = 0;
        }

        v19 = dispatch_time(0, v18);
        block[0] = MEMORY[0x1E69E9820];
        block[1] = 3221225472;
        block[2] = __58__CKChatController_chatInputControllerDidSelectFunCamera___block_invoke_1216;
        block[3] = &unk_1E72ED1C8;
        block[4] = self;
        v21 = v7;
        dispatch_after(v19, MEMORY[0x1E69E96A0], block);
      }
    }

    else if (IMOSLoggingEnabled())
    {
      v13 = OSLogHandleForIMFoundationCategory();
      if (os_log_type_enabled(v13, OS_LOG_TYPE_INFO))
      {
        *buf = 0;
        _os_log_impl(&dword_19020E000, v13, OS_LOG_TYPE_INFO, "chatInputControllerDidSelectFunCamera: Not attempting to present Camera. Camera restriction in effect.", buf, 2u);
      }
    }
  }
}

void __58__CKChatController_chatInputControllerDidSelectFunCamera___block_invoke(uint64_t a1)
{
  if ([*(a1 + 32) isShowingCamera])
  {
    if (!IMOSLoggingEnabled())
    {
      return;
    }

    v2 = OSLogHandleForIMFoundationCategory();
    if (!os_log_type_enabled(v2, OS_LOG_TYPE_INFO))
    {
      goto LABEL_12;
    }

    v17 = 0;
    v3 = "Not presenting FunCam, instance of camera already presented";
    v4 = &v17;
LABEL_11:
    _os_log_impl(&dword_19020E000, v2, OS_LOG_TYPE_INFO, v3, v4, 2u);
LABEL_12:

    return;
  }

  if (![*(a1 + 32) appeared])
  {
    if (!IMOSLoggingEnabled())
    {
      return;
    }

    v2 = OSLogHandleForIMFoundationCategory();
    if (!os_log_type_enabled(v2, OS_LOG_TYPE_INFO))
    {
      goto LABEL_12;
    }

    *buf = 0;
    v3 = "Not presenting FunCam, chat controller is dissapearing or dissapeared";
    v4 = buf;
    goto LABEL_11;
  }

  [*(a1 + 32) setIsShowingCamera:1];
  v5 = [*(a1 + 32) entryView];
  v6 = [v5 contentView];
  v7 = [v6 isActive];

  if (v7)
  {
    v8 = [*(a1 + 32) entryView];
    v9 = [v8 contentView];
    v10 = [v9 activeView];
    [v10 resignFirstResponder];
  }

  else if (!CKIsAppCardsEnabled())
  {
    [*(a1 + 32) resignFirstResponder];
  }

  v11 = *(a1 + 32);
  v12 = [v11 funCameraViewController];
  [v12 setDelegate:v11];

  v13 = [*(a1 + 32) funCameraViewController];
  [v13 setModalPresentationStyle:0];

  v14 = *(a1 + 32);
  v15 = [v14 funCameraViewController];
  [v14 presentViewController:v15 animated:1 completion:0];
}

uint64_t __58__CKChatController_chatInputControllerDidSelectFunCamera___block_invoke_1216(uint64_t a1)
{
  [*(a1 + 32) prewarmFunCamera];
  v2 = *(*(a1 + 40) + 16);

  return v2();
}

- (void)chatInputController:(id)controller requestPresentSendMenu:(id)menu
{
  menuCopy = menu;
  [(CKChatController *)self animateSendMenuStatusBarAppearanceUpdate];
  mEMORY[0x1E69A8070] = [MEMORY[0x1E69A8070] sharedFeatureFlags];
  isPopoverSendMenuEnabled = [mEMORY[0x1E69A8070] isPopoverSendMenuEnabled];

  if (isPopoverSendMenuEnabled && (-[CKChatController presentedViewController](self, "presentedViewController"), v8 = objc_claimAutoreleasedReturnValue(), v9 = [v8 conformsToProtocol:&unk_1F06826C0], v8, v9))
  {
    presentedViewController = [(CKChatController *)self presentedViewController];
  }

  else
  {
    presentedViewController = 0;
  }

  sendMenuDelegate = [(CKChatController *)self sendMenuDelegate];
  [sendMenuDelegate chatController:self requestPresentSendMenu:menuCopy currentlyPresentedViewController:presentedViewController];

  [(CKChatController *)self enforceSendMenuOrderingInWindowSubviews];
}

- (void)chatInputController:(id)controller didFinishDismissAnimationForSendMenuViewController:(id)viewController
{
  viewControllerCopy = viewController;
  sendMenuDelegate = [(CKChatController *)self sendMenuDelegate];
  [sendMenuDelegate chatController:self didFinishDismissAnimationForSendMenuViewController:viewControllerCopy];

  [(CKChatController *)self animateSendMenuStatusBarAppearanceUpdate];
}

- (void)animateSendMenuStatusBarAppearanceUpdate
{
  v3 = +[CKUIBehavior sharedBehaviors];
  sendMenuStatusBarAnimator = [v3 sendMenuStatusBarAnimator];

  v5[0] = MEMORY[0x1E69E9820];
  v5[1] = 3221225472;
  v5[2] = __60__CKChatController_animateSendMenuStatusBarAppearanceUpdate__block_invoke;
  v5[3] = &unk_1E72EBA18;
  v5[4] = self;
  [sendMenuStatusBarAnimator addAnimations:v5];
  [sendMenuStatusBarAnimator startAnimation];
}

- (void)chatInputWillChangeHeightForCompactPresentation:(double)presentation
{
  collectionView = [(CKChatController *)self collectionView];
  v3 = +[CKScrollViewAnimationProperties systemDefaultScrollAnimation];
  [collectionView enforceTranscriptScrollIntentWithAnimationProperties:v3];
}

- (void)chatInputControllerWillTransitionExpanded:(id)expanded
{
  collectionViewController = [(CKCoreChatController *)self collectionViewController];
  [collectionViewController setAllowsPluginPlayback:0];

  collectionViewController2 = [(CKCoreChatController *)self collectionViewController];
  [collectionViewController2 stopPluginPlayback];

  self->_shouldDisplayKeyboardWhenDismissingModalBrowser = [(CKScrollViewController *)self isKeyboardVisible];
  [(CKScrollViewController *)self beginHoldingScrollGeometryUpdatesForReason:@"BrowserTransition"];
  collectionView = [(CKChatController *)self collectionView];
  [collectionView beginHoldingContentOffsetUpdatesForReason:@"ChatInputControllerTransition"];

  collectionViewController3 = [(CKCoreChatController *)self collectionViewController];
  [collectionViewController3 setTranscriptUpdateAnimated:0];
}

- (void)chatInputControllerDidTransitionExpanded:(id)expanded
{
  collectionView = [(CKChatController *)self collectionView];
  collectionView2 = [(CKChatController *)self collectionView];
  [collectionView2 endHoldingContentOffsetUpdatesForReason:@"ChatInputControllerTransition"];

  v5 = +[CKScrollViewAnimationProperties unanimated];
  [collectionView enforceTranscriptScrollIntentWithAnimationProperties:v5];
}

- (void)chatInputControllerWillTransitionCollapsed:(id)collapsed
{
  UIKeyboardOrderInAutomaticSkippingAnimation();
  [(CKScrollViewController *)self endHoldingScrollGeometryUpdatesForReason:@"BrowserTransition"];
  collectionViewController = [(CKCoreChatController *)self collectionViewController];
  [collectionViewController scrollTranscriptToEntryViewInsertionTimeWithAnimation:0];

  collectionView = [(CKChatController *)self collectionView];
  [collectionView beginHoldingContentOffsetUpdatesForReason:@"ChatInputControllerTransition"];

  collectionViewController2 = [(CKCoreChatController *)self collectionViewController];
  [collectionViewController2 setTranscriptUpdateAnimated:1];

  collectionViewController3 = [(CKCoreChatController *)self collectionViewController];
  [collectionViewController3 setAllowsPluginPlayback:1];

  collectionViewController4 = [(CKCoreChatController *)self collectionViewController];
  [collectionViewController4 startPluginPlaybackAfterDelay:0.0];
}

- (void)chatInputControllerDidTransitionCollapsed:(id)collapsed
{
  collectionView = [(CKChatController *)self collectionView];
  [collectionView endHoldingContentOffsetUpdatesForReason:@"ChatInputControllerTransition"];

  [(CKChatController *)self _updateEntryViewFrameIfNeeded:1];
  entryView = [(CKChatController *)self entryView];
  [entryView setAlpha:1.0];

  v6 = MEMORY[0x1E69DD258];

  [v6 attemptRotationToDeviceOrientation];
}

- (BOOL)chatInputControllerShouldShowHandwriting:(id)handwriting
{
  chat = [(CKCoreChatController *)self chat];
  if (chat)
  {
    chat2 = [(CKCoreChatController *)self chat];
    allowedToShowConversation = [chat2 allowedToShowConversation];
  }

  else
  {
    allowedToShowConversation = 0;
  }

  return allowedToShowConversation;
}

- (id)_associatedStickerChatItemInInsertedIndexes:(id)indexes matchingSticker:(id)sticker
{
  indexesCopy = indexes;
  stickerCopy = sticker;
  v14 = 0;
  v15 = &v14;
  v16 = 0x3032000000;
  v17 = __Block_byref_object_copy__8;
  v18 = __Block_byref_object_dispose__8;
  v19 = 0;
  v11[0] = MEMORY[0x1E69E9820];
  v11[1] = 3221225472;
  v11[2] = __80__CKChatController__associatedStickerChatItemInInsertedIndexes_matchingSticker___block_invoke;
  v11[3] = &unk_1E72ED900;
  v11[4] = self;
  v8 = stickerCopy;
  v12 = v8;
  v13 = &v14;
  [indexesCopy enumerateIndexesUsingBlock:v11];
  v9 = v15[5];

  _Block_object_dispose(&v14, 8);

  return v9;
}

void __80__CKChatController__associatedStickerChatItemInInsertedIndexes_matchingSticker___block_invoke(uint64_t a1, uint64_t a2, _BYTE *a3)
{
  v12 = [MEMORY[0x1E696AC88] indexPathForRow:a2 inSection:1];
  v5 = [*(a1 + 32) collectionViewController];
  v6 = [v5 chatItemAtIndexPath:v12];

  objc_opt_class();
  if (objc_opt_isKindOfClass())
  {
    v7 = v6;
    v8 = [v7 sticker];
    v9 = [v8 stickerGUID];
    v10 = [*(a1 + 40) stickerGUID];
    v11 = [v9 hasPrefix:v10];

    if (v11)
    {
      objc_storeStrong((*(*(a1 + 48) + 8) + 40), v6);
      *a3 = 1;
    }
  }
}

- (CGRect)_targetStickerFrameFromStickerCell:(id)cell coordinateSpace:(id)space
{
  v53 = 0u;
  v54 = 0u;
  v51 = 0u;
  v52 = 0u;
  v49 = 0u;
  v50 = 0u;
  v47 = 0u;
  v48 = 0u;
  spaceCopy = space;
  cellCopy = cell;
  associatedItemView = [cellCopy associatedItemView];
  layer = [associatedItemView layer];
  v9 = layer;
  if (layer)
  {
    [layer transform];
  }

  else
  {
    v53 = 0u;
    v54 = 0u;
    v51 = 0u;
    v52 = 0u;
    v49 = 0u;
    v50 = 0u;
    v47 = 0u;
    v48 = 0u;
  }

  associatedItemView2 = [cellCopy associatedItemView];
  layer2 = [associatedItemView2 layer];
  v12 = *(MEMORY[0x1E69792E8] + 80);
  v43 = *(MEMORY[0x1E69792E8] + 64);
  v44 = v12;
  v13 = *(MEMORY[0x1E69792E8] + 112);
  v45 = *(MEMORY[0x1E69792E8] + 96);
  v46 = v13;
  v14 = *(MEMORY[0x1E69792E8] + 16);
  v39 = *MEMORY[0x1E69792E8];
  v40 = v14;
  v15 = *(MEMORY[0x1E69792E8] + 48);
  v41 = *(MEMORY[0x1E69792E8] + 32);
  v42 = v15;
  [layer2 setTransform:&v39];

  associatedItemView3 = [cellCopy associatedItemView];
  [associatedItemView3 frame];
  [cellCopy convertRect:spaceCopy toCoordinateSpace:?];
  v18 = v17;
  v20 = v19;
  v22 = v21;
  v24 = v23;

  v35 = v51;
  v36 = v52;
  v37 = v53;
  v38 = v54;
  v31 = v47;
  v32 = v48;
  v33 = v49;
  v34 = v50;
  associatedItemView4 = [cellCopy associatedItemView];

  layer3 = [associatedItemView4 layer];
  v43 = v35;
  v44 = v36;
  v45 = v37;
  v46 = v38;
  v39 = v31;
  v40 = v32;
  v41 = v33;
  v42 = v34;
  [layer3 setTransform:&v39];

  v27 = v18;
  v28 = v20;
  v29 = v22;
  v30 = v24;
  result.size.height = v30;
  result.size.width = v29;
  result.origin.y = v28;
  result.origin.x = v27;
  return result;
}

- (void)sendAutomaticallyPlacedSticker:(id)sticker stickerReactionSession:(id)session forChatItem:(id)item forParentChatItem:(id)chatItem stickerFrame:(CGRect)frame animationCompletionHandler:(id)handler
{
  height = frame.size.height;
  width = frame.size.width;
  y = frame.origin.y;
  x = frame.origin.x;
  stickerCopy = sticker;
  sessionCopy = session;
  itemCopy = item;
  chatItemCopy = chatItem;
  handlerCopy = handler;
  height = [CKAutomaticallyPlacedStickerCommSafetySendContext contextWithAutomaticallyPlacedSticker:stickerCopy stickerReactionSession:sessionCopy chatItem:itemCopy parentChatItem:chatItemCopy stickerFrame:handlerCopy animationCompletionHandler:x, y, width, height];
  v23 = +[CKMediaObjectManager sharedInstance];
  v24 = [v23 mediaObjectWithSticker:stickerCopy stickerUserInfo:0];

  transfer = [v24 transfer];
  fileURL = [transfer fileURL];
  v32[0] = MEMORY[0x1E69E9820];
  v32[1] = 3221225472;
  v32[2] = __144__CKChatController_sendAutomaticallyPlacedSticker_stickerReactionSession_forChatItem_forParentChatItem_stickerFrame_animationCompletionHandler___block_invoke;
  v32[3] = &unk_1E72ED928;
  v33 = stickerCopy;
  selfCopy = self;
  v35 = sessionCopy;
  v36 = itemCopy;
  v39 = x;
  v40 = y;
  v41 = width;
  v42 = height;
  v37 = chatItemCopy;
  v38 = handlerCopy;
  v27 = handlerCopy;
  v28 = chatItemCopy;
  v29 = itemCopy;
  v30 = sessionCopy;
  v31 = stickerCopy;
  [(CKCoreChatController *)self presentCommSafetyInterventionIfNecessaryForFileURL:fileURL withSendContext:height completion:v32];
}

void __144__CKChatController_sendAutomaticallyPlacedSticker_stickerReactionSession_forChatItem_forParentChatItem_stickerFrame_animationCompletionHandler___block_invoke(double *a1, int a2)
{
  v17 = *MEMORY[0x1E69E9840];
  if (a2)
  {
    v3 = IMLogHandleForCategory();
    if (os_log_type_enabled(v3, OS_LOG_TYPE_INFO))
    {
      v4 = *(a1 + 4);
      v15 = 138412290;
      v16 = v4;
      _os_log_impl(&dword_19020E000, v3, OS_LOG_TYPE_INFO, "Sticker was sensitive, deferring send for intervention: %@", &v15, 0xCu);
    }
  }

  else
  {
    v6 = *(a1 + 4);
    v5 = *(a1 + 5);
    v7 = *(a1 + 6);
    v8 = *(a1 + 7);
    v9 = *(a1 + 8);
    v10 = *(a1 + 9);
    v11 = a1[10];
    v12 = a1[11];
    v13 = a1[12];
    v14 = a1[13];

    [v5 _sendAutomaticallyPlacedSticker:v6 stickerReactionSession:v7 forChatItem:v8 forParentChatItem:v9 stickerFrame:v10 animationCompletionHandler:{v11, v12, v13, v14}];
  }
}

- (void)_sendAutomaticallyPlacedSticker:(id)sticker stickerReactionSession:(id)session forChatItem:(id)item forParentChatItem:(id)chatItem stickerFrame:(CGRect)frame animationCompletionHandler:(id)handler
{
  height = frame.size.height;
  width = frame.size.width;
  y = frame.origin.y;
  x = frame.origin.x;
  v48 = *MEMORY[0x1E69E9840];
  stickerCopy = sticker;
  sessionCopy = session;
  itemCopy = item;
  chatItemCopy = chatItem;
  handlerCopy = handler;
  mEMORY[0x1E69A8070] = [MEMORY[0x1E69A8070] sharedFeatureFlags];
  isReactWithAStickerEnabled = [mEMORY[0x1E69A8070] isReactWithAStickerEnabled];

  if (isReactWithAStickerEnabled)
  {
    if (stickerCopy)
    {
      v24 = IMLogHandleForCategory();
      fullScreenBalloonViewController = v24;
      if (chatItemCopy)
      {
        if (os_log_type_enabled(v24, OS_LOG_TYPE_INFO))
        {
          *buf = 138412290;
          v47 = stickerCopy;
          _os_log_impl(&dword_19020E000, fullScreenBalloonViewController, OS_LOG_TYPE_INFO, "Sending sticker: %@", buf, 0xCu);
        }

        stickerTranscriptScrollDisplayLink = [(CKChatController *)self stickerTranscriptScrollDisplayLink];
        [stickerTranscriptScrollDisplayLink invalidate];

        [(CKChatController *)self setStickerTranscriptScrollDisplayLink:0];
        fullScreenBalloonViewController = [(CKCoreChatController *)self fullScreenBalloonViewController];
        collectionViewController = [(CKCoreChatController *)self collectionViewController];
        v28 = [collectionViewController balloonViewForChatItem:chatItemCopy];

        if (v28)
        {
          [(CKChatController *)self setAnimatingStickerReaction:1];
          conversation = [(CKCoreChatController *)self conversation];
          chat = [conversation chat];

          [chat beginHoldingUpdatesForStickerMoveAnimation];
          [(CKChatController *)self setIgnoresAutomaticScrollsTowardBottom:1];
          collectionView = [(CKChatController *)self collectionView];
          [collectionView beginHoldingContentOffsetUpdatesForReason:@"StickerAnimation"];

          objc_initWeak(buf, self);
          v36 = MEMORY[0x1E69E9820];
          v37 = 3221225472;
          v38 = __145__CKChatController__sendAutomaticallyPlacedSticker_stickerReactionSession_forChatItem_forParentChatItem_stickerFrame_animationCompletionHandler___block_invoke;
          v39 = &unk_1E72ED9F0;
          objc_copyWeak(v45, buf);
          v32 = stickerCopy;
          v40 = v32;
          v41 = fullScreenBalloonViewController;
          v33 = chat;
          v42 = v33;
          v43 = v28;
          v45[1] = *&x;
          v45[2] = *&y;
          v45[3] = *&width;
          v45[4] = *&height;
          v44 = handlerCopy;
          [(CKChatController *)self setInsertItemsCallback:&v36];
          [sessionCopy sendSticker:{v32, v36, v37, v38, v39}];

          objc_destroyWeak(v45);
          objc_destroyWeak(buf);
        }

        else
        {
          v34 = IMLogHandleForCategory();
          if (os_log_type_enabled(v34, OS_LOG_TYPE_ERROR))
          {
            [CKChatController _sendAutomaticallyPlacedSticker:stickerReactionSession:forChatItem:forParentChatItem:stickerFrame:animationCompletionHandler:];
          }

          [sessionCopy sendSticker:stickerCopy];
          inputController = [(CKCoreChatController *)self inputController];
          [inputController endStickerReactionSession];

          if (fullScreenBalloonViewController)
          {
            [(CKChatController *)self _dismissFullScreenBubbleViewControllerAnimated:1 withSendAnimation:0 dismissAppCard:1 completion:0];
          }
        }
      }

      else if (os_log_type_enabled(v24, OS_LOG_TYPE_ERROR))
      {
        [CKChatController _sendAutomaticallyPlacedSticker:stickerReactionSession:forChatItem:forParentChatItem:stickerFrame:animationCompletionHandler:];
      }
    }

    else
    {
      fullScreenBalloonViewController = IMLogHandleForCategory();
      if (os_log_type_enabled(fullScreenBalloonViewController, OS_LOG_TYPE_ERROR))
      {
        [CKChatController _sendAutomaticallyPlacedSticker:stickerReactionSession:forChatItem:forParentChatItem:stickerFrame:animationCompletionHandler:];
      }
    }
  }
}

void __145__CKChatController__sendAutomaticallyPlacedSticker_stickerReactionSession_forChatItem_forParentChatItem_stickerFrame_animationCompletionHandler___block_invoke(uint64_t a1, void *a2, void *a3)
{
  v5 = a2;
  v6 = a3;
  WeakRetained = objc_loadWeakRetained((a1 + 72));
  v8 = [WeakRetained _associatedStickerChatItemInInsertedIndexes:v6 matchingSticker:*(a1 + 32)];

  if (v8)
  {
    v9 = [v8 guid];
    v10 = objc_loadWeakRetained((a1 + 72));
    v11 = [v10 collectionViewController];
    v12 = [v11 cellForAssociatedChatItem:v8];

    v13 = objc_loadWeakRetained((a1 + 72));
    v14 = [v13 collectionViewController];
    [v14 beginHidingStickerWithGUIDDuringAddStickerAnimation:v9];

    if (*(a1 + 40))
    {
      v37 = v9;
      v38 = v5;
      v15 = objc_loadWeakRetained((a1 + 72));
      v16 = [v15 collectionViewController];
      v17 = [*(a1 + 40) chatItem];
      v18 = [v17 IMChatItem];
      v19 = [v18 guid];
      v20 = [v16 chatItemForGUID:v19];

      v21 = objc_loadWeakRetained((a1 + 72));
      [v21 updateChatItemBalloonViewAndStickerViews:v20 hidden:1];

      [*(a1 + 40) updateStickersAnimated:0];
      v22 = *(a1 + 40);
      v23 = [v8 IMChatItem];
      v24 = [v23 guid];
      [v22 setStickerVisibility:0 forStickerChatItemGUID:v24];

      v25 = objc_loadWeakRetained((a1 + 72));
      v52[0] = MEMORY[0x1E69E9820];
      v52[1] = 3221225472;
      v52[2] = __145__CKChatController__sendAutomaticallyPlacedSticker_stickerReactionSession_forChatItem_forParentChatItem_stickerFrame_animationCompletionHandler___block_invoke_1220;
      v52[3] = &unk_1E72ED950;
      objc_copyWeak(v55, (a1 + 72));
      v26 = v20;
      v53 = v26;
      v54 = v12;
      [v25 _dismissFullScreenBubbleViewControllerAnimated:1 withSendAnimation:0 dismissAppCard:0 completion:v52];

      v27 = objc_loadWeakRetained((a1 + 72));
      LODWORD(v17) = [v27 entryViewWasActiveOnContextMenuPresentation];

      if (v17)
      {
        v28 = objc_loadWeakRetained((a1 + 72));
        v29 = [v28 inputController];
        [v29 endStickerReactionSession];

        v30 = objc_loadWeakRetained((a1 + 72));
        [v30 updateActiveEntryViewPositioningGuide];

        v31 = objc_loadWeakRetained((a1 + 72));
        [v31 showKeyboard];
      }

      objc_destroyWeak(v55);
      v9 = v37;
      v5 = v38;
    }

    else
    {
      v33 = dispatch_time(0, 150000000);
      block[0] = MEMORY[0x1E69E9820];
      block[1] = 3221225472;
      block[2] = __145__CKChatController__sendAutomaticallyPlacedSticker_stickerReactionSession_forChatItem_forParentChatItem_stickerFrame_animationCompletionHandler___block_invoke_2;
      block[3] = &unk_1E72EBB98;
      objc_copyWeak(&v51, (a1 + 72));
      v50 = *(a1 + 48);
      dispatch_after(v33, MEMORY[0x1E69E96A0], block);

      objc_destroyWeak(&v51);
    }

    v34 = *(a1 + 32);
    v39[0] = MEMORY[0x1E69E9820];
    v39[1] = 3221225472;
    v39[2] = __145__CKChatController__sendAutomaticallyPlacedSticker_stickerReactionSession_forChatItem_forParentChatItem_stickerFrame_animationCompletionHandler___block_invoke_3;
    v39[3] = &unk_1E72ED9C8;
    v40 = *(a1 + 56);
    objc_copyWeak(&v46, (a1 + 72));
    v35 = v12;
    v41 = v35;
    v36 = *(a1 + 96);
    v47 = *(a1 + 80);
    v48 = v36;
    v32 = v9;
    v42 = v32;
    v43 = *(a1 + 48);
    v44 = *(a1 + 40);
    v45 = *(a1 + 64);
    [v34 stickerViewForStickerChatItem:v8 snapshotEffectView:1 completion:v39];

    objc_destroyWeak(&v46);
  }

  else
  {
    v32 = IMLogHandleForCategory();
    if (os_log_type_enabled(v32, OS_LOG_TYPE_ERROR))
    {
      __145__CKChatController__sendAutomaticallyPlacedSticker_stickerReactionSession_forChatItem_forParentChatItem_stickerFrame_animationCompletionHandler___block_invoke_cold_1();
    }
  }
}

void __145__CKChatController__sendAutomaticallyPlacedSticker_stickerReactionSession_forChatItem_forParentChatItem_stickerFrame_animationCompletionHandler___block_invoke_1220(uint64_t a1)
{
  WeakRetained = objc_loadWeakRetained((a1 + 48));
  [WeakRetained setIgnoresAutomaticScrollsTowardBottom:1];

  v3 = objc_loadWeakRetained((a1 + 48));
  [v3 updateChatItemBalloonViewAndStickerViews:*(a1 + 32) hidden:0];

  v4 = [*(a1 + 40) associatedItemView];
  [v4 setHidden:1];
}

void __145__CKChatController__sendAutomaticallyPlacedSticker_stickerReactionSession_forChatItem_forParentChatItem_stickerFrame_animationCompletionHandler___block_invoke_2(uint64_t a1)
{
  WeakRetained = objc_loadWeakRetained((a1 + 40));
  v3 = [WeakRetained inputController];
  [v3 dismissStickerPickerPreservingChatItem:0 completion:0];

  [*(a1 + 32) beginHoldingUpdatesForStickerMoveAnimation];
  v4 = objc_loadWeakRetained((a1 + 40));
  [v4 setIgnoresAutomaticScrollsTowardBottom:1];

  v6 = objc_loadWeakRetained((a1 + 40));
  v5 = [v6 collectionView];
  [v5 beginHoldingContentOffsetUpdatesForReason:@"StickerPopoverDismiss"];
}

void __145__CKChatController__sendAutomaticallyPlacedSticker_stickerReactionSession_forChatItem_forParentChatItem_stickerFrame_animationCompletionHandler___block_invoke_3(uint64_t a1, void *a2)
{
  v81[5] = *MEMORY[0x1E69E9840];
  v3 = a2;
  v57 = [*(a1 + 32) window];
  WeakRetained = objc_loadWeakRetained((a1 + 80));
  v5 = [WeakRetained fullScreenBalloonViewController];
  if (v5)
  {
    v6 = objc_loadWeakRetained((a1 + 80));
    v7 = [v6 fullScreenBalloonViewController];
    [v7 preservedBoundsInBalloonWindowAtAppearance];
    v9 = v8;
    v11 = v10;
    v13 = v12;
    v15 = v14;
  }

  else
  {
    v6 = [MEMORY[0x1E69DCEB0] mainScreen];
    [v6 bounds];
    v9 = v16;
    v11 = v17;
    v13 = v18;
    v15 = v19;
  }

  v75 = 0;
  v76 = &v75;
  v77 = 0x3032000000;
  v78 = __Block_byref_object_copy__8;
  v79 = __Block_byref_object_dispose__8;
  v80 = [[CKAnimationOverlayWindow alloc] initWithFrame:v9, v11, v13, v15];
  v20 = v76[5];
  v21 = [v57 windowScene];
  [v20 showInWindowScene:v21];

  [v76[5] addSubview:v3];
  v22 = objc_loadWeakRetained((a1 + 80));
  v23 = [v22 fullScreenBalloonViewController];
  if (v23)
  {
    v24 = objc_loadWeakRetained((a1 + 80));
    v25 = [v24 view];
    v56 = [v25 coordinateSpace];
  }

  else
  {
    v56 = [v76[5] coordinateSpace];
  }

  v26 = objc_loadWeakRetained((a1 + 80));
  [v26 _targetStickerFrameFromStickerCell:*(a1 + 40) coordinateSpace:v56];
  v28 = v27;
  v30 = v29;
  v32 = v31;
  v34 = v33;

  [v3 setFrame:{*(a1 + 88), *(a1 + 96), *(a1 + 104), *(a1 + 112)}];
  v73 = 0u;
  v74 = 0u;
  v71 = 0u;
  v72 = 0u;
  v69 = 0u;
  v70 = 0u;
  v67 = 0u;
  v68 = 0u;
  v35 = [*(a1 + 40) associatedItemView];
  v36 = [v35 layer];
  v37 = v36;
  if (v36)
  {
    [v36 transform];
  }

  else
  {
    v73 = 0u;
    v74 = 0u;
    v71 = 0u;
    v72 = 0u;
    v69 = 0u;
    v70 = 0u;
    v67 = 0u;
    v68 = 0u;
  }

  v66[5] = v72;
  v66[6] = v73;
  v66[7] = v74;
  v66[0] = v67;
  v66[1] = v68;
  v66[2] = v69;
  v66[3] = v70;
  v66[4] = v71;
  v55 = [MEMORY[0x1E6979300] ck_stickerFlyInTransformAnimationTo:v66];
  [v3 bounds];
  v40 = [MEMORY[0x1E6979300] ck_stickerFlyInBoundsAnimationFromSize:v38 toSize:{v39, v32, v34}];
  v41 = [MEMORY[0x1E6979300] ck_stickerFlyInSpringAnimation];
  v42 = [MEMORY[0x1E6979300] ck_stickerFlyInScaleAnimation];
  v43 = [MEMORY[0x1E6979300] ck_stickerFlyInMoveAnimationFromRect:*(a1 + 88) toRect:{*(a1 + 96), *(a1 + 104), *(a1 + 112), v28, v30, v32, v34}];
  v44 = [MEMORY[0x1E6979308] animation];
  [v41 beginTime];
  v46 = v45;
  [v41 duration];
  v48 = v47;
  [v42 duration];
  if (v46 + v48 >= v49)
  {
    v49 = v46 + v48;
  }

  [v44 setDuration:v49];
  v81[0] = v55;
  v81[1] = v43;
  v81[2] = v42;
  v81[3] = v41;
  v81[4] = v40;
  v50 = [MEMORY[0x1E695DEC8] arrayWithObjects:v81 count:5];
  [v44 setAnimations:v50];

  [v44 setFillMode:*MEMORY[0x1E69797E8]];
  [v44 setRemovedOnCompletion:0];
  [MEMORY[0x1E6979518] begin];
  v51 = MEMORY[0x1E6979518];
  [v44 duration];
  [v51 setAnimationDuration:?];
  v52 = MEMORY[0x1E6979518];
  v58[0] = MEMORY[0x1E69E9820];
  v58[1] = 3221225472;
  v58[2] = __145__CKChatController__sendAutomaticallyPlacedSticker_stickerReactionSession_forChatItem_forParentChatItem_stickerFrame_animationCompletionHandler___block_invoke_4;
  v58[3] = &unk_1E72ED9A0;
  objc_copyWeak(&v65, (a1 + 80));
  v59 = *(a1 + 48);
  v53 = v3;
  v60 = v53;
  v64 = &v75;
  v61 = *(a1 + 56);
  v62 = *(a1 + 64);
  v63 = *(a1 + 72);
  [v52 setCompletionBlock:v58];
  v54 = [v53 layer];
  [v54 addAnimation:v44 forKey:0];

  [MEMORY[0x1E6979518] commit];
  objc_destroyWeak(&v65);

  _Block_object_dispose(&v75, 8);
}

void __145__CKChatController__sendAutomaticallyPlacedSticker_stickerReactionSession_forChatItem_forParentChatItem_stickerFrame_animationCompletionHandler___block_invoke_4(uint64_t a1)
{
  WeakRetained = objc_loadWeakRetained((a1 + 80));
  v3 = [WeakRetained collectionViewController];
  [v3 endHidingStickerWithGUIDDuringAddStickerAnimation:*(a1 + 32)];

  v4 = dispatch_time(0, 100000000);
  v7[0] = MEMORY[0x1E69E9820];
  v7[1] = 3221225472;
  v7[2] = __145__CKChatController__sendAutomaticallyPlacedSticker_stickerReactionSession_forChatItem_forParentChatItem_stickerFrame_animationCompletionHandler___block_invoke_5;
  v7[3] = &unk_1E72ED978;
  v5 = *(a1 + 40);
  v6 = *(a1 + 72);
  v8 = v5;
  v12 = v6;
  v9 = *(a1 + 48);
  objc_copyWeak(&v13, (a1 + 80));
  v10 = *(a1 + 56);
  v11 = *(a1 + 64);
  dispatch_after(v4, MEMORY[0x1E69E96A0], v7);

  objc_destroyWeak(&v13);
}

uint64_t __145__CKChatController__sendAutomaticallyPlacedSticker_stickerReactionSession_forChatItem_forParentChatItem_stickerFrame_animationCompletionHandler___block_invoke_5(uint64_t a1)
{
  [*(a1 + 32) removeFromSuperview];
  [*(*(*(a1 + 64) + 8) + 40) dismiss];
  v2 = *(*(a1 + 64) + 8);
  v3 = *(v2 + 40);
  *(v2 + 40) = 0;

  [*(a1 + 40) endAllHoldsOnChatItemsUpdatesForStickerMoveAnimation];
  WeakRetained = objc_loadWeakRetained((a1 + 72));
  v5 = [WeakRetained entryViewWasActiveOnContextMenuPresentation];

  if (v5)
  {
    v6 = objc_loadWeakRetained((a1 + 72));
    v7 = [v6 inputController];
    [v7 endStickerReactionSession];

    v8 = objc_loadWeakRetained((a1 + 72));
    [v8 showKeyboard];
  }

  else
  {
    v9 = [*(a1 + 48) displayConfiguration];
    v10 = [v9 shouldDismissAppCardOnExit];

    if (!v10)
    {
      goto LABEL_6;
    }

    v11 = objc_loadWeakRetained((a1 + 72));
    v12 = [v11 inputController];
    [v12 dismissAppCardIfNecessary];

    v8 = objc_loadWeakRetained((a1 + 72));
    v13 = [v8 inputController];
    [v13 endStickerReactionSession];
  }

LABEL_6:
  v14 = objc_loadWeakRetained((a1 + 72));
  [v14 setIgnoresAutomaticScrollsTowardBottom:0];

  v15 = objc_loadWeakRetained((a1 + 72));
  v16 = [v15 collectionView];
  [v16 endHoldingContentOffsetUpdatesForReason:@"StickerAnimation"];

  v17 = objc_loadWeakRetained((a1 + 72));
  v18 = [v17 collectionView];
  [v18 endHoldingContentOffsetUpdatesForReason:@"StickerPopoverDismiss"];

  v19 = objc_loadWeakRetained((a1 + 72));
  [v19 setAnimatingStickerReaction:0];

  v20 = objc_loadWeakRetained((a1 + 72));
  [v20 updateActiveEntryViewPositioningGuide];

  result = *(a1 + 56);
  if (result)
  {
    v22 = *(result + 16);

    return v22();
  }

  return result;
}

- (void)prewarmFunCamera
{
  if ([(CKChatController *)self isShowingCamera])
  {
    if (IMOSLoggingEnabled())
    {
      v3 = OSLogHandleForIMFoundationCategory();
      if (os_log_type_enabled(v3, OS_LOG_TYPE_INFO))
      {
        *buf = 0;
        _os_log_impl(&dword_19020E000, v3, OS_LOG_TYPE_INFO, "Not prewarming FunCam, instance of camera already presented", buf, 2u);
      }
    }
  }

  else
  {
    v4 = [CKFunCameraViewController alloc];
    conversation = [(CKCoreChatController *)self conversation];
    v6 = [(CKFunCameraViewController *)v4 initWithConversation:conversation];
    [(CKChatController *)self setFunCameraViewController:v6];

    v7 = +[CKBalloonPluginManager sharedInstance];
    funCameraViewController = [(CKChatController *)self funCameraViewController];
    balloonPlugin = [funCameraViewController balloonPlugin];
    identifier = [balloonPlugin identifier];
    v11 = [v7 viewControllerForPluginIdentifier:identifier];

    [v11 prepareForPresentationWithCompletionHandler:&__block_literal_global_1228];
  }
}

- (BOOL)isFunCamPresented
{
  presentedViewController = [(CKChatController *)self presentedViewController];
  if (presentedViewController)
  {
    funCameraViewController = [(CKChatController *)self funCameraViewController];
    v5 = presentedViewController == funCameraViewController;
  }

  else
  {
    v5 = 0;
  }

  return v5;
}

- (void)entryViewContainerViewDidLayoutSubviews:(id)subviews
{
  sendMenuDelegate = [(CKChatController *)self sendMenuDelegate];
  v15 = [sendMenuDelegate activeSendMenuPresentationForChatController:self];

  [v15 informSendMenuOfAnchorViewPositionChangeIfNecessary];
  if ([MEMORY[0x1E69DCBB8] isInHardwareKeyboardMode])
  {
    keyboardHeightFromPreviousLayout = self->_keyboardHeightFromPreviousLayout;
    [(CKChatController *)self _keyboardHeightFromLayoutGuide];
    if (vabdd_f64(keyboardHeightFromPreviousLayout, v6) > 0.01)
    {
      self->_keyboardHeightFromPreviousLayout = v6;
      collectionViewController = [(CKCoreChatController *)self collectionViewController];
      collectionView = [collectionViewController collectionView];

      [(CKScrollViewController *)self updateScrollGeometryWithoutAnimationForReason:@"CandidateBarHeightChanged"];
      v9 = +[CKScrollViewAnimationProperties unanimated];
      [collectionView enforceTranscriptScrollIntentWithAnimationProperties:v9];
    }
  }

  entryViewMaxYFromPreviousLayout = self->_entryViewMaxYFromPreviousLayout;
  entryView = [(CKChatController *)self entryView];
  [entryView frame];
  MaxY = CGRectGetMaxY(v17);

  if (vabdd_f64(entryViewMaxYFromPreviousLayout, MaxY) > 0.01)
  {
    self->_entryViewMaxYFromPreviousLayout = MaxY;
    [(CKChatController *)self updateEntryViewHeightAnimated:0];
  }

  mEMORY[0x1E69A8070] = [MEMORY[0x1E69A8070] sharedFeatureFlags];
  isTranscriptBackgroundsEnabled = [mEMORY[0x1E69A8070] isTranscriptBackgroundsEnabled];

  if (isTranscriptBackgroundsEnabled)
  {
    [(CKCoreChatController *)self setNeedsPosterSaliencyAndOcclusionRectUpdate];
  }
}

- (id)messageEntryViewActiveSendMenuPresentation:(id)presentation
{
  sendMenuDelegate = [(CKChatController *)self sendMenuDelegate];
  v5 = [sendMenuDelegate activeSendMenuPresentationForChatController:self];

  return v5;
}

- (BOOL)_shouldValidatePayloadBeforeSendingPayload:(id)payload
{
  payloadCopy = payload;
  objc_opt_class();
  if (objc_opt_isKindOfClass())
  {
    requiresValidation = [payloadCopy requiresValidation];
  }

  else
  {
    requiresValidation = 0;
  }

  return requiresValidation;
}

- (id)createAlertControllerForAccountComposition:(id)composition completion:(id)completion
{
  v44 = *MEMORY[0x1E69E9840];
  compositionCopy = composition;
  completionCopy = completion;
  v5 = CKFrameworkBundle();
  v6 = [v5 localizedStringForKey:@"SEND_WITH_TITLE" value:&stru_1F04268F8 table:@"ChatKit"];
  v26 = [CKAlertController alertControllerWithTitle:v6 message:0 preferredStyle:0];

  conversation = [(CKCoreChatController *)self conversation];
  chat = [conversation chat];
  lastAddressedHandleID = [chat lastAddressedHandleID];

  conversation2 = [(CKCoreChatController *)self conversation];
  chat2 = [conversation2 chat];
  lastAddressedSIMID = [chat2 lastAddressedSIMID];

  mEMORY[0x1E69A7F68] = [MEMORY[0x1E69A7F68] sharedInstance];
  ctSubscriptionInfo = [mEMORY[0x1E69A7F68] ctSubscriptionInfo];
  v22 = [ctSubscriptionInfo __im_subscriptionContextForForSimID:lastAddressedSIMID phoneNumber:lastAddressedHandleID];

  if (IMOSLoggingEnabled())
  {
    v13 = OSLogHandleForIMFoundationCategory();
    if (os_log_type_enabled(v13, OS_LOG_TYPE_INFO))
    {
      *buf = 138412802;
      v39 = lastAddressedSIMID;
      v40 = 2112;
      v41 = lastAddressedHandleID;
      v42 = 2112;
      v43 = v22;
      _os_log_impl(&dword_19020E000, v13, OS_LOG_TYPE_INFO, "FindAccountsForPrompt: lastSIM %@ lastHandle %@ found context %@", buf, 0x20u);
    }
  }

  if (!v22 && ![(CKChatController *)self _lastAddressedHandleIsAvailableAsiMessageAlias:lastAddressedHandleID SIMID:lastAddressedSIMID])
  {
    v35 = 0u;
    v36 = 0u;
    v33 = 0u;
    v34 = 0u;
    obj = +[CKSenderIdentity senderIdentitiesForFromPicker];
    v14 = [obj countByEnumeratingWithState:&v33 objects:v37 count:16];
    if (v14)
    {
      v15 = *v34;
      do
      {
        for (i = 0; i != v14; ++i)
        {
          if (*v34 != v15)
          {
            objc_enumerationMutation(obj);
          }

          v17 = *(*(&v33 + 1) + 8 * i);
          label = [v17 label];
          if (!label)
          {
            v19 = CKFrameworkBundle();
            label = [v19 localizedStringForKey:@"CURRENT_LINE" value:&stru_1F04268F8 table:@"ChatKit"];
          }

          v30[0] = MEMORY[0x1E69E9820];
          v30[1] = 3221225472;
          v30[2] = __74__CKChatController_createAlertControllerForAccountComposition_completion___block_invoke;
          v30[3] = &unk_1E72EDA18;
          v30[4] = self;
          v30[5] = v17;
          v31 = compositionCopy;
          v32 = completionCopy;
          v20 = [CKAlertAction actionWithTitle:label style:0 handler:v30];
          [v26 addAction:v20];
        }

        v14 = [obj countByEnumeratingWithState:&v33 objects:v37 count:16];
      }

      while (v14);
    }
  }

  return v26;
}

void __74__CKChatController_createAlertControllerForAccountComposition_completion___block_invoke(uint64_t a1)
{
  v2 = [*(a1 + 32) conversation];
  v5 = [v2 chat];

  v3 = [*(a1 + 40) handle];
  [v5 setLastAddressedHandleID:v3];

  v4 = [*(a1 + 40) simID];
  [v5 setLastAddressedSIMID:v4];

  [*(a1 + 32) _validateAndSendComposition:*(a1 + 48) completion:*(a1 + 56)];
}

- (BOOL)_lastAddressedHandleIsAvailableAsiMessageAlias:(id)alias SIMID:(id)d
{
  v5 = MEMORY[0x1E69A5A80];
  dCopy = d;
  aliasCopy = alias;
  sharedInstance = [v5 sharedInstance];
  v9 = [sharedInstance iMessageAccountForLastAddressedHandle:aliasCopy simID:dCopy];

  return v9 != 0;
}

- (void)presentActionMenuForAccountSelection:(id)selection completion:(id)completion
{
  v30 = *MEMORY[0x1E69E9840];
  selectionCopy = selection;
  completionCopy = completion;
  v8 = [(CKChatController *)self createAlertControllerForAccountComposition:selectionCopy completion:completionCopy];
  conversation = [(CKCoreChatController *)self conversation];
  sendingService = [conversation sendingService];

  if ([sendingService __ck_isiMessage])
  {
    v11 = 0;
  }

  else
  {
    v11 = [sendingService __ck_isiMessageLite] ^ 1;
  }

  if (IMOSLoggingEnabled())
  {
    v12 = OSLogHandleForIMFoundationCategory();
    if (os_log_type_enabled(v12, OS_LOG_TYPE_INFO))
    {
      actions = [v8 actions];
      v14 = actions;
      v15 = @"NO";
      *v25 = 138412802;
      if (v11)
      {
        v15 = @"YES";
      }

      *&v25[4] = v15;
      v26 = 2112;
      v27 = sendingService;
      v28 = 2112;
      v29 = actions;
      _os_log_impl(&dword_19020E000, v12, OS_LOG_TYPE_INFO, "AccountSelection shouldShow %@ service %@ actions %@", v25, 0x20u);
    }
  }

  actions2 = [v8 actions];
  v17 = [actions2 count] != 0;

  if ((v17 & v11) != 0)
  {
    v18 = CKFrameworkBundle();
    v19 = [v18 localizedStringForKey:@"CANCEL" value:&stru_1F04268F8 table:@"ChatKit"];
    v20 = [CKAlertAction actionWithTitle:v19 style:1 handler:0];
    [v8 addAction:v20];

    effectPickerViewController = [(CKChatController *)self effectPickerViewController];
    if (effectPickerViewController)
    {
      selfCopy = [(CKChatController *)self effectPickerViewController];
    }

    else
    {
      selfCopy = self;
    }

    v24 = selfCopy;

    [v8 presentFromViewController:v24 animated:1 completion:0];
  }

  else
  {
    if (IMOSLoggingEnabled())
    {
      v23 = OSLogHandleForIMFoundationCategory();
      if (os_log_type_enabled(v23, OS_LOG_TYPE_INFO))
      {
        *v25 = 0;
        _os_log_impl(&dword_19020E000, v23, OS_LOG_TYPE_INFO, "Not showing account selection alert. Validate and send composition instead.", v25, 2u);
      }
    }

    [(CKChatController *)self _validateAndSendComposition:selectionCopy completion:completionCopy];
  }
}

- (void)disableRotationWhileRecordingAudioMessage
{
  if (self->_rotationLockUtility)
  {
    [(CKChatController *)self enableRotationAfterRecording];
  }

  view = [(CKChatController *)self view];
  window = [view window];
  windowScene = [window windowScene];
  keyWindow = [windowScene keyWindow];

  if (keyWindow)
  {
    v6 = [[CKRotationLockUtility alloc] initWithWindow:keyWindow];
    rotationLockUtility = self->_rotationLockUtility;
    self->_rotationLockUtility = v6;
  }
}

- (void)enableRotationAfterRecording
{
  [(CKRotationLockUtility *)self->_rotationLockUtility releaseRotationLock];
  rotationLockUtility = self->_rotationLockUtility;
  self->_rotationLockUtility = 0;
}

- (void)messageEntryViewSafeAreaInsetsDidChange:(id)change
{
  if ([(CKChatController *)self nextEntryViewSafeAreaInsetUpdateIsSynchronous])
  {
    self->_nextEntryViewSafeAreaInsetUpdateIsSynchronous = 0;

    [(CKChatController *)self updateEntryViewHeightAnimated:0];
  }

  else
  {
    block[0] = MEMORY[0x1E69E9820];
    block[1] = 3221225472;
    block[2] = __60__CKChatController_messageEntryViewSafeAreaInsetsDidChange___block_invoke;
    block[3] = &unk_1E72EBA18;
    block[4] = self;
    dispatch_async(MEMORY[0x1E69E96A0], block);
  }
}

- (void)messageEntryView:(id)view didMoveToWindow:(id)window
{
  [(CKChatController *)self _updateEntryViewConstraintsIfNeeded:view];
  [(CKChatController *)self _setUpEntryViewAppCardLayoutConstraint];
  [(CKChatController *)self updateActiveEntryViewPositioningGuide];
  [(CKChatController *)self _updateEntryViewFrameIfNeeded:0];

  [(CKScrollViewController *)self updateScrollGeometryWithoutAnimationForReason:@"EntryViewMovedToWindow"];
}

- (void)messageEntryViewRequestsVisionAppMenu:(id)menu fromButton:(id)button
{
  menuCopy = menu;
  buttonCopy = button;
  v8 = MEMORY[0x1E69DD250];
  v22[0] = MEMORY[0x1E69E9820];
  v22[1] = 3221225472;
  v22[2] = __69__CKChatController_messageEntryViewRequestsVisionAppMenu_fromButton___block_invoke;
  v22[3] = &unk_1E72EBA18;
  v9 = buttonCopy;
  v23 = v9;
  [v8 animateWithDuration:v22 animations:0.2];
  objc_initWeak(&location, self);
  conversation = [(CKCoreChatController *)self conversation];
  v19[0] = MEMORY[0x1E69E9820];
  v19[1] = 3221225472;
  v19[2] = __69__CKChatController_messageEntryViewRequestsVisionAppMenu_fromButton___block_invoke_2;
  v19[3] = &unk_1E72EDA40;
  objc_copyWeak(&v20, &location);
  v14 = MEMORY[0x1E69E9820];
  v15 = 3221225472;
  v16 = __69__CKChatController_messageEntryViewRequestsVisionAppMenu_fromButton___block_invoke_3;
  v17 = &unk_1E72EBA18;
  v11 = v9;
  v18 = v11;
  v12 = [_TtC7ChatKit26CKVisionAppMenuViewFactory appMenuViewControllerWithConversation:conversation selectionHandler:v19 dismissHandler:&v14];

  popoverPresentationController = [v12 popoverPresentationController];
  [popoverPresentationController setSourceView:v11];

  [(CKChatController *)self presentViewController:v12 animated:1 completion:0];
  objc_destroyWeak(&v20);
  objc_destroyWeak(&location);
}

void __69__CKChatController_messageEntryViewRequestsVisionAppMenu_fromButton___block_invoke_2(uint64_t a1, void *a2)
{
  v3 = a2;
  WeakRetained = objc_loadWeakRetained((a1 + 32));
  v4 = [WeakRetained inputController];
  [v4 appSelectionInterfaceSelectedItem:v3];
}

- (void)messageEntryViewWantsSendLaterPickerPresented:(id)presented
{
  inputController = [(CKCoreChatController *)self inputController];
  [inputController showSendLater];
}

- (void)messageEntryViewSendLaterPluginInfoUpdated:(id)updated
{
  inputController = [(CKCoreChatController *)self inputController];
  [inputController sendLaterPluginInfoUpdated];

  v5[0] = MEMORY[0x1E69E9820];
  v5[1] = 3221225472;
  v5[2] = __63__CKChatController_messageEntryViewSendLaterPluginInfoUpdated___block_invoke;
  v5[3] = &unk_1E72EBA18;
  v5[4] = self;
  [(CKChatController *)self updateEntryViewHeightWithContentChange:1 animated:1 completionHandler:v5];
}

void __63__CKChatController_messageEntryViewSendLaterPluginInfoUpdated___block_invoke(uint64_t a1)
{
  v6 = [*(a1 + 32) collectionViewController];
  v2 = [CKTranscriptScrollIntentEntryViewChangedTrigger alloc];
  v3 = [*(a1 + 32) entryView];
  v4 = [(CKTranscriptScrollIntentEntryViewChangedTrigger *)v2 initWithEntryView:v3 isTextChange:0 isShelfChange:0 isSendLaterPluginChange:1];
  v5 = [*(a1 + 32) activeKeyboardAppearanceAnimationProperties];
  [v6 updateScrollIntentWithTrigger:v4 activeKeyboardAppearanceAnimationProperties:v5];
}

- (void)messageEntryViewWantsGenerativePlaygroundPluginPresented:(id)presented presentationStyle:(unint64_t)style
{
  v13 = IMBalloonExtensionIDWithSuffix();
  mEMORY[0x1E69A5AD0] = [MEMORY[0x1E69A5AD0] sharedInstance];
  v7 = [mEMORY[0x1E69A5AD0] balloonPluginForBundleID:v13];

  v8 = [CKTranscriptPluginPresentationConfiguration alloc];
  entryView = [(CKChatController *)self entryView];
  sendMenuSourceView = [entryView sendMenuSourceView];
  v11 = [(CKTranscriptPluginPresentationConfiguration *)v8 initWithSourceView:sendMenuSourceView permittedArrowDirections:8 shouldDisableSnapshotView:0];

  inputController = [(CKCoreChatController *)self inputController];
  [inputController showBrowserForPlugin:v7 dataSource:0 style:style presentationConfiguration:v11];
}

- (void)messageEntryViewWillPresentCustomizationPicker:(id)picker
{
  pickerCopy = picker;
  if (IMOSLoggingEnabled())
  {
    v5 = OSLogHandleForIMFoundationCategory();
    if (os_log_type_enabled(v5, OS_LOG_TYPE_INFO))
    {
      *v6 = 0;
      _os_log_impl(&dword_19020E000, v5, OS_LOG_TYPE_INFO, "Will present customization picker", v6, 2u);
    }
  }

  [(CKScrollViewController *)self beginHoldingScrollGeometryUpdatesForReason:@"LinkCustomizationPicker"];
  [(CKChatController *)self requestShowKeyboardSnapshotForReason:32];
}

- (void)messageEntryViewDidPresentCustomizationPicker:(id)picker
{
  pickerCopy = picker;
  if (IMOSLoggingEnabled())
  {
    v4 = OSLogHandleForIMFoundationCategory();
    if (os_log_type_enabled(v4, OS_LOG_TYPE_INFO))
    {
      *v5 = 0;
      _os_log_impl(&dword_19020E000, v4, OS_LOG_TYPE_INFO, "Did present customization picker", v5, 2u);
    }
  }
}

- (void)messageEntryViewWillDismissCustomizationPicker:(id)picker
{
  pickerCopy = picker;
  if (IMOSLoggingEnabled())
  {
    v5 = OSLogHandleForIMFoundationCategory();
    if (os_log_type_enabled(v5, OS_LOG_TYPE_INFO))
    {
      *v6 = 0;
      _os_log_impl(&dword_19020E000, v5, OS_LOG_TYPE_INFO, "Will dismiss customization picker", v6, 2u);
    }
  }

  [(CKScrollViewController *)self endHoldingScrollGeometryUpdatesForReason:@"LinkCustomizationPicker"];
}

- (void)messageEntryViewDidDismissCustomizationPicker:(id)picker
{
  pickerCopy = picker;
  if (IMOSLoggingEnabled())
  {
    v5 = OSLogHandleForIMFoundationCategory();
    if (os_log_type_enabled(v5, OS_LOG_TYPE_INFO))
    {
      *v6 = 0;
      _os_log_impl(&dword_19020E000, v5, OS_LOG_TYPE_INFO, "Did dismiss customization picker", v6, 2u);
    }
  }

  [(CKChatController *)self requestDismissKeyboardSnapshotForReason:32];
}

- (void)messageEntryViewTextFormattingAnimationsOptionsPresentationInProgress:(BOOL)progress
{
  progressCopy = progress;
  if (([MEMORY[0x1E69DCBB8] isInHardwareKeyboardMode] & 1) == 0)
  {

    [(CKChatController *)self setIgnoresAutomaticScrollsTowardBottom:progressCopy];
  }
}

- (void)enableSendButtonSpinner
{
  block[0] = MEMORY[0x1E69E9820];
  block[1] = 3221225472;
  block[2] = __43__CKChatController_enableSendButtonSpinner__block_invoke;
  block[3] = &unk_1E72EBA18;
  block[4] = self;
  dispatch_async(MEMORY[0x1E69E96A0], block);
}

void __43__CKChatController_enableSendButtonSpinner__block_invoke(uint64_t a1)
{
  v1 = [*(a1 + 32) entryView];
  [v1 configureForDisplayMode:4];
}

- (void)disableSendButtonSpinner
{
  block[0] = MEMORY[0x1E69E9820];
  block[1] = 3221225472;
  block[2] = __44__CKChatController_disableSendButtonSpinner__block_invoke;
  block[3] = &unk_1E72EBA18;
  block[4] = self;
  dispatch_async(MEMORY[0x1E69E96A0], block);
}

void __44__CKChatController_disableSendButtonSpinner__block_invoke(uint64_t a1)
{
  v1 = [*(a1 + 32) entryView];
  [v1 configureForDisplayMode:1];
}

- (int64_t)_sharingAccessTypeFromOptionsGroups:(id)groups
{
  groupsCopy = groups;
  if (groupsCopy)
  {
    if (_sharingAccessTypeFromOptionsGroups___pred_CKSharingAccessTypeFromOptionsGroupsCloudKit != -1)
    {
      [CKChatController _sharingAccessTypeFromOptionsGroups:];
    }

    v4 = _sharingAccessTypeFromOptionsGroups___CKSharingAccessTypeFromOptionsGroups(groupsCopy);
  }

  else
  {
    v4 = 1;
  }

  return v4;
}

void *__56__CKChatController__sharingAccessTypeFromOptionsGroups___block_invoke()
{
  result = MEMORY[0x193AF5ED0]("CKSharingAccessTypeFromOptionsGroups", @"CloudKit");
  _sharingAccessTypeFromOptionsGroups___CKSharingAccessTypeFromOptionsGroups = result;
  return result;
}

- (int64_t)_sharingPermissionTypeFromOptionsGroups:(id)groups
{
  groupsCopy = groups;
  if (groupsCopy)
  {
    if (_sharingPermissionTypeFromOptionsGroups___pred_CKSharingPermissionTypeFromOptionsGroupsCloudKit != -1)
    {
      [CKChatController _sharingPermissionTypeFromOptionsGroups:];
    }

    v4 = _sharingPermissionTypeFromOptionsGroups___CKSharingPermissionTypeFromOptionsGroups(groupsCopy);
  }

  else
  {
    v4 = 2;
  }

  return v4;
}

void *__60__CKChatController__sharingPermissionTypeFromOptionsGroups___block_invoke()
{
  result = MEMORY[0x193AF5ED0]("CKSharingPermissionTypeFromOptionsGroups", @"CloudKit");
  _sharingPermissionTypeFromOptionsGroups___CKSharingPermissionTypeFromOptionsGroups = result;
  return result;
}

- (BOOL)_sharingAllowOthersToInviteFromOptionsGroups:(id)groups
{
  groupsCopy = groups;
  if (groupsCopy)
  {
    if (_sharingAllowOthersToInviteFromOptionsGroups___pred_CKSharingAllowOthersToInviteFromOptionsGroupsCloudKit != -1)
    {
      [CKChatController _sharingAllowOthersToInviteFromOptionsGroups:];
    }

    v4 = _sharingAllowOthersToInviteFromOptionsGroups___CKSharingAllowOthersToInviteFromOptionsGroups(groupsCopy);
  }

  else
  {
    v4 = 0;
  }

  return v4;
}

void *__65__CKChatController__sharingAllowOthersToInviteFromOptionsGroups___block_invoke()
{
  result = MEMORY[0x193AF5ED0]("CKSharingAllowOthersToInviteFromOptionsGroups", @"CloudKit");
  _sharingAllowOthersToInviteFromOptionsGroups___CKSharingAllowOthersToInviteFromOptionsGroups = result;
  return result;
}

- (void)sendCollaborationCompositionAndSetSendingState:(id)state
{
  stateCopy = state;
  if (IMIsRunningInMessagesComposeViewService())
  {
    [(CKChatController *)self sendComposition:stateCopy];
  }

  else
  {
    [(CKChatController *)self sendCompositionIfAllowed:stateCopy];
  }

  [(CKChatController *)self setIsSettingUpCollaboration:0];
}

- (void)sendCompositionForFileProvider:(id)provider completion:(id)completion
{
  providerCopy = provider;
  completionCopy = completion;
  cKCloudSharingClass = [(CKChatController *)self CKCloudSharingClass];
  if (objc_opt_respondsToSelector())
  {
    shelfPluginPayload = [providerCopy shelfPluginPayload];
    v10 = [shelfPluginPayload url];
    v11[0] = MEMORY[0x1E69E9820];
    v11[1] = 3221225472;
    v11[2] = __62__CKChatController_sendCompositionForFileProvider_completion___block_invoke;
    v11[3] = &unk_1E72EDB58;
    v11[4] = self;
    v12 = providerCopy;
    v13 = completionCopy;
    v14 = cKCloudSharingClass;
    [(objc_class *)cKCloudSharingClass existingShareForFileOrFolderURL:v10 completionHandler:v11];
  }
}

void __62__CKChatController_sendCompositionForFileProvider_completion___block_invoke(uint64_t a1, void *a2, void *a3, void *a4)
{
  v7 = a2;
  v8 = a3;
  v9 = a4;
  v10 = v9;
  if (!v9)
  {
    v25[0] = MEMORY[0x1E69E9820];
    v25[1] = 3221225472;
    v25[2] = __62__CKChatController_sendCompositionForFileProvider_completion___block_invoke_2;
    v25[3] = &unk_1E72EDB30;
    v16 = v8;
    v31 = *(a1 + 56);
    v17 = *(a1 + 32);
    v18 = *(a1 + 40);
    v26 = v16;
    v27 = v17;
    v28 = v18;
    v29 = v7;
    v30 = *(a1 + 48);
    dispatch_async(MEMORY[0x1E69E96A0], v25);

    v15 = v26;
    goto LABEL_14;
  }

  v11 = [v9 domain];
  if ([v11 isEqualToString:*MEMORY[0x1E695B740]])
  {
    v12 = [v10 code];

    if (v12 == 12)
    {
      if (IMOSLoggingEnabled())
      {
        v13 = OSLogHandleForIMFoundationCategory();
        if (os_log_type_enabled(v13, OS_LOG_TYPE_INFO))
        {
          *buf = 0;
          _os_log_impl(&dword_19020E000, v13, OS_LOG_TYPE_INFO, "Sending collaboration composition for file provider.", buf, 2u);
        }
      }

      block[0] = MEMORY[0x1E69E9820];
      block[1] = 3221225472;
      block[2] = __62__CKChatController_sendCompositionForFileProvider_completion___block_invoke_1257;
      block[3] = &unk_1E72EDA68;
      v14 = *(a1 + 40);
      block[4] = *(a1 + 32);
      v36 = v14;
      v37 = *(a1 + 48);
      dispatch_async(MEMORY[0x1E69E96A0], block);

      v15 = v36;
      goto LABEL_14;
    }
  }

  else
  {
  }

  v19 = IMLogHandleForCategory();
  if (os_log_type_enabled(v19, OS_LOG_TYPE_ERROR))
  {
    __62__CKChatController_sendCompositionForFileProvider_completion___block_invoke_cold_1(v10);
  }

  v20 = *(a1 + 32);
  v21 = *(a1 + 40);
  v32[0] = MEMORY[0x1E69E9820];
  v32[1] = 3221225472;
  v32[2] = __62__CKChatController_sendCompositionForFileProvider_completion___block_invoke_1258;
  v32[3] = &unk_1E72EDA90;
  v22 = *(a1 + 48);
  v23 = *(a1 + 32);
  v24 = *(a1 + 40);
  v34 = v22;
  v32[4] = v23;
  v33 = v24;
  [v20 presentCollaborationFailureAlertForComposition:v21 sharingURL:v7 error:v10 completion:v32];

  v15 = v34;
LABEL_14:
}

uint64_t __62__CKChatController_sendCompositionForFileProvider_completion___block_invoke_1258(uint64_t a1, uint64_t a2)
{
  if (a2 == 1)
  {
    return [*(a1 + 32) sendCompositionForFileProvider:*(a1 + 40) completion:*(a1 + 48)];
  }

  result = *(a1 + 48);
  if (result)
  {
    return (*(result + 16))(result, 0);
  }

  return result;
}

void __62__CKChatController_sendCompositionForFileProvider_completion___block_invoke_2(uint64_t a1)
{
  v17 = *MEMORY[0x1E69E9840];
  if (IMOSLoggingEnabled())
  {
    v2 = OSLogHandleForIMFoundationCategory();
    if (os_log_type_enabled(v2, OS_LOG_TYPE_INFO))
    {
      v3 = *(a1 + 32);
      *buf = 138412290;
      v16 = v3;
      _os_log_impl(&dword_19020E000, v2, OS_LOG_TYPE_INFO, "Querying for current user's status on share %@", buf, 0xCu);
    }
  }

  v4 = *(a1 + 72);
  v11[0] = MEMORY[0x1E69E9820];
  v11[1] = 3221225472;
  v11[2] = __62__CKChatController_sendCompositionForFileProvider_completion___block_invoke_1259;
  v11[3] = &unk_1E72EDB08;
  v5 = *(a1 + 32);
  *&v6 = v5;
  *(&v6 + 1) = *(a1 + 40);
  v10 = v6;
  v7 = *(a1 + 48);
  v8 = *(a1 + 56);
  *&v9 = v7;
  *(&v9 + 1) = v8;
  v12 = v10;
  v13 = v9;
  v14 = *(a1 + 64);
  [v4 sharingStatusForShare:v5 completionHandler:v11];
}

void __62__CKChatController_sendCompositionForFileProvider_completion___block_invoke_1259(uint64_t a1, unint64_t a2, void *a3)
{
  v42 = *MEMORY[0x1E69E9840];
  v5 = a3;
  if (IMOSLoggingEnabled())
  {
    v6 = OSLogHandleForIMFoundationCategory();
    if (os_log_type_enabled(v6, OS_LOG_TYPE_INFO))
    {
      v7 = [*(a1 + 32) recordID];
      *buf = 138412802;
      v37 = v7;
      v38 = 2048;
      v39 = a2;
      v40 = 2112;
      v41 = v5;
      _os_log_impl(&dword_19020E000, v6, OS_LOG_TYPE_INFO, "Received current user's status for share %@, status: %ld, error: %@", buf, 0x20u);
    }
  }

  if (v5)
  {
    v8 = IMLogHandleForCategory();
    if (os_log_type_enabled(v8, OS_LOG_TYPE_ERROR))
    {
      __62__CKChatController_sendCompositionForFileProvider_completion___block_invoke_1259_cold_1();
    }

    v10 = *(a1 + 40);
    v9 = *(a1 + 48);
    v11 = *(a1 + 56);
    v33[0] = MEMORY[0x1E69E9820];
    v33[1] = 3221225472;
    v33[2] = __62__CKChatController_sendCompositionForFileProvider_completion___block_invoke_1260;
    v33[3] = &unk_1E72EDAB8;
    v33[4] = v10;
    v34 = v9;
    v35 = *(a1 + 64);
    [v10 presentCollaborationFailureAlertForComposition:v34 sharingURL:v11 error:v5 completion:v33];
  }

  else if (a2 <= 4 && ((1 << a2) & 0x16) != 0)
  {
    if (IMOSLoggingEnabled())
    {
      v12 = OSLogHandleForIMFoundationCategory();
      if (os_log_type_enabled(v12, OS_LOG_TYPE_INFO))
      {
        *buf = 0;
        _os_log_impl(&dword_19020E000, v12, OS_LOG_TYPE_INFO, "Updating collaboration composition for file provider.", buf, 2u);
      }
    }

    block[0] = MEMORY[0x1E69E9820];
    block[1] = 3221225472;
    block[2] = __62__CKChatController_sendCompositionForFileProvider_completion___block_invoke_1261;
    block[3] = &unk_1E72EDAE0;
    v25 = *(a1 + 40);
    v13 = *(a1 + 48);
    v14 = *(a1 + 32);
    v15 = *(a1 + 56);
    *&v16 = v14;
    *(&v16 + 1) = v15;
    *&v17 = v25;
    *(&v17 + 1) = v13;
    v30 = v17;
    v31 = v16;
    v32 = *(a1 + 64);
    dispatch_async(MEMORY[0x1E69E96A0], block);
  }

  else
  {
    if (IMOSLoggingEnabled())
    {
      v18 = OSLogHandleForIMFoundationCategory();
      if (os_log_type_enabled(v18, OS_LOG_TYPE_INFO))
      {
        *buf = 138412290;
        v37 = 0;
        _os_log_impl(&dword_19020E000, v18, OS_LOG_TYPE_INFO, "Can't add people because you are not the owner or the share doesn't allow others to invite. Error: %@", buf, 0xCu);
      }
    }

    v19 = *(a1 + 40);
    v20 = *(a1 + 48);
    v26[0] = MEMORY[0x1E69E9820];
    v26[1] = 3221225472;
    v26[2] = __62__CKChatController_sendCompositionForFileProvider_completion___block_invoke_1262;
    v26[3] = &unk_1E72EDA90;
    v21 = *(a1 + 56);
    v22 = *(a1 + 64);
    v23 = *(a1 + 40);
    v24 = *(a1 + 48);
    v28 = v22;
    v26[4] = v23;
    v27 = v24;
    [v19 presentCollaborationFailureAlertForComposition:v20 sharingURL:v21 error:0 completion:v26];
  }
}

uint64_t __62__CKChatController_sendCompositionForFileProvider_completion___block_invoke_1260(uint64_t a1, uint64_t a2)
{
  if (a2 == 1)
  {
    return [*(a1 + 32) sendCompositionForFileProvider:*(a1 + 40) completion:*(a1 + 48)];
  }

  result = *(a1 + 48);
  if (result)
  {
    return (*(result + 16))(result, 0);
  }

  return result;
}

uint64_t __62__CKChatController_sendCompositionForFileProvider_completion___block_invoke_1262(uint64_t a1, uint64_t a2)
{
  if (a2 == 1)
  {
    return [*(a1 + 32) sendCompositionForFileProvider:*(a1 + 40) completion:*(a1 + 48)];
  }

  result = *(a1 + 48);
  if (result)
  {
    return (*(result + 16))(result, 0);
  }

  return result;
}

- (id)createAnalyticsDictionaryForCollaborationForType:(int64_t)type sharingURL:(id)l
{
  v28 = *MEMORY[0x1E69E9840];
  lCopy = l;
  v6 = objc_alloc_init(MEMORY[0x1E69A82D8]);
  [v6 bundleIDsForCollaborationURL:lCopy];
  v21 = 0u;
  v22 = 0u;
  v23 = 0u;
  v7 = v24 = 0u;
  v8 = [v7 countByEnumeratingWithState:&v21 objects:v27 count:16];
  if (v8)
  {
    v9 = v8;
    typeCopy = type;
    v10 = *v22;
    v11 = @"NA";
    while (2)
    {
      for (i = 0; i != v9; ++i)
      {
        if (*v22 != v10)
        {
          objc_enumerationMutation(v7);
        }

        v13 = *(*(&v21 + 1) + 8 * i);
        v14 = [objc_alloc(MEMORY[0x1E69635F8]) initWithBundleIdentifier:v13 allowPlaceholder:0 error:0];
        if (v14)
        {
          v15 = v14;
          v11 = v13;

          goto LABEL_11;
        }
      }

      v9 = [v7 countByEnumeratingWithState:&v21 objects:v27 count:16];
      if (v9)
      {
        continue;
      }

      break;
    }

LABEL_11:
    type = typeCopy;
  }

  else
  {
    v11 = @"NA";
  }

  v16 = *MEMORY[0x1E69A72D8];
  v25[0] = *MEMORY[0x1E69A72C8];
  v25[1] = v16;
  v26[0] = v11;
  v17 = [MEMORY[0x1E696AD98] numberWithInteger:type];
  v26[1] = v17;
  v18 = [MEMORY[0x1E695DF20] dictionaryWithObjects:v26 forKeys:v25 count:2];

  return v18;
}

- (void)sendAnalyticsForElapsedSendTimeForType:(int64_t)type sharingURL:(id)l timeInterval:(double)interval
{
  v6 = [(CKChatController *)self createAnalyticsDictionaryForCollaborationForType:type sharingURL:l];
  v9 = [v6 mutableCopy];

  v7 = [MEMORY[0x1E696AD98] numberWithDouble:interval];
  [v9 setObject:v7 forKey:*MEMORY[0x1E69A72D0]];

  mEMORY[0x1E69A8168] = [MEMORY[0x1E69A8168] sharedInstance];
  [mEMORY[0x1E69A8168] trackEvent:*MEMORY[0x1E69A7378] withDictionary:v9];
}

- (void)_sendCollaborationCompositionForFileProvider:(id)provider sharingURL:(id)l share:(id)share completion:(id)completion
{
  v41 = *MEMORY[0x1E69E9840];
  providerCopy = provider;
  lCopy = l;
  shareCopy = share;
  completionCopy = completion;
  if (lCopy)
  {
    shelfPluginPayload = [providerCopy shelfPluginPayload];
    v14 = [shelfPluginPayload url];
    aBlock[0] = MEMORY[0x1E69E9820];
    aBlock[1] = 3221225472;
    aBlock[2] = __93__CKChatController__sendCollaborationCompositionForFileProvider_sharingURL_share_completion___block_invoke;
    aBlock[3] = &unk_1E72EDB80;
    v15 = shelfPluginPayload;
    v34 = v15;
    v16 = lCopy;
    v35 = v16;
    selfCopy = self;
    v37 = providerCopy;
    v38 = completionCopy;
    v17 = _Block_copy(aBlock);
    if (IMOSLoggingEnabled())
    {
      v18 = OSLogHandleForIMFoundationCategory();
      if (os_log_type_enabled(v18, OS_LOG_TYPE_INFO))
      {
        *buf = 138412290;
        v40 = v14;
        _os_log_impl(&dword_19020E000, v18, OS_LOG_TYPE_INFO, "Starting to perform _SWStartCollaborationAction action for url: %@", buf, 0xCu);
      }
    }

    if (_sendCollaborationCompositionForFileProvider_sharingURL_share_completion___pred_SWPerformActionForDocumentURLSharedWithYouCore != -1)
    {
      [CKChatController _sendCollaborationCompositionForFileProvider:sharingURL:share:completion:];
    }

    v19 = MEMORY[0x1E697B740];
    collaborationMetadata = [v15 collaborationMetadata];
    v21 = [v19 actionWithMetadata:collaborationMetadata];

    v22 = _sendCollaborationCompositionForFileProvider_sharingURL_share_completion___SWPerformActionForDocumentURL;
    v28[0] = MEMORY[0x1E69E9820];
    v28[1] = 3221225472;
    v28[2] = __93__CKChatController__sendCollaborationCompositionForFileProvider_sharingURL_share_completion___block_invoke_2;
    v28[3] = &unk_1E72EDBA8;
    v29 = v15;
    v30 = shareCopy;
    v31 = v16;
    v32 = v17;
    v23 = v17;
    v24 = v15;
    v25 = _Block_copy(v28);
    v22(v14, v21, v25);
  }

  else if (IMOSLoggingEnabled())
  {
    v26 = OSLogHandleForIMFoundationCategory();
    if (os_log_type_enabled(v26, OS_LOG_TYPE_INFO))
    {
      *buf = 0;
      _os_log_impl(&dword_19020E000, v26, OS_LOG_TYPE_INFO, "Received nil share URL from CloudSharing.", buf, 2u);
    }
  }
}

void __93__CKChatController__sendCollaborationCompositionForFileProvider_sharingURL_share_completion___block_invoke(uint64_t a1, void *a2)
{
  v32 = *MEMORY[0x1E69E9840];
  v3 = a2;
  if (v3)
  {
    [*(a1 + 32) setCollaborationMetadata:v3];
  }

  v4 = *(a1 + 32);
  v5 = [*(a1 + 40) ckURLByPercentEncodingFragment];
  [v4 setUrl:v5];

  v6 = *(a1 + 32);
  v7 = [MEMORY[0x1E696AEC0] stringGUID];
  [v6 setMessageGUID:v7];

  v8 = *(a1 + 32);
  v9 = [*(a1 + 40) absoluteString];
  if ([v9 length])
  {
    v10 = objc_alloc(MEMORY[0x1E696AAB0]);
    v11 = [*(a1 + 40) absoluteString];
    v12 = [v10 initWithString:v11];
    [v8 setText:v12];
  }

  else
  {
    [v8 setText:0];
  }

  [*(a1 + 32) setPluginBundleID:*MEMORY[0x1E69A6A18]];
  v13 = *(a1 + 48);
  v14 = *(a1 + 32);
  v15 = [v14 messageGUID];
  v16 = [v13 updateDataSourceForPluginPayload:v14 forGUID:v15 withCollaborationMetadata:v3 shareURL:*(a1 + 40)];

  v17 = [CKComposition alloc];
  v18 = [*(a1 + 56) text];
  v19 = [*(a1 + 56) subject];
  v20 = [(CKComposition *)v17 initWithText:v18 subject:v19 shelfPluginPayload:v16];

  if (IMOSLoggingEnabled())
  {
    v21 = OSLogHandleForIMFoundationCategory();
    if (os_log_type_enabled(v21, OS_LOG_TYPE_INFO))
    {
      v22 = *(a1 + 40);
      v23 = [v16 collaborationMetadata];
      *buf = 138412546;
      v29 = v22;
      v30 = 2112;
      v31 = v23;
      _os_log_impl(&dword_19020E000, v21, OS_LOG_TYPE_INFO, "Sending the final composition for sharingURL: %@ with CollaborationMetadata:%@", buf, 0x16u);
    }
  }

  [*(a1 + 48) setShareWasCreated:1];
  v24 = [*(a1 + 32) collaborationMetadata];
  [v24 checkSendReadiness];

  [*(*(a1 + 48) + 1512) stopTimingForKey:@"sendGelato"];
  [*(*(a1 + 48) + 1512) totalTimeForKey:@"sendGelato"];
  [*(a1 + 48) sendAnalyticsForElapsedSendTimeForType:1 sharingURL:*(a1 + 40) timeInterval:?];
  if ([MEMORY[0x1E696AF00] isMainThread])
  {
    [*(a1 + 48) sendCollaborationCompositionAndSetSendingState:v20];
  }

  else
  {
    v26[0] = MEMORY[0x1E69E9820];
    v26[1] = 3221225472;
    v26[2] = __93__CKChatController__sendCollaborationCompositionForFileProvider_sharingURL_share_completion___block_invoke_1276;
    v26[3] = &unk_1E72EB8D0;
    v26[4] = *(a1 + 48);
    v27 = v20;
    dispatch_sync(MEMORY[0x1E69E96A0], v26);
  }

  v25 = *(a1 + 64);
  if (v25)
  {
    (*(v25 + 16))(v25, 1);
  }
}

void *__93__CKChatController__sendCollaborationCompositionForFileProvider_sharingURL_share_completion___block_invoke_1278()
{
  result = MEMORY[0x193AF5ED0]("SWPerformActionForDocumentURL", @"SharedWithYouCore");
  _sendCollaborationCompositionForFileProvider_sharingURL_share_completion___SWPerformActionForDocumentURL = result;
  return result;
}

void __93__CKChatController__sendCollaborationCompositionForFileProvider_sharingURL_share_completion___block_invoke_2(uint64_t a1, void *a2, void *a3)
{
  v24 = *MEMORY[0x1E69E9840];
  v5 = a2;
  v6 = a3;
  objc_opt_class();
  if (objc_opt_isKindOfClass())
  {
    v7 = v5;
  }

  else
  {
    v7 = 0;
  }

  v8 = v7;
  if ([v8 success] && (objc_msgSend(v8, "url"), (v9 = objc_claimAutoreleasedReturnValue()) != 0) && (objc_msgSend(v8, "updatedMetadata"), v10 = objc_claimAutoreleasedReturnValue(), v10, v9, v10))
  {
    if (IMOSLoggingEnabled())
    {
      v11 = OSLogHandleForIMFoundationCategory();
      if (os_log_type_enabled(v11, OS_LOG_TYPE_INFO))
      {
        v12 = [v8 url];
        v13 = [v8 updatedMetadata];
        v20 = 138412546;
        v21 = v12;
        v22 = 2112;
        v23 = v13;
        _os_log_impl(&dword_19020E000, v11, OS_LOG_TYPE_INFO, "Updating the collaborationMetadata for url: %@ with metadata: %@", &v20, 0x16u);
      }
    }

    v14 = [*(a1 + 32) collaborationMetadata];
    v15 = [v8 updatedMetadata];
    v16 = [v14 updatedCollaborationMetadataWithUpdatedMetadata:v15 ckShare:*(a1 + 40) sharingURL:*(a1 + 48)];

    if (!v16)
    {
      v17 = IMLogHandleForCategory();
      if (os_log_type_enabled(v17, OS_LOG_TYPE_ERROR))
      {
        __93__CKChatController__sendCollaborationCompositionForFileProvider_sharingURL_share_completion___block_invoke_2_cold_1();
      }
    }

    (*(*(a1 + 56) + 16))();
  }

  else
  {
    if (IMOSLoggingEnabled())
    {
      v18 = OSLogHandleForIMFoundationCategory();
      if (os_log_type_enabled(v18, OS_LOG_TYPE_INFO))
      {
        v20 = 138412290;
        v21 = v6;
        _os_log_impl(&dword_19020E000, v18, OS_LOG_TYPE_INFO, "Failed to update the collaborationMetadata. Error: %@", &v20, 0xCu);
      }
    }

    v19 = *(a1 + 56);
    v16 = [*(a1 + 32) collaborationMetadata];
    (*(v19 + 16))(v19, v16);
  }
}

- (void)_sendCompositionForFileProviderCloudDrive:(id)drive completion:(id)completion
{
  driveCopy = drive;
  completionCopy = completion;
  shelfPluginPayload = [driveCopy shelfPluginPayload];
  v9 = [shelfPluginPayload url];
  v10 = MEMORY[0x1E6994FC0];
  v14[0] = MEMORY[0x1E69E9820];
  v14[1] = 3221225472;
  v14[2] = __73__CKChatController__sendCompositionForFileProviderCloudDrive_completion___block_invoke;
  v14[3] = &unk_1E72EDC48;
  v15 = v9;
  selfCopy = self;
  v17 = driveCopy;
  v18 = completionCopy;
  v11 = completionCopy;
  v12 = driveCopy;
  v13 = v9;
  [v10 sharingStatusForFileOrFolderURL:v13 completionHandler:v14];
}

void __73__CKChatController__sendCompositionForFileProviderCloudDrive_completion___block_invoke(id *a1, unint64_t a2, void *a3)
{
  v35 = *MEMORY[0x1E69E9840];
  v5 = a3;
  if (v5)
  {
    v6 = IMLogHandleForCategory();
    if (os_log_type_enabled(v6, OS_LOG_TYPE_ERROR))
    {
      __73__CKChatController__sendCompositionForFileProviderCloudDrive_completion___block_invoke_cold_1();
    }

    v8 = a1[5];
    v7 = a1[6];
    v9 = a1[4];
    v29[0] = MEMORY[0x1E69E9820];
    v29[1] = 3221225472;
    v29[2] = __73__CKChatController__sendCompositionForFileProviderCloudDrive_completion___block_invoke_1289;
    v29[3] = &unk_1E72EDBD0;
    v30 = a1[7];
    [v8 presentCollaborationFailureAlertForComposition:v7 sharingURL:v9 error:v5 completion:v29];
  }

  else
  {
    if (a2 > 6)
    {
      v10 = 0;
      v25 = 0;
    }

    else
    {
      if (a2 == 3)
      {
        [a1[5] _startSharingForURLForFileProviderCloudDrive:a1[6] completion:a1[7]];
        goto LABEL_13;
      }

      v25 = @"CKCollaborationStatusErrorDomain";
      v10 = a2;
    }

    [a1[5] disableSendButtonSpinner];
    if (IMOSLoggingEnabled())
    {
      v11 = OSLogHandleForIMFoundationCategory();
      if (os_log_type_enabled(v11, OS_LOG_TYPE_INFO))
      {
        v12 = a1[4];
        *buf = 138412546;
        v32 = v12;
        v33 = 2048;
        v34 = a2;
        _os_log_impl(&dword_19020E000, v11, OS_LOG_TYPE_INFO, "Unable to share %@ with CSUIShareItemStatus: %ld", buf, 0x16u);
      }
    }

    v14 = (a1 + 5);
    v13 = a1[5];
    v15 = a1 + 6;
    v16 = a1[6];
    v18 = a1 + 4;
    v17 = a1[4];
    v19 = [MEMORY[0x1E696ABC0] errorWithDomain:v25 code:v10 userInfo:0];
    v26[0] = MEMORY[0x1E69E9820];
    v26[1] = 3221225472;
    v26[2] = __73__CKChatController__sendCompositionForFileProviderCloudDrive_completion___block_invoke_1290;
    v26[3] = &unk_1E72EDC20;
    v20 = a1[7];
    v24 = *v14;
    v21 = *v15;
    *&v22 = *v18;
    *(&v22 + 1) = v20;
    *&v23 = v24;
    *(&v23 + 1) = v21;
    v27 = v23;
    v28 = v22;
    [v13 presentCollaborationFailureAlertForComposition:v16 sharingURL:v17 error:v19 completion:v26];
  }

LABEL_13:
}

uint64_t __73__CKChatController__sendCompositionForFileProviderCloudDrive_completion___block_invoke_1289(uint64_t a1)
{
  result = *(a1 + 32);
  if (result)
  {
    return (*(result + 16))(result, 0);
  }

  return result;
}

void __73__CKChatController__sendCompositionForFileProviderCloudDrive_completion___block_invoke_1290(uint64_t a1, uint64_t a2)
{
  if (a2 == 2)
  {
    v6 = *(a1 + 32);
    v7 = *(a1 + 40);
    v8 = *(a1 + 56);

    [v6 _startSharingForURLForFileProviderCloudDrive:v7 completion:v8];
  }

  else if (a2 == 3)
  {
    [*(a1 + 32) enableSendButtonSpinner];
    v4 = *(a1 + 32);
    v3 = *(a1 + 40);
    v5 = *(a1 + 48);
    v11[0] = MEMORY[0x1E69E9820];
    v11[1] = 3221225472;
    v11[2] = __73__CKChatController__sendCompositionForFileProviderCloudDrive_completion___block_invoke_2;
    v11[3] = &unk_1E72EDBF8;
    v11[4] = v4;
    v12 = v3;
    v13 = *(a1 + 56);
    [v4 _removeSubsharesAndSendFileProviderComposition:v12 shareURL:v5 completion:v11];
  }

  else
  {
    v9 = *(a1 + 56);
    if (v9)
    {
      v10 = *(v9 + 16);

      v10();
    }
  }
}

void __73__CKChatController__sendCompositionForFileProviderCloudDrive_completion___block_invoke_2(uint64_t a1, void *a2, void *a3)
{
  v7 = a2;
  v5 = a3;
  [*(a1 + 32) disableSendButtonSpinner];
  if (v7 && v5)
  {
    [*(a1 + 32) _sendCollaborationCompositionForFileProvider:*(a1 + 40) sharingURL:v7 share:v5 completion:*(a1 + 48)];
  }

  else
  {
    v6 = *(a1 + 48);
    if (v6)
    {
      (*(v6 + 16))(v6, 0);
    }
  }
}

- (void)_startSharingForURLForFileProviderCloudDrive:(id)drive completion:(id)completion
{
  v38 = *MEMORY[0x1E69E9840];
  driveCopy = drive;
  completionCopy = completion;
  shelfPluginPayload = [driveCopy shelfPluginPayload];
  v27 = [shelfPluginPayload url];
  if (IMOSLoggingEnabled())
  {
    v8 = OSLogHandleForIMFoundationCategory();
    if (os_log_type_enabled(v8, OS_LOG_TYPE_INFO))
    {
      *buf = 138412290;
      v33 = v27;
      _os_log_impl(&dword_19020E000, v8, OS_LOG_TYPE_INFO, "Sending composition for iCloudDrive. url = %@", buf, 0xCu);
    }
  }

  conversation = [(CKCoreChatController *)self conversation];
  recipientPhoneNumbers = [conversation recipientPhoneNumbers];

  conversation2 = [(CKCoreChatController *)self conversation];
  recipientEmailAddresses = [conversation2 recipientEmailAddresses];

  collaborationShareOptions = [driveCopy collaborationShareOptions];
  optionsGroups = [collaborationShareOptions optionsGroups];
  v15 = [(CKChatController *)self _sharingAccessTypeFromOptionsGroups:optionsGroups];

  optionsGroups2 = [collaborationShareOptions optionsGroups];
  v17 = [(CKChatController *)self _sharingPermissionTypeFromOptionsGroups:optionsGroups2];

  optionsGroups3 = [collaborationShareOptions optionsGroups];
  v19 = [(CKChatController *)self _sharingAllowOthersToInviteFromOptionsGroups:optionsGroups3];

  if (IMOSLoggingEnabled())
  {
    v20 = OSLogHandleForIMFoundationCategory();
    if (os_log_type_enabled(v20, OS_LOG_TYPE_INFO))
    {
      v21 = @"NO";
      *buf = 134218498;
      v33 = v15;
      if (v19)
      {
        v21 = @"YES";
      }

      v34 = 2048;
      v35 = v17;
      v36 = 2112;
      v37 = v21;
      _os_log_impl(&dword_19020E000, v20, OS_LOG_TYPE_INFO, "Invoking the share creation with options: accessType: %ld, permissionType:%ld, allowOthersToInvite=%@", buf, 0x20u);
    }
  }

  v22 = objc_alloc_init(MEMORY[0x1E69A6170]);
  [v22 startTimingForKey:@"shareFileOrFolderURL"];
  cKCloudSharingClass = [(CKChatController *)self CKCloudSharingClass];
  if (objc_opt_respondsToSelector())
  {
    optionsGroups4 = [collaborationShareOptions optionsGroups];
    v28[0] = MEMORY[0x1E69E9820];
    v28[1] = 3221225472;
    v28[2] = __76__CKChatController__startSharingForURLForFileProviderCloudDrive_completion___block_invoke;
    v28[3] = &unk_1E72EDC70;
    v28[4] = self;
    v29 = v22;
    v30 = driveCopy;
    v31 = completionCopy;
    [(objc_class *)cKCloudSharingClass shareFileOrFolderURL:v27 emailAddresses:recipientEmailAddresses phoneNumbers:recipientPhoneNumbers optionsGroups:optionsGroups4 completionHandler:v28];
  }

  else
  {
    v25 = IMLogHandleForCategory();
    if (os_log_type_enabled(v25, OS_LOG_TYPE_FAULT))
    {
      [CKChatController _startSharingForURLForFileProviderCloudDrive:completion:];
    }
  }
}

void __76__CKChatController__startSharingForURLForFileProviderCloudDrive_completion___block_invoke(id *a1, void *a2, void *a3, void *a4)
{
  v29 = *MEMORY[0x1E69E9840];
  v7 = a2;
  v8 = a3;
  v9 = a4;
  [a1[4] disableSendButtonSpinner];
  [a1[5] stopTimingForKey:@"shareFileOrFolderURL"];
  [a1[5] totalTimeForKey:@"shareFileOrFolderURL"];
  v11 = v10;
  v12 = IMLogHandleForCategory();
  v13 = v12;
  if (v9)
  {
    if (os_log_type_enabled(v12, OS_LOG_TYPE_ERROR))
    {
      __76__CKChatController__startSharingForURLForFileProviderCloudDrive_completion___block_invoke_cold_1();
    }

    v14 = a1[4];
    v24[0] = MEMORY[0x1E69E9820];
    v24[1] = 3221225472;
    v24[2] = __76__CKChatController__startSharingForURLForFileProviderCloudDrive_completion___block_invoke_1298;
    v24[3] = &unk_1E72EDA90;
    v15 = a1[6];
    v16 = a1[7];
    v17 = a1[4];
    v26 = v16;
    v24[4] = v17;
    v25 = a1[6];
    [v14 presentCollaborationFailureAlertForComposition:v15 sharingURL:v7 error:v9 completion:v24];

    v18 = v26;
  }

  else
  {
    if (os_log_type_enabled(v12, OS_LOG_TYPE_INFO))
    {
      *buf = 134217984;
      v28 = v11;
      _os_log_impl(&dword_19020E000, v13, OS_LOG_TYPE_INFO, "shareFileOrFolderURL finished in %f seconds", buf, 0xCu);
    }

    v19[0] = MEMORY[0x1E69E9820];
    v19[1] = 3221225472;
    v19[2] = __76__CKChatController__startSharingForURLForFileProviderCloudDrive_completion___block_invoke_1299;
    v19[3] = &unk_1E72EDAE0;
    v19[4] = a1[4];
    v20 = a1[6];
    v21 = v7;
    v22 = v8;
    v23 = a1[7];
    dispatch_async(MEMORY[0x1E69E96A0], v19);

    v18 = v20;
  }
}

uint64_t __76__CKChatController__startSharingForURLForFileProviderCloudDrive_completion___block_invoke_1298(uint64_t a1, uint64_t a2)
{
  if (a2 == 1)
  {
    return [*(a1 + 32) _sendCompositionForFileProviderCloudDrive:*(a1 + 40) completion:*(a1 + 48)];
  }

  result = *(a1 + 48);
  if (result)
  {
    return (*(result + 16))(result, 0);
  }

  return result;
}

- (void)_updateAndSendCompositionForFileProvider:(id)provider share:(id)share sharingURL:(id)l completion:(id)completion
{
  v76 = *MEMORY[0x1E69E9840];
  providerCopy = provider;
  shareCopy = share;
  lCopy = l;
  completionCopy = completion;
  v50 = shareCopy;
  v51 = providerCopy;
  if (shareCopy)
  {
    if (providerCopy)
    {
      conversation = [(CKCoreChatController *)self conversation];
      recipientPhoneNumbers = [conversation recipientPhoneNumbers];
      v14 = recipientPhoneNumbers;
      if (recipientPhoneNumbers)
      {
        array = recipientPhoneNumbers;
      }

      else
      {
        array = [MEMORY[0x1E695DEC8] array];
      }

      v17 = array;

      conversation2 = [(CKCoreChatController *)self conversation];
      recipientEmailAddresses = [conversation2 recipientEmailAddresses];
      v20 = recipientEmailAddresses;
      if (recipientEmailAddresses)
      {
        array2 = recipientEmailAddresses;
      }

      else
      {
        array2 = [MEMORY[0x1E695DEC8] array];
      }

      v22 = array2;

      shelfPluginPayload = [providerCopy shelfPluginPayload];
      containerSetupInfo = [shelfPluginPayload containerSetupInfo];

      collaborationShareOptions = [providerCopy collaborationShareOptions];
      optionsGroups = [collaborationShareOptions optionsGroups];
      v26 = [(CKChatController *)self _sharingPermissionTypeFromOptionsGroups:optionsGroups];

      optionsGroups2 = [collaborationShareOptions optionsGroups];
      v28 = [(CKChatController *)self _sharingAllowOthersToInviteFromOptionsGroups:optionsGroups2];

      if (IMOSLoggingEnabled())
      {
        v29 = OSLogHandleForIMFoundationCategory();
        if (os_log_type_enabled(v29, OS_LOG_TYPE_INFO))
        {
          if (v28)
          {
            v30 = @"YES";
          }

          else
          {
            v30 = @"NO";
          }

          v31 = [v17 componentsJoinedByString:{@", "}];
          v32 = [v22 componentsJoinedByString:{@", "}];
          *buf = 134218754;
          *&buf[4] = v26;
          *&buf[12] = 2112;
          *&buf[14] = v30;
          *&buf[22] = 2112;
          v73 = v31;
          v74 = 2112;
          v75 = v32;
          _os_log_impl(&dword_19020E000, v29, OS_LOG_TYPE_INFO, "Updating the share with options: permissionType:%ld, allowOthersToInvite=%@, new phone numbers: %@, new email addresses: %@", buf, 0x2Au);
        }
      }

      cKCloudSharingClass = [(CKChatController *)self CKCloudSharingClass];
      *buf = 0;
      *&buf[8] = buf;
      *&buf[16] = 0x2020000000;
      LOBYTE(v73) = [v50 publicPermission] != 1;
      aBlock[0] = MEMORY[0x1E69E9820];
      aBlock[1] = 3221225472;
      aBlock[2] = __89__CKChatController__updateAndSendCompositionForFileProvider_share_sharingURL_completion___block_invoke;
      aBlock[3] = &unk_1E72EDD10;
      v68 = buf;
      aBlock[4] = self;
      v34 = v51;
      v61 = v34;
      v35 = v26;
      v36 = lCopy;
      v62 = v36;
      v37 = v50;
      v63 = v37;
      v38 = v17;
      v39 = completionCopy;
      v67 = v39;
      v69 = cKCloudSharingClass;
      v46 = containerSetupInfo;
      v64 = v46;
      v45 = v22;
      v65 = v45;
      v16 = v38;
      v66 = v16;
      v70 = v35;
      v71 = v28;
      v40 = _Block_copy(aBlock);
      v41 = MEMORY[0x1E6994FC0];
      shelfPluginPayload2 = [v34 shelfPluginPayload];
      v43 = [shelfPluginPayload2 url];
      v53[0] = MEMORY[0x1E69E9820];
      v53[1] = 3221225472;
      v53[2] = __89__CKChatController__updateAndSendCompositionForFileProvider_share_sharingURL_completion___block_invoke_3;
      v53[3] = &unk_1E72EDD60;
      v54 = v36;
      selfCopy = self;
      v56 = v34;
      v58 = v39;
      v44 = v40;
      v59 = v44;
      v57 = v37;
      [v41 sharingStatusForFileOrFolderURL:v43 completionHandler:v53];

      _Block_object_dispose(buf, 8);
    }

    else
    {
      v16 = IMLogHandleForCategory();
      if (os_log_type_enabled(v16, OS_LOG_TYPE_ERROR))
      {
        [CKChatController _updateAndSendCompositionForFileProvider:a2 share:? sharingURL:? completion:?];
      }
    }
  }

  else
  {
    v16 = IMLogHandleForCategory();
    if (os_log_type_enabled(v16, OS_LOG_TYPE_ERROR))
    {
      [CKChatController _updateAndSendCompositionForFileProvider:a2 share:? sharingURL:? completion:?];
    }
  }
}

void __89__CKChatController__updateAndSendCompositionForFileProvider_share_sharingURL_completion___block_invoke(uint64_t a1)
{
  if (*(*(*(a1 + 96) + 8) + 24) == 1)
  {
    if (IMOSLoggingEnabled())
    {
      v2 = OSLogHandleForIMFoundationCategory();
      if (os_log_type_enabled(v2, OS_LOG_TYPE_INFO))
      {
        *buf = 0;
        _os_log_impl(&dword_19020E000, v2, OS_LOG_TYPE_INFO, "Not calling addParticipants because it's a public share.", buf, 2u);
      }
    }

    [*(a1 + 32) _sendCollaborationCompositionForFileProvider:*(a1 + 40) sharingURL:*(a1 + 48) share:*(a1 + 56) completion:*(a1 + 88)];
  }

  else if (objc_opt_respondsToSelector())
  {
    v3 = *(a1 + 56);
    v4 = *(a1 + 64);
    v5 = *(a1 + 72);
    v6 = *(a1 + 80);
    v7 = *(a1 + 104);
    v8 = *(a1 + 112);
    v9 = *(a1 + 120);
    v11[0] = MEMORY[0x1E69E9820];
    v11[1] = 3221225472;
    v11[2] = __89__CKChatController__updateAndSendCompositionForFileProvider_share_sharingURL_completion___block_invoke_1306;
    v11[3] = &unk_1E72EDCE8;
    v10 = *(a1 + 40);
    v11[4] = *(a1 + 32);
    v12 = v10;
    v14 = *(a1 + 88);
    v13 = *(a1 + 48);
    [v7 addParticipantsToShare:v3 containerSetupInfo:v4 emailAddresses:v5 phoneNumbers:v6 permissionType:v8 allowOthersToInvite:v9 completionHandler:v11];
  }
}

void __89__CKChatController__updateAndSendCompositionForFileProvider_share_sharingURL_completion___block_invoke_1306(uint64_t a1, void *a2, void *a3, void *a4)
{
  v7 = a2;
  v8 = a3;
  v9 = a4;
  [*(a1 + 32) disableSendButtonSpinner];
  if (v9)
  {
    v10 = IMLogHandleForCategory();
    if (os_log_type_enabled(v10, OS_LOG_TYPE_ERROR))
    {
      __89__CKChatController__updateAndSendCompositionForFileProvider_share_sharingURL_completion___block_invoke_1306_cold_1();
    }

    v11 = *(a1 + 32);
    v12 = *(a1 + 40);
    v32[0] = MEMORY[0x1E69E9820];
    v32[1] = 3221225472;
    v32[2] = __89__CKChatController__updateAndSendCompositionForFileProvider_share_sharingURL_completion___block_invoke_1307;
    v32[3] = &unk_1E72EDC98;
    v13 = &v36;
    v14 = *(a1 + 56);
    v15 = *(a1 + 32);
    v16 = *(a1 + 40);
    v36 = v14;
    v32[4] = v15;
    v33 = v16;
    v34 = v8;
    v35 = v7;
    v17 = v7;
    v18 = v8;
    [v11 presentCollaborationFailureAlertForComposition:v12 sharingURL:v17 error:v9 completion:v32];

    v19 = v33;
  }

  else
  {
    block[0] = MEMORY[0x1E69E9820];
    block[1] = 3221225472;
    block[2] = __89__CKChatController__updateAndSendCompositionForFileProvider_share_sharingURL_completion___block_invoke_2;
    block[3] = &unk_1E72EDCC0;
    v13 = &v26;
    v26 = v7;
    v20 = *(a1 + 48);
    v21 = *(a1 + 32);
    v22 = *(a1 + 40);
    v27 = v20;
    v28 = v21;
    v29 = v22;
    v30 = v8;
    v31 = *(a1 + 56);
    v23 = v7;
    v24 = v8;
    dispatch_async(MEMORY[0x1E69E96A0], block);

    v19 = v27;
  }
}

uint64_t __89__CKChatController__updateAndSendCompositionForFileProvider_share_sharingURL_completion___block_invoke_1307(uint64_t a1, uint64_t a2)
{
  if (a2 == 1)
  {
    return [*(a1 + 32) _updateAndSendCompositionForFileProvider:*(a1 + 40) share:*(a1 + 48) sharingURL:*(a1 + 56) completion:*(a1 + 64)];
  }

  result = *(a1 + 64);
  if (result)
  {
    return (*(result + 16))(result, 0);
  }

  return result;
}

void __89__CKChatController__updateAndSendCompositionForFileProvider_share_sharingURL_completion___block_invoke_2(uint64_t a1)
{
  v2 = *(a1 + 32);
  v3 = v2;
  v4 = *(a1 + 40);
  if (v4)
  {
    v6 = v2;
    v5 = v4;

    v3 = v5;
  }

  v7 = v3;
  [*(a1 + 48) _sendCollaborationCompositionForFileProvider:*(a1 + 56) sharingURL:v3 share:*(a1 + 64) completion:*(a1 + 72)];
}

void __89__CKChatController__updateAndSendCompositionForFileProvider_share_sharingURL_completion___block_invoke_3(id *a1, unint64_t a2, void *a3)
{
  v33 = *MEMORY[0x1E69E9840];
  v5 = a3;
  if (v5)
  {
    v6 = IMLogHandleForCategory();
    if (os_log_type_enabled(v6, OS_LOG_TYPE_ERROR))
    {
      __89__CKChatController__updateAndSendCompositionForFileProvider_share_sharingURL_completion___block_invoke_3_cold_1();
    }

    v8 = a1[5];
    v7 = a1[6];
    v9 = a1[4];
    v27[0] = MEMORY[0x1E69E9820];
    v27[1] = 3221225472;
    v27[2] = __89__CKChatController__updateAndSendCompositionForFileProvider_share_sharingURL_completion___block_invoke_1309;
    v27[3] = &unk_1E72EDBD0;
    v28 = a1[8];
    [v8 presentCollaborationFailureAlertForComposition:v7 sharingURL:v9 error:v5 completion:v27];
  }

  else if (a2 <= 6)
  {
    if (((1 << a2) & 0x63) != 0)
    {
      [a1[5] disableSendButtonSpinner];
      if (IMOSLoggingEnabled())
      {
        v10 = OSLogHandleForIMFoundationCategory();
        if (os_log_type_enabled(v10, OS_LOG_TYPE_INFO))
        {
          v11 = a1[4];
          *buf = 134218242;
          v30 = a2;
          v31 = 2112;
          v32 = v11;
          _os_log_impl(&dword_19020E000, v10, OS_LOG_TYPE_INFO, "_checkEnclosingShareForFileProviderUpdate received CSUIShareItemStatus: %ld for url: %@", buf, 0x16u);
        }
      }

      v12 = a1[5];
      v13 = a1[6];
      v14 = a1[4];
      v15 = [MEMORY[0x1E696ABC0] errorWithDomain:@"CKCollaborationStatusErrorDomain" code:a2 userInfo:0];
      v22[0] = MEMORY[0x1E69E9820];
      v22[1] = 3221225472;
      v22[2] = __89__CKChatController__updateAndSendCompositionForFileProvider_share_sharingURL_completion___block_invoke_1310;
      v22[3] = &unk_1E72EDD38;
      v25 = a1[8];
      v21 = a1[5];
      v16 = a1[6];
      v17 = a1[7];
      v18 = a1[4];
      *&v19 = v17;
      *(&v19 + 1) = v18;
      *&v20 = v21;
      *(&v20 + 1) = v16;
      v23 = v20;
      v24 = v19;
      v26 = a1[9];
      [v12 presentCollaborationFailureAlertForComposition:v13 sharingURL:v14 error:v15 completion:v22];
    }

    else
    {
      (*(a1[9] + 2))();
    }
  }
}

uint64_t __89__CKChatController__updateAndSendCompositionForFileProvider_share_sharingURL_completion___block_invoke_1309(uint64_t a1)
{
  result = *(a1 + 32);
  if (result)
  {
    return (*(result + 16))(result, 0);
  }

  return result;
}

void __89__CKChatController__updateAndSendCompositionForFileProvider_share_sharingURL_completion___block_invoke_1310(uint64_t a1, uint64_t a2)
{
  if (a2 > 1)
  {
    if (a2 == 2)
    {
      v13 = *(*(a1 + 72) + 16);

      v13();
    }

    else if (a2 == 3)
    {
      [*(a1 + 32) enableSendButtonSpinner];
      v9 = *(a1 + 32);
      v8 = *(a1 + 40);
      v10 = *(a1 + 56);
      v14[0] = MEMORY[0x1E69E9820];
      v14[1] = 3221225472;
      v14[2] = __89__CKChatController__updateAndSendCompositionForFileProvider_share_sharingURL_completion___block_invoke_2_1311;
      v14[3] = &unk_1E72EDBF8;
      v14[4] = v9;
      v15 = v8;
      v16 = *(a1 + 64);
      [v9 _removeSubsharesAndSendFileProviderComposition:v15 shareURL:v10 completion:v14];
    }
  }

  else if (a2)
  {
    if (a2 == 1)
    {
      v3 = *(a1 + 32);
      v4 = *(a1 + 40);
      v5 = *(a1 + 48);
      v6 = *(a1 + 56);
      v7 = *(a1 + 64);

      [v3 _updateAndSendCompositionForFileProvider:v4 share:v5 sharingURL:v6 completion:v7];
    }
  }

  else
  {
    v11 = *(a1 + 64);
    if (v11)
    {
      v12 = *(v11 + 16);

      v12();
    }
  }
}

void __89__CKChatController__updateAndSendCompositionForFileProvider_share_sharingURL_completion___block_invoke_2_1311(uint64_t a1, void *a2, void *a3)
{
  v6 = a2;
  v5 = a3;
  [*(a1 + 32) disableSendButtonSpinner];
  if (v6 && v5)
  {
    [*(a1 + 32) _sendCollaborationCompositionForFileProvider:*(a1 + 40) sharingURL:v6 share:v5 completion:*(a1 + 48)];
  }
}

- (void)_removeSubsharesAndSendFileProviderComposition:(id)composition shareURL:(id)l completion:(id)completion
{
  v47 = *MEMORY[0x1E69E9840];
  compositionCopy = composition;
  lCopy = l;
  completionCopy = completion;
  collaborationShareOptions = [compositionCopy collaborationShareOptions];
  optionsGroups = [collaborationShareOptions optionsGroups];
  v35 = [(CKChatController *)self _sharingPermissionTypeFromOptionsGroups:optionsGroups];

  optionsGroups2 = [collaborationShareOptions optionsGroups];
  v33 = [(CKChatController *)self _sharingAccessTypeFromOptionsGroups:optionsGroups2];

  conversation = [(CKCoreChatController *)self conversation];
  recipientPhoneNumbers = [conversation recipientPhoneNumbers];
  v15 = recipientPhoneNumbers;
  if (recipientPhoneNumbers)
  {
    array = recipientPhoneNumbers;
  }

  else
  {
    array = [MEMORY[0x1E695DEC8] array];
  }

  v17 = array;

  conversation2 = [(CKCoreChatController *)self conversation];
  recipientEmailAddresses = [conversation2 recipientEmailAddresses];
  v20 = recipientEmailAddresses;
  if (recipientEmailAddresses)
  {
    array2 = recipientEmailAddresses;
  }

  else
  {
    array2 = [MEMORY[0x1E695DEC8] array];
  }

  v22 = array2;

  optionsGroups3 = [collaborationShareOptions optionsGroups];
  v24 = [(CKChatController *)self _sharingAllowOthersToInviteFromOptionsGroups:optionsGroups3];

  if (IMOSLoggingEnabled())
  {
    v25 = OSLogHandleForIMFoundationCategory();
    if (os_log_type_enabled(v25, OS_LOG_TYPE_INFO))
    {
      v32 = lCopy;
      if (v24)
      {
        v26 = @"YES";
      }

      else
      {
        v26 = @"NO";
      }

      v27 = [v17 componentsJoinedByString:{@", "}];
      v28 = [v22 componentsJoinedByString:{@", "}];
      *buf = 134218754;
      v40 = v35;
      v41 = 2112;
      v42 = v26;
      v43 = 2112;
      v44 = v27;
      v45 = 2112;
      v46 = v28;
      _os_log_impl(&dword_19020E000, v25, OS_LOG_TYPE_INFO, "_removeSubsharesAndSendFileProviderComposition permissionType:%ld, allowOthersToInvite=%@, new phone numbers: %@, new email addresses: %@", buf, 0x2Au);

      lCopy = v32;
    }
  }

  v29 = MEMORY[0x1E6994FC0];
  v36[0] = MEMORY[0x1E69E9820];
  v36[1] = 3221225472;
  v36[2] = __87__CKChatController__removeSubsharesAndSendFileProviderComposition_shareURL_completion___block_invoke;
  v36[3] = &unk_1E72EDDB0;
  v36[4] = self;
  v37 = compositionCopy;
  v38 = completionCopy;
  v30 = completionCopy;
  v31 = compositionCopy;
  [v29 shareFolderRemovingSubshares:lCopy emailAddresses:v22 phoneNumbers:v17 accessType:v33 permissionType:v35 allowOthersToInvite:v24 completionHandler:v36];
}

void __87__CKChatController__removeSubsharesAndSendFileProviderComposition_shareURL_completion___block_invoke(uint64_t a1, void *a2, void *a3, void *a4)
{
  v7 = a2;
  v8 = a3;
  v9 = a4;
  if (v9)
  {
    v10 = IMLogHandleForCategory();
    if (os_log_type_enabled(v10, OS_LOG_TYPE_ERROR))
    {
      __87__CKChatController__removeSubsharesAndSendFileProviderComposition_shareURL_completion___block_invoke_cold_1();
    }

    v11 = *(a1 + 32);
    v12 = *(a1 + 40);
    v18[0] = MEMORY[0x1E69E9820];
    v18[1] = 3221225472;
    v18[2] = __87__CKChatController__removeSubsharesAndSendFileProviderComposition_shareURL_completion___block_invoke_1312;
    v18[3] = &unk_1E72EDBD0;
    v13 = &v19;
    v19 = *(a1 + 48);
    [v11 presentCollaborationFailureAlertForComposition:v12 sharingURL:v7 error:v9 completion:v18];
  }

  else
  {
    v14[0] = MEMORY[0x1E69E9820];
    v14[1] = 3221225472;
    v14[2] = __87__CKChatController__removeSubsharesAndSendFileProviderComposition_shareURL_completion___block_invoke_3;
    v14[3] = &unk_1E72EDD88;
    v13 = &v17;
    v17 = *(a1 + 48);
    v15 = v7;
    v16 = v8;
    dispatch_async(MEMORY[0x1E69E96A0], v14);
  }
}

void __87__CKChatController__removeSubsharesAndSendFileProviderComposition_shareURL_completion___block_invoke_1312(uint64_t a1)
{
  if (*(a1 + 32))
  {
    block[0] = MEMORY[0x1E69E9820];
    block[1] = 3221225472;
    block[2] = __87__CKChatController__removeSubsharesAndSendFileProviderComposition_shareURL_completion___block_invoke_2;
    block[3] = &unk_1E72EBDB8;
    v2 = *(a1 + 32);
    dispatch_async(MEMORY[0x1E69E96A0], block);
  }
}

- (id)updateDataSourceForPluginPayload:(id)payload forGUID:(id)d withCollaborationMetadata:(id)metadata shareURL:(id)l
{
  v31 = *MEMORY[0x1E69E9840];
  payloadCopy = payload;
  dCopy = d;
  metadataCopy = metadata;
  lCopy = l;
  if (!payloadCopy || (v13 = [dCopy length], !metadataCopy) || !v13)
  {
    v14 = IMLogHandleForCategory();
    if (os_log_type_enabled(v14, OS_LOG_TYPE_ERROR))
    {
      v25 = 138412802;
      v26 = payloadCopy;
      v27 = 2112;
      v28 = dCopy;
      v29 = 2112;
      v30 = metadataCopy;
      _os_log_error_impl(&dword_19020E000, v14, OS_LOG_TYPE_ERROR, "Not updating data source. pluginPayload: %@ messageGUID: %@ collaborationMetadata: %@", &v25, 0x20u);
    }
  }

  v15 = MEMORY[0x1E696ECD8];
  data = [payloadCopy data];
  v17 = [v15 linkWithDataRepresentationWithoutSubstitutingAttachments:data];

  metadata = [v17 metadata];
  [metadata setOriginalURL:lCopy];
  [metadata setCollaborationMetadata:metadataCopy];
  [v17 setMetadata:metadata];
  v19 = [v17 dataRepresentationWithOutOfLineAttachments:0];
  [payloadCopy setData:v19];

  mEMORY[0x1E69A5AD0] = [MEMORY[0x1E69A5AD0] sharedInstance];
  v21 = [mEMORY[0x1E69A5AD0] dataSourceForPluginPayload:payloadCopy];

  mEMORY[0x1E69A5AD0]2 = [MEMORY[0x1E69A5AD0] sharedInstance];
  messageGUID = [payloadCopy messageGUID];
  [mEMORY[0x1E69A5AD0]2 insertDataSource:v21 forGUID:messageGUID];

  return payloadCopy;
}

- (void)_sendCollaborationCompositionForCloudKit:(id)kit sharingURL:(id)l share:(id)share completion:(id)completion
{
  v44 = *MEMORY[0x1E69E9840];
  kitCopy = kit;
  lCopy = l;
  shareCopy = share;
  completionCopy = completion;
  if (lCopy)
  {
    shelfPluginPayload = [kitCopy shelfPluginPayload];
    v14 = [shelfPluginPayload url];
    ckURLByPercentEncodingFragment = [v14 ckURLByPercentEncodingFragment];
    [shelfPluginPayload setUrl:ckURLByPercentEncodingFragment];

    stringGUID = [MEMORY[0x1E696AEC0] stringGUID];
    [shelfPluginPayload setMessageGUID:stringGUID];

    absoluteString = [lCopy absoluteString];
    if ([absoluteString length])
    {
      v18 = objc_alloc(MEMORY[0x1E696AAB0]);
      absoluteString2 = [lCopy absoluteString];
      v20 = [v18 initWithString:absoluteString2];
      [shelfPluginPayload setText:v20];
    }

    else
    {
      [shelfPluginPayload setText:0];
    }

    [shelfPluginPayload setPluginBundleID:*MEMORY[0x1E69A6A18]];
    messageGUID = [shelfPluginPayload messageGUID];
    collaborationMetadata = [shelfPluginPayload collaborationMetadata];
    v24 = [(CKChatController *)self updateDataSourceForPluginPayload:shelfPluginPayload forGUID:messageGUID withCollaborationMetadata:collaborationMetadata shareURL:lCopy];

    if ([MEMORY[0x1E69A5AC8] isPayloadServiceManatee:v24])
    {
      v25 = [(CKChatController *)self shareMetadataWithDugongTokensForCKShare:shareCopy shareURL:lCopy];
      datasource = [v24 datasource];
      richLinkMetadata = [datasource richLinkMetadata];

      specialization = [richLinkMetadata specialization];
      objc_opt_class();
      isKindOfClass = objc_opt_isKindOfClass();

      if (isKindOfClass)
      {
        specialization2 = [richLinkMetadata specialization];
        v30Specialization = [specialization2 specialization];

        if (objc_opt_respondsToSelector())
        {
          [v30Specialization setEncodedTokens:v25];
        }
      }
    }

    v32 = [CKComposition alloc];
    text = [kitCopy text];
    subject = [kitCopy subject];
    v35 = [(CKComposition *)v32 initWithText:text subject:subject shelfPluginPayload:v24];

    if (IMOSLoggingEnabled())
    {
      v36 = OSLogHandleForIMFoundationCategory();
      if (os_log_type_enabled(v36, OS_LOG_TYPE_INFO))
      {
        v37 = [shelfPluginPayload url];
        *buf = 138412290;
        v43 = v37;
        _os_log_impl(&dword_19020E000, v36, OS_LOG_TYPE_INFO, "Sending the final composition for CloudKit sharingURL: %@", buf, 0xCu);
      }
    }

    [(CKCoreChatController *)self setShareWasCreated:1];
    collaborationMetadata2 = [shelfPluginPayload collaborationMetadata];
    [collaborationMetadata2 checkSendReadiness];

    [(IMTimingCollection *)self->_timingCollectionSendGelato stopTimingForKey:@"sendGelato"];
    [(IMTimingCollection *)self->_timingCollectionSendGelato totalTimeForKey:@"sendGelato"];
    [(CKChatController *)self sendAnalyticsForElapsedSendTimeForType:2 sharingURL:lCopy timeInterval:?];
    if ([MEMORY[0x1E696AF00] isMainThread])
    {
      [(CKChatController *)self sendCollaborationCompositionAndSetSendingState:v35];
    }

    else
    {
      block[0] = MEMORY[0x1E69E9820];
      block[1] = 3221225472;
      block[2] = __89__CKChatController__sendCollaborationCompositionForCloudKit_sharingURL_share_completion___block_invoke;
      block[3] = &unk_1E72EB8D0;
      block[4] = self;
      v41 = v35;
      dispatch_sync(MEMORY[0x1E69E96A0], block);
    }

    if (completionCopy)
    {
      completionCopy[2](completionCopy, 1);
    }
  }

  else if (IMOSLoggingEnabled())
  {
    v21 = OSLogHandleForIMFoundationCategory();
    if (os_log_type_enabled(v21, OS_LOG_TYPE_INFO))
    {
      *buf = 0;
      _os_log_impl(&dword_19020E000, v21, OS_LOG_TYPE_INFO, "Received nil share URL from CloudSharing.", buf, 2u);
    }
  }
}

- (void)_sendCompositionForNewCloudKitShare:(id)share completion:(id)completion
{
  v37 = *MEMORY[0x1E69E9840];
  shareCopy = share;
  completionCopy = completion;
  shelfPluginPayload = [shareCopy shelfPluginPayload];
  v24 = [shelfPluginPayload url];
  if (IMOSLoggingEnabled())
  {
    v8 = OSLogHandleForIMFoundationCategory();
    if (os_log_type_enabled(v8, OS_LOG_TYPE_INFO))
    {
      *buf = 138412290;
      v32 = v24;
      _os_log_impl(&dword_19020E000, v8, OS_LOG_TYPE_INFO, "Sending collaboration composition for New CloudKit share. URL = %@", buf, 0xCu);
    }
  }

  conversation = [(CKCoreChatController *)self conversation];
  recipientPhoneNumbers = [conversation recipientPhoneNumbers];

  conversation2 = [(CKCoreChatController *)self conversation];
  recipientEmailAddresses = [conversation2 recipientEmailAddresses];

  containerSetupInfo = [shelfPluginPayload containerSetupInfo];
  cloudKitShare = [shelfPluginPayload cloudKitShare];
  collaborationShareOptions = [shareCopy collaborationShareOptions];
  optionsGroups = [collaborationShareOptions optionsGroups];
  v15 = [(CKChatController *)self _sharingAccessTypeFromOptionsGroups:optionsGroups];

  optionsGroups2 = [collaborationShareOptions optionsGroups];
  v17 = [(CKChatController *)self _sharingPermissionTypeFromOptionsGroups:optionsGroups2];

  optionsGroups3 = [collaborationShareOptions optionsGroups];
  v19 = [(CKChatController *)self _sharingAllowOthersToInviteFromOptionsGroups:optionsGroups3];

  if (IMOSLoggingEnabled())
  {
    v20 = OSLogHandleForIMFoundationCategory();
    if (os_log_type_enabled(v20, OS_LOG_TYPE_INFO))
    {
      v21 = @"NO";
      *buf = 134218498;
      v32 = v15;
      if (v19)
      {
        v21 = @"YES";
      }

      v33 = 2048;
      v34 = v17;
      v35 = 2112;
      v36 = v21;
      _os_log_impl(&dword_19020E000, v20, OS_LOG_TYPE_INFO, "Invoking the share creation with options: accessType: %ld permissionType:%ld, allowOthersToInvite=%@", buf, 0x20u);
    }
  }

  cKCloudSharingClass = [(CKChatController *)self CKCloudSharingClass];
  if (objc_opt_respondsToSelector())
  {
    v28[0] = MEMORY[0x1E69E9820];
    v28[1] = 3221225472;
    v28[2] = __67__CKChatController__sendCompositionForNewCloudKitShare_completion___block_invoke;
    v28[3] = &unk_1E72EDDB0;
    v28[4] = self;
    v29 = shareCopy;
    v30 = completionCopy;
    LOBYTE(v23) = v19;
    [(objc_class *)cKCloudSharingClass completeShare:cloudKitShare containerSetupInfo:containerSetupInfo emailAddresses:recipientEmailAddresses phoneNumbers:recipientPhoneNumbers accessType:v15 permissionType:v17 allowOthersToInvite:v23 completionHandler:v28];
  }
}

void __67__CKChatController__sendCompositionForNewCloudKitShare_completion___block_invoke(uint64_t a1, void *a2, void *a3, void *a4)
{
  v29 = *MEMORY[0x1E69E9840];
  v7 = a2;
  v8 = a3;
  v9 = a4;
  [*(a1 + 32) disableSendButtonSpinner];
  if (v9)
  {
    if (IMOSLoggingEnabled())
    {
      v10 = OSLogHandleForIMFoundationCategory();
      if (os_log_type_enabled(v10, OS_LOG_TYPE_INFO))
      {
        *buf = 138412546;
        v26 = v9;
        v27 = 2112;
        v28 = v7;
        _os_log_impl(&dword_19020E000, v10, OS_LOG_TYPE_INFO, "Error while creating the share URL for CloudKit: %@. Sharing URL: %@", buf, 0x16u);
      }
    }

    v11 = *(a1 + 32);
    v12 = *(a1 + 40);
    v22[0] = MEMORY[0x1E69E9820];
    v22[1] = 3221225472;
    v22[2] = __67__CKChatController__sendCompositionForNewCloudKitShare_completion___block_invoke_1321;
    v22[3] = &unk_1E72EDA90;
    v13 = *(a1 + 48);
    v14 = *(a1 + 32);
    v15 = *(a1 + 40);
    v24 = v13;
    v22[4] = v14;
    v23 = v15;
    [v11 presentCollaborationFailureAlertForComposition:v12 sharingURL:v7 error:v9 completion:v22];
  }

  else
  {
    v17[0] = MEMORY[0x1E69E9820];
    v17[1] = 3221225472;
    v17[2] = __67__CKChatController__sendCompositionForNewCloudKitShare_completion___block_invoke_2;
    v17[3] = &unk_1E72EDAE0;
    v16 = *(a1 + 40);
    v17[4] = *(a1 + 32);
    v18 = v16;
    v19 = v7;
    v20 = v8;
    v21 = *(a1 + 48);
    dispatch_async(MEMORY[0x1E69E96A0], v17);
  }
}

uint64_t __67__CKChatController__sendCompositionForNewCloudKitShare_completion___block_invoke_1321(uint64_t a1, uint64_t a2)
{
  if (a2)
  {
    return [*(a1 + 32) _sendCompositionForNewCloudKitShare:*(a1 + 40) completion:*(a1 + 48)];
  }

  result = *(a1 + 48);
  if (result)
  {
    return (*(result + 16))(result, 0);
  }

  return result;
}

uint64_t __67__CKChatController__sendCompositionForNewCloudKitShare_completion___block_invoke_2(uint64_t a1)
{
  if (IMOSLoggingEnabled())
  {
    v2 = OSLogHandleForIMFoundationCategory();
    if (os_log_type_enabled(v2, OS_LOG_TYPE_INFO))
    {
      *v4 = 0;
      _os_log_impl(&dword_19020E000, v2, OS_LOG_TYPE_INFO, "CloudSharing API returned without error. Calling send composition.", v4, 2u);
    }
  }

  return [*(a1 + 32) _sendCollaborationCompositionForCloudKit:*(a1 + 40) sharingURL:*(a1 + 48) share:*(a1 + 56) completion:*(a1 + 64)];
}

- (void)_updateAndSendCompositionForExistingCloudKitShare:(id)share share:(id)a4 attempt:(unint64_t)attempt completion:(id)completion
{
  v45 = *MEMORY[0x1E69E9840];
  shareCopy = share;
  v11 = a4;
  completionCopy = completion;
  if (v11)
  {
    if (shareCopy)
    {
      conversation = [(CKCoreChatController *)self conversation];
      recipientPhoneNumbers = [conversation recipientPhoneNumbers];

      conversation2 = [(CKCoreChatController *)self conversation];
      recipientEmailAddresses = [conversation2 recipientEmailAddresses];

      shelfPluginPayload = [shareCopy shelfPluginPayload];
      containerSetupInfo = [shelfPluginPayload containerSetupInfo];

      collaborationShareOptions = [shareCopy collaborationShareOptions];
      optionsGroups = [collaborationShareOptions optionsGroups];
      v30 = [(CKChatController *)self _sharingPermissionTypeFromOptionsGroups:optionsGroups];

      optionsGroups2 = [collaborationShareOptions optionsGroups];
      v29 = [(CKChatController *)self _sharingAllowOthersToInviteFromOptionsGroups:optionsGroups2];

      if (IMOSLoggingEnabled())
      {
        v21 = OSLogHandleForIMFoundationCategory();
        if (os_log_type_enabled(v21, OS_LOG_TYPE_INFO))
        {
          v28 = recipientEmailAddresses;
          if (v29)
          {
            v22 = @"YES";
          }

          else
          {
            v22 = @"NO";
          }

          v23 = [recipientPhoneNumbers componentsJoinedByString:@", "];
          v24 = [v28 componentsJoinedByString:{@", "}];
          *buf = 134218754;
          v38 = v30;
          v39 = 2112;
          v40 = v22;
          v41 = 2112;
          v42 = v23;
          v43 = 2112;
          v44 = v24;
          _os_log_impl(&dword_19020E000, v21, OS_LOG_TYPE_INFO, "Updating the share with options: permissionType:%ld, allowOthersToInvite=%@, new phone numbers: %@, new email addresses: %@", buf, 0x2Au);

          recipientEmailAddresses = v28;
        }
      }

      cKCloudSharingClass = [(CKChatController *)self CKCloudSharingClass];
      if ([v11 publicPermission] == 1)
      {
        if (objc_opt_respondsToSelector())
        {
          v33[0] = MEMORY[0x1E69E9820];
          v33[1] = 3221225472;
          v33[2] = __95__CKChatController__updateAndSendCompositionForExistingCloudKitShare_share_attempt_completion___block_invoke;
          v33[3] = &unk_1E72EDDD8;
          v33[4] = self;
          attemptCopy = attempt;
          v34 = shareCopy;
          v35 = completionCopy;
          [(objc_class *)cKCloudSharingClass addParticipantsToShare:v11 containerSetupInfo:containerSetupInfo emailAddresses:recipientEmailAddresses phoneNumbers:recipientPhoneNumbers permissionType:v30 allowOthersToInvite:v29 completionHandler:v33];
        }
      }

      else
      {
        if (IMOSLoggingEnabled())
        {
          v26 = OSLogHandleForIMFoundationCategory();
          if (os_log_type_enabled(v26, OS_LOG_TYPE_INFO))
          {
            *buf = 0;
            _os_log_impl(&dword_19020E000, v26, OS_LOG_TYPE_INFO, "Not calling addParticipants because it's a public share.", buf, 2u);
          }
        }

        v27 = [v11 URL];
        [(CKChatController *)self _sendCollaborationCompositionForCloudKit:shareCopy sharingURL:v27 share:v11 completion:completionCopy];
      }
    }

    else
    {
      recipientPhoneNumbers = IMLogHandleForCategory();
      if (os_log_type_enabled(recipientPhoneNumbers, OS_LOG_TYPE_ERROR))
      {
        [CKChatController _updateAndSendCompositionForExistingCloudKitShare:a2 share:? attempt:? completion:?];
      }
    }
  }

  else
  {
    recipientPhoneNumbers = IMLogHandleForCategory();
    if (os_log_type_enabled(recipientPhoneNumbers, OS_LOG_TYPE_ERROR))
    {
      [CKChatController _updateAndSendCompositionForExistingCloudKitShare:a2 share:? attempt:? completion:?];
    }
  }
}

void __95__CKChatController__updateAndSendCompositionForExistingCloudKitShare_share_attempt_completion___block_invoke(uint64_t a1, void *a2, void *a3, void *a4)
{
  v7 = a2;
  v8 = a3;
  v9 = a4;
  [*(a1 + 32) disableSendButtonSpinner];
  if (v9)
  {
    v10 = IMLogHandleForCategory();
    if (os_log_type_enabled(v10, OS_LOG_TYPE_ERROR))
    {
      __95__CKChatController__updateAndSendCompositionForExistingCloudKitShare_share_attempt_completion___block_invoke_cold_1();
    }

    v11 = [v9 updatedServerChangedShare];
    v12 = [MEMORY[0x1E69A53F0] sharedInstanceForBagType:1];
    v13 = [v12 objectForKey:@"sharedwithyou-max-retry-attempts" ofClass:objc_opt_class()];
    v14 = v13;
    v15 = &unk_1F04E78C0;
    if (v13)
    {
      v15 = v13;
    }

    v16 = v15;

    v17 = *(a1 + 56);
    v18 = [v16 intValue];

    if (v17 > v18 || v11 == 0)
    {
      v20 = *(a1 + 32);
      v21 = *(a1 + 40);
      v33[0] = MEMORY[0x1E69E9820];
      v33[1] = 3221225472;
      v33[2] = __95__CKChatController__updateAndSendCompositionForExistingCloudKitShare_share_attempt_completion___block_invoke_1329;
      v33[3] = &unk_1E72EDC98;
      v22 = *(a1 + 48);
      v23 = *(a1 + 32);
      v24 = *(a1 + 40);
      v37 = v22;
      v33[4] = v23;
      v34 = v24;
      v35 = v11;
      v36 = v8;
      [v20 presentCollaborationFailureAlertForComposition:v21 sharingURL:v7 error:v9 completion:v33];
    }

    else
    {
      v26 = IMLogHandleForCategory();
      if (os_log_type_enabled(v26, OS_LOG_TYPE_ERROR))
      {
        __95__CKChatController__updateAndSendCompositionForExistingCloudKitShare_share_attempt_completion___block_invoke_cold_2();
      }

      [*(a1 + 32) _updateAndSendCompositionForExistingCloudKitShare:*(a1 + 40) share:v11 attempt:*(a1 + 56) + 1 completion:*(a1 + 48)];
    }
  }

  else
  {
    v28[0] = MEMORY[0x1E69E9820];
    v28[1] = 3221225472;
    v28[2] = __95__CKChatController__updateAndSendCompositionForExistingCloudKitShare_share_attempt_completion___block_invoke_2;
    v28[3] = &unk_1E72EDAE0;
    v25 = *(a1 + 40);
    v28[4] = *(a1 + 32);
    v29 = v25;
    v30 = v7;
    v31 = v8;
    v32 = *(a1 + 48);
    dispatch_async(MEMORY[0x1E69E96A0], v28);
  }
}

uint64_t __95__CKChatController__updateAndSendCompositionForExistingCloudKitShare_share_attempt_completion___block_invoke_1329(uint64_t a1, uint64_t a2)
{
  if (a2 == 1)
  {
    v2 = *(a1 + 48);
    if (!v2)
    {
      v2 = *(a1 + 56);
    }

    return [*(a1 + 32) _updateAndSendCompositionForExistingCloudKitShare:*(a1 + 40) share:v2 completion:*(a1 + 64)];
  }

  else
  {
    result = *(a1 + 64);
    if (result)
    {
      return (*(result + 16))(result, 0);
    }
  }

  return result;
}

- (void)sendCompositionForPendingCollaboration:(id)collaboration completion:(id)completion
{
  v57 = *MEMORY[0x1E69E9840];
  collaborationCopy = collaboration;
  completionCopy = completion;
  if (IMOSLoggingEnabled())
  {
    v8 = OSLogHandleForIMFoundationCategory();
    if (os_log_type_enabled(v8, OS_LOG_TYPE_INFO))
    {
      *buf = 0;
      _os_log_impl(&dword_19020E000, v8, OS_LOG_TYPE_INFO, "Sending collaboration composition for GroupActivity.", buf, 2u);
    }
  }

  shelfPluginPayload = [collaborationCopy shelfPluginPayload];
  v10 = objc_alloc(MEMORY[0x1E69D37C0]);
  v36 = [v10 initWithTargetSerialQueue:MEMORY[0x1E69E96A0] synchronous:1];
  conversation = [(CKCoreChatController *)self conversation];
  recipientStrings = [conversation recipientStrings];

  v13 = [objc_alloc(MEMORY[0x1E695DFD8]) initWithArray:recipientStrings];
  v14 = [shelfPluginPayload url];
  collaborationMetadata = [shelfPluginPayload collaborationMetadata];
  collaborationShareOptions = [collaborationCopy collaborationShareOptions];
  [collaborationMetadata setUserSelectedShareOptions:collaborationShareOptions];

  isFileURL = [v14 isFileURL];
  v18 = isFileURL;
  *buf = 0;
  v52 = buf;
  v53 = 0x2020000000;
  if (isFileURL)
  {
    startAccessingSecurityScopedResource = [v14 startAccessingSecurityScopedResource];
  }

  else
  {
    startAccessingSecurityScopedResource = 0;
  }

  v54 = startAccessingSecurityScopedResource;
  aBlock[0] = MEMORY[0x1E69E9820];
  aBlock[1] = 3221225472;
  aBlock[2] = __70__CKChatController_sendCompositionForPendingCollaboration_completion___block_invoke;
  aBlock[3] = &unk_1E72EDE50;
  v20 = shelfPluginPayload;
  v44 = v20;
  v50 = buf;
  v21 = v14;
  v45 = v21;
  selfCopy = self;
  v22 = collaborationCopy;
  v47 = v22;
  v23 = completionCopy;
  v49 = v23;
  v24 = v13;
  v48 = v24;
  v25 = _Block_copy(aBlock);
  if (v18)
  {
    if (v52[24])
    {
      defaultManager = [MEMORY[0x1E69673B0] defaultManager];
      v27 = [defaultManager itemForURL:v21 error:0];

      if (v27)
      {
        if (IMOSLoggingEnabled())
        {
          v28 = OSLogHandleForIMFoundationCategory();
          if (os_log_type_enabled(v28, OS_LOG_TYPE_INFO))
          {
            if (v52[24])
            {
              v29 = @"YES";
            }

            else
            {
              v29 = @"NO";
            }

            *v55 = 138412290;
            v56 = v29;
            _os_log_impl(&dword_19020E000, v28, OS_LOG_TYPE_INFO, "Payload appears to be for a file provider. Starting handshake with a file url. did startAccessingSecurityScopedResource: %@", v55, 0xCu);
          }
        }

        [(CKChatController *)self enableSendButtonSpinner];
        collaborationMetadata2 = [v20 collaborationMetadata];
        [v36 startCollaborationWithFileURL:v21 metadata:collaborationMetadata2 participants:v24 timeout:v25 completion:10.0];
        goto LABEL_31;
      }

      v35 = IMLogHandleForCategory();
      if (os_log_type_enabled(v35, OS_LOG_TYPE_ERROR))
      {
        [CKChatController sendCompositionForPendingCollaboration:completion:];
      }

      [(CKChatController *)self disableSendButtonSpinner];
      v33 = [MEMORY[0x1E696ABC0] errorWithDomain:@"CKCollaborationErrorDomain" code:2 userInfo:0];
      v34 = v37;
      v37[0] = MEMORY[0x1E69E9820];
      v37[1] = 3221225472;
      v37[2] = __70__CKChatController_sendCompositionForPendingCollaboration_completion___block_invoke_1337;
      v37[3] = &unk_1E72EDA90;
      v39 = v23;
      v37[4] = self;
      v38 = v22;
      [(CKChatController *)self presentCollaborationFailureAlertForComposition:v38 sharingURL:0 error:v33 completion:v37];
    }

    else
    {
      v32 = IMLogHandleForCategory();
      if (os_log_type_enabled(v32, OS_LOG_TYPE_ERROR))
      {
        [CKChatController sendCompositionForPendingCollaboration:completion:];
      }

      [(CKChatController *)self disableSendButtonSpinner];
      v33 = [MEMORY[0x1E696ABC0] errorWithDomain:@"CKCollaborationErrorDomain" code:1 userInfo:0];
      v34 = v40;
      v40[0] = MEMORY[0x1E69E9820];
      v40[1] = 3221225472;
      v40[2] = __70__CKChatController_sendCompositionForPendingCollaboration_completion___block_invoke_1335;
      v40[3] = &unk_1E72EDA90;
      v42 = v23;
      v40[4] = self;
      v41 = v22;
      [(CKChatController *)self presentCollaborationFailureAlertForComposition:v41 sharingURL:0 error:v33 completion:v40];
    }

    collaborationMetadata2 = v34[6];
    goto LABEL_31;
  }

  if (IMOSLoggingEnabled())
  {
    v31 = OSLogHandleForIMFoundationCategory();
    if (os_log_type_enabled(v31, OS_LOG_TYPE_INFO))
    {
      *v55 = 0;
      _os_log_impl(&dword_19020E000, v31, OS_LOG_TYPE_INFO, "Payload appears to be for a generic 3rd party. Starting handshake with metadata.", v55, 2u);
    }
  }

  [(CKChatController *)self enableSendButtonSpinner];
  collaborationMetadata2 = [v20 collaborationMetadata];
  [v36 startCollaborationWithMetadata:collaborationMetadata2 participants:v24 timeout:v25 completion:10.0];
LABEL_31:

  _Block_object_dispose(buf, 8);
}

void __70__CKChatController_sendCompositionForPendingCollaboration_completion___block_invoke(uint64_t a1, void *a2, void *a3, void *a4)
{
  v65 = *MEMORY[0x1E69E9840];
  v7 = a2;
  v48 = a3;
  v47 = a4;
  if (IMOSLoggingEnabled())
  {
    v8 = OSLogHandleForIMFoundationCategory();
    if (os_log_type_enabled(v8, OS_LOG_TYPE_INFO))
    {
      v9 = [*(a1 + 32) collaborationMetadata];
      *buf = 138412290;
      v62 = v9;
      _os_log_impl(&dword_19020E000, v8, OS_LOG_TYPE_INFO, "Starting collaboration for pending collaboration with metadata: %@", buf, 0xCu);
    }
  }

  if (*(*(*(a1 + 80) + 8) + 24) == 1)
  {
    [*(a1 + 40) stopAccessingSecurityScopedResource];
  }

  if (v7)
  {
    [*(a1 + 32) setUrl:v7];
    v10 = *(a1 + 32);
    v11 = [MEMORY[0x1E696AEC0] stringGUID];
    [v10 setMessageGUID:v11];

    v12 = *(a1 + 32);
    v13 = [v7 absoluteString];
    if ([v13 length])
    {
      v14 = objc_alloc(MEMORY[0x1E696AAB0]);
      v15 = [v7 absoluteString];
      v16 = [v14 initWithString:v15];
      [v12 setText:v16];
    }

    else
    {
      [v12 setText:0];
    }

    [*(a1 + 32) setPluginBundleID:*MEMORY[0x1E69A6A18]];
    [*(a1 + 32) setCollaborationMetadata:v48];
    v24 = *(a1 + 48);
    v25 = *(a1 + 32);
    v26 = [v25 messageGUID];
    v46 = [v24 updateDataSourceForPluginPayload:v25 forGUID:v26 withCollaborationMetadata:v48 shareURL:v7];

    v27 = [CKComposition alloc];
    v28 = [*(a1 + 56) text];
    v29 = [*(a1 + 56) subject];
    v30 = [(CKComposition *)v27 initWithText:v28 subject:v29 shelfPluginPayload:v46];

    [*(a1 + 48) setShareWasCreated:1];
    v31 = [*(a1 + 32) collaborationMetadata];
    [v31 checkSendReadiness];

    aBlock[0] = MEMORY[0x1E69E9820];
    aBlock[1] = 3221225472;
    aBlock[2] = __70__CKChatController_sendCompositionForPendingCollaboration_completion___block_invoke_2;
    aBlock[3] = &unk_1E72EDE00;
    v32 = v7;
    v33 = *(a1 + 48);
    v54 = v32;
    v55 = v33;
    v34 = v30;
    v56 = v34;
    v57 = *(a1 + 72);
    v35 = _Block_copy(aBlock);
    v36 = [*(a1 + 64) count];
    v37 = [v48 handleToIdentityMap];
    v38 = [v37 allKeys];
    v39 = [v38 count];

    v40 = v36 + 1;
    if (v39 == v36 + 1)
    {
      v35[2](v35);
    }

    else
    {
      if (IMOSLoggingEnabled())
      {
        v41 = OSLogHandleForIMFoundationCategory();
        if (os_log_type_enabled(v41, OS_LOG_TYPE_INFO))
        {
          *buf = 134218240;
          v62 = v40;
          v63 = 2048;
          v64 = v39;
          _os_log_impl(&dword_19020E000, v41, OS_LOG_TYPE_INFO, "Did not receive all participant identities from sociallayerd, alerting the user. Expected: %lu, actual: %lu", buf, 0x16u);
        }
      }

      if (v39 == 1)
      {
        v42 = 3;
      }

      else
      {
        v42 = 4;
      }

      v43 = [MEMORY[0x1E696ABC0] errorWithDomain:@"CKCollaborationErrorDomain" code:v42 userInfo:0];
      v44 = *(a1 + 48);
      v45 = *(a1 + 56);
      v49[0] = MEMORY[0x1E69E9820];
      v49[1] = 3221225472;
      v49[2] = __70__CKChatController_sendCompositionForPendingCollaboration_completion___block_invoke_1333;
      v49[3] = &unk_1E72EDE28;
      v52 = v42;
      v50 = *(a1 + 72);
      v51 = v35;
      [v44 presentCollaborationFailureAlertForComposition:v45 sharingURL:v32 error:v43 completion:v49];
    }

    v23 = v46;
  }

  else
  {
    if (IMOSLoggingEnabled())
    {
      v17 = OSLogHandleForIMFoundationCategory();
      if (os_log_type_enabled(v17, OS_LOG_TYPE_INFO))
      {
        *buf = 138412290;
        v62 = v47;
        _os_log_impl(&dword_19020E000, v17, OS_LOG_TYPE_INFO, "Received a nil shareURL when starting a pending collaboration. Error: %@", buf, 0xCu);
      }
    }

    v18 = *(a1 + 48);
    v19 = *(a1 + 56);
    v58[0] = MEMORY[0x1E69E9820];
    v58[1] = 3221225472;
    v58[2] = __70__CKChatController_sendCompositionForPendingCollaboration_completion___block_invoke_1331;
    v58[3] = &unk_1E72EDA90;
    v20 = *(a1 + 72);
    v21 = *(a1 + 48);
    v22 = *(a1 + 56);
    v60 = v20;
    v58[4] = v21;
    v59 = v22;
    [v18 presentCollaborationFailureAlertForComposition:v19 sharingURL:0 error:v47 completion:v58];

    v23 = v60;
  }

  [*(a1 + 48) disableSendButtonSpinner];
}

uint64_t __70__CKChatController_sendCompositionForPendingCollaboration_completion___block_invoke_1331(uint64_t a1, uint64_t a2)
{
  if (a2 == 1)
  {
    return [*(a1 + 32) sendCompositionForPendingCollaboration:*(a1 + 40) completion:*(a1 + 48)];
  }

  result = *(a1 + 48);
  if (result)
  {
    return (*(result + 16))(result, 0);
  }

  return result;
}

uint64_t __70__CKChatController_sendCompositionForPendingCollaboration_completion___block_invoke_2(uint64_t a1)
{
  v10 = *MEMORY[0x1E69E9840];
  if (IMOSLoggingEnabled())
  {
    v2 = OSLogHandleForIMFoundationCategory();
    if (os_log_type_enabled(v2, OS_LOG_TYPE_INFO))
    {
      v3 = *(a1 + 32);
      *buf = 138412290;
      v9 = v3;
      _os_log_impl(&dword_19020E000, v2, OS_LOG_TYPE_INFO, "Sending the final composition for pending conversation for share URL: %@", buf, 0xCu);
    }
  }

  [*(*(a1 + 40) + 1512) stopTimingForKey:@"sendGelato"];
  [*(*(a1 + 40) + 1512) totalTimeForKey:@"sendGelato"];
  [*(a1 + 40) sendAnalyticsForElapsedSendTimeForType:3 sharingURL:*(a1 + 32) timeInterval:?];
  if ([MEMORY[0x1E696AF00] isMainThread])
  {
    [*(a1 + 40) sendCollaborationCompositionAndSetSendingState:*(a1 + 48)];
  }

  else
  {
    v6[0] = MEMORY[0x1E69E9820];
    v6[1] = 3221225472;
    v6[2] = __70__CKChatController_sendCompositionForPendingCollaboration_completion___block_invoke_1332;
    v6[3] = &unk_1E72EB8D0;
    v4 = *(a1 + 48);
    v6[4] = *(a1 + 40);
    v7 = v4;
    dispatch_sync(MEMORY[0x1E69E96A0], v6);
  }

  result = *(a1 + 56);
  if (result)
  {
    return (*(result + 16))(result, 1);
  }

  return result;
}

uint64_t __70__CKChatController_sendCompositionForPendingCollaboration_completion___block_invoke_1333(void *a1)
{
  if (a1[6] != 3)
  {
    return (*(a1[5] + 16))();
  }

  result = a1[4];
  if (result)
  {
    return (*(result + 16))(result, 0);
  }

  return result;
}

uint64_t __70__CKChatController_sendCompositionForPendingCollaboration_completion___block_invoke_1335(uint64_t a1, uint64_t a2)
{
  if (a2 == 1)
  {
    return [*(a1 + 32) sendCompositionForPendingCollaboration:*(a1 + 40) completion:*(a1 + 48)];
  }

  result = *(a1 + 48);
  if (result)
  {
    return (*(result + 16))(result, 0);
  }

  return result;
}

uint64_t __70__CKChatController_sendCompositionForPendingCollaboration_completion___block_invoke_1337(uint64_t a1, uint64_t a2)
{
  if (a2 == 1)
  {
    return [*(a1 + 32) sendCompositionForPendingCollaboration:*(a1 + 40) completion:*(a1 + 48)];
  }

  result = *(a1 + 48);
  if (result)
  {
    return (*(result + 16))(result, 0);
  }

  return result;
}

- (void)sendCompositionForCloudKit:(id)kit completion:(id)completion
{
  kitCopy = kit;
  completionCopy = completion;
  shelfPluginPayload = [kitCopy shelfPluginPayload];
  cloudKitShare = [shelfPluginPayload cloudKitShare];
  if (cloudKitShare)
  {
    v10 = cloudKitShare;
    shelfPluginPayload2 = [kitCopy shelfPluginPayload];
    cloudKitShare2 = [shelfPluginPayload2 cloudKitShare];
    participants = [cloudKitShare2 participants];
    v14 = [participants count];

    if (v14 > 1)
    {
      if (IMOSLoggingEnabled())
      {
        v15 = OSLogHandleForIMFoundationCategory();
        if (os_log_type_enabled(v15, OS_LOG_TYPE_INFO))
        {
          *v19 = 0;
          _os_log_impl(&dword_19020E000, v15, OS_LOG_TYPE_INFO, "Updating collaboration composition for existing Cloud Kit Share.", v19, 2u);
        }
      }

      shelfPluginPayload3 = [kitCopy shelfPluginPayload];
      cloudKitShare3 = [shelfPluginPayload3 cloudKitShare];
      [(CKChatController *)self _updateAndSendCompositionForExistingCloudKitShare:kitCopy share:cloudKitShare3 completion:completionCopy];

      goto LABEL_14;
    }
  }

  else
  {
  }

  if (IMOSLoggingEnabled())
  {
    v18 = OSLogHandleForIMFoundationCategory();
    if (os_log_type_enabled(v18, OS_LOG_TYPE_INFO))
    {
      *buf = 0;
      _os_log_impl(&dword_19020E000, v18, OS_LOG_TYPE_INFO, "There is no existing share for the shareURL.", buf, 2u);
    }
  }

  [(CKChatController *)self _sendCompositionForNewCloudKitShare:kitCopy completion:completionCopy];
LABEL_14:
}

- (void)sendCompositionForCollaboration:(id)collaboration collaborationType:(int64_t)type completion:(id)completion
{
  v28 = *MEMORY[0x1E69E9840];
  collaborationCopy = collaboration;
  completionCopy = completion;
  aBlock[0] = MEMORY[0x1E69E9820];
  aBlock[1] = 3221225472;
  aBlock[2] = __81__CKChatController_sendCompositionForCollaboration_collaborationType_completion___block_invoke;
  aBlock[3] = &unk_1E72ED638;
  aBlock[4] = self;
  v10 = completionCopy;
  v25 = v10;
  v11 = _Block_copy(aBlock);
  if (IMOSLoggingEnabled())
  {
    v12 = OSLogHandleForIMFoundationCategory();
    if (os_log_type_enabled(v12, OS_LOG_TYPE_INFO))
    {
      *buf = 134217984;
      typeCopy = type;
      _os_log_impl(&dword_19020E000, v12, OS_LOG_TYPE_INFO, "Collaboration type switch: %ld", buf, 0xCu);
    }
  }

  v20[0] = MEMORY[0x1E69E9820];
  v20[1] = 3221225472;
  v20[2] = __81__CKChatController_sendCompositionForCollaboration_collaborationType_completion___block_invoke_1338;
  v20[3] = &unk_1E72EDE78;
  v20[4] = self;
  v21 = collaborationCopy;
  v22 = v11;
  typeCopy2 = type;
  v13 = v11;
  v14 = collaborationCopy;
  v15 = _Block_copy(v20);
  shelfPluginPayload = [v14 shelfPluginPayload];
  v18[0] = MEMORY[0x1E69E9820];
  v18[1] = 3221225472;
  v18[2] = __81__CKChatController_sendCompositionForCollaboration_collaborationType_completion___block_invoke_3;
  v18[3] = &unk_1E72ED638;
  v18[4] = self;
  v19 = v15;
  v17 = v15;
  [(CKChatController *)self _presentCollaborationAlertsIfNecessaryForPayload:shelfPluginPayload collaborationType:type sendBlock:v17 completionHandler:v18];
}

uint64_t __81__CKChatController_sendCompositionForCollaboration_collaborationType_completion___block_invoke(uint64_t a1)
{
  [*(a1 + 32) setIsSettingUpCollaboration:0];
  result = *(a1 + 40);
  if (result)
  {
    v3 = *(result + 16);

    return v3();
  }

  return result;
}

void __81__CKChatController_sendCompositionForCollaboration_collaborationType_completion___block_invoke_1338(uint64_t a1)
{
  v2 = [MEMORY[0x1E69A8070] sharedFeatureFlags];
  v3 = [v2 isGelatoAsyncSendingEnabled];

  v4 = *(a1 + 56);
  if (v3)
  {
    if ((v4 - 2) < 2)
    {
LABEL_5:
      [*(a1 + 32) setShareWasCreated:1];
      [*(a1 + 32) setIsSettingUpCollaboration:0];
      if ([MEMORY[0x1E696AF00] isMainThread])
      {
        [*(a1 + 32) sendCollaborationCompositionAndSetSendingState:*(a1 + 40)];
      }

      else
      {
        v16[0] = MEMORY[0x1E69E9820];
        v16[1] = 3221225472;
        v16[2] = __81__CKChatController_sendCompositionForCollaboration_collaborationType_completion___block_invoke_2;
        v16[3] = &unk_1E72EB8D0;
        v8 = *(a1 + 40);
        v16[4] = *(a1 + 32);
        v17 = v8;
        dispatch_sync(MEMORY[0x1E69E96A0], v16);
      }

      v9 = *(a1 + 48);
      if (v9)
      {
        (*(v9 + 16))(v9, 1);
      }

      return;
    }

    if (v4 != 1)
    {
      if (v4)
      {
        return;
      }

      goto LABEL_5;
    }

    goto LABEL_10;
  }

  switch(v4)
  {
    case 3:
      v13 = *(a1 + 32);
      v14 = *(a1 + 40);
      v15 = *(a1 + 48);

      [v13 sendCompositionForPendingCollaboration:v14 completion:v15];
      break;
    case 2:
      v10 = *(a1 + 32);
      v11 = *(a1 + 40);
      v12 = *(a1 + 48);

      [v10 sendCompositionForCloudKit:v11 completion:v12];
      break;
    case 1:
LABEL_10:
      v5 = *(a1 + 32);
      v6 = *(a1 + 40);
      v7 = *(a1 + 48);

      [v5 sendCompositionForFileProvider:v6 completion:v7];
      return;
    default:
      return;
  }
}

uint64_t __81__CKChatController_sendCompositionForCollaboration_collaborationType_completion___block_invoke_3(uint64_t result, char a2)
{
  if ((a2 & 1) == 0)
  {
    v2 = result;
    result = [*(result + 32) isSettingUpCollaboration];
    if ((result & 1) == 0)
    {
      [*(v2 + 32) setIsSettingUpCollaboration:1];
      v3 = *(*(v2 + 40) + 16);

      return v3();
    }
  }

  return result;
}

- (void)_presentCollaborationAlertsIfNecessaryForPayload:(id)payload collaborationType:(int64_t)type sendBlock:(id)block completionHandler:(id)handler
{
  payloadCopy = payload;
  blockCopy = block;
  handlerCopy = handler;
  if ([(CKChatController *)self _presentCollabInvalidFileProviderLocationAlertIfNecessaryForPayload:payloadCopy collaborationType:type])
  {
    handlerCopy[2](handlerCopy, 1);
  }

  else
  {
    [(CKChatController *)self _presentCollabAddToMessagesGroupAlertIfNecessary:payloadCopy collaborationType:type sendBlock:blockCopy completionHandler:handlerCopy];
  }
}

- (BOOL)_presentCollabInvalidFileProviderLocationAlertIfNecessaryForPayload:(id)payload collaborationType:(int64_t)type
{
  if (type != 1)
  {
    return 0;
  }

  v5 = MEMORY[0x1E69673B0];
  payloadCopy = payload;
  defaultManager = [v5 defaultManager];
  v8 = [payloadCopy url];

  v22 = 0;
  v9 = [defaultManager itemForURL:v8 error:&v22];
  v10 = v22;

  v11 = v9 == 0;
  if (!v9)
  {
    if (v10)
    {
      v12 = IMLogHandleForCategory();
      if (os_log_type_enabled(v12, OS_LOG_TYPE_ERROR))
      {
        [CKChatController _presentCollabInvalidFileProviderLocationAlertIfNecessaryForPayload:collaborationType:];
      }
    }

    v13 = CKFrameworkBundle();
    v14 = [v13 localizedStringForKey:@"ALERT_TITLE_COLLAB_INVALID_FILE_PROVIDER_LOCATION" value:&stru_1F04268F8 table:@"ChatKit"];

    v15 = CKFrameworkBundle();
    v16 = [v15 localizedStringForKey:@"ALERT_MESSAGE_COLLAB_INVALID_FILE_PROVIDER_LOCATION" value:&stru_1F04268F8 table:@"ChatKit"];

    v17 = CKFrameworkBundle();
    v18 = [v17 localizedStringForKey:@"OK" value:&stru_1F04268F8 table:@"ChatKit"];

    v19 = [CKAlertController alertControllerWithTitle:v14 message:v16 preferredStyle:CKIsRunningInMacCatalyst() != 0];
    v20 = [CKAlertAction actionWithTitle:v18 style:0 handler:&__block_literal_global_1346];
    [v19 addAction:v20];

    [v19 presentFromViewController:self animated:1 completion:0];
  }

  return v11;
}

- (void)_presentCollabAddToMessagesGroupAlertIfNecessary:(id)necessary collaborationType:(int64_t)type sendBlock:(id)block completionHandler:(id)handler
{
  necessaryCopy = necessary;
  blockCopy = block;
  handlerCopy = handler;
  conversation = [(CKCoreChatController *)self conversation];
  recipientCount = [conversation recipientCount];

  if (recipientCount < 2)
  {
    if (type == 1)
    {
      v15 = objc_alloc(MEMORY[0x1E6994900]);
      v16 = [necessaryCopy url];
      v17 = [v15 initWithFileURL:v16 documentType:*MEMORY[0x1E69638B8]];

      v19[0] = MEMORY[0x1E69E9820];
      v19[1] = 3221225472;
      v19[2] = __115__CKChatController__presentCollabAddToMessagesGroupAlertIfNecessary_collaborationType_sendBlock_completionHandler___block_invoke;
      v19[3] = &unk_1E72EDEC8;
      v19[4] = self;
      v20 = handlerCopy;
      v21 = blockCopy;
      [v17 setCopyShareURLCompletionBlock:v19];
      v18 = objc_alloc_init(MEMORY[0x1E696ADC8]);
      [v18 setMaxConcurrentOperationCount:1];
      [v18 addOperation:v17];
    }

    else
    {
      v17 = [necessaryCopy url];
      [(CKChatController *)self _presentCollabAddToMessagesGroupAlert:v17 sendBlock:blockCopy completionHandler:handlerCopy];
    }
  }

  else
  {
    (*(handlerCopy + 2))(handlerCopy, 0);
  }
}

void __115__CKChatController__presentCollabAddToMessagesGroupAlertIfNecessary_collaborationType_sendBlock_completionHandler___block_invoke(uint64_t a1, void *a2, void *a3)
{
  v5 = a2;
  v6 = a3;
  v7 = v6;
  if (!v5 || v6)
  {
    v8 = IMLogHandleForCategory();
    if (os_log_type_enabled(v8, OS_LOG_TYPE_ERROR))
    {
      __115__CKChatController__presentCollabAddToMessagesGroupAlertIfNecessary_collaborationType_sendBlock_completionHandler___block_invoke_cold_1();
    }

    (*(*(a1 + 40) + 16))();
  }

  else
  {
    v9[0] = MEMORY[0x1E69E9820];
    v9[1] = 3221225472;
    v9[2] = __115__CKChatController__presentCollabAddToMessagesGroupAlertIfNecessary_collaborationType_sendBlock_completionHandler___block_invoke_1348;
    v9[3] = &unk_1E72EDEA0;
    v9[4] = *(a1 + 32);
    v10 = v5;
    v11 = *(a1 + 48);
    v12 = *(a1 + 40);
    dispatch_async(MEMORY[0x1E69E96A0], v9);
  }
}

- (void)_presentCollabAddToMessagesGroupAlert:(id)alert sendBlock:(id)block completionHandler:(id)handler
{
  v68 = *MEMORY[0x1E69E9840];
  alertCopy = alert;
  blockCopy = block;
  handlerCopy = handler;
  v49 = alertCopy;
  if (alertCopy)
  {
    selfCopy = self;
    v51 = [(CKChatController *)self _groupConversationContainingSharedURL:alertCopy];
    if (v51)
    {
      if (IMOSLoggingEnabled())
      {
        v9 = OSLogHandleForIMFoundationCategory();
        if (os_log_type_enabled(v9, OS_LOG_TYPE_INFO))
        {
          chat = [v51 chat];
          chatIdentifier = [chat chatIdentifier];
          *buf = 138412290;
          v67 = chatIdentifier;
          _os_log_impl(&dword_19020E000, v9, OS_LOG_TYPE_INFO, "Presenting Group Collaboration alert for chat identifier: %@", buf, 0xCu);
        }
      }

      v63 = 0u;
      v64 = 0u;
      v61 = 0u;
      v62 = 0u;
      obj = [v51 recipients];
      v12 = [obj countByEnumeratingWithState:&v61 objects:v65 count:16];
      if (v12)
      {
        v13 = *v62;
        while (2)
        {
          for (i = 0; i != v12; ++i)
          {
            if (*v62 != v13)
            {
              objc_enumerationMutation(obj);
            }

            defaultIMHandle = [*(*(&v61 + 1) + 8 * i) defaultIMHandle];
            v16 = [defaultIMHandle ID];
            conversation = [(CKCoreChatController *)selfCopy conversation];
            recipient = [conversation recipient];
            defaultIMHandle2 = [recipient defaultIMHandle];
            v20 = [defaultIMHandle2 ID];
            v21 = [v16 isEqualToString:v20];

            if (v21)
            {
              if (IMOSLoggingEnabled())
              {
                v48 = OSLogHandleForIMFoundationCategory();
                if (os_log_type_enabled(v48, OS_LOG_TYPE_INFO))
                {
                  *buf = 0;
                  _os_log_impl(&dword_19020E000, v48, OS_LOG_TYPE_INFO, "Recipient is already part of group conversation, sending separately", buf, 2u);
                }
              }

              goto LABEL_34;
            }
          }

          v12 = [obj countByEnumeratingWithState:&v61 objects:v65 count:16];
          if (v12)
          {
            continue;
          }

          break;
        }
      }

      conversation2 = [(CKCoreChatController *)selfCopy conversation];
      recipient2 = [conversation2 recipient];
      name = [recipient2 name];

      displayName = [v51 displayName];
      if (!displayName)
      {
        displayName = [v51 name];
      }

      v26 = CKIsRunningInMacCatalyst() == 0;
      v27 = MEMORY[0x1E696AEC0];
      v28 = CKFrameworkBundle();
      v29 = v28;
      if (v26)
      {
        v30 = @"ALERT_TITLE_ADD_TO_EXISTING_GROUP_CONVERSATION_IOS";
      }

      else
      {
        v30 = @"ALERT_TITLE_ADD_TO_EXISTING_GROUP_CONVERSATION_MAC";
      }

      v31 = [v28 localizedStringForKey:v30 value:&stru_1F04268F8 table:@"ChatKit"];
      v32 = [v27 stringWithFormat:v31, name, displayName, v49];

      mEMORY[0x1E69DC668] = [MEMORY[0x1E69DC668] sharedApplication];
      v34 = [mEMORY[0x1E69DC668] userInterfaceLayoutDirection] == 1;

      if (v34)
      {
        v35 = @"\u200F";
      }

      else
      {
        v35 = @"\u200E";
      }

      obja = [(__CFString *)v35 stringByAppendingString:v32];

      v36 = CKFrameworkBundle();
      v37 = [v36 localizedStringForKey:@"ALERT_ACTION_ADD_TO_GROUP" value:&stru_1F04268F8 table:@"ChatKit"];

      v38 = CKFrameworkBundle();
      v39 = [v38 localizedStringForKey:@"ALERT_ACTION_SHARE_WITH_PARTICIPANT_ONLY" value:&stru_1F04268F8 table:@"ChatKit"];

      v40 = [CKAlertController alertControllerWithTitle:obja message:0 preferredStyle:CKIsRunningInMacCatalyst() != 0];
      v58[0] = MEMORY[0x1E69E9820];
      v58[1] = 3221225472;
      v58[2] = __86__CKChatController__presentCollabAddToMessagesGroupAlert_sendBlock_completionHandler___block_invoke;
      v58[3] = &unk_1E72EDEF0;
      v58[4] = selfCopy;
      v59 = v51;
      v41 = blockCopy;
      v60 = v41;
      v42 = [CKAlertAction actionWithTitle:v37 style:0 handler:v58];
      [v40 addAction:v42];

      v56[0] = MEMORY[0x1E69E9820];
      v56[1] = 3221225472;
      v56[2] = __86__CKChatController__presentCollabAddToMessagesGroupAlert_sendBlock_completionHandler___block_invoke_1363;
      v56[3] = &unk_1E72EC218;
      v57 = v41;
      v43 = [CKAlertAction actionWithTitle:v39 style:0 handler:v56];
      [v40 addAction:v43];

      v44 = CKFrameworkBundle();
      v45 = [v44 localizedStringForKey:@"CANCEL" value:&stru_1F04268F8 table:@"ChatKit"];
      v46 = [CKAlertAction actionWithTitle:v45 style:1 handler:&__block_literal_global_1366];
      [v40 addAction:v46];

      [v40 presentFromViewController:selfCopy animated:1 completion:0];
      handlerCopy[2](handlerCopy, 1);
    }

    else
    {
LABEL_34:
      handlerCopy[2](handlerCopy, 0);
    }
  }

  else
  {
    if (IMOSLoggingEnabled())
    {
      v47 = OSLogHandleForIMFoundationCategory();
      if (os_log_type_enabled(v47, OS_LOG_TYPE_INFO))
      {
        *buf = 0;
        _os_log_impl(&dword_19020E000, v47, OS_LOG_TYPE_INFO, "Can't find a group conversation, URL is nil", buf, 2u);
      }
    }

    handlerCopy[2](handlerCopy, 0);
  }
}

void __86__CKChatController__presentCollabAddToMessagesGroupAlert_sendBlock_completionHandler___block_invoke(uint64_t a1, void *a2)
{
  v17[1] = *MEMORY[0x1E69E9840];
  v3 = a2;
  if (IMOSLoggingEnabled())
  {
    v4 = OSLogHandleForIMFoundationCategory();
    if (os_log_type_enabled(v4, OS_LOG_TYPE_INFO))
    {
      LOWORD(v15) = 0;
      _os_log_impl(&dword_19020E000, v4, OS_LOG_TYPE_INFO, "Add to group and share with recipient", &v15, 2u);
    }
  }

  v5 = [*(a1 + 32) conversation];
  v6 = [v5 recipient];

  v7 = [v6 rawAddress];
  v8 = [*(a1 + 32) conversation];
  v9 = [v8 chat];
  v10 = [v9 account];
  v11 = [v10 imHandleWithID:v7 alreadyCanonical:0];

  if (v11)
  {
    [*(a1 + 32) setConversation:*(a1 + 40)];
    v12 = [*(a1 + 32) conversation];
    v17[0] = v11;
    v13 = [MEMORY[0x1E695DEC8] arrayWithObjects:v17 count:1];
    [v12 addRecipientHandles:v13];

    (*(*(a1 + 48) + 16))();
  }

  else if (IMOSLoggingEnabled())
  {
    v14 = OSLogHandleForIMFoundationCategory();
    if (os_log_type_enabled(v14, OS_LOG_TYPE_INFO))
    {
      v15 = 138412290;
      v16 = v6;
      _os_log_impl(&dword_19020E000, v14, OS_LOG_TYPE_INFO, "CKChatController_Collaboration: Couldn't get handle from recipient: %@", &v15, 0xCu);
    }
  }
}

void __86__CKChatController__presentCollabAddToMessagesGroupAlert_sendBlock_completionHandler___block_invoke_1363(uint64_t a1, void *a2)
{
  v3 = a2;
  if (IMOSLoggingEnabled())
  {
    v4 = OSLogHandleForIMFoundationCategory();
    if (os_log_type_enabled(v4, OS_LOG_TYPE_INFO))
    {
      *v5 = 0;
      _os_log_impl(&dword_19020E000, v4, OS_LOG_TYPE_INFO, "Share with recipient only", v5, 2u);
    }
  }

  (*(*(a1 + 32) + 16))();
}

void __86__CKChatController__presentCollabAddToMessagesGroupAlert_sendBlock_completionHandler___block_invoke_1364(uint64_t a1, void *a2)
{
  v2 = a2;
  if (IMOSLoggingEnabled())
  {
    v3 = OSLogHandleForIMFoundationCategory();
    if (os_log_type_enabled(v3, OS_LOG_TYPE_INFO))
    {
      *v4 = 0;
      _os_log_impl(&dword_19020E000, v3, OS_LOG_TYPE_INFO, "Cancel", v4, 2u);
    }
  }
}

- (id)_groupConversationContainingSharedURL:(id)l
{
  v32 = *MEMORY[0x1E69E9840];
  lCopy = l;
  if (lCopy)
  {
    mEMORY[0x1E69A5C78] = [MEMORY[0x1E69A5C78] sharedController];
    v26 = 0;
    v5 = [mEMORY[0x1E69A5C78] collaborationHighlightForURL:lCopy error:&v26];
    v6 = v26;

    if (v6 || !v5)
    {
      if (IMOSLoggingEnabled())
      {
        v17 = OSLogHandleForIMFoundationCategory();
        if (os_log_type_enabled(v17, OS_LOG_TYPE_INFO))
        {
          localizedDescription = [v6 localizedDescription];
          *buf = 138412546;
          v29 = v5;
          v30 = 2112;
          v31 = localizedDescription;
          _os_log_impl(&dword_19020E000, v17, OS_LOG_TYPE_INFO, "Could not get collaboration highlight: %@ with error: %@", buf, 0x16u);
        }
      }

      v9 = 0;
      v10 = 0;
    }

    else
    {
      mEMORY[0x1E69A5C78]2 = [MEMORY[0x1E69A5C78] sharedController];
      v21 = [mEMORY[0x1E69A5C78]2 fetchAttributionsForHighlight:v5];

      v24 = 0u;
      v25 = 0u;
      v22 = 0u;
      v23 = 0u;
      attributions = [v21 attributions];
      v9 = 0;
      v10 = [attributions countByEnumeratingWithState:&v22 objects:v27 count:16];
      if (v10)
      {
        v11 = 0;
        v12 = *v23;
        while (2)
        {
          for (i = 0; i != v10; i = i + 1)
          {
            if (*v23 != v12)
            {
              objc_enumerationMutation(attributions);
            }

            v14 = *(*(&v22 + 1) + 8 * i);
            if ([v14 isGroupConversation])
            {
              conversationIdentifier = [v14 conversationIdentifier];

              if (v11 >= 1)
              {
                if (IMOSLoggingEnabled())
                {
                  v19 = OSLogHandleForIMFoundationCategory();
                  if (os_log_type_enabled(v19, OS_LOG_TYPE_INFO))
                  {
                    *buf = 0;
                    _os_log_impl(&dword_19020E000, v19, OS_LOG_TYPE_INFO, "Found more than 1 group where the url is shared, not returning a conversation", buf, 2u);
                  }
                }

                v9 = 0;
                v10 = 0;
                goto LABEL_31;
              }

              ++v11;
              v9 = conversationIdentifier;
            }
          }

          v10 = [attributions countByEnumeratingWithState:&v22 objects:v27 count:16];
          if (v10)
          {
            continue;
          }

          break;
        }

        if (v9)
        {
          attributions = +[CKConversationList sharedConversationList];
          v10 = [attributions conversationForExistingChatWithGUID:v9];
          goto LABEL_31;
        }

        v10 = 0;
      }

      else
      {
LABEL_31:
      }
    }
  }

  else
  {
    if (IMOSLoggingEnabled())
    {
      v16 = OSLogHandleForIMFoundationCategory();
      if (os_log_type_enabled(v16, OS_LOG_TYPE_INFO))
      {
        *buf = 0;
        _os_log_impl(&dword_19020E000, v16, OS_LOG_TYPE_INFO, "No URL provided", buf, 2u);
      }
    }

    v10 = 0;
  }

  return v10;
}

- (void)_validateAndSendComposition:(id)composition completion:(id)completion
{
  v70 = *MEMORY[0x1E69E9840];
  compositionCopy = composition;
  completionCopy = completion;
  defaultCenter = [MEMORY[0x1E696AD88] defaultCenter];
  [defaultCenter addObserver:self selector:sel__passKitUIDismissed_ name:@"CKPluginExtensionStateObserverPassKitUIDismissed" object:0];

  shelfPluginPayload = [compositionCopy shelfPluginPayload];
  v10 = [(CKChatController *)self _shouldValidatePayloadBeforeSendingPayload:shelfPluginPayload];
  sendAsCopy = [shelfPluginPayload sendAsCopy];
  if ([shelfPluginPayload supportsCollaboration] && (sendAsCopy & 1) == 0)
  {
    [(CKChatController *)self enableSendButtonSpinner];
    if (IMOSLoggingEnabled())
    {
      v12 = OSLogHandleForIMFoundationCategory();
      if (os_log_type_enabled(v12, OS_LOG_TYPE_INFO))
      {
        *buf = 134217984;
        payloadCollaborationType = [shelfPluginPayload payloadCollaborationType];
        _os_log_impl(&dword_19020E000, v12, OS_LOG_TYPE_INFO, "Sending collaboration item for type %ld", buf, 0xCu);
      }
    }

    -[CKChatController sendCompositionForCollaboration:collaborationType:completion:](self, "sendCompositionForCollaboration:collaborationType:completion:", compositionCopy, [shelfPluginPayload payloadCollaborationType], completionCopy);
    goto LABEL_40;
  }

  if (v10)
  {
    if (IMOSLoggingEnabled())
    {
      v13 = OSLogHandleForIMFoundationCategory();
      if (os_log_type_enabled(v13, OS_LOG_TYPE_INFO))
      {
        *buf = 0;
        _os_log_impl(&dword_19020E000, v13, OS_LOG_TYPE_INFO, "Validating shelf plugin payload", buf, 2u);
      }
    }

    v14 = shelfPluginPayload;
    v15 = +[CKBalloonPluginManager sharedInstance];
    pluginBundleID = [v14 pluginBundleID];
    datasource = [v14 datasource];
    v57 = [v15 newViewControllerForPluginIdentifier:pluginBundleID dataSource:datasource];

    text = [compositionCopy text];
    string = [text string];

    v19 = [string stringByReplacingOccurrencesOfString:*MEMORY[0x1E69A5F00] withString:&stru_1F04268F8];
    v53 = [v19 stringByReplacingOccurrencesOfString:*MEMORY[0x1E69A5F20] withString:&stru_1F04268F8];

    if (objc_opt_respondsToSelector())
    {
      conversation = [(CKCoreChatController *)self conversation];
      senderIdentifier = [conversation senderIdentifier];
      [v57 setSender:senderIdentifier];
    }

    if (objc_opt_respondsToSelector())
    {
      conversation2 = [(CKCoreChatController *)self conversation];
      recipientStrings = [conversation2 recipientStrings];

      [v57 setRecipients:recipientStrings];
    }

    [(CKChatController *)self enableSendButtonSpinner];
    entryView = [(CKChatController *)self entryView];
    contentView = [entryView contentView];
    [contentView setClearPluginButtonEnabled:0];

    aBlock[0] = MEMORY[0x1E69E9820];
    aBlock[1] = 3221225472;
    aBlock[2] = __59__CKChatController__validateAndSendComposition_completion___block_invoke;
    aBlock[3] = &unk_1E72EDF68;
    aBlock[4] = self;
    v65 = compositionCopy;
    v67 = completionCopy;
    v26 = v14;
    v66 = v26;
    v27 = _Block_copy(aBlock);
    entryView2 = [(CKChatController *)self entryView];
    contentView2 = [entryView2 contentView];
    pluginEntryViewController = [contentView2 pluginEntryViewController];
    if (pluginEntryViewController)
    {
      liveEditableInEntryView = [v26 liveEditableInEntryView];

      if (liveEditableInEntryView)
      {
        if ([(CKScrollViewController *)self isKeyboardVisible])
        {
          [(CKChatController *)self setTargetFirstResponder:1];
          [(CKChatController *)self becomeFirstResponder];
        }

        entryView3 = [(CKChatController *)self entryView];
        contentView3 = [entryView3 contentView];
        pluginEntryViewController2 = [contentView3 pluginEntryViewController];
        v61[0] = MEMORY[0x1E69E9820];
        v61[1] = 3221225472;
        v61[2] = __59__CKChatController__validateAndSendComposition_completion___block_invoke_2_1375;
        v61[3] = &unk_1E72EDF90;
        v62 = v57;
        v63 = v27;
        v35 = v27;
        [pluginEntryViewController2 fetchInternalMessageStateForDraft:0 completion:v61];

        v36 = &v62;
        goto LABEL_39;
      }
    }

    else
    {
    }

    v59[0] = MEMORY[0x1E69E9820];
    v59[1] = 3221225472;
    v59[2] = __59__CKChatController__validateAndSendComposition_completion___block_invoke_3;
    v59[3] = &unk_1E72EDFB8;
    v60 = v27;
    v52 = v27;
    [v57 validatePayloadForSending:v26 associatedText:v53 completionHandler:v59];
    v36 = &v60;
LABEL_39:

    goto LABEL_40;
  }

  if (sendAsCopy && [shelfPluginPayload payloadCollaborationType] == 2)
  {
    [compositionCopy cleanupCKShareFromComposition];
  }

  v37 = compositionCopy;
  sendAsCopyURL = [shelfPluginPayload sendAsCopyURL];
  if (sendAsCopyURL)
  {
    sendAsCopy2 = [shelfPluginPayload sendAsCopy];

    if (sendAsCopy2)
    {
      sendAsCopyURL2 = [shelfPluginPayload sendAsCopyURL];
      [shelfPluginPayload setUrl:sendAsCopyURL2];

      v41 = [CKComposition alloc];
      text2 = [v37 text];
      subject = [v37 subject];
      translation = [v37 translation];
      bizIntent = [v37 bizIntent];
      shelfMediaObject = [v37 shelfMediaObject];
      proofreadingInfo = [v37 proofreadingInfo];
      v54 = completionCopy;
      v46 = [(CKComposition *)v41 initWithText:text2 subject:subject translation:translation shelfPluginPayload:shelfPluginPayload bizIntent:bizIntent shelfMediaObject:shelfMediaObject proofreadingInfo:proofreadingInfo];

      v37 = v46;
      completionCopy = v54;
    }
  }

  mEMORY[0x1E69A8070] = [MEMORY[0x1E69A8070] sharedFeatureFlags];
  isExpressiveTextEnabled = [mEMORY[0x1E69A8070] isExpressiveTextEnabled];

  if (isExpressiveTextEnabled)
  {
    entryView4 = [(CKChatController *)self entryView];
    contentView4 = [entryView4 contentView];
    [contentView4 prepareTextEffectsForImmediateMessageSend];
  }

  if (IMOSLoggingEnabled())
  {
    v51 = OSLogHandleForIMFoundationCategory();
    if (os_log_type_enabled(v51, OS_LOG_TYPE_INFO))
    {
      *buf = 0;
      _os_log_impl(&dword_19020E000, v51, OS_LOG_TYPE_INFO, "Sending composition if allowed", buf, 2u);
    }
  }

  [(CKChatController *)self sendCompositionIfAllowed:v37];
  if (completionCopy)
  {
    (*(completionCopy + 2))(completionCopy, 1);
  }

LABEL_40:
}

void __59__CKChatController__validateAndSendComposition_completion___block_invoke(uint64_t a1, char a2, void *a3, void *a4)
{
  v7 = a3;
  v8 = a4;
  block[0] = MEMORY[0x1E69E9820];
  block[1] = 3221225472;
  block[2] = __59__CKChatController__validateAndSendComposition_completion___block_invoke_2;
  block[3] = &unk_1E72EDF40;
  v20 = a2;
  v16 = v7;
  v17 = v8;
  v14 = *(a1 + 32);
  v9 = *(&v14 + 1);
  v10 = *(a1 + 56);
  *&v11 = *(a1 + 48);
  *(&v11 + 1) = v10;
  v18 = v14;
  v19 = v11;
  v12 = v8;
  v13 = v7;
  dispatch_async(MEMORY[0x1E69E96A0], block);
}

void __59__CKChatController__validateAndSendComposition_completion___block_invoke_2(uint64_t a1)
{
  v45 = *MEMORY[0x1E69E9840];
  if (IMOSLoggingEnabled())
  {
    v2 = OSLogHandleForIMFoundationCategory();
    if (os_log_type_enabled(v2, OS_LOG_TYPE_INFO))
    {
      v3 = *(a1 + 32);
      v4 = [MEMORY[0x1E696AD98] numberWithBool:*(a1 + 80)];
      v5 = *(a1 + 40);
      *buf = 138412802;
      v38 = v3;
      v39 = 2112;
      v40 = v4;
      v41 = 2112;
      v42 = v5;
      _os_log_impl(&dword_19020E000, v2, OS_LOG_TYPE_INFO, "Received payload validation for payload %@. shouldSend %@. localizedInvalidationDescription %@", buf, 0x20u);
    }
  }

  [*(a1 + 48) disableSendButtonSpinner];
  v6 = [*(a1 + 48) entryView];
  v7 = [v6 contentView];
  [v7 setClearPluginButtonEnabled:1];

  if (*(a1 + 80) == 1)
  {
    aBlock[0] = MEMORY[0x1E69E9820];
    aBlock[1] = 3221225472;
    aBlock[2] = __59__CKChatController__validateAndSendComposition_completion___block_invoke_1370;
    aBlock[3] = &unk_1E72EDE00;
    v33 = *(a1 + 32);
    v8 = *(a1 + 56);
    v9 = *(a1 + 48);
    v34 = v8;
    v35 = v9;
    v36 = *(a1 + 72);
    v10 = _Block_copy(aBlock);
    v11 = [*(a1 + 32) pluginBundleID];
    v12 = IMBalloonExtensionIDWithSuffix();
    v13 = [v11 isEqualToString:v12];

    if (IMOSLoggingEnabled())
    {
      v14 = OSLogHandleForIMFoundationCategory();
      if (os_log_type_enabled(v14, OS_LOG_TYPE_INFO))
      {
        v15 = *(a1 + 32);
        v16 = _Block_copy(v10);
        v17 = MEMORY[0x1E696AD98];
        v18 = +[CKPluginExtensionStateObserver sharedInstance];
        v19 = [v17 numberWithBool:{objc_msgSend(v18, "passKitUIPresented")}];
        v20 = [MEMORY[0x1E696AD98] numberWithBool:v13];
        *buf = 138413058;
        v38 = v15;
        v39 = 2112;
        v40 = v16;
        v41 = 2112;
        v42 = v19;
        v43 = 2112;
        v44 = v20;
        _os_log_impl(&dword_19020E000, v14, OS_LOG_TYPE_INFO, "Preparing for send after payload validation. payload %@. sendBlock %@. passKitUIPresented %@. isSurf:%@", buf, 0x2Au);
      }
    }

    v21 = +[CKPluginExtensionStateObserver sharedInstance];
    v22 = [v21 passKitUIPresented];

    if (v22 & v13)
    {
      if (IMOSLoggingEnabled())
      {
        v23 = OSLogHandleForIMFoundationCategory();
        if (os_log_type_enabled(v23, OS_LOG_TYPE_INFO))
        {
          *buf = 0;
          _os_log_impl(&dword_19020E000, v23, OS_LOG_TYPE_INFO, "setting deferred send animation block", buf, 2u);
        }
      }

      [*(a1 + 48) setDeferredSendAnimationBlock:v10];
    }

    else
    {
      v10[2](v10);
    }
  }

  else
  {
    v24 = *(a1 + 40) == 0;
    v25 = IMOSLoggingEnabled();
    if (v24)
    {
      if (v25)
      {
        v30 = OSLogHandleForIMFoundationCategory();
        if (os_log_type_enabled(v30, OS_LOG_TYPE_INFO))
        {
          *buf = 0;
          _os_log_impl(&dword_19020E000, v30, OS_LOG_TYPE_INFO, "We should not send this message, restoring the entry view.", buf, 2u);
        }
      }

      block[0] = MEMORY[0x1E69E9820];
      block[1] = 3221225472;
      block[2] = __59__CKChatController__validateAndSendComposition_completion___block_invoke_1373;
      block[3] = &unk_1E72EBA18;
      block[4] = *(a1 + 48);
      dispatch_async(MEMORY[0x1E69E96A0], block);
    }

    else
    {
      if (v25)
      {
        v26 = OSLogHandleForIMFoundationCategory();
        if (os_log_type_enabled(v26, OS_LOG_TYPE_INFO))
        {
          v27 = [*(a1 + 64) pluginBundleID];
          v28 = *(a1 + 64);
          v29 = *(a1 + 40);
          *buf = 138412802;
          v38 = v27;
          v39 = 2112;
          v40 = v28;
          v41 = 2112;
          v42 = v29;
          _os_log_impl(&dword_19020E000, v26, OS_LOG_TYPE_INFO, "Payload validation from plugin %@ for payload (%@) failed. reason %@", buf, 0x20u);
        }
      }

      [*(a1 + 48) showPayloadValidationAlertWithDescription:*(a1 + 40)];
    }
  }
}

void __59__CKChatController__validateAndSendComposition_completion___block_invoke_1370(uint64_t a1)
{
  v6[0] = MEMORY[0x1E69E9820];
  v6[1] = 3221225472;
  v6[2] = __59__CKChatController__validateAndSendComposition_completion___block_invoke_2_1371;
  v6[3] = &unk_1E72EDF18;
  v2 = *(a1 + 32);
  v3 = *(a1 + 40);
  v4 = *(a1 + 48);
  v5 = *(a1 + 56);
  v7 = v3;
  v8 = v4;
  v9 = v5;
  [CKComposition compositionWithShelfPluginPayload:v2 completionHandler:v6];
}

void __59__CKChatController__validateAndSendComposition_completion___block_invoke_2_1371(uint64_t a1, uint64_t a2)
{
  v4 = [*(a1 + 32) compositionByAppendingComposition:a2];
  [*(a1 + 40) sendCompositionIfAllowed:?];
  v3 = *(a1 + 48);
  if (v3)
  {
    (*(v3 + 16))(v3, 1);
  }
}

void __59__CKChatController__validateAndSendComposition_completion___block_invoke_1373(uint64_t a1)
{
  v1 = [*(a1 + 32) entryView];
  [v1 updateEntryView];
}

void __59__CKChatController__validateAndSendComposition_completion___block_invoke_2_1375(uint64_t a1, uint64_t a2)
{
  v3 = [*(a1 + 32) _itemPayloadFromMSMessage:a2];
  (*(*(a1 + 40) + 16))();
}

- (void)showPayloadValidationAlertWithDescription:(id)description
{
  v4 = [MEMORY[0x1E69DC650] alertControllerWithTitle:0 message:description preferredStyle:1];
  v5 = MEMORY[0x1E69DC648];
  v6 = CKFrameworkBundle();
  v7 = [v6 localizedStringForKey:@"OK" value:&stru_1F04268F8 table:@"ChatKit"];
  v9[0] = MEMORY[0x1E69E9820];
  v9[1] = 3221225472;
  v9[2] = __62__CKChatController_showPayloadValidationAlertWithDescription___block_invoke;
  v9[3] = &unk_1E72EBFE8;
  v9[4] = self;
  v8 = [v5 actionWithTitle:v7 style:0 handler:v9];
  [v4 addAction:v8];

  [(CKChatController *)self presentViewController:v4 animated:1 completion:0];
}

- (void)_handleDictationStarted:(id)started
{
  [(CKChatController *)self setShouldShowAudioButtonInEntryView:0];

  [(CKChatController *)self _updateEntryViewFrameIfNeeded:1];
}

- (void)setShouldShowAudioButtonInEntryView:(BOOL)view
{
  viewCopy = view;
  conversation = [(CKCoreChatController *)self conversation];
  chat = [conversation chat];
  [chat setShouldShowAudioButtonInEntryView:viewCopy];
}

- (void)sendCompositionIfAllowed:(id)allowed
{
  allowedCopy = allowed;
  objc_opt_class();
  if (objc_opt_isKindOfClass())
  {
    [(CKChatController *)self setShouldShowAudioButtonInEntryView:1];
  }

  if (IMOSLoggingEnabled())
  {
    v5 = OSLogHandleForIMFoundationCategory();
    if (os_log_type_enabled(v5, OS_LOG_TYPE_INFO))
    {
      *buf = 0;
      _os_log_impl(&dword_19020E000, v5, OS_LOG_TYPE_INFO, "Checking for sensitive content if necessary", buf, 2u);
    }
  }

  v7[0] = MEMORY[0x1E69E9820];
  v7[1] = 3221225472;
  v7[2] = __45__CKChatController_sendCompositionIfAllowed___block_invoke;
  v7[3] = &unk_1E72EBA18;
  v7[4] = self;
  v6[0] = MEMORY[0x1E69E9820];
  v6[1] = 3221225472;
  v6[2] = __45__CKChatController_sendCompositionIfAllowed___block_invoke_2;
  v6[3] = &unk_1E72ED6D8;
  v6[4] = self;
  [(CKCoreChatController *)self checkForSensitiveContentAndSendComposition:allowedCopy willPresentInterventionHandler:v7 sendHandler:v6];
}

uint64_t __45__CKChatController_sendCompositionIfAllowed___block_invoke(uint64_t a1)
{
  result = [*(a1 + 32) effectPickerIsPresented];
  if (result)
  {
    v3 = *(a1 + 32);

    return [v3 dismissEffectPickerAnimated:1];
  }

  return result;
}

void __45__CKChatController_sendCompositionIfAllowed___block_invoke_2(uint64_t a1, void *a2)
{
  v3 = a2;
  if (IMOSLoggingEnabled())
  {
    v4 = OSLogHandleForIMFoundationCategory();
    if (os_log_type_enabled(v4, OS_LOG_TYPE_INFO))
    {
      *v5 = 0;
      _os_log_impl(&dword_19020E000, v4, OS_LOG_TYPE_INFO, "Checking composition that has been checked for sensitive content", v5, 2u);
    }
  }

  [*(a1 + 32) sendComposition:v3];
}

- (void)handleStickerTapbackConfirmCommSafetySendContext:(id)context
{
  contextCopy = context;
  stickerTapback = [contextCopy stickerTapback];
  parentMessagePartChatItem = [contextCopy parentMessagePartChatItem];

  chat = [(CKCoreChatController *)self chat];
  [chat sendTapback:stickerTapback forChatItem:parentMessagePartChatItem];
}

- (void)handleAutomaticallyPlacedStickerCommSafetySendContext:(id)context
{
  contextCopy = context;
  sticker = [contextCopy sticker];
  stickerReactionSession = [contextCopy stickerReactionSession];
  chatItem = [contextCopy chatItem];
  parentChatItem = [contextCopy parentChatItem];
  [contextCopy stickerFrame];
  v9 = v8;
  v11 = v10;
  v13 = v12;
  v15 = v14;
  animationCompletionHandler = [contextCopy animationCompletionHandler];

  [(CKChatController *)self _sendAutomaticallyPlacedSticker:sticker stickerReactionSession:stickerReactionSession forChatItem:chatItem forParentChatItem:parentChatItem stickerFrame:animationCompletionHandler animationCompletionHandler:v9, v11, v13, v15];
}

- (void)clearStagedSensitiveContentUsingContextDictionary:(id)dictionary
{
  v31 = *MEMORY[0x1E69E9840];
  dictionaryCopy = dictionary;
  v5 = [dictionaryCopy objectForKey:@"CKCommSafetyContextKeyiOSSend"];
  composition = [v5 composition];
  sensitiveMediaObjects = [v5 sensitiveMediaObjects];
  identifiersOfShelvedImages = [v5 identifiersOfShelvedImages];
  if ([sensitiveMediaObjects count])
  {
    v9 = [composition compositionByRemovingMediaObjects:sensitiveMediaObjects];
    shelfPluginPayload = [v9 shelfPluginPayload];
    if (shelfPluginPayload)
    {
      shelfMediaObject = [composition shelfMediaObject];
      v12 = [sensitiveMediaObjects containsObject:shelfMediaObject];

      if (v12)
      {
        v25 = [CKComposition alloc];
        text = [v9 text];
        subject = [v9 subject];
        translation = [v9 translation];
        bizIntent = [v9 bizIntent];
        proofreadingInfo = [v9 proofreadingInfo];
        v16 = [(CKComposition *)v25 initWithText:text subject:subject translation:translation shelfPluginPayload:0 bizIntent:bizIntent shelfMediaObject:0 proofreadingInfo:proofreadingInfo];
        v26 = dictionaryCopy;
        v17 = v16;

        v9 = v17;
        dictionaryCopy = v26;
      }
    }

    [(CKChatController *)self setComposition:v9];
  }

  inputController = [(CKCoreChatController *)self inputController];
  [inputController requestPhotoBrowserToUnstageImages:identifiersOfShelvedImages];

  if (IMOSLoggingEnabled())
  {
    v19 = OSLogHandleForIMFoundationCategory();
    if (os_log_type_enabled(v19, OS_LOG_TYPE_INFO))
    {
      conversation = [(CKCoreChatController *)self conversation];
      chat = [conversation chat];
      chatIdentifier = [chat chatIdentifier];
      *buf = 138412546;
      v28 = composition;
      v29 = 2112;
      v30 = chatIdentifier;
      _os_log_impl(&dword_19020E000, v19, OS_LOG_TYPE_INFO, "Not sending composition %@ for chat %@ since composition flagged as sensitive and user clicked Don't Send", buf, 0x16u);
    }
  }
}

- (id)mediaObjectsFromComposition:(id)composition
{
  compositionCopy = composition;
  mediaObjects = [compositionCopy mediaObjects];
  v5 = [mediaObjects mutableCopy];

  shelfPluginPayload = [compositionCopy shelfPluginPayload];
  objc_opt_class();
  if (objc_opt_isKindOfClass())
  {
    v7 = shelfPluginPayload;
  }

  else
  {
    v7 = 0;
  }

  v8 = v7;
  v9 = v8;
  if (v8)
  {
    if ([v8 payloadCollaborationType] == 1 && objc_msgSend(v9, "sendAsCopy") && (objc_msgSend(compositionCopy, "shelfMediaObject"), v10 = objc_claimAutoreleasedReturnValue(), v10, v10))
    {
      shelfMediaObject = [compositionCopy shelfMediaObject];
    }

    else
    {
      mediaObjectFromPayload = [v9 mediaObjectFromPayload];

      if (!mediaObjectFromPayload)
      {
        __ck_photoCompositionMediaObjects = [v9 __ck_photoCompositionMediaObjects];
        if ([__ck_photoCompositionMediaObjects count])
        {
          [v5 addObjectsFromArray:__ck_photoCompositionMediaObjects];
        }

LABEL_15:

        goto LABEL_16;
      }

      shelfMediaObject = [v9 mediaObjectFromPayload];
    }

    __ck_photoCompositionMediaObjects = shelfMediaObject;
    if (!shelfMediaObject)
    {
      goto LABEL_16;
    }

    [v5 addObject:shelfMediaObject];
    goto LABEL_15;
  }

LABEL_16:
  v14 = [v5 copy];

  return v14;
}

- (void)flagSensitiveMediaObjects:(id)objects
{
  v47 = *MEMORY[0x1E69E9840];
  objectsCopy = objects;
  mEMORY[0x1E69A7FC8] = [MEMORY[0x1E69A7FC8] sharedManager];
  if ([mEMORY[0x1E69A7FC8] checksForSensitivityOnSend])
  {
    v37 = mEMORY[0x1E69A7FC8];
    v38 = objectsCopy;
    v6 = [(CKChatController *)self mediaObjectsFromComposition:objectsCopy];
    v39 = objc_alloc_init(MEMORY[0x1E695DF70]);
    mEMORY[0x1E69A7FC0] = [MEMORY[0x1E69A7FC0] sharedManager];
    selfCopy = self;
    conversation = [(CKCoreChatController *)self conversation];
    chat = [conversation chat];
    chatIdentifier = [chat chatIdentifier];

    v44 = 0u;
    v45 = 0u;
    v42 = 0u;
    v43 = 0u;
    obj = v6;
    v11 = [obj countByEnumeratingWithState:&v42 objects:v46 count:16];
    if (v11)
    {
      v12 = v11;
      v13 = *v43;
      do
      {
        v14 = 0;
        v40 = v12;
        do
        {
          if (*v43 != v13)
          {
            objc_enumerationMutation(obj);
          }

          v15 = *(*(&v42 + 1) + 8 * v14);
          transfer = [v15 transfer];
          fileURL = [transfer fileURL];

          v18 = [mEMORY[0x1E69A7FC0] cachedResultForContentAttachment:fileURL withChatID:chatIdentifier];
          transfer2 = [v15 transfer];
          guid = [transfer2 guid];

          if (v18)
          {
            v21 = guid == 0;
          }

          else
          {
            v21 = 1;
          }

          if (!v21)
          {
            v22 = chatIdentifier;
            v23 = mEMORY[0x1E69A7FC0];
            if ([v18 BOOLValue])
            {
              v24 = [MEMORY[0x1E695DEF0] dataWithContentsOfURL:fileURL];
              if (v24)
              {
                v25 = [objc_alloc(MEMORY[0x1E69A5B38]) initWithIdentifier:guid imageData:v24];
                [v39 addObject:v25];
              }
            }

            if ([v18 BOOLValue])
            {
              v26 = 2;
            }

            else
            {
              v26 = 0;
            }

            mEMORY[0x1E69A5B80] = [MEMORY[0x1E69A5B80] sharedInstance];
            v28 = [mEMORY[0x1E69A5B80] transferForGUID:guid];

            [v28 setCommSafetySensitive:v26];
            mEMORY[0x1E69A7FC0] = v23;
            chatIdentifier = v22;
            v12 = v40;
          }

          ++v14;
        }

        while (v12 != v14);
        v12 = [obj countByEnumeratingWithState:&v42 objects:v46 count:16];
      }

      while (v12);
    }

    if ([v39 count])
    {
      v29 = MEMORY[0x1E69A5B30];
      [(CKCoreChatController *)selfCopy conversation];
      v31 = v30 = mEMORY[0x1E69A7FC0];
      [v31 chat];
      v33 = v32 = chatIdentifier;
      localTypingMessageGUID = [v33 localTypingMessageGUID];
      chat2 = [(CKCoreChatController *)selfCopy chat];
      [v29 registerEvent:0 eventType:0 messageGUID:localTypingMessageGUID chat:chat2 forImages:v39];

      chatIdentifier = v32;
      mEMORY[0x1E69A7FC0] = v30;
    }

    mEMORY[0x1E69A7FC8] = v37;
    objectsCopy = v38;
  }
}

- (void)messageEntryViewDidChange:(id)change isTextChange:(BOOL)textChange isShelfChange:(BOOL)shelfChange isTranslationChange:(BOOL)translationChange
{
  translationChangeCopy = translationChange;
  shelfChangeCopy = shelfChange;
  textChangeCopy = textChange;
  changeCopy = change;
  typingUpdater = [(CKChatController *)self typingUpdater];
  [typingUpdater setNeedsUpdate];

  if (!-[CKChatController isAnimatingMessageSend](self, "isAnimatingMessageSend") || ([changeCopy contentView], v11 = objc_claimAutoreleasedReturnValue(), objc_msgSend(v11, "textView"), v12 = objc_claimAutoreleasedReturnValue(), objc_msgSend(v12, "text"), v13 = objc_claimAutoreleasedReturnValue(), v14 = objc_msgSend(v13, "length"), v13, v12, v11, v14))
  {
    isShowingAudioRecordingView = [changeCopy isShowingAudioRecordingView];
    mEMORY[0x1E69A8070] = [MEMORY[0x1E69A8070] sharedInstance];
    isSendMenuEnabled = [mEMORY[0x1E69A8070] isSendMenuEnabled];

    v18 = CKIsRunningInMacCatalyst();
    v19 = [(CKChatController *)self hasFinishedRestoringDraftState]|| CKIsRunningInMessagesViewService() != 0;
    delegate = [(CKCoreChatController *)self delegate];
    v21 = objc_opt_respondsToSelector();

    if (v21)
    {
      delegate2 = [(CKCoreChatController *)self delegate];
      hasDetailsNavigationController = [delegate2 hasDetailsNavigationController];

      if (!shelfChangeCopy)
      {
LABEL_8:
        if (((isShowingAudioRecordingView | hasDetailsNavigationController) & 1) != 0 || translationChangeCopy)
        {
          goto LABEL_15;
        }

        goto LABEL_14;
      }
    }

    else
    {
      hasDetailsNavigationController = 0;
      if (!shelfChangeCopy)
      {
        goto LABEL_8;
      }
    }

    if ((v18 == 0) & isSendMenuEnabled | (isShowingAudioRecordingView | hasDetailsNavigationController) & 1 || translationChangeCopy)
    {
      goto LABEL_15;
    }

LABEL_14:
    v19 = 0;
LABEL_15:
    [(CKChatController *)self _updateEntryViewFrameIfNeeded:v19];
  }

  [(CKChatController *)self _updatePollSuggestionAvailability];
  isInHardwareKeyboardMode = [MEMORY[0x1E69DCBB8] isInHardwareKeyboardMode];
  collectionViewController = [(CKCoreChatController *)self collectionViewController];
  collectionView = [collectionViewController collectionView];
  v27 = collectionView;
  if (isInHardwareKeyboardMode && [collectionView transcriptScrollIntent] == 9)
  {
    [v27 setTranscriptScrollIntent:0];
    v28 = +[CKScrollViewAnimationProperties inheritedAnimation];
    [v27 enforceTranscriptScrollIntentWithAnimationProperties:v28];
  }

  v29 = [[CKTranscriptScrollIntentEntryViewChangedTrigger alloc] initWithEntryView:changeCopy isTextChange:textChangeCopy isShelfChange:shelfChangeCopy isSendLaterPluginChange:0];
  if ([(CKChatController *)self hasFinishedRestoringDraftState])
  {
    [(CKScrollViewController *)self activeKeyboardAppearanceAnimationProperties];
  }

  else
  {
    +[CKScrollViewAnimationProperties unanimated];
  }
  v30 = ;
  [collectionViewController updateScrollIntentWithTrigger:v29 activeKeyboardAppearanceAnimationProperties:v30];
}

- (void)messageEntryViewRecordingDidChange:(id)change
{
  [MEMORY[0x1E69DD258] attemptRotationToDeviceOrientation];
  collectionViewController = [(CKCoreChatController *)self collectionViewController];
  [collectionViewController stopPlayingAudio];

  typingUpdater = [(CKChatController *)self typingUpdater];
  [typingUpdater setNeedsUpdate];
}

- (id)inputContextHistoryForMessageEntryView:(id)view
{
  conversation = [(CKCoreChatController *)self conversation];
  if ([conversation isKnownSender])
  {
    collectionViewController = [(CKCoreChatController *)self collectionViewController];
    inputContextHistory = [collectionViewController inputContextHistory];
  }

  else
  {
    v7 = IMLogHandleForCategory();
    if (os_log_type_enabled(v7, OS_LOG_TYPE_INFO))
    {
      *v9 = 0;
      _os_log_impl(&dword_19020E000, v7, OS_LOG_TYPE_INFO, "Not providing input context history because conversation is with an unknown sender.", v9, 2u);
    }

    inputContextHistory = 0;
  }

  return inputContextHistory;
}

- (BOOL)_transcriptScrollsOnEntryViewActivation
{
  collectionView = [(CKChatController *)self collectionView];
  transcriptScrollIntent = [collectionView transcriptScrollIntent];

  if (CKIsRunningInMacCatalyst() || [MEMORY[0x1E69DCBB8] isInHardwareKeyboardMode])
  {
    if (transcriptScrollIntent)
    {
      v4 = transcriptScrollIntent == 6;
    }

    else
    {
      v4 = 1;
    }

    LOBYTE(v5) = v4;
  }

  else
  {
    v5 = 0x47u >> transcriptScrollIntent;
    if (transcriptScrollIntent > 6)
    {
      LOBYTE(v5) = 0;
    }
  }

  return v5 & 1;
}

- (void)messageEntryViewDidBeginEditing:(id)editing
{
  if ([(CKChatController *)self _wantsThreeColumnLayout])
  {
    if (!CKIsRunningInMacCatalyst())
    {
      mEMORY[0x1E69A8070] = [MEMORY[0x1E69A8070] sharedFeatureFlags];
      isModernSplitViewControllerEnabled = [mEMORY[0x1E69A8070] isModernSplitViewControllerEnabled];

      if ((isModernSplitViewControllerEnabled & 1) == 0)
      {
        splitViewController = [(CKChatController *)self splitViewController];
        [splitViewController hideColumn:0];
      }
    }
  }

  [(CKChatController *)self registerForTextInputPayloadHandling];
  if (![(CKChatController *)self hasAlreadyPresentedSatelliteConnectionBanner])
  {
    mEMORY[0x1E69A5B00] = [MEMORY[0x1E69A5B00] sharedInstance];
    conversation = [(CKCoreChatController *)self conversation];
    chat = [conversation chat];
    [mEMORY[0x1E69A5B00] presentSatelliteConnectionBannerIfNecessaryWithChat:chat withReason:*MEMORY[0x1E69A5A50] ignoreTimerLimit:1];

    [(CKChatController *)self setHasAlreadyPresentedSatelliteConnectionBanner:1];
  }
}

- (void)messageEntryViewDidBeginEditingNotAlreadyActive:(id)active
{
  activeCopy = active;
  if ([(CKChatController *)self targetFirstResponder]== 1)
  {
    [(CKChatController *)self setTargetFirstResponder:0];
  }

  if (IMOSLoggingEnabled())
  {
    v5 = OSLogHandleForIMFoundationCategory();
    if (os_log_type_enabled(v5, OS_LOG_TYPE_INFO))
    {
      *v11 = 0;
      _os_log_impl(&dword_19020E000, v5, OS_LOG_TYPE_INFO, "Learned messageEntryViewDidBeginEditingNotAlreadyActive, updating scrollIntent.", v11, 2u);
    }
  }

  collectionViewController = [(CKCoreChatController *)self collectionViewController];
  v7 = [[CKTranscriptScrollIntentEntryViewActiveTrigger alloc] initWithChatController:self];
  activeKeyboardAppearanceAnimationProperties = [(CKScrollViewController *)self activeKeyboardAppearanceAnimationProperties];
  [collectionViewController updateScrollIntentWithTrigger:v7 activeKeyboardAppearanceAnimationProperties:activeKeyboardAppearanceAnimationProperties];

  inlineReplyController = [(CKChatController *)self inlineReplyController];
  if (inlineReplyController || [(CKChatController *)self entryViewWasActiveOnContextMenuPresentation])
  {
  }

  else if (!CKIsRunningInMessagesTranscriptExtension())
  {
    [(CKChatController *)self setupScrollingForKeyboardInteraction];
  }

  [(CKChatController *)self setEntryViewWasActiveOnContextMenuPresentation:0];
  [(CKChatController *)self _setAvoidanceInsetsNeedsUpdate];
  if (CKIsRunningInMacCatalyst())
  {
    collectionViewController2 = [(CKCoreChatController *)self collectionViewController];
    [collectionViewController2 deselectAllBalloons];
  }
}

- (BOOL)messageEntryView:(id)view shouldInsertMediaObjects:(id)objects
{
  objectsCopy = objects;
  viewCopy = view;
  conversation = [(CKCoreChatController *)self conversation];
  composition = [viewCopy composition];

  v10 = [composition compositionByAppendingMediaObjects:objectsCopy];

  LOBYTE(objectsCopy) = [conversation canSendComposition:v10 error:0];
  return objectsCopy;
}

- (void)messageEntryView:(id)view didInsertPluginPayload:(id)payload
{
  pluginBundleID = [payload pluginBundleID];
  v6 = IMBalloonExtensionIDWithSuffix();
  v7 = [pluginBundleID isEqualToString:v6];

  if (CKIsRunningInMacCatalyst() && v7)
  {
    viewControllerForChatInputModalPresentation = [(CKChatController *)self viewControllerForChatInputModalPresentation];
    [viewControllerForChatInputModalPresentation dismissViewControllerAnimated:1 completion:0];

    defaultCenter = [MEMORY[0x1E696AD88] defaultCenter];
    [defaultCenter postNotificationName:@"CKAnimojiStickerPopoverWillHide" object:0];
  }
}

- (void)messageEntryViewSendButtonHit:(id)hit
{
  hitCopy = hit;
  effectPickerWindow = [(CKChatController *)self effectPickerWindow];

  if (effectPickerWindow)
  {
    if (IMOSLoggingEnabled())
    {
      v6 = OSLogHandleForIMFoundationCategory();
      if (os_log_type_enabled(v6, OS_LOG_TYPE_INFO))
      {
        *buf = 0;
        _os_log_impl(&dword_19020E000, v6, OS_LOG_TYPE_INFO, "Effect window exists. Drop send button press.", buf, 2u);
      }
    }
  }

  else
  {
    if (CKIsRunningInMacCatalyst())
    {
      viewControllerForChatInputModalPresentation = [(CKChatController *)self viewControllerForChatInputModalPresentation];
      [viewControllerForChatInputModalPresentation dismissViewControllerAnimated:1 completion:0];
    }

    v8 = +[CKAdaptivePresentationController sharedInstance];
    [v8 dismissViewControllerAnimated:1 completion:0];

    v9[0] = MEMORY[0x1E69E9820];
    v9[1] = 3221225472;
    v9[2] = __50__CKChatController_messageEntryViewSendButtonHit___block_invoke;
    v9[3] = &unk_1E72ED6D8;
    v9[4] = self;
    [hitCopy compositionWithAcceptedAutocorrection:v9];
  }
}

void __50__CKChatController_messageEntryViewSendButtonHit___block_invoke(uint64_t a1, void *a2)
{
  v9 = *MEMORY[0x1E69E9840];
  v3 = a2;
  if (IMOSLoggingEnabled())
  {
    v4 = OSLogHandleForIMFoundationCategory();
    if (os_log_type_enabled(v4, OS_LOG_TYPE_INFO))
    {
      v5 = [v3 hasContent];
      v6 = @"NO";
      if (v5)
      {
        v6 = @"YES";
      }

      v7 = 138412290;
      v8 = v6;
      _os_log_impl(&dword_19020E000, v4, OS_LOG_TYPE_INFO, "Composition with accepted autocorrection returned. In completion block. composition.hasContent: %@", &v7, 0xCu);
    }
  }

  [*(a1 + 32) selectAccountAndSendComposition:v3 completion:0];
}

- (void)selectAccountAndSendComposition:(id)composition completion:(id)completion
{
  v15 = *MEMORY[0x1E69E9840];
  compositionCopy = composition;
  completionCopy = completion;
  chat = [(CKCoreChatController *)self chat];
  isStewieChat = [chat isStewieChat];

  if (isStewieChat)
  {
    HasMultipleSubscriptions = 0;
  }

  else
  {
    HasMultipleSubscriptions = IMSharedHelperDeviceHasMultipleSubscriptions();
  }

  if (IMOSLoggingEnabled())
  {
    v11 = OSLogHandleForIMFoundationCategory();
    if (os_log_type_enabled(v11, OS_LOG_TYPE_INFO))
    {
      v12 = @"NO";
      if (HasMultipleSubscriptions)
      {
        v12 = @"YES";
      }

      v13 = 138412290;
      v14 = v12;
      _os_log_impl(&dword_19020E000, v11, OS_LOG_TYPE_INFO, "Should present account selection menu on send: %@", &v13, 0xCu);
    }
  }

  if (HasMultipleSubscriptions)
  {
    [(CKChatController *)self presentActionMenuForAccountSelection:compositionCopy completion:completionCopy];
  }

  else
  {
    [(CKChatController *)self _validateAndSendComposition:compositionCopy completion:completionCopy];
  }
}

- (void)messageEntryViewPopulatePreviousSentMessage:(id)message
{
  v31 = *MEMORY[0x1E69E9840];
  collectionViewController = [(CKCoreChatController *)self collectionViewController];
  chatItems = [collectionViewController chatItems];
  lastPopulatedMessageGuidFromMe = [(CKChatController *)self lastPopulatedMessageGuidFromMe];
  v6 = lastPopulatedMessageGuidFromMe == 0;

  if (!lastPopulatedMessageGuidFromMe)
  {
    entryView = [(CKChatController *)self entryView];
    composition = [entryView composition];
    [(CKChatController *)self setOriginalComposition:composition];
  }

  v28 = 0u;
  v29 = 0u;
  v26 = 0u;
  v27 = 0u;
  reverseObjectEnumerator = [chatItems reverseObjectEnumerator];
  v10 = [reverseObjectEnumerator countByEnumeratingWithState:&v26 objects:v30 count:16];
  if (v10)
  {
    v11 = v10;
    v12 = *v27;
    while (2)
    {
      for (i = 0; i != v11; ++i)
      {
        if (*v27 != v12)
        {
          objc_enumerationMutation(reverseObjectEnumerator);
        }

        v14 = *(*(&v26 + 1) + 8 * i);
        objc_opt_class();
        if (objc_opt_isKindOfClass())
        {
          iMChatItem = [v14 IMChatItem];
          if ([iMChatItem isFromMe])
          {
            guid = [iMChatItem guid];
            if (v6)
            {
              [(CKChatController *)self setLastPopulatedMessageGuidFromMe:guid];
              v18 = v14;
              entryView2 = [(CKChatController *)self entryView];
              v20 = [CKComposition alloc];
              text = [v18 text];
              subject = [v18 subject];

              v23 = [(CKComposition *)v20 initWithText:text subject:subject shelfPluginPayload:0];
              [entryView2 setComposition:v23];

              goto LABEL_17;
            }

            lastPopulatedMessageGuidFromMe2 = [(CKChatController *)self lastPopulatedMessageGuidFromMe];
            v6 = [guid isEqualToString:lastPopulatedMessageGuidFromMe2];
          }
        }
      }

      v11 = [reverseObjectEnumerator countByEnumeratingWithState:&v26 objects:v30 count:16];
      if (v11)
      {
        continue;
      }

      break;
    }
  }

LABEL_17:
}

- (void)messageEntryViewPopulateNextSentMessage:(id)message
{
  v30 = *MEMORY[0x1E69E9840];
  lastPopulatedMessageGuidFromMe = [(CKChatController *)self lastPopulatedMessageGuidFromMe];

  if (lastPopulatedMessageGuidFromMe)
  {
    collectionViewController = [(CKCoreChatController *)self collectionViewController];
    [collectionViewController chatItems];
    v25 = 0u;
    v26 = 0u;
    v27 = 0u;
    v5 = v28 = 0u;
    v6 = [v5 countByEnumeratingWithState:&v25 objects:v29 count:16];
    if (v6)
    {
      v7 = v6;
      v8 = 0;
      v9 = *v26;
      while (2)
      {
        for (i = 0; i != v7; ++i)
        {
          if (*v26 != v9)
          {
            objc_enumerationMutation(v5);
          }

          v11 = *(*(&v25 + 1) + 8 * i);
          objc_opt_class();
          if (objc_opt_isKindOfClass())
          {
            iMChatItem = [v11 IMChatItem];
            if ([iMChatItem isFromMe])
            {
              guid = [iMChatItem guid];
              if (v8)
              {
                [(CKChatController *)self setLastPopulatedMessageGuidFromMe:guid];
                v18 = v11;
                entryView = [(CKChatController *)self entryView];
                v20 = [CKComposition alloc];
                text = [v18 text];
                subject = [v18 subject];

                v23 = [(CKComposition *)v20 initWithText:text subject:subject shelfPluginPayload:0];
                [entryView setComposition:v23];

                return;
              }

              lastPopulatedMessageGuidFromMe2 = [(CKChatController *)self lastPopulatedMessageGuidFromMe];
              v8 = [guid isEqualToString:lastPopulatedMessageGuidFromMe2];
            }
          }
        }

        v7 = [v5 countByEnumeratingWithState:&v25 objects:v29 count:16];
        if (v7)
        {
          continue;
        }

        break;
      }
    }
  }

  [(CKChatController *)self setLastPopulatedMessageGuidFromMe:0];
  originalComposition = [(CKChatController *)self originalComposition];

  if (originalComposition)
  {
    entryView2 = [(CKChatController *)self entryView];
    originalComposition2 = [(CKChatController *)self originalComposition];
    [entryView2 setComposition:originalComposition2];

    [(CKChatController *)self setOriginalComposition:0];
  }
}

- (void)_passKitUIDismissed:(id)dismissed
{
  v20 = *MEMORY[0x1E69E9840];
  dismissedCopy = dismissed;
  if (IMOSLoggingEnabled())
  {
    v5 = OSLogHandleForIMFoundationCategory();
    if (os_log_type_enabled(v5, OS_LOG_TYPE_INFO))
    {
      v6 = MEMORY[0x1E696AD98];
      v7 = +[CKPluginExtensionStateObserver sharedInstance];
      v8 = [v6 numberWithBool:{objc_msgSend(v7, "passKitUIPresented")}];
      deferredSendAnimationBlock = [(CKChatController *)self deferredSendAnimationBlock];
      v10 = _Block_copy(deferredSendAnimationBlock);
      *buf = 138412546;
      v17 = v8;
      v18 = 2112;
      v19 = v10;
      _os_log_impl(&dword_19020E000, v5, OS_LOG_TYPE_INFO, "passKit UI dismissed. PassKitUIPresented %@. sendAnimationBlock %@", buf, 0x16u);
    }
  }

  deferredSendAnimationBlock2 = [(CKChatController *)self deferredSendAnimationBlock];
  if (deferredSendAnimationBlock2)
  {
    v12 = +[CKPluginExtensionStateObserver sharedInstance];
    passKitUIPresented = [v12 passKitUIPresented];

    if ((passKitUIPresented & 1) == 0)
    {
      defaultCenter = [MEMORY[0x1E696AD88] defaultCenter];
      [defaultCenter removeObserver:self name:@"CKPluginExtensionStateObserverPassKitUIDismissed" object:0];

      block[0] = MEMORY[0x1E69E9820];
      block[1] = 3221225472;
      block[2] = __40__CKChatController__passKitUIDismissed___block_invoke;
      block[3] = &unk_1E72EBA18;
      block[4] = self;
      dispatch_async(MEMORY[0x1E69E96A0], block);
    }
  }
}

uint64_t __40__CKChatController__passKitUIDismissed___block_invoke(uint64_t a1)
{
  v2 = [*(a1 + 32) deferredSendAnimationBlock];
  v2[2]();

  v3 = *(a1 + 32);

  return [v3 setDeferredSendAnimationBlock:0];
}

- (void)messageEntryViewSendButtonHitWhileDisabled:(id)disabled
{
  disabledCopy = disabled;
  if (IMOSLoggingEnabled())
  {
    v4 = OSLogHandleForIMFoundationCategory();
    if (os_log_type_enabled(v4, OS_LOG_TYPE_INFO))
    {
      *v5 = 0;
      _os_log_impl(&dword_19020E000, v4, OS_LOG_TYPE_INFO, "Send button was hit while it was disabled.", v5, 2u);
    }
  }
}

- (void)messageEntryViewPlusButtonHit:(id)hit
{
  v4 = IMLogHandleForCategory();
  if (os_log_type_enabled(v4, OS_LOG_TYPE_INFO))
  {
    *v5 = 0;
    _os_log_impl(&dword_19020E000, v4, OS_LOG_TYPE_INFO, "Plus button hit", v5, 2u);
  }

  [(CKChatController *)self _beginDeferringSystemNavigationPopGestureForPlusButton];
}

- (unint64_t)preferredScreenEdgesDeferringSystemGestures
{
  v4.receiver = self;
  v4.super_class = CKChatController;
  result = [(CKChatController *)&v4 preferredScreenEdgesDeferringSystemGestures];
  if (self->_deferSystemNavigationPopGestureForPlusButton)
  {
    result |= 2uLL;
  }

  return result;
}

- (void)_beginDeferringSystemNavigationPopGestureForPlusButton
{
  if (!self->_deferSystemNavigationPopGestureForPlusButton)
  {
    v3 = IMLogHandleForCategory();
    if (os_log_type_enabled(v3, OS_LOG_TYPE_INFO))
    {
      *v7 = 0;
      _os_log_impl(&dword_19020E000, v3, OS_LOG_TYPE_INFO, "Began deferring system navigation pop gesture for PlusButton", v7, 2u);
    }

    self->_deferSystemNavigationPopGestureForPlusButton = 1;
    navigationController = [(CKChatController *)self navigationController];
    interactivePopGestureRecognizer = [navigationController interactivePopGestureRecognizer];
    [interactivePopGestureRecognizer setDelaysTouchesBegan:0];

    [(CKChatController *)self setNeedsUpdateOfScreenEdgesDeferringSystemGestures];
    delegate = [(CKCoreChatController *)self delegate];
    [delegate chatControllerDidChangeDeferringSystemNavigationPopGestureForPlusButton:self];
  }
}

- (void)_endDeferringSystemNavigationPopGestureForPlusButton
{
  if (self->_deferSystemNavigationPopGestureForPlusButton)
  {
    v3 = IMLogHandleForCategory();
    if (os_log_type_enabled(v3, OS_LOG_TYPE_INFO))
    {
      *v7 = 0;
      _os_log_impl(&dword_19020E000, v3, OS_LOG_TYPE_INFO, "Ended deferring system navigation pop gesture for PlusButton", v7, 2u);
    }

    self->_deferSystemNavigationPopGestureForPlusButton = 0;
    navigationController = [(CKChatController *)self navigationController];
    interactivePopGestureRecognizer = [navigationController interactivePopGestureRecognizer];
    [interactivePopGestureRecognizer setDelaysTouchesBegan:1];

    [(CKChatController *)self setNeedsUpdateOfScreenEdgesDeferringSystemGestures];
    delegate = [(CKCoreChatController *)self delegate];
    [delegate chatControllerDidChangeDeferringSystemNavigationPopGestureForPlusButton:self];
  }
}

- (void)messageEntryViewRaiseGestureAutoSend:(id)send
{
  sendCopy = send;
  if (IMOSLoggingEnabled())
  {
    v5 = OSLogHandleForIMFoundationCategory();
    if (os_log_type_enabled(v5, OS_LOG_TYPE_INFO))
    {
      *v6 = 0;
      _os_log_impl(&dword_19020E000, v5, OS_LOG_TYPE_INFO, "Raise gesture auto send was triggered. Programmatically hit send button.", v6, 2u);
    }
  }

  [(CKChatController *)self messageEntryViewSendButtonHit:sendCopy];
}

- (CGSize)messageEntryViewMaxShelfPluginViewSize:(id)size
{
  [(CKChatController *)self balloonMaxWidth];
  v4 = v3;
  v5 = +[CKUIBehavior sharedBehaviors];
  [v5 maxTranscriptPortraitHeight];
  v7 = v6;

  v8 = v4;
  v9 = v7;
  result.height = v9;
  result.width = v8;
  return result;
}

- (BOOL)messageEntryViewWidth:(double *)width andOffset:(double *)offset
{
  v4 = 0;
  if (width && offset)
  {
    view = [(CKChatController *)self view];
    window = [view window];
    v4 = window != 0;
    if (!window)
    {
LABEL_24:

      return v4;
    }

    v10 = window;
    view2 = [(CKChatController *)self view];
    superview = [view2 superview];

    if (superview)
    {
      view = [(CKChatController *)self splitViewController];
      if (view)
      {
LABEL_6:
        v13 = 0.0;
        if (!-[CKCoreChatController isCollapsed](self, "isCollapsed") && ![*MEMORY[0x1E69DDA98] userInterfaceLayoutDirection])
        {
          if ([(CKChatController *)self _wantsThreeColumnLayout])
          {
            v14 = [view viewControllerForColumn:2];
            view3 = [v14 view];
            [view3 bounds];
            v17 = v16;
            v19 = v18;

            view4 = [v14 view];
            view5 = [(CKChatController *)self view];
            window2 = [view5 window];
            [view4 convertPoint:window2 toView:{v17, v19}];
            v13 = v23;
          }

          else
          {
            [view primaryColumnWidth];
            v28 = v27;
            if (CKPixelWidth_once_0 != -1)
            {
              [CKChatController messageEntryViewWidth:andOffset:];
            }

            v13 = v28 + *&CKPixelWidth_sPixel_0;
          }
        }

        goto LABEL_18;
      }

      navigationController = [(CKChatController *)self navigationController];
      presentingViewController = [navigationController presentingViewController];
      v25PresentingViewController = [presentingViewController presentingViewController];
      view = [v25PresentingViewController splitViewController];

      if ([view isCollapsed])
      {

        view = 0;
      }

      else if (view)
      {
        goto LABEL_6;
      }

      v13 = 0.0;
LABEL_18:
      view6 = [(CKChatController *)self view];
      [view6 bounds];
      v31 = v30;
      view7 = [(CKChatController *)self view];
      window3 = [view7 window];
      [window3 bounds];
      v35 = v34;

      objc_opt_class();
      if (objc_opt_isKindOfClass() & 1) != 0 || (objc_opt_class(), (objc_opt_isKindOfClass()))
      {
        if (v13 == 0.0 && v31 < v35)
        {
          view8 = [(CKChatController *)self view];
          view9 = [(CKChatController *)self view];
          [view9 origin];
          [view8 convertPoint:0 toView:?];
          v13 = v38;
        }
      }

      view10 = [(CKChatController *)self view];
      [view10 bounds];
      *width = v40;

      *offset = v13;
      goto LABEL_24;
    }

    return 0;
  }

  return v4;
}

- (BOOL)chatFooterViewOffset:(double *)offset
{
  needsFooter = [(CKChatController *)self needsFooter];
  v6 = 0;
  if (needsFooter)
  {
    chatFooterView = [(CKChatController *)self chatFooterView];
    LODWORD(v8) = 1144750080;
    LODWORD(v9) = 1144750080;
    [chatFooterView systemLayoutSizeFittingSize:*MEMORY[0x1E69DE090] withHorizontalFittingPriority:*(MEMORY[0x1E69DE090] + 8) verticalFittingPriority:{v8, v9}];
    v6 = v10;
  }

  *offset = v6;
  return needsFooter;
}

- (CGRect)messageEntryView:(id)view frameInThrowViewCoordinatesForView:(id)forView
{
  forViewCopy = forView;
  v6 = [(CKChatController *)self throwAnimationContainerSuperview:0];
  [forViewCopy bounds];
  [forViewCopy convertRect:v6 toView:?];
  v8 = v7;
  v10 = v9;
  v12 = v11;
  v14 = v13;

  v15 = v8;
  v16 = v10;
  v17 = v12;
  v18 = v14;
  result.size.height = v18;
  result.size.width = v17;
  result.origin.y = v16;
  result.origin.x = v15;
  return result;
}

- (void)openURLInExtensionContextForMode:(id)mode
{
  v4 = [(CKChatController *)self launchURLForMode:mode];
  mEMORY[0x1E69DC668] = [MEMORY[0x1E69DC668] sharedApplication];
  [mEMORY[0x1E69DC668] openURL:v4 options:MEMORY[0x1E695E0F8] completionHandler:0];
}

- (id)launchURLForMode:(id)mode
{
  modeCopy = mode;
  mEMORY[0x1E69A5AF8] = [MEMORY[0x1E69A5AF8] sharedRegistry];
  conversation = [(CKCoreChatController *)self conversation];
  chat = [conversation chat];
  entryView = [(CKChatController *)self entryView];
  composition = [entryView composition];
  text = [composition text];
  string = [text string];
  v12 = [mEMORY[0x1E69A5AF8] messagesURLWithChat:chat orHandles:0 withMessageText:string];

  v13 = [MEMORY[0x1E696AF20] componentsWithURL:v12 resolvingAgainstBaseURL:0];
  v14 = MEMORY[0x1E695DF70];
  queryItems = [v13 queryItems];
  v16 = [v14 arrayWithArray:queryItems];

  messageGUIDForTranscriptExtension = [(CKChatController *)self messageGUIDForTranscriptExtension];
  v18 = [messageGUIDForTranscriptExtension length];

  if (v18)
  {
    v19 = MEMORY[0x1E696AF60];
    messageGUIDForTranscriptExtension2 = [(CKChatController *)self messageGUIDForTranscriptExtension];
    v21 = [v19 queryItemWithName:@"message-guid" value:messageGUIDForTranscriptExtension2];
    [v16 addObject:v21];
  }

  v22 = [MEMORY[0x1E696AF60] queryItemWithName:@"inputmode" value:modeCopy];
  [v16 addObject:v22];

  v23 = [MEMORY[0x1E696AF60] queryItemWithName:@"overlay" value:@"1"];
  [v16 addObject:v23];

  [v13 setQueryItems:v16];
  v24 = [v13 URL];

  return v24;
}

- (void)contentInsetWillChange:(UIEdgeInsets)change withAnimationProperties:(id)properties
{
  v5.receiver = self;
  v5.super_class = CKChatController;
  [(CKCoreChatController *)&v5 contentInsetWillChange:properties withAnimationProperties:change.top, change.left, change.bottom, change.right];
  [(CKChatController *)self setNextEntryViewSafeAreaInsetUpdateIsSynchronous:1];
}

- (void)updateEntryViewHeightWithContentChange:(BOOL)change animated:(BOOL)animated completionHandler:(id)handler
{
  animatedCopy = animated;
  changeCopy = change;
  handlerCopy = handler;
  view = [(CKChatController *)self view];
  [view bounds];
  v10 = v9;

  [(CKChatController *)self _maxEntryViewHeight];
  v12 = v11;
  mEMORY[0x1E69A8070] = [MEMORY[0x1E69A8070] sharedFeatureFlags];
  isModernSplitViewControllerEnabled = [mEMORY[0x1E69A8070] isModernSplitViewControllerEnabled];

  if (isModernSplitViewControllerEnabled)
  {
    view2 = [(CKChatController *)self view];
    [view2 safeAreaInsets];
    v17 = v16;
    view3 = [(CKChatController *)self view];
    [view3 safeAreaInsets];
    v20 = v19;
    view4 = [(CKChatController *)self view];
    [view4 safeAreaInsets];
    v10 = v10 - (v20 + v22);
  }

  else
  {
    v17 = 0.0;
  }

  entryView = [(CKChatController *)self entryView];
  [entryView frame];
  v25 = v24;
  v27 = v26;

  if (v25 != v10 || v27 != v12)
  {
    [(CKChatController *)self _setEntryViewFrame:changeCopy isContentChange:animatedCopy animated:handlerCopy completionHandler:v17, 0.0, v10, v12];
  }
}

- (void)messageEntryViewSwipeDownGestureRecognized:(id)recognized
{
  recognizedCopy = recognized;
  if (CKIsRunningInMessages())
  {
    inputViewController = [(CKChatController *)self inputViewController];

    if (inputViewController)
    {
      inputController = [(CKCoreChatController *)self inputController];
      [inputController swipeDismissBrowser];
    }

    else
    {
      contentView = [recognizedCopy contentView];
      activeView = [contentView activeView];
      isFirstResponder = [activeView isFirstResponder];

      if (!isFirstResponder)
      {
        goto LABEL_6;
      }
    }

    [(CKChatController *)self dismissKeyboard];
  }

LABEL_6:
}

- (void)updateTyping
{
  entryView = [(CKChatController *)self entryView];
  if ([entryView isRecording])
  {
    conversation = [(CKCoreChatController *)self conversation];
    [conversation setLocalUserIsRecording:1];
    goto LABEL_10;
  }

  composition = [entryView composition];
  conversation = [composition shelfPluginPayload];

  if (!conversation)
  {
    goto LABEL_7;
  }

  pluginBundleID = [conversation pluginBundleID];
  if ([pluginBundleID isEqualToIgnoringCase:*MEMORY[0x1E69A6A00]])
  {

LABEL_7:
    conversation2 = [(CKCoreChatController *)self conversation];
    composition2 = [entryView composition];
    [conversation2 setLocalUserIsTyping:{objc_msgSend(composition2, "hasContent")}];
    goto LABEL_8;
  }

  pluginBundleID2 = [conversation pluginBundleID];
  v7 = IMBalloonExtensionIDWithSuffix();
  v8 = [pluginBundleID2 isEqualToIgnoringCase:v7];

  if (v8)
  {
    goto LABEL_7;
  }

  composition3 = [entryView composition];
  shelfPluginPayload = [composition3 shelfPluginPayload];
  conversation2 = [shelfPluginPayload pluginBundleID];

  if (!conversation2 || ([conversation2 isEqualToString:*MEMORY[0x1E69A69A8]] & 1) != 0)
  {
    goto LABEL_9;
  }

  mEMORY[0x1E69A5AD0] = [MEMORY[0x1E69A5AD0] sharedInstance];
  composition2 = [mEMORY[0x1E69A5AD0] balloonPluginForBundleID:conversation2];

  v14 = [composition2 __ck_statusJPEGImageDataForTransportWithCompressionFactor:0.2];
  if (v14)
  {
    conversation3 = [(CKCoreChatController *)self conversation];
    [conversation3 setLocalUserIsComposing:conversation2 typingIndicatorIcon:v14];
  }

LABEL_8:
LABEL_9:

LABEL_10:
}

- (void)setEffectPickerIsPresented:(BOOL)presented
{
  if (self->_effectPickerIsPresented == !presented)
  {
    presentedCopy = presented;
    self->_effectPickerIsPresented = presented;
    collectionViewController = [(CKCoreChatController *)self collectionViewController];
    conversation = [(CKCoreChatController *)self conversation];
    chat = [conversation chat];

    if (presentedCopy)
    {
      [collectionViewController addContentAnimationPauseReasons:2];
      [chat beginHoldingChatItemsUpdatesForReason:*MEMORY[0x1E69A5798]];
    }

    else
    {
      [chat endHoldingChatItemsUpdatesForReason:*MEMORY[0x1E69A5798]];
      [collectionViewController removeContentAnimationPauseReasons:2];
    }
  }
}

- (BOOL)gestureRecognizer:(id)recognizer shouldRequireFailureOfGestureRecognizer:(id)gestureRecognizer
{
  gestureRecognizerCopy = gestureRecognizer;
  recognizerCopy = recognizer;
  objc_opt_class();
  isKindOfClass = objc_opt_isKindOfClass();

  v8 = 0;
  if (isKindOfClass)
  {
    objc_opt_class();
    if (objc_opt_isKindOfClass())
    {
      v8 = 1;
    }
  }

  return v8;
}

- (BOOL)gestureRecognizer:(id)recognizer shouldReceiveTouch:(id)touch
{
  view = [touch view];
  objc_opt_class();
  isKindOfClass = objc_opt_isKindOfClass();

  if (isKindOfClass)
  {
    return 1;
  }

  else
  {
    return [(CKChatController *)self isEditing]^ 1;
  }
}

- (BOOL)allowEffectPickerToBePresented
{
  currentDevice = [MEMORY[0x1E69DC938] currentDevice];
  userInterfaceIdiom = [currentDevice userInterfaceIdiom];

  if (userInterfaceIdiom == 1)
  {
    return 1;
  }

  view = [(CKChatController *)self view];
  window = [view window];
  windowScene = [window windowScene];
  v5 = ([windowScene interfaceOrientation] - 5) < 0xFFFFFFFFFFFFFFFELL;

  return v5;
}

- (CGRect)fullScreenBalloonViewControllerSafeAreaLayoutFrame:(id)frame
{
  frameCopy = frame;
  if ([(CKChatController *)self photosGridViewPresented])
  {
    [(CKChatController *)self photosGridFullScreenBalloonViewControllerSafeAreaLayoutFrame:frameCopy];
    v6 = v5;
    v8 = v7;
    v10 = v9;
    v12 = v11;
  }

  else
  {
    v26.receiver = self;
    v26.super_class = CKChatController;
    [(CKCoreChatController *)&v26 fullScreenBalloonViewControllerSafeAreaLayoutFrame:frameCopy];
    v6 = v13;
    v8 = v14;
    v10 = v15;
    v17 = v16;

    frameCopy = [(CKChatController *)self entryView];
    [frameCopy bounds];
    v19 = v18;
    view = [(CKChatController *)self view];
    [view safeAreaInsets];
    v12 = v17 - (v19 - v21);
  }

  v22 = v6;
  v23 = v8;
  v24 = v10;
  v25 = v12;
  result.size.height = v25;
  result.size.width = v24;
  result.origin.y = v23;
  result.origin.x = v22;
  return result;
}

- (CGRect)fullScreenBalloonViewControllerSafeAreaLayoutFrameIgnoreEntryView:(id)view
{
  viewCopy = view;
  if ([(CKChatController *)self photosGridViewPresented])
  {
    [(CKChatController *)self photosGridFullScreenBalloonViewControllerSafeAreaLayoutFrame:viewCopy];
  }

  else
  {
    v17.receiver = self;
    v17.super_class = CKChatController;
    [(CKCoreChatController *)&v17 fullScreenBalloonViewControllerSafeAreaLayoutFrame:viewCopy];
  }

  v9 = v5;
  v10 = v6;
  v11 = v7;
  v12 = v8;

  v13 = v9;
  v14 = v10;
  v15 = v11;
  v16 = v12;
  result.size.height = v16;
  result.size.width = v15;
  result.origin.y = v14;
  result.origin.x = v13;
  return result;
}

- (BOOL)clickInteractionShouldBegin:(id)begin
{
  beginCopy = begin;
  entryView = [(CKChatController *)self entryView];
  composition = [entryView composition];
  shelfPluginPayload = [composition shelfPluginPayload];

  datasource = [shelfPluginPayload datasource];
  LOBYTE(composition) = [datasource supportsDynamicSize];

  if (composition)
  {
    goto LABEL_8;
  }

  v9 = +[CKUIBehavior sharedBehaviors];
  shouldDisableSendButtonClickInteraction = [v9 shouldDisableSendButtonClickInteraction];

  if (shouldDisableSendButtonClickInteraction)
  {
    goto LABEL_8;
  }

  entryView2 = [(CKChatController *)self entryView];
  hasRecording = [entryView2 hasRecording];

  if (hasRecording)
  {
    goto LABEL_8;
  }

  chat = [(CKCoreChatController *)self chat];
  v14 = [chat supportsCapabilities:0x20000];

  if (!v14)
  {
    goto LABEL_8;
  }

  chat2 = [(CKCoreChatController *)self chat];
  if (![chat2 canSend])
  {
    v17 = 0;
LABEL_11:

    goto LABEL_9;
  }

  isReadOnly = [(CKCoreChatController *)self isReadOnly];

  if (!isReadOnly && (IMIsRunningInMessagesTranscriptExtension() & 1) == 0)
  {
    if ([(CKChatController *)self allowEffectPickerToBePresented])
    {
      v17 = 1;
      goto LABEL_9;
    }

    [beginCopy locationInCoordinateSpace:0];
    v20 = v19;
    v22 = v21;
    mEMORY[0x1E69A8070] = [MEMORY[0x1E69A8070] sharedFeatureFlags];
    isEntryViewRefreshEnabled = [mEMORY[0x1E69A8070] isEntryViewRefreshEnabled];

    entryView3 = [(CKChatController *)self entryView];
    v26 = entryView3;
    if (isEntryViewRefreshEnabled)
    {
      [entryView3 glassSendButton];
    }

    else
    {
      [entryView3 sendButton];
    }
    chat2 = ;

    v27 = [chat2 hitTest:0 withEvent:{v20, v22}];
    v17 = v27 == 0;

    goto LABEL_11;
  }

LABEL_8:
  v17 = 0;
LABEL_9:

  return v17;
}

- (void)showEffectPicker
{
  if (CKIsRunningInMacCatalyst() || (-[CKChatController entryView](self, "entryView"), v3 = objc_claimAutoreleasedReturnValue(), v4 = [v3 isSendButtonEnabled], v3, v4))
  {
    [(CKChatController *)self _initializeEffectPicker];
    effectPickerViewController = [(CKChatController *)self effectPickerViewController];
    [effectPickerViewController presentPicker];

    self->_effectPickerIsPresented = 1;
    view = [(CKChatController *)self view];
    [view setNeedsDisplay];
  }
}

- (void)dismissEffectPickerAnimated:(BOOL)animated
{
  animatedCopy = animated;
  effectPickerViewController = [(CKChatController *)self effectPickerViewController];
  [(CKChatController *)self effectPickerViewControllerClose:effectPickerViewController animated:animatedCopy];

  v6 = +[CKAdaptivePresentationController sharedInstance];
  [v6 dismissViewControllerAnimated:animatedCopy completion:0];

  [(CKChatController *)self setEffectPickerIsPresented:0];
}

- (void)tapGestureRecognized:(id)recognized
{
  entryView = [(CKChatController *)self entryView];
  if (CKIsRunningInMacCatalyst())
  {
    collectionViewController = [(CKCoreChatController *)self collectionViewController];
    [collectionViewController hideTranscriptTimestampsIfNeeded];

    collectionViewController2 = [(CKCoreChatController *)self collectionViewController];
    [collectionViewController2 deselectAllBalloons];

    contentView = [entryView contentView];
    textView = [contentView textView];
    [textView resignFirstResponder];

    contentView2 = [entryView contentView];
    textView2 = [contentView2 textView];
    [textView2 setHideCaretUntilUserTypes:1];
  }
}

- (void)raiseGestureRecognized:(id)recognized
{
  recognizedCopy = recognized;
  conversation = [(CKCoreChatController *)self conversation];
  isBlockedByCommunicationLimits = [conversation isBlockedByCommunicationLimits];

  if ((isBlockedByCommunicationLimits & 1) == 0)
  {
    [(CKChatController *)self __raiseGestureRecognized:recognizedCopy];
  }
}

- (void)__raiseGestureRecognized:(id)recognized
{
  recognizedCopy = recognized;
  mEMORY[0x1E69DCBF0] = [MEMORY[0x1E69DCBF0] sharedInputModeController];
  currentInputMode = [mEMORY[0x1E69DCBF0] currentInputMode];
  identifier = [currentInputMode identifier];
  v8 = *MEMORY[0x1E69DDFB0];

  if (identifier != v8)
  {
    collectionViewController = [(CKCoreChatController *)self collectionViewController];
    canRaiseToListen = [collectionViewController canRaiseToListen];

    if (canRaiseToListen)
    {
      collectionViewController2 = [(CKCoreChatController *)self collectionViewController];
      [collectionViewController2 raiseGestureRecognized:recognizedCopy];
    }

    else
    {
      conversation = [(CKCoreChatController *)self conversation];
      chat = [conversation chat];
      v14 = [chat supportsCapabilities:0x10000];

      if (v14)
      {
        if ([recognizedCopy isRecognized])
        {
          if (IMOSLoggingEnabled())
          {
            v15 = OSLogHandleForIMFoundationCategory();
            if (os_log_type_enabled(v15, OS_LOG_TYPE_INFO))
            {
              *buf = 0;
              _os_log_impl(&dword_19020E000, v15, OS_LOG_TYPE_INFO, "Starting audio recording invoked by raise to record gesture.", buf, 2u);
            }
          }

          collectionViewController2 = [(CKChatController *)self entryView];
          [collectionViewController2 startRecordingForRaiseGesture];
        }

        else
        {
          gestureState = [recognizedCopy gestureState];
          v17 = IMOSLoggingEnabled();
          if (gestureState == 2)
          {
            if (v17)
            {
              v18 = OSLogHandleForIMFoundationCategory();
              if (os_log_type_enabled(v18, OS_LOG_TYPE_INFO))
              {
                *v23 = 0;
                _os_log_impl(&dword_19020E000, v18, OS_LOG_TYPE_INFO, "Stopping audio recording invoked by raise to record gesture because of failure.", v23, 2u);
              }
            }

            entryView = [(CKChatController *)self entryView];
            collectionViewController2 = entryView;
            v20 = 1;
          }

          else
          {
            if (v17)
            {
              v21 = OSLogHandleForIMFoundationCategory();
              if (os_log_type_enabled(v21, OS_LOG_TYPE_INFO))
              {
                *v22 = 0;
                _os_log_impl(&dword_19020E000, v21, OS_LOG_TYPE_INFO, "Stopping audio recording invoked by raise to record gesture.", v22, 2u);
              }
            }

            entryView = [(CKChatController *)self entryView];
            collectionViewController2 = entryView;
            v20 = 0;
          }

          [entryView stopRecordingForRaiseGestureWithFailure:v20];
        }
      }

      else
      {
        if (!IMOSLoggingEnabled())
        {
          goto LABEL_5;
        }

        collectionViewController2 = OSLogHandleForIMFoundationCategory();
        if (os_log_type_enabled(collectionViewController2, OS_LOG_TYPE_INFO))
        {
          *v25 = 0;
          _os_log_impl(&dword_19020E000, collectionViewController2, OS_LOG_TYPE_INFO, "Ignoring raise gesture for audio recording because chat does not support capability.", v25, 2u);
        }
      }
    }
  }

LABEL_5:
}

- (void)updateRaiseGesture
{
  collectionViewController = [(CKCoreChatController *)self collectionViewController];
  mEMORY[0x1E69DC668] = [MEMORY[0x1E69DC668] sharedApplication];
  if ([mEMORY[0x1E69DC668] applicationState] || !-[CKViewController appeared](self, "appeared"))
  {
    v5 = 0;
    goto LABEL_6;
  }

  imagePickerController = [(CKChatController *)self imagePickerController];
  if (!imagePickerController)
  {
    presentedViewController = [(CKChatController *)self presentedViewController];
    objc_opt_class();
    if ((objc_opt_isKindOfClass() & 1) == 0)
    {
      if ([collectionViewController canRaiseToListen])
      {
        v5 = 1;
        goto LABEL_15;
      }

      if ([collectionViewController canRaiseToTalk])
      {
        v5 = [(CKCoreChatController *)self isReadOnly]^ 1;
        goto LABEL_15;
      }
    }

    v5 = 0;
LABEL_15:

    goto LABEL_16;
  }

  v5 = 0;
LABEL_16:

LABEL_6:
  raiseGesture = [(CKChatController *)self raiseGesture];
  [raiseGesture setEnabled:v5];
}

- (void)_saveDraftState
{
  conversation = [(CKCoreChatController *)self conversation];
  v4 = conversation;
  if (conversation && (v15 = conversation, v5 = IMIsRunningInMessagesComposeViewService(), v4 = v15, !v5))
  {
    conversation2 = [(CKCoreChatController *)self conversation];
    chat = [conversation2 chat];
    joinState = [chat joinState];

    if (joinState != 1)
    {
      conversation3 = [(CKCoreChatController *)self conversation];
      if (-[CKChatController isAnimatingMessageSend](self, "isAnimatingMessageSend") || (+[CKConversationList sharedConversationList](CKConversationList, "sharedConversationList"), v10 = objc_claimAutoreleasedReturnValue(), [v10 pendingConversation], v11 = objc_claimAutoreleasedReturnValue(), v11, v10, v11 == conversation3))
      {
        if (IMOSLoggingEnabled())
        {
          v14 = OSLogHandleForIMFoundationCategory();
          if (os_log_type_enabled(v14, OS_LOG_TYPE_INFO))
          {
            *buf = 0;
            _os_log_impl(&dword_19020E000, v14, OS_LOG_TYPE_INFO, "Skip saving draft state", buf, 2u);
          }
        }
      }

      else
      {
        inputController = [(CKCoreChatController *)self inputController];
        [inputController requestPhotoBrowserToPrepareForDraft];

        inputController2 = [(CKCoreChatController *)self inputController];
        v17[0] = MEMORY[0x1E69E9820];
        v17[1] = 3221225472;
        v17[2] = __35__CKChatController__saveDraftState__block_invoke;
        v17[3] = &unk_1E72ED6D8;
        v18 = conversation3;
        [inputController2 requestPollPluginToPrepareForDraftWithCompletion:v17];
      }
    }
  }

  else
  {
  }
}

void __35__CKChatController__saveDraftState__block_invoke(uint64_t a1, void *a2)
{
  v3 = a2;
  if (IMOSLoggingEnabled())
  {
    v4 = OSLogHandleForIMFoundationCategory();
    if (os_log_type_enabled(v4, OS_LOG_TYPE_INFO))
    {
      *v5 = 0;
      _os_log_impl(&dword_19020E000, v4, OS_LOG_TYPE_INFO, "Conversation has unsent composition, saving draft state", v5, 2u);
    }
  }

  [*(a1 + 32) setUnsentComposition:v3];
}

- (BOOL)_shouldRestoreDraftState
{
  composition = [(CKChatController *)self composition];
  if ([composition hasContent])
  {
    LOBYTE(v3) = 0;
  }

  else
  {
    v3 = !CKBalloonPluginViewCacheNeedsPrewarm();
  }

  return v3;
}

- (void)_prewarmBalloonPluginViewCacheCompleted:(id)completed
{
  [(CKChatController *)self _restoreDraftState];
  composition = [(CKChatController *)self composition];
  if (composition)
  {
    inputController = composition;
    composition2 = [(CKChatController *)self composition];
    if ([composition2 hasContent])
    {
      composition3 = [(CKChatController *)self composition];
      shelfPluginPayload = [composition3 shelfPluginPayload];

      if (!shelfPluginPayload)
      {
        return;
      }

      v8 = +[CKBalloonPluginManager sharedInstance];
      [v8 invalidatePhotosViewController];

      inputController = [(CKCoreChatController *)self inputController];
      composition2 = [(CKChatController *)self composition];
      [inputController requestPhotoBrowserInitFromDraft:composition2];
    }
  }
}

- (void)_restoreDraftState
{
  if ([(CKChatController *)self _shouldRestoreDraftState])
  {
    if (IMOSLoggingEnabled())
    {
      v3 = OSLogHandleForIMFoundationCategory();
      if (os_log_type_enabled(v3, OS_LOG_TYPE_INFO))
      {
        *buf = 0;
        _os_log_impl(&dword_19020E000, v3, OS_LOG_TYPE_INFO, "Composition does not have content, trying to restore draft", buf, 2u);
      }
    }

    if ((IMIsRunningInMessagesComposeViewService() & 1) == 0)
    {
      inputController = [(CKCoreChatController *)self inputController];

      if (!inputController)
      {
        [(CKChatController *)self loadChatInputController];
      }

      conversation = [(CKCoreChatController *)self conversation];
      unsentComposition = [conversation unsentComposition];

      if (([unsentComposition hasContent] & 1) != 0 || (objc_msgSend(unsentComposition, "bizIntent"), v7 = objc_claimAutoreleasedReturnValue(), v7, v7))
      {
        conversation2 = [(CKCoreChatController *)self conversation];
        chat = [conversation2 chat];
        bizIntent = [unsentComposition bizIntent];
        [chat setBizIntent:bizIntent];

        [(CKChatController *)self setComposition:unsentComposition];
        v11 = +[CKBalloonPluginManager sharedInstance];
        [v11 invalidatePhotosViewController];

        inputController2 = [(CKCoreChatController *)self inputController];
        [inputController2 requestPhotoBrowserInitFromDraft:unsentComposition];

        v13 = +[CKUIBehavior sharedBehaviors];
        LODWORD(chat) = [v13 restoringDraftShouldShowKeyboard];

        if (chat)
        {
          [(CKChatController *)self setTargetFirstResponder:1];
          self->_entryViewShouldBecomeTargetFirstResponderForPendingDraft = 1;
        }

        if (IMOSLoggingEnabled())
        {
          v14 = OSLogHandleForIMFoundationCategory();
          if (os_log_type_enabled(v14, OS_LOG_TYPE_INFO))
          {
            *v15 = 0;
            _os_log_impl(&dword_19020E000, v14, OS_LOG_TYPE_INFO, "Draft composition restored", v15, 2u);
          }
        }
      }

      [(CKChatController *)self setHasFinishedRestoringDraftState:1];
    }
  }
}

- (id)getCurrentContext
{
  v60 = *MEMORY[0x1E69E9840];
  conversation = [(CKCoreChatController *)self conversation];
  chat = [conversation chat];

  lastFinishedMessage = [chat lastFinishedMessage];
  if (lastFinishedMessage)
  {
    v6 = objc_alloc_init(MEMORY[0x1E69C7A98]);
    time = [lastFinishedMessage time];
    [v6 setDateSent:time];

    v8 = [MEMORY[0x1E696AD98] numberWithBool:{objc_msgSend(lastFinishedMessage, "isFromMe")}];
    [v6 setOutgoing:v8];

    if (([lastFinishedMessage isFromMe] & 1) == 0)
    {
      v9 = objc_alloc_init(MEMORY[0x1E69C7938]);
      sender = [lastFinishedMessage sender];
      v11 = [sender ID];

      sender2 = [lastFinishedMessage sender];
      fullName = [sender2 fullName];

      [v9 setData:v11];
      if (fullName)
      {
        [v9 setDisplayText:fullName];
      }

      else
      {
        v15 = IMFormattedDisplayStringForIDInAddressBook();
        [v9 setDisplayText:v15];
      }

      v16 = CKSAPersonForAddress(v11);
      [v9 setObject:v16];

      [v6 setMsgSender:v9];
    }

    conversation2 = [(CKCoreChatController *)self conversation];
    recipients = [conversation2 recipients];

    if (([lastFinishedMessage isFromMe] & 1) != 0 || objc_msgSend(recipients, "count") >= 2)
    {
      v47 = lastFinishedMessage;
      v48 = chat;
      array = [MEMORY[0x1E695DF70] array];
      v54 = 0u;
      v55 = 0u;
      v56 = 0u;
      v57 = 0u;
      v45 = recipients;
      v20 = recipients;
      v21 = [v20 countByEnumeratingWithState:&v54 objects:v59 count:16];
      if (v21)
      {
        v22 = v21;
        v23 = *v55;
        do
        {
          for (i = 0; i != v22; ++i)
          {
            if (*v55 != v23)
            {
              objc_enumerationMutation(v20);
            }

            rawAddress = [*(*(&v54 + 1) + 8 * i) rawAddress];
            [array addObject:rawAddress];
          }

          v22 = [v20 countByEnumeratingWithState:&v54 objects:v59 count:16];
        }

        while (v22);
      }

      v46 = v6;

      v26 = objc_alloc_init(MEMORY[0x1E695DF70]);
      v50 = 0u;
      v51 = 0u;
      v52 = 0u;
      v53 = 0u;
      obj = array;
      v27 = [obj countByEnumeratingWithState:&v50 objects:v58 count:16];
      if (v27)
      {
        v28 = v27;
        v29 = *v51;
        do
        {
          for (j = 0; j != v28; ++j)
          {
            if (*v51 != v29)
            {
              objc_enumerationMutation(obj);
            }

            v31 = *(*(&v50 + 1) + 8 * j);
            mEMORY[0x1E69A7FD0] = [MEMORY[0x1E69A7FD0] sharedInstance];
            v33 = [mEMORY[0x1E69A7FD0] fetchCNContactForHandleWithID:v31];

            v34 = [MEMORY[0x1E69A7FD0] fullNameForCNContact:v33];
            v35 = objc_alloc_init(MEMORY[0x1E69C7938]);
            [v35 setData:v31];
            if (v34)
            {
              [v35 setDisplayText:v34];
            }

            else
            {
              v36 = IMFormattedDisplayStringForIDInAddressBook();
              [v35 setDisplayText:v36];
            }

            v37 = CKSAPersonForAddress(v31);
            [v35 setObject:v37];

            [v26 addObject:v35];
          }

          v28 = [obj countByEnumeratingWithState:&v50 objects:v58 count:16];
        }

        while (v28);
      }

      v6 = v46;
      [v46 setMsgRecipients:v26];

      lastFinishedMessage = v47;
      chat = v48;
      recipients = v45;
    }

    v38 = MEMORY[0x1E695DFF8];
    v39 = [MEMORY[0x1E696AEC0] stringWithFormat:@"x-apple-sms:guid=%lld", objc_msgSend(lastFinishedMessage, "messageID")];
    v40 = [v38 URLWithString:v39];
    [v6 setIdentifier:v40];

    guid = [chat guid];
    [v6 setChatIdentifier:guid];

    v42 = MEMORY[0x1E695DEC8];
    dictionary = [v6 dictionary];
    v14 = [v42 arrayWithObject:dictionary];
  }

  else
  {
    v14 = 0;
  }

  return v14;
}

- (void)setEditing:(BOOL)editing animated:(BOOL)animated
{
  animatedCopy = animated;
  editingCopy = editing;
  if ([(CKChatController *)self isEditing]== editing)
  {
    navigationController = [(CKChatController *)self navigationController];
    [navigationController setToolbarHidden:editingCopy ^ 1 animated:animatedCopy];
  }

  else
  {
    v24.receiver = self;
    v24.super_class = CKChatController;
    [(CKChatController *)&v24 setEditing:editingCopy animated:animatedCopy];
    [(CKChatController *)self _updateNavigationButtons];
    if (editingCopy)
    {
      [(CKChatController *)self _updateToolbarItems];
      editingToolbarItems = [(CKChatController *)self editingToolbarItems];
      [(CKChatController *)self setToolbarItems:editingToolbarItems animated:0];

      v8 = CKIsAppCardsEnabled();
      inputController = [(CKCoreChatController *)self inputController];
      v10 = inputController;
      if (v8)
      {
        [inputController dismissAppCardIfNecessaryAnimated:animatedCopy completion:0];
      }

      else
      {
        [inputController forceDismissBrowserWithoutAnimation];
      }

      [(CKChatController *)self addOrRemoveEntryViewIfNeeded];
      [(CKChatController *)self removeFooterView];
      [(CKChatController *)self _hideCatchUpButtonIfNeededAndRemoveOnCompletion:0];
    }

    else
    {
      if ([(CKViewController *)self appeared])
      {
        [(CKChatController *)self becomeFirstResponder];
        [(CKChatController *)self reloadInputViews];
      }

      [(CKChatController *)self _updateToolbarItems];
      [(CKChatController *)self addOrRemoveEntryViewIfNeeded];
      [(CKChatController *)self reloadFooterViewControllerIfNecessary];
      [(CKChatController *)self _showCatchUpButtonIfNeeded];
    }

    collectionViewController = [(CKCoreChatController *)self collectionViewController];
    collectionView = [collectionViewController collectionView];

    aBlock[0] = MEMORY[0x1E69E9820];
    aBlock[1] = 3221225472;
    aBlock[2] = __40__CKChatController_setEditing_animated___block_invoke;
    aBlock[3] = &unk_1E72ED8D8;
    v23 = editingCopy;
    aBlock[4] = self;
    v13 = _Block_copy(aBlock);
    v20[0] = MEMORY[0x1E69E9820];
    v20[1] = 3221225472;
    v20[2] = __40__CKChatController_setEditing_animated___block_invoke_2;
    v20[3] = &unk_1E72ECCA8;
    v20[4] = self;
    v14 = collectionView;
    v21 = v14;
    v15 = _Block_copy(v20);
    v16 = +[CKAdaptivePresentationController sharedInstance];
    [v16 dismissViewControllerAnimated:animatedCopy completion:0];

    if (animatedCopy)
    {
      [MEMORY[0x1E69DD250] animateWithDuration:4 delay:v13 options:v15 animations:0.300000012 completion:0.0];
    }

    else
    {
      v13[2](v13);
      v15[2](v15, 1);
    }

    collectionViewController2 = [(CKCoreChatController *)self collectionViewController];
    [collectionViewController2 setEditing:editingCopy animated:animatedCopy];

    navigationController2 = [(CKChatController *)self navigationController];
    [navigationController2 setToolbarHidden:editingCopy ^ 1 animated:animatedCopy];
  }
}

uint64_t __40__CKChatController_setEditing_animated___block_invoke(uint64_t result)
{
  if ((*(result + 40) & 1) == 0)
  {
    return [*(result + 32) _updateEntryViewFrameIfNeeded:0];
  }

  return result;
}

void __40__CKChatController_setEditing_animated___block_invoke_2(uint64_t a1)
{
  [*(a1 + 32) addOrRemoveEntryViewIfNeeded];
  [*(a1 + 32) updateScrollGeometryWithoutAnimationForReason:@"CollectionViewEditModeChanged"];
  v2 = +[CKScrollViewAnimationProperties systemDefaultScrollAnimation];
  [*(a1 + 40) enforceTranscriptScrollIntentWithAnimationProperties:v2];
}

- (id)editingToolbarItems
{
  v3 = objc_alloc_init(MEMORY[0x1E695DF70]);
  v4 = [objc_alloc(MEMORY[0x1E69DC708]) initWithBarButtonSystemItem:16 target:self action:sel__deleteSelectedMessages_];
  [v4 setTag:0];
  v5 = +[CKUIBehavior sharedBehaviors];
  forwardImage = [v5 forwardImage];

  v7 = [objc_alloc(MEMORY[0x1E69DC708]) initWithImage:forwardImage style:0 target:self action:sel__editingToolbarSelectedForward_];
  [v7 setTag:1];
  [v3 addObject:v4];
  v8 = [objc_alloc(MEMORY[0x1E69DC708]) initWithBarButtonSystemItem:5 target:0 action:0];
  chat = [(CKCoreChatController *)self chat];
  chatItems = [chat chatItems];
  v11 = [chatItems arrayByApplyingSelector:sel__item];

  if (!IMSSMSReportSpamShouldShowReportMessagesForItems())
  {
    goto LABEL_11;
  }

  chat2 = [(CKCoreChatController *)self chat];
  messageCount = [chat2 messageCount];

  if (messageCount <= 1)
  {
    chat3 = [(CKCoreChatController *)self chat];
    messageCount2 = [chat3 messageCount];

    if (messageCount2 != 1)
    {
      v18 = 0;
      goto LABEL_8;
    }

    v14 = @"REPORT_SPAM_SMS_BUTTON_TITLE_SINGULAR";
  }

  else
  {
    v14 = @"REPORT_SPAM_SMS_BUTTON_TITLE_MULTIPLE";
  }

  v17 = CKFrameworkBundle();
  v18 = [v17 localizedStringForKey:v14 value:&stru_1F04268F8 table:@"ChatKit"];

LABEL_8:
  if ([v18 length])
  {
    v19 = [objc_alloc(MEMORY[0x1E69DC708]) initWithTitle:v18 style:0 target:self action:sel__reportSelectedMessages_];
    [v19 setTag:2];
    v20 = [objc_alloc(MEMORY[0x1E69DC708]) initWithBarButtonSystemItem:5 target:0 action:0];
    [v3 addObject:v20];
    [v3 addObject:v19];
  }

LABEL_11:
  [v3 addObject:v8];
  if ([(CKChatController *)self allowDebugItems])
  {
    internalBarButtonItems = [(CKChatController *)self internalBarButtonItems];
    [v3 addObjectsFromArray:internalBarButtonItems];
  }

  [v3 addObject:v7];

  return v3;
}

- (void)_updateToolbarItems
{
  v40 = *MEMORY[0x1E69E9840];
  if ([(CKChatController *)self isEditing])
  {
    collectionViewController = [(CKCoreChatController *)self collectionViewController];
    selectedItems = [collectionViewController selectedItems];
    chatItems = [collectionViewController chatItems];
    v6 = [chatItems objectsAtIndexes:selectedItems];

    if ([selectedItems count])
    {
      conversation = [(CKCoreChatController *)self conversation];
      isUserDeletable = [conversation isUserDeletable];
    }

    else
    {
      isUserDeletable = 0;
    }

    v34 = 0u;
    v35 = 0u;
    v9 = [selectedItems count] != 0;
    v36 = 0u;
    v37 = 0u;
    v10 = v6;
    v11 = [v10 countByEnumeratingWithState:&v34 objects:v39 count:16];
    if (v11)
    {
      v12 = v11;
      v13 = *v35;
      do
      {
        for (i = 0; i != v12; ++i)
        {
          if (*v35 != v13)
          {
            objc_enumerationMutation(v10);
          }

          v15 = *(*(&v34 + 1) + 8 * i);
          isUserDeletable = [v15 canDelete] & isUserDeletable;
          v9 = [v15 canForward] & v9;
        }

        v12 = [v10 countByEnumeratingWithState:&v34 objects:v39 count:16];
      }

      while (v12);
    }

    mEMORY[0x1E69A8070] = [MEMORY[0x1E69A8070] sharedFeatureFlags];
    isTranscriptSharingEnabled = [mEMORY[0x1E69A8070] isTranscriptSharingEnabled];

    if (isTranscriptSharingEnabled)
    {
      conversation2 = [(CKCoreChatController *)self conversation];
      chat = [conversation2 chat];
      isStewieSharingChat = [chat isStewieSharingChat];

      isUserDeletable = (isStewieSharingChat ^ 1) & isUserDeletable;
    }

    v32 = 0u;
    v33 = 0u;
    v30 = 0u;
    v31 = 0u;
    toolbarItems = [(CKChatController *)self toolbarItems];
    v22 = [toolbarItems countByEnumeratingWithState:&v30 objects:v38 count:16];
    if (v22)
    {
      v23 = v22;
      v24 = *v31;
      do
      {
        for (j = 0; j != v23; ++j)
        {
          if (*v31 != v24)
          {
            objc_enumerationMutation(toolbarItems);
          }

          v26 = *(*(&v30 + 1) + 8 * j);
          v27 = [v26 tag];
          v28 = isUserDeletable;
          if (v27)
          {
            v29 = [v26 tag];
            v28 = v9;
            if (v29 != 1)
            {
              if ([v26 tag] != 2)
              {
                continue;
              }

              v28 = 1;
            }
          }

          [v26 setEnabled:v28];
        }

        v23 = [toolbarItems countByEnumeratingWithState:&v30 objects:v38 count:16];
      }

      while (v23);
    }
  }
}

- (void)_deleteSelectedMessages:(id)messages
{
  messagesCopy = messages;
  collectionViewController = [(CKCoreChatController *)self collectionViewController];
  [collectionViewController deleteSelectedChatItems:messagesCopy];
}

- (void)_editingToolbarSelectedForward:(id)forward
{
  v40 = *MEMORY[0x1E69E9840];
  collectionViewController = [(CKCoreChatController *)self collectionViewController];
  selectedItems = [collectionViewController selectedItems];
  chatItems = [collectionViewController chatItems];
  v7 = [chatItems objectsAtIndexes:selectedItems];

  v36 = 0u;
  v37 = 0u;
  v34 = 0u;
  v35 = 0u;
  v8 = v7;
  v9 = [v8 countByEnumeratingWithState:&v34 objects:v39 count:16];
  if (v9)
  {
    v10 = v9;
    v11 = *v35;
    v12 = 1;
    do
    {
      for (i = 0; i != v10; ++i)
      {
        if (*v35 != v11)
        {
          objc_enumerationMutation(v8);
        }

        v12 &= [*(*(&v34 + 1) + 8 * i) canForward];
      }

      v10 = [v8 countByEnumeratingWithState:&v34 objects:v39 count:16];
    }

    while (v10);
  }

  else
  {
    v12 = 1;
  }

  if ([selectedItems count] && v12)
  {
    v14 = objc_opt_new();
    v29 = collectionViewController;
    chatItems2 = [collectionViewController chatItems];
    v16 = [chatItems2 objectsAtIndexes:selectedItems];

    v32 = 0u;
    v33 = 0u;
    v30 = 0u;
    v31 = 0u;
    v17 = v16;
    v18 = [v17 countByEnumeratingWithState:&v30 objects:v38 count:16];
    if (v18)
    {
      v19 = v18;
      v20 = *v31;
      do
      {
        for (j = 0; j != v19; ++j)
        {
          if (*v31 != v20)
          {
            objc_enumerationMutation(v17);
          }

          v22 = *(*(&v30 + 1) + 8 * j);
          objc_opt_class();
          if (objc_opt_isKindOfClass())
          {
            aggregateChatItems = [v22 aggregateChatItems];
            [v14 addObjectsFromArray:aggregateChatItems];
          }

          else
          {
            [v14 addObject:v22];
          }
        }

        v19 = [v17 countByEnumeratingWithState:&v30 objects:v38 count:16];
      }

      while (v19);
    }

    entryView = [(CKChatController *)self entryView];
    shouldShowSubject = [entryView shouldShowSubject];
    chatInputTranscriptIdentifier = [(CKChatController *)self chatInputTranscriptIdentifier];
    v27 = [CKComposition compositionForMessageParts:v14 preserveSubject:shouldShowSubject contextIdentifier:chatInputTranscriptIdentifier];

    [(CKChatController *)self setEditing:0 animated:1];
    delegate = [(CKCoreChatController *)self delegate];
    [delegate chatController:self forwardComposition:v27];

    collectionViewController = v29;
  }
}

- (void)_reportSelectedMessages:(id)messages
{
  collectionViewController = [(CKCoreChatController *)self collectionViewController];
  selectedItems = [collectionViewController selectedItems];
  chatItems = [collectionViewController chatItems];
  v6 = [chatItems objectsAtIndexes:selectedItems];
  v7 = [v6 arrayByApplyingSelector:sel_IMChatItem];

  chat = [(CKCoreChatController *)self chat];
  v9 = [chat messagesToReportAsSpamFromChatItems:v7];

  [(CKChatController *)self showSMSReportSpamExtensionControllerForMessages:v9];
}

- (void)_editCancelButtonPressed
{
  if ([(CKChatController *)self isEditing])
  {

    [(CKChatController *)self setEditing:0 animated:1];
  }

  else if (CKIsRunningInMessagesTranscriptExtension())
  {
    objc_opt_class();
    if (objc_opt_isKindOfClass())
    {

      [(CKChatController *)self dismissViewControllerAnimated:1 completion:0];
    }
  }
}

- (void)_doneButtonPressed
{
  delegate = [(CKCoreChatController *)self delegate];
  v4 = objc_opt_respondsToSelector();

  if (v4)
  {
    delegate2 = [(CKCoreChatController *)self delegate];
    [delegate2 doneButtonPressedForChatController:self];
  }
}

- (void)recoverableDeleteConversation
{
  v17[1] = *MEMORY[0x1E69E9840];
  conversation = [(CKCoreChatController *)self conversation];
  v17[0] = conversation;
  v4 = [MEMORY[0x1E695DEC8] arrayWithObjects:v17 count:1];

  v5 = [MEMORY[0x1E695DF00] now];
  v11 = MEMORY[0x1E69E9820];
  v12 = 3221225472;
  v13 = __49__CKChatController_recoverableDeleteConversation__block_invoke;
  v14 = &unk_1E72EB8D0;
  v15 = v4;
  v16 = v5;
  v6 = v5;
  v7 = v4;
  v8 = _Block_copy(&v11);
  v9 = objc_opt_new();
  [v9 setPresentationViewController:{self, v11, v12, v13, v14}];
  [v9 setTargetConversations:v7];
  [v9 setAlertsCompletedBlock:v8];
  v10 = [[CKConversationConfirmationAlertsController alloc] initWithConfiguration:v9];
  [(CKConversationConfirmationAlertsController *)v10 presentRecoverableConversationDeletionConfirmations];
}

void __49__CKChatController_recoverableDeleteConversation__block_invoke(uint64_t a1)
{
  v2 = +[CKConversationList sharedConversationList];
  [v2 recoverableDeleteForConversations:*(a1 + 32) deleteDate:*(a1 + 40) synchronousQuery:0 completionHandler:0];
}

- (void)layoutFooterView
{
  footerViewController = [(CKChatController *)self footerViewController];
  view = [(CKChatController *)self view];
  [view safeAreaInsets];
  v5 = v4;
  v7 = v6;
  v9 = v8;

  mEMORY[0x1E69A8070] = [MEMORY[0x1E69A8070] sharedFeatureFlags];
  isEntryViewRefreshEnabled = [mEMORY[0x1E69A8070] isEntryViewRefreshEnabled];

  if (isEntryViewRefreshEnabled)
  {
    v12 = v5 + v9;
    view2 = [(CKChatController *)self view];
    [view2 bounds];
    v15 = v14;
    v17 = v16;

    view3 = [footerViewController view];
    [view3 sizeThatFits:{v15 - v12, v17}];
    v20 = v19;
    v22 = v21;

    view4 = [(CKChatController *)self view];
    [view4 bounds];
    v24 = CGRectGetWidth(v41) - v12;

    v25 = v5 + (v24 - v20) * 0.5;
    view5 = [(CKChatController *)self view];
    [view5 bounds];
    v27 = CGRectGetHeight(v42) - v22 - v7;
  }

  else
  {
    v25 = *MEMORY[0x1E695F058];
    view6 = [(CKChatController *)self view];
    [view6 bounds];
    v30 = v29;
    v32 = v31;

    view7 = [footerViewController view];
    [view7 sizeThatFits:{v30, v32}];
    v20 = v34;
    v22 = v35;

    view5 = [(CKChatController *)self view];
    [view5 bounds];
    v27 = CGRectGetHeight(v43) - v22;
  }

  view8 = [footerViewController view];
  [view8 setFrame:{v25, v27, v20, v22}];

  view9 = [(CKChatController *)self view];
  view10 = [footerViewController view];
  [view9 bringSubviewToFront:view10];
}

- (void)removeFooterView
{
  footerViewController = self->_footerViewController;
  if (footerViewController)
  {
    [(UIViewController *)footerViewController willMoveToParentViewController:0];
    view = [(UIViewController *)self->_footerViewController view];
    [view removeFromSuperview];

    [(UIViewController *)self->_footerViewController removeFromParentViewController];
    v5 = self->_footerViewController;
    self->_footerViewController = 0;
  }
}

- (void)reloadFooterViewControllerIfNecessary
{
  mEMORY[0x1E69A8070] = [MEMORY[0x1E69A8070] sharedFeatureFlags];
  isTranscriptSharingEnabled = [mEMORY[0x1E69A8070] isTranscriptSharingEnabled];

  if (isTranscriptSharingEnabled)
  {
    conversation = [(CKCoreChatController *)self conversation];
    chat = [conversation chat];
    isStewieSharingChat = [chat isStewieSharingChat];

    if (isStewieSharingChat)
    {
      if (!self->_footerViewController)
      {
        v8 = [CKTranscriptSharingFooterViewController alloc];
        conversation2 = [(CKCoreChatController *)self conversation];
        v10 = [(CKTranscriptSharingFooterViewController *)v8 initWithConversation:conversation2];

        footerViewController = self->_footerViewController;
        self->_footerViewController = v10;
        v12 = v10;

        [(CKChatController *)self addChildViewController:self->_footerViewController];
        view = [(CKChatController *)self view];
        view2 = [(UIViewController *)self->_footerViewController view];
        [view addSubview:view2];

        [(UIViewController *)self->_footerViewController didMoveToParentViewController:self];
        collectionView = [(CKChatController *)self collectionView];
        [(UIViewController *)v12 configurePocketInteractionForScrollView:collectionView];

        [(CKChatController *)self layoutFooterView];
      }
    }

    else
    {

      [(CKChatController *)self removeFooterView];
    }
  }
}

- (void)setUpStyleForDarkEffect
{
  inlineReplyController = [(CKChatController *)self inlineReplyController];

  if (!inlineReplyController)
  {
    [(CKChatController *)self setNeedsDarkEffectStyleCleanUp:1];
    if (IMOSLoggingEnabled())
    {
      v4 = OSLogHandleForIMFoundationCategory();
      if (os_log_type_enabled(v4, OS_LOG_TYPE_INFO))
      {
        *v15 = 0;
        _os_log_impl(&dword_19020E000, v4, OS_LOG_TYPE_INFO, "Setting style for dark effect", v15, 2u);
      }
    }

    v5 = +[CKUIBehavior sharedBehaviors];
    isAppStripInKeyboard = [v5 isAppStripInKeyboard];

    if (isAppStripInKeyboard)
    {
      entryView = [(CKChatController *)self entryView];
      [entryView setStyle:1];
    }

    if (CKIsAppCardsEnabled())
    {
      entryView2 = [(CKChatController *)self entryView];
      [entryView2 setStyle:1];

      _viewControllerForModalPresentation = [(CKChatController *)self _viewControllerForModalPresentation];
      if (_viewControllerForModalPresentation != self)
      {
        traitCollection = [(CKChatController *)self traitCollection];
        v11 = [traitCollection userInterfaceStyle] == 2;

        [(CKChatController *)_viewControllerForModalPresentation setShowingDarkEffect:1 isInDarkMode:v11];
      }
    }

    conversation = [(CKCoreChatController *)self conversation];
    isBusinessConversation = [conversation isBusinessConversation];

    if ((isBusinessConversation & 1) == 0)
    {
      currentNavigationBarBasedOnSizeClass = [(CKChatController *)self currentNavigationBarBasedOnSizeClass];
      [currentNavigationBarBasedOnSizeClass setDarkEffectStyle:1];
    }

    [(CKChatController *)self _setBannersHidden:1];
  }
}

- (void)cleanUpDarkEffectStyle
{
  inlineReplyController = [(CKChatController *)self inlineReplyController];

  if (!inlineReplyController)
  {
    if ([(CKChatController *)self needsDarkEffectStyleCleanUp])
    {
      if (CKIsAppCardsEnabled())
      {
        _viewControllerForModalPresentation = [(CKChatController *)self _viewControllerForModalPresentation];
        if (_viewControllerForModalPresentation != self && (objc_opt_respondsToSelector() & 1) != 0)
        {
          traitCollection = [(CKChatController *)self traitCollection];
          v6 = [traitCollection userInterfaceStyle] == 2;

          [(CKChatController *)_viewControllerForModalPresentation setShowingDarkEffect:0 isInDarkMode:v6];
        }
      }

      traitCollection2 = [(CKChatController *)self traitCollection];
      entryView = [(CKChatController *)self entryView];
      [entryView setEntryViewTraitCollection:traitCollection2 resetStyle:1];

      [(CKMessageEntryBackgroundViewProtocol *)self->_keyboardCandidateBarBackgroundView setEntryViewTraitCollection:traitCollection2];
      conversation = [(CKCoreChatController *)self conversation];
      isBusinessConversation = [conversation isBusinessConversation];

      if ((isBusinessConversation & 1) == 0)
      {
        currentNavigationBarBasedOnSizeClass = [(CKChatController *)self currentNavigationBarBasedOnSizeClass];
        [currentNavigationBarBasedOnSizeClass setDarkEffectStyle:0];
      }

      [(CKChatController *)self _setBannersHidden:0];
      [(CKChatController *)self setNeedsDarkEffectStyleCleanUp:0];
    }

    else if (IMOSLoggingEnabled())
    {
      v11 = OSLogHandleForIMFoundationCategory();
      if (os_log_type_enabled(v11, OS_LOG_TYPE_INFO))
      {
        *buf = 0;
        _os_log_impl(&dword_19020E000, v11, OS_LOG_TYPE_INFO, "Skipping dark effect style clean up", buf, 2u);
      }
    }
  }
}

- (void)_setBannersHidden:(BOOL)hidden
{
  hiddenCopy = hidden;
  nicknameBanner = [(CKChatController *)self nicknameBanner];
  [nicknameBanner setHidden:hiddenCopy];

  groupPhotoUpdateBanner = [(CKChatController *)self groupPhotoUpdateBanner];
  [groupPhotoUpdateBanner setHidden:hiddenCopy];

  suggestionBannerView = [(CKChatController *)self suggestionBannerView];
  [suggestionBannerView setHidden:hiddenCopy];
}

- (id)_defaultTranscriptNavBarAppearance
{
  v9[1] = *MEMORY[0x1E69E9840];
  navigationItem = [(CKChatController *)self navigationItem];
  standardAppearance = [navigationItem standardAppearance];

  if (CKIsRunningInMacCatalyst())
  {
    v4 = [MEMORY[0x1E69DC730] effectWithStyle:4];
    v5 = +[CKUIBehavior sharedBehaviors];
    chatNavbarColor = [v5 chatNavbarColor];
    [standardAppearance setBackgroundColor:chatNavbarColor];
  }

  else
  {
    v4 = [MEMORY[0x1E69DC730] effectWithStyle:8];
  }

  v9[0] = v4;
  v7 = [MEMORY[0x1E695DEC8] arrayWithObjects:v9 count:1];
  [standardAppearance setBackgroundEffects:v7];

  return standardAppearance;
}

- (void)updateStyleForCurrentEffect
{
  OUTLINED_FUNCTION_9();
  v0 = objc_opt_class();
  v1 = NSStringFromClass(v0);
  OUTLINED_FUNCTION_10();
  OUTLINED_FUNCTION_0_3();
  _os_log_error_impl(v2, v3, v4, v5, v6, 0x16u);
}

- (BOOL)transcriptCollectionViewController:(id)controller shouldSetupFullscreenEffectUI:(id)i
{
  v18[1] = *MEMORY[0x1E69E9840];
  if ([i effectIsDark])
  {
    if (objc_opt_respondsToSelector())
    {
      [(CKChatController *)self setUpStyleForDarkEffect];
    }

    else
    {
      v6 = IMLogHandleForCategory();
      if (os_log_type_enabled(v6, OS_LOG_TYPE_ERROR))
      {
        [CKChatController updateStyleForCurrentEffect];
      }

      mEMORY[0x1E69A60F0] = [MEMORY[0x1E69A60F0] sharedInstance];
      isInternalInstall = [mEMORY[0x1E69A60F0] isInternalInstall];

      if (isInternalInstall)
      {
        v9 = MEMORY[0x1E696AEC0];
        v10 = objc_opt_class();
        v11 = NSStringFromClass(v10);
        v12 = [v9 stringWithFormat:@"<%p> ChatController (class: %@) does not respond to -setUpStyleForDarkEffect. Please file a radar.", self, v11];

        v13 = MEMORY[0x1E696ABC0];
        v17 = *MEMORY[0x1E696A278];
        v18[0] = v12;
        v14 = [MEMORY[0x1E695DF20] dictionaryWithObjects:v18 forKeys:&v17 count:1];
        v15 = [v13 errorWithDomain:@"CKChatControllerErrorDomain" code:0 userInfo:v14];

        mEMORY[0x1E69A8168] = [MEMORY[0x1E69A8168] sharedInstance];
        [mEMORY[0x1E69A8168] forceAutoBugCaptureWithSubType:@"Unexpected method list for CKChatController" errorPayload:v15];
      }
    }
  }

  else
  {
    [(CKChatController *)self cleanUpDarkEffectStyle];
  }

  return 1;
}

- (id)transcriptCollectionViewControllerOuterEffectPresentingView:(id)view
{
  v5.receiver = self;
  v5.super_class = CKChatController;
  v3 = [(CKCoreChatController *)&v5 transcriptCollectionViewControllerOuterEffectPresentingView:view];

  return v3;
}

- (id)_interfaceActionsForChatItem:(id)item
{
  itemCopy = item;
  array = [MEMORY[0x1E695DF70] array];
  objc_initWeak(location, self);
  v6 = &off_190DCE000;
  if (-[CKCoreChatController wantsReplyButton](self, "wantsReplyButton") && [itemCopy canInlineReply])
  {
    v7 = MEMORY[0x1E69DCB08];
    v8 = CKFrameworkBundle();
    v9 = [v8 localizedStringForKey:@"INLINE_REPLY_ORB_TITLE" value:&stru_1F04268F8 table:@"ChatKit"];
    v107[0] = MEMORY[0x1E69E9820];
    v107[1] = 3221225472;
    v107[2] = __49__CKChatController__interfaceActionsForChatItem___block_invoke;
    v107[3] = &unk_1E72EDFE0;
    objc_copyWeak(&v108, location);
    v10 = [v7 actionWithTitle:v9 type:0 handler:v107];

    [v10 setEnabled:{objc_msgSend(itemCopy, "canInlineReply")}];
    [array addObject:v10];

    objc_destroyWeak(&v108);
  }

  if ([itemCopy canRetract])
  {
    if ([itemCopy scheduleType] == 2)
    {
      v11 = CKFrameworkBundle();
      [v11 localizedStringForKey:@"DELETE_SCHEDULED_ACTION" value:&stru_1F04268F8 table:@"ChatKit"];
    }

    else
    {
      v11 = CKFrameworkBundle();
      [v11 localizedStringForKey:@"UNDO_SEND_ACTION" value:&stru_1F04268F8 table:@"ChatKit"];
    }
    v12 = ;

    v13 = MEMORY[0x1E69DCB08];
    v104[0] = MEMORY[0x1E69E9820];
    v104[1] = 3221225472;
    v104[2] = __49__CKChatController__interfaceActionsForChatItem___block_invoke_2;
    v104[3] = &unk_1E72EE008;
    objc_copyWeak(&v106, location);
    v105 = itemCopy;
    v14 = [v13 actionWithTitle:v12 type:0 handler:v104];
    [array addObject:v14];

    objc_destroyWeak(&v106);
  }

  if ([itemCopy canCopy])
  {
    v15 = MEMORY[0x1E69DCB08];
    v16 = CKFrameworkBundle();
    v17 = [v16 localizedStringForKey:@"COPY" value:&stru_1F04268F8 table:@"ChatKit"];
    v102[0] = MEMORY[0x1E69E9820];
    v102[1] = 3221225472;
    v102[2] = __49__CKChatController__interfaceActionsForChatItem___block_invoke_3;
    v102[3] = &unk_1E72EE030;
    v103 = itemCopy;
    v18 = [v15 actionWithTitle:v17 type:0 handler:v102];
    [array addObject:v18];
  }

  if ([itemCopy syndicationBehavior] == 1)
  {
    chat = [(CKCoreChatController *)self chat];
    isBusinessChat = [chat isBusinessChat];

    if ((isBusinessChat & 1) == 0)
    {
      if ([itemCopy isHighlighted])
      {
        v21 = CKFrameworkBundle();
        [v21 localizedStringForKey:@"REMOVE_PIN_ACTION" value:&stru_1F04268F8 table:@"ChatKit"];
      }

      else
      {
        v21 = CKFrameworkBundle();
        [v21 localizedStringForKey:@"ADD_PIN_ACTION" value:&stru_1F04268F8 table:@"ChatKit"];
      }
      v22 = ;

      v23 = MEMORY[0x1E69DCB08];
      v99[0] = MEMORY[0x1E69E9820];
      v99[1] = 3221225472;
      v99[2] = __49__CKChatController__interfaceActionsForChatItem___block_invoke_4;
      v99[3] = &unk_1E72EE058;
      v100 = itemCopy;
      objc_copyWeak(&v101, location);
      v24 = [v23 actionWithTitle:v22 type:0 handler:v99];
      [array addObject:v24];

      objc_destroyWeak(&v101);
    }
  }

  if ([CKTranslatorUtilities shouldShowTranslateMenuOption:itemCopy])
  {
    v25 = [CKTranslationMenu translateActionForChatItem:itemCopy forController:self];
    [array addObject:v25];
  }

  if ([itemCopy canExport])
  {
    v26 = CKFrameworkBundle();
    v27 = [v26 localizedStringForKey:@"BALLOON_EXPORT_CALLOUT" value:&stru_1F04268F8 table:@"ChatKit"];

    objc_opt_class();
    if (objc_opt_isKindOfClass())
    {
      v28 = CKFrameworkBundle();
      v29 = [v28 localizedStringForKey:@"AUDIO_MESSAGE_SAVE" value:&stru_1F04268F8 table:@"ChatKit"];

      v27 = v29;
    }

    v30 = MEMORY[0x1E69DCB08];
    v97[0] = MEMORY[0x1E69E9820];
    v97[1] = 3221225472;
    v97[2] = __49__CKChatController__interfaceActionsForChatItem___block_invoke_5;
    v97[3] = &unk_1E72EE030;
    v98 = itemCopy;
    v31 = [v30 actionWithTitle:v27 type:0 handler:v97];
    [array addObject:v31];
  }

  if ([itemCopy canSendAsTextMessage])
  {
    iMChatItem = [itemCopy IMChatItem];
    iMChatItem2 = [itemCopy IMChatItem];
    objc_opt_class();
    isKindOfClass = objc_opt_isKindOfClass();

    if ((isKindOfClass & 1) == 0)
    {
LABEL_34:

      goto LABEL_35;
    }

    message = [iMChatItem message];
    WeakRetained = objc_loadWeakRetained(location);
    conversation = [WeakRetained conversation];

    if (-[CKChatController _smsEnabled](self, "_smsEnabled") && [message isFromMe] && (objc_msgSend(message, "isDelivered") & 1) == 0)
    {
      error = [message error];
      if (!error)
      {
        if ([conversation isGroupConversation])
        {
          goto LABEL_33;
        }

        v39 = objc_loadWeakRetained(location);
        collectionViewController = [v39 collectionViewController];
        chatItems = [collectionViewController chatItems];

        guid = [message guid];
        v42 = [chatItems __ck_indexesOfPartsOfMessageWithGUID:guid];
        v43 = [chatItems objectsAtIndexes:v42];

        textInputContextIdentifier = [(CKCoreChatController *)self textInputContextIdentifier];
        v45 = [CKComposition compositionForMessageParts:v43 preserveSubject:1 contextIdentifier:textInputContextIdentifier];

        LOBYTE(textInputContextIdentifier) = [conversation canSendComposition:v45 error:0];
        v6 = &off_190DCE000;
        if ((textInputContextIdentifier & 1) == 0)
        {
          goto LABEL_33;
        }

        error = [conversation fallbackSendString];
        v46 = MEMORY[0x1E69DCB08];
        v92[0] = MEMORY[0x1E69E9820];
        v92[1] = 3221225472;
        v92[2] = __49__CKChatController__interfaceActionsForChatItem___block_invoke_1488;
        v92[3] = &unk_1E72EE080;
        v93 = message;
        v94 = conversation;
        objc_copyWeak(&v96, location);
        selfCopy = self;
        v47 = [v46 actionWithTitle:error type:0 handler:v92];
        [array addObject:v47];

        objc_destroyWeak(&v96);
        v6 = &off_190DCE000;
      }
    }

LABEL_33:

    goto LABEL_34;
  }

LABEL_35:
  visibleAssociatedMessageChatItems = [itemCopy visibleAssociatedMessageChatItems];

  if (visibleAssociatedMessageChatItems)
  {
    v49 = objc_alloc_init(MEMORY[0x1E695DF70]);
    visibleAssociatedMessageChatItems2 = [itemCopy visibleAssociatedMessageChatItems];
    v90[0] = MEMORY[0x1E69E9820];
    v51 = *(v6 + 189);
    v90[1] = v51;
    v90[2] = __49__CKChatController__interfaceActionsForChatItem___block_invoke_2_1494;
    v90[3] = &unk_1E72EC100;
    v52 = v49;
    v91 = v52;
    [visibleAssociatedMessageChatItems2 enumerateObjectsUsingBlock:v90];

    if ([v52 count])
    {
      v53 = MEMORY[0x1E69DCB08];
      v54 = CKFrameworkBundle();
      v55 = [v54 localizedStringForKey:@"BALLOON_STICKER_CALLOUT" value:&stru_1F04268F8 table:@"ChatKit"];
      v88[0] = MEMORY[0x1E69E9820];
      v88[1] = v51;
      v88[2] = __49__CKChatController__interfaceActionsForChatItem___block_invoke_3_1498;
      v88[3] = &unk_1E72EE0A8;
      v88[4] = self;
      v89 = v52;
      v56 = [v53 actionWithTitle:v55 type:0 handler:v88];
      [array addObject:v56];
    }
  }

  objc_opt_class();
  if (objc_opt_isKindOfClass())
  {
    mediaObject = [itemCopy mediaObject];
    transfer = [mediaObject transfer];
    attributionInfo = [transfer attributionInfo];

    if (attributionInfo)
    {
      __ck_localizedAppNameForTranscriptAttribution = [attributionInfo __ck_localizedAppNameForTranscriptAttribution];
      if (__ck_localizedAppNameForTranscriptAttribution)
      {
        selfCopy2 = self;
        v61 = array;
        v62 = v6;
        v63 = MEMORY[0x1E69DCB08];
        v64 = MEMORY[0x1E696AEC0];
        v65 = CKFrameworkBundle();
        v66 = [v65 localizedStringForKey:@"MEDIA_ATTRIBUTION_TITLE_FORMAT" value:&stru_1F04268F8 table:@"ChatKit"];
        v67 = [v64 stringWithFormat:v66, __ck_localizedAppNameForTranscriptAttribution];

        mEMORY[0x1E69DC668] = [MEMORY[0x1E69DC668] sharedApplication];
        userInterfaceLayoutDirection = [mEMORY[0x1E69DC668] userInterfaceLayoutDirection];

        if (userInterfaceLayoutDirection == 1)
        {
          v70 = @"\u200F";
        }

        else
        {
          v70 = @"\u200E";
        }

        v71 = [(__CFString *)v70 stringByAppendingString:v67];

        v85[0] = MEMORY[0x1E69E9820];
        v85[1] = *(v62 + 189);
        v85[2] = __49__CKChatController__interfaceActionsForChatItem___block_invoke_4_1502;
        v85[3] = &unk_1E72EE058;
        v86 = attributionInfo;
        objc_copyWeak(&v87, location);
        v72 = [v63 actionWithTitle:v71 type:0 handler:v85];
        [v61 addObject:v72];

        objc_destroyWeak(&v87);
        v6 = v62;
        array = v61;
        self = selfCopy2;
      }
    }
  }

  v73 = objc_loadWeakRetained(location);
  conversation2 = [v73 conversation];
  if ([conversation2 isPending])
  {
  }

  else
  {
    isInline = [(CKCoreChatController *)self isInline];

    if (!isInline)
    {
      v76 = MEMORY[0x1E69DCB08];
      v77 = CKFrameworkBundle();
      v78 = [v77 localizedStringForKey:@"BALLOON_MORE_CALLOUT" value:&stru_1F04268F8 table:@"ChatKit"];
      v83[0] = MEMORY[0x1E69E9820];
      v83[1] = *(v6 + 189);
      v83[2] = __49__CKChatController__interfaceActionsForChatItem___block_invoke_6_1507;
      v83[3] = &unk_1E72EE0A8;
      v83[4] = self;
      v84 = itemCopy;
      v79 = [v76 actionWithTitle:v78 type:0 handler:v83];
      [array addObject:v79];
    }
  }

  objc_destroyWeak(location);

  return array;
}

void __49__CKChatController__interfaceActionsForChatItem___block_invoke(uint64_t a1, uint64_t a2, _BYTE *a3)
{
  WeakRetained = objc_loadWeakRetained((a1 + 32));
  [WeakRetained setWantsInlineOverlay:1];

  *a3 = 1;
}

void __49__CKChatController__interfaceActionsForChatItem___block_invoke_2(uint64_t a1, uint64_t a2, _BYTE *a3)
{
  WeakRetained = objc_loadWeakRetained((a1 + 40));
  [WeakRetained actionRetractIsTappedForChatItem:*(a1 + 32)];

  *a3 = 1;
}

void __49__CKChatController__interfaceActionsForChatItem___block_invoke_3(uint64_t a1, uint64_t a2, _BYTE *a3)
{
  v5 = [MEMORY[0x1E69DCD50] generalPasteboard];
  v6 = [*(a1 + 32) pasteboardItemProviders];
  [v5 setItemProviders:v6];

  *a3 = 1;
}

void __49__CKChatController__interfaceActionsForChatItem___block_invoke_4(uint64_t a1, uint64_t a2, _BYTE *a3)
{
  v5 = [*(a1 + 32) isHighlighted];
  WeakRetained = objc_loadWeakRetained((a1 + 40));
  v7 = [WeakRetained conversation];
  v8 = [v7 chat];
  v9 = [*(a1 + 32) IMChatItem];
  v10 = [v9 guid];
  v12 = [*(a1 + 32) messagePartRange];
  if (v5)
  {
    v13 = 0;
  }

  else
  {
    v13 = 4;
  }

  [v8 sendSyndicationAction:v13 forMessagePartGUID:v10 syndicatedMessagePartRange:{v12, v11}];

  *a3 = 1;
}

void __49__CKChatController__interfaceActionsForChatItem___block_invoke_5(uint64_t a1, uint64_t a2, _BYTE *a3)
{
  v4 = *(a1 + 32);
  v5 = [v4 mediaObject];
  objc_opt_class();
  if (objc_opt_isKindOfClass())
  {
    v6 = [v4 sender];
    v7 = MEMORY[0x1E696AEC0];
    v8 = CKFrameworkBundle();
    v9 = [v8 localizedStringForKey:@"AUDIO_MESSAGE_VOICE_MEMO_LABEL" value:&stru_1F04268F8 table:@"ChatKit"];
    if ([v6 hasName])
    {
      [v6 name];
    }

    else
    {
      [v6 displayID];
    }
    v11 = ;
    v12 = [v7 stringWithFormat:v9, v11];

    v13 = [MEMORY[0x1E69DC668] sharedApplication];
    v14 = [v13 userInterfaceLayoutDirection];

    if (v14 == 1)
    {
      v15 = @"\u200F";
    }

    else
    {
      v15 = @"\u200E";
    }

    v10 = [(__CFString *)v15 stringByAppendingString:v12];
  }

  else
  {
    v10 = 0;
  }

  v16 = objc_alloc_init(CKMediaObjectExportManager);
  [(CKMediaObjectExportManager *)v16 setMetricsSource:*MEMORY[0x1E69A7628]];
  v18[0] = MEMORY[0x1E69E9820];
  v18[1] = 3221225472;
  v18[2] = __49__CKChatController__interfaceActionsForChatItem___block_invoke_6;
  v18[3] = &unk_1E72EC088;
  v19 = v5;
  v17 = v5;
  [(CKMediaObjectExportManager *)v16 exportMediaObject:v17 withFileName:v10 completion:v18];
  *a3 = 1;
}

void __49__CKChatController__interfaceActionsForChatItem___block_invoke_6(uint64_t a1, int a2, void *a3)
{
  v14 = *MEMORY[0x1E69E9840];
  v5 = a3;
  v6 = IMOSLoggingEnabled();
  if (a2)
  {
    if (v6)
    {
      v7 = OSLogHandleForIMFoundationCategory();
      if (os_log_type_enabled(v7, OS_LOG_TYPE_INFO))
      {
        v8 = *(a1 + 32);
        v10 = 138412290;
        v11 = v8;
        _os_log_impl(&dword_19020E000, v7, OS_LOG_TYPE_INFO, "Successfully exported media object: %@", &v10, 0xCu);
      }

LABEL_9:
    }
  }

  else if (v6)
  {
    v7 = OSLogHandleForIMFoundationCategory();
    if (os_log_type_enabled(v7, OS_LOG_TYPE_INFO))
    {
      v9 = *(a1 + 32);
      v10 = 138412546;
      v11 = v5;
      v12 = 2112;
      v13 = v9;
      _os_log_impl(&dword_19020E000, v7, OS_LOG_TYPE_INFO, "Error exporting media object. error: %@, mediaObject: %@", &v10, 0x16u);
    }

    goto LABEL_9;
  }
}

void __49__CKChatController__interfaceActionsForChatItem___block_invoke_1488(uint64_t a1, void *a2, _BYTE *a3)
{
  v23 = *MEMORY[0x1E69E9840];
  v5 = a2;
  if (IMOSLoggingEnabled())
  {
    CKLogCStringForType(29);
    v6 = OSLogHandleForIMFoundationCategory();
    if (os_log_type_enabled(v6, OS_LOG_TYPE_INFO))
    {
      v7 = [*(a1 + 32) guid];
      v8 = *(a1 + 40);
      *buf = 138412546;
      v20 = v7;
      v21 = 2112;
      v22 = v8;
      _os_log_impl(&dword_19020E000, v6, OS_LOG_TYPE_INFO, "Manually downgrading message with GUID {%@} -- conversation:%@", buf, 0x16u);
    }
  }

  if (os_log_shim_legacy_logging_enabled() && _CKShouldLogExternal())
  {
    v14 = [*(a1 + 32) guid];
    v15 = *(a1 + 40);
    _CKLogExternal();
  }

  v9 = [*(a1 + 40) chat];
  [v9 downgradeMessage:*(a1 + 32) manualDowngrade:1];

  v10 = [*(a1 + 32) __ck_downgradedMessage];
  WeakRetained = objc_loadWeakRetained((a1 + 56));
  v12 = [WeakRetained collectionViewController];
  v16[0] = MEMORY[0x1E69E9820];
  v16[1] = 3221225472;
  v16[2] = __49__CKChatController__interfaceActionsForChatItem___block_invoke_1492;
  v16[3] = &unk_1E72EB880;
  v16[4] = *(a1 + 48);
  v17 = v10;
  v18 = *(a1 + 40);
  v13 = v10;
  [v12 updateTranscript:v16 animated:0 completion:0];

  *a3 = 1;
}

void __49__CKChatController__interfaceActionsForChatItem___block_invoke_1492(void *a1)
{
  v1 = a1[4];
  v2 = a1[5];
  v3 = a1[6];
  v4 = [MEMORY[0x1E69A5C90] smsService];
  [v1 sendMessage:v2 forConversation:v3 onService:v4 newComposition:0];
}

void __49__CKChatController__interfaceActionsForChatItem___block_invoke_2_1494(uint64_t a1, void *a2)
{
  v3 = a2;
  objc_opt_class();
  if (objc_opt_isKindOfClass())
  {
    [*(a1 + 32) addObject:v3];
  }
}

void __49__CKChatController__interfaceActionsForChatItem___block_invoke_3_1498(uint64_t a1, uint64_t a2, _BYTE *a3)
{
  v5 = [*(a1 + 32) fullScreenBalloonViewController];
  [v5 presentStickerDetailControllerWithStickers:*(a1 + 40)];

  *a3 = 0;
}

void __49__CKChatController__interfaceActionsForChatItem___block_invoke_4_1502(uint64_t a1, uint64_t a2, _BYTE *a3)
{
  v5 = dispatch_time(0, 200000000);
  v6[0] = MEMORY[0x1E69E9820];
  v6[1] = 3221225472;
  v6[2] = __49__CKChatController__interfaceActionsForChatItem___block_invoke_5_1503;
  v6[3] = &unk_1E72EE0D0;
  v7 = *(a1 + 32);
  objc_copyWeak(&v8, (a1 + 40));
  dispatch_after(v5, MEMORY[0x1E69E96A0], v6);
  *a3 = 1;
  objc_destroyWeak(&v8);
}

void __49__CKChatController__interfaceActionsForChatItem___block_invoke_5_1503(uint64_t a1)
{
  v6 = [*(a1 + 32) objectForKey:*MEMORY[0x1E69A6FA0]];
  v2 = [*(a1 + 32) objectForKey:*MEMORY[0x1E69A6FB0]];
  objc_opt_class();
  if (objc_opt_isKindOfClass())
  {
    v3 = [MEMORY[0x1E696AD98] numberWithLongLong:{objc_msgSend(v6, "longLongValue")}];

    v6 = v3;
  }

  v4 = [*(a1 + 32) objectForKey:*MEMORY[0x1E69A6FF0]];
  WeakRetained = objc_loadWeakRetained((a1 + 40));
  [WeakRetained _presentBrowserOrAppStoreForAdamID:v6 url:v4 identifier:v2];
}

uint64_t __49__CKChatController__interfaceActionsForChatItem___block_invoke_6_1507(uint64_t a1, uint64_t a2, _BYTE *a3)
{
  result = [*(a1 + 32) actionMoreIsTappedForChatItem:*(a1 + 40)];
  *a3 = 1;
  return result;
}

- (void)actionCancelIsTappedForChatItem:(id)item
{
  itemCopy = item;
  objc_opt_class();
  v4 = itemCopy;
  if (objc_opt_isKindOfClass())
  {
    v4 = [(CKChatController *)self currentTopChatItemForAggregateChatItem:itemCopy];
  }

  conversation = [(CKCoreChatController *)self conversation];
  iMChatItem = [v4 IMChatItem];
  [conversation retractMessagePart:iMChatItem];
}

- (void)actionRetractIsTappedForChatItem:(id)item
{
  itemCopy = item;
  objc_opt_class();
  v5 = itemCopy;
  if (objc_opt_isKindOfClass())
  {
    v5 = [(CKChatController *)self currentTopChatItemForAggregateChatItem:itemCopy];
  }

  v6 = dispatch_time(0, 500000000);
  v13 = MEMORY[0x1E69E9820];
  v14 = 3221225472;
  v15 = __53__CKChatController_actionRetractIsTappedForChatItem___block_invoke;
  v16 = &unk_1E72EB8D0;
  selfCopy = self;
  v18 = v5;
  v7 = v5;
  dispatch_after(v6, MEMORY[0x1E69E96A0], &v13);
  mEMORY[0x1E69A8168] = [MEMORY[0x1E69A8168] sharedInstance];
  [mEMORY[0x1E69A8168] trackEvent:*MEMORY[0x1E69A76D0]];

  tipManager = [(CKChatController *)self tipManager];
  [tipManager undoOrEditMessageUsed];

  v10 = MEMORY[0x1E696AD98];
  [itemCopy timeIntervalSinceMessageSent];
  v11 = [v10 numberWithDouble:?];
  mEMORY[0x1E69A8168]2 = [MEMORY[0x1E69A8168] sharedInstance];
  [mEMORY[0x1E69A8168]2 trackEvent:*MEMORY[0x1E69A76D8] withStatistic:v11];
}

void __53__CKChatController_actionRetractIsTappedForChatItem___block_invoke(uint64_t a1)
{
  v11 = *MEMORY[0x1E69E9840];
  v2 = (a1 + 32);
  v3 = [*(a1 + 32) collectionViewController];
  if ([*v2 transcriptCollectionViewControllerPlaybackForOutgoingEffectsIsAllowed:v3])
  {
    v4 = [v3 impactEffectManager];
    [v4 playUndoSendAnimationForChatItem:*(a1 + 40)];
  }

  v5 = [*(a1 + 32) conversation];
  v6 = [*(a1 + 40) IMChatItem];
  [v5 retractMessagePart:v6];
  if (IMOSLoggingEnabled())
  {
    v7 = OSLogHandleForIMFoundationCategory();
    if (os_log_type_enabled(v7, OS_LOG_TYPE_INFO))
    {
      v9 = 136315138;
      v10 = "[CKChatController actionRetractIsTappedForChatItem:]_block_invoke";
      _os_log_impl(&dword_19020E000, v7, OS_LOG_TYPE_INFO, "%s requesting purge of default snapshot", &v9, 0xCu);
    }
  }

  v8 = objc_alloc_init(MEMORY[0x1E69D41A0]);
  [v8 deleteSnapshotsForApplicationIdentifier:@"com.apple.MobileSMS"];
  [v8 invalidate];
}

- (void)actionMoreIsTappedForChatItem:(id)item
{
  itemCopy = item;
  [(CKChatController *)self setEditing:1 animated:1];
  collectionViewController = [(CKCoreChatController *)self collectionViewController];
  selectionManager = [collectionViewController selectionManager];
  [selectionManager removeAllSelectedMessageGuids];

  if (itemCopy)
  {
    collectionViewController2 = [(CKCoreChatController *)self collectionViewController];
    [collectionViewController2 selectChatItem:itemCopy];
  }

  [(CKChatController *)self _updateToolbarItems];
  view = [(CKChatController *)self view];
  window = [view window];
  firstResponder = [window firstResponder];
  [firstResponder reloadInputViews];
}

- (CGRect)fullScreenBalloonViewController:(id)controller stickerBoundsForChatItem:(id)item
{
  itemCopy = item;
  collectionViewController = [(CKCoreChatController *)self collectionViewController];
  v7 = [collectionViewController cellForAssociatedChatItem:itemCopy];

  associatedItemView = [v7 associatedItemView];
  if (associatedItemView)
  {
    view = [(CKChatController *)self view];
    [associatedItemView bounds];
    v11 = v10;
    v13 = v12;
    v15 = v14;
    v17 = v16;
    superview = [associatedItemView superview];
    [view convertRect:superview fromView:{v11, v13, v15, v17}];
    v20 = v19;
    v22 = v21;
    v24 = v23;
    v26 = v25;
  }

  else
  {
    v20 = *MEMORY[0x1E695F058];
    v22 = *(MEMORY[0x1E695F058] + 8);
    v24 = *(MEMORY[0x1E695F058] + 16);
    v26 = *(MEMORY[0x1E695F058] + 24);
  }

  v27 = v20;
  v28 = v22;
  v29 = v24;
  v30 = v26;
  result.size.height = v30;
  result.size.width = v29;
  result.origin.y = v28;
  result.origin.x = v27;
  return result;
}

- (CGPoint)fullScreenBalloonViewController:(id)controller stickerCenterForChatItem:(id)item
{
  itemCopy = item;
  collectionViewController = [(CKCoreChatController *)self collectionViewController];
  v7 = [collectionViewController cellForAssociatedChatItem:itemCopy];

  associatedItemView = [v7 associatedItemView];
  if (associatedItemView)
  {
    view = [(CKChatController *)self view];
    [associatedItemView center];
    v11 = v10;
    v13 = v12;
    superview = [associatedItemView superview];
    [view convertPoint:superview fromView:{v11, v13}];
    v16 = v15;
    v18 = v17;
  }

  else
  {
    v16 = *MEMORY[0x1E695EFF8];
    v18 = *(MEMORY[0x1E695EFF8] + 8);
  }

  v19 = v16;
  v20 = v18;
  result.y = v20;
  result.x = v19;
  return result;
}

- (BOOL)shouldShowFullScreenAcknowledgmentPickerForChatItem:(id)item
{
  itemCopy = item;
  if ([(CKChatController *)self isShowingOscarChat]|| [(CKChatController *)self isEditingMessage])
  {
    v5 = 0;
  }

  else
  {
    v7.receiver = self;
    v7.super_class = CKChatController;
    v5 = [(CKCoreChatController *)&v7 shouldShowFullScreenAcknowledgmentPickerForChatItem:itemCopy];
  }

  return v5;
}

- (BOOL)shouldShowTapbackPickerForChatItem:(id)item
{
  itemCopy = item;
  objc_opt_class();
  if (objc_opt_isKindOfClass() & 1) != 0 && (v5 = MEMORY[0x1E69A5B80], v6 = itemCopy, [v5 sharedInstance], v7 = objc_claimAutoreleasedReturnValue(), objc_msgSend(v6, "transferGUID"), v8 = objc_claimAutoreleasedReturnValue(), v6, objc_msgSend(v7, "transferForGUID:", v8), v9 = objc_claimAutoreleasedReturnValue(), v8, v7, LOBYTE(v7) = +[CKCommSafetyHelper shouldDisableTranscriptCapabilitiesForFileTransfer:](CKCommSafetyHelper, "shouldDisableTranscriptCapabilitiesForFileTransfer:", v9), v9, (v7))
  {
    v10 = 0;
  }

  else
  {
    v12.receiver = self;
    v12.super_class = CKChatController;
    v10 = [(CKCoreChatController *)&v12 shouldShowTapbackPickerForChatItem:itemCopy];
  }

  return v10;
}

- (BOOL)shouldDismissKeyboardWhenShowingFullScreenAcknowledgmentPickerForBalloonChatItem:(id)item
{
  [(CKChatController *)self fullScreenBalloonViewController:0 balloonFrameForChatItem:item];
  MaxY = CGRectGetMaxY(v19);
  view = [(CKChatController *)self view];
  [view bounds];
  Height = CGRectGetHeight(v20);
  collectionView = [(CKChatController *)self collectionView];
  [collectionView contentInset];
  v9 = v8;

  isCollapsed = [(CKCoreChatController *)self isCollapsed];
  v11 = +[CKUIBehavior sharedBehaviors];
  canPresentOverKeyboard = [v11 canPresentOverKeyboard];
  if (MaxY <= Height - v9)
  {
    v13 = canPresentOverKeyboard;
  }

  else
  {
    v13 = 0;
  }

  v14 = v13 & isCollapsed;
  if ((v13 & isCollapsed & 1) == 0)
  {
    entryView = [(CKChatController *)self entryView];
    contentView = [entryView contentView];
    isActive = [contentView isActive];

    if (isActive)
    {
      [(CKChatController *)self setEntryViewWasActiveOnContextMenuPresentation:1];
      [(CKChatController *)self setTargetFirstResponder:1];
    }
  }

  return v14 ^ 1;
}

- (void)fullScreenBalloonViewController:(id)controller didTapToSaveSticker:(id)sticker
{
  stickerCopy = sticker;
  v7[0] = MEMORY[0x1E69E9820];
  v7[1] = 3221225472;
  v7[2] = __72__CKChatController_fullScreenBalloonViewController_didTapToSaveSticker___block_invoke;
  v7[3] = &unk_1E72EB8D0;
  v7[4] = self;
  v8 = stickerCopy;
  v6 = stickerCopy;
  [(CKChatController *)self _dismissFullScreenBubbleViewControllerAnimated:1 withSendAnimation:0 completion:v7];
}

- (void)fullScreenBalloonViewControllerWillTransitionToKeyboardInput:(id)input
{
  [(CKChatController *)self hideExistingKeyboardSnapshot];

  [(CKChatController *)self updateActiveEntryViewPositioningGuide];
}

- (void)fullScreenBalloonViewControllerWillReturnToSuggestionsPicker:(id)picker
{
  [(CKChatController *)self revealExistingKeyboardSnapshot];

  [(CKChatController *)self updateActiveEntryViewPositioningGuide];
}

- (BOOL)showFullScreenAcknowledgmentPickerIfNeededForBalloonAtIndexPath:(id)path
{
  pathCopy = path;
  if (!pathCopy)
  {
LABEL_8:
    LOBYTE(v7) = 0;
    goto LABEL_14;
  }

  if (![(CKCoreChatController *)self isInline])
  {
    inlineReplyController = [(CKChatController *)self inlineReplyController];

    if (inlineReplyController)
    {
      if (IMOSLoggingEnabled())
      {
        v6 = OSLogHandleForIMFoundationCategory();
        if (os_log_type_enabled(v6, OS_LOG_TYPE_INFO))
        {
          *buf = 0;
          _os_log_impl(&dword_19020E000, v6, OS_LOG_TYPE_INFO, "Not presenting tapback picker: inlineReplyController active", buf, 2u);
        }
      }

      goto LABEL_8;
    }
  }

  collectionViewController = [(CKCoreChatController *)self collectionViewController];
  chatItems = [collectionViewController chatItems];
  v10 = [chatItems objectAtIndex:{objc_msgSend(pathCopy, "item")}];

  v13.receiver = self;
  v13.super_class = CKChatController;
  v7 = [(CKCoreChatController *)&v13 showFullScreenAcknowledgmentPickerIfNeededForBalloonAtIndexPath:pathCopy];
  if (v7)
  {
    if ([(CKChatController *)self shouldDismissKeyboardWhenShowingFullScreenAcknowledgmentPickerForBalloonChatItem:v10])
    {
      inputController = [(CKCoreChatController *)self inputController];
      [inputController dismissBrowserViewController];

      [(CKChatController *)self dismissKeyboard];
    }

    [(CKChatController *)self hideAssociatedCellsForChatItem:v10];
    [(CKChatController *)self updateActiveEntryViewPositioningGuide];
  }

LABEL_14:
  return v7;
}

- (void)hideAssociatedCellsForChatItem:(id)item
{
  v21 = *MEMORY[0x1E69E9840];
  v16 = 0u;
  v17 = 0u;
  v18 = 0u;
  v19 = 0u;
  obj = [item visibleAssociatedMessageChatItems];
  v3 = [obj countByEnumeratingWithState:&v16 objects:v20 count:16];
  if (v3)
  {
    v4 = v3;
    v5 = *v17;
    do
    {
      v6 = 0;
      do
      {
        if (*v17 != v5)
        {
          objc_enumerationMutation(obj);
        }

        v7 = *(*(&v16 + 1) + 8 * v6);
        objc_opt_class();
        isKindOfClass = objc_opt_isKindOfClass();
        objc_opt_class();
        v9 = objc_opt_isKindOfClass();
        v10 = +[CKUIBehavior sharedBehaviors];
        longPressHidesAssociatedAcknowledgments = [v10 longPressHidesAssociatedAcknowledgments];

        if (isKindOfClass & 1) != 0 || (v9 & longPressHidesAssociatedAcknowledgments)
        {
          collectionViewController = [(CKCoreChatController *)self collectionViewController];
          v13 = [collectionViewController cellForAssociatedChatItem:v7];

          [v13 performHide:0];
        }

        ++v6;
      }

      while (v4 != v6);
      v4 = [obj countByEnumeratingWithState:&v16 objects:v20 count:16];
    }

    while (v4);
  }
}

- (void)setIgnoresAutomaticScrollsTowardBottom:(BOOL)bottom
{
  bottomCopy = bottom;
  collectionViewController = [(CKCoreChatController *)self collectionViewController];
  collectionView = [collectionViewController collectionView];

  [collectionView setIgnoresAutomaticScrollsTowardBottom:bottomCopy];
}

- (void)showSMSReportSpamExtensionControllerForMessages:(id)messages
{
  v48 = *MEMORY[0x1E69E9840];
  messagesCopy = messages;
  v5 = MEMORY[0x193AF5EC0](@"ILMessageCommunication", @"IdentityLookup");
  v33 = MEMORY[0x193AF5EC0](@"ILMessageClassificationRequest", @"IdentityLookup");
  v6 = MEMORY[0x193AF5EC0](@"ILClassificationUIExtensionHostViewController", @"IdentityLookupUI");
  if (v5 && v33 && v6)
  {
    v29 = v6;
    v32 = messagesCopy;
    if (IMOSLoggingEnabled())
    {
      v7 = OSLogHandleForIMFoundationCategory();
      if (os_log_type_enabled(v7, OS_LOG_TYPE_INFO))
      {
        *buf = 0;
        _os_log_impl(&dword_19020E000, v7, OS_LOG_TYPE_INFO, "SMS Report Spam classes exist -- going to display controller", buf, 2u);
      }
    }

    selfCopy = self;
    chat = [(CKCoreChatController *)self chat];
    participants = [chat participants];
    firstObject = [participants firstObject];

    v35 = objc_alloc_init(MEMORY[0x1E695DF70]);
    v43 = 0u;
    v44 = 0u;
    v41 = 0u;
    v42 = 0u;
    obj = v32;
    v10 = [obj countByEnumeratingWithState:&v41 objects:v47 count:16];
    if (v10)
    {
      v11 = *v42;
      do
      {
        for (i = 0; i != v10; ++i)
        {
          if (*v42 != v11)
          {
            objc_enumerationMutation(obj);
          }

          v13 = *(*(&v41 + 1) + 8 * i);
          if ([v13 hasDataDetectorResults])
          {
            body = [v13 body];
            string = [body string];
          }

          else
          {
            string = [v13 plainBody];
          }

          v16 = [v5 alloc];
          v17 = [firstObject ID];
          im_stripCategoryLabel = [v17 im_stripCategoryLabel];
          time = [v13 time];
          v20 = [v16 initWithSender:im_stripCategoryLabel dateReceived:time messageBody:string];

          [v35 addObject:v20];
        }

        v10 = [obj countByEnumeratingWithState:&v41 objects:v47 count:16];
      }

      while (v10);
    }

    if (IMOSLoggingEnabled())
    {
      v21 = OSLogHandleForIMFoundationCategory();
      if (os_log_type_enabled(v21, OS_LOG_TYPE_INFO))
      {
        *buf = 138412290;
        v46 = v35;
        _os_log_impl(&dword_19020E000, v21, OS_LOG_TYPE_INFO, "Going to report the following communications: %@", buf, 0xCu);
      }
    }

    v22 = [[v33 alloc] initWithMessageCommunications:v35];
    v23 = [v30 alloc];
    v24 = [firstObject ID];
    countryCode = [firstObject countryCode];
    v26 = [v23 initUnactivatedVCWithRequest:v22 sender:v24 isoCountryCode:countryCode];

    [v26 setDelegate:selfCopy];
    v37[0] = MEMORY[0x1E69E9820];
    v37[1] = 3221225472;
    v37[2] = __68__CKChatController_showSMSReportSpamExtensionControllerForMessages___block_invoke;
    v37[3] = &unk_1E72EE0F8;
    v38 = v22;
    v39 = selfCopy;
    v40 = v26;
    v27 = v26;
    v28 = v22;
    [v27 activateExtensionWithCompletion:v37];

    messagesCopy = v32;
  }
}

void __68__CKChatController_showSMSReportSpamExtensionControllerForMessages___block_invoke(uint64_t a1)
{
  block[0] = MEMORY[0x1E69E9820];
  block[1] = 3221225472;
  block[2] = __68__CKChatController_showSMSReportSpamExtensionControllerForMessages___block_invoke_2;
  block[3] = &unk_1E72EB880;
  v2 = *(a1 + 32);
  v3 = *(a1 + 40);
  v4 = *(a1 + 48);
  v6 = v2;
  v7 = v3;
  v8 = v4;
  dispatch_async(MEMORY[0x1E69E96A0], block);
}

uint64_t __68__CKChatController_showSMSReportSpamExtensionControllerForMessages___block_invoke_2(uint64_t a1)
{
  v7 = *MEMORY[0x1E69E9840];
  if (IMOSLoggingEnabled())
  {
    v2 = OSLogHandleForIMFoundationCategory();
    if (os_log_type_enabled(v2, OS_LOG_TYPE_INFO))
    {
      v3 = *(a1 + 32);
      v5 = 138412290;
      v6 = v3;
      _os_log_impl(&dword_19020E000, v2, OS_LOG_TYPE_INFO, "Going to display spam extension for message classification request: %@", &v5, 0xCu);
    }
  }

  return [*(a1 + 40) presentViewController:*(a1 + 48) animated:1 completion:0];
}

- (CGRect)fullScreenBalloonViewController:(id)controller balloonFrameForChatItem:(id)item
{
  controllerCopy = controller;
  itemCopy = item;
  if ([(CKChatController *)self photosGridViewPresented])
  {
    [(CKChatController *)self photosGridFullScreenBalloonViewController:controllerCopy balloonFrameForChatItem:itemCopy];
LABEL_10:
    v16 = v8;
    v18 = v9;
    v20 = v10;
    v22 = v11;
    goto LABEL_11;
  }

  objc_opt_class();
  if (objc_opt_isKindOfClass())
  {
    collectionViewController = [(CKCoreChatController *)self collectionViewController];
    coordinateSpace = [collectionViewController balloonViewForChatItem:itemCopy];

    view = [(CKChatController *)self view];
    [coordinateSpace ck_identityTransformFrameInView:view];
    v16 = v15;
    v18 = v17;
    v20 = v19;
    v22 = v21;
  }

  else
  {
    supplementaryLayoutChatItem = [controllerCopy supplementaryLayoutChatItem];
    if (!supplementaryLayoutChatItem || (v24 = supplementaryLayoutChatItem, [controllerCopy supplementaryLayoutChatItem], v25 = objc_claimAutoreleasedReturnValue(), objc_opt_class(), isKindOfClass = objc_opt_isKindOfClass(), v25, v24, (isKindOfClass & 1) == 0))
    {
      v39.receiver = self;
      v39.super_class = CKChatController;
      [(CKCoreChatController *)&v39 fullScreenBalloonViewController:controllerCopy balloonFrameForChatItem:itemCopy];
      goto LABEL_10;
    }

    view2 = [(CKChatController *)self view];
    coordinateSpace = [view2 coordinateSpace];

    collectionViewController2 = [(CKCoreChatController *)self collectionViewController];
    supplementaryLayoutChatItem2 = [controllerCopy supplementaryLayoutChatItem];
    v30 = [collectionViewController2 balloonViewForChatItem:supplementaryLayoutChatItem2];

    [v30 currentAssetFrameInCoordinateSpace:coordinateSpace];
    v16 = v31;
    v18 = v32;
    v20 = v33;
    v22 = v34;
  }

LABEL_11:
  v35 = v16;
  v36 = v18;
  v37 = v20;
  v38 = v22;
  result.size.height = v38;
  result.size.width = v37;
  result.origin.y = v36;
  result.origin.x = v35;
  return result;
}

- (void)fullScreenBalloonViewControllerHandleDismissTap:(id)tap
{
  tapCopy = tap;
  if ([(CKChatController *)self photosGridViewPresented])
  {
    [(CKChatController *)self photosGridFullScreenBalloonViewControllerHandleDismissTap:tapCopy];
  }

  else
  {
    v5.receiver = self;
    v5.super_class = CKChatController;
    [(CKCoreChatController *)&v5 fullScreenBalloonViewControllerHandleDismissTap:tapCopy];
  }
}

- (BOOL)fullScreenBalloonViewControllerShouldShowReplyButton:(id)button
{
  buttonCopy = button;
  if ([(CKChatController *)self photosGridViewPresented])
  {
    v5 = [(CKChatController *)self photosGridFullScreenBalloonViewControllerShouldShowReplyButton:buttonCopy];
  }

  else
  {
    v8.receiver = self;
    v8.super_class = CKChatController;
    v5 = [(CKCoreChatController *)&v8 fullScreenBalloonViewControllerShouldShowReplyButton:buttonCopy];
  }

  v6 = v5;

  return v6;
}

- (BOOL)fullScreenBalloonViewControllerShouldShowHightlightButton:(id)button forChatItem:(id)item
{
  itemCopy = item;
  buttonCopy = button;
  if ([(CKChatController *)self photosGridViewPresented])
  {
    v8 = [(CKChatController *)self photosGridFullScreenBalloonViewControllerShouldShowHightlightButton:buttonCopy forChatItem:itemCopy];
  }

  else
  {
    v11.receiver = self;
    v11.super_class = CKChatController;
    v8 = [(CKCoreChatController *)&v11 fullScreenBalloonViewControllerShouldShowHightlightButton:buttonCopy forChatItem:itemCopy];
  }

  v9 = v8;

  return v9;
}

- (void)fullScreenBalloonViewController:(id)controller sendMessageHighlight:(BOOL)highlight forChatItem:(id)item
{
  highlightCopy = highlight;
  itemCopy = item;
  controllerCopy = controller;
  if ([(CKChatController *)self photosGridViewPresented])
  {
    [(CKChatController *)self photosGridFullScreenBalloonViewController:controllerCopy sendMessageHighlight:highlightCopy forChatItem:itemCopy];
  }

  else
  {
    v10.receiver = self;
    v10.super_class = CKChatController;
    [(CKCoreChatController *)&v10 fullScreenBalloonViewController:controllerCopy sendMessageHighlight:highlightCopy forChatItem:itemCopy];
  }
}

- (void)fullScreenBalloonViewController:(id)controller willAppearAnimated:(BOOL)animated
{
  animatedCopy = animated;
  controllerCopy = controller;
  if ([(CKChatController *)self photosGridViewPresented])
  {
    [(CKChatController *)self photosGridFullScreenBalloonViewController:controllerCopy didAppearAnimated:animatedCopy];
  }

  else
  {
    collectionView = [(CKChatController *)self collectionView];
    [collectionView setTranscriptScrollIntent:8];

    v10.receiver = self;
    v10.super_class = CKChatController;
    [(CKCoreChatController *)&v10 fullScreenBalloonViewController:controllerCopy willAppearAnimated:animatedCopy];
    displayConfiguration = [controllerCopy displayConfiguration];
    type = [displayConfiguration type];

    if (type == 1)
    {
      [(CKChatController *)self requestShowKeyboardSnapshotForReason:16];
    }

    [(CKChatController *)self updateActiveEntryViewPositioningGuide];
  }
}

- (void)fullScreenBalloonViewController:(id)controller didAppearAnimated:(BOOL)animated
{
  animatedCopy = animated;
  controllerCopy = controller;
  if ([(CKChatController *)self photosGridViewPresented])
  {
    [(CKChatController *)self photosGridFullScreenBalloonViewController:controllerCopy didAppearAnimated:animatedCopy];
  }

  else
  {
    collectionViewController = [(CKCoreChatController *)self collectionViewController];
    collectionView = [collectionViewController collectionView];
    [collectionView contentOffset];
    self->_startingScrollOffset.x = v9;
    self->_startingScrollOffset.y = v10;

    v11.receiver = self;
    v11.super_class = CKChatController;
    [(CKCoreChatController *)&v11 fullScreenBalloonViewController:controllerCopy didAppearAnimated:animatedCopy];
    [(CKChatController *)self beginHoldingAutorotationForKey:@"CKAutorotationFullScreenBubble"];
    [(CKChatController *)self updateActiveEntryViewPositioningGuide];
  }
}

- (double)_currentScrollDelta
{
  collectionViewController = [(CKCoreChatController *)self collectionViewController];
  collectionView = [collectionViewController collectionView];
  [collectionView contentOffset];
  v6 = v5;

  return self->_startingScrollOffset.y - v6;
}

- (void)fullScreenBalloonViewController:(id)controller willDisappearWithSendAnimation:(BOOL)animation duration:(double)duration
{
  animationCopy = animation;
  controllerCopy = controller;
  if ([(CKChatController *)self photosGridViewPresented])
  {
    [(CKChatController *)self photosGridFullScreenBalloonViewController:controllerCopy willDisappearWithSendAnimation:animationCopy];
  }

  else
  {
    v18.receiver = self;
    v18.super_class = CKChatController;
    [(CKCoreChatController *)&v18 fullScreenBalloonViewController:controllerCopy willDisappearWithSendAnimation:animationCopy duration:duration];
    [(CKChatController *)self setIgnoresAutomaticScrollsTowardBottom:0];
    [(CKChatController *)self _currentScrollDelta];
    if (v9 != 0.0)
    {
      v10 = v9;
      fullScreenBalloonViewController = [(CKCoreChatController *)self fullScreenBalloonViewController];
      displayConfiguration = [fullScreenBalloonViewController displayConfiguration];
      type = [displayConfiguration type];

      if (type == 2)
      {
        chatItem = [controllerCopy chatItem];
        [(CKChatController *)self updateChatItemBalloonViewAndStickerViews:chatItem hidden:1];
      }

      displayConfiguration2 = [controllerCopy displayConfiguration];
      shouldReturnToStartingScrollOffset = [displayConfiguration2 shouldReturnToStartingScrollOffset];

      if (shouldReturnToStartingScrollOffset)
      {
        collectionViewController = [(CKCoreChatController *)self collectionViewController];
        [collectionViewController verticallyScrollTranscriptByAmount:1 animated:0 duration:v10 completion:duration];
      }
    }
  }
}

- (void)fullScreenBalloonViewController:(id)controller sendMessageAcknowledgment:(int64_t)acknowledgment forChatItem:(id)item
{
  controllerCopy = controller;
  itemCopy = item;
  if ([(CKChatController *)self photosGridViewPresented])
  {
    [(CKChatController *)self photosGridFullScreenBalloonViewController:controllerCopy sendMessageAcknowledgment:acknowledgment forChatItem:itemCopy];
  }

  else
  {
    revealAnimationGroup = [(CKChatController *)self revealAnimationGroup];
    dispatch_group_enter(revealAnimationGroup);

    v11[0] = MEMORY[0x1E69E9820];
    v11[1] = 3221225472;
    v11[2] = __90__CKChatController_fullScreenBalloonViewController_sendMessageAcknowledgment_forChatItem___block_invoke;
    v11[3] = &unk_1E72EBC38;
    v11[4] = self;
    acknowledgmentCopy = acknowledgment;
    v12 = itemCopy;
    [(CKChatController *)self _dismissFullScreenBubbleViewControllerAnimated:1 withSendAnimation:1 completion:v11];
  }
}

void __90__CKChatController_fullScreenBalloonViewController_sendMessageAcknowledgment_forChatItem___block_invoke(uint64_t a1)
{
  v2 = [*(a1 + 32) revealAnimationGroup];
  block[0] = MEMORY[0x1E69E9820];
  block[1] = 3221225472;
  block[2] = __90__CKChatController_fullScreenBalloonViewController_sendMessageAcknowledgment_forChatItem___block_invoke_2;
  block[3] = &unk_1E72EBC38;
  v4 = *(a1 + 40);
  v3 = *(a1 + 48);
  block[4] = *(a1 + 32);
  v8 = v3;
  v7 = v4;
  dispatch_group_notify(v2, MEMORY[0x1E69E96A0], block);

  v5 = [*(a1 + 32) revealAnimationGroup];
  dispatch_group_leave(v5);
}

void __90__CKChatController_fullScreenBalloonViewController_sendMessageAcknowledgment_forChatItem___block_invoke_2(uint64_t a1)
{
  v2 = [*(a1 + 32) chat];
  [v2 sendMessageAcknowledgment:*(a1 + 48) forChatItem:*(a1 + 40)];

  if (([*(a1 + 32) showingInStandAloneWindow] & 1) == 0)
  {
    v3 = [*(a1 + 32) delegate];
    if (v3)
    {
      v4 = v3;
      v5 = [*(a1 + 32) delegate];
      objc_opt_class();
      isKindOfClass = objc_opt_isKindOfClass();

      if (isKindOfClass)
      {
        v9 = [*(a1 + 32) delegate];
        v7 = [v9 conversationListController];
        v8 = [*(a1 + 32) conversation];
        [v7 updateConversationListForMessageSentToConversation:v8];
      }
    }
  }
}

- (void)fullScreenBalloonViewControllerDidDisappear:(id)disappear
{
  disappearCopy = disappear;
  mEMORY[0x1E69A8070] = [MEMORY[0x1E69A8070] sharedFeatureFlags];
  isExpressiveTextEnabled = [mEMORY[0x1E69A8070] isExpressiveTextEnabled];

  if (isExpressiveTextEnabled)
  {
    collectionViewController = [(CKCoreChatController *)self collectionViewController];
    objc_opt_class();
    if (objc_opt_isKindOfClass())
    {
      [collectionViewController setTextEffectCoordinatorPaused:0 reason:@"fullscreen view controller did disappear"];
    }
  }

  if ([(CKChatController *)self photosGridViewPresented])
  {
    [(CKChatController *)self photosGridFullScreenBalloonViewControllerDidDisappear:disappearCopy];
  }

  else
  {
    supplementaryLayoutChatItem = [disappearCopy supplementaryLayoutChatItem];
    v9 = supplementaryLayoutChatItem;
    if (supplementaryLayoutChatItem)
    {
      chatItem = supplementaryLayoutChatItem;
    }

    else
    {
      chatItem = [disappearCopy chatItem];
    }

    v11 = chatItem;

    collectionViewController2 = [(CKCoreChatController *)self collectionViewController];
    chatItem2 = [disappearCopy chatItem];
    v14 = [collectionViewController2 balloonViewForChatItem:chatItem2];

    [v14 setInvisibleInkEffectPaused:0];
    if (([disappearCopy willPresentInlineReplies] & 1) == 0)
    {
      chatItem3 = [disappearCopy chatItem];
      [(CKChatController *)self updateChatItemBalloonViewAndStickerViews:chatItem3 hidden:0];
    }

    v20 = MEMORY[0x1E69E9820];
    v21 = 3221225472;
    v22 = __64__CKChatController_fullScreenBalloonViewControllerDidDisappear___block_invoke;
    v23 = &unk_1E72EB8D0;
    v16 = disappearCopy;
    v24 = v16;
    selfCopy = self;
    v17 = _Block_copy(&v20);
    displayConfiguration = [v16 displayConfiguration];
    shouldShowStickers = [displayConfiguration shouldShowStickers];

    [(CKChatController *)self showAssociatedCellsForChatItem:v11 animated:shouldShowStickers ^ 1u completion:v17];
  }
}

void __64__CKChatController_fullScreenBalloonViewControllerDidDisappear___block_invoke(uint64_t a1)
{
  v2 = *(a1 + 32);
  v11.receiver = *(a1 + 40);
  v11.super_class = CKChatController;
  objc_msgSendSuper2(&v11, sel_fullScreenBalloonViewControllerDidDisappear_, v2);
  [*(a1 + 40) endHoldingAutorotationForKey:@"CKAutorotationFullScreenBubble"];
  if ([*(a1 + 40) targetFirstResponder] == 1)
  {
    [*(a1 + 40) becomeFirstResponder];
  }

  v3 = [*(a1 + 40) collectionViewController];
  [v3 updateTranscriptScrollIntentToBottomOrHistoryBasedOnCurrentContentOffset];

  v4 = +[CKScrollViewAnimationProperties systemDefaultScrollAnimation];
  v5 = [*(a1 + 40) collectionViewController];
  v6 = [v5 collectionView];
  [v6 enforceTranscriptScrollIntentWithAnimationProperties:v4];

  [*(a1 + 40) setRevealAnimationGroup:0];
  if (([*(a1 + 40) isAnimatingStickerReaction] & 1) == 0)
  {
    v7 = [*(a1 + 40) inputController];
    [v7 endStickerReactionSession];

    [*(a1 + 40) updateActiveEntryViewPositioningGuide];
  }

  v8 = [*(a1 + 32) view];
  [v8 removeFromSuperview];

  v9 = [*(a1 + 32) displayConfiguration];
  v10 = [v9 type];

  if (v10 == 1)
  {
    [*(a1 + 40) requestDismissKeyboardSnapshotForReason:16];
  }
}

- (void)showAssociatedCellsForChatItem:(id)item animated:(BOOL)animated completion:(id)completion
{
  animatedCopy = animated;
  v44 = *MEMORY[0x1E69E9840];
  itemCopy = item;
  block = completion;
  v27 = itemCopy;
  v28 = objc_alloc_init(MEMORY[0x1E695DF70]);
  v38 = 0u;
  v39 = 0u;
  v40 = 0u;
  v41 = 0u;
  obj = [itemCopy visibleAssociatedMessageChatItems];
  v7 = [obj countByEnumeratingWithState:&v38 objects:v43 count:16];
  if (v7)
  {
    v8 = v7;
    v9 = *v39;
    do
    {
      for (i = 0; i != v8; ++i)
      {
        if (*v39 != v9)
        {
          objc_enumerationMutation(obj);
        }

        v11 = *(*(&v38 + 1) + 8 * i);
        objc_opt_class();
        isKindOfClass = objc_opt_isKindOfClass();
        objc_opt_class();
        v13 = objc_opt_isKindOfClass();
        v14 = +[CKUIBehavior sharedBehaviors];
        longPressHidesAssociatedAcknowledgments = [v14 longPressHidesAssociatedAcknowledgments];

        if (isKindOfClass & 1) != 0 || (v13 & longPressHidesAssociatedAcknowledgments)
        {
          [v28 addObject:v11];
        }
      }

      v8 = [obj countByEnumeratingWithState:&v38 objects:v43 count:16];
    }

    while (v8);
  }

  revealAnimationGroup = [(CKChatController *)self revealAnimationGroup];
  v34 = 0u;
  v35 = 0u;
  v36 = 0u;
  v37 = 0u;
  v17 = v28;
  v18 = [v17 countByEnumeratingWithState:&v34 objects:v42 count:16];
  if (v18)
  {
    v19 = v18;
    v20 = *v35;
    do
    {
      for (j = 0; j != v19; ++j)
      {
        if (*v35 != v20)
        {
          objc_enumerationMutation(v17);
        }

        v22 = *(*(&v34 + 1) + 8 * j);
        collectionViewController = [(CKCoreChatController *)self collectionViewController];
        v24 = [collectionViewController cellForAssociatedChatItem:v22];

        if (v24)
        {
          dispatch_group_enter(revealAnimationGroup);
          aBlock[0] = MEMORY[0x1E69E9820];
          aBlock[1] = 3221225472;
          aBlock[2] = __71__CKChatController_showAssociatedCellsForChatItem_animated_completion___block_invoke;
          aBlock[3] = &unk_1E72EBA18;
          v33 = revealAnimationGroup;
          v25 = _Block_copy(aBlock);
          [v24 performRevealAnimated:animatedCopy completion:v25];
        }
      }

      v19 = [v17 countByEnumeratingWithState:&v34 objects:v42 count:16];
    }

    while (v19);
  }

  if (block)
  {
    dispatch_group_notify(revealAnimationGroup, MEMORY[0x1E69E96A0], block);
  }
}

- (OS_dispatch_group)revealAnimationGroup
{
  revealAnimationGroup = self->_revealAnimationGroup;
  if (!revealAnimationGroup)
  {
    v4 = dispatch_group_create();
    v5 = self->_revealAnimationGroup;
    self->_revealAnimationGroup = v4;

    revealAnimationGroup = self->_revealAnimationGroup;
  }

  return revealAnimationGroup;
}

- (void)fullScreenBalloonViewController:(id)controller verticallyScrollTranscriptByAmount:(double)amount animated:(BOOL)animated duration:(double)duration completion:(id)completion
{
  animatedCopy = animated;
  controllerCopy = controller;
  completionCopy = completion;
  if ([(CKChatController *)self photosGridViewPresented])
  {
    [(CKChatController *)self photosGridFullScreenBalloonViewController:controllerCopy verticallyScrollTranscriptByAmount:animatedCopy animated:completionCopy duration:amount completion:duration];
  }

  else
  {
    collectionViewController = [(CKCoreChatController *)self collectionViewController];
    [collectionViewController verticallyScrollTranscriptByAmount:animatedCopy animated:completionCopy duration:amount completion:duration];
  }
}

- (void)fullScreenBalloonViewController:(id)controller stickerPackTappedWithAdamID:(id)d
{
  controllerCopy = controller;
  dCopy = d;
  if ([(CKChatController *)self photosGridViewPresented])
  {
    [(CKChatController *)self photosGridFullScreenBalloonViewController:controllerCopy stickerPackTappedWithAdamID:dCopy];
  }

  else
  {
    v8 = dispatch_time(0, 300000000);
    v9[0] = MEMORY[0x1E69E9820];
    v9[1] = 3221225472;
    v9[2] = __80__CKChatController_fullScreenBalloonViewController_stickerPackTappedWithAdamID___block_invoke;
    v9[3] = &unk_1E72EB8D0;
    v9[4] = self;
    v10 = dCopy;
    dispatch_after(v8, MEMORY[0x1E69E96A0], v9);
  }
}

- (void)_presentAppStoreForAdamID:(id)d
{
  v10 = *MEMORY[0x1E69E9840];
  dCopy = d;
  if (IMOSLoggingEnabled())
  {
    v5 = OSLogHandleForIMFoundationCategory();
    if (os_log_type_enabled(v5, OS_LOG_TYPE_INFO))
    {
      v8 = 138412290;
      v9 = dCopy;
      _os_log_impl(&dword_19020E000, v5, OS_LOG_TYPE_INFO, "present app store for ID: %@", &v8, 0xCu);
    }
  }

  inputController = [(CKCoreChatController *)self inputController];
  [inputController presentAppStoreForAdamID:dCopy];

  mEMORY[0x1E69A8168] = [MEMORY[0x1E69A8168] sharedInstance];
  [mEMORY[0x1E69A8168] trackEvent:*MEMORY[0x1E69A7300]];
}

- (void)fullScreenBalloonViewController:(id)controller deleteStickerWithTransferGUID:(id)d
{
  controllerCopy = controller;
  dCopy = d;
  if ([(CKChatController *)self photosGridViewPresented])
  {
    [(CKChatController *)self photosGridFullScreenBalloonViewController:controllerCopy deleteStickerWithTransferGUID:dCopy];
  }

  else
  {
    [(CKChatController *)self _deleteStickerWithTransferGUID:dCopy];
  }
}

- (void)_deleteStickerWithTransferGUID:(id)d
{
  v11[1] = *MEMORY[0x1E69E9840];
  dCopy = d;
  chat = [(CKCoreChatController *)self chat];
  v11[0] = dCopy;
  v6 = [MEMORY[0x1E695DEC8] arrayWithObjects:v11 count:1];
  [chat deleteTransfers:v6];

  if (IMOSLoggingEnabled())
  {
    v7 = OSLogHandleForIMFoundationCategory();
    if (os_log_type_enabled(v7, OS_LOG_TYPE_INFO))
    {
      v9 = 136315138;
      v10 = "[CKChatController _deleteStickerWithTransferGUID:]";
      _os_log_impl(&dword_19020E000, v7, OS_LOG_TYPE_INFO, "%s requesting purge of default snapshot", &v9, 0xCu);
    }
  }

  v8 = objc_alloc_init(MEMORY[0x1E69D41A0]);
  [v8 deleteSnapshotsForApplicationIdentifier:@"com.apple.MobileSMS"];
  [v8 invalidate];
}

- (void)fullScreenBalloonViewController:(id)controller replyButtonPressedForChatItem:(id)item
{
  controllerCopy = controller;
  itemCopy = item;
  if ([(CKChatController *)self photosGridViewPresented])
  {
    [(CKChatController *)self photosGridFullScreenBalloonViewController:controllerCopy replyButtonPressedForChatItem:itemCopy];
  }

  else
  {
    v8[0] = MEMORY[0x1E69E9820];
    v8[1] = 3221225472;
    v8[2] = __82__CKChatController_fullScreenBalloonViewController_replyButtonPressedForChatItem___block_invoke;
    v8[3] = &unk_1E72EB8D0;
    v9 = itemCopy;
    selfCopy = self;
    [(CKChatController *)self _dismissFullScreenBubbleViewControllerAnimated:1 withSendAnimation:0 completion:v8];
  }
}

uint64_t __82__CKChatController_fullScreenBalloonViewController_replyButtonPressedForChatItem___block_invoke(uint64_t result)
{
  v1 = *(result + 32);
  if (v1)
  {
    return [*(result + 40) showInlineReplyControllerForChatItem:v1 presentKeyboard:1];
  }

  return result;
}

- (id)chatItems
{
  chat = [(CKCoreChatController *)self chat];
  chatItems = [chat chatItems];

  return chatItems;
}

- (BOOL)_anyTranscriptBannerIsVisible
{
  transcriptSharingBannerSuggestion = [(CKChatController *)self transcriptSharingBannerSuggestion];

  if (transcriptSharingBannerSuggestion)
  {
    return 1;
  }

  nicknameBanner = [(CKChatController *)self nicknameBanner];
  if (nicknameBanner)
  {
    v4 = 1;
  }

  else
  {
    groupPhotoUpdateBanner = [(CKChatController *)self groupPhotoUpdateBanner];
    if (groupPhotoUpdateBanner)
    {
      v4 = 1;
    }

    else
    {
      notificationBannerView = [(CKChatController *)self notificationBannerView];
      if (notificationBannerView)
      {
        v4 = 1;
      }

      else
      {
        suggestionBannerView = [(CKChatController *)self suggestionBannerView];
        if (suggestionBannerView)
        {
          v4 = 1;
        }

        else
        {
          acceptedContactBanner = [(CKChatController *)self acceptedContactBanner];
          v4 = acceptedContactBanner != 0;
        }
      }
    }
  }

  return v4;
}

- (BOOL)_wantsToShowCollaborationNotices
{
  collaborationNoticeSuggestions = [(CKChatController *)self collaborationNoticeSuggestions];
  v3 = [collaborationNoticeSuggestions count] != 0;

  return v3;
}

- (void)suggestionPresenterWantsToShowBanner:(id)banner
{
  bannerCopy = banner;
  suggestionBannerView = [(CKChatController *)self suggestionBannerView];
  v5 = suggestionBannerView == 0;

  banner = [bannerCopy banner];
  [(CKChatController *)self setSuggestionBannerView:banner];

  objc_opt_class();
  if (objc_opt_isKindOfClass())
  {
    transitionContext = [(CKChatController *)self transitionContext];
    v5 = [transitionContext isParentChatControllerShowingBanner] ^ 1;
  }

  banner2 = [bannerCopy banner];
  [(CKChatController *)self addSuggestionBanner:banner2 animated:v5];
}

- (void)suggestionPresenterWantsToHideBanner:(id)banner
{
  bannerCopy = banner;
  standardSuggestionPresenter = [(CKChatController *)self standardSuggestionPresenter];
  if (standardSuggestionPresenter == bannerCopy)
  {
  }

  else
  {
    foundInSuggestionPresenter = [(CKChatController *)self foundInSuggestionPresenter];

    v6 = bannerCopy;
    if (foundInSuggestionPresenter != bannerCopy)
    {
      goto LABEL_11;
    }
  }

  standardSuggestionPresenter2 = [(CKChatController *)self standardSuggestionPresenter];
  if (standardSuggestionPresenter2 == bannerCopy)
  {
    [(CKChatController *)self foundInSuggestionPresenter];
  }

  else
  {
    [(CKChatController *)self standardSuggestionPresenter];
  }
  v8 = ;

  banner = [bannerCopy banner];
  [(CKChatController *)self removeSuggestionsBanner:banner animated:1];

  [(CKChatController *)self setSuggestionBannerView:0];
  if ([v8 wantsToShowBanner])
  {
    banner2 = [bannerCopy banner];
    [(CKChatController *)self setSuggestionBannerView:banner2];

    banner3 = [v8 banner];
    [(CKChatController *)self addSuggestionBanner:banner3 animated:1];
  }

  v6 = bannerCopy;
LABEL_11:
}

- (void)removeSuggestionsBanner:(id)banner animated:(BOOL)animated
{
  animatedCopy = animated;
  bannerCopy = banner;
  if (animatedCopy)
  {
    view = [(CKChatController *)self view];
    [view layoutIfNeeded];

    v8 = MEMORY[0x1E69DD250];
    v14[0] = MEMORY[0x1E69E9820];
    v14[1] = 3221225472;
    v14[2] = __53__CKChatController_removeSuggestionsBanner_animated___block_invoke;
    v14[3] = &unk_1E72EB8D0;
    v15 = bannerCopy;
    selfCopy = self;
    v11[0] = MEMORY[0x1E69E9820];
    v11[1] = 3221225472;
    v11[2] = __53__CKChatController_removeSuggestionsBanner_animated___block_invoke_2;
    v11[3] = &unk_1E72ECCA8;
    v12 = v15;
    selfCopy2 = self;
    [v8 animateWithDuration:v14 animations:v11 completion:0.3];
  }

  else
  {
    suggestionBannerTopConstraint = [(CKChatController *)self suggestionBannerTopConstraint];
    [bannerCopy removeConstraint:suggestionBannerTopConstraint];

    suggestionBannerTopConstraint = self->_suggestionBannerTopConstraint;
    self->_suggestionBannerTopConstraint = 0;

    [bannerCopy removeFromSuperview];
    [(CKChatController *)self _updateTranscriptOffsetForBannerView];
  }
}

uint64_t __53__CKChatController_removeSuggestionsBanner_animated___block_invoke(uint64_t a1)
{
  [*(a1 + 32) setAlpha:0.0];
  [*(a1 + 40) suggestionBannerHeight];
  v3 = -v2;
  v4 = [*(a1 + 40) suggestionBannerTopConstraint];
  [v4 setConstant:v3];

  [*(a1 + 32) setNeedsUpdateConstraints];
  v5 = [*(a1 + 40) view];
  [v5 layoutIfNeeded];

  v6 = *(a1 + 40);

  return [v6 _updateTranscriptOffsetForBannerView];
}

uint64_t __53__CKChatController_removeSuggestionsBanner_animated___block_invoke_2(uint64_t a1)
{
  v2 = *(a1 + 32);
  v3 = [*(a1 + 40) suggestionBannerTopConstraint];
  [v2 removeConstraint:v3];

  v4 = *(a1 + 40);
  v5 = *(v4 + 1632);
  *(v4 + 1632) = 0;

  v6 = *(a1 + 32);

  return [v6 removeFromSuperview];
}

- (void)addSuggestionBanner:(id)banner animated:(BOOL)animated
{
  animatedCopy = animated;
  v53 = *MEMORY[0x1E69E9840];
  bannerCopy = banner;
  chat = [(CKCoreChatController *)self chat];
  canSuggestRecipientContact = [chat canSuggestRecipientContact];

  if (bannerCopy)
  {
    if (canSuggestRecipientContact)
    {
      v9 = CFPreferencesCopyAppValue(@"AppCanShowSiriSuggestionsBlacklist", @"com.apple.suggestions");
      v10 = [v9 containsObject:@"com.apple.MobileSMS"];

      if ((v10 & 1) == 0)
      {
        superview = [bannerCopy superview];

        if (superview)
        {
          [(CKChatController *)self removeSuggestionsBanner:bannerCopy animated:0];
        }

        [bannerCopy intrinsicContentSize];
        self->_suggestionBannerHeight = v12;
        [bannerCopy setTranslatesAutoresizingMaskIntoConstraints:0];
        view = [(CKChatController *)self view];
        [view addSubview:bannerCopy];

        superview2 = [bannerCopy superview];
        view2 = [(CKChatController *)self view];

        if (superview2 == view2)
        {
          mEMORY[0x1E69A8070] = [MEMORY[0x1E69A8070] sharedFeatureFlags];
          isModernSplitViewControllerEnabled = [mEMORY[0x1E69A8070] isModernSplitViewControllerEnabled];

          leadingAnchor = [bannerCopy leadingAnchor];
          view3 = [(CKChatController *)self view];
          v23 = view3;
          if (isModernSplitViewControllerEnabled)
          {
            layoutMarginsGuide = [view3 layoutMarginsGuide];
            leadingAnchor2 = [layoutMarginsGuide leadingAnchor];
            v26 = [leadingAnchor constraintEqualToAnchor:leadingAnchor2];
            [v26 setActive:1];

            trailingAnchor = [bannerCopy trailingAnchor];
            view4 = [(CKChatController *)self view];
            layoutMarginsGuide2 = [view4 layoutMarginsGuide];
            trailingAnchor2 = [layoutMarginsGuide2 trailingAnchor];
            v31 = [trailingAnchor constraintEqualToAnchor:trailingAnchor2];
            [v31 setActive:1];
          }

          else
          {
            leadingAnchor3 = [view3 leadingAnchor];
            v33 = [leadingAnchor constraintEqualToAnchor:leadingAnchor3];
            [v33 setActive:1];

            trailingAnchor = [bannerCopy trailingAnchor];
            view4 = [(CKChatController *)self view];
            layoutMarginsGuide2 = [view4 trailingAnchor];
            trailingAnchor2 = [trailingAnchor constraintEqualToAnchor:layoutMarginsGuide2];
            [trailingAnchor2 setActive:1];
          }

          topAnchor = [bannerCopy topAnchor];
          view5 = [(CKChatController *)self view];
          safeAreaLayoutGuide = [view5 safeAreaLayoutGuide];
          topAnchor2 = [safeAreaLayoutGuide topAnchor];
          if (animatedCopy)
          {
            [(CKChatController *)self suggestionBannerHeight];
            v39 = [topAnchor constraintEqualToAnchor:topAnchor2 constant:-v38];
            [(CKChatController *)self setSuggestionBannerTopConstraint:v39];

            suggestionBannerTopConstraint = [(CKChatController *)self suggestionBannerTopConstraint];
            [suggestionBannerTopConstraint setActive:1];

            [bannerCopy setAlpha:0.0];
            view6 = [(CKChatController *)self view];
            [view6 layoutIfNeeded];

            v42 = MEMORY[0x1E69DD250];
            v46[0] = MEMORY[0x1E69E9820];
            v46[1] = 3221225472;
            v46[2] = __49__CKChatController_addSuggestionBanner_animated___block_invoke;
            v46[3] = &unk_1E72EB8D0;
            v47 = bannerCopy;
            selfCopy = self;
            [v42 animateWithDuration:v46 animations:0.3];
          }

          else
          {
            v43 = [topAnchor constraintEqualToAnchor:topAnchor2 constant:0.0];
            [(CKChatController *)self setSuggestionBannerTopConstraint:v43];

            suggestionBannerTopConstraint2 = [(CKChatController *)self suggestionBannerTopConstraint];
            [suggestionBannerTopConstraint2 setActive:1];

            view7 = [(CKChatController *)self view];
            [view7 layoutIfNeeded];

            [(CKChatController *)self _updateTranscriptOffsetForBannerView];
          }
        }

        else
        {
          if (IMOSLoggingEnabled())
          {
            v16 = OSLogHandleForIMFoundationCategory();
            if (os_log_type_enabled(v16, OS_LOG_TYPE_INFO))
            {
              superview3 = [bannerCopy superview];
              view8 = [(CKChatController *)self view];
              *buf = 138412546;
              v50 = superview3;
              v51 = 2112;
              v52 = view8;
              _os_log_impl(&dword_19020E000, v16, OS_LOG_TYPE_INFO, "CKChatController - Not displaying suggestions banner, banner superview: %@ isn't the chat controller's view: %@ after insertion", buf, 0x16u);
            }
          }

          [bannerCopy removeFromSuperview];
        }
      }
    }
  }
}

uint64_t __49__CKChatController_addSuggestionBanner_animated___block_invoke(uint64_t a1)
{
  [*(a1 + 32) setAlpha:1.0];
  v2 = [*(a1 + 40) suggestionBannerTopConstraint];
  [v2 setConstant:0.0];

  [*(a1 + 32) setNeedsUpdateConstraints];
  v3 = [*(a1 + 40) view];
  [v3 layoutIfNeeded];

  v4 = *(a1 + 40);

  return [v4 _updateTranscriptOffsetForBannerView];
}

- (void)_updateTranscriptOffsetForBannerView
{
  collectionView = [(CKChatController *)self collectionView];
  [collectionView contentOffset];
  v5 = v4;
  v7 = v6;

  collectionView2 = [(CKChatController *)self collectionView];
  [collectionView2 contentInset];
  v10 = v9;

  [(CKScrollViewController *)self updateScrollGeometryWithInheritedAnimationForReason:@"BannerChangedSize"];
  collectionView3 = [(CKChatController *)self collectionView];
  [collectionView3 contentInset];
  v13 = v12;

  collectionView4 = [(CKChatController *)self collectionView];
  [collectionView4 setContentOffset:{v5, v7 - (v13 - v10)}];
}

- (void)_handleChatItemDidChange:(id)change
{
  changeCopy = change;
  [(CKChatController *)self removeLoadingIndicatorCoverIfNeeded];
  [(CKChatController *)self checkSuggestionsForBanner];
  userInfo = [changeCopy userInfo];
  v6 = [userInfo objectForKey:*MEMORY[0x1E69A5750]];

  array = [MEMORY[0x1E695DF70] array];
  conversation = [(CKCoreChatController *)self conversation];
  chat = [conversation chat];
  chatItems = [chat chatItems];
  v11 = [chatItems count];

  v21 = 0;
  v22 = &v21;
  v23 = 0x2020000000;
  v24 = 0;
  v16[0] = MEMORY[0x1E69E9820];
  v16[1] = 3221225472;
  v16[2] = __45__CKChatController__handleChatItemDidChange___block_invoke;
  v16[3] = &unk_1E72EE120;
  v20 = v11;
  v16[4] = self;
  v12 = array;
  v17 = v12;
  v19 = &v21;
  v13 = v6;
  v18 = v13;
  [v13 enumerateIndexesUsingBlock:v16];
  if (*(v22 + 24) == 1 && [(CKChatController *)self shouldShowBanners])
  {
    v15[0] = MEMORY[0x1E69E9820];
    v15[1] = 3221225472;
    v15[2] = __45__CKChatController__handleChatItemDidChange___block_invoke_1559;
    v15[3] = &unk_1E72ED570;
    v15[4] = self;
    [(CKChatController *)self showTranslationTips:v15];
  }

  inputController = [(CKCoreChatController *)self inputController];
  [inputController notifyBrowserViewControllerOfMatchingNewMessages:v12];

  _Block_object_dispose(&v21, 8);
}

void __45__CKChatController__handleChatItemDidChange___block_invoke(uint64_t a1, unint64_t a2)
{
  v17 = *MEMORY[0x1E69E9840];
  if (*(a1 + 64) <= a2)
  {
    if (IMOSLoggingEnabled())
    {
      v7 = OSLogHandleForIMFoundationCategory();
      if (os_log_type_enabled(v7, OS_LOG_TYPE_INFO))
      {
        v8 = [*(a1 + 48) count];
        v9 = *(a1 + 64);
        v11 = 134218496;
        v12 = a2;
        v13 = 2048;
        v14 = v8;
        v15 = 2048;
        v16 = v9;
        _os_log_impl(&dword_19020E000, v7, OS_LOG_TYPE_INFO, "Index out of bounds for inserted index %ld. Inserted Index count = %ld, chat items count = %ld", &v11, 0x20u);
      }
    }
  }

  else
  {
    v4 = [*(a1 + 32) conversation];
    v5 = [v4 chat];
    v6 = [v5 chatItems];
    v10 = [v6 objectAtIndex:a2];

    [*(a1 + 40) addObject:v10];
    objc_opt_class();
    if ((objc_opt_isKindOfClass() & 1) != 0 && ([v10 isFromMe] & 1) == 0)
    {
      *(*(*(a1 + 56) + 8) + 24) = 1;
    }
  }
}

void __45__CKChatController__handleChatItemDidChange___block_invoke_1559(uint64_t a1, int a2, void *a3)
{
  if (a2)
  {
    v4 = *(a1 + 32);
    v5 = a3;
    v6 = [v4 tipManager];
    [v6 setTranslationDelegate:v4];

    v7 = [*(a1 + 32) tipManager];
    v9 = [v7 presentTranslationTipWithLanguages:v5];

    v8 = [v5 objectForKeyedSubscript:v9];

    [*(a1 + 32) prewarmTranslationCacheForMessagesWithGUIDs:v8 sourceLanguage:v9];
  }
}

- (void)_handleKeyTransparencyShouldRefresh:(id)refresh
{
  chat = [(CKCoreChatController *)self chat];
  [chat refreshServiceForSending];
}

- (void)_handleInterworkingStateChanged:(id)changed
{
  entryView = [(CKChatController *)self entryView];
  [entryView updateEntryView];
}

- (BOOL)_hasExistingBannerMatchingStyle:(unint64_t)style withNicknames:(id)nicknames
{
  v16 = *MEMORY[0x1E69E9840];
  nicknamesCopy = nicknames;
  nicknameBanner = [(CKChatController *)self nicknameBanner];
  v8 = nicknameBanner;
  if (nicknameBanner && [nicknameBanner style] == style && (objc_msgSend(v8, "nicknameUpdates"), v9 = objc_claimAutoreleasedReturnValue(), v10 = objc_msgSend(v9, "isEqualToArray:", nicknamesCopy), v9, v10))
  {
    if (IMOSLoggingEnabled())
    {
      v11 = OSLogHandleForIMFoundationCategory();
      if (os_log_type_enabled(v11, OS_LOG_TYPE_INFO))
      {
        v14 = 138412290;
        v15 = v8;
        _os_log_impl(&dword_19020E000, v11, OS_LOG_TYPE_INFO, "Asked to represent identical banner, bailing! Existing is %@", &v14, 0xCu);
      }
    }

    v12 = 1;
  }

  else
  {
    v12 = 0;
  }

  return v12;
}

- (void)clearHandlesFromScrutiny:(id)scrutiny
{
  v15 = *MEMORY[0x1E69E9840];
  scrutinyCopy = scrutiny;
  v10 = 0u;
  v11 = 0u;
  v12 = 0u;
  v13 = 0u;
  v4 = [scrutinyCopy countByEnumeratingWithState:&v10 objects:v14 count:16];
  if (v4)
  {
    v5 = v4;
    v6 = *v11;
    do
    {
      v7 = 0;
      do
      {
        if (*v11 != v6)
        {
          objc_enumerationMutation(scrutinyCopy);
        }

        v8 = *(*(&v10 + 1) + 8 * v7);
        mEMORY[0x1E69A5C10] = [MEMORY[0x1E69A5C10] sharedInstance];
        [mEMORY[0x1E69A5C10] clearHandleFromScrutiny:v8];

        ++v7;
      }

      while (v5 != v7);
      v5 = [scrutinyCopy countByEnumeratingWithState:&v10 objects:v14 count:16];
    }

    while (v5);
  }
}

- (BOOL)shouldNotShowGroupBanners
{
  conversation = [(CKCoreChatController *)self conversation];
  groupIdentityUpdateHandleID = [conversation groupIdentityUpdateHandleID];
  if (groupIdentityUpdateHandleID)
  {
    conversation2 = [(CKCoreChatController *)self conversation];
    if ([conversation2 isGroupConversation] && !-[CKCoreChatController isInline](self, "isInline"))
    {
      v7 = +[CKUIBehavior sharedBehaviors];
      if ([v7 areBannersSupported])
      {
        v6 = IMIsRunningInScreenshotTesting_IsolatedTranscriptUI();
      }

      else
      {
        v6 = 1;
      }
    }

    else
    {
      v6 = 1;
    }
  }

  else
  {
    v6 = 1;
  }

  return v6;
}

- (BOOL)showGroupBannerUpdateIfNeeded
{
  v15[1] = *MEMORY[0x1E69E9840];
  if ([(CKChatController *)self shouldNotShowGroupBanners])
  {
    return 0;
  }

  groupPhotoUpdateBanner = [(CKChatController *)self groupPhotoUpdateBanner];

  if (!groupPhotoUpdateBanner)
  {
    conversation = [(CKCoreChatController *)self conversation];
    v5 = [conversation conversationVisualIdentityWithKeys:MEMORY[0x1E695E0F0] requestedNumberOfContactsToFetch:0];
    groupPhoto = [v5 groupPhoto];
    groupName = [v5 groupName];
    if ([conversation shouldDisplayGroupIdentity] && objc_msgSend(conversation, "shouldShowGroupPhotoUpdateBanner") && objc_msgSend(conversation, "shouldShowGroupNameUpdateBanner"))
    {
      if ([groupPhoto length] && objc_msgSend(groupName, "length"))
      {
        v8 = 3;
      }

      else if ([groupPhoto length])
      {
        v8 = 8;
      }

      else if ([groupName length])
      {
        v8 = 7;
      }

      else
      {
        v8 = 6;
      }
    }

    else if ([conversation shouldDisplayGroupIdentity] && objc_msgSend(conversation, "shouldShowGroupNameUpdateBanner") && objc_msgSend(groupName, "length"))
    {
      v8 = 1;
    }

    else if ([conversation shouldDisplayGroupIdentity] && objc_msgSend(conversation, "shouldShowGroupNameUpdateBanner") && !objc_msgSend(groupName, "length"))
    {
      v8 = 5;
    }

    else if ([conversation shouldDisplayGroupIdentity] && objc_msgSend(conversation, "shouldShowGroupPhotoUpdateBanner") && objc_msgSend(groupPhoto, "length"))
    {
      v8 = 2;
    }

    else
    {
      if (![conversation shouldDisplayGroupIdentity] || !objc_msgSend(conversation, "shouldShowGroupPhotoUpdateBanner") || groupPhoto)
      {
        goto LABEL_32;
      }

      v8 = 4;
    }

    v9 = [(CKChatController *)self createGroupUpdateWithType:v8];
    if (v9)
    {
      v10 = v9;
      v15[0] = v9;
      v11 = [MEMORY[0x1E695DEC8] arrayWithObjects:v15 count:1];
      v12 = [(CKChatController *)self createBannerForGroupUpdates:v11];
      [(CKChatController *)self setGroupPhotoUpdateBanner:v12];
    }

LABEL_32:
  }

  groupPhotoUpdateBanner2 = [(CKChatController *)self groupPhotoUpdateBanner];

  if (groupPhotoUpdateBanner2)
  {
    return [(CKChatController *)self presentUpdateBanner];
  }

  return 0;
}

- (id)createGroupUpdateWithType:(int64_t)type
{
  v5 = [CKGroupUpdate alloc];
  conversation = [(CKCoreChatController *)self conversation];
  groupIdentityUpdateHandleID = [conversation groupIdentityUpdateHandleID];
  v8 = [(CKGroupUpdate *)v5 initWithType:type handleID:groupIdentityUpdateHandleID];

  return v8;
}

- (BOOL)presentUpdateBanner
{
  view = [(CKChatController *)self view];
  groupPhotoUpdateBanner = [(CKChatController *)self groupPhotoUpdateBanner];
  [view addSubview:groupPhotoUpdateBanner];

  groupPhotoUpdateBanner2 = [(CKChatController *)self groupPhotoUpdateBanner];
  [(CKChatController *)self _presentBannerView:groupPhotoUpdateBanner2 completion:0];

  return 1;
}

- (BOOL)accountCanCreateNickname
{
  mEMORY[0x1E69A8070] = [MEMORY[0x1E69A8070] sharedFeatureFlags];
  isAllowMultiplePhoneNumbersSNaPEnabled = [mEMORY[0x1E69A8070] isAllowMultiplePhoneNumbersSNaPEnabled];

  v4 = IMSharedHelperNickNameEnabled();
  if (isAllowMultiplePhoneNumbersSNaPEnabled)
  {
    if (v4)
    {
      mEMORY[0x1E69A5C10] = [MEMORY[0x1E69A5C10] sharedInstance];
      LOBYTE(v6) = [mEMORY[0x1E69A5C10] iCloudSignedInToUseNicknames];
LABEL_9:

      return v6;
    }
  }

  else if (v4)
  {
    mEMORY[0x1E69A5C10] = [MEMORY[0x1E69A5C10] sharedInstance];
    if ([mEMORY[0x1E69A5C10] iCloudSignedInToUseNicknames])
    {
      v6 = [MEMORY[0x1E69A5C10] multiplePhoneNumbersTiedToAppleID] ^ 1;
    }

    else
    {
      LOBYTE(v6) = 0;
    }

    goto LABEL_9;
  }

  LOBYTE(v6) = 0;
  return v6;
}

- (BOOL)shouldShowAcceptedContactBanner
{
  chat = [(CKCoreChatController *)self chat];
  recipient = [chat recipient];
  v5 = [recipient cnContactWithKeys:MEMORY[0x1E695E0F0]];

  if (![v5 isCoreRecentsAccepted])
  {
    goto LABEL_4;
  }

  chat2 = [(CKCoreChatController *)self chat];
  isStewieChat = [chat2 isStewieChat];

  if ((isStewieChat & 1) != 0 || [(CKChatController *)self isShowingOscarChat])
  {
    goto LABEL_4;
  }

  conversation = [(CKCoreChatController *)self conversation];
  if ([conversation isWithMyself])
  {
    LOBYTE(v8) = 0;
LABEL_8:

    goto LABEL_5;
  }

  conversation2 = [(CKCoreChatController *)self conversation];
  chat3 = [conversation2 chat];
  isGroupChat = [chat3 isGroupChat];

  if ((isGroupChat & 1) == 0)
  {
    chat4 = [(CKCoreChatController *)self chat];
    allowedByScreenTime = [chat4 allowedByScreenTime];

    if (allowedByScreenTime)
    {
      conversation3 = [(CKCoreChatController *)self conversation];
      chat5 = [conversation3 chat];
      conversation = [chat5 valueForChatProperty:*MEMORY[0x1E69A6AE8]];

      if (conversation)
      {
        v8 = [conversation BOOLValue] ^ 1;
      }

      else
      {
        LOBYTE(v8) = 1;
      }

      goto LABEL_8;
    }
  }

LABEL_4:
  LOBYTE(v8) = 0;
LABEL_5:

  return v8;
}

- (void)showOrHideAcceptedContactBannerIfNeeded
{
  objc_initWeak(&location, self);
  aBlock[0] = MEMORY[0x1E69E9820];
  aBlock[1] = 3221225472;
  aBlock[2] = __59__CKChatController_showOrHideAcceptedContactBannerIfNeeded__block_invoke;
  aBlock[3] = &unk_1E72EC460;
  objc_copyWeak(&v20, &location);
  v3 = _Block_copy(aBlock);
  if ([(CKChatController *)self shouldShowAcceptedContactBanner])
  {
    chat = [(CKCoreChatController *)self chat];
    recipient = [chat recipient];

    if (recipient)
    {
      nameThatIsNotHandle = [recipient nameThatIsNotHandle];
      if (nameThatIsNotHandle)
      {
        nameThatIsNotHandle2 = [recipient nameThatIsNotHandle];
      }

      else
      {
        v8 = CKFrameworkBundle();
        nameThatIsNotHandle2 = [v8 localizedStringForKey:@"NEW_SENDER_BANNER_TITLE" value:&stru_1F04268F8 table:@"ChatKit"];
      }

      displayID = [recipient displayID];
      v9 = objc_alloc_init(CKNicknameUpdate);
      [(CKNicknameUpdate *)v9 setHandle:recipient];
      nicknameObject = [recipient nicknameObject];
      if (nicknameObject)
      {
        [(CKNicknameUpdate *)v9 setNickname:nicknameObject];
      }

      if (CKIsRunningInMacCatalyst())
      {
        v11 = MEMORY[0x1E695E0F0];
      }

      else
      {
        v11 = [CKNicknameUtility addContactOptionsMenuItemsWithTarget:self update:v9];
      }

      v17[0] = MEMORY[0x1E69E9820];
      v17[1] = 3221225472;
      v17[2] = __59__CKChatController_showOrHideAcceptedContactBannerIfNeeded__block_invoke_3;
      v17[3] = &unk_1E72EE148;
      objc_copyWeak(&v18, &location);
      v12 = _Block_copy(v17);
      v13 = [[_TtC7ChatKit25AcceptedContactBannerView alloc] initWithTitle:nameThatIsNotHandle2 subtitle:displayID update:v9 actionButtonHandler:v12 actionButtonMenuItems:v11 xButtonHandler:v3];
      acceptedContactBanner = [(CKChatController *)self acceptedContactBanner];

      if (!acceptedContactBanner)
      {
        [(CKChatController *)self setAcceptedContactBanner:v13];
        [(CKChatController *)self _presentBannerView:v13 completion:0];
        [(CKScrollViewController *)self updateScrollGeometryWithoutAnimationForReason:@"GroupPhotoBannerChangedSize"];
      }

      objc_destroyWeak(&v18);
    }
  }

  else
  {
    acceptedContactBanner2 = [(CKChatController *)self acceptedContactBanner];

    if (acceptedContactBanner2)
    {
      v3[2](v3);
    }
  }

  objc_destroyWeak(&v20);
  objc_destroyWeak(&location);
}

void __59__CKChatController_showOrHideAcceptedContactBannerIfNeeded__block_invoke(uint64_t a1)
{
  v2 = objc_loadWeakRetained((a1 + 32));
  v3 = [v2 acceptedContactBanner];
  v4[0] = MEMORY[0x1E69E9820];
  v4[1] = 3221225472;
  v4[2] = __59__CKChatController_showOrHideAcceptedContactBannerIfNeeded__block_invoke_2;
  v4[3] = &unk_1E72EC460;
  objc_copyWeak(&v5, (a1 + 32));
  [v2 _dismissBannerView:v3 completion:v4];

  objc_destroyWeak(&v5);
}

void __59__CKChatController_showOrHideAcceptedContactBannerIfNeeded__block_invoke_2(uint64_t a1)
{
  WeakRetained = objc_loadWeakRetained((a1 + 32));
  [WeakRetained setAcceptedContactBanner:0];

  v3 = objc_loadWeakRetained((a1 + 32));
  [v3 updateScrollGeometryWithoutAnimationForReason:@"BannerDismissed"];

  v6 = objc_loadWeakRetained((a1 + 32));
  v4 = [v6 conversation];
  v5 = [v4 chat];
  [v5 setValue:MEMORY[0x1E695E118] forChatProperty:*MEMORY[0x1E69A6AE8]];
}

void __59__CKChatController_showOrHideAcceptedContactBannerIfNeeded__block_invoke_3(uint64_t a1)
{
  WeakRetained = objc_loadWeakRetained((a1 + 32));
  v1 = [WeakRetained conversation];
  v2 = [v1 chat];
  [v2 setValue:MEMORY[0x1E695E118] forChatProperty:*MEMORY[0x1E69A6AE8]];
}

- (BOOL)_showOrHideNicknameBannerIfNeeded
{
  v52 = *MEMORY[0x1E69E9840];
  chat = [(CKCoreChatController *)self chat];
  isStewieChat = [chat isStewieChat];

  if ((isStewieChat & 1) == 0 && ![(CKChatController *)self isAnimatingMessageSend]&& ![(CKChatController *)self isShowingOscarChat])
  {
    conversation = [(CKCoreChatController *)self conversation];
    isWithMyself = [conversation isWithMyself];

    if ((isWithMyself & 1) == 0)
    {
      chat2 = [(CKCoreChatController *)self chat];
      canSuggestRecipientContact = [chat2 canSuggestRecipientContact];

      if (canSuggestRecipientContact)
      {
        v47 = 0;
        v9 = [(CKCoreChatController *)self _retrieveNicknameBannerUpdatesIfNeeded:&v47];
        if (v9)
        {
          if (!v47 || [(CKChatController *)self _wantsToShowCollaborationNotices])
          {
            nicknameBanner = [(CKChatController *)self nicknameBanner];

            if (nicknameBanner)
            {
              nicknameBanner2 = [(CKChatController *)self nicknameBanner];
              v40[0] = MEMORY[0x1E69E9820];
              v40[1] = 3221225472;
              v40[2] = __53__CKChatController__showOrHideNicknameBannerIfNeeded__block_invoke_7;
              v40[3] = &unk_1E72EBA18;
              v40[4] = self;
              [(CKChatController *)self _dismissBannerView:nicknameBanner2 completion:v40];
            }

            v12 = [v9 count] != 0;
            goto LABEL_16;
          }

          if (![(CKChatController *)self _hasExistingBannerMatchingStyle:v47 withNicknames:v9])
          {
            if (IMOSLoggingEnabled())
            {
              v14 = OSLogHandleForIMFoundationCategory();
              if (os_log_type_enabled(v14, OS_LOG_TYPE_INFO))
              {
                *buf = 134218242;
                v49 = v47;
                v50 = 2112;
                v51 = v9;
                _os_log_impl(&dword_19020E000, v14, OS_LOG_TYPE_INFO, "Will present nickname banner with state %lu, and updates %@", buf, 0x16u);
              }
            }

            if (v47 == 4)
            {
              isGroupConversation = 0;
            }

            else
            {
              conversation2 = [(CKCoreChatController *)self conversation];
              isGroupConversation = [conversation2 isGroupConversation];
            }

            objc_initWeak(buf, self);
            firstObject = [v9 firstObject];
            contact = [firstObject contact];
            if (CKIsRunningInMacCatalyst() || contact || (v47 - 4) < 3)
            {
              v38 = 0;
              if (v47 == 3 && contact)
              {
                v38 = [CKNicknameUtility updateNameAndPhotoMenuItemsWithTarget:self update:firstObject];
              }
            }

            else
            {
              v38 = [CKNicknameUtility addContactOptionsMenuItemsWithTarget:self update:firstObject];
            }

            aBlock[0] = MEMORY[0x1E69E9820];
            aBlock[1] = 3221225472;
            aBlock[2] = __53__CKChatController__showOrHideNicknameBannerIfNeeded__block_invoke;
            aBlock[3] = &unk_1E72EE198;
            v46[1] = v47;
            objc_copyWeak(v46, buf);
            v18 = v9;
            v45 = v18;
            v37 = _Block_copy(aBlock);
            v36 = [CKNicknameUtility bannerTitleTextWithUpdates:v18 style:v47 useNamedTitles:isGroupConversation];
            v35 = [CKNicknameUtility bannerSubtitleTextWithUpdates:v18 style:v47];
            v34 = [CKNicknameUtility bannerActionButtonStringWithUpdates:v18 style:v47];
            v41[0] = MEMORY[0x1E69E9820];
            v41[1] = 3221225472;
            v41[2] = __53__CKChatController__showOrHideNicknameBannerIfNeeded__block_invoke_4;
            v41[3] = &unk_1E72EE1C0;
            objc_copyWeak(&v43, buf);
            v19 = v18;
            v42 = v19;
            v20 = _Block_copy(v41);
            v21 = [CKNicknameUtility avatarContactsForUpdates:v19 style:v47];
            v22 = [CKNicknameUtility customImageForUpdate:firstObject style:v47];
            v23 = [CKNicknameBannerView alloc];
            v24 = [(CKNicknameBannerView *)v23 initWithStyle:v47 updates:v19 useNamedTitles:isGroupConversation avatarImages:0 contacts:v21 customImage:v22 titleString:v36 subtitleString:v35 actionButtonTitle:v34 actionButtonHandler:v20 actionButtonMenuItems:v38 xButtonHandler:v37];
            if ([(CKChatController *)self _anySuggestionPresenterWantsToShowBanner])
            {
              suggestionBannerView = [(CKChatController *)self suggestionBannerView];
              v26 = suggestionBannerView == 0;

              if (!v26)
              {
                suggestionBannerView2 = [(CKChatController *)self suggestionBannerView];
                [(CKChatController *)self removeSuggestionsBanner:suggestionBannerView2 animated:1];
              }
            }

            nicknameBanner3 = [(CKChatController *)self nicknameBanner];

            if (nicknameBanner3)
            {
              nicknameBanner4 = [(CKChatController *)self nicknameBanner];
              nicknameUpdates = [nicknameBanner4 nicknameUpdates];
              v31 = [nicknameUpdates __imArrayByApplyingBlock:&__block_literal_global_1571];

              nicknameBanner5 = [(CKChatController *)self nicknameBanner];
              [(CKChatController *)self _replaceBannerView:nicknameBanner5 withNewBannerView:v24 placingHandlesUnderScrutiny:v31 completion:0];

              [(CKChatController *)self setNicknameBanner:v24];
            }

            else
            {
              [(CKChatController *)self setNicknameBanner:v24];
              nicknameUpdates2 = [(CKNicknameBannerView *)v24 nicknameUpdates];
              v31 = [nicknameUpdates2 __imArrayByApplyingBlock:&__block_literal_global_1573];

              [(CKChatController *)self _presentBannerView:v24 placingHandlesUnderScrutiny:v31 completion:0];
            }

            objc_destroyWeak(&v43);
            objc_destroyWeak(v46);

            objc_destroyWeak(buf);
            v12 = 1;
            goto LABEL_16;
          }
        }

        v12 = 0;
LABEL_16:

        return v12;
      }
    }
  }

  return 0;
}

void __53__CKChatController__showOrHideNicknameBannerIfNeeded__block_invoke(id *a1, void *a2)
{
  v3 = a2;
  aBlock[0] = MEMORY[0x1E69E9820];
  aBlock[1] = 3221225472;
  aBlock[2] = __53__CKChatController__showOrHideNicknameBannerIfNeeded__block_invoke_2;
  aBlock[3] = &unk_1E72EE170;
  v17[1] = a1[6];
  objc_copyWeak(v17, a1 + 5);
  v16 = a1[4];
  v4 = _Block_copy(aBlock);
  WeakRetained = objc_loadWeakRetained(a1 + 5);
  [WeakRetained setNicknameBanner:0];

  v6 = objc_loadWeakRetained(a1 + 5);
  v12[0] = MEMORY[0x1E69E9820];
  v12[1] = 3221225472;
  v12[2] = __53__CKChatController__showOrHideNicknameBannerIfNeeded__block_invoke_3;
  v12[3] = &unk_1E72EC1F0;
  v7 = v4;
  v13 = v7;
  objc_copyWeak(&v14, a1 + 5);
  [v6 _dismissBannerView:v3 completion:v12];

  v8 = objc_loadWeakRetained(a1 + 5);
  if (![v8 _anySuggestionPresenterWantsToShowBanner])
  {
    goto LABEL_4;
  }

  v9 = objc_loadWeakRetained(a1 + 5);
  v10 = [v9 suggestionBannerView];

  if (v10)
  {
    v8 = objc_loadWeakRetained(a1 + 5);
    v11 = [v8 suggestionBannerView];
    [v8 addSuggestionBanner:v11 animated:1];

LABEL_4:
  }

  objc_destroyWeak(&v14);

  objc_destroyWeak(v17);
}

void __53__CKChatController__showOrHideNicknameBannerIfNeeded__block_invoke_2(uint64_t a1)
{
  v21 = *MEMORY[0x1E69E9840];
  v2 = *(a1 + 48);
  if (v2 == 5)
  {
    v15 = [MEMORY[0x1E69A5C10] sharedInstance];
    WeakRetained = objc_loadWeakRetained((a1 + 40));
    v4 = [WeakRetained conversation];
    v5 = [v4 chat];
    v6 = [v5 participants];
    [v15 denyHandlesForNicknameSharing:v6];

    goto LABEL_5;
  }

  if (v2 == 6)
  {
    v15 = objc_loadWeakRetained((a1 + 40));
    [v15 nicknameBannerDidInteractWithOnboardingOffer];
LABEL_5:

    return;
  }

  v18 = 0u;
  v19 = 0u;
  v16 = 0u;
  v17 = 0u;
  v7 = *(a1 + 32);
  v8 = [v7 countByEnumeratingWithState:&v16 objects:v20 count:16];
  if (v8)
  {
    v9 = v8;
    v10 = *v17;
    do
    {
      for (i = 0; i != v9; ++i)
      {
        if (*v17 != v10)
        {
          objc_enumerationMutation(v7);
        }

        v12 = *(*(&v16 + 1) + 8 * i);
        v13 = [MEMORY[0x1E69A5C10] sharedInstance];
        v14 = [v12 handle];
        [v13 clearPendingNicknameUpdatesForHandle:v14 forceClear:1];
      }

      v9 = [v7 countByEnumeratingWithState:&v16 objects:v20 count:16];
    }

    while (v9);
  }
}

void __53__CKChatController__showOrHideNicknameBannerIfNeeded__block_invoke_3(uint64_t a1)
{
  (*(*(a1 + 32) + 16))();
  WeakRetained = objc_loadWeakRetained((a1 + 40));
  [WeakRetained setNicknameBanner:0];

  v3 = objc_loadWeakRetained((a1 + 40));
  [v3 updateScrollGeometryWithoutAnimationForReason:@"BannerDismissed"];

  v4 = objc_loadWeakRetained((a1 + 40));
  [v4 updateFoundInSuggestionPresenter];
}

void __53__CKChatController__showOrHideNicknameBannerIfNeeded__block_invoke_4(uint64_t a1, void *a2, void *a3)
{
  v5 = a3;
  v6 = a2;
  WeakRetained = objc_loadWeakRetained((a1 + 40));
  [WeakRetained nicknameBannerView:v6 actionButtonTapped:v5 forUpdates:*(a1 + 32)];
}

uint64_t __53__CKChatController__showOrHideNicknameBannerIfNeeded__block_invoke_7(uint64_t a1)
{
  [*(a1 + 32) setNicknameBanner:0];
  v2 = *(a1 + 32);

  return [v2 updateScrollGeometryWithoutAnimationForReason:@"BannerDismissed"];
}

- (void)nicknameStoreDidChange:(id)change
{
  [(CKChatController *)self _showOrHideNicknameBannerIfNeeded];

  [(CKChatController *)self _autoAcceptNicknameIfNeeded];
}

- (void)_autoAcceptNicknameIfNeeded
{
  v28[1] = *MEMORY[0x1E69E9840];
  conversation = [(CKCoreChatController *)self conversation];
  handles = [conversation handles];
  firstObject = [handles firstObject];
  v6 = [firstObject ID];

  if (![(CKChatController *)self shouldShowAvatarViewInNavBarCanvas])
  {
    conversation2 = [(CKCoreChatController *)self conversation];
    isGroupConversation = [conversation2 isGroupConversation];

    if ((isGroupConversation & 1) == 0)
    {
      if (v6)
      {
        mEMORY[0x1E69A5C10] = [MEMORY[0x1E69A5C10] sharedInstance];
        v10 = MEMORY[0x1E695DFD8];
        v28[0] = v6;
        v11 = [MEMORY[0x1E695DEC8] arrayWithObjects:v28 count:1];
        v12 = [v10 setWithArray:v11];
        v13 = [mEMORY[0x1E69A5C10] pendingNicknameForHandleIDs:v12];
        v14 = v13 == 0;

        if (v14)
        {
          if (IMOSLoggingEnabled())
          {
            v21 = OSLogHandleForIMFoundationCategory();
            if (os_log_type_enabled(v21, OS_LOG_TYPE_INFO))
            {
              *buf = 0;
              _os_log_impl(&dword_19020E000, v21, OS_LOG_TYPE_INFO, "Not auto-updating, no pending nickname available.", buf, 2u);
            }
          }
        }

        else
        {
          mEMORY[0x1E69A5C10]2 = [MEMORY[0x1E69A5C10] sharedInstance];
          v27 = v6;
          v16 = [MEMORY[0x1E695DEC8] arrayWithObjects:&v27 count:1];
          v17 = [mEMORY[0x1E69A5C10]2 createSharedProfileStateOracleForHandles:v16];

          if ([v17 effectiveStateForContact] == 1 || objc_msgSend(v17, "effectiveStateForContact") == 3)
          {
            v22 = 0;
            v18 = [v17 updateContactAndNicknamesForAutoUpdateWithError:&v22];
            v19 = v22;
            if (IMOSLoggingEnabled())
            {
              v20 = OSLogHandleForIMFoundationCategory();
              if (os_log_type_enabled(v20, OS_LOG_TYPE_INFO))
              {
                *buf = 138412546;
                v24 = v6;
                v25 = 2112;
                v26 = v19;
                _os_log_impl(&dword_19020E000, v20, OS_LOG_TYPE_INFO, "Updated contact and nicknames for recipient: %@, error: %@", buf, 0x16u);
              }
            }
          }
        }
      }
    }
  }
}

- (void)_presentBannerView:(id)view placingHandlesUnderScrutiny:(id)scrutiny completion:(id)completion
{
  v50 = *MEMORY[0x1E69E9840];
  viewCopy = view;
  scrutinyCopy = scrutiny;
  completionCopy = completion;
  if (IMOSLoggingEnabled())
  {
    v7 = OSLogHandleForIMFoundationCategory();
    if (os_log_type_enabled(v7, OS_LOG_TYPE_INFO))
    {
      *buf = 138412290;
      v49 = viewCopy;
      _os_log_impl(&dword_19020E000, v7, OS_LOG_TYPE_INFO, "Present update banner view %@", buf, 0xCu);
    }
  }

  if ([scrutinyCopy count])
  {
    v45 = 0u;
    v46 = 0u;
    v44 = 0u;
    v43 = 0u;
    v8 = scrutinyCopy;
    v9 = [v8 countByEnumeratingWithState:&v43 objects:v47 count:16];
    if (v9)
    {
      v10 = *v44;
      while (2)
      {
        for (i = 0; i != v9; ++i)
        {
          if (*v44 != v10)
          {
            objc_enumerationMutation(v8);
          }

          v12 = *(*(&v43 + 1) + 8 * i);
          mEMORY[0x1E69A5C10] = [MEMORY[0x1E69A5C10] sharedInstance];
          handlesForNicknamesUnderScrutiny = [mEMORY[0x1E69A5C10] handlesForNicknamesUnderScrutiny];
          v15 = [v12 ID];
          v16 = [handlesForNicknamesUnderScrutiny containsObject:v15];

          v17 = IMOSLoggingEnabled();
          if (v16)
          {
            if (v17)
            {
              v30 = OSLogHandleForIMFoundationCategory();
              if (os_log_type_enabled(v30, OS_LOG_TYPE_INFO))
              {
                v31 = [v12 ID];
                *buf = 138412290;
                v49 = v31;
                _os_log_impl(&dword_19020E000, v30, OS_LOG_TYPE_INFO, "CKChatController - Skipping handling %@, under scrutiny;  now clearing from scrutiny", buf, 0xCu);
              }
            }

            mEMORY[0x1E69A5C10]2 = [MEMORY[0x1E69A5C10] sharedInstance];
            [mEMORY[0x1E69A5C10]2 ignorePendingNicknameUpdatesForHandle:v12];

            mEMORY[0x1E69A5C10]3 = [MEMORY[0x1E69A5C10] sharedInstance];
            [mEMORY[0x1E69A5C10]3 clearHandleFromScrutiny:v12];

            goto LABEL_39;
          }

          if (v17)
          {
            v18 = OSLogHandleForIMFoundationCategory();
            if (os_log_type_enabled(v18, OS_LOG_TYPE_INFO))
            {
              v19 = [v12 ID];
              *buf = 138412290;
              v49 = v19;
              _os_log_impl(&dword_19020E000, v18, OS_LOG_TYPE_INFO, "Placing %@ under scrutiny", buf, 0xCu);
            }
          }

          mEMORY[0x1E69A5C10]4 = [MEMORY[0x1E69A5C10] sharedInstance];
          [mEMORY[0x1E69A5C10]4 markHandleUnderScrutiny:v12];
        }

        v9 = [v8 countByEnumeratingWithState:&v43 objects:v47 count:16];
        if (v9)
        {
          continue;
        }

        break;
      }
    }
  }

  [viewCopy setAlpha:0.0];
  if (-[CKCoreChatController isShowingLockoutView](self, "isShowingLockoutView") && (-[CKCoreChatController lockoutViewController](self, "lockoutViewController"), v21 = objc_claimAutoreleasedReturnValue(), [v21 view], v8 = objc_claimAutoreleasedReturnValue(), v21, v8))
  {
    view = [(CKChatController *)self view];
    [view insertSubview:viewCopy belowSubview:v8];
  }

  else
  {
    view = [(CKChatController *)self view];
    [view addSubview:viewCopy];
    v8 = 0;
  }

  if ([scrutinyCopy count])
  {
    if (IMOSLoggingEnabled())
    {
      v23 = OSLogHandleForIMFoundationCategory();
      if (os_log_type_enabled(v23, OS_LOG_TYPE_INFO))
      {
        *buf = 138412290;
        v49 = scrutinyCopy;
        _os_log_impl(&dword_19020E000, v23, OS_LOG_TYPE_INFO, "Removing from scrutiny after presenting banner: %@", buf, 0xCu);
      }
    }

    [(CKChatController *)self clearHandlesFromScrutiny:scrutinyCopy];
  }

  [(CKChatController *)self _layoutBannerView:viewCopy];
  inlineReplyController = [(CKChatController *)self inlineReplyController];

  if (!inlineReplyController)
  {
    transitionCoordinator = [(CKChatController *)self transitionCoordinator];

    if (transitionCoordinator)
    {
      transitionCoordinator2 = [(CKChatController *)self transitionCoordinator];
      v41[0] = MEMORY[0x1E69E9820];
      v41[1] = 3221225472;
      v41[2] = __78__CKChatController__presentBannerView_placingHandlesUnderScrutiny_completion___block_invoke;
      v41[3] = &unk_1E72EC3E8;
      v27 = viewCopy;
      v42 = v27;
      v28 = [transitionCoordinator2 animateAlongsideTransition:v41 completion:0];

      if ((v28 & 1) == 0)
      {
        v29 = MEMORY[0x1E69DD250];
        v39[0] = MEMORY[0x1E69E9820];
        v39[1] = 3221225472;
        v39[2] = __78__CKChatController__presentBannerView_placingHandlesUnderScrutiny_completion___block_invoke_2;
        v39[3] = &unk_1E72EBA18;
        v40 = v27;
        v38[0] = MEMORY[0x1E69E9820];
        v38[1] = 3221225472;
        v38[2] = __78__CKChatController__presentBannerView_placingHandlesUnderScrutiny_completion___block_invoke_3;
        v38[3] = &unk_1E72EB9C8;
        v38[4] = self;
        [v29 animateWithDuration:v39 animations:v38 completion:0.1];
      }
    }

    else
    {
      [viewCopy setAlpha:1.0];
      [(CKChatController *)self _showCatchUpButtonIfNeeded];
    }
  }

LABEL_39:
}

- (void)_dismissBannerView:(id)view completion:(id)completion
{
  v23 = *MEMORY[0x1E69E9840];
  viewCopy = view;
  completionCopy = completion;
  if (IMOSLoggingEnabled())
  {
    v8 = OSLogHandleForIMFoundationCategory();
    if (os_log_type_enabled(v8, OS_LOG_TYPE_INFO))
    {
      *buf = 138412290;
      v22 = viewCopy;
      _os_log_impl(&dword_19020E000, v8, OS_LOG_TYPE_INFO, "Dismiss banner view %@", buf, 0xCu);
    }
  }

  collectionView = [(CKChatController *)self collectionView];
  __ck_isScrolledToTop = [collectionView __ck_isScrolledToTop];

  v11 = MEMORY[0x1E69DD250];
  v19[0] = MEMORY[0x1E69E9820];
  v19[1] = 3221225472;
  v19[2] = __50__CKChatController__dismissBannerView_completion___block_invoke;
  v19[3] = &unk_1E72EBA18;
  v20 = viewCopy;
  v14[0] = MEMORY[0x1E69E9820];
  v14[1] = 3221225472;
  v14[2] = __50__CKChatController__dismissBannerView_completion___block_invoke_2;
  v14[3] = &unk_1E72EE208;
  v15 = v20;
  selfCopy = self;
  v18 = __ck_isScrolledToTop;
  v17 = completionCopy;
  v12 = completionCopy;
  v13 = v20;
  [v11 animateWithDuration:v19 animations:v14 completion:0.1];
}

uint64_t __50__CKChatController__dismissBannerView_completion___block_invoke_2(uint64_t a1)
{
  [*(a1 + 32) removeFromSuperview];
  [*(a1 + 32) setAlpha:1.0];
  [*(a1 + 40) updateScrollGeometryWithoutAnimationForReason:@"BannerDismissed"];
  if (*(a1 + 56) == 1)
  {
    v2 = [*(a1 + 40) collectionView];
    [v2 __ck_scrollToTop:1];
  }

  v3 = *(a1 + 48);
  if (v3)
  {
    (*(v3 + 16))();
  }

  v4 = *(a1 + 40);

  return [v4 _showCatchUpButtonIfNeeded];
}

- (void)_replaceBannerView:(id)view withNewBannerView:(id)bannerView placingHandlesUnderScrutiny:(id)scrutiny completion:(id)completion
{
  selfCopy = self;
  v58 = *MEMORY[0x1E69E9840];
  viewCopy = view;
  bannerViewCopy = bannerView;
  scrutinyCopy = scrutiny;
  completionCopy = completion;
  if (IMOSLoggingEnabled())
  {
    v10 = OSLogHandleForIMFoundationCategory();
    if (os_log_type_enabled(v10, OS_LOG_TYPE_INFO))
    {
      *buf = 138412546;
      *&buf[4] = viewCopy;
      *&buf[12] = 2112;
      *&buf[14] = bannerViewCopy;
      _os_log_impl(&dword_19020E000, v10, OS_LOG_TYPE_INFO, "Replace nickname banner view %@ with new banner view %@", buf, 0x16u);
    }
  }

  v36 = viewCopy;
  if (viewCopy == bannerViewCopy)
  {
    if (IMOSLoggingEnabled())
    {
      v33 = OSLogHandleForIMFoundationCategory();
      if (os_log_type_enabled(v33, OS_LOG_TYPE_INFO))
      {
        *buf = 0;
        _os_log_impl(&dword_19020E000, v33, OS_LOG_TYPE_INFO, "Nickname banners are equal, not replacing", buf, 2u);
      }
    }
  }

  else
  {
    v51 = 0u;
    v52 = 0u;
    v50 = 0u;
    v49 = 0u;
    v11 = scrutinyCopy;
    v12 = [v11 countByEnumeratingWithState:&v49 objects:v57 count:16];
    if (v12)
    {
      v13 = *v50;
      while (2)
      {
        for (i = 0; i != v12; ++i)
        {
          if (*v50 != v13)
          {
            objc_enumerationMutation(v11);
          }

          v15 = *(*(&v49 + 1) + 8 * i);
          mEMORY[0x1E69A5C10] = [MEMORY[0x1E69A5C10] sharedInstance];
          handlesForNicknamesUnderScrutiny = [mEMORY[0x1E69A5C10] handlesForNicknamesUnderScrutiny];
          v18 = [v15 ID];
          v19 = [handlesForNicknamesUnderScrutiny containsObject:v18];

          v20 = IMOSLoggingEnabled();
          if (v19)
          {
            if (v20)
            {
              v29 = OSLogHandleForIMFoundationCategory();
              if (os_log_type_enabled(v29, OS_LOG_TYPE_INFO))
              {
                v30 = [v15 ID];
                *buf = 138412290;
                *&buf[4] = v30;
                _os_log_impl(&dword_19020E000, v29, OS_LOG_TYPE_INFO, "CKChatController - Skipping handling %@, under scrutiny;  now clearing from scrutiny", buf, 0xCu);
              }
            }

            mEMORY[0x1E69A5C10]2 = [MEMORY[0x1E69A5C10] sharedInstance];
            [mEMORY[0x1E69A5C10]2 ignorePendingNicknameUpdatesForHandle:v15];

            mEMORY[0x1E69A5C10]3 = [MEMORY[0x1E69A5C10] sharedInstance];
            [mEMORY[0x1E69A5C10]3 clearHandleFromScrutiny:v15];

            goto LABEL_34;
          }

          if (v20)
          {
            v21 = OSLogHandleForIMFoundationCategory();
            if (os_log_type_enabled(v21, OS_LOG_TYPE_INFO))
            {
              v22 = [v15 ID];
              *buf = 138412290;
              *&buf[4] = v22;
              _os_log_impl(&dword_19020E000, v21, OS_LOG_TYPE_INFO, "Placing %@ under scrutiny", buf, 0xCu);
            }
          }

          mEMORY[0x1E69A5C10]4 = [MEMORY[0x1E69A5C10] sharedInstance];
          [mEMORY[0x1E69A5C10]4 markHandleUnderScrutiny:v15];
        }

        v12 = [v11 countByEnumeratingWithState:&v49 objects:v57 count:16];
        if (v12)
        {
          continue;
        }

        break;
      }
    }

    [(CKChatController *)selfCopy _layoutBannerView:bannerViewCopy];
    [bannerViewCopy setAlpha:0.0];
    view = [(CKChatController *)selfCopy view];
    [view addSubview:bannerViewCopy];

    if ([v11 count])
    {
      if (IMOSLoggingEnabled())
      {
        v25 = OSLogHandleForIMFoundationCategory();
        if (os_log_type_enabled(v25, OS_LOG_TYPE_INFO))
        {
          *buf = 138412290;
          *&buf[4] = v11;
          _os_log_impl(&dword_19020E000, v25, OS_LOG_TYPE_INFO, "Removing from scrutiny after replacing banner: %@", buf, 0xCu);
        }
      }

      [(CKChatController *)selfCopy clearHandlesFromScrutiny:v11, selfCopy];
    }

    collectionView = [(CKChatController *)selfCopy collectionView];
    __ck_isScrolledToTop = [collectionView __ck_isScrolledToTop];

    *buf = 0;
    *&buf[8] = buf;
    *&buf[16] = 0x3032000000;
    v54 = __Block_byref_object_copy__8;
    v55 = __Block_byref_object_dispose__8;
    v56 = v36;
    v28 = MEMORY[0x1E69DD250];
    v46[0] = MEMORY[0x1E69E9820];
    v46[1] = 3221225472;
    v46[2] = __96__CKChatController__replaceBannerView_withNewBannerView_placingHandlesUnderScrutiny_completion___block_invoke;
    v46[3] = &unk_1E72EB8D0;
    v47 = v56;
    v48 = bannerViewCopy;
    v40[0] = MEMORY[0x1E69E9820];
    v40[1] = 3221225472;
    v40[2] = __96__CKChatController__replaceBannerView_withNewBannerView_placingHandlesUnderScrutiny_completion___block_invoke_2;
    v40[3] = &unk_1E72EE230;
    v44 = buf;
    v41 = v47;
    v42 = v35;
    v45 = __ck_isScrolledToTop;
    v43 = completionCopy;
    [v28 animateWithDuration:v46 animations:v40 completion:0.1];

    _Block_object_dispose(buf, 8);
  }

LABEL_34:
}

uint64_t __96__CKChatController__replaceBannerView_withNewBannerView_placingHandlesUnderScrutiny_completion___block_invoke(uint64_t a1)
{
  [*(a1 + 32) setAlpha:0.0];
  v2 = *(a1 + 40);

  return [v2 setAlpha:1.0];
}

uint64_t __96__CKChatController__replaceBannerView_withNewBannerView_placingHandlesUnderScrutiny_completion___block_invoke_2(uint64_t a1)
{
  [*(a1 + 32) removeFromSuperview];
  v2 = *(*(a1 + 56) + 8);
  v3 = *(v2 + 40);
  *(v2 + 40) = 0;

  [*(a1 + 40) updateScrollGeometryWithoutAnimationForReason:@"BannerChangedSize"];
  if (*(a1 + 64) == 1)
  {
    v4 = [*(a1 + 40) collectionView];
    [v4 __ck_scrollToTop:1];
  }

  result = *(a1 + 48);
  if (result)
  {
    v6 = *(result + 16);

    return v6();
  }

  return result;
}

- (void)groupPhotoUpdateBanner:(id)banner dismissedUpdate:(id)update
{
  bannerCopy = banner;
  groupUpdateType = [update groupUpdateType];
  if ((groupUpdateType & 0xFFFFFFFFFFFFFFFBLL) == 1)
  {
    conversation = [(CKCoreChatController *)self conversation];
    [conversation setShouldShowGroupNameUpdateBanner:0];
LABEL_8:

    goto LABEL_9;
  }

  if (groupUpdateType <= 8)
  {
    if (((1 << groupUpdateType) & 0x1C8) != 0)
    {
      conversation2 = [(CKCoreChatController *)self conversation];
      [conversation2 setShouldShowGroupNameUpdateBanner:0];

LABEL_7:
      conversation = [(CKCoreChatController *)self conversation];
      [conversation setShouldShowGroupPhotoUpdateBanner:0];
      goto LABEL_8;
    }

    if (((1 << groupUpdateType) & 0x14) != 0)
    {
      goto LABEL_7;
    }
  }

LABEL_9:
  conversation3 = [(CKCoreChatController *)self conversation];
  [conversation3 setGroupIdentityUpdateHandleID:0];

  v11[0] = MEMORY[0x1E69E9820];
  v11[1] = 3221225472;
  v11[2] = __59__CKChatController_groupPhotoUpdateBanner_dismissedUpdate___block_invoke;
  v11[3] = &unk_1E72EBA18;
  v11[4] = self;
  [(CKChatController *)self _dismissBannerView:bannerCopy completion:v11];
}

uint64_t __59__CKChatController_groupPhotoUpdateBanner_dismissedUpdate___block_invoke(uint64_t a1)
{
  [*(a1 + 32) setGroupPhotoUpdateBanner:0];
  v2 = *(a1 + 32);

  return [v2 updateScrollGeometryWithoutAnimationForReason:@"GroupPhotoBannerChangedSize"];
}

- (void)nicknameBannerView:(id)view actionButtonTapped:(id)tapped forUpdates:(id)updates
{
  v34 = *MEMORY[0x1E69E9840];
  viewCopy = view;
  tappedCopy = tapped;
  updatesCopy = updates;
  objc_initWeak(&location, self);
  aBlock[0] = MEMORY[0x1E69E9820];
  aBlock[1] = 3221225472;
  aBlock[2] = __69__CKChatController_nicknameBannerView_actionButtonTapped_forUpdates___block_invoke;
  aBlock[3] = &unk_1E72EBA18;
  v11 = updatesCopy;
  v28 = v11;
  v12 = _Block_copy(aBlock);
  v22[0] = MEMORY[0x1E69E9820];
  v22[1] = 3221225472;
  v22[2] = __69__CKChatController_nicknameBannerView_actionButtonTapped_forUpdates___block_invoke_2;
  v22[3] = &unk_1E72EE280;
  objc_copyWeak(&v26, &location);
  v13 = viewCopy;
  v23 = v13;
  v14 = v12;
  selfCopy = self;
  v25 = v14;
  v15 = _Block_copy(v22);
  firstObject = [v11 firstObject];
  if (IMOSLoggingEnabled())
  {
    v17 = OSLogHandleForIMFoundationCategory();
    if (os_log_type_enabled(v17, OS_LOG_TYPE_INFO))
    {
      style = [v13 style];
      *buf = 138412546;
      v31 = firstObject;
      v32 = 2048;
      v33 = style;
      _os_log_impl(&dword_19020E000, v17, OS_LOG_TYPE_INFO, "Performing action for update %@, with style: %lu", buf, 0x16u);
    }
  }

  style2 = [v13 style];
  if (style2 <= 4)
  {
    if (style2 == 1)
    {
      v20 = 4;
    }

    else
    {
      if (style2 != 2)
      {
        if (style2 == 4)
        {
          [(CKChatController *)self presentNicknameUpdatesViewControllerFromView:tappedCopy];
        }

        goto LABEL_17;
      }

      v20 = 2;
    }

    [(CKChatController *)self updateContactQuietlyForNicknameUpdate:firstObject updateType:v20];
    v15[2](v15, 0);
    goto LABEL_17;
  }

  if ((style2 - 5) < 2)
  {
    if ([v13 style] == 6)
    {
      [(CKChatController *)self nicknameBannerDidInteractWithOnboardingOffer];
      [(CKChatController *)self showNicknameSharingOnboardingWithMemoji:1];
    }

    v21[0] = MEMORY[0x1E69E9820];
    v21[1] = 3221225472;
    v21[2] = __69__CKChatController_nicknameBannerView_actionButtonTapped_forUpdates___block_invoke_1575;
    v21[3] = &unk_1E72EBA18;
    v21[4] = self;
    (v15)[2](v15, v21);
  }

LABEL_17:

  objc_destroyWeak(&v26);
  objc_destroyWeak(&location);
}

void __69__CKChatController_nicknameBannerView_actionButtonTapped_forUpdates___block_invoke(uint64_t a1)
{
  v14 = *MEMORY[0x1E69E9840];
  v9 = 0u;
  v10 = 0u;
  v11 = 0u;
  v12 = 0u;
  v1 = *(a1 + 32);
  v2 = [v1 countByEnumeratingWithState:&v9 objects:v13 count:16];
  if (v2)
  {
    v3 = v2;
    v4 = *v10;
    do
    {
      v5 = 0;
      do
      {
        if (*v10 != v4)
        {
          objc_enumerationMutation(v1);
        }

        v6 = *(*(&v9 + 1) + 8 * v5);
        v7 = [MEMORY[0x1E69A5C10] sharedInstance];
        v8 = [v6 handle];
        [v7 clearPendingNicknameUpdatesForHandle:v8 forceClear:0];

        ++v5;
      }

      while (v3 != v5);
      v3 = [v1 countByEnumeratingWithState:&v9 objects:v13 count:16];
    }

    while (v3);
  }
}

void __69__CKChatController_nicknameBannerView_actionButtonTapped_forUpdates___block_invoke_2(uint64_t a1, void *a2)
{
  v3 = a2;
  WeakRetained = objc_loadWeakRetained((a1 + 56));
  v5 = [WeakRetained nicknameBanner];
  v6 = *(a1 + 32);

  if (v5 == v6)
  {
    v7 = objc_loadWeakRetained((a1 + 56));
    v8 = *(a1 + 32);
    v9[0] = MEMORY[0x1E69E9820];
    v9[1] = 3221225472;
    v9[2] = __69__CKChatController_nicknameBannerView_actionButtonTapped_forUpdates___block_invoke_3;
    v9[3] = &unk_1E72EE258;
    v10 = v3;
    v11 = *(a1 + 48);
    objc_copyWeak(&v12, (a1 + 56));
    v9[4] = *(a1 + 40);
    [v7 _dismissBannerView:v8 completion:v9];

    objc_destroyWeak(&v12);
  }

  else
  {
    if (v3)
    {
      v3[2](v3);
    }

    (*(*(a1 + 48) + 16))();
  }
}

uint64_t __69__CKChatController_nicknameBannerView_actionButtonTapped_forUpdates___block_invoke_3(uint64_t a1)
{
  v2 = *(a1 + 40);
  if (v2)
  {
    (*(v2 + 16))();
  }

  (*(*(a1 + 48) + 16))();
  WeakRetained = objc_loadWeakRetained((a1 + 56));
  [WeakRetained setNicknameBanner:0];

  [*(a1 + 32) updateScrollGeometryWithoutAnimationForReason:@"BannerChangedSize"];
  v4 = *(a1 + 32);

  return [v4 updateFoundInSuggestionPresenter];
}

void __69__CKChatController_nicknameBannerView_actionButtonTapped_forUpdates___block_invoke_1575(uint64_t a1)
{
  v9 = [MEMORY[0x1E69A5C10] sharedInstance];
  v2 = [*(a1 + 32) conversation];
  v3 = [v2 chat];
  v4 = [v3 participants];
  v5 = [*(a1 + 32) conversation];
  v6 = [v5 chat];
  v7 = [*(a1 + 32) conversation];
  v8 = [v7 lastAddressedHandle];
  [v9 allowHandlesForNicknameSharing:v4 forChat:v6 fromHandle:v8 forceSend:0];
}

- (void)presentNicknameUpdatesViewControllerFromView:(id)view
{
  viewCopy = view;
  if (IMOSLoggingEnabled())
  {
    v5 = OSLogHandleForIMFoundationCategory();
    if (os_log_type_enabled(v5, OS_LOG_TYPE_INFO))
    {
      *v10 = 0;
      _os_log_impl(&dword_19020E000, v5, OS_LOG_TYPE_INFO, "Presenting updates controller!", v10, 2u);
    }
  }

  v6 = [(CKCoreChatController *)self _nicknameBannerUpdatesAndStyle:0];
  v7 = [CKNicknameUpdateListViewFactory listViewWithUpdates:v6 delegate:self];
  [(CKChatController *)self setNicknameUpdateController:v7];
  v8 = v7;
  if (CKIsRunningInMacCatalyst())
  {
    [v8 setModalPresentationStyle:7];
    popoverPresentationController = [v8 popoverPresentationController];
    [popoverPresentationController setSourceView:viewCopy];
  }

  [(CKChatController *)self presentViewController:v8 animated:1 completion:0];
}

- (void)nicknameBannerDidInteractWithOnboardingOffer
{
  mEMORY[0x1E69A8108] = [MEMORY[0x1E69A8108] sharedInstance];
  if (([mEMORY[0x1E69A8108] wasSharingEverEnabled] & 1) == 0 && (objc_msgSend(mEMORY[0x1E69A8108], "sharingEnabled") & 1) == 0)
  {
    if (IMOSLoggingEnabled())
    {
      v3 = OSLogHandleForIMFoundationCategory();
      if (os_log_type_enabled(v3, OS_LOG_TYPE_INFO))
      {
        *v4 = 0;
        _os_log_impl(&dword_19020E000, v3, OS_LOG_TYPE_INFO, "User interacted with outgoing share CTA. Disabling.", v4, 2u);
      }
    }

    [mEMORY[0x1E69A8108] setSharingEnabled:0];
  }
}

- (void)updateInterfaceSelectedAction:(unint64_t)action forUpdate:(id)update
{
  updateCopy = update;
  nicknameUpdateController = [(CKChatController *)self nicknameUpdateController];
  nicknameUpdateController2 = [(CKChatController *)self nicknameUpdateController];
  view = [nicknameUpdateController2 view];
  [(CKChatController *)self nicknameUpdatesViewController:nicknameUpdateController selectedAction:action forNicknameUpdate:updateCopy sourceView:view];
}

- (void)nicknameUpdatesViewController:(id)controller selectedAction:(unint64_t)action forNicknameUpdate:(id)update sourceView:(id)view
{
  controllerCopy = controller;
  updateCopy = update;
  viewCopy = view;
  if (action <= 2)
  {
    if (!action)
    {
      mEMORY[0x1E69A5C10] = [MEMORY[0x1E69A5C10] sharedInstance];
      handle = [updateCopy handle];
      [mEMORY[0x1E69A5C10] clearPendingNicknameUpdatesForHandle:handle forceClear:1];
LABEL_16:

      goto LABEL_17;
    }

    if (action == 1)
    {
      contact = [updateCopy contact];
      [(CKChatController *)self updateContact:contact withNicknameUpdate:updateCopy updateType:2 addHandleToContact:0 presentationMode:3];

      mEMORY[0x1E69A5C10] = [MEMORY[0x1E69A5C10] sharedInstance];
      handle = [updateCopy handle];
      v22 = [handle ID];
      [mEMORY[0x1E69A5C10] acceptPendingNicknameForHandleID:v22 updateType:2];
      goto LABEL_15;
    }

    if (action != 2)
    {
      goto LABEL_17;
    }

    contact2 = [updateCopy contact];
    [(CKChatController *)self updateContact:contact2 withNicknameUpdate:updateCopy updateType:4 addHandleToContact:0 presentationMode:3];

    mEMORY[0x1E69A5C10]2 = [MEMORY[0x1E69A5C10] sharedInstance];
    handle2 = [updateCopy handle];
    v15 = [handle2 ID];
    v16 = mEMORY[0x1E69A5C10]2;
    v17 = v15;
    v18 = 4;
LABEL_13:
    [v16 acceptPendingNicknameForHandleID:v17 updateType:v18];

    mEMORY[0x1E69A5C10] = [MEMORY[0x1E69A5C10] sharedInstance];
    handle = [updateCopy handle];
    v22 = [handle ID];
    [mEMORY[0x1E69A5C10] markTransitionAsObservedForHandleID:v22 isAutoUpdate:0];
LABEL_15:

    goto LABEL_16;
  }

  switch(action)
  {
    case 3uLL:
      contact3 = [updateCopy contact];
      [(CKChatController *)self updateContact:contact3 withNicknameUpdate:updateCopy updateType:6 addHandleToContact:0 presentationMode:3];

      mEMORY[0x1E69A5C10]2 = [MEMORY[0x1E69A5C10] sharedInstance];
      handle2 = [updateCopy handle];
      v15 = [handle2 ID];
      v16 = mEMORY[0x1E69A5C10]2;
      v17 = v15;
      v18 = 6;
      goto LABEL_13;
    case 4uLL:
      if (CKIsRunningInMacCatalyst())
      {
        [(CKChatController *)self showUnknownContactPopoverForNicknameUpdate:updateCopy presentingViewController:controllerCopy sourceView:viewCopy];
      }

      else
      {
        [(CKChatController *)self updateContact:0 withNicknameUpdate:updateCopy updateType:*MEMORY[0x1E69A77E8] addHandleToContact:1 presentationMode:1];
      }

      [(CKChatController *)self setCurrentNicknameUpdate:updateCopy];
      break;
    case 5uLL:
      if (CKIsRunningInMacCatalyst())
      {
        [(CKChatController *)self showUnknownContactPopoverForNicknameUpdate:updateCopy presentingViewController:controllerCopy sourceView:viewCopy];
      }

      else
      {
        [(CKChatController *)self setCurrentNicknameUpdate:updateCopy];
        [(CKChatController *)self selectContact];
      }

      break;
  }

LABEL_17:
}

- (BOOL)shouldShowBanners
{
  v21 = *MEMORY[0x1E69E9840];
  chat = [(CKCoreChatController *)self chat];
  v4 = chat;
  if (chat && ([chat allowedToShowConversation] & 1) == 0)
  {
    if (IMOSLoggingEnabled())
    {
      v11 = OSLogHandleForIMFoundationCategory();
      if (os_log_type_enabled(v11, OS_LOG_TYPE_INFO))
      {
        date = [MEMORY[0x1E695DF00] date];
        [date timeIntervalSince1970];
        v14 = v13;
        chat2 = [(CKCoreChatController *)self chat];
        v17 = 134218242;
        v18 = v14;
        v19 = 2112;
        v20 = chat2;
        _os_log_impl(&dword_19020E000, v11, OS_LOG_TYPE_INFO, "Bypassing checking checkSuggestionsForBanner due to downtime being on and chat containing nonallowlisted participants:   - %f %@", &v17, 0x16u);
      }
    }

    goto LABEL_12;
  }

  if ([v4 isStewieChat])
  {
    [(CKChatController *)self _presentTranscriptSharingBannerIfNecessary];
LABEL_12:
    v10 = 0;
    goto LABEL_13;
  }

  mEMORY[0x1E69A8070] = [MEMORY[0x1E69A8070] sharedFeatureFlags];
  isIntroductionsEnabled = [mEMORY[0x1E69A8070] isIntroductionsEnabled];

  if (isIntroductionsEnabled)
  {
    v7 = +[CKConversationList sharedConversationList];
    conversation = [(CKCoreChatController *)self conversation];
    v9 = [v7 primaryFilterModeForConversation:conversation];

    if (v9 == 9)
    {
      goto LABEL_12;
    }
  }

  v10 = 1;
LABEL_13:

  return v10;
}

- (void)_updateSuggestionsBanners
{
  v9 = *MEMORY[0x1E69E9840];
  if ([(CKChatController *)self _anyTranscriptBannerIsVisible]|| [(CKChatController *)self _wantsToShowCollaborationNotices])
  {
    if (IMOSLoggingEnabled())
    {
      v3 = OSLogHandleForIMFoundationCategory();
      if (os_log_type_enabled(v3, OS_LOG_TYPE_INFO))
      {
        LOWORD(v7) = 0;
        _os_log_impl(&dword_19020E000, v3, OS_LOG_TYPE_INFO, "Bypassing checkSuggestionsForBanner, another banner is already up", &v7, 2u);
      }
    }
  }

  else
  {
    if (IMOSLoggingEnabled())
    {
      v4 = OSLogHandleForIMFoundationCategory();
      if (os_log_type_enabled(v4, OS_LOG_TYPE_INFO))
      {
        date = [MEMORY[0x1E695DF00] date];
        [date timeIntervalSince1970];
        v7 = 134217984;
        v8 = v6;
        _os_log_impl(&dword_19020E000, v4, OS_LOG_TYPE_INFO, "Handling _updateSuggestionsBanners - %f ", &v7, 0xCu);
      }
    }

    [(CKChatController *)self updateFoundInSuggestionPresenter];
  }
}

- (void)checkSuggestionsForBanner
{
  v9 = *MEMORY[0x1E69E9840];
  if ([(CKChatController *)self shouldShowBanners])
  {
    if ([(CKChatController *)self _supportsCollaborationNotices]&& [(CKChatController *)self shouldFetchCollaborationNotices])
    {
      [(CKChatController *)self _fetchCollaborationNotices];

      [(CKChatController *)self setShouldFetchCollaborationNotices:0];
    }

    else if ([(CKChatController *)self _anyTranscriptBannerIsVisible]|| [(CKChatController *)self _wantsToShowCollaborationNotices])
    {
      if (IMOSLoggingEnabled())
      {
        v3 = OSLogHandleForIMFoundationCategory();
        if (os_log_type_enabled(v3, OS_LOG_TYPE_INFO))
        {
          LOWORD(v7) = 0;
          _os_log_impl(&dword_19020E000, v3, OS_LOG_TYPE_INFO, "Bypassing checkSuggestionsForBanner, another banner is already up", &v7, 2u);
        }
      }
    }

    else
    {
      if (IMOSLoggingEnabled())
      {
        v4 = OSLogHandleForIMFoundationCategory();
        if (os_log_type_enabled(v4, OS_LOG_TYPE_INFO))
        {
          date = [MEMORY[0x1E695DF00] date];
          [date timeIntervalSince1970];
          v7 = 134217984;
          v8 = v6;
          _os_log_impl(&dword_19020E000, v4, OS_LOG_TYPE_INFO, "Handling checkSuggestionsForBanner - %f ", &v7, 0xCu);
        }
      }

      [(CKChatController *)self _updateSuggestionsBanners];
    }
  }
}

- (void)_handleCollaborationNoticesChanged:(id)changed
{
  v19 = *MEMORY[0x1E69E9840];
  changedCopy = changed;
  v5 = MEMORY[0x1E695DFD8];
  object = [changedCopy object];
  v7 = [v5 setWithArray:object];

  v8 = MEMORY[0x1E695DFD8];
  mEMORY[0x1E69A5AF8] = [MEMORY[0x1E69A5AF8] sharedRegistry];
  conversation = [(CKCoreChatController *)self conversation];
  chat = [conversation chat];
  v12 = [mEMORY[0x1E69A5AF8] allGUIDsForChat:chat];
  v13 = [v8 setWithArray:v12];

  LODWORD(mEMORY[0x1E69A5AF8]) = [v7 intersectsSet:v13];
  v14 = IMOSLoggingEnabled();
  if (mEMORY[0x1E69A5AF8])
  {
    if (v14)
    {
      v15 = OSLogHandleForIMFoundationCategory();
      if (os_log_type_enabled(v15, OS_LOG_TYPE_INFO))
      {
        v17 = 138412290;
        v18 = v13;
        _os_log_impl(&dword_19020E000, v15, OS_LOG_TYPE_INFO, "Fetching CollaborationNotices in response to change notification for guids: %@.", &v17, 0xCu);
      }
    }

    [(CKChatController *)self setShouldFetchCollaborationNotices:1];
    [(CKChatController *)self checkSuggestionsForBanner];
  }

  else if (v14)
  {
    v16 = OSLogHandleForIMFoundationCategory();
    if (os_log_type_enabled(v16, OS_LOG_TYPE_INFO))
    {
      LOWORD(v17) = 0;
      _os_log_impl(&dword_19020E000, v16, OS_LOG_TYPE_INFO, "Ignoring CollaborationNotices change notification, not relevant to displayed chat.", &v17, 2u);
    }
  }
}

- (void)_handleTranslationSettingChanged:(id)changed
{
  object = [changed object];
  if (object)
  {
    v5 = object;
    [(CKChatController *)self reloadEntryViewIfNeeded];
    object = v5;
  }
}

- (void)_handleTranslationSupportChanged:(id)changed
{
  object = [changed object];
  if (object)
  {
    v5 = object;
    [(CKChatController *)self reloadEntryViewIfNeeded];
    object = v5;
  }
}

- (void)_handleContactStoreBatchLoadCompleteNotification:(id)notification
{
  notificationCopy = notification;
  if (IMOSLoggingEnabled())
  {
    v5 = OSLogHandleForIMFoundationCategory();
    if (os_log_type_enabled(v5, OS_LOG_TYPE_INFO))
    {
      *v6 = 0;
      _os_log_impl(&dword_19020E000, v5, OS_LOG_TYPE_INFO, "Fetching CollaborationNotices in response to contact store load completion", v6, 2u);
    }
  }

  [(CKChatController *)self setShouldFetchCollaborationNotices:1];
  [(CKChatController *)self checkSuggestionsForBanner];
}

- (void)_fetchCollaborationNotices
{
  OUTLINED_FUNCTION_1();
  OUTLINED_FUNCTION_0();
  _os_log_error_impl(v0, v1, v2, v3, v4, 2u);
}

void __46__CKChatController__fetchCollaborationNotices__block_invoke(uint64_t a1, void *a2)
{
  v3 = a2;
  v6[0] = MEMORY[0x1E69E9820];
  v6[1] = 3221225472;
  v6[2] = __46__CKChatController__fetchCollaborationNotices__block_invoke_2;
  v6[3] = &unk_1E72EB8D0;
  v4 = *(a1 + 32);
  v7 = v3;
  v8 = v4;
  v5 = v3;
  dispatch_async(MEMORY[0x1E69E96A0], v6);
}

uint64_t __46__CKChatController__fetchCollaborationNotices__block_invoke_2(uint64_t a1)
{
  v9 = *MEMORY[0x1E69E9840];
  if (IMOSLoggingEnabled())
  {
    v2 = OSLogHandleForIMFoundationCategory();
    if (os_log_type_enabled(v2, OS_LOG_TYPE_INFO))
    {
      v3 = *(a1 + 32);
      v7 = 138412290;
      v8 = v3;
      _os_log_impl(&dword_19020E000, v2, OS_LOG_TYPE_INFO, "Received CollaborationNotices: %@", &v7, 0xCu);
    }
  }

  v5 = *(a1 + 40);
  v4 = (a1 + 40);
  [v5 _processCollaborationNoticesForBanner:*(v4 - 1)];
  return [*v4 _updateSuggestionsBanners];
}

- (void)_processCollaborationNoticesForBanner:(id)banner
{
  v20 = *MEMORY[0x1E69E9840];
  bannerCopy = banner;
  array = [MEMORY[0x1E695DF70] array];
  v15 = 0u;
  v16 = 0u;
  v17 = 0u;
  v18 = 0u;
  v6 = bannerCopy;
  v7 = [v6 countByEnumeratingWithState:&v15 objects:v19 count:16];
  if (v7)
  {
    v8 = v7;
    v9 = *v16;
    while (2)
    {
      for (i = 0; i != v8; ++i)
      {
        if (*v16 != v9)
        {
          objc_enumerationMutation(v6);
        }

        v11 = *(*(&v15 + 1) + 8 * i);
        if ([(CKChatController *)self _noticeIsExpired:v11, v15])
        {
          mEMORY[0x1E69A5B28] = [MEMORY[0x1E69A5B28] sharedInstance];
          [mEMORY[0x1E69A5B28] dismissNotice:v11];

          goto LABEL_11;
        }

        objc_opt_class();
        v12 = [CKCollaborationNoticeSuggestion suggestionWithNotice:v11 delegate:self wantsInlineReplyStyle:objc_opt_isKindOfClass() & 1];
        [array addObject:v12];
      }

      v8 = [v6 countByEnumeratingWithState:&v15 objects:v19 count:16];
      if (v8)
      {
        continue;
      }

      break;
    }
  }

  v13 = [array copy];
  [(CKChatController *)self setCollaborationNoticeSuggestions:v13];

  [(CKChatController *)self _showOrHideNicknameBannerIfNeeded];
LABEL_11:
}

- (void)setCollaborationNoticeSuggestions:(id)suggestions
{
  v27 = *MEMORY[0x1E69E9840];
  suggestionsCopy = suggestions;
  objc_storeStrong(&self->_collaborationNoticeSuggestions, suggestions);
  if (IMOSLoggingEnabled())
  {
    v6 = OSLogHandleForIMFoundationCategory();
    if (os_log_type_enabled(v6, OS_LOG_TYPE_INFO))
    {
      v7 = [suggestionsCopy count];
      standardSuggestionPresenter = [(CKChatController *)self standardSuggestionPresenter];
      *buf = 134218242;
      v24 = v7;
      v25 = 2112;
      v26 = standardSuggestionPresenter;
      _os_log_impl(&dword_19020E000, v6, OS_LOG_TYPE_INFO, "setCollaborationNoticeSuggestions invoked with %lu suggestions. standardSuggestionPresenter %@", buf, 0x16u);
    }
  }

  standardSuggestionPresenter2 = [(CKChatController *)self standardSuggestionPresenter];
  [standardSuggestionPresenter2 setSuggestions:suggestionsCopy];

  v20 = 0u;
  v21 = 0u;
  v18 = 0u;
  v19 = 0u;
  v10 = suggestionsCopy;
  v11 = [v10 countByEnumeratingWithState:&v18 objects:v22 count:16];
  if (v11)
  {
    v12 = *v19;
    do
    {
      v13 = 0;
      do
      {
        if (*v19 != v12)
        {
          objc_enumerationMutation(v10);
        }

        notice = [*(*(&v18 + 1) + 8 * v13) notice];
        dateViewed = [notice dateViewed];
        v16 = dateViewed == 0;

        if (v16)
        {
          mEMORY[0x1E69A5B28] = [MEMORY[0x1E69A5B28] sharedInstance];
          [mEMORY[0x1E69A5B28] markAsViewedForNotice:notice];
        }

        ++v13;
      }

      while (v11 != v13);
      v11 = [v10 countByEnumeratingWithState:&v18 objects:v22 count:16];
    }

    while (v11);
  }
}

- (BOOL)_noticeIsExpired:(id)expired
{
  expiredCopy = expired;
  date = [expiredCopy date];
  [date timeIntervalSinceNow];
  v6 = v5;

  dateViewed = [expiredCopy dateViewed];
  if (dateViewed)
  {
    dateViewed2 = [expiredCopy dateViewed];
    [dateViewed2 timeIntervalSinceNow];
    v10 = -v9;
  }

  else
  {
    v10 = 0.0;
  }

  v11 = IMGetCachedDomainIntForKeyWithDefaultValue();
  v12 = v10 >= IMGetCachedDomainIntForKeyWithDefaultValue() || -v6 >= v11;

  return v12;
}

- (void)dismissCollaborationNoticeBannersIfNecessary
{
  v26 = *MEMORY[0x1E69E9840];
  standardSuggestionPresenter = [(CKChatController *)self standardSuggestionPresenter];
  banner = [standardSuggestionPresenter banner];
  suggestionBannerView = [(CKChatController *)self suggestionBannerView];
  v5 = suggestionBannerView;
  if (banner == suggestionBannerView)
  {
    suggestionBannerView2 = [(CKChatController *)self suggestionBannerView];
    window = [suggestionBannerView2 window];

    if (!window)
    {
      return;
    }

    standardSuggestionPresenter2 = [(CKChatController *)self standardSuggestionPresenter];
    suggestions = [standardSuggestionPresenter2 suggestions];

    v23 = 0u;
    v24 = 0u;
    v21 = 0u;
    v22 = 0u;
    v10 = suggestions;
    v11 = [v10 countByEnumeratingWithState:&v21 objects:v25 count:16];
    if (!v11)
    {
      goto LABEL_19;
    }

    v12 = v11;
    v13 = *v22;
    while (1)
    {
      for (i = 0; i != v12; ++i)
      {
        if (*v22 != v13)
        {
          objc_enumerationMutation(v10);
        }

        v15 = *(*(&v21 + 1) + 8 * i);
        objc_opt_class();
        if (objc_opt_isKindOfClass())
        {
          v16 = v15;
          notice = [v16 notice];
          if ([notice wantsEphemeralDismissal])
          {

            goto LABEL_15;
          }

          notice2 = [v16 notice];
          v19 = [(CKChatController *)self _noticeIsExpired:notice2];

          if (v19)
          {
LABEL_15:
            [(CKChatController *)self dismissCollaborationNoticeSuggestion:v16];
          }

          continue;
        }
      }

      v12 = [v10 countByEnumeratingWithState:&v21 objects:v25 count:16];
      if (!v12)
      {
LABEL_19:

        return;
      }
    }
  }
}

- (void)dismissCollaborationNoticeSuggestion:(id)suggestion
{
  suggestionCopy = suggestion;
  standardSuggestionPresenter = [(CKChatController *)self standardSuggestionPresenter];
  [standardSuggestionPresenter removeSuggestion:suggestionCopy];

  mEMORY[0x1E69A5B28] = [MEMORY[0x1E69A5B28] sharedInstance];
  notice = [suggestionCopy notice];

  [mEMORY[0x1E69A5B28] dismissNotice:notice];
}

- (id)_newCollaborationPayloadFromPayload:(id)payload shareURL:(id)l updatedMetadata:(id)metadata
{
  metadataCopy = metadata;
  payloadCopy = payload;
  v8 = [CKBrowserItemPayload browserItemPayloadFromIMPluginPayload:payloadCopy];
  v9 = StringGUID();
  [v8 setMessageGUID:v9];

  v10 = StringGUID();
  [v8 setPluginSessionGUID:v10];

  [v8 setAttachments:0];
  [v8 setPayloadCollaborationType:{objc_msgSend(payloadCopy, "payloadCollaborationType")}];
  [v8 setCollaborationMetadata:metadataCopy];

  cloudKitShare = [payloadCopy cloudKitShare];

  [v8 setCloudKitShare:cloudKitShare];
  return v8;
}

- (void)addToCollaboration:(id)collaboration
{
  v47 = *MEMORY[0x1E69E9840];
  collaborationCopy = collaboration;
  notice = [collaborationCopy notice];
  senderHandle = [notice senderHandle];

  notice2 = [collaborationCopy notice];
  metadata = [notice2 metadata];
  contentURL = [metadata contentURL];

  notice3 = [collaborationCopy notice];
  metadata2 = [notice3 metadata];
  messageGUID = [metadata2 messageGUID];

  if (IMOSLoggingEnabled())
  {
    v11 = OSLogHandleForIMFoundationCategory();
    if (os_log_type_enabled(v11, OS_LOG_TYPE_INFO))
    {
      *buf = 138412802;
      v42 = senderHandle;
      v43 = 2112;
      v44 = contentURL;
      v45 = 2112;
      v46 = messageGUID;
      _os_log_impl(&dword_19020E000, v11, OS_LOG_TYPE_INFO, "Adding handle: %@ to share URL: %@ with messageGUID: %@", buf, 0x20u);
    }
  }

  mEMORY[0x1E69A5AD0] = [MEMORY[0x1E69A5AD0] sharedInstance];
  v30 = [mEMORY[0x1E69A5AD0] existingDataSourceForMessageGUID:messageGUID bundleID:*MEMORY[0x1E69A6A18]];

  pluginPayload = [v30 pluginPayload];
  v14 = MEMORY[0x1E696ECD8];
  data = [pluginPayload data];
  v16 = [v14 linkWithDataRepresentationWithoutSubstitutingAttachments:data];

  metadata3 = [v16 metadata];
  collaborationMetadata = [metadata3 collaborationMetadata];
  containerSetupInfo = [collaborationMetadata containerSetupInfo];

  containerOptions = [containerSetupInfo containerOptions];
  [containerOptions setAccountOverrideInfo:0];

  containerOptions2 = [containerSetupInfo containerOptions];
  [containerOptions2 setPersonaIdentifier:0];

  if (IMOSLoggingEnabled())
  {
    v22 = OSLogHandleForIMFoundationCategory();
    if (os_log_type_enabled(v22, OS_LOG_TYPE_INFO))
    {
      *buf = 138412546;
      v42 = pluginPayload;
      v43 = 2112;
      v44 = containerSetupInfo;
      _os_log_impl(&dword_19020E000, v22, OS_LOG_TYPE_INFO, "Adding - PluginPayload: %@, Container Setup Info: %@", buf, 0x16u);
    }
  }

  objc_initWeak(buf, self);
  chat = [(CKCoreChatController *)self chat];
  guid = [chat guid];
  v35[0] = MEMORY[0x1E69E9820];
  v35[1] = 3221225472;
  v35[2] = __39__CKChatController_addToCollaboration___block_invoke;
  v35[3] = &unk_1E72EE320;
  v25 = metadata3;
  v36 = v25;
  objc_copyWeak(&v40, buf);
  v26 = pluginPayload;
  v37 = v26;
  v27 = contentURL;
  v38 = v27;
  v28 = collaborationCopy;
  v39 = v28;
  [(CKChatController *)self addParticipant:senderHandle toCollaboration:v27 forChatGUID:guid containerSetupInfo:containerSetupInfo completionHandler:v35];

  block[0] = MEMORY[0x1E69E9820];
  block[1] = 3221225472;
  block[2] = __39__CKChatController_addToCollaboration___block_invoke_2_1583;
  block[3] = &unk_1E72EB8D0;
  block[4] = self;
  v34 = v28;
  v29 = v28;
  dispatch_async(MEMORY[0x1E69E96A0], block);

  objc_destroyWeak(&v40);
  objc_destroyWeak(buf);
}

void __39__CKChatController_addToCollaboration___block_invoke(uint64_t a1, int a2, void *a3)
{
  v5 = a3;
  v6 = v5;
  if (a2)
  {
    if (v5)
    {
      v7 = v5;
    }

    else
    {
      v7 = [*(a1 + 32) collaborationMetadata];
    }

    v8 = v7;
    WeakRetained = objc_loadWeakRetained((a1 + 64));
    v10 = [WeakRetained _newCollaborationPayloadFromPayload:*(a1 + 40) shareURL:*(a1 + 48) updatedMetadata:v8];

    v16[0] = MEMORY[0x1E69E9820];
    v16[1] = 3221225472;
    v16[2] = __39__CKChatController_addToCollaboration___block_invoke_2;
    v16[3] = &unk_1E72EE2F8;
    v17 = *(a1 + 48);
    objc_copyWeak(&v20, (a1 + 64));
    v11 = v10;
    v18 = v11;
    v12 = v8;
    v19 = v12;
    [CKComposition compositionWithShelfPluginPayload:v11 completionHandler:v16];

    objc_destroyWeak(&v20);
  }

  else
  {
    v13[0] = MEMORY[0x1E69E9820];
    v13[1] = 3221225472;
    v13[2] = __39__CKChatController_addToCollaboration___block_invoke_1581;
    v13[3] = &unk_1E72EBB98;
    objc_copyWeak(&v15, (a1 + 64));
    v14 = *(a1 + 56);
    dispatch_async(MEMORY[0x1E69E96A0], v13);

    objc_destroyWeak(&v15);
  }
}

void __39__CKChatController_addToCollaboration___block_invoke_2(id *a1, void *a2)
{
  v3 = a2;
  block[0] = MEMORY[0x1E69E9820];
  block[1] = 3221225472;
  block[2] = __39__CKChatController_addToCollaboration___block_invoke_3;
  block[3] = &unk_1E72EE2D0;
  v6 = a1[4];
  objc_copyWeak(&v10, a1 + 7);
  v7 = a1[5];
  v8 = a1[6];
  v9 = v3;
  v4 = v3;
  dispatch_async(MEMORY[0x1E69E96A0], block);

  objc_destroyWeak(&v10);
}

void __39__CKChatController_addToCollaboration___block_invoke_3(uint64_t a1)
{
  v17 = *MEMORY[0x1E69E9840];
  if (IMOSLoggingEnabled())
  {
    v2 = OSLogHandleForIMFoundationCategory();
    if (os_log_type_enabled(v2, OS_LOG_TYPE_INFO))
    {
      v3 = *(a1 + 32);
      v15 = 138412290;
      v16 = v3;
      _os_log_impl(&dword_19020E000, v2, OS_LOG_TYPE_INFO, "Sending the final composition for sharingURL: %@", &v15, 0xCu);
    }
  }

  WeakRetained = objc_loadWeakRetained((a1 + 64));
  v5 = *(a1 + 40);
  v6 = [v5 messageGUID];
  v7 = [WeakRetained updateDataSourceForPluginPayload:v5 forGUID:v6 withCollaborationMetadata:*(a1 + 48) shareURL:*(a1 + 32)];

  v8 = [v7 datasource];
  [v8 setPayloadInShelf:1];

  v9 = [v7 datasource];
  [v9 payloadWillEnterShelf];

  v10 = [CKComposition alloc];
  v11 = [*(a1 + 56) text];
  v12 = [*(a1 + 56) subject];
  v13 = [(CKComposition *)v10 initWithText:v11 subject:v12 shelfPluginPayload:v7];

  v14 = objc_loadWeakRetained((a1 + 64));
  [v14 sendCompositionIfAllowed:v13];
}

void __39__CKChatController_addToCollaboration___block_invoke_1581(uint64_t a1)
{
  WeakRetained = objc_loadWeakRetained((a1 + 40));
  [WeakRetained createCollaborationFailureAlertForNotice:*(a1 + 32)];
}

void __39__CKChatController_addToCollaboration___block_invoke_2_1583(uint64_t a1)
{
  v2 = [*(a1 + 32) standardSuggestionPresenter];
  [v2 removeSuggestion:*(a1 + 40)];
}

- (void)removeFromCollaboration:(id)collaboration
{
  v41 = *MEMORY[0x1E69E9840];
  collaborationCopy = collaboration;
  notice = [collaborationCopy notice];
  senderHandle = [notice senderHandle];

  notice2 = [collaborationCopy notice];
  metadata = [notice2 metadata];
  contentURL = [metadata contentURL];

  notice3 = [collaborationCopy notice];
  metadata2 = [notice3 metadata];
  messageGUID = [metadata2 messageGUID];

  if (IMOSLoggingEnabled())
  {
    v10 = OSLogHandleForIMFoundationCategory();
    if (os_log_type_enabled(v10, OS_LOG_TYPE_INFO))
    {
      *buf = 138412802;
      v36 = senderHandle;
      v37 = 2112;
      v38 = contentURL;
      v39 = 2112;
      v40 = messageGUID;
      _os_log_impl(&dword_19020E000, v10, OS_LOG_TYPE_INFO, "Removing handle: %@ from share URL: %@ with messageGUID: %@", buf, 0x20u);
    }
  }

  mEMORY[0x1E69A5AD0] = [MEMORY[0x1E69A5AD0] sharedInstance];
  v12 = [mEMORY[0x1E69A5AD0] existingDataSourceForMessageGUID:messageGUID bundleID:*MEMORY[0x1E69A6A18]];

  pluginPayload = [v12 pluginPayload];
  v14 = MEMORY[0x1E696ECD8];
  data = [pluginPayload data];
  v16 = [v14 linkWithDataRepresentationWithoutSubstitutingAttachments:data];

  metadata3 = [v16 metadata];
  collaborationMetadata = [metadata3 collaborationMetadata];
  containerSetupInfo = [collaborationMetadata containerSetupInfo];

  containerOptions = [containerSetupInfo containerOptions];
  [containerOptions setAccountOverrideInfo:0];

  containerOptions2 = [containerSetupInfo containerOptions];
  [containerOptions2 setPersonaIdentifier:0];

  if (IMOSLoggingEnabled())
  {
    v22 = OSLogHandleForIMFoundationCategory();
    if (os_log_type_enabled(v22, OS_LOG_TYPE_INFO))
    {
      *buf = 138412546;
      v36 = pluginPayload;
      v37 = 2112;
      v38 = containerSetupInfo;
      _os_log_impl(&dword_19020E000, v22, OS_LOG_TYPE_INFO, "Removing - PluginPayload: %@, Container Setup Info: %@", buf, 0x16u);
    }
  }

  objc_initWeak(buf, self);
  chat = [(CKCoreChatController *)self chat];
  guid = [chat guid];
  v32[0] = MEMORY[0x1E69E9820];
  v32[1] = 3221225472;
  v32[2] = __44__CKChatController_removeFromCollaboration___block_invoke;
  v32[3] = &unk_1E72EE348;
  objc_copyWeak(&v34, buf);
  v25 = collaborationCopy;
  v33 = v25;
  [(CKChatController *)self removeParticipant:senderHandle fromCollaboration:contentURL forChatGUID:guid containerSetupInfo:containerSetupInfo completionHandler:v32];

  block[0] = MEMORY[0x1E69E9820];
  block[1] = 3221225472;
  block[2] = __44__CKChatController_removeFromCollaboration___block_invoke_3;
  block[3] = &unk_1E72EB8D0;
  block[4] = self;
  v31 = v25;
  v26 = v25;
  dispatch_async(MEMORY[0x1E69E96A0], block);

  objc_destroyWeak(&v34);
  objc_destroyWeak(buf);
}

void __44__CKChatController_removeFromCollaboration___block_invoke(uint64_t a1, char a2)
{
  if ((a2 & 1) == 0)
  {
    v3[0] = MEMORY[0x1E69E9820];
    v3[1] = 3221225472;
    v3[2] = __44__CKChatController_removeFromCollaboration___block_invoke_2;
    v3[3] = &unk_1E72EBB98;
    objc_copyWeak(&v5, (a1 + 40));
    v4 = *(a1 + 32);
    dispatch_async(MEMORY[0x1E69E96A0], v3);

    objc_destroyWeak(&v5);
  }
}

void __44__CKChatController_removeFromCollaboration___block_invoke_2(uint64_t a1)
{
  WeakRetained = objc_loadWeakRetained((a1 + 40));
  [WeakRetained createCollaborationFailureAlertForNotice:*(a1 + 32)];
}

void __44__CKChatController_removeFromCollaboration___block_invoke_3(uint64_t a1)
{
  v2 = [*(a1 + 32) standardSuggestionPresenter];
  [v2 removeSuggestion:*(a1 + 40)];
}

- (void)collaborationNoticeSuggestionWillDismiss:(id)dismiss
{
  dismissCopy = dismiss;
  v6[0] = MEMORY[0x1E69E9820];
  v6[1] = 3221225472;
  v6[2] = __61__CKChatController_collaborationNoticeSuggestionWillDismiss___block_invoke;
  v6[3] = &unk_1E72EB8D0;
  v6[4] = self;
  v7 = dismissCopy;
  v5 = dismissCopy;
  dispatch_async(MEMORY[0x1E69E96A0], v6);
}

- (void)_satelliteStateChangedNotification:(id)notification
{
  notificationCopy = notification;
  mEMORY[0x1E69A8070] = [MEMORY[0x1E69A8070] sharedFeatureFlags];
  stewieEnabled = [mEMORY[0x1E69A8070] stewieEnabled];

  if (stewieEnabled)
  {
    v12.receiver = self;
    v12.super_class = CKChatController;
    [(CKCoreChatController *)&v12 _satelliteStateChangedNotification:notificationCopy];
    if (IMOSLoggingEnabled())
    {
      v7 = OSLogHandleForIMFoundationCategory();
      if (os_log_type_enabled(v7, OS_LOG_TYPE_INFO))
      {
        *v11 = 0;
        _os_log_impl(&dword_19020E000, v7, OS_LOG_TYPE_INFO, "Satellite state changed, determining whether to show or hide entry view and updating chat items.", v11, 2u);
      }
    }

    [(CKChatController *)self addOrRemoveEntryViewIfNeeded];
    chat = [(CKCoreChatController *)self chat];
    [chat _reloadChatItemsForSatelliteStateChangeIfRequired:@"Satellite status changed"];

    conversation = [(CKCoreChatController *)self conversation];
    isStewieConversation = [conversation isStewieConversation];

    if (isStewieConversation)
    {
      [(CKChatController *)self checkSuggestionsForBanner];
    }
  }
}

- (void)_presentTranscriptSharingBannerIfNecessary
{
  mEMORY[0x1E69A5B00] = [MEMORY[0x1E69A5B00] sharedInstance];
  isStewieEmergencyActive = [mEMORY[0x1E69A5B00] isStewieEmergencyActive];

  if (isStewieEmergencyActive)
  {
    chat = [(CKCoreChatController *)self chat];
    transcriptSharingState = [chat transcriptSharingState];

    if (!transcriptSharingState)
    {
      return;
    }

    standardSuggestionPresenter = [(CKChatController *)self standardSuggestionPresenter];
    suggestions = [standardSuggestionPresenter suggestions];
    v9 = [suggestions count];

    if (v9)
    {
      return;
    }

    v10 = [CKTranscriptSharingSuggestion bannerWithState:transcriptSharingState];
    [(CKChatController *)self setTranscriptSharingBannerSuggestion:v10];

    transcriptSharingBannerSuggestion = [(CKChatController *)self transcriptSharingBannerSuggestion];
    [transcriptSharingBannerSuggestion setDelegate:self];

    standardSuggestionPresenter2 = [(CKChatController *)self standardSuggestionPresenter];
    transcriptSharingBannerSuggestion2 = [(CKChatController *)self transcriptSharingBannerSuggestion];
    [standardSuggestionPresenter2 addSuggestion:transcriptSharingBannerSuggestion2];
  }

  else
  {
    standardSuggestionPresenter3 = [(CKChatController *)self standardSuggestionPresenter];
    suggestions2 = [standardSuggestionPresenter3 suggestions];
    v15 = [suggestions2 count];

    if (!v15)
    {
      return;
    }

    standardSuggestionPresenter2 = [(CKChatController *)self standardSuggestionPresenter];
    transcriptSharingBannerSuggestion2 = [(CKChatController *)self transcriptSharingBannerSuggestion];
    [standardSuggestionPresenter2 removeSuggestion:transcriptSharingBannerSuggestion2];
  }
}

- (void)transcriptSharingBannerWillDismiss:(id)dismiss
{
  dismissCopy = dismiss;
  chat = [(CKCoreChatController *)self chat];
  [chat updateTranscriptSharingState:0];

  v7[0] = MEMORY[0x1E69E9820];
  v7[1] = 3221225472;
  v7[2] = __55__CKChatController_transcriptSharingBannerWillDismiss___block_invoke;
  v7[3] = &unk_1E72EB8D0;
  v7[4] = self;
  v8 = dismissCopy;
  v6 = dismissCopy;
  dispatch_async(MEMORY[0x1E69E96A0], v7);
}

void __55__CKChatController_transcriptSharingBannerWillDismiss___block_invoke(uint64_t a1)
{
  v2 = [*(a1 + 32) standardSuggestionPresenter];
  [v2 removeSuggestion:*(a1 + 40)];
}

- (void)transcriptStopSharingButtonTapped:(id)tapped
{
  tappedCopy = tapped;
  v5 = CKFrameworkBundle();
  v6 = [v5 localizedStringForKey:@"TS_ALERT_TITLE_STOP_SHARING" value:&stru_1F04268F8 table:@"TranscriptSharing-SYDROB_FEATURES"];
  v7 = [CKAlertController alertControllerWithTitle:v6 message:0 preferredStyle:1];

  v8 = CKFrameworkBundle();
  v9 = [v8 localizedStringForKey:@"TS_STOP_SHARING_ACTION_ALERT" value:&stru_1F04268F8 table:@"TranscriptSharing-SYDROB_FEATURES"];
  v15 = MEMORY[0x1E69E9820];
  v16 = 3221225472;
  v17 = __54__CKChatController_transcriptStopSharingButtonTapped___block_invoke;
  v18 = &unk_1E72EC710;
  selfCopy = self;
  v20 = tappedCopy;
  v10 = tappedCopy;
  v11 = [CKAlertAction actionWithTitle:v9 style:2 handler:&v15];

  [v7 addAction:{v11, v15, v16, v17, v18, selfCopy}];
  v12 = CKFrameworkBundle();
  v13 = [v12 localizedStringForKey:@"CANCEL" value:&stru_1F04268F8 table:@"ChatKit"];
  v14 = [CKAlertAction actionWithTitle:v13 style:1 handler:0];

  [v7 addAction:v14];
  [v7 presentFromViewController:self animated:1 completion:0];
}

void __54__CKChatController_transcriptStopSharingButtonTapped___block_invoke(uint64_t a1)
{
  v2 = [*(a1 + 32) chat];
  [v2 updateTranscriptSharingState:3];

  v3 = [*(a1 + 32) standardSuggestionPresenter];
  [v3 removeSuggestion:*(a1 + 40)];

  v6 = [CKTranscriptSharingSuggestion bannerWithState:3];
  [v6 setDelegate:*(a1 + 32)];
  v4 = [*(a1 + 32) standardSuggestionPresenter];
  [v4 addSuggestion:v6];

  v5 = [*(a1 + 32) chat];
  [v5 stopTranscriptSharingWithChat];
}

- (void)updateFoundInSuggestionPresenter
{
  v67 = *MEMORY[0x1E69E9840];
  array = [MEMORY[0x1E695DF70] array];
  v57 = 0u;
  v58 = 0u;
  v55 = 0u;
  v56 = 0u;
  chat = [(CKCoreChatController *)self chat];
  chatItems = [chat chatItems];
  obj = [chatItems reverseObjectEnumerator];

  v54 = [obj countByEnumeratingWithState:&v55 objects:v66 count:16];
  if (v54)
  {
    v53 = *v56;
    v50 = *MEMORY[0x1E695C2B0];
    v5 = 20;
    *&v4 = 138412546;
    v48 = v4;
    do
    {
      for (i = 0; i != v54; ++i)
      {
        if (*v56 != v53)
        {
          objc_enumerationMutation(obj);
        }

        v7 = *(*(&v55 + 1) + 8 * i);
        objc_opt_class();
        if ((objc_opt_isKindOfClass() & (v5 > 0)) == 1)
        {
          v8 = v7;
          message = [v8 message];
          guid = [message guid];

          if (guid)
          {
            v11 = objc_alloc_init(MEMORY[0x1E6964E90]);
            message2 = [v8 message];
            sender = [message2 sender];
            hasName = [sender hasName];

            if (hasName)
            {
              message3 = [v8 message];
              sender2 = [message3 sender];
              name = [sender2 name];
            }

            else
            {
              name = 0;
            }

            v18 = objc_alloc_init(MEMORY[0x1E695DF70]);
            message4 = [v8 message];
            sender3 = [message4 sender];
            v21 = [sender3 ID];

            if (v21)
            {
              message5 = [v8 message];
              sender4 = [message5 sender];
              v24 = [sender4 ID];
              [v18 addObject:v24];
            }

            else if (IMOSLoggingEnabled())
            {
              v25 = OSLogHandleForIMFoundationCategory();
              if (os_log_type_enabled(v25, OS_LOG_TYPE_INFO))
              {
                message6 = [v8 message];
                *buf = v48;
                v60 = v8;
                v61 = 2112;
                v62 = message6;
                _os_log_impl(&dword_19020E000, v25, OS_LOG_TYPE_INFO, "sending id is nil. partChatItem: %@ =, message: %@", buf, 0x16u);
              }
            }

            v27 = [objc_alloc(MEMORY[0x1E6964E50]) initWithDisplayName:name handles:v18 handleIdentifier:v50];
            v65 = v27;
            v28 = [MEMORY[0x1E695DEC8] arrayWithObjects:&v65 count:1];
            [v11 setAuthors:v28];

            if ([v8 isFromMe])
            {
              [v11 setAccountHandles:v18];
            }

            message7 = [v8 message];
            time = [message7 time];

            if (time)
            {
              message8 = [v8 message];
              time2 = [message8 time];
              [v11 setContentCreationDate:time2];
            }

            v33 = [MEMORY[0x1E696AD98] numberWithInteger:{objc_msgSend(v8, "index")}];
            partIndexKey = [MEMORY[0x1E69A7FF8] partIndexKey];
            [v11 setValue:v33 forCustomKey:partIndexKey];

            objc_opt_class();
            if (objc_opt_isKindOfClass())
            {
              text = [v8 text];
              string = [text string];
              v37 = [string copy];
              [v11 setTextContent:v37];
            }

            v38 = objc_alloc(MEMORY[0x1E6964E80]);
            chat2 = [(CKCoreChatController *)self chat];
            guid2 = [chat2 guid];
            v41 = [v38 initWithUniqueIdentifier:guid domainIdentifier:guid2 attributeSet:v11];

            if (v41)
            {
              mainBundle = [MEMORY[0x1E696AAE8] mainBundle];
              bundleIdentifier = [mainBundle bundleIdentifier];
              [v41 setBundleID:bundleIdentifier];

              [array addObject:v41];
            }
          }

          --v5;
        }

        else if (v5 < 1)
        {
          goto LABEL_33;
        }
      }

      v54 = [obj countByEnumeratingWithState:&v55 objects:v66 count:16];
    }

    while (v54);
  }

  else
  {
    v5 = 20;
  }

LABEL_33:

  if (IMOSLoggingEnabled())
  {
    v44 = OSLogHandleForIMFoundationCategory();
    if (os_log_type_enabled(v44, OS_LOG_TYPE_INFO))
    {
      v45 = [array count];
      foundInSuggestionPresenter = [(CKChatController *)self foundInSuggestionPresenter];
      *buf = 134218498;
      v60 = (20 - v5);
      v61 = 2048;
      v62 = v45;
      v63 = 2112;
      v64 = foundInSuggestionPresenter;
      _os_log_impl(&dword_19020E000, v44, OS_LOG_TYPE_INFO, "checkCSSearchableItemSuggestionsForBanner for %lu sliced searchables from %lu. foundInSuggestionPresenter %@", buf, 0x20u);
    }
  }

  foundInSuggestionPresenter2 = [(CKChatController *)self foundInSuggestionPresenter];
  [foundInSuggestionPresenter2 addSuggestionsFromSearchableItems:array options:0 filter:&__block_literal_global_1607];
}

id __52__CKChatController_updateFoundInSuggestionPresenter__block_invoke(uint64_t a1, void *a2)
{
  v21 = *MEMORY[0x1E69E9840];
  v2 = a2;
  v14 = objc_opt_new();
  v16 = 0u;
  v17 = 0u;
  v18 = 0u;
  v19 = 0u;
  v3 = v2;
  v4 = [v3 countByEnumeratingWithState:&v16 objects:v20 count:16];
  if (v4)
  {
    v5 = *v17;
    do
    {
      for (i = 0; i != v4; ++i)
      {
        if (*v17 != v5)
        {
          objc_enumerationMutation(v3);
        }

        v7 = *(*(&v16 + 1) + 8 * i);
        MEMORY[0x193AF5EC0](@"SGRealtimeEvent", @"CoreSuggestions");
        objc_opt_class();
        if (objc_opt_isKindOfClass())
        {
          v8 = v7;
          if ([v8 state] == 4 || objc_msgSend(v8, "state") == 5)
          {
            if (IMOSLoggingEnabled())
            {
              v9 = OSLogHandleForIMFoundationCategory();
              if (os_log_type_enabled(v9, OS_LOG_TYPE_INFO))
              {
                *buf = 0;
                _os_log_impl(&dword_19020E000, v9, OS_LOG_TYPE_INFO, "Filtered out Duplicate event", buf, 2u);
              }

              goto LABEL_12;
            }

            goto LABEL_20;
          }

          v11 = [v8 event];
          v12 = [v11 isNaturalLanguageEvent];

          if (v12)
          {
            if (IMOSLoggingEnabled())
            {
              v9 = OSLogHandleForIMFoundationCategory();
              if (os_log_type_enabled(v9, OS_LOG_TYPE_INFO))
              {
                *buf = 0;
                _os_log_impl(&dword_19020E000, v9, OS_LOG_TYPE_INFO, "Filtered out Natural Language event", buf, 2u);
              }

LABEL_12:
            }

LABEL_20:

            continue;
          }

          goto LABEL_26;
        }

        objc_opt_class();
        if (objc_opt_isKindOfClass())
        {
          v8 = v7;
          if ([v8 updatedFields])
          {
            if (IMOSLoggingEnabled())
            {
              v10 = OSLogHandleForIMFoundationCategory();
              if (os_log_type_enabled(v10, OS_LOG_TYPE_INFO))
              {
                *buf = 0;
                _os_log_impl(&dword_19020E000, v10, OS_LOG_TYPE_INFO, "Filtered out Suggestions realtime contact", buf, 2u);
              }
            }

            goto LABEL_20;
          }

LABEL_26:
        }

        [v14 addObject:v7];
      }

      v4 = [v3 countByEnumeratingWithState:&v16 objects:v20 count:16];
    }

    while (v4);
  }

  return v14;
}

- (CKOnboardingController)onboardingController
{
  onboardingController = self->_onboardingController;
  if (!onboardingController)
  {
    if (IMOSLoggingEnabled())
    {
      v4 = OSLogHandleForIMFoundationCategory();
      if (os_log_type_enabled(v4, OS_LOG_TYPE_INFO))
      {
        *v8 = 0;
        _os_log_impl(&dword_19020E000, v4, OS_LOG_TYPE_INFO, "Creating onboarding in CKChatController", v8, 2u);
      }
    }

    v5 = objc_alloc_init(CKOnboardingController);
    v6 = self->_onboardingController;
    self->_onboardingController = v5;

    [(CKOnboardingController *)self->_onboardingController setDelegate:self];
    onboardingController = self->_onboardingController;
  }

  return onboardingController;
}

- (id)presentingViewControllerForOnboardingController:(id)controller
{
  v11 = *MEMORY[0x1E69E9840];
  controllerCopy = controller;
  onboardingController = [(CKChatController *)self onboardingController];

  if (onboardingController == controllerCopy)
  {
    selfCopy = self;
  }

  else
  {
    if (IMOSLoggingEnabled())
    {
      v6 = OSLogHandleForIMFoundationCategory();
      if (os_log_type_enabled(v6, OS_LOG_TYPE_INFO))
      {
        v9 = 138412290;
        v10 = controllerCopy;
        _os_log_impl(&dword_19020E000, v6, OS_LOG_TYPE_INFO, "Unexpected instance of onboardingController %@", &v9, 0xCu);
      }
    }

    selfCopy = 0;
  }

  return selfCopy;
}

- (void)onboardingControllerDidFinish:(id)finish
{
  finishCopy = finish;
  if (IMOSLoggingEnabled())
  {
    v5 = OSLogHandleForIMFoundationCategory();
    if (os_log_type_enabled(v5, OS_LOG_TYPE_INFO))
    {
      *v6 = 0;
      _os_log_impl(&dword_19020E000, v5, OS_LOG_TYPE_INFO, "Finishing onboarding in CKChatController", v6, 2u);
    }
  }

  [(CKChatController *)self setOnboardingController:0];
}

- (BOOL)_shouldShowNicknameOnboardingFlow
{
  if (IMSharedHelperNickNameEnabled())
  {
    mEMORY[0x1E69A5C10] = [MEMORY[0x1E69A5C10] sharedInstance];
    if ([mEMORY[0x1E69A5C10] iCloudSignedInToUseNicknames])
    {
      v3 = [MEMORY[0x1E69A5C10] multiplePhoneNumbersTiedToAppleID] ^ 1;
    }

    else
    {
      LOBYTE(v3) = 0;
    }
  }

  else
  {
    LOBYTE(v3) = 0;
  }

  return v3;
}

- (BOOL)showNicknameSharingOnboardingWithMemoji:(BOOL)memoji
{
  memojiCopy = memoji;
  if (![(CKChatController *)self _shouldShowNicknameOnboardingFlow])
  {
    return 0;
  }

  mEMORY[0x1E69A8108] = [MEMORY[0x1E69A8108] sharedInstance];
  sharingEnabled = [mEMORY[0x1E69A8108] sharingEnabled];
  if ((sharingEnabled & 1) == 0)
  {
    onboardingController = [(CKChatController *)self onboardingController];
    [onboardingController presentNicknameSharingSetupFlowWithMemoji:memojiCopy forUserInitiatedEdit:1];
  }

  v8 = sharingEnabled ^ 1;

  return v8;
}

- (id)_meContact
{
  mEMORY[0x1E69A7FD0] = [MEMORY[0x1E69A7FD0] sharedInstance];
  keysForNicknameHandling = [MEMORY[0x1E69A7FD0] keysForNicknameHandling];
  v4 = [mEMORY[0x1E69A7FD0] fetchMeContactWithKeys:keysForNicknameHandling];

  return v4;
}

- (id)textDroppableView:(id)view proposalForDrop:(id)drop
{
  dropCopy = drop;
  entryView = [(CKChatController *)self entryView];
  if ([entryView displayMode] == 2)
  {

LABEL_4:
    v9 = 0;
    goto LABEL_8;
  }

  entryView2 = [(CKChatController *)self entryView];
  displayMode = [entryView2 displayMode];

  if (displayMode == 3)
  {
    goto LABEL_4;
  }

  if ([dropCopy isSameView])
  {
    v9 = 3;
  }

  else
  {
    v9 = 2;
  }

LABEL_8:
  v10 = [objc_alloc(MEMORY[0x1E69DD0A0]) initWithDropOperation:v9];
  [v10 setDropAction:0];
  v11 = IMLogHandleForCategory();
  if (os_log_type_enabled(v11, OS_LOG_TYPE_DEBUG))
  {
    [CKChatController textDroppableView:proposalForDrop:];
  }

  return v10;
}

- (void)textDroppableView:(id)view dropSessionDidEnter:(id)enter
{
  v14 = *MEMORY[0x1E69E9840];
  viewCopy = view;
  enterCopy = enter;
  if (IMOSLoggingEnabled())
  {
    v8 = OSLogHandleForIMFoundationCategory();
    if (os_log_type_enabled(v8, OS_LOG_TYPE_INFO))
    {
      items = [enterCopy items];
      v10 = 138412546;
      v11 = enterCopy;
      v12 = 2048;
      v13 = [items count];
      _os_log_impl(&dword_19020E000, v8, OS_LOG_TYPE_INFO, "textDroppableView:dropSessionDidEnter: %@ %lu", &v10, 0x16u);
    }
  }

  [(CKChatController *)self setCurrentDropSession:enterCopy];
}

- (void)textDroppableView:(id)view dropSessionDidEnd:(id)end
{
  v11 = *MEMORY[0x1E69E9840];
  viewCopy = view;
  endCopy = end;
  if (IMOSLoggingEnabled())
  {
    v8 = OSLogHandleForIMFoundationCategory();
    if (os_log_type_enabled(v8, OS_LOG_TYPE_INFO))
    {
      v9 = 138412290;
      v10 = endCopy;
      _os_log_impl(&dword_19020E000, v8, OS_LOG_TYPE_INFO, "textDroppableView:dropSessionDidEnd: %@", &v9, 0xCu);
    }
  }

  [(CKChatController *)self setCurrentDropSession:0];
}

- (void)textPasteConfigurationSupporting:(id)supporting transformPasteItem:(id)item
{
  supportingCopy = supporting;
  itemCopy = item;
  if (!self->_dropComposition)
  {
    v8 = +[CKComposition composition];
    dropComposition = self->_dropComposition;
    self->_dropComposition = v8;
  }

  conversation = [(CKCoreChatController *)self conversation];
  v11 = objc_alloc_init(_TtC7ChatKit27CKCompositionBuilderContext);
  -[CKCompositionBuilderContext setIsInLockdownMode:](v11, "setIsInLockdownMode:", [MEMORY[0x1E69A8020] deviceIsLockedDown]);
  mEMORY[0x1E69A8070] = [MEMORY[0x1E69A8070] sharedFeatureFlags];
  isExpressiveTextEnabled = [mEMORY[0x1E69A8070] isExpressiveTextEnabled];

  if (isExpressiveTextEnabled)
  {
    chat = [conversation chat];
    -[CKCompositionBuilderContext setSupportsExpressiveText:](v11, "setSupportsExpressiveText:", [chat supportsCapabilities:0x100000]);
  }

  -[CKCompositionBuilderContext setConversationSupportsInlineAdaptiveImageGlyphs:](v11, "setConversationSupportsInlineAdaptiveImageGlyphs:", [conversation supportsInlineAdaptiveImageGlyphs]);
  [(CKCompositionBuilderContext *)v11 setCanUseRichTextAttributes:1];
  aBlock[0] = MEMORY[0x1E69E9820];
  aBlock[1] = 3221225472;
  aBlock[2] = __72__CKChatController_textPasteConfigurationSupporting_transformPasteItem___block_invoke;
  aBlock[3] = &unk_1E72EE370;
  aBlock[4] = self;
  v15 = itemCopy;
  v29 = v15;
  v16 = _Block_copy(aBlock);
  currentDropSession = [(CKChatController *)self currentDropSession];
  items = [currentDropSession items];
  v19 = [items count];

  itemProvider = [v15 itemProvider];
  if (v19 < 2)
  {
    v24[0] = MEMORY[0x1E69E9820];
    v24[1] = 3221225472;
    v24[2] = __72__CKChatController_textPasteConfigurationSupporting_transformPasteItem___block_invoke_2;
    v24[3] = &unk_1E72ED700;
    v21 = &v25;
    v25 = v16;
    v23 = v16;
    [CKComposition requestCompositionFromItemProvider:itemProvider builderContext:v11 completion:v24];
  }

  else
  {
    v26[0] = MEMORY[0x1E69E9820];
    v26[1] = 3221225472;
    v26[2] = __72__CKChatController_textPasteConfigurationSupporting_transformPasteItem___block_invoke_1622;
    v26[3] = &unk_1E72ED700;
    v21 = &v27;
    v27 = v16;
    v22 = v16;
    [CKComposition requestCompositionFromItemProviderForNonCollaboration:itemProvider builderContext:v11 completion:v26];
  }
}

void __72__CKChatController_textPasteConfigurationSupporting_transformPasteItem___block_invoke(uint64_t a1, void *a2)
{
  v4 = a2;
  if (v4)
  {
    v5 = [*(*(a1 + 32) + 1384) compositionByAppendingComposition:v4];
    v6 = *(a1 + 32);
    v7 = *(v6 + 1384);
    *(v6 + 1384) = v5;

    if ([v4 isAudioComposition])
    {
      objc_storeStrong((*(a1 + 32) + 1384), a2);
    }

    v8 = IMLogHandleForCategory();
    if (os_log_type_enabled(v8, OS_LOG_TYPE_DEBUG))
    {
      __72__CKChatController_textPasteConfigurationSupporting_transformPasteItem___block_invoke_cold_1();
    }

    [*(a1 + 40) setNoResult];
  }
}

- (id)textPasteConfigurationSupporting:(id)supporting combineItemAttributedStrings:(id)strings forRange:(id)range
{
  v52 = *MEMORY[0x1E69E9840];
  supportingCopy = supporting;
  stringsCopy = strings;
  rangeCopy = range;
  if (self->_dropComposition)
  {
    entryView = [(CKChatController *)self entryView];
    v13 = [entryView pasteBoardTextFromComposition:self->_dropComposition];

    isAudioComposition = [(CKComposition *)self->_dropComposition isAudioComposition];
    if (isAudioComposition)
    {
    }

    else if (v13)
    {
      dropComposition = self->_dropComposition;
      self->_dropComposition = 0;

      goto LABEL_25;
    }

    shelfPluginPayload = [(CKComposition *)self->_dropComposition shelfPluginPayload];
    if (shelfPluginPayload)
    {
    }

    else
    {
      shelfMediaObject = [(CKComposition *)self->_dropComposition shelfMediaObject];
      v22 = shelfMediaObject == 0;

      if (v22 & ~isAudioComposition)
      {
LABEL_24:
        v13 = 0;
        goto LABEL_25;
      }
    }

    v41 = 0;
    v42 = &v41;
    v43 = 0x3032000000;
    v44 = __Block_byref_object_copy__8;
    v45 = __Block_byref_object_dispose__8;
    entryView2 = [(CKChatController *)self entryView];
    composition = [entryView2 composition];

    v37 = 0;
    v38 = &v37;
    v39 = 0x2020000000;
    shelfPluginPayload2 = [v42[5] shelfPluginPayload];
    v25 = shelfPluginPayload2 != 0;

    v40 = v25;
    v26 = v38;
    hasContent = *(v38 + 24);
    if (isAudioComposition && (v38[3] & 1) == 0)
    {
      hasContent = [v42[5] hasContent];
      v26 = v38;
    }

    *(v26 + 24) = hasContent & 1;
    aBlock[0] = MEMORY[0x1E69E9820];
    aBlock[1] = 3221225472;
    aBlock[2] = __91__CKChatController_textPasteConfigurationSupporting_combineItemAttributedStrings_forRange___block_invoke;
    aBlock[3] = &unk_1E72EE3C0;
    aBlock[4] = self;
    aBlock[5] = &v37;
    aBlock[6] = &v41;
    v28 = _Block_copy(aBlock);
    v29 = v28;
    if (*(v38 + 24) == 1)
    {
      v34[0] = MEMORY[0x1E69E9820];
      v34[1] = 3221225472;
      v34[2] = __91__CKChatController_textPasteConfigurationSupporting_combineItemAttributedStrings_forRange___block_invoke_3;
      v34[3] = &unk_1E72EBDB8;
      v35 = v28;
      v32[0] = MEMORY[0x1E69E9820];
      v32[1] = 3221225472;
      v32[2] = __91__CKChatController_textPasteConfigurationSupporting_combineItemAttributedStrings_forRange___block_invoke_4;
      v32[3] = &unk_1E72EBDB8;
      v33 = v35;
      [(CKChatController *)self presentReplaceCompositionAlertWithConfirmationBlock:v34 cancelBlock:v32];
    }

    else
    {
      (*(v28 + 2))(v28, 1);
    }

    _Block_object_dispose(&v37, 8);
    _Block_object_dispose(&v41, 8);

    goto LABEL_24;
  }

  v13 = objc_alloc_init(MEMORY[0x1E696AD40]);
  v47 = 0u;
  v48 = 0u;
  v49 = 0u;
  v50 = 0u;
  v15 = stringsCopy;
  v16 = [v15 countByEnumeratingWithState:&v47 objects:v51 count:16];
  if (v16)
  {
    v17 = *v48;
    do
    {
      for (i = 0; i != v16; ++i)
      {
        if (*v48 != v17)
        {
          objc_enumerationMutation(v15);
        }

        [v13 appendAttributedString:*(*(&v47 + 1) + 8 * i)];
      }

      v16 = [v15 countByEnumeratingWithState:&v47 objects:v51 count:16];
    }

    while (v16);
  }

LABEL_25:
  v30 = IMLogHandleForCategory();
  if (os_log_type_enabled(v30, OS_LOG_TYPE_DEBUG))
  {
    [CKChatController textPasteConfigurationSupporting:a2 combineItemAttributedStrings:? forRange:?];
  }

  return v13;
}

void __91__CKChatController_textPasteConfigurationSupporting_combineItemAttributedStrings_forRange___block_invoke(uint64_t a1, char a2)
{
  if (*(*(*(a1 + 40) + 8) + 24) != 1 || (a2 & 1) != 0)
  {
    v5 = *(*(a1 + 48) + 8);
    v6 = *(v5 + 40);
    v7 = *(*(a1 + 32) + 1384);
    if (v6)
    {
      v8 = [v6 compositionByAppendingComposition:v7];
      v9 = *(*(a1 + 48) + 8);
      v10 = *(v9 + 40);
      *(v9 + 40) = v8;
    }

    else
    {
      v11 = v7;
      v10 = *(v5 + 40);
      *(v5 + 40) = v11;
    }

    if ([*(*(a1 + 32) + 1384) isAudioComposition])
    {
      objc_storeStrong((*(*(a1 + 48) + 8) + 40), *(*(a1 + 32) + 1384));
    }

    objc_initWeak(&location, *(a1 + 32));
    block[0] = MEMORY[0x1E69E9820];
    block[1] = 3221225472;
    block[2] = __91__CKChatController_textPasteConfigurationSupporting_combineItemAttributedStrings_forRange___block_invoke_2;
    block[3] = &unk_1E72EE398;
    objc_copyWeak(&v15, &location);
    block[4] = *(a1 + 48);
    dispatch_async(MEMORY[0x1E69E96A0], block);
    v12 = *(a1 + 32);
    v13 = *(v12 + 1384);
    *(v12 + 1384) = 0;

    objc_destroyWeak(&v15);
    objc_destroyWeak(&location);
  }

  else
  {
    v3 = *(a1 + 32);
    v4 = *(v3 + 1384);
    *(v3 + 1384) = 0;
  }
}

void __91__CKChatController_textPasteConfigurationSupporting_combineItemAttributedStrings_forRange___block_invoke_2(uint64_t a1)
{
  WeakRetained = objc_loadWeakRetained((a1 + 40));
  v2 = [WeakRetained entryView];
  [v2 setComposition:*(*(*(a1 + 32) + 8) + 40)];
}

uint64_t __91__CKChatController_textPasteConfigurationSupporting_combineItemAttributedStrings_forRange___block_invoke_4(uint64_t a1)
{
  if (IMOSLoggingEnabled())
  {
    v2 = OSLogHandleForIMFoundationCategory();
    if (os_log_type_enabled(v2, OS_LOG_TYPE_INFO))
    {
      *v4 = 0;
      _os_log_impl(&dword_19020E000, v2, OS_LOG_TYPE_INFO, "Do not replace composition, return.", v4, 2u);
    }
  }

  return (*(*(a1 + 32) + 16))();
}

- (id)textPasteConfigurationSupporting:(id)supporting performPasteOfAttributedString:(id)string toRange:(id)range
{
  supportingCopy = supporting;
  [supportingCopy handlePastedString:string toRange:range];
  v9 = IMLogHandleForCategory();
  if (os_log_type_enabled(v9, OS_LOG_TYPE_DEBUG))
  {
    [CKChatController textPasteConfigurationSupporting:a2 performPasteOfAttributedString:? toRange:?];
  }

  selectedTextRange = [supportingCopy selectedTextRange];

  return selectedTextRange;
}

- (void)_dragInteractionDidCancelLiftWithoutDragging:(id)dragging
{
  draggingCopy = dragging;
  WeakRetained = objc_loadWeakRetained(&self->_currentDragPreviewContainer);

  if (WeakRetained)
  {
    v6 = [(CKChatController *)self _transcriptStickerCellContainingInteraction:draggingCopy];
    if (v6)
    {
      collectionView = [(CKChatController *)self collectionView];
      [collectionView setScrollEnabled:0];

      v8 = objc_loadWeakRetained(&self->_currentDragPreviewContainer);
      v9[0] = MEMORY[0x1E69E9820];
      v9[1] = 3221225472;
      v9[2] = __65__CKChatController__dragInteractionDidCancelLiftWithoutDragging___block_invoke;
      v9[3] = &unk_1E72EB8D0;
      v9[4] = self;
      v10 = draggingCopy;
      [v8 _animateLiftCancellationAlongsideAnimator:0 completion:v9];

      objc_storeWeak(&self->_currentDragPreviewContainer, 0);
    }
  }
}

void __65__CKChatController__dragInteractionDidCancelLiftWithoutDragging___block_invoke(uint64_t a1)
{
  v2 = [*(a1 + 32) collectionView];
  [v2 setScrollEnabled:1];

  v3 = [*(a1 + 32) _transcriptStickerCellContainingInteraction:*(a1 + 40)];
  if (v3)
  {
    v4 = v3;
    [v3 setStickerViewHidden:0];
    v3 = v4;
  }
}

- (void)_dragInteraction:(id)interaction prepareForSession:(id)session completion:(id)completion
{
  interactionCopy = interaction;
  completionCopy = completion;
  mEMORY[0x1E69A8070] = [MEMORY[0x1E69A8070] sharedFeatureFlags];
  isStickerRepositioningEnabled = [mEMORY[0x1E69A8070] isStickerRepositioningEnabled];

  if (isStickerRepositioningEnabled)
  {
    [interactionCopy _setLiftMoveHysteresis:0.0];
  }

  completionCopy[2](completionCopy);
}

- (id)_dragInteraction:(id)interaction sessionPropertiesForSession:(id)session
{
  interactionCopy = interaction;
  sessionCopy = session;
  v8 = objc_alloc_init(MEMORY[0x1E69DD480]);
  mEMORY[0x1E69A8070] = [MEMORY[0x1E69A8070] sharedFeatureFlags];
  isStickerRepositioningEnabled = [mEMORY[0x1E69A8070] isStickerRepositioningEnabled];

  if (isStickerRepositioningEnabled && [sessionCopy hasItemsConformingToTypeIdentifiers:&unk_1F04E6840])
  {
    [v8 set_wantsElasticEffects:1];
    [v8 set_resizable:1];
    [v8 set_rotatable:1];
    v11 = [(CKChatController *)self _transcriptStickerCellContainingInteraction:interactionCopy];
    if (v11)
    {
      collectionViewController = [(CKCoreChatController *)self collectionViewController];
      v13 = [collectionViewController chatItemForCell:v11];

      if (v13 && (objc_opt_class(), (objc_opt_isKindOfClass() & 1) != 0))
      {
        v14 = MEMORY[0x1E69A82C0];
        v15 = v13;
        collectionView = [(CKChatController *)self collectionView];
        [collectionView bounds];
        [v14 calculatedRecentsItemWidthFromStickersUltraExtensionForStickerChatItem:v15 collectionViewWidth:v17];
        v19 = v18;
        v21 = v20;
      }

      else
      {
        v21 = 48.0;
        v19 = 48.0;
      }
    }

    else
    {
      v21 = 48.0;
      v19 = 48.0;
    }

    [v8 set_minimumResizableSize:{v19, v21}];
    v22 = +[CKUIBehavior sharedBehaviors];
    [v22 stickerDropPreviewMaxDimension];
    v24 = v23;
    v25 = +[CKUIBehavior sharedBehaviors];
    [v25 stickerDropPreviewMaxDimension];
    [v8 set_maximumResizableSize:{v24, v26}];
  }

  return v8;
}

- (BOOL)dragInteraction:(id)interaction sessionIsRestrictedToDraggingApplication:(id)application
{
  v16 = *MEMORY[0x1E69E9840];
  applicationCopy = application;
  mEMORY[0x1E69A8070] = [MEMORY[0x1E69A8070] sharedFeatureFlags];
  LODWORD(v6) = [mEMORY[0x1E69A8070] isStickerRepositioningEnabled];

  if (v6)
  {
    v13 = 0u;
    v14 = 0u;
    v11 = 0u;
    v12 = 0u;
    items = [applicationCopy items];
    v6 = [items countByEnumeratingWithState:&v11 objects:v15 count:16];
    if (v6)
    {
      v8 = *v12;
      while (2)
      {
        for (i = 0; i != v6; ++i)
        {
          if (*v12 != v8)
          {
            objc_enumerationMutation(items);
          }

          if ([MEMORY[0x1E69A82C0] dragItemIsRepositioningSticker:*(*(&v11 + 1) + 8 * i)])
          {
            LOBYTE(v6) = 1;
            goto LABEL_12;
          }
        }

        v6 = [items countByEnumeratingWithState:&v11 objects:v15 count:16];
        if (v6)
        {
          continue;
        }

        break;
      }
    }

LABEL_12:
  }

  return v6;
}

- (id)dragInteraction:(id)interaction itemsForAddingToSession:(id)session withTouchAtPoint:(CGPoint)point
{
  v29 = *MEMORY[0x1E69E9840];
  interactionCopy = interaction;
  v23 = 0u;
  v24 = 0u;
  v25 = 0u;
  v26 = 0u;
  items = [session items];
  v9 = [items countByEnumeratingWithState:&v23 objects:v28 count:16];
  if (v9)
  {
    v10 = v9;
    v11 = *v24;
    v12 = MEMORY[0x1E695E0F0];
LABEL_3:
    v13 = 0;
    while (1)
    {
      if (*v24 != v11)
      {
        objc_enumerationMutation(items);
      }

      if ([MEMORY[0x1E69A82C0] dragItemIsRepositioningSticker:*(*(&v23 + 1) + 8 * v13)])
      {
        break;
      }

      if (v10 == ++v13)
      {
        v10 = [items countByEnumeratingWithState:&v23 objects:v28 count:16];
        if (v10)
        {
          goto LABEL_3;
        }

        goto LABEL_9;
      }
    }
  }

  else
  {
LABEL_9:

    [(CKChatController *)self _dragItemsForInteraction:interactionCopy];
    v19 = 0u;
    v20 = 0u;
    v21 = 0u;
    items = v22 = 0u;
    v14 = [items countByEnumeratingWithState:&v19 objects:v27 count:16];
    if (v14)
    {
      v15 = v14;
      v16 = *v20;
      while (2)
      {
        for (i = 0; i != v15; ++i)
        {
          if (*v20 != v16)
          {
            objc_enumerationMutation(items);
          }

          if ([MEMORY[0x1E69A82C0] dragItemIsRepositioningSticker:{*(*(&v19 + 1) + 8 * i), v19}])
          {

            v12 = MEMORY[0x1E695E0F0];
            goto LABEL_19;
          }
        }

        v15 = [items countByEnumeratingWithState:&v19 objects:v27 count:16];
        if (v15)
        {
          continue;
        }

        break;
      }
    }

    items = items;
    v12 = items;
  }

LABEL_19:

  return v12;
}

- (id)dragInteraction:(id)interaction previewForLiftingItem:(id)item session:(id)session
{
  interactionCopy = interaction;
  itemCopy = item;
  mEMORY[0x1E69A8070] = [MEMORY[0x1E69A8070] sharedFeatureFlags];
  if (![mEMORY[0x1E69A8070] isStickerRepositioningEnabled])
  {

LABEL_13:
    localObject = [itemCopy localObject];
    objc_opt_class();
    isKindOfClass = objc_opt_isKindOfClass();

    if ((isKindOfClass & 1) == 0)
    {
      placeholderViewFactory = 0;
      goto LABEL_47;
    }

    localObject2 = [itemCopy localObject];
    objc_opt_class();
    if (objc_opt_isKindOfClass())
    {
      stackView = [localObject2 stackView];
      currentAssetReference = [stackView currentAssetReference];
      v33 = [stackView regionOfInterestForAssetReference:currentAssetReference];
      placeholderViewFactory = [v33 placeholderViewFactory];
      if (placeholderViewFactory)
      {
        v83 = interactionCopy;
        placeholderViewFactory2 = [v33 placeholderViewFactory];
        v35 = (placeholderViewFactory2)[2](placeholderViewFactory2, v33);

        if (v35)
        {
          view = [(CKChatController *)self view];
          [v33 rectInCoordinateSpace:view];
          v79 = v38;
          v81 = v37;
          v75 = v40;
          v77 = v39;

          v41 = objc_alloc(MEMORY[0x1E69DCE38]);
          view2 = [(CKChatController *)self view];
          v43 = *(MEMORY[0x1E695F058] + 16);
          if (CKMainScreenScale_once_12 != -1)
          {
            v74 = *(MEMORY[0x1E695F058] + 16);
            [CKChatController dragInteraction:previewForLiftingItem:session:];
            v43 = v74;
          }

          v44 = CKMainScreenScale_sMainScreenScale_12;
          if (*&CKMainScreenScale_sMainScreenScale_12 == 0.0)
          {
            *&v44 = 1.0;
          }

          v45.f64[0] = v77;
          v45.f64[1] = v75;
          __asm { FMOV            V2.2D, #0.5 }

          v51 = vmulq_f64(vsubq_f64(v45, v43), _Q2);
          _Q2.f64[0] = v81;
          _Q2.f64[1] = v79;
          v52 = [v41 initWithContainer:view2 center:{vdivq_f64(vrndmq_f64(vmulq_n_f64(vaddq_f64(_Q2, v51), *&v44)), vdupq_lane_s64(v44, 0)), *&v74}];

          v53 = objc_alloc_init(MEMORY[0x1E69DCE28]);
          placeholderViewFactory = [objc_alloc(MEMORY[0x1E69DD068]) initWithView:v35 parameters:v53 target:v52];
        }

        else
        {
          placeholderViewFactory = 0;
        }

        interactionCopy = v83;
      }
    }

    else
    {
      objc_opt_class();
      if ((objc_opt_isKindOfClass() & 1) == 0 || ![localObject2 shouldProvideDragPreview])
      {
        goto LABEL_45;
      }

      stackView = [(CKChatController *)self dragPreviewParametersForBalloonView:localObject2];
      v54 = objc_alloc(MEMORY[0x1E69DCE38]);
      superview = [localObject2 superview];
      [localObject2 frame];
      v60 = *(MEMORY[0x1E695F058] + 16);
      if (CKMainScreenScale_once_12 != -1)
      {
        v82 = v57;
        v84 = v56.f64[0];
        v78 = v59;
        v80 = v58.f64[0];
        v76 = *(MEMORY[0x1E695F058] + 16);
        [CKChatController dragInteraction:previewForLiftingItem:session:];
        v60 = v76;
        v59 = v78;
        v58.f64[0] = v80;
        v57 = v82;
        v56.f64[0] = v84;
      }

      *&v61 = 1.0;
      if (*&CKMainScreenScale_sMainScreenScale_12 != 0.0)
      {
        v61 = CKMainScreenScale_sMainScreenScale_12;
      }

      v58.f64[1] = v59;
      v62 = vsubq_f64(v58, v60);
      __asm { FMOV            V2.2D, #0.5 }

      v56.f64[1] = v57;
      currentAssetReference = [v54 initWithContainer:superview center:{vdivq_f64(vrndmq_f64(vmulq_n_f64(vaddq_f64(v56, vmulq_f64(v62, _Q2)), *&v61)), vdupq_lane_s64(v61, 0))}];

      attachmentBalloonViewPreview = [localObject2 attachmentBalloonViewPreview];
      v65 = attachmentBalloonViewPreview;
      if (attachmentBalloonViewPreview)
      {
        v66 = attachmentBalloonViewPreview;
      }

      else
      {
        v66 = localObject2;
      }

      v33 = v66;

      placeholderViewFactory = [objc_alloc(MEMORY[0x1E69DD068]) initWithView:v33 parameters:stackView target:currentAssetReference];
    }

    if (placeholderViewFactory)
    {
      goto LABEL_46;
    }

LABEL_45:
    [localObject2 setCanUseOpaqueMask:0];
    [localObject2 prepareForDisplayIfNeeded];
    v72 = [(CKChatController *)self dragPreviewParametersForBalloonView:localObject2];
    placeholderViewFactory = [objc_alloc(MEMORY[0x1E69DD068]) initWithView:localObject2 parameters:v72];

    goto LABEL_46;
  }

  v10 = [MEMORY[0x1E69A82C0] dragItemIsRepositioningSticker:itemCopy];

  if (!v10)
  {
    goto LABEL_13;
  }

  localObject3 = [itemCopy localObject];
  localObject2 = [localObject3 objectForKey:@"kStickerDragItemImageViewKey"];

  if (localObject2)
  {
    v13 = objc_alloc_init(MEMORY[0x1E69DC9A0]);
    v14 = objc_alloc_init(MEMORY[0x1E69DC728]);
    [v13 setShadowPath:v14];

    clearColor = [MEMORY[0x1E69DC888] clearColor];
    [v13 setBackgroundColor:clearColor];

    v16 = MEMORY[0x193AF5EC0](@"_MSStickerDragPreviewContainerView", @"Messages");
    if (v16 && (objc_opt_respondsToSelector() & 1) != 0)
    {
      shadowPropertiesForDrag = [v16 shadowPropertiesForDrag];
      if (shadowPropertiesForDrag && (objc_opt_respondsToSelector() & 1) != 0)
      {
        [v13 _setShadowProperties:shadowPropertiesForDrag];
      }
    }

    superview2 = [localObject2 superview];
    [localObject2 center];
    [superview2 convertPoint:superview2 toView:?];
    v20 = v19;
    v22 = v21;
    v23 = objc_alloc(MEMORY[0x1E69DC9A8]);
    [(CKChatController *)self stickerPreviewTransform];
    v24 = [v23 initWithContainer:superview2 center:v85 transform:{v20, v22}];
    placeholderViewFactory = [objc_alloc(MEMORY[0x1E69DD068]) initWithView:localObject2 parameters:v13 target:v24];
    v26 = [[v16 alloc] initWithIsDropAnimation:0];
    objc_opt_class();
    if (objc_opt_isKindOfClass())
    {
      v27 = interactionCopy;
      currentFrameIndex = [localObject2 currentFrameIndex];
    }

    else
    {
      objc_opt_class();
      if ((objc_opt_isKindOfClass() & 1) == 0)
      {
LABEL_37:
        [placeholderViewFactory _setPreviewContainer:v26];
        [(CKChatController *)self setCurrentDragPreviewContainer:v26];
        v69 = [(CKChatController *)self _transcriptStickerCellContainingInteraction:interactionCopy];
        if (v69)
        {
          v70 = interactionCopy;
          v71 = IMLogHandleForCategory();
          if (os_log_type_enabled(v71, OS_LOG_TYPE_DEBUG))
          {
            [CKChatController dragInteraction:previewForLiftingItem:session:];
          }

          [v69 setGestureRecognizersEnabled:0];
          interactionCopy = v70;
        }

        goto LABEL_46;
      }

      v27 = interactionCopy;
      v67 = localObject2;
      currentFrameIndex = 0;
    }

    [(CKChatController *)self setInitialFrameIndexForCurrentDrag:currentFrameIndex];
    image = [localObject2 image];

    [v26 setImage:image];
    interactionCopy = v27;
    goto LABEL_37;
  }

  placeholderViewFactory = 0;
LABEL_46:

LABEL_47:

  return placeholderViewFactory;
}

- (void)dragInteraction:(id)interaction sessionWillBegin:(id)begin
{
  interactionCopy = interaction;
  [(CKChatController *)self setDragSession:begin];
  [(CKCoreChatController *)self _updateTranscriptDockingStateIfNeeded];
  mEMORY[0x1E69A8070] = [MEMORY[0x1E69A8070] sharedFeatureFlags];
  isStickerRepositioningEnabled = [mEMORY[0x1E69A8070] isStickerRepositioningEnabled];

  v8 = interactionCopy;
  if (isStickerRepositioningEnabled)
  {
    v9 = [(CKChatController *)self _transcriptStickerCellContainingInteraction:interactionCopy];
    v10 = v9;
    if (v9)
    {
      [v9 setHidden:1];
      [v10 setStickerViewHidden:1];
    }

    v8 = interactionCopy;
  }
}

- (void)dragInteraction:(id)interaction session:(id)session didEndWithOperation:(unint64_t)operation
{
  interactionCopy = interaction;
  [(CKChatController *)self setDragSession:0];
  [(CKChatController *)self setCurrentDragPreviewContainer:0];
  [(CKCoreChatController *)self _updateTranscriptDockingStateIfNeeded];
  v7 = [(CKChatController *)self _transcriptStickerCellContainingInteraction:interactionCopy];

  if (v7)
  {
    v8 = IMLogHandleForCategory();
    if (os_log_type_enabled(v8, OS_LOG_TYPE_DEBUG))
    {
      [CKChatController dragInteraction:session:didEndWithOperation:];
    }

    [v7 setGestureRecognizersEnabled:1];
  }
}

- (id)dragInteraction:(id)interaction previewForCancellingItem:(id)item withDefault:(id)default
{
  interactionCopy = interaction;
  defaultCopy = default;
  mEMORY[0x1E69A8070] = [MEMORY[0x1E69A8070] sharedFeatureFlags];
  isStickerRepositioningEnabled = [mEMORY[0x1E69A8070] isStickerRepositioningEnabled];

  if (isStickerRepositioningEnabled)
  {
    v11 = [(CKChatController *)self _transcriptStickerCellContainingInteraction:interactionCopy];
    v12 = v11;
    if (v11)
    {
      associatedItemView = [v11 associatedItemView];
      view = [(CKChatController *)self view];
      [associatedItemView frameInView:view];
      v16 = v15;
      v18 = v17;
      v20 = v19;
      v22 = v21;

      v23 = v16 + v20 * 0.5;
      v34 = 0u;
      v35 = 0u;
      v24 = v18 + v22 * 0.5;
      v33 = 0u;
      associatedItemView2 = [v12 associatedItemView];
      v26 = associatedItemView2;
      if (associatedItemView2)
      {
        [associatedItemView2 transform];
      }

      else
      {
        v34 = 0u;
        v35 = 0u;
        v33 = 0u;
      }

      v28 = objc_alloc(MEMORY[0x1E69DC9A8]);
      view2 = [(CKChatController *)self view];
      v32[0] = v33;
      v32[1] = v34;
      v32[2] = v35;
      v30 = [v28 initWithContainer:view2 center:v32 transform:{v23, v24}];
      v27 = [defaultCopy retargetedPreviewWithTarget:v30];
    }

    else
    {
      v27 = 0;
    }
  }

  else
  {
    v27 = 0;
  }

  return v27;
}

- (void)dragInteraction:(id)interaction item:(id)item willAnimateCancelWithAnimator:(id)animator
{
  interactionCopy = interaction;
  animatorCopy = animator;
  mEMORY[0x1E69A8070] = [MEMORY[0x1E69A8070] sharedFeatureFlags];
  isStickerRepositioningEnabled = [mEMORY[0x1E69A8070] isStickerRepositioningEnabled];

  if (isStickerRepositioningEnabled)
  {
    v14[0] = MEMORY[0x1E69E9820];
    v14[1] = 3221225472;
    v14[2] = __71__CKChatController_dragInteraction_item_willAnimateCancelWithAnimator___block_invoke;
    v14[3] = &unk_1E72EBA18;
    v14[4] = self;
    [animatorCopy addAnimations:v14];
    collectionView = [(CKChatController *)self collectionView];
    [collectionView setScrollEnabled:0];

    v12[0] = MEMORY[0x1E69E9820];
    v12[1] = 3221225472;
    v12[2] = __71__CKChatController_dragInteraction_item_willAnimateCancelWithAnimator___block_invoke_2;
    v12[3] = &unk_1E72EE3E8;
    v12[4] = self;
    v13 = interactionCopy;
    [animatorCopy addCompletion:v12];
  }
}

void __71__CKChatController_dragInteraction_item_willAnimateCancelWithAnimator___block_invoke_2(uint64_t a1, uint64_t a2)
{
  if (!a2)
  {
    v4 = [*(a1 + 32) collectionView];
    [v4 setScrollEnabled:1];

    v5 = [*(a1 + 32) _transcriptStickerCellContainingInteraction:*(a1 + 40)];
    if (v5)
    {
      v6 = v5;
      [v5 setHidden:0];
      [v6 setStickerViewHidden:0];
      v5 = v6;
    }
  }
}

- (id)_dragItemsForInteraction:(id)interaction
{
  interactionCopy = interaction;
  if (-[CKChatController isShowingOscarChat](self, "isShowingOscarChat") || (+[CKUIBehavior sharedBehaviors](CKUIBehavior, "sharedBehaviors"), v5 = objc_claimAutoreleasedReturnValue(), v6 = [v5 disableTranscriptInteractions], v5, (v6 & 1) != 0))
  {
    v7 = 0;
    goto LABEL_12;
  }

  collectionView = [(CKChatController *)self collectionView];
  visibleCells = [collectionView visibleCells];

  mEMORY[0x1E69A8070] = [MEMORY[0x1E69A8070] sharedFeatureFlags];
  isStickerRepositioningEnabled = [mEMORY[0x1E69A8070] isStickerRepositioningEnabled];

  if (!isStickerRepositioningEnabled)
  {
    goto LABEL_7;
  }

  v7 = [(CKChatController *)self _dragItemsIfRepositioningForInteraction:interactionCopy];
  if (![v7 count])
  {

LABEL_7:
    v30 = 0;
    v31 = &v30;
    v32 = 0x3032000000;
    v33 = __Block_byref_object_copy__8;
    v34 = __Block_byref_object_dispose__8;
    v35 = 0;
    v24 = 0;
    v25 = &v24;
    v26 = 0x3032000000;
    v27 = __Block_byref_object_copy__8;
    v28 = __Block_byref_object_dispose__8;
    v29 = 0;
    v16 = MEMORY[0x1E69E9820];
    v17 = 3221225472;
    v18 = __45__CKChatController__dragItemsForInteraction___block_invoke;
    v19 = &unk_1E72EE410;
    v20 = interactionCopy;
    selfCopy = self;
    v22 = &v30;
    v23 = &v24;
    [visibleCells enumerateObjectsUsingBlock:&v16];
    objc_opt_class();
    if (objc_opt_isKindOfClass())
    {
      v7 = 0;
    }

    else
    {
      v12 = [(CKCoreChatController *)self collectionViewController:v16];
      chatItems = [v12 chatItems];
      v14 = [chatItems objectAtIndex:{objc_msgSend(v31[5], "item")}];

      v7 = [(CKChatController *)self _dragItemsFromChatItem:v14 balloonView:v25[5]];
    }

    _Block_object_dispose(&v24, 8);
    _Block_object_dispose(&v30, 8);
  }

LABEL_12:

  return v7;
}

void __45__CKChatController__dragItemsForInteraction___block_invoke(uint64_t a1, void *a2, uint64_t a3, _BYTE *a4)
{
  v14 = a2;
  if (objc_opt_respondsToSelector())
  {
    v6 = [v14 balloonView];
    if (objc_opt_respondsToSelector())
    {
      v7 = [v14 isReplyContextPreview] ^ 1;
    }

    else
    {
      v7 = 1;
    }

    v8 = [v6 interactions];
    v9 = [v8 containsObject:*(a1 + 32)];

    if (v9 && v7)
    {
      v10 = [*(a1 + 40) collectionView];
      v11 = [v10 indexPathForCell:v14];
      v12 = *(*(a1 + 48) + 8);
      v13 = *(v12 + 40);
      *(v12 + 40) = v11;

      objc_storeStrong((*(*(a1 + 56) + 8) + 40), v6);
      *a4 = 1;
    }
  }
}

- (id)_itemProvidersFromDragItems:(id)items
{
  v18 = *MEMORY[0x1E69E9840];
  itemsCopy = items;
  v4 = objc_alloc_init(MEMORY[0x1E695DF70]);
  v13 = 0u;
  v14 = 0u;
  v15 = 0u;
  v16 = 0u;
  v5 = itemsCopy;
  v6 = [v5 countByEnumeratingWithState:&v13 objects:v17 count:16];
  if (v6)
  {
    v7 = v6;
    v8 = *v14;
    do
    {
      for (i = 0; i != v7; ++i)
      {
        if (*v14 != v8)
        {
          objc_enumerationMutation(v5);
        }

        itemProvider = [*(*(&v13 + 1) + 8 * i) itemProvider];
        [v4 addObject:itemProvider];
      }

      v7 = [v5 countByEnumeratingWithState:&v13 objects:v17 count:16];
    }

    while (v7);
  }

  v11 = [v4 copy];

  return v11;
}

- (id)_dragItemsFromChatItem:(id)item balloonView:(id)view
{
  v25[1] = *MEMORY[0x1E69E9840];
  itemCopy = item;
  viewCopy = view;
  objc_opt_class();
  if ((objc_opt_isKindOfClass() & 1) == 0)
  {
    array = [MEMORY[0x1E695DEC8] array];
    goto LABEL_21;
  }

  objc_opt_class();
  if (objc_opt_isKindOfClass())
  {
    collectionViewController = [(CKCoreChatController *)self collectionViewController];
    v9 = [collectionViewController balloonViewForChatItem:itemCopy];

    objc_opt_class();
    isKindOfClass = objc_opt_isKindOfClass();
    if (isKindOfClass)
    {
      currentAssetChatItem = [v9 currentAssetChatItem];
      dragItemProvider = [currentAssetChatItem dragItemProvider];
    }

    else
    {
      dragItemProvider = 0;
    }

    v18 = isKindOfClass ^ 1;

    if (dragItemProvider)
    {
LABEL_12:
      v19 = [objc_alloc(MEMORY[0x1E69DC990]) initWithItemProvider:dragItemProvider];
      [v19 setLocalObject:viewCopy];
      if (v18)
      {
        objc_initWeak(&location, self);
        v21[0] = MEMORY[0x1E69E9820];
        v21[1] = 3221225472;
        v21[2] = __55__CKChatController__dragItemsFromChatItem_balloonView___block_invoke_2;
        v21[3] = &unk_1E72EE438;
        objc_copyWeak(&v23, &location);
        v22 = viewCopy;
        [v19 setPreviewProvider:v21];

        objc_destroyWeak(&v23);
        objc_destroyWeak(&location);
      }

      v25[0] = v19;
      array = [MEMORY[0x1E695DEC8] arrayWithObjects:v25 count:1];

      goto LABEL_20;
    }
  }

  else
  {
    objc_opt_class();
    if (objc_opt_isKindOfClass())
    {
      v14 = itemCopy;
      mEMORY[0x1E69A5B80] = [MEMORY[0x1E69A5B80] sharedInstance];
      transferGUID = [v14 transferGUID];
      v17 = [mEMORY[0x1E69A5B80] transferForGUID:transferGUID];

      if ([v17 commSafetySensitive])
      {

        array = 0;
        goto LABEL_21;
      }

      dragItemProvider = [v14 dragItemProvider];
      if ([viewCopy isAudioMessage])
      {
        [dragItemProvider registerItemForTypeIdentifier:@"com.apple.messages.audioMessage" loadHandler:&__block_literal_global_1664];
      }
    }

    else
    {
      dragItemProvider = [itemCopy dragItemProvider];
    }

    v18 = 1;
    if (dragItemProvider)
    {
      goto LABEL_12;
    }
  }

  array = 0;
LABEL_20:

LABEL_21:

  return array;
}

void __55__CKChatController__dragItemsFromChatItem_balloonView___block_invoke(uint64_t a1, void (**a2)(void, void, void))
{
  v3 = MEMORY[0x1E695DEF0];
  v4 = a2;
  v5 = [v3 data];
  (a2)[2](v4, v5, 0);
}

id __55__CKChatController__dragItemsFromChatItem_balloonView___block_invoke_2(uint64_t a1)
{
  WeakRetained = objc_loadWeakRetained((a1 + 40));

  if (WeakRetained)
  {
    v3 = objc_loadWeakRetained((a1 + 40));
    v4 = [v3 dragPreviewParametersForBalloonView:*(a1 + 32)];

    objc_opt_class();
    if ((objc_opt_isKindOfClass() & 1) != 0 && [*(a1 + 32) shouldProvideDragPreview])
    {
      v5 = [*(a1 + 32) attachmentBalloonViewPreview];
      v6 = v5;
      if (!v5)
      {
        v6 = *(a1 + 32);
      }

      v7 = v6;

      v8 = [objc_alloc(MEMORY[0x1E69DC998]) initWithView:v7 parameters:v4];
    }

    else
    {
      v8 = [objc_alloc(MEMORY[0x1E69DC998]) initWithView:*(a1 + 32) parameters:v4];
    }
  }

  else
  {
    v8 = 0;
  }

  return v8;
}

- (id)dragPreviewParametersForBalloonView:(id)view
{
  viewCopy = view;
  v4 = objc_alloc_init(MEMORY[0x1E69DC9A0]);
  bezierPathForDragPreview = [viewCopy bezierPathForDragPreview];
  if (bezierPathForDragPreview)
  {
    [v4 setVisiblePath:bezierPathForDragPreview];
    [v4 setShadowPath:bezierPathForDragPreview];
  }

  else
  {
    v6 = IMLogHandleForCategory();
    if (os_log_type_enabled(v6, OS_LOG_TYPE_ERROR))
    {
      [CKChatController dragPreviewParametersForBalloonView:];
    }
  }

  return v4;
}

- (BOOL)dropInteraction:(id)interaction canHandleSession:(id)session
{
  v38 = *MEMORY[0x1E69E9840];
  sessionCopy = session;
  v32 = 0u;
  v33 = 0u;
  v34 = 0u;
  v35 = 0u;
  items = [sessionCopy items];
  v7 = [items countByEnumeratingWithState:&v32 objects:v37 count:16];
  if (v7)
  {
    v8 = v7;
    v9 = *v33;
LABEL_3:
    v10 = 0;
    while (1)
    {
      if (*v33 != v9)
      {
        objc_enumerationMutation(items);
      }

      itemProvider = [*(*(&v32 + 1) + 8 * v10) itemProvider];
      v12 = [itemProvider hasItemConformingToTypeIdentifier:@"com.apple.messages.audioMessage"];

      if (v12)
      {
        goto LABEL_27;
      }

      if (v8 == ++v10)
      {
        v8 = [items countByEnumeratingWithState:&v32 objects:v37 count:16];
        if (v8)
        {
          goto LABEL_3;
        }

        break;
      }
    }
  }

  mEMORY[0x1E69A8070] = [MEMORY[0x1E69A8070] sharedFeatureFlags];
  isStickerRepositioningEnabled = [mEMORY[0x1E69A8070] isStickerRepositioningEnabled];

  if (isStickerRepositioningEnabled)
  {
    v30 = 0u;
    v31 = 0u;
    v28 = 0u;
    v29 = 0u;
    items = [sessionCopy items];
    v15 = [items countByEnumeratingWithState:&v28 objects:v36 count:16];
    if (v15)
    {
      v16 = v15;
      v17 = *v29;
LABEL_12:
      v18 = 0;
      while (1)
      {
        if (*v29 != v17)
        {
          objc_enumerationMutation(items);
        }

        if ([MEMORY[0x1E69A82C0] dragItemIsRepositioningSticker:*(*(&v28 + 1) + 8 * v18)])
        {
          break;
        }

        if (v16 == ++v18)
        {
          v16 = [items countByEnumeratingWithState:&v28 objects:v36 count:16];
          if (v16)
          {
            goto LABEL_12;
          }

          goto LABEL_18;
        }
      }

LABEL_27:
      v26 = 1;
      goto LABEL_32;
    }

LABEL_18:
  }

  items = [sessionCopy localDragSession];
  dragSession = [(CKChatController *)self dragSession];

  localContext = [items localContext];
  objc_opt_class();
  if (objc_opt_isKindOfClass())
  {
    v21 = localContext;
  }

  else
  {
    v21 = 0;
  }

  v22 = v21;
  v23 = [v22 isEqualToString:@"CKConversationListDragContext"];
  v24 = [v22 isEqualToString:@"CKMessageEntryContentViewDragContext"];

  if (items && (items == dragSession) | v23 & 1 | v24 & 1)
  {
    v25 = IMLogHandleForCategory();
    if (os_log_type_enabled(v25, OS_LOG_TYPE_DEBUG))
    {
      [CKChatController dropInteraction:canHandleSession:];
    }

    v26 = 0;
  }

  else
  {
    v25 = IMLogHandleForCategory();
    if (os_log_type_enabled(v25, OS_LOG_TYPE_DEBUG))
    {
      [CKChatController dropInteraction:canHandleSession:];
    }

    v26 = 1;
  }

LABEL_32:
  return v26;
}

- (void)dropInteraction:(id)interaction sessionDidEnter:(id)enter
{
  enterCopy = enter;
  dropSession = [(CKChatController *)self dropSession];

  v7 = IMLogHandleForCategory();
  v8 = os_log_type_enabled(v7, OS_LOG_TYPE_DEBUG);
  if (dropSession == enterCopy)
  {
    if (v8)
    {
      [CKChatController dropInteraction:sessionDidEnter:];
    }
  }

  else
  {
    if (v8)
    {
      [CKChatController dropInteraction:sessionDidEnter:];
    }

    [(CKChatController *)self setDropSession:enterCopy];
    [(CKCoreChatController *)self _updateTranscriptDockingStateIfNeeded];
  }
}

- (id)dropInteraction:(id)interaction sessionDidUpdate:(id)update
{
  interactionCopy = interaction;
  updateCopy = update;
  entryView = [(CKChatController *)self entryView];
  if ([entryView displayMode] == 2)
  {

LABEL_4:
    v11 = [objc_alloc(MEMORY[0x1E69DC9C0]) initWithDropOperation:0];
    goto LABEL_5;
  }

  entryView2 = [(CKChatController *)self entryView];
  displayMode = [entryView2 displayMode];

  if (displayMode == 3)
  {
    goto LABEL_4;
  }

  entryView3 = [(CKChatController *)self entryView];
  window = [entryView3 window];

  if (window)
  {
    v11 = [objc_alloc(MEMORY[0x1E69DC9C0]) initWithDropOperation:2];
    v12 = 1;
    goto LABEL_6;
  }

  if (IMOSLoggingEnabled())
  {
    v32 = OSLogHandleForIMFoundationCategory();
    if (os_log_type_enabled(v32, OS_LOG_TYPE_INFO))
    {
      *v34 = 0;
      _os_log_impl(&dword_19020E000, v32, OS_LOG_TYPE_INFO, "Drop proposal is forbidden because the entry view is not in a window. UIDragPreviewTarget requires that its container (the entry view in this case) be in a window.", v34, 2u);
    }
  }

  v11 = [objc_alloc(MEMORY[0x1E69DC9C0]) initWithDropOperation:1];
  v33 = IMLogHandleForCategory();
  if (os_log_type_enabled(v33, OS_LOG_TYPE_DEBUG))
  {
    [CKChatController dropInteraction:sessionDidUpdate:];
  }

LABEL_5:
  v12 = 0;
LABEL_6:
  if (!-[CKChatController _dropSessionIsNewSticker:](self, "_dropSessionIsNewSticker:", updateCopy) && ![MEMORY[0x1E69A82C0] dropSessionIsRepositioningSticker:updateCopy])
  {
    v19 = v11;
    goto LABEL_31;
  }

  v13 = [(CKChatController *)self _selectedBalloonFromTouchForDropSession:updateCopy];
  if (v13)
  {
    collectionViewController = [(CKCoreChatController *)self collectionViewController];
    chatItems = [collectionViewController chatItems];
    v16 = [chatItems objectAtIndex:{objc_msgSend(v13, "row")}];

    if (([v16 canAttachStickers] & 1) == 0)
    {
      v17 = IMLogHandleForCategory();
      if (os_log_type_enabled(v17, OS_LOG_TYPE_DEBUG))
      {
        [CKChatController dropInteraction:sessionDidUpdate:];
      }

      v18 = [objc_alloc(MEMORY[0x1E69DC9C0]) initWithDropOperation:1];
      v12 = 0;
      v11 = v18;
    }

    v19 = v11;

    v11 = collectionViewController;
  }

  else
  {
    v20 = IMLogHandleForCategory();
    if (os_log_type_enabled(v20, OS_LOG_TYPE_DEBUG))
    {
      [CKChatController dropInteraction:sessionDidUpdate:];
    }

    v19 = [objc_alloc(MEMORY[0x1E69DC9C0]) initWithDropOperation:1];
  }

  mEMORY[0x1E69A8070] = [MEMORY[0x1E69A8070] sharedFeatureFlags];
  isStickerRepositioningEnabled = [mEMORY[0x1E69A8070] isStickerRepositioningEnabled];

  if (!isStickerRepositioningEnabled)
  {
    [v19 _setPreferredBadgeStyle:1];

    if (!v12)
    {
      goto LABEL_31;
    }

    goto LABEL_27;
  }

  v23 = [(CKChatController *)self _originalIndexPathForRepositioningDropSession:updateCopy];
  if (v23)
  {
    section = [v13 section];
    if (section != [v23 section] || (v25 = objc_msgSend(v13, "item"), v25 != objc_msgSend(v23, "item")))
    {
      v26 = IMLogHandleForCategory();
      if (os_log_type_enabled(v26, OS_LOG_TYPE_ERROR))
      {
        [CKChatController dropInteraction:sessionDidUpdate:];
      }

      v27 = [objc_alloc(MEMORY[0x1E69DC9C0]) initWithDropOperation:1];
      [(CKChatController *)self _clearBalloonViewOverlaysWithAnimation:1];
      LOBYTE(v12) = 0;
      v19 = v27;
    }
  }

  [v19 _setPreferredBadgeStyle:1];
  if (v12)
  {
LABEL_27:
    v28 = [(CKChatController *)self _selectedBalloonFromTouchForDropSession:updateCopy];
    [(CKChatController *)self _setOverlayForBalloonViewAtIndexPath:v28 animated:1];
  }

LABEL_31:

  return v19;
}

- (void)dropInteraction:(id)interaction performDrop:(id)drop
{
  dropCopy = drop;
  v6 = IMLogHandleForCategory();
  if (os_log_type_enabled(v6, OS_LOG_TYPE_DEBUG))
  {
    [CKChatController dropInteraction:performDrop:];
  }

  if (-[CKChatController _dropSessionIsNewSticker:](self, "_dropSessionIsNewSticker:", dropCopy) || [MEMORY[0x1E69A82C0] dropSessionIsRepositioningSticker:dropCopy] && (objc_msgSend(MEMORY[0x1E69A8070], "sharedFeatureFlags"), v7 = objc_claimAutoreleasedReturnValue(), v8 = objc_msgSend(v7, "isStickerRepositioningEnabled"), v7, v8))
  {
    [(CKChatController *)self _sendNewStickerFromDropSession:dropCopy];
  }

  else
  {
    items = [dropCopy items];
    v10 = [(CKChatController *)self _itemProvidersFromDragItems:items];

    v11 = IMLogHandleForCategory();
    if (os_log_type_enabled(v11, OS_LOG_TYPE_DEBUG))
    {
      [CKChatController dropInteraction:v10 performDrop:?];
    }

    if ([v10 count])
    {
      [(CKChatController *)self appendCompositionFromItemProviders:v10];
    }
  }
}

- (void)dropInteraction:(id)interaction item:(id)item willAnimateDropWithAnimator:(id)animator
{
  animatorCopy = animator;
  v7 = IMLogHandleForCategory();
  if (os_log_type_enabled(v7, OS_LOG_TYPE_DEBUG))
  {
    [CKChatController dropInteraction:item:willAnimateDropWithAnimator:];
  }

  v10[0] = MEMORY[0x1E69E9820];
  v10[1] = 3221225472;
  v10[2] = __69__CKChatController_dropInteraction_item_willAnimateDropWithAnimator___block_invoke;
  v10[3] = &unk_1E72EBA18;
  v10[4] = self;
  [animatorCopy addAnimations:v10];
  collectionView = [(CKChatController *)self collectionView];
  [collectionView setScrollEnabled:0];

  v9[0] = MEMORY[0x1E69E9820];
  v9[1] = 3221225472;
  v9[2] = __69__CKChatController_dropInteraction_item_willAnimateDropWithAnimator___block_invoke_2;
  v9[3] = &unk_1E72ED838;
  v9[4] = self;
  [animatorCopy addCompletion:v9];
}

void __69__CKChatController_dropInteraction_item_willAnimateDropWithAnimator___block_invoke_2(uint64_t a1)
{
  v1 = [*(a1 + 32) collectionView];
  [v1 setScrollEnabled:1];

  v2 = IMLogHandleForCategory();
  if (os_log_type_enabled(v2, OS_LOG_TYPE_DEBUG))
  {
    __69__CKChatController_dropInteraction_item_willAnimateDropWithAnimator___block_invoke_2_cold_1();
  }
}

- (void)dropInteraction:(id)interaction concludeDrop:(id)drop
{
  v4 = IMLogHandleForCategory();
  if (os_log_type_enabled(v4, OS_LOG_TYPE_DEBUG))
  {
    [CKChatController dropInteraction:concludeDrop:];
  }
}

- (void)dropInteraction:(id)interaction sessionDidEnd:(id)end
{
  v5 = IMLogHandleForCategory();
  if (os_log_type_enabled(v5, OS_LOG_TYPE_DEBUG))
  {
    [CKChatController dropInteraction:sessionDidEnd:];
  }

  [(CKChatController *)self setDropSession:0];
  inputController = [(CKCoreChatController *)self inputController];
  [inputController stickerDropAnimationFinished];

  [(CKCoreChatController *)self _updateTranscriptDockingStateIfNeeded];
}

- (id)dropInteraction:(id)interaction previewForDroppingItem:(id)item withDefault:(id)default
{
  interactionCopy = interaction;
  itemCopy = item;
  defaultCopy = default;
  v11 = IMLogHandleForCategory();
  if (os_log_type_enabled(v11, OS_LOG_TYPE_DEBUG))
  {
    [CKChatController dropInteraction:previewForDroppingItem:withDefault:];
  }

  if ([MEMORY[0x1E69A82C0] dragItemIsSticker:itemCopy] || (objc_msgSend(MEMORY[0x1E69A8070], "sharedFeatureFlags"), v13 = objc_claimAutoreleasedReturnValue(), v14 = objc_msgSend(v13, "isStickerRepositioningEnabled"), v13, v14) && objc_msgSend(MEMORY[0x1E69A82C0], "dragItemIsRepositioningSticker:", itemCopy))
  {
    v12 = [(CKChatController *)self _stickerDragPreviewForDragItem:itemCopy defaultPreview:defaultCopy];
  }

  else
  {
    entryView = [(CKChatController *)self entryView];
    window = [entryView window];

    if (window)
    {
      dropSession = [(CKChatController *)self dropSession];
      view = [(CKChatController *)self view];
      [dropSession locationInView:view];
      v20 = v19;
      v22 = v21;

      v23 = IMLogHandleForCategory();
      if (os_log_type_enabled(v23, OS_LOG_TYPE_DEBUG))
      {
        [CKChatController dropInteraction:previewForDroppingItem:withDefault:];
      }

      v24 = objc_alloc(MEMORY[0x1E69DC9A8]);
      CGAffineTransformMakeScale(&v29, 0.00000011920929, 0.00000011920929);
      v25 = [v24 initWithContainer:entryView center:&v29 transform:{v20, v22}];
      v12 = [defaultCopy retargetedPreviewWithTarget:v25];
    }

    else
    {
      if (IMOSLoggingEnabled())
      {
        v26 = OSLogHandleForIMFoundationCategory();
        if (os_log_type_enabled(v26, OS_LOG_TYPE_INFO))
        {
          LOWORD(v29.a) = 0;
          _os_log_impl(&dword_19020E000, v26, OS_LOG_TYPE_INFO, "Drop preview generation failed because the entry view is not in a window. UIDragPreviewTarget requires that its container (the entry view in this case) be in a window.", &v29, 2u);
        }
      }

      v12 = 0;
    }

    v27 = IMLogHandleForCategory();
    if (os_log_type_enabled(v27, OS_LOG_TYPE_DEBUG))
    {
      [CKChatController dropInteraction:previewForDroppingItem:withDefault:];
    }
  }

  return v12;
}

- (BOOL)_dropSessionIsTargetingEntryView:(id)view
{
  viewCopy = view;
  entryView = [(CKChatController *)self entryView];
  contentView = [entryView contentView];
  textView = [contentView textView];

  [viewCopy locationInView:textView];
  v9 = v8;
  v11 = v10;

  [textView bounds];
  v13.x = v9;
  v13.y = v11;
  LOBYTE(entryView) = CGRectContainsPoint(v14, v13);

  return entryView;
}

- (void)_clearBalloonViewOverlaysWithAnimation:(BOOL)animation
{
  collectionViewController = [(CKCoreChatController *)self collectionViewController];
  collectionView = [collectionViewController collectionView];

  visibleCells = [collectionView visibleCells];
  v7[0] = MEMORY[0x1E69E9820];
  v7[1] = 3221225472;
  v7[2] = __59__CKChatController__clearBalloonViewOverlaysWithAnimation___block_invoke;
  v7[3] = &__block_descriptor_33_e63_v32__0__UICollectionViewCell_CKTranscriptCellProtocol__8Q16_B24l;
  animationCopy = animation;
  [visibleCells enumerateObjectsUsingBlock:v7];
}

void __59__CKChatController__clearBalloonViewOverlaysWithAnimation___block_invoke(uint64_t a1, void *a2)
{
  v4 = a2;
  if (objc_opt_respondsToSelector())
  {
    v3 = [v4 balloonView];
    [v3 setHasHighlightOverlay:0 animated:*(a1 + 32) autoDismiss:0];
  }
}

- (void)_setOverlayForBalloonViewAtIndexPath:(id)path animated:(BOOL)animated
{
  pathCopy = path;
  collectionViewController = [(CKCoreChatController *)self collectionViewController];
  collectionView = [collectionViewController collectionView];

  visibleCells = [collectionView visibleCells];
  v12[0] = MEMORY[0x1E69E9820];
  v12[1] = 3221225472;
  v12[2] = __66__CKChatController__setOverlayForBalloonViewAtIndexPath_animated___block_invoke;
  v12[3] = &unk_1E72EE480;
  v13 = collectionView;
  v14 = pathCopy;
  animatedCopy = animated;
  v10 = pathCopy;
  v11 = collectionView;
  [visibleCells enumerateObjectsUsingBlock:v12];
}

void __66__CKChatController__setOverlayForBalloonViewAtIndexPath_animated___block_invoke(uint64_t a1, void *a2)
{
  v10 = a2;
  v3 = objc_opt_respondsToSelector();
  v4 = v10;
  if (v3)
  {
    v5 = v10;
    v6 = [*(a1 + 32) indexPathForCell:v5];
    v7 = *(a1 + 40);
    if (v7)
    {
      v8 = [v7 isEqual:v6];
    }

    else
    {
      v8 = 0;
    }

    v9 = [v5 balloonView];
    [v9 setHasHighlightOverlay:v8 animated:*(a1 + 48) autoDismiss:0];

    v4 = v10;
  }
}

- (void)detailsAdapter:(id)adapter wantsToStageComposition:(id)composition
{
  compositionCopy = composition;
  [(CKChatController *)self _detailsAdapterWantsDismiss:adapter];
  [(CKChatController *)self setComposition:compositionCopy];
}

- (void)_detailsAdapterWantsDismiss:(id)dismiss
{
  detailsController = [dismiss detailsController];
  if (CKIsRunningInMacCatalyst())
  {
    delegate = [(CKCoreChatController *)self delegate];
    if (objc_opt_respondsToSelector())
    {
      delegate2 = [(CKCoreChatController *)self delegate];
      if ([delegate2 hasDetailsNavigationController])
      {
        delegate3 = [(CKCoreChatController *)self delegate];
        v7 = objc_opt_respondsToSelector();

        v8 = detailsController;
        if ((v7 & 1) == 0)
        {
          goto LABEL_13;
        }

        delegate4 = [(CKCoreChatController *)self delegate];
        [delegate4 dismissDetailsNavigationController];

        goto LABEL_12;
      }
    }

    goto LABEL_11;
  }

  v8 = detailsController;
  if (!detailsController)
  {
    goto LABEL_13;
  }

  delegate = [(CKChatController *)self presentedViewController];
  objc_opt_class();
  if ((objc_opt_isKindOfClass() & 1) == 0)
  {
LABEL_11:

    goto LABEL_12;
  }

  presentedViewController = [(CKChatController *)self presentedViewController];
  viewControllers = [presentedViewController viewControllers];
  v12 = [viewControllers containsObject:detailsController];

  v8 = detailsController;
  if (!v12)
  {
    goto LABEL_13;
  }

  [(CKChatController *)self dismissDetailsControllerAnimated:1];
LABEL_12:
  v8 = detailsController;
LABEL_13:
}

- (void)detailsAdapter:(id)adapter shouldComposeConversationWithRecipientAddresses:(id)addresses
{
  addressesCopy = addresses;
  detailsController = [adapter detailsController];
  if (CKIsRunningInMacCatalyst())
  {
    delegate = [(CKCoreChatController *)self delegate];
    if (objc_opt_respondsToSelector())
    {
      delegate2 = [(CKCoreChatController *)self delegate];
      if ([delegate2 hasDetailsNavigationController])
      {
        delegate3 = [(CKCoreChatController *)self delegate];
        v10 = objc_opt_respondsToSelector();

        if ((v10 & 1) == 0)
        {
          goto LABEL_12;
        }

        delegate = [(CKCoreChatController *)self delegate];
        [delegate dismissDetailsNavigationController];
      }

      else
      {
      }
    }

LABEL_11:

    goto LABEL_12;
  }

  if (!detailsController)
  {
    goto LABEL_12;
  }

  delegate = [(CKChatController *)self presentedViewController];
  objc_opt_class();
  if ((objc_opt_isKindOfClass() & 1) == 0)
  {
    goto LABEL_11;
  }

  presentedViewController = [(CKChatController *)self presentedViewController];
  viewControllers = [presentedViewController viewControllers];
  v13 = [viewControllers containsObject:detailsController];

  if (v13)
  {
    [(CKChatController *)self dismissDetailsControllerAnimated:1];
  }

LABEL_12:
  delegate4 = [(CKCoreChatController *)self delegate];
  v15 = objc_opt_respondsToSelector();

  if (v15)
  {
    delegate5 = [(CKCoreChatController *)self delegate];
    [delegate5 chatController:self shouldComposeConversationWithRecipientAddresses:addressesCopy];
  }
}

- (id)presentingViewControllerForAlertsFromDetailsAdapter:(id)adapter
{
  if (CKIsRunningInMacCatalyst())
  {
    selfCopy = self;
  }

  else
  {
    selfCopy = 0;
  }

  return selfCopy;
}

- (BOOL)transcriptCollectionViewControllerShouldSuppressDockingBehavior:(id)behavior
{
  behaviorCopy = behavior;
  if ([(CKScrollViewController *)self isKeyboardVisible])
  {
    collectionView = [behaviorCopy collectionView];
    [collectionView contentSize];
    v6 = [(CKCoreChatController *)self _transcriptContentSizeEligibleForTranscriptDocking:?];
  }

  else
  {
    v6 = 0;
  }

  return v6;
}

- (void)detailsAdapterWantsToPresentKTContactVerificationUI:(id)i
{
  conversation = [(CKCoreChatController *)self conversation];
  [CKKeyTransparencyErrorUtilities showKTContactVerificationUIForConversation:conversation fromViewController:self];
}

- (void)detailsAdapterWillDismiss:(id)dismiss
{
  v3 = +[CKLinkIntentsManager sharedManager];
  [v3 purgeDependencies];
}

- (void)detailsAdapterDidDismiss:(id)dismiss
{
  conversation = [(CKCoreChatController *)self conversation];
  chat = [conversation chat];
  [chat fetchKTStatus];

  if ([(CKChatController *)self _shouldRestoreFirstResponderAfterDetailsViewDismiss])
  {

    [(CKChatController *)self becomeFirstResponder];
  }
}

- (void)dismissDetailsNavigationControllerWithCompletion:(id)completion
{
  completionCopy = completion;
  delegate = [(CKCoreChatController *)self delegate];
  v5 = objc_opt_respondsToSelector();

  if (v5)
  {
    delegate2 = [(CKCoreChatController *)self delegate];
    [delegate2 dismissDetailsNavigationControllerWithCompletion:completionCopy];
  }
}

- (void)dismissDetailsViewAndShowConversationListWithCompletion:(id)completion
{
  completionCopy = completion;
  delegate = [(CKCoreChatController *)self delegate];
  [delegate dismissDetailsViewAndShowConversationListWithCompletion:completionCopy];
}

- (BOOL)isDetailsNavigationControllerDetached
{
  delegate = [(CKCoreChatController *)self delegate];
  isDetailsNavigationControllerDetached = [delegate isDetailsNavigationControllerDetached];

  return isDetailsNavigationControllerDetached;
}

- (BOOL)_shouldRestoreFirstResponderAfterDetailsViewDismiss
{
  conversation = [(CKCoreChatController *)self conversation];
  hasLeftGroupChat = [conversation hasLeftGroupChat];
  isReadOnly = [(CKCoreChatController *)self isReadOnly];
  isBusinessChatDisabled = [conversation isBusinessChatDisabled];
  isFirstResponder = [(CKChatController *)self isFirstResponder];
  entryView = [(CKChatController *)self entryView];
  contentView = [entryView contentView];
  isActive = [contentView isActive];

  return (((hasLeftGroupChat | isFirstResponder | isActive) | (isBusinessChatDisabled | isReadOnly)) & 1) == 0;
}

- (void)keyTransparencyConversationViewControllerDidComplete:(id)complete
{
  conversation = [(CKCoreChatController *)self conversation];
  chat = [conversation chat];
  [chat fetchKTStatus];

  [(CKChatController *)self dismissViewControllerAnimated:1 completion:&__block_literal_global_1686];
}

- (void)showModalInlineReplyControllerForChatItem:(id)item fromViewController:(id)controller
{
  controllerCopy = controller;
  v6 = [(CKChatController *)self modalInlineReplyControllerForChatItem:item];
  if (v6)
  {
    [controllerCopy presentViewController:v6 animated:1 completion:0];
  }
}

- (id)modalInlineReplyControllerForChatItem:(id)item
{
  v25 = *MEMORY[0x1E69E9840];
  itemCopy = item;
  inlineReplyController = [(CKChatController *)self inlineReplyController];
  if (inlineReplyController)
  {

LABEL_4:
    if (!IMOSLoggingEnabled())
    {
LABEL_8:
      v7 = 0;
      goto LABEL_9;
    }

    v6 = OSLogHandleForIMFoundationCategory();
    if (os_log_type_enabled(v6, OS_LOG_TYPE_INFO))
    {
      LOWORD(v21) = 0;
      _os_log_impl(&dword_19020E000, v6, OS_LOG_TYPE_INFO, "Inline reply controller already presented/presenting, bailing!", &v21, 2u);
    }

LABEL_7:

    goto LABEL_8;
  }

  objc_opt_class();
  if (objc_opt_isKindOfClass())
  {
    goto LABEL_4;
  }

  objc_opt_class();
  if ((objc_opt_isKindOfClass() & 1) == 0)
  {
    if (!IMOSLoggingEnabled())
    {
      goto LABEL_8;
    }

    v6 = OSLogHandleForIMFoundationCategory();
    if (os_log_type_enabled(v6, OS_LOG_TYPE_INFO))
    {
      LOWORD(v21) = 0;
      _os_log_impl(&dword_19020E000, v6, OS_LOG_TYPE_INFO, "Grid asked to present non-message part item, bailing", &v21, 2u);
    }

    goto LABEL_7;
  }

  v9 = itemCopy;
  v10 = [CKUtilities threadIdentifierForMessagePart:v9];
  v11 = [CKUtilities threadOriginatorForMessagePart:v9];
  v12 = [MEMORY[0x1E69A5AE0] configureMessageSummaryInfoForChatItem:v9];
  message = [v9 message];
  guid = [message guid];

  if (IMOSLoggingEnabled())
  {
    v15 = OSLogHandleForIMFoundationCategory();
    if (os_log_type_enabled(v15, OS_LOG_TYPE_INFO))
    {
      v21 = 138412546;
      v22 = v10;
      v23 = 2112;
      v24 = v11;
      _os_log_impl(&dword_19020E000, v15, OS_LOG_TYPE_INFO, "Creating reply modal for grid with thread identifier %@ originator %@", &v21, 0x16u);
    }
  }

  chat = [(CKCoreChatController *)self chat];
  [chat loadInlineRepliesForThreadIdentifier:v10 threadOriginator:v11 messageGuid:guid];

  _transcriptOverlayTransitionContextForModalPresentation = [(CKChatController *)self _transcriptOverlayTransitionContextForModalPresentation];
  v18 = [CKInlineReplyChatController alloc];
  conversation = [(CKCoreChatController *)self conversation];
  v20 = [(CKInlineReplyChatController *)v18 initWithConversation:conversation threadIdentifier:v10 threadOriginator:v11 transitionContext:_transcriptOverlayTransitionContextForModalPresentation originatorMessageSummaryInfo:v12 parentChatController:self];

  [(CKChatController *)v20 setSendMenuDelegate:self];
  v7 = [objc_alloc(MEMORY[0x1E69DCCD8]) initWithRootViewController:v20];
  [v7 setModalPresentationStyle:6];
  if (CKIsRunningInMacCatalyst())
  {
    [v7 setNavigationBarHidden:1];
  }

LABEL_9:

  return v7;
}

- (void)showInlineReplyControllerForChatItem:(id)item presentKeyboard:(BOOL)keyboard
{
  keyboardCopy = keyboard;
  itemCopy = item;
  v7 = +[CKInlineReplyTransitionProperties defaultProperties];
  [(CKChatController *)self showInlineReplyControllerForChatItem:itemCopy presentKeyboard:keyboardCopy replyTransitionProperties:v7];
}

- (void)showInlineReplyControllerForChatItem:(id)item presentKeyboard:(BOOL)keyboard replyTransitionProperties:(id)properties
{
  keyboardCopy = keyboard;
  v55 = *MEMORY[0x1E69E9840];
  itemCopy = item;
  propertiesCopy = properties;
  collectionView = [(CKChatController *)self collectionView];
  [collectionView _setHiddenPocketEdges:15];

  inlineReplyController = [(CKChatController *)self inlineReplyController];
  if (inlineReplyController)
  {
  }

  else
  {
    objc_opt_class();
    if ((objc_opt_isKindOfClass() & 1) == 0)
    {
      goto LABEL_6;
    }
  }

  if (!CKIsRunningInMacCatalyst())
  {
    if (IMOSLoggingEnabled())
    {
      v22 = OSLogHandleForIMFoundationCategory();
      if (os_log_type_enabled(v22, OS_LOG_TYPE_INFO))
      {
        *buf = 0;
        _os_log_impl(&dword_19020E000, v22, OS_LOG_TYPE_INFO, "Inline reply controller already presented/presenting, bailing!", buf, 2u);
      }
    }

    goto LABEL_37;
  }

  [(CKChatController *)self dismissInlineReplyController:0];
LABEL_6:
  if ([itemCopy canInlineReply])
  {
    objc_opt_class();
    if (objc_opt_isKindOfClass())
    {
      [(CKScrollViewController *)self beginHoldingScrollGeometryUpdatesForReason:@"MainTranscriptWhileInlineReplyControllerVisible"];
      collectionView2 = [(CKChatController *)self collectionView];
      [collectionView2 setScrollEnabled:0];

      collectionView3 = [(CKChatController *)self collectionView];
      [collectionView3 endHoldingContentOffsetUpdatesForAllReasons];

      mEMORY[0x1E69A8070] = [MEMORY[0x1E69A8070] sharedFeatureFlags];
      isExpressiveTextEnabled = [mEMORY[0x1E69A8070] isExpressiveTextEnabled];

      if (isExpressiveTextEnabled)
      {
        collectionViewController = [(CKCoreChatController *)self collectionViewController];
        [collectionViewController updateTextEffectsState:&__block_literal_global_1691];
      }

      if ([itemCopy itemIsReplyContextPreview])
      {
        collectionViewController2 = [(CKCoreChatController *)self collectionViewController];
        chatItems = [collectionViewController2 chatItems];

        for (i = [chatItems indexOfObject:itemCopy]; i < objc_msgSend(chatItems, "count"); ++i)
        {
          v20 = [chatItems objectAtIndex:i];
          if ([v20 itemIsReply])
          {
            goto LABEL_24;
          }
        }

        v20 = 0;
LABEL_24:
      }

      else
      {
        v20 = itemCopy;
      }

      v23 = [(CKChatController *)self _threadIdentifierForMessagePart:v20];
      v50 = [(CKChatController *)self _threadOriginatorForMessagePart:v20];
      v48 = [MEMORY[0x1E69A5AE0] configureMessageSummaryInfoForChatItem:v20];
      message = [v20 message];
      guid = [message guid];

      if (IMOSLoggingEnabled())
      {
        v25 = OSLogHandleForIMFoundationCategory();
        if (os_log_type_enabled(v25, OS_LOG_TYPE_INFO))
        {
          *buf = 138412546;
          v52 = v23;
          v53 = 2112;
          v54 = v50;
          _os_log_impl(&dword_19020E000, v25, OS_LOG_TYPE_INFO, "Creating reply overlay,\n\tthreadIdentifier: %@\n\toriginator: %@", buf, 0x16u);
        }
      }

      chat = [(CKCoreChatController *)self chat];
      [chat loadInlineRepliesForThreadIdentifier:v23 threadOriginator:v50 messageGuid:guid];

      v27 = [(CKChatController *)self _transcriptOverlayTransitionContextForAnchoredMessagePart:v20 threadIdentifier:v23 presentKeyboard:keyboardCopy];
      collaborationNoticeSuggestions = [(CKChatController *)self collaborationNoticeSuggestions];
      [v27 setIsParentChatControllerShowingBanner:{objc_msgSend(collaborationNoticeSuggestions, "count") != 0}];

      [v27 setReplyTransitionProperties:propertiesCopy];
      v29 = [CKInlineReplyChatController alloc];
      conversation = [(CKCoreChatController *)self conversation];
      v31 = [(CKInlineReplyChatController *)v29 initWithConversation:conversation threadIdentifier:v23 threadOriginator:v50 transitionContext:v27 originatorMessageSummaryInfo:v48 parentChatController:self];

      [(CKChatController *)v31 setMessageGUIDForTranscriptExtension:guid];
      [(CKInlineReplyChatController *)v31 setInteractionDelegate:self];
      [(CKInlineReplyChatController *)v31 setTranscriptOverlayTransitionDelegate:self];
      v32 = itemCopy;
      messageItem = [v32 messageItem];
      v34 = [messageItem scheduleType] == 2;

      if (v34)
      {
        inputController = [(CKCoreChatController *)self inputController];
        sendLaterPluginInfo = [inputController sendLaterPluginInfo];

        time = [v32 time];
        [sendLaterPluginInfo setSelectedDate:time];

        entryView = [(CKChatController *)self entryView];
        [entryView setSendLaterPluginInfo:sendLaterPluginInfo animated:0];
      }

      entryView2 = [(CKChatController *)self entryView];
      [(CKChatController *)v31 setEntryView:entryView2];

      [(CKScrollViewController *)self keyboardFrame];
      [(CKScrollViewController *)v31 primeWithKeyboardFrame:?];
      [(CKChatController *)v31 setSendMenuDelegate:self];
      if ([(CKScrollViewController *)self isKeyboardFloating])
      {
        [(CKInlineReplyChatController *)v31 setShouldReloadInsetsForFloatingKeyboard:1];
      }

      entryView3 = [(CKChatController *)self entryView];
      [entryView3 setDelegate:v31];

      entryView4 = [(CKChatController *)self entryView];
      [entryView4 setClickInteractionDelegate:v31];

      inputController2 = [(CKCoreChatController *)self inputController];
      [inputController2 setDelegate:v31];

      [(CKChatController *)self setInlineReplyController:v31];
      [(CKChatController *)self presentTranscriptOverlayViewController:v31];
      traitCollection = [(CKChatController *)self traitCollection];
      v44 = [traitCollection userInterfaceStyle] == 2;

      entryView5 = [(CKChatController *)self entryView];
      v46 = entryView5;
      if (v44)
      {
        v47 = 7;
      }

      else
      {
        v47 = 8;
      }

      [entryView5 setStyle:v47];

      [(CKChatController *)self _hideCatchUpButtonIfNeededAndRemoveOnCompletion:0];
      [(CKCoreChatController *)self removeTapbackBackdropCaptureView];
    }
  }

  else
  {
    v21 = IMLogHandleForCategory();
    if (os_log_type_enabled(v21, OS_LOG_TYPE_ERROR))
    {
      [CKChatController showInlineReplyControllerForChatItem:presentKeyboard:replyTransitionProperties:];
    }
  }

LABEL_37:
}

- (void)showMessageEditingViewControllerForChatItem:(id)item presentKeyboard:(BOOL)keyboard
{
  keyboardCopy = keyboard;
  itemCopy = item;
  tipManager = [(CKChatController *)self tipManager];
  [tipManager undoOrEditMessageUsed];

  if (!CKIsAppCardsEnabled())
  {
    inputController = [(CKCoreChatController *)self inputController];
    [inputController forceDismissBrowserWithoutAnimation];
  }

  [(CKChatController *)self hideAcknowledgmentsAssociatedWithChatItem:itemCopy];
  v18 = [(CKChatController *)self _transcriptOverlayTransitionContextForAnchoredMessagePart:itemCopy threadIdentifier:0 presentKeyboard:keyboardCopy];
  v9 = [CKMessageEditingViewController alloc];
  conversation = [(CKCoreChatController *)self conversation];
  v11 = [(CKMessageEditingViewController *)v9 initWithTransitionContext:v18 conversation:conversation];

  [(CKMessageEditingViewController *)v11 setTranscriptOverlayTransitionDelegate:self];
  [(CKMessageEditingViewController *)v11 setInteractionDelegate:self];
  collectionViewController = [(CKCoreChatController *)self collectionViewController];
  v13 = [collectionViewController balloonViewForChatItem:itemCopy];
  iMChatItem = [itemCopy IMChatItem];

  guid = [iMChatItem guid];

  [v13 frame];
  v17 = [objc_alloc(MEMORY[0x1E69B1828]) initWithEditedMessageGuid:guid editedMessageHeight:v16];
  [collectionViewController setMessageEditingContext:v17];
  [(CKChatController *)self presentTranscriptOverlayViewController:v11];
  [(CKChatController *)self setMessageEditingViewController:v11];
  [(CKChatController *)self _hideCatchUpButtonIfNeededAndRemoveOnCompletion:0];
}

- (void)hideAcknowledgmentsAssociatedWithChatItem:(id)item
{
  itemCopy = item;
  visibleAssociatedMessageChatItems = [itemCopy visibleAssociatedMessageChatItems];
  v5 = [visibleAssociatedMessageChatItems indexOfObjectPassingTest:&__block_literal_global_1696];

  v6 = itemCopy;
  if (v5 != 0x7FFFFFFFFFFFFFFFLL)
  {
    visibleAssociatedMessageChatItems2 = [itemCopy visibleAssociatedMessageChatItems];
    v8 = [visibleAssociatedMessageChatItems2 objectAtIndex:v5];

    collectionViewController = [(CKCoreChatController *)self collectionViewController];
    v10 = [collectionViewController cellForAssociatedChatItem:v8];

    collectionViewController2 = [(CKCoreChatController *)self collectionViewController];
    collectionView = [collectionViewController2 collectionView];
    v13 = [collectionView indexPathForCell:v10];

    if (v13)
    {
      v14 = [MEMORY[0x1E696AC90] indexSetWithIndex:{objc_msgSend(v13, "item")}];
      collectionViewController3 = [(CKCoreChatController *)self collectionViewController];
      [collectionViewController3 setHiddenAssociatedItemsForMessageEditing:v14];
    }

    v6 = itemCopy;
  }
}

uint64_t __62__CKChatController_hideAcknowledgmentsAssociatedWithChatItem___block_invoke(uint64_t a1, void *a2)
{
  v2 = a2;
  objc_opt_class();
  isKindOfClass = objc_opt_isKindOfClass();

  return isKindOfClass & 1;
}

- (void)showAcknowledgmentsAssociatedWithChatItem:(id)item
{
  itemCopy = item;
  visibleAssociatedMessageChatItems = [itemCopy visibleAssociatedMessageChatItems];
  v5 = [visibleAssociatedMessageChatItems indexOfObjectPassingTest:&__block_literal_global_1699];

  v6 = itemCopy;
  if (v5 != 0x7FFFFFFFFFFFFFFFLL)
  {
    visibleAssociatedMessageChatItems2 = [itemCopy visibleAssociatedMessageChatItems];
    v8 = [visibleAssociatedMessageChatItems2 objectAtIndex:v5];

    collectionViewController = [(CKCoreChatController *)self collectionViewController];
    v10 = [collectionViewController cellForAssociatedChatItem:v8];

    collectionViewController2 = [(CKCoreChatController *)self collectionViewController];
    collectionView = [collectionViewController2 collectionView];
    v13 = [collectionView indexPathForCell:v10];

    if (v13)
    {
      collectionViewController3 = [(CKCoreChatController *)self collectionViewController];
      hiddenAssociatedItems = [collectionViewController3 hiddenAssociatedItems];
      v16 = [hiddenAssociatedItems mutableCopy];

      [v16 removeIndex:{objc_msgSend(v13, "item")}];
      collectionViewController4 = [(CKCoreChatController *)self collectionViewController];
      [collectionViewController4 setHiddenAssociatedItemsForMessageEditing:v16];
    }

    v6 = itemCopy;
  }
}

uint64_t __62__CKChatController_showAcknowledgmentsAssociatedWithChatItem___block_invoke(uint64_t a1, void *a2)
{
  v2 = a2;
  objc_opt_class();
  isKindOfClass = objc_opt_isKindOfClass();

  return isKindOfClass & 1;
}

- (void)presentTranscriptOverlayViewController:(id)controller
{
  controllerCopy = controller;
  [(CKChatController *)self addChildViewController:controllerCopy];
  view = [(CKChatController *)self view];
  view2 = [controllerCopy view];
  [view addSubview:view2];

  [controllerCopy didMoveToParentViewController:self];
  v7 = +[CKUIBehavior sharedBehaviors];
  LOBYTE(view) = [v7 isEntryViewInputAccessory];

  if ((view & 1) == 0)
  {
    view3 = [(CKChatController *)self view];
    entryViewContainerView = [(CKChatController *)self entryViewContainerView];
    [view3 bringSubviewToFront:entryViewContainerView];
  }
}

- (id)_transcriptOverlayTransitionContextForAnchoredMessagePart:(id)part threadIdentifier:(id)identifier presentKeyboard:(BOOL)keyboard
{
  keyboardCopy = keyboard;
  partCopy = part;
  v8 = objc_alloc_init(CKTranscriptOverlayTransitionContext);
  iMChatItem = [partCopy IMChatItem];

  guid = [iMChatItem guid];
  [(CKTranscriptOverlayTransitionContext *)v8 setAnchorChatItemGUID:guid];

  _visibleChatItemsToScreenFrameMap = [(CKChatController *)self _visibleChatItemsToScreenFrameMap];
  [(CKTranscriptOverlayTransitionContext *)v8 setVisibleChatItemToFrameMap:_visibleChatItemsToScreenFrameMap];

  if (keyboardCopy)
  {
    [(CKTranscriptOverlayTransitionContext *)v8 setPresentWithKeyboard:1];
  }

  else
  {
    entryView = [(CKChatController *)self entryView];
    contentView = [entryView contentView];
    -[CKTranscriptOverlayTransitionContext setPresentWithKeyboard:](v8, "setPresentWithKeyboard:", [contentView isActive]);
  }

  entryView2 = [(CKChatController *)self entryView];
  contentView2 = [entryView2 contentView];
  -[CKTranscriptOverlayTransitionContext setKeyboardWasUpInMainTranscript:](v8, "setKeyboardWasUpInMainTranscript:", [contentView2 isActive]);

  collectionViewController = [(CKCoreChatController *)self collectionViewController];
  view = [collectionViewController view];
  [view frame];
  [(CKTranscriptOverlayTransitionContext *)v8 setParentCollectionViewFrame:?];

  collectionViewController2 = [(CKCoreChatController *)self collectionViewController];
  [collectionViewController2 marginInsets];
  [(CKTranscriptOverlayTransitionContext *)v8 setTranscriptMarginInsets:?];

  collectionViewController3 = [(CKCoreChatController *)self collectionViewController];
  view2 = [collectionViewController3 view];
  [view2 safeAreaInsets];
  [(CKTranscriptOverlayTransitionContext *)v8 setTranscriptSafeAreaInsets:?];

  if (CKIsRunningInMessagesTranscriptExtension())
  {
    [(CKTranscriptOverlayTransitionContext *)v8 setWantsUnanimatedPresentation:1];
  }

  return v8;
}

- (id)_transcriptOverlayTransitionContextForModalPresentation
{
  v2 = objc_alloc_init(CKTranscriptOverlayTransitionContext);
  [(CKTranscriptOverlayTransitionContext *)v2 setWantsModalPresentation:1];
  [(CKTranscriptOverlayTransitionContext *)v2 setPresentWithKeyboard:1];

  return v2;
}

- (id)_visibleChatItemsToScreenFrameMap
{
  v3 = objc_alloc_init(MEMORY[0x1E695DF90]);
  collectionViewController = [(CKCoreChatController *)self collectionViewController];
  chatItems = [collectionViewController chatItems];
  v15[0] = MEMORY[0x1E69E9820];
  v15[1] = 3221225472;
  v15[2] = __53__CKChatController__visibleChatItemsToScreenFrameMap__block_invoke;
  v15[3] = &unk_1E72EE4E8;
  v15[4] = self;
  v6 = v3;
  v16 = v6;
  [chatItems enumerateObjectsUsingBlock:v15];

  collectionViewController2 = [(CKCoreChatController *)self collectionViewController];
  associatedChatItems = [collectionViewController2 associatedChatItems];
  v13[0] = MEMORY[0x1E69E9820];
  v13[1] = 3221225472;
  v13[2] = __53__CKChatController__visibleChatItemsToScreenFrameMap__block_invoke_2;
  v13[3] = &unk_1E72EE4E8;
  v13[4] = self;
  v9 = v6;
  v14 = v9;
  [associatedChatItems enumerateObjectsUsingBlock:v13];

  v10 = v14;
  v11 = v9;

  return v9;
}

void __53__CKChatController__visibleChatItemsToScreenFrameMap__block_invoke(uint64_t a1, void *a2, uint64_t a3)
{
  v5 = a2;
  v6 = [MEMORY[0x1E696AC88] indexPathForRow:a3 inSection:0];
  v7 = [*(a1 + 32) collectionView];
  v8 = [v7 collectionViewLayout];
  v9 = [v8 layoutAttributesForItemAtIndexPath:v6];

  v10 = [*(a1 + 32) view];
  [v9 frame];
  v12 = v11;
  v14 = v13;
  v16 = v15;
  v18 = v17;
  v19 = [*(a1 + 32) collectionView];
  [v10 convertRect:v19 fromView:{v12, v14, v16, v18}];
  v21 = v20;
  v23 = v22;
  v25 = v24;
  v27 = v26;

  v28 = [v5 IMChatItem];
  v29 = [v28 guid];

  if (v29 && [v5 supportsInlineReplyTransition])
  {
    v30 = *(a1 + 40);
    v32[0] = v21;
    v32[1] = v23;
    v32[2] = v25;
    v32[3] = v27;
    v31 = [MEMORY[0x1E696B098] valueWithBytes:v32 objCType:"{CGRect={CGPoint=dd}{CGSize=dd}}"];
    [v30 setObject:v31 forKey:v29];
  }
}

void __53__CKChatController__visibleChatItemsToScreenFrameMap__block_invoke_2(uint64_t a1, void *a2, uint64_t a3)
{
  v5 = a2;
  v6 = [MEMORY[0x1E696AC88] indexPathForRow:a3 inSection:1];
  v7 = [*(a1 + 32) collectionView];
  v8 = [v7 collectionViewLayout];
  v9 = [v8 layoutAttributesForItemAtIndexPath:v6];

  v10 = [*(a1 + 32) view];
  [v9 frame];
  v12 = v11;
  v14 = v13;
  v16 = v15;
  v18 = v17;
  v19 = [*(a1 + 32) collectionView];
  [v10 convertRect:v19 fromView:{v12, v14, v16, v18}];
  v21 = v20;
  v23 = v22;
  v25 = v24;
  v27 = v26;

  v28 = [v5 IMChatItem];
  v29 = [v28 guid];

  if (v29 && [v5 supportsInlineReplyTransition])
  {
    v30 = *(a1 + 40);
    v32[0] = v21;
    v32[1] = v23;
    v32[2] = v25;
    v32[3] = v27;
    v31 = [MEMORY[0x1E696B098] valueWithBytes:v32 objCType:"{CGRect={CGPoint=dd}{CGSize=dd}}"];
    [v30 setObject:v31 forKey:v29];
  }
}

- (void)dismissInlineReplyController:(BOOL)controller
{
  controllerCopy = controller;
  inlineReplyController = [(CKChatController *)self inlineReplyController];
  [(CKChatController *)self setInlineReplyController:0];
  chat = [(CKCoreChatController *)self chat];
  [chat dismissInlineReplies];

  collectionViewController = [(CKCoreChatController *)self collectionViewController];
  [collectionViewController updateTargetAlphaForVisibleChatItems];

  [(CKChatController *)self dismissTranscriptOverlayViewController:inlineReplyController presentKeyboard:controllerCopy];
  [(CKChatController *)self _showCatchUpButtonIfNeeded];
  [(CKCoreChatController *)self configureTapbackBackdropCaptureView];
}

- (void)dismissMessageEditingViewController:(BOOL)controller
{
  controllerCopy = controller;
  messageEditingViewController = [(CKChatController *)self messageEditingViewController];
  [(CKChatController *)self setMessageEditingViewController:0];
  collectionViewController = [(CKCoreChatController *)self collectionViewController];
  collectionViewController2 = [(CKCoreChatController *)self collectionViewController];
  messageEditingContext = [collectionViewController2 messageEditingContext];

  [collectionViewController setMessageEditingContext:0];
  [collectionViewController balloonMaxWidth];
  v9 = v8;
  [collectionViewController marginInsets];
  v11 = v10;
  v13 = v12;
  v15 = v14;
  v17 = v16;
  traitCollection = [(CKChatController *)self traitCollection];
  [collectionViewController transcriptBackgroundLuminance];
  [collectionViewController invalidateChatItemLayoutWithNewBalloonMaxWidth:traitCollection marginInsets:v9 traitCollection:v11 transcriptBackgroundLuminance:{v13, v15, v17, v19}];

  [collectionViewController updateTranscriptScrollIntentToBottomOrHistoryBasedOnCurrentContentOffset];
  [(CKChatController *)self dismissTranscriptOverlayViewController:messageEditingViewController presentKeyboard:controllerCopy];
  editedMessageGuid = [messageEditingContext editedMessageGuid];
  v21 = [collectionViewController chatItemForGUID:editedMessageGuid];

  [(CKChatController *)self showAcknowledgmentsAssociatedWithChatItem:v21];
  [(CKChatController *)self _showCatchUpButtonIfNeeded];
}

- (void)dismissTranscriptOverlayViewController:(id)controller presentKeyboard:(BOOL)keyboard
{
  controllerCopy = controller;
  standardSuggestionPresenter = [(CKChatController *)self standardSuggestionPresenter];
  banner = [standardSuggestionPresenter banner];
  [banner setHidden:0];

  standardSuggestionPresenter2 = [(CKChatController *)self standardSuggestionPresenter];
  banner2 = [standardSuggestionPresenter2 banner];
  [banner2 setAlpha:1.0];

  if (controllerCopy)
  {
    [controllerCopy willMoveToParentViewController:0];
    [(CKChatController *)self removeChildViewController:controllerCopy];
    view = [controllerCopy view];
    [view removeFromSuperview];
  }

  entryView = [(CKChatController *)self entryView];
  [entryView setDelegate:self];

  entryView2 = [(CKChatController *)self entryView];
  [entryView2 setClickInteractionDelegate:self];

  entryView3 = [(CKChatController *)self entryView];
  if (entryView3)
  {
    v14 = entryView3;
    collectionViewController = [(CKCoreChatController *)self collectionViewController];
    collectionView = [collectionViewController collectionView];

    if (collectionView)
    {
      entryView4 = [(CKChatController *)self entryView];
      collectionViewController2 = [(CKCoreChatController *)self collectionViewController];
      collectionView2 = [collectionViewController2 collectionView];
      [entryView4 configurePocketInteractionForScrollView:collectionView2];
    }
  }

  traitCollection = [(CKChatController *)self traitCollection];
  entryView5 = [(CKChatController *)self entryView];
  [entryView5 setEntryViewTraitCollection:traitCollection resetStyle:1];

  [(CKMessageEntryBackgroundViewProtocol *)self->_keyboardCandidateBarBackgroundView setEntryViewTraitCollection:traitCollection];
  inputController = [(CKCoreChatController *)self inputController];
  [inputController setDelegate:self];

  collectionViewController3 = [(CKCoreChatController *)self collectionViewController];
  v24 = objc_opt_new();
  [collectionViewController3 setHiddenItems:v24];

  collectionViewController4 = [(CKCoreChatController *)self collectionViewController];
  v26 = objc_opt_new();
  [collectionViewController4 setHiddenAssociatedItems:v26];

  collectionViewController5 = [(CKCoreChatController *)self collectionViewController];
  v28 = objc_opt_new();
  [collectionViewController5 setHiddenBalloonViews:v28];

  collectionView3 = [(CKChatController *)self collectionView];
  [collectionView3 setScrollEnabled:1];

  collectionView4 = [(CKChatController *)self collectionView];
  [collectionView4 endHoldingContentOffsetUpdatesForReason:@"TranscriptOverlayViewController"];

  [(CKScrollViewController *)self updateScrollGeometryWithoutAnimationForReason:@"InlineReplyDismissal"];
  [(CKChatController *)self _updateNavigationButtons];
  [(CKScrollViewController *)self endHoldingScrollGeometryUpdatesForReason:@"MainTranscriptWhileInlineReplyControllerVisible"];
  if ([(CKScrollViewController *)self isKeyboardFloating])
  {
    [(CKScrollViewController *)self inputAccessoryViewFrameUpdatedForFloatingKeyboard];
  }

  groupPhotoUpdateBanner = [(CKChatController *)self groupPhotoUpdateBanner];

  if (groupPhotoUpdateBanner)
  {
    v32 = +[CKUIBehavior sharedBehaviors];
    [v32 replyTranscriptUpdateBannerAnimateInTime];
    v34 = v33;

    v42[0] = MEMORY[0x1E69E9820];
    v42[1] = 3221225472;
    v42[2] = __75__CKChatController_dismissTranscriptOverlayViewController_presentKeyboard___block_invoke;
    v42[3] = &unk_1E72EBA18;
    v42[4] = self;
    [MEMORY[0x1E69DD250] animateWithDuration:v42 animations:0 completion:v34];
  }

  nicknameBanner = [(CKChatController *)self nicknameBanner];

  if (nicknameBanner)
  {
    v36 = +[CKUIBehavior sharedBehaviors];
    [v36 replyTranscriptUpdateBannerAnimateInTime];
    v38 = v37;

    v41[0] = MEMORY[0x1E69E9820];
    v41[1] = 3221225472;
    v41[2] = __75__CKChatController_dismissTranscriptOverlayViewController_presentKeyboard___block_invoke_2;
    v41[3] = &unk_1E72EBA18;
    v41[4] = self;
    [MEMORY[0x1E69DD250] animateWithDuration:v41 animations:0 completion:v38];
  }

  v39 = dispatch_time(0, 100000000);
  block[0] = MEMORY[0x1E69E9820];
  block[1] = 3221225472;
  block[2] = __75__CKChatController_dismissTranscriptOverlayViewController_presentKeyboard___block_invoke_3;
  block[3] = &unk_1E72EBA18;
  block[4] = self;
  dispatch_after(v39, MEMORY[0x1E69E96A0], block);
}

void __75__CKChatController_dismissTranscriptOverlayViewController_presentKeyboard___block_invoke(uint64_t a1)
{
  v1 = [*(a1 + 32) groupPhotoUpdateBanner];
  [v1 setAlpha:1.0];
}

void __75__CKChatController_dismissTranscriptOverlayViewController_presentKeyboard___block_invoke_2(uint64_t a1)
{
  v1 = [*(a1 + 32) nicknameBanner];
  [v1 setAlpha:1.0];
}

void __75__CKChatController_dismissTranscriptOverlayViewController_presentKeyboard___block_invoke_3(uint64_t a1)
{
  v6 = [*(a1 + 32) collectionView];
  v2 = [*(a1 + 32) transcriptWasScrolledToBottomBeforeInlinePresentation];
  v3 = *(a1 + 32);
  if (v2)
  {
    [v3 setTranscriptWasScrolledToBottomBeforeInlinePresentation:0];
    v4 = [*(a1 + 32) collectionViewController];
    [v4 scrollTranscriptToEntryViewInsertionTimeWithAnimation:1];
  }

  else
  {
    v5 = [v3 collectionViewController];
    [v5 updateTranscriptScrollIntentToBottomOrHistoryBasedOnCurrentContentOffset];

    v4 = +[CKScrollViewAnimationProperties systemDefaultScrollAnimation];
    [v6 enforceTranscriptScrollIntentWithAnimationProperties:v4];
  }
}

- (void)messageEditingViewController:(id)controller confirmedEditWithComposition:(id)composition
{
  controllerCopy = controller;
  compositionCopy = composition;
  if (compositionCopy)
  {
    transitionContext = [controllerCopy transitionContext];
    anchorChatItemGUID = [transitionContext anchorChatItemGUID];

    collectionViewController = [(CKCoreChatController *)self collectionViewController];
    v10 = [collectionViewController chatItemForGUID:anchorChatItemGUID];

    v11 = v10;
    messageItem = [v11 messageItem];
    index = [v11 index];
    conversation = [(CKCoreChatController *)self conversation];
    [conversation editMessageItem:messageItem partIndex:index withNewComposition:compositionCopy];
    conversation2 = [(CKCoreChatController *)self conversation];
    chat = [conversation2 chat];
    [chat setProofreadingInfo:0];

    v17 = [messageItem historyForMessagePart:index];
    v18 = [v17 count] - 1;
    mEMORY[0x1E69A8168] = [MEMORY[0x1E69A8168] sharedInstance];
    v20 = *MEMORY[0x1E69A73C0];
    v21 = [MEMORY[0x1E696AD98] numberWithInteger:v18];
    [mEMORY[0x1E69A8168] trackEvent:v20 withCount:v21];

    v22 = MEMORY[0x1E696AD98];
    [v11 timeIntervalSinceMessageSent];
    v24 = v23;

    v25 = [v22 numberWithDouble:v24];
    mEMORY[0x1E69A8168]2 = [MEMORY[0x1E69A8168] sharedInstance];
    [mEMORY[0x1E69A8168]2 trackEvent:*MEMORY[0x1E69A73D0] withStatistic:v25];
  }

  else if (IMOSLoggingEnabled())
  {
    v27 = OSLogHandleForIMFoundationCategory();
    if (os_log_type_enabled(v27, OS_LOG_TYPE_INFO))
    {
      *buf = 0;
      _os_log_impl(&dword_19020E000, v27, OS_LOG_TYPE_INFO, "Confirmed edit with no changes to the original message, aborting edit.", buf, 2u);
    }
  }
}

- (void)messageEditingViewControllerIsAnimatingIn:(id)in
{
  inCopy = in;
  [(CKChatController *)self setTargetFirstResponder:3];
  [(CKChatController *)self reloadInputViews];
  becomeFirstResponder = [inCopy becomeFirstResponder];

  if (becomeFirstResponder)
  {
    [(CKChatController *)self setTargetFirstResponder:4];
  }

  inputController = [(CKCoreChatController *)self inputController];
  [inputController setShouldBlurForMessageEditing:1];
}

- (void)messageEditingViewControllerIsAnimatingOut:(id)out
{
  [(CKChatController *)self setTargetFirstResponder:1];
  if ([(CKChatController *)self becomeFirstResponder])
  {
    [(CKChatController *)self setTargetFirstResponder:4];
  }

  inputController = [(CKCoreChatController *)self inputController];
  [inputController setShouldBlurForMessageEditing:0];
}

- (id)messageEditingViewController:(id)controller originalMessageCompositionForMessageWithGuid:(id)guid
{
  v28 = *MEMORY[0x1E69E9840];
  controllerCopy = controller;
  guidCopy = guid;
  collectionViewController = [(CKCoreChatController *)self collectionViewController];
  v7 = [collectionViewController chatItemForGUID:guidCopy];

  v8 = v7;
  index = [v8 index];
  message = [v8 message];
  messageSubject = [message messageSubject];
  text = [message text];
  v13 = [text __im_messagePartMatchingPartIndex:index];
  messagePartBody = [v13 messagePartBody];
  messageItem = [v8 messageItem];
  v16 = [messageItem translationsForMessagePart:index];

  v17 = objc_alloc(MEMORY[0x1E69A8308]);
  firstObject = [v16 firstObject];
  v19 = [v17 initWithDictionaryRepresentation:firstObject];

  translatedText = [v19 translatedText];
  if (IMOSLoggingEnabled())
  {
    v21 = OSLogHandleForIMFoundationCategory();
    if (os_log_type_enabled(v21, OS_LOG_TYPE_INFO))
    {
      *buf = 138412290;
      v27 = translatedText;
      _os_log_impl(&dword_19020E000, v21, OS_LOG_TYPE_INFO, "Translation: %@", buf, 0xCu);
    }
  }

  v22 = [[CKComposition alloc] initWithText:messagePartBody subject:messageSubject translation:translatedText shelfPluginPayload:0 bizIntent:0 shelfMediaObject:0 proofreadingInfo:0];

  return v22;
}

- (void)messageEditingViewController:(id)controller didUpdateFrameForBalloonView:(id)view
{
  viewCopy = view;
  transitionContext = [controller transitionContext];
  anchorChatItemGUID = [transitionContext anchorChatItemGUID];

  collectionViewController = [(CKCoreChatController *)self collectionViewController];
  [viewCopy frame];
  v10 = v9;

  v11 = [objc_alloc(MEMORY[0x1E69B1828]) initWithEditedMessageGuid:anchorChatItemGUID editedMessageHeight:v10];
  messageEditingContext = [collectionViewController messageEditingContext];
  v13 = [v11 isEqualToContext:messageEditingContext];

  if ((v13 & 1) == 0)
  {
    [collectionViewController setMessageEditingContext:v11];
    [collectionViewController balloonMaxWidth];
    v15 = v14;
    [collectionViewController marginInsets];
    v17 = v16;
    v19 = v18;
    v21 = v20;
    v23 = v22;
    traitCollection = [(CKChatController *)self traitCollection];
    [collectionViewController transcriptBackgroundLuminance];
    [collectionViewController invalidateChatItemLayoutWithNewBalloonMaxWidth:traitCollection marginInsets:v15 traitCollection:v17 transcriptBackgroundLuminance:{v19, v21, v23, v25}];
  }

  [(CKChatController *)self scrollTranscriptToAlignWithMessageEditingBalloonView];
}

void __72__CKChatController_scrollTranscriptToAlignWithMessageEditingBalloonView__block_invoke(uint64_t a1)
{
  WeakRetained = objc_loadWeakRetained((a1 + 48));
  [WeakRetained scrollToMessage:*(a1 + 32) atSpecificMessagePartIndex:*(a1 + 56) highlight:0 withInlineReplyOverlay:0 alignedWithView:*(a1 + 40) allowOverScroll:1];
}

- (UIEdgeInsets)messageEditingViewController:(id)controller contentInsetsForChatItemGuid:(id)guid
{
  guidCopy = guid;
  v6 = *MEMORY[0x1E69DDCE0];
  v7 = *(MEMORY[0x1E69DDCE0] + 8);
  v8 = *(MEMORY[0x1E69DDCE0] + 16);
  v9 = *(MEMORY[0x1E69DDCE0] + 24);
  collectionViewController = [(CKCoreChatController *)self collectionViewController];
  v11 = [collectionViewController chatItemForGUID:guidCopy];

  if (v11)
  {
    collectionViewController2 = [(CKCoreChatController *)self collectionViewController];
    v13 = [collectionViewController2 cellForChatItem:v11];

    if (v13)
    {
      objc_opt_class();
      if (objc_opt_isKindOfClass())
      {
        [v13 contentAlignmentInsets];
        v6 = v14;
        v7 = v15;
        v8 = v16;
        v9 = v17;
        goto LABEL_12;
      }

      v18 = IMLogHandleForCategory();
      if (os_log_type_enabled(v18, OS_LOG_TYPE_ERROR))
      {
        [CKChatController messageEditingViewController:contentInsetsForChatItemGuid:];
      }
    }

    else
    {
      v18 = IMLogHandleForCategory();
      if (os_log_type_enabled(v18, OS_LOG_TYPE_ERROR))
      {
        [CKChatController messageEditingViewController:contentInsetsForChatItemGuid:];
      }
    }

    goto LABEL_12;
  }

  v13 = IMLogHandleForCategory();
  if (os_log_type_enabled(v13, OS_LOG_TYPE_ERROR))
  {
    [CKChatController messageEditingViewController:contentInsetsForChatItemGuid:];
  }

LABEL_12:

  v19 = v6;
  v20 = v7;
  v21 = v8;
  v22 = v9;
  result.right = v22;
  result.bottom = v21;
  result.left = v20;
  result.top = v19;
  return result;
}

- (BOOL)messageEditingViewController:(id)controller balloonHasTailForChatItemGuid:(id)guid
{
  guidCopy = guid;
  collectionViewController = [(CKCoreChatController *)self collectionViewController];
  v7 = [collectionViewController chatItemForGUID:guidCopy];

  LOBYTE(collectionViewController) = [v7 hasTail];
  return collectionViewController;
}

- (char)messageEditingViewController:(id)controller colorTypeForChatItemGuid:(id)guid
{
  guidCopy = guid;
  collectionViewController = [(CKCoreChatController *)self collectionViewController];
  v7 = [collectionViewController chatItemForGUID:guidCopy];

  objc_opt_class();
  if (objc_opt_isKindOfClass())
  {
    color = [v7 color];
  }

  else
  {
    color = 1;
  }

  return color;
}

- (id)_fillColorForColorType:(char)type dynamicFillColor:(IMColorComponents)color
{
  alpha = color.alpha;
  blue = color.blue;
  green = color.green;
  red = color.red;
  typeCopy = type;
  if (IMColorComponentsIsZero())
  {
    v9 = +[CKUIBehavior sharedBehaviors];
    theme = [v9 theme];
    v11 = [theme balloonColorsForColorType:typeCopy];
    lastObject = [v11 lastObject];
  }

  else
  {
    lastObject = [MEMORY[0x1E69DC888] ck_colorWithIMColorComponents:{red, green, blue, alpha}];
  }

  return lastObject;
}

- (id)messageEditingViewController:(id)controller colorForChatItemGuid:(id)guid
{
  guidCopy = guid;
  collectionViewController = [(CKCoreChatController *)self collectionViewController];
  v7 = [collectionViewController chatItemForGUID:guidCopy];

  objc_opt_class();
  if (objc_opt_isKindOfClass())
  {
    v8 = v7;
    v9 = v8;
    v15 = 0;
    if (!v8)
    {
      goto LABEL_5;
    }

    [v8 balloonDescriptor];
    if (BYTE2(v15) <= 5u)
    {
      if (((1 << SBYTE2(v15)) & 0x15) == 0)
      {
        if (((1 << SBYTE2(v15)) & 0xA) != 0 || (-[CKChatController traitCollection](self, "traitCollection"), v12 = objc_claimAutoreleasedReturnValue(), v13 = [v12 isTranscriptBackgroundActive], v12, !v13))
        {
          clearColor = [MEMORY[0x1E69DC888] clearColor];
          goto LABEL_8;
        }
      }

LABEL_5:
      clearColor = -[CKChatController _fillColorForColorType:dynamicFillColor:](self, "_fillColorForColorType:dynamicFillColor:", [v9 color], 0, 0);
LABEL_8:
      clearColor2 = clearColor;

      goto LABEL_13;
    }
  }

  clearColor2 = [MEMORY[0x1E69DC888] clearColor];
LABEL_13:

  return clearColor2;
}

- (id)proofReadingInfoForMessageEditingViewController:(id)controller
{
  conversation = [(CKCoreChatController *)self conversation];
  chat = [conversation chat];
  proofreadingInfo = [chat proofreadingInfo];

  return proofreadingInfo;
}

- (void)inlineReplyControllerRequestsDismissal:(id)dismissal presentKeyboard:(BOOL)keyboard
{
  [(CKChatController *)self dismissInlineReplyController:keyboard];

  [(CKChatController *)self _registerSendProgressDelegate];
}

- (void)transcriptOverlayViewController:(id)controller visibleGUIDsDidChange:(id)change
{
  changeCopy = change;
  v6 = objc_opt_new();
  v7 = objc_opt_new();
  v12[0] = MEMORY[0x1E69E9820];
  v12[1] = 3221225472;
  v12[2] = __74__CKChatController_transcriptOverlayViewController_visibleGUIDsDidChange___block_invoke;
  v12[3] = &unk_1E72EC738;
  v12[4] = self;
  v13 = v6;
  v14 = v7;
  v8 = v7;
  v9 = v6;
  [changeCopy enumerateObjectsUsingBlock:v12];

  collectionViewController = [(CKCoreChatController *)self collectionViewController];
  [collectionViewController setHiddenItems:v9];

  collectionViewController2 = [(CKCoreChatController *)self collectionViewController];
  [collectionViewController2 setHiddenAssociatedItems:v8];
}

void __74__CKChatController_transcriptOverlayViewController_visibleGUIDsDidChange___block_invoke(id *a1, void *a2)
{
  v13 = a2;
  v3 = [a1[4] collectionViewController];
  v4 = [v3 chatItemForGUID:v13];

  if (v4)
  {
    if ([v4 supportsInlineReplyTransition])
    {
      v5 = [a1[4] collectionViewController];
      v6 = [v5 chatItems];
      v7 = [v6 indexOfObject:v4];

      [a1[5] addIndex:v7];
    }
  }

  else
  {
    v8 = [a1[4] collectionViewController];
    v9 = [v8 associatedChatItemForGUID:v13];

    if (v9)
    {
      v10 = [a1[4] collectionViewController];
      v11 = [v10 associatedChatItems];
      v12 = [v11 indexOfObject:v9];

      [a1[6] addIndex:v12];
    }
  }
}

- (CGRect)inlineReplyController:(id)controller gradientFrameWithInsets:(UIEdgeInsets)insets
{
  bottom = insets.bottom;
  v6 = [(CKChatController *)self collectionView:controller];
  [v6 contentInset];
  v8 = v7;
  v10 = v9;
  v12 = v11;
  v14 = v13;

  if (v12 >= bottom)
  {
    v15 = v12;
  }

  else
  {
    v15 = bottom;
  }

  [(CKCoreChatController *)self gradientFrameWithInsets:v8, v10, v15, v14];
  result.size.height = v19;
  result.size.width = v18;
  result.origin.y = v17;
  result.origin.x = v16;
  return result;
}

- (void)inlineReplyControllerIsAppearing:(id)appearing
{
  collectionView = [(CKChatController *)self collectionView];
  transcriptScrollIntent = [collectionView transcriptScrollIntent];
  if (transcriptScrollIntent <= 3)
  {
    if (transcriptScrollIntent && transcriptScrollIntent != 3)
    {
      goto LABEL_11;
    }

LABEL_7:
    [(CKChatController *)self setTranscriptWasScrolledToBottomBeforeInlinePresentation:1];
    goto LABEL_11;
  }

  if (transcriptScrollIntent != 4)
  {
    if (transcriptScrollIntent != 6)
    {
      goto LABEL_11;
    }

    goto LABEL_7;
  }

  v6 = IMLogHandleForCategory();
  if (os_log_type_enabled(v6, OS_LOG_TYPE_ERROR))
  {
    [CKChatController inlineReplyControllerIsAppearing:];
  }

LABEL_11:
  [collectionView setTranscriptScrollIntent:4];
}

- (void)transcriptOverlayViewControllerWillAnimateIn:(id)in
{
  inCopy = in;
  groupPhotoUpdateBanner = [(CKChatController *)self groupPhotoUpdateBanner];

  if (groupPhotoUpdateBanner)
  {
    v6 = +[CKUIBehavior sharedBehaviors];
    [v6 replyTranscriptUpdateBannerAnimateOutTime];
    v8 = v7;

    v15[0] = MEMORY[0x1E69E9820];
    v15[1] = 3221225472;
    v15[2] = __65__CKChatController_transcriptOverlayViewControllerWillAnimateIn___block_invoke;
    v15[3] = &unk_1E72EBA18;
    v15[4] = self;
    [MEMORY[0x1E69DD250] animateWithDuration:v15 animations:0 completion:v8];
  }

  nicknameBanner = [(CKChatController *)self nicknameBanner];

  if (nicknameBanner)
  {
    v10 = +[CKUIBehavior sharedBehaviors];
    [v10 replyTranscriptUpdateBannerAnimateOutTime];
    v12 = v11;

    v14[0] = MEMORY[0x1E69E9820];
    v14[1] = 3221225472;
    v14[2] = __65__CKChatController_transcriptOverlayViewControllerWillAnimateIn___block_invoke_2;
    v14[3] = &unk_1E72EBA18;
    v14[4] = self;
    [MEMORY[0x1E69DD250] animateWithDuration:v14 animations:0 completion:v12];
  }

  if ([inCopy wantsBackingTranscriptToIgnoreContentOffsetChanges])
  {
    collectionView = [(CKChatController *)self collectionView];
    [collectionView beginHoldingContentOffsetUpdatesForReason:@"TranscriptOverlayViewController"];
  }
}

void __65__CKChatController_transcriptOverlayViewControllerWillAnimateIn___block_invoke(uint64_t a1)
{
  v1 = [*(a1 + 32) groupPhotoUpdateBanner];
  [v1 setAlpha:0.0];
}

void __65__CKChatController_transcriptOverlayViewControllerWillAnimateIn___block_invoke_2(uint64_t a1)
{
  v1 = [*(a1 + 32) nicknameBanner];
  [v1 setAlpha:0.0];
}

- (void)transcriptOverlayViewControllerIsAnimatingIn:(id)in
{
  [(CKChatController *)self _updateNavigationButtons];
  collectionViewController = [(CKCoreChatController *)self collectionViewController];
  [collectionViewController updateTargetAlphaForVisibleChatItems];

  collectionViewController2 = [(CKCoreChatController *)self collectionViewController];
  collectionView = [collectionViewController2 collectionView];
  v6 = +[CKUIBehavior sharedBehaviors];
  theme = [v6 theme];
  [theme transcriptOverlayBackingCollectionViewOpacity];
  [collectionView setAlpha:?];
}

- (void)transcriptOverlayViewControllerDidAnimateIn:(id)in
{
  v8[0] = MEMORY[0x1E69E9820];
  v8[1] = 3221225472;
  v8[2] = __64__CKChatController_transcriptOverlayViewControllerDidAnimateIn___block_invoke;
  v8[3] = &unk_1E72EBA18;
  v8[4] = self;
  v7[0] = MEMORY[0x1E69E9820];
  v7[1] = 3221225472;
  v7[2] = __64__CKChatController_transcriptOverlayViewControllerDidAnimateIn___block_invoke_2;
  v7[3] = &unk_1E72EB9C8;
  v7[4] = self;
  [MEMORY[0x1E69DD250] animateWithDuration:v8 animations:v7 completion:0.3];
  entryViewContainerView = [(CKChatController *)self entryViewContainerView];
  [entryViewContainerView setNeedsLayout];

  collectionViewController = [(CKCoreChatController *)self collectionViewController];
  [collectionViewController updateTextEffectsState:&__block_literal_global_1707];
  collectionViewController2 = [(CKCoreChatController *)self->_inlineReplyController collectionViewController];
  [collectionViewController2 updateTextEffectsState:&__block_literal_global_1709];
}

void __64__CKChatController_transcriptOverlayViewControllerDidAnimateIn___block_invoke(uint64_t a1)
{
  v2 = [*(a1 + 32) standardSuggestionPresenter];
  v1 = [v2 banner];
  [v1 setAlpha:0.0];
}

void __64__CKChatController_transcriptOverlayViewControllerDidAnimateIn___block_invoke_2(uint64_t a1)
{
  v2 = [*(a1 + 32) standardSuggestionPresenter];
  v1 = [v2 banner];
  [v1 setHidden:1];
}

void __64__CKChatController_transcriptOverlayViewControllerDidAnimateIn___block_invoke_4(uint64_t a1, void *a2)
{
  v2 = a2;
  [v2 setInTransition:0];
  [v2 setIsReady:1];
}

- (void)transcriptOverlayViewControllerWillAnimateOut:(id)out
{
  if (self->_inlineReplyController == out)
  {
    collectionView = [(CKChatController *)self collectionView];
    [collectionView _setHiddenPocketEdges:0];

    collectionViewController = [(CKCoreChatController *)self collectionViewController];
    [collectionViewController updateTextEffectsState:&__block_literal_global_1711];
    collectionViewController2 = [(CKCoreChatController *)self->_inlineReplyController collectionViewController];
    [collectionViewController2 updateTextEffectsState:&__block_literal_global_1713];
  }
}

- (void)transcriptOverlayViewControllerIsAnimatingOut:(id)out
{
  collectionViewController = [(CKCoreChatController *)self collectionViewController];
  [collectionViewController updateTargetAlphaForVisibleChatItems];

  collectionViewController2 = [(CKCoreChatController *)self collectionViewController];
  collectionView = [collectionViewController2 collectionView];
  [collectionView setAlpha:1.0];
}

- (void)transcriptOverlayViewControllerDidAnimateOut:(id)out
{
  if (self->_inlineReplyController == out)
  {
    collectionViewController = [(CKCoreChatController *)self collectionViewController];
    [collectionViewController updateTextEffectsState:&__block_literal_global_1715];
    collectionViewController2 = [(CKCoreChatController *)self->_inlineReplyController collectionViewController];
    [collectionViewController2 updateTextEffectsState:&__block_literal_global_1717];
  }
}

- (UIEdgeInsets)parentTranscriptContentInsetsForInlineReplyController:(id)controller
{
  collectionView = [(CKChatController *)self collectionView];
  [collectionView contentInset];
  v5 = v4;
  v7 = v6;
  v9 = v8;
  v11 = v10;

  v12 = v5;
  v13 = v7;
  v14 = v9;
  v15 = v11;
  result.right = v15;
  result.bottom = v14;
  result.left = v13;
  result.top = v12;
  return result;
}

- (void)imagePickerController:(id)controller didFinishPickingMediaWithInfo:(id)info
{
  v20[1] = *MEMORY[0x1E69E9840];
  controllerCopy = controller;
  infoCopy = info;
  v8 = [infoCopy objectForKey:*MEMORY[0x1E69DDE18]];
  localIdentifier = [v8 localIdentifier];

  if (localIdentifier)
  {
    photoLibrary = [v8 photoLibrary];
    librarySpecificFetchOptions = [photoLibrary librarySpecificFetchOptions];

    v12 = MEMORY[0x1E6978630];
    localIdentifier2 = [v8 localIdentifier];
    v20[0] = localIdentifier2;
    v14 = [MEMORY[0x1E695DEC8] arrayWithObjects:v20 count:1];
    v15 = [v12 fetchAssetsWithLocalIdentifiers:v14 options:librarySpecificFetchOptions];
    firstObject = [v15 firstObject];

    if (firstObject)
    {
      objc_initWeak(&location, self);
      v17[0] = MEMORY[0x1E69E9820];
      v17[1] = 3221225472;
      v17[2] = __72__CKChatController_imagePickerController_didFinishPickingMediaWithInfo___block_invoke;
      v17[3] = &unk_1E72EE510;
      objc_copyWeak(&v18, &location);
      [CKComposition mediaObjectFromPhotosAsset:firstObject completion:v17];
      objc_destroyWeak(&v18);
      objc_destroyWeak(&location);
    }
  }
}

void __72__CKChatController_imagePickerController_didFinishPickingMediaWithInfo___block_invoke(uint64_t a1, void *a2)
{
  v3 = a2;
  WeakRetained = objc_loadWeakRetained((a1 + 32));
  v5 = [WeakRetained composition];
  v7 = [v5 compositionByAppendingMediaObject:v3];

  v6 = objc_loadWeakRetained((a1 + 32));
  [v6 setComposition:v7];
}

- (void)appendCompositionFromItemProviders:(id)providers
{
  providersCopy = providers;
  objc_initWeak(&location, self);
  v5[0] = MEMORY[0x1E69E9820];
  v5[1] = 3221225472;
  v5[2] = __55__CKChatController_appendCompositionFromItemProviders___block_invoke;
  v5[3] = &unk_1E72EE538;
  objc_copyWeak(&v6, &location);
  v5[4] = self;
  [CKComposition requestCompositionFromItemProviders:providersCopy completion:v5];
  objc_destroyWeak(&v6);
  objc_destroyWeak(&location);
}

void __55__CKChatController_appendCompositionFromItemProviders___block_invoke(uint64_t a1, void *a2)
{
  v3 = a2;
  block[0] = MEMORY[0x1E69E9820];
  block[1] = 3221225472;
  block[2] = __55__CKChatController_appendCompositionFromItemProviders___block_invoke_2;
  block[3] = &unk_1E72ED660;
  v6 = v3;
  v4 = v3;
  objc_copyWeak(&v8, (a1 + 40));
  v7 = *(a1 + 32);
  dispatch_async(MEMORY[0x1E69E96A0], block);
  objc_destroyWeak(&v8);
}

void __55__CKChatController_appendCompositionFromItemProviders___block_invoke_2(id *a1)
{
  v19 = 0;
  v20 = &v19;
  v21 = 0x3032000000;
  v22 = __Block_byref_object_copy__8;
  v23 = __Block_byref_object_dispose__8;
  v24 = a1[4];
  WeakRetained = objc_loadWeakRetained(a1 + 6);
  v3 = [WeakRetained composition];

  if (([v20[5] isAudioComposition] & 1) == 0)
  {
    v4 = a1[4];
    if (v3)
    {
      v4 = [v3 compositionByAppendingComposition:a1[4]];
    }

    objc_storeStrong(v20 + 5, v4);
    if (v3)
    {
    }

    v5 = [a1[4] collaborationShareOptions];
    v6 = [v20[5] compositionWithCollaborationShareOptions:v5];
    v7 = v20[5];
    v20[5] = v6;
  }

  v8 = [a1[5] delegate];
  objc_opt_class();
  isKindOfClass = objc_opt_isKindOfClass();

  if (isKindOfClass)
  {
    v10 = [a1[5] delegate];
  }

  else
  {
    v10 = 0;
  }

  if (([v10 isComposingMessage] & 1) == 0 && (objc_msgSend(a1[5], "composition"), v11 = objc_claimAutoreleasedReturnValue(), objc_msgSend(v11, "shelfPluginPayload"), v12 = objc_claimAutoreleasedReturnValue(), v12, v11, v12) || objc_msgSend(v20[5], "isAudioComposition") && (objc_msgSend(a1[5], "composition"), v13 = objc_claimAutoreleasedReturnValue(), v14 = objc_msgSend(v13, "hasContent"), v13, v14))
  {
    v15 = a1[5];
    v17[0] = MEMORY[0x1E69E9820];
    v17[1] = 3221225472;
    v17[2] = __55__CKChatController_appendCompositionFromItemProviders___block_invoke_3;
    v17[3] = &unk_1E72EE398;
    objc_copyWeak(&v18, a1 + 6);
    v17[4] = &v19;
    [v15 presentReplaceCompositionAlertWithConfirmationBlock:v17 cancelBlock:&__block_literal_global_1721];
    objc_destroyWeak(&v18);
  }

  else
  {
    v16 = objc_loadWeakRetained(a1 + 6);
    [v16 setComposition:v20[5]];
  }

  _Block_object_dispose(&v19, 8);
}

void __55__CKChatController_appendCompositionFromItemProviders___block_invoke_3(uint64_t a1)
{
  WeakRetained = objc_loadWeakRetained((a1 + 40));
  [WeakRetained setComposition:*(*(*(a1 + 32) + 8) + 40)];
}

void __55__CKChatController_appendCompositionFromItemProviders___block_invoke_4()
{
  if (IMOSLoggingEnabled())
  {
    v0 = OSLogHandleForIMFoundationCategory();
    if (os_log_type_enabled(v0, OS_LOG_TYPE_INFO))
    {
      *v1 = 0;
      _os_log_impl(&dword_19020E000, v0, OS_LOG_TYPE_INFO, "Do not replace composition. Return early.", v1, 2u);
    }
  }
}

- (id)presentedControllerDoneButtonItem
{
  v2 = [objc_alloc(MEMORY[0x1E69DC708]) initWithBarButtonSystemItem:0 target:self action:sel_dismissPresentedViewController_];

  return v2;
}

- (void)startDeferredEditingPayload:(id)payload forConversation:(id)conversation
{
  payloadCopy = payload;
  conversationCopy = conversation;
  objc_initWeak(&location, self);
  v9[0] = MEMORY[0x1E69E9820];
  v9[1] = 3221225472;
  v9[2] = __64__CKChatController_startDeferredEditingPayload_forConversation___block_invoke;
  v9[3] = &unk_1E72EE560;
  v9[4] = self;
  objc_copyWeak(&v11, &location);
  v8 = payloadCopy;
  v10 = v8;
  [CKComposition compositionWithShelfPluginPayload:v8 completionHandler:v9];

  objc_destroyWeak(&v11);
  objc_destroyWeak(&location);
}

void __64__CKChatController_startDeferredEditingPayload_forConversation___block_invoke(id *a1, void *a2, void *a3)
{
  v5 = a2;
  v6 = a3;
  v7 = [a1[4] conversation];
  [v7 setUnsentComposition:v5];

  v8[0] = MEMORY[0x1E69E9820];
  v8[1] = 3221225472;
  v8[2] = __64__CKChatController_startDeferredEditingPayload_forConversation___block_invoke_2;
  v8[3] = &unk_1E72EBB98;
  objc_copyWeak(&v10, a1 + 6);
  v9 = a1[5];
  [a1[4] setDeferredPresentationBlock:v8];

  objc_destroyWeak(&v10);
}

void __64__CKChatController_startDeferredEditingPayload_forConversation___block_invoke_2(uint64_t a1)
{
  WeakRetained = objc_loadWeakRetained((a1 + 40));
  v2 = [WeakRetained inputController];
  [v2 startEditingPayload:*(a1 + 32)];
}

- (void)startCommitPayload:(id)payload forConversation:(id)conversation
{
  payloadCopy = payload;
  [payloadCopy setIsFromMe:1];
  v7[0] = MEMORY[0x1E69E9820];
  v7[1] = 3221225472;
  v7[2] = __55__CKChatController_startCommitPayload_forConversation___block_invoke;
  v7[3] = &unk_1E72EE588;
  v7[4] = self;
  v8 = payloadCopy;
  v6 = payloadCopy;
  [CKComposition compositionWithShelfPluginPayload:v6 completionHandler:v7];
}

void __55__CKChatController_startCommitPayload_forConversation___block_invoke(uint64_t a1, uint64_t a2)
{
  [*(a1 + 32) chatInputSentComposition:a2];
  v4 = +[CKBalloonPluginManager sharedInstance];
  v3 = [*(a1 + 40) pluginBundleID];
  [v4 updateInteractionTimeForPlugin:v3];
}

- (void)willDismissFunCamera:(id)camera
{
  v8 = *MEMORY[0x1E69E9840];
  cameraCopy = camera;
  [(CKChatController *)self setIsShowingCamera:0];
  if (IMOSLoggingEnabled())
  {
    v5 = OSLogHandleForIMFoundationCategory();
    if (os_log_type_enabled(v5, OS_LOG_TYPE_INFO))
    {
      v6 = 136315138;
      v7 = "[CKChatController willDismissFunCamera:]";
      _os_log_impl(&dword_19020E000, v5, OS_LOG_TYPE_INFO, "reloadEntryViewIfNeeded called from %s", &v6, 0xCu);
    }
  }

  [(CKChatController *)self reloadEntryViewIfNeeded];
  [(CKChatController *)self becomeFirstResponder];
}

- (void)stageAssetArchive:(id)archive skipShelf:(BOOL)shelf completionHandler:(id)handler
{
  archiveCopy = archive;
  handlerCopy = handler;
  objc_initWeak(&location, self);
  v12[0] = MEMORY[0x1E69E9820];
  v12[1] = 3221225472;
  v12[2] = __66__CKChatController_stageAssetArchive_skipShelf_completionHandler___block_invoke;
  v12[3] = &unk_1E72EE5B0;
  objc_copyWeak(&v15, &location);
  v10 = archiveCopy;
  v13 = v10;
  shelfCopy = shelf;
  v11 = handlerCopy;
  v14 = v11;
  [(CKChatController *)self setDeferredPresentationBlock:v12];

  objc_destroyWeak(&v15);
  objc_destroyWeak(&location);
}

void __66__CKChatController_stageAssetArchive_skipShelf_completionHandler___block_invoke(uint64_t a1)
{
  v10 = *MEMORY[0x1E69E9840];
  WeakRetained = objc_loadWeakRetained((a1 + 48));
  v3 = [WeakRetained inputController];

  if (objc_opt_respondsToSelector())
  {
    [v3 stageAssetArchive:*(a1 + 32) skipShelf:*(a1 + 56) completionHandler:*(a1 + 40)];
  }

  else if (IMOSLoggingEnabled())
  {
    v4 = OSLogHandleForIMFoundationCategory();
    if (os_log_type_enabled(v4, OS_LOG_TYPE_INFO))
    {
      v5 = objc_loadWeakRetained((a1 + 48));
      v6 = 138412546;
      v7 = v5;
      v8 = 2112;
      v9 = v3;
      _os_log_impl(&dword_19020E000, v4, OS_LOG_TYPE_INFO, "Failed to dispatch to input controller %@ %@ -stageAssetArchive:skipShelf:completionHandler: as it doesn't implement that method!", &v6, 0x16u);
    }
  }
}

- (void)presentPhotosApp
{
  inputController = [(CKCoreChatController *)self inputController];
  [inputController presentPluginWithBundleID:*MEMORY[0x1E69A6A08] appLaunchPayload:0];
}

- (void)controller:(id)controller didCompleteClassificationRequest:(id)request withResponse:(id)response
{
  controllerCopy = controller;
  requestCopy = request;
  responseCopy = response;
  if (IMOSLoggingEnabled())
  {
    v11 = OSLogHandleForIMFoundationCategory();
    if (os_log_type_enabled(v11, OS_LOG_TYPE_INFO))
    {
      *buf = 0;
      _os_log_impl(&dword_19020E000, v11, OS_LOG_TYPE_INFO, "didCompleteClassificationRequest -- di", buf, 2u);
    }
  }

  block[0] = MEMORY[0x1E69E9820];
  block[1] = 3221225472;
  block[2] = __77__CKChatController_controller_didCompleteClassificationRequest_withResponse___block_invoke;
  block[3] = &unk_1E72EB880;
  v15 = controllerCopy;
  v16 = responseCopy;
  selfCopy = self;
  v12 = responseCopy;
  v13 = controllerCopy;
  dispatch_async(MEMORY[0x1E69E96A0], block);
}

void __77__CKChatController_controller_didCompleteClassificationRequest_withResponse___block_invoke(uint64_t a1)
{
  v5[0] = MEMORY[0x1E69E9820];
  v5[1] = 3221225472;
  v5[2] = __77__CKChatController_controller_didCompleteClassificationRequest_withResponse___block_invoke_2;
  v5[3] = &unk_1E72EB8D0;
  v2 = *(a1 + 32);
  v3 = *(a1 + 40);
  v4 = *(a1 + 48);
  v6 = v3;
  v7 = v4;
  [v2 dismissViewControllerAnimated:1 completion:v5];
}

uint64_t __77__CKChatController_controller_didCompleteClassificationRequest_withResponse___block_invoke_2(uint64_t a1)
{
  v2 = *(a1 + 32);
  v3 = IMOSLoggingEnabled();
  if (v2)
  {
    if (v3)
    {
      v4 = OSLogHandleForIMFoundationCategory();
      if (os_log_type_enabled(v4, OS_LOG_TYPE_INFO))
      {
        *buf = 0;
        _os_log_impl(&dword_19020E000, v4, OS_LOG_TYPE_INFO, "Classification request complete, deleting and reporting junk.", buf, 2u);
      }
    }

    v5 = [*(a1 + 40) delegate];
    v6 = *(a1 + 40);
    v7 = [v6 conversation];
    [v5 chatController:v6 didReportSpamForConversation:v7];
  }

  else
  {
    if (!v3)
    {
      return [*(a1 + 40) becomeFirstResponder];
    }

    v5 = OSLogHandleForIMFoundationCategory();
    if (os_log_type_enabled(v5, OS_LOG_TYPE_INFO))
    {
      *v9 = 0;
      _os_log_impl(&dword_19020E000, v5, OS_LOG_TYPE_INFO, "Classification request was cancelled, not going to delete or report junk.", v9, 2u);
    }
  }

  return [*(a1 + 40) becomeFirstResponder];
}

- (UIView)recipientsVirtualToolbarItem
{
  macRecipientsController = [(CKChatController *)self macRecipientsController];
  view = [macRecipientsController view];

  if (view && self->_recipientsVirtualToolbarItem != view)
  {
    objc_storeStrong(&self->_recipientsVirtualToolbarItem, view);
  }

  recipientsVirtualToolbarItem = self->_recipientsVirtualToolbarItem;
  v6 = recipientsVirtualToolbarItem;

  return recipientsVirtualToolbarItem;
}

- (void)dismissBusinessOnboardingIfShowing
{
  if ([(CKChatController *)self isShowingBusinessOnboarding])
  {

    [(CKChatController *)self dismissViewControllerAnimated:0 completion:0];
  }
}

- (void)dismissTipIfPresented
{
  tipManager = [(CKChatController *)self tipManager];
  [tipManager dismissTipIfPresented];
}

- (BOOL)isShowingBusinessOnboarding
{
  presentedViewController = [(CKChatController *)self presentedViewController];
  objc_opt_class();
  isKindOfClass = objc_opt_isKindOfClass();

  return isKindOfClass & 1;
}

- (void)inputController:(id)controller willDismissPresentationController:(id)presentationController
{
  [(CKChatController *)self _dismissFullScreenBubbleViewControllerAnimated:1 withSendAnimation:0 completion:0];
  if (![(CKChatController *)self isAnimatingStickerReaction])
  {

    [(CKChatController *)self setIgnoresAutomaticScrollsTowardBottom:0];
  }
}

- (void)_dismissFullScreenBubbleViewControllerAnimated:(BOOL)animated withSendAnimation:(BOOL)animation completion:(id)completion
{
  animationCopy = animation;
  animatedCopy = animated;
  completionCopy = completion;
  fullScreenBalloonViewController = [(CKCoreChatController *)self fullScreenBalloonViewController];
  displayConfiguration = [fullScreenBalloonViewController displayConfiguration];
  shouldDismissAppCardOnExit = [displayConfiguration shouldDismissAppCardOnExit];

  [(CKChatController *)self _dismissFullScreenBubbleViewControllerAnimated:animatedCopy withSendAnimation:animationCopy dismissAppCard:shouldDismissAppCardOnExit completion:completionCopy];
}

- (void)_dismissFullScreenBubbleViewControllerAnimated:(BOOL)animated withSendAnimation:(BOOL)animation dismissAppCard:(BOOL)card completion:(id)completion
{
  cardCopy = card;
  animationCopy = animation;
  animatedCopy = animated;
  v21 = *MEMORY[0x1E69E9840];
  completionCopy = completion;
  fullScreenBalloonViewController = [(CKCoreChatController *)self fullScreenBalloonViewController];

  if (fullScreenBalloonViewController)
  {
    aBlock[0] = MEMORY[0x1E69E9820];
    aBlock[1] = 3221225472;
    aBlock[2] = __111__CKChatController__dismissFullScreenBubbleViewControllerAnimated_withSendAnimation_dismissAppCard_completion___block_invoke;
    aBlock[3] = &unk_1E72EE5D8;
    aBlock[4] = self;
    v18 = completionCopy;
    v12 = _Block_copy(aBlock);
    objc_opt_class();
    if (objc_opt_isKindOfClass())
    {
      inputController = [(CKCoreChatController *)self inputController];
      [inputController showKeyboard];
    }

    else if ([(CKChatController *)self entryViewWasActiveOnContextMenuPresentation])
    {
      [(CKChatController *)self showKeyboard];
    }

    else if (cardCopy)
    {
      inputController2 = [(CKCoreChatController *)self inputController];
      [inputController2 dismissAppCardIfNecessaryAnimated:1 completion:0];
    }

    v16.receiver = self;
    v16.super_class = CKChatController;
    [(CKCoreChatController *)&v16 _dismissFullScreenBubbleViewControllerAnimated:animatedCopy withSendAnimation:animationCopy completion:v12];
  }

  else if (IMOSLoggingEnabled())
  {
    v14 = OSLogHandleForIMFoundationCategory();
    if (os_log_type_enabled(v14, OS_LOG_TYPE_INFO))
    {
      *buf = 136315138;
      v20 = "[CKChatController _dismissFullScreenBubbleViewControllerAnimated:withSendAnimation:dismissAppCard:completion:]";
      _os_log_impl(&dword_19020E000, v14, OS_LOG_TYPE_INFO, "[%s] called but fullScreenBalloonViewController is nil", buf, 0xCu);
    }
  }
}

uint64_t __111__CKChatController__dismissFullScreenBubbleViewControllerAnimated_withSendAnimation_dismissAppCard_completion___block_invoke(uint64_t a1)
{
  v2 = *(a1 + 40);
  if (v2)
  {
    (*(v2 + 16))();
  }

  if (CKIsRunningInMacCatalyst())
  {
    v3 = [*(a1 + 32) entryView];
    v4 = [v3 contentView];
    [v4 makeActive];
  }

  result = [*(a1 + 32) isInline];
  if ((result & 1) == 0)
  {
    v6 = *(a1 + 32);

    return [v6 _updateNavigationButtons];
  }

  return result;
}

- (void)registerForTextinputPayloadHandlingForCheckInForConversation:(id)conversation
{
  conversationCopy = conversation;
  mEMORY[0x1E69A8070] = [MEMORY[0x1E69A8070] sharedFeatureFlags];
  isZelkovaEnabled = [mEMORY[0x1E69A8070] isZelkovaEnabled];

  if (isZelkovaEnabled)
  {
    chat = [conversationCopy chat];
    isGroupChat = [chat isGroupChat];

    if ((isGroupChat & 1) == 0)
    {
      senderIdentifier = [conversationCopy senderIdentifier];
      recipients = [conversationCopy recipients];
      firstObject = [recipients firstObject];

      if (firstObject)
      {
        rawAddress = [firstObject rawAddress];
      }

      else
      {
        rawAddress = 0;
      }

      inputController = [(CKCoreChatController *)self inputController];
      [inputController registerForTextInputPayloadHandlingForSenderHandleID:senderIdentifier receiverHandleID:rawAddress];
    }
  }
}

- (void)learnMoreButtonTapped
{
  v8 = [*MEMORY[0x1E69A69F0] stringByAppendingFormat:@":%@:%@", @"0000000000", *MEMORY[0x1E69A6930]];
  mEMORY[0x1E69A8218] = [MEMORY[0x1E69A8218] sharedCoordinator];
  appPayloadID = [mEMORY[0x1E69A8218] appPayloadID];

  mEMORY[0x1E69A8218]2 = [MEMORY[0x1E69A8218] sharedCoordinator];
  appPayload = [mEMORY[0x1E69A8218]2 appPayload];

  inputController = [(CKCoreChatController *)self inputController];
  [inputController handleTextInputPayload:appPayload withPayloadID:appPayloadID forPlugin:v8];
}

- (void)tipManagerDidShowTranscriptBannerTip
{
  v3 = +[CKUIBehavior sharedBehaviors];
  [v3 updateTranscriptInsetsAnimationDuration];
  [(CKScrollViewController *)self updateScrollGeometryForReason:@"BannerChangedSize" withDuration:3 animationCurve:?];
}

- (void)tipManagerDidDismissTranscriptBannerTip
{
  v3 = +[CKUIBehavior sharedBehaviors];
  [v3 updateTranscriptInsetsAnimationDuration];
  [(CKScrollViewController *)self updateScrollGeometryForReason:@"BannerChangedSize" withDuration:3 animationCurve:?];
}

- (void)setUpFilteringButtonTapped
{
  initUnknownSendersOnboardingController = [[CKUnknownSendersOnboardingController alloc] initUnknownSendersOnboardingController];
  v3 = [objc_alloc(MEMORY[0x1E69DCCD8]) initWithRootViewController:initUnknownSendersOnboardingController];
  [(CKChatController *)self presentViewController:v3 animated:1 completion:&__block_literal_global_1737];
}

- (void)didRequestSendResponseForAction:(id)action
{
  v4 = MEMORY[0x1E69A5BD8];
  actionCopy = action;
  v6 = [v4 alloc];
  date = [MEMORY[0x1E695DF00] date];
  suggestedActionBody = [actionCopy suggestedActionBody];

  stringGUID = [MEMORY[0x1E696AEC0] stringGUID];
  v11 = [v6 initWithSender:0 time:date text:suggestedActionBody messageSubject:0 fileTransferGUIDs:0 flags:5 error:0 guid:stringGUID subject:0 balloonBundleID:0 payloadData:0 expressiveSendStyleID:0 threadIdentifier:0 scheduleType:0 scheduleState:0];

  chat = [(CKCoreChatController *)self chat];
  [chat sendMessage:v11];
}

- (void)didRequestLocationPush:(BOOL)push
{
  inputController = [(CKCoreChatController *)self inputController];
  [inputController showLocationPlugin];
}

- (void)didRequestComposeText:(id)text text:(id)a4
{
  v22[1] = *MEMORY[0x1E69E9840];
  textCopy = text;
  v7 = MEMORY[0x1E696AAB0];
  v8 = a4;
  v9 = [[v7 alloc] initWithString:v8];

  v10 = [[CKComposition alloc] initWithText:v9 subject:0];
  chat = [(CKCoreChatController *)self chat];
  participants = [chat participants];
  if ([participants count] != 1)
  {

    goto LABEL_5;
  }

  [(CKCoreChatController *)self chat];
  v21 = v9;
  v14 = v13 = textCopy;
  participants2 = [v14 participants];
  firstObject = [participants2 firstObject];
  v17 = [firstObject ID];
  v18 = [v17 isEqualToString:v13];

  textCopy = v13;
  v9 = v21;

  if (!v18)
  {
LABEL_5:
    delegate = [(CKCoreChatController *)self delegate];
    v22[0] = textCopy;
    v20 = [MEMORY[0x1E695DEC8] arrayWithObjects:v22 count:1];
    [delegate chatController:self shouldComposeConversationWithRecipientAddresses:v20 composition:v10];

    goto LABEL_6;
  }

  [(CKChatController *)self setComposition:v10];
LABEL_6:
}

- (void)didRequestComposeAudio:(id)audio
{
  v16[1] = *MEMORY[0x1E69E9840];
  audioCopy = audio;
  chat = [(CKCoreChatController *)self chat];
  participants = [chat participants];
  if ([participants count] != 1)
  {

    goto LABEL_5;
  }

  chat2 = [(CKCoreChatController *)self chat];
  participants2 = [chat2 participants];
  firstObject = [participants2 firstObject];
  v10 = [firstObject ID];
  v11 = [v10 isEqualToString:audioCopy];

  if (!v11)
  {
LABEL_5:
    delegate = [(CKCoreChatController *)self delegate];
    v16[0] = audioCopy;
    v15 = [MEMORY[0x1E695DEC8] arrayWithObjects:v16 count:1];
    [delegate chatController:self shouldComposeAudioMessageWithRecipientAddresses:v15];

    goto LABEL_6;
  }

  inputController = [(CKCoreChatController *)self inputController];
  entryView = [inputController entryView];
  [entryView startRecordingForAudioButtonInEntryView];

LABEL_6:
}

- (void)didRequestComposeVideo:(id)video
{
  v15[1] = *MEMORY[0x1E69E9840];
  videoCopy = video;
  chat = [(CKCoreChatController *)self chat];
  participants = [chat participants];
  if ([participants count] != 1)
  {

    goto LABEL_5;
  }

  chat2 = [(CKCoreChatController *)self chat];
  participants2 = [chat2 participants];
  firstObject = [participants2 firstObject];
  v10 = [firstObject ID];
  v11 = [v10 isEqualToString:videoCopy];

  if (!v11)
  {
LABEL_5:
    delegate = [(CKCoreChatController *)self delegate];
    v15[0] = videoCopy;
    v14 = [MEMORY[0x1E695DEC8] arrayWithObjects:v15 count:1];
    [delegate chatController:self shouldComposeVideoMessageWithRecipientAddresses:v14];

    goto LABEL_6;
  }

  inputController = [(CKCoreChatController *)self inputController];
  [inputController showFunCamera];

LABEL_6:
}

- (void)didRequestCreateCalendarEvent:(id)event
{
  if (event)
  {
    eventCopy = event;
    [eventCopy setEditViewDelegate:self];
    [(CKChatController *)self presentViewController:eventCopy animated:1 completion:0];
  }
}

- (void)didRequestOpenWebView:(id)view
{
  v37 = *MEMORY[0x1E69E9840];
  viewCopy = view;
  v5 = MEMORY[0x1E695DFF8];
  v6 = [viewCopy url];
  v7 = [v5 URLWithString:v6];

  if (!v7)
  {
    goto LABEL_18;
  }

  scheme = [v7 scheme];
  if ([scheme isEqualToString:@"http"])
  {

LABEL_5:
    gotLoadHelper_x8__OBJC_CLASS___SFSafariViewController(v9);
    v13 = [objc_alloc(*(v12 + 2104)) initWithURL:v7];
    [v13 setDelegate:self];
    [v13 setModalPresentationStyle:2];
    sheetPresentationController = [v13 sheetPresentationController];
    view = [(CKChatController *)self view];
    [view bounds];
    v17 = v16;

    v28[0] = MEMORY[0x1E69E9820];
    v28[1] = 3221225472;
    v28[2] = __42__CKChatController_didRequestOpenWebView___block_invoke;
    v28[3] = &__block_descriptor_40_e64_d16__0___UISheetPresentationControllerDetentResolutionContext__8l;
    v28[4] = v17;
    v18 = [MEMORY[0x1E69DCF58] customDetentWithIdentifier:@"OpenWebViewControllerFullDetent" resolver:v28];
    v27[0] = MEMORY[0x1E69E9820];
    v27[1] = 3221225472;
    v27[2] = __42__CKChatController_didRequestOpenWebView___block_invoke_2;
    v27[3] = &__block_descriptor_40_e64_d16__0___UISheetPresentationControllerDetentResolutionContext__8l;
    v27[4] = v17;
    v19 = [MEMORY[0x1E69DCF58] customDetentWithIdentifier:@"OpenWebViewControllerTallDetent" resolver:v27];
    v26[0] = MEMORY[0x1E69E9820];
    v26[1] = 3221225472;
    v26[2] = __42__CKChatController_didRequestOpenWebView___block_invoke_3;
    v26[3] = &__block_descriptor_40_e64_d16__0___UISheetPresentationControllerDetentResolutionContext__8l;
    v26[4] = v17;
    v20 = [MEMORY[0x1E69DCF58] customDetentWithIdentifier:@"OpenWebViewControllerHalfDetent" resolver:v26];
    mode = [viewCopy mode];
    if (mode == 2)
    {
      v31[0] = v19;
      v31[1] = v18;
      v22 = [MEMORY[0x1E695DEC8] arrayWithObjects:v31 count:2];
    }

    else if (mode == 1)
    {
      v30[0] = v20;
      v30[1] = v18;
      v22 = [MEMORY[0x1E695DEC8] arrayWithObjects:v30 count:2];
    }

    else
    {
      if (mode)
      {
        v29 = v18;
        [MEMORY[0x1E695DEC8] arrayWithObjects:&v29 count:1];
      }

      else
      {
        v32 = v18;
        [MEMORY[0x1E695DEC8] arrayWithObjects:&v32 count:1];
      }
      v22 = ;
    }

    v25 = v22;
    [sheetPresentationController setPrefersGrabberVisible:0];
    [sheetPresentationController setDetents:v25];
    [(CKChatController *)self presentViewController:v13 animated:1 completion:0];
    [(CKChatController *)self setIsWebViewVisible:1];

    goto LABEL_18;
  }

  scheme2 = [v7 scheme];
  v11 = [scheme2 isEqualToString:@"https"];

  if (v11)
  {
    goto LABEL_5;
  }

  if (IMOSLoggingEnabled())
  {
    v23 = OSLogHandleForIMFoundationCategory();
    if (os_log_type_enabled(v23, OS_LOG_TYPE_INFO))
    {
      scheme3 = [v7 scheme];
      *buf = 136315394;
      v34 = "[CKChatController didRequestOpenWebView:]";
      v35 = 2112;
      v36 = scheme3;
      _os_log_impl(&dword_19020E000, v23, OS_LOG_TYPE_INFO, "[%s] called with an invalid URL scheme: %@", buf, 0x16u);
    }
  }

LABEL_18:
}

- (void)didRequestSendDeviceDetails
{
  v18 = MGCopyAnswer();
  v3 = MEMORY[0x1E696AEC0];
  currentDevice = [MEMORY[0x1E69DC938] currentDevice];
  systemName = [currentDevice systemName];
  currentDevice2 = [MEMORY[0x1E69DC938] currentDevice];
  systemVersion = [currentDevice2 systemVersion];
  v8 = [v3 stringWithFormat:@"%@ %@", systemName, systemVersion];

  v9 = MEMORY[0x1E696AEC0];
  currentDevice3 = [MEMORY[0x1E69DC938] currentDevice];
  systemVersion2 = [currentDevice3 systemVersion];
  v12 = [v9 stringWithFormat:@"Apple Messages %@", systemVersion2];

  v13 = [MEMORY[0x1E696AEC0] stringWithFormat:@"%@\n%@", v8, v12];
  v14 = [_TtC7ChatKit25CKSuggestedActionsHandler pluginPayloadForShelfCardWithTitle:v18 summary:v13 userInfo:&unk_1F04E9078];
  v15 = [[CKComposition alloc] initWithText:0 subject:0 shelfPluginPayload:v14];
  composition = [(CKChatController *)self composition];
  v17 = [composition compositionByAppendingComposition:v15];
  [(CKChatController *)self setComposition:v17];
}

- (void)setSendingCompositionBackgroundTask:(unint64_t)task
{
  sendingCompositionBackgroundTask = self->_sendingCompositionBackgroundTask;
  mEMORY[0x1E69DC668] = [MEMORY[0x1E69DC668] sharedApplication];
  [mEMORY[0x1E69DC668] endBackgroundTask:sendingCompositionBackgroundTask];

  self->_sendingCompositionBackgroundTask = task;
}

- (void)mentionsControllerDidFinishAnimation:(id)animation
{
  mEMORY[0x1E69A8070] = [MEMORY[0x1E69A8070] sharedFeatureFlags];
  isModernMentionsAndEmojiAnimationsEnabled = [mEMORY[0x1E69A8070] isModernMentionsAndEmojiAnimationsEnabled];

  if (isModernMentionsAndEmojiAnimationsEnabled)
  {
    entryView = [(CKChatController *)self entryView];
    contentView = [entryView contentView];
    textView = [contentView textView];
    textStorage = [textView textStorage];
    [textStorage ck_addDisplayableAttributeForIMTextEffectAttribute];

    [entryView setTextEffectCoordinatorPaused:0 reason:@"resuming because mentions controller did finish animation."];
  }
}

- (id)preferredViewControllerForModalDetailPresentation
{
  _viewControllerForModalPresentation = [(CKChatController *)self _viewControllerForModalPresentation];
  v4 = _viewControllerForModalPresentation;
  if (_viewControllerForModalPresentation == self)
  {
    v5 = 0;
  }

  else
  {
    v5 = _viewControllerForModalPresentation;
  }

  return v5;
}

- (CKExternalPluginViewControllerProvider)externalPluginControllerProvider
{
  WeakRetained = objc_loadWeakRetained(&self->_externalPluginControllerProvider);

  return WeakRetained;
}

- (CGSize)lastLaidOutSize
{
  width = self->_lastLaidOutSize.width;
  height = self->_lastLaidOutSize.height;
  result.height = height;
  result.width = width;
  return result;
}

- (CGPoint)contentOffsetForFirstUnreadMessage
{
  x = self->_contentOffsetForFirstUnreadMessage.x;
  y = self->_contentOffsetForFirstUnreadMessage.y;
  result.y = y;
  result.x = x;
  return result;
}

- (CGPoint)initialContentOffset
{
  x = self->_initialContentOffset.x;
  y = self->_initialContentOffset.y;
  result.y = y;
  result.x = x;
  return result;
}

- (UIEdgeInsets)initialContentInset
{
  top = self->_initialContentInset.top;
  left = self->_initialContentInset.left;
  bottom = self->_initialContentInset.bottom;
  right = self->_initialContentInset.right;
  result.right = right;
  result.bottom = bottom;
  result.left = left;
  result.top = top;
  return result;
}

- (UIView)previewSourceView
{
  WeakRetained = objc_loadWeakRetained(&self->_previewSourceView);

  return WeakRetained;
}

- (id)currentDragPreviewContainer
{
  WeakRetained = objc_loadWeakRetained(&self->_currentDragPreviewContainer);

  return WeakRetained;
}

- (UIViewController)walletOrderImportViewController
{
  WeakRetained = objc_loadWeakRetained(&self->_walletOrderImportViewController);

  return WeakRetained;
}

- (CGRect)photoGridTapbackSnapshotRect
{
  x = self->_photoGridTapbackSnapshotRect.origin.x;
  y = self->_photoGridTapbackSnapshotRect.origin.y;
  width = self->_photoGridTapbackSnapshotRect.size.width;
  height = self->_photoGridTapbackSnapshotRect.size.height;
  result.size.height = height;
  result.size.width = width;
  result.origin.y = y;
  result.origin.x = x;
  return result;
}

- (CKAggregateAttachmentMessagePartChatItem)photoGridMomentShareChatItem
{
  WeakRetained = objc_loadWeakRetained(&self->_photoGridMomentShareChatItem);

  return WeakRetained;
}

- (CKMediaObjectAssetDataSourceManager)photoGridDataSourceManager
{
  WeakRetained = objc_loadWeakRetained(&self->_photoGridDataSourceManager);

  return WeakRetained;
}

- (id)selectedChatItems
{
  collectionViewController = [(CKCoreChatController *)self collectionViewController];
  selectedChatItems = [collectionViewController selectedChatItems];

  return selectedChatItems;
}

- (id)selectedChatItemsIncludingTapbackedChatItem
{
  v15[1] = *MEMORY[0x1E69E9840];
  selectedChatItems = [(CKChatController *)self selectedChatItems];
  if (![selectedChatItems count])
  {
    inlineReplyController = [(CKChatController *)self inlineReplyController];
    v5 = inlineReplyController;
    if (inlineReplyController)
    {
      selfCopy = inlineReplyController;
    }

    else
    {
      selfCopy = self;
    }

    v7 = selfCopy;

    clickyOrbChatItem = [(CKChatController *)v7 clickyOrbChatItem];

    if (clickyOrbChatItem)
    {
      clickyOrbChatItem2 = [(CKChatController *)v7 clickyOrbChatItem];

      v15[0] = clickyOrbChatItem2;
      [MEMORY[0x1E695DEC8] arrayWithObjects:v15 count:1];
      selectedChatItems = v10 = selectedChatItems;
    }

    else
    {
      clickyOrbChatItem2 = [(CKCoreChatController *)v7 fullScreenBalloonViewController];

      chatItem = [clickyOrbChatItem2 chatItem];
      v10 = chatItem;
      if (chatItem)
      {
        v14 = chatItem;
        v12 = [MEMORY[0x1E695DEC8] arrayWithObjects:&v14 count:1];

        selectedChatItems = v12;
      }
    }
  }

  return selectedChatItems;
}

- (BOOL)hasSelectedChatItems
{
  selectedChatItems = [(CKChatController *)self selectedChatItems];
  v3 = [selectedChatItems count] != 0;

  return v3;
}

- (BOOL)hasSelectedChatItemsIncludingAssociatedTapback
{
  selectedChatItemsIncludingTapbackedChatItem = [(CKChatController *)self selectedChatItemsIncludingTapbackedChatItem];
  v3 = [selectedChatItemsIncludingTapbackedChatItem count] != 0;

  return v3;
}

- (id)selectedMessagePartItem
{
  inlineReplyController = [(CKChatController *)self inlineReplyController];
  v4 = inlineReplyController;
  if (inlineReplyController)
  {
    selfCopy = inlineReplyController;
  }

  else
  {
    selfCopy = self;
  }

  v6 = selfCopy;

  selectedChatItemsIncludingTapbackedChatItem = [(CKChatController *)v6 selectedChatItemsIncludingTapbackedChatItem];

  if ([selectedChatItemsIncludingTapbackedChatItem count] == 1)
  {
    firstObject = [selectedChatItemsIncludingTapbackedChatItem firstObject];
    objc_opt_class();
    if (objc_opt_isKindOfClass())
    {
      v9 = firstObject;
    }

    else
    {
      v9 = 0;
    }
  }

  else
  {
    v9 = 0;
  }

  return v9;
}

- (id)lastOutgoingMessagePartItem
{
  inlineReplyController = [(CKChatController *)self inlineReplyController];
  v4 = inlineReplyController;
  if (inlineReplyController)
  {
    selfCopy = inlineReplyController;
  }

  else
  {
    selfCopy = self;
  }

  v6 = selfCopy;

  v12 = 0;
  v13 = &v12;
  v14 = 0x3032000000;
  v15 = __Block_byref_object_copy__12;
  v16 = __Block_byref_object_dispose__12;
  v17 = 0;
  collectionViewController = [(CKCoreChatController *)v6 collectionViewController];
  chatItems = [collectionViewController chatItems];
  v11[0] = MEMORY[0x1E69E9820];
  v11[1] = 3221225472;
  v11[2] = __66__CKChatController_ChatItemSelection__lastOutgoingMessagePartItem__block_invoke;
  v11[3] = &unk_1E72EEC48;
  v11[4] = &v12;
  [chatItems enumerateObjectsWithOptions:2 usingBlock:v11];

  v9 = v13[5];
  _Block_object_dispose(&v12, 8);

  return v9;
}

void __66__CKChatController_ChatItemSelection__lastOutgoingMessagePartItem__block_invoke(uint64_t a1, void *a2, uint64_t a3, _BYTE *a4)
{
  v10 = a2;
  objc_opt_class();
  isKindOfClass = objc_opt_isKindOfClass();
  v8 = v10;
  if (isKindOfClass)
  {
    v9 = v10;
    if ([v9 itemIsFromMe] && (objc_msgSend(v9, "itemIsReplyContextPreview") & 1) == 0)
    {
      objc_storeStrong((*(*(a1 + 32) + 8) + 40), a2);
      *a4 = 1;
    }

    v8 = v10;
  }
}

- (BOOL)allowDebugItems
{
  mEMORY[0x1E69A60F0] = [MEMORY[0x1E69A60F0] sharedInstance];
  isInternalInstall = [mEMORY[0x1E69A60F0] isInternalInstall];

  standardUserDefaults = [MEMORY[0x1E695E000] standardUserDefaults];
  v5 = [standardUserDefaults BOOLForKey:@"showTranscriptDebugButton"];

  return isInternalInstall & v5;
}

- (NSArray)internalBarButtonItems
{
  v9[2] = *MEMORY[0x1E69E9840];
  if ([(CKChatController *)self allowDebugItems])
  {
    v3 = [MEMORY[0x1E69DCAB8] systemImageNamed:@"wrench.and.screwdriver.fill"];
    _makeInternalMenu = [(CKChatController *)self _makeInternalMenu];
    v5 = [objc_alloc(MEMORY[0x1E69DC708]) initWithImage:v3 menu:_makeInternalMenu];
    [v5 setTag:100];
    flexibleSpaceItem = [MEMORY[0x1E69DC708] flexibleSpaceItem];
    v9[0] = v5;
    v9[1] = flexibleSpaceItem;
    v7 = [MEMORY[0x1E695DEC8] arrayWithObjects:v9 count:2];
  }

  else
  {
    v7 = MEMORY[0x1E695E0F0];
  }

  return v7;
}

- (id)_makeInternalMenu
{
  v17[2] = *MEMORY[0x1E69E9840];
  objc_initWeak(&location, self);
  v2 = MEMORY[0x1E69DC628];
  v14[0] = MEMORY[0x1E69E9820];
  v14[1] = 3221225472;
  v14[2] = __44__CKChatController_Debug___makeInternalMenu__block_invoke;
  v14[3] = &unk_1E72EBCD8;
  objc_copyWeak(&v15, &location);
  v3 = [v2 actionWithTitle:@"Show GUID Summary" image:0 identifier:0 handler:v14];
  v4 = MEMORY[0x1E69DC628];
  v9 = MEMORY[0x1E69E9820];
  v10 = 3221225472;
  v11 = __44__CKChatController_Debug___makeInternalMenu__block_invoke_2;
  v12 = &unk_1E72EBCD8;
  objc_copyWeak(&v13, &location);
  v5 = [v4 actionWithTitle:@"Chat Item Summary" image:0 identifier:0 handler:&v9];
  v17[0] = v5;
  v17[1] = v3;
  v6 = [MEMORY[0x1E695DEC8] arrayWithObjects:v17 count:{2, v9, v10, v11, v12}];
  v7 = [MEMORY[0x1E69DCC60] menuWithTitle:@"[Internal]" image:0 identifier:0 options:1 children:v6];

  objc_destroyWeak(&v13);
  objc_destroyWeak(&v15);
  objc_destroyWeak(&location);

  return v7;
}

void __44__CKChatController_Debug___makeInternalMenu__block_invoke(uint64_t a1)
{
  WeakRetained = objc_loadWeakRetained((a1 + 32));
  v4 = [WeakRetained _debugSelectedGuidSummary];

  v3 = objc_loadWeakRetained((a1 + 32));
  [v3 _presentAlertForDebugSummary:v4];
}

void __44__CKChatController_Debug___makeInternalMenu__block_invoke_2(uint64_t a1)
{
  WeakRetained = objc_loadWeakRetained((a1 + 32));
  v3 = [WeakRetained collectionViewController];

  v4 = [v3 selectedItems];
  v5 = [v3 chatItems];
  v6 = [v5 objectsAtIndexes:v4];

  v7 = [MEMORY[0x1E695DF70] array];
  v15[0] = MEMORY[0x1E69E9820];
  v15[1] = 3221225472;
  v15[2] = __44__CKChatController_Debug___makeInternalMenu__block_invoke_3;
  v15[3] = &unk_1E72EFBB0;
  v8 = v7;
  v16 = v8;
  [v4 enumerateIndexesUsingBlock:v15];
  v9 = objc_loadWeakRetained((a1 + 32));
  v10 = [v9 view];
  v11 = [v10 window];
  v12 = [v11 windowScene];
  v13 = [v12 delegate];

  objc_opt_class();
  if (objc_opt_isKindOfClass())
  {
    v14 = [v8 copy];
    [v13 showInspectorViewForChatItems:v6 parallelIndexes:v14];
  }
}

void __44__CKChatController_Debug___makeInternalMenu__block_invoke_3(uint64_t a1, uint64_t a2)
{
  v2 = *(a1 + 32);
  v3 = [MEMORY[0x1E696AD98] numberWithInteger:a2];
  [v2 addObject:v3];
}

- (void)_presentAlertForDebugSummary:(id)summary
{
  summaryCopy = summary;
  v5 = [MEMORY[0x1E69DC650] alertControllerWithTitle:&stru_1F04268F8 message:summaryCopy preferredStyle:1];
  v6 = MEMORY[0x1E69DC648];
  v10[0] = MEMORY[0x1E69E9820];
  v10[1] = 3221225472;
  v10[2] = __56__CKChatController_Debug___presentAlertForDebugSummary___block_invoke;
  v10[3] = &unk_1E72EBFE8;
  v11 = summaryCopy;
  v7 = summaryCopy;
  v8 = [v6 actionWithTitle:@"Copy" style:0 handler:v10];
  v9 = [MEMORY[0x1E69DC648] actionWithTitle:@"Cancel" style:1 handler:0];
  [v5 addAction:v8];
  [v5 addAction:v9];
  [(CKChatController *)self presentViewController:v5 animated:1 completion:0];
}

void __56__CKChatController_Debug___presentAlertForDebugSummary___block_invoke(uint64_t a1)
{
  v2 = [MEMORY[0x1E69DCD50] generalPasteboard];
  [v2 setString:*(a1 + 32)];
}

- (id)_debugSelectedGuidSummary
{
  collectionViewController = [(CKCoreChatController *)self collectionViewController];
  selectedItems = [collectionViewController selectedItems];
  chatItems = [collectionViewController chatItems];
  v5 = [chatItems objectsAtIndexes:selectedItems];

  string = [MEMORY[0x1E696AD60] string];
  if ([v5 count])
  {
    v7 = 0;
    do
    {
      v8 = [v5 objectAtIndexedSubscript:v7];
      iMChatItem = [v8 IMChatItem];
      guid = [iMChatItem guid];
      [string appendString:guid];

      if (v7 < [v5 count] - 1)
      {
        [string appendString:@"\n\n"];
      }

      ++v7;
    }

    while (v7 < [v5 count]);
  }

  v11 = [string copy];

  return v11;
}

- (id)_internalMenuForChatItem:(id)item
{
  v61[1] = *MEMORY[0x1E69E9840];
  itemCopy = item;
  selfCopy = self;
  objc_initWeak(&location, self);
  v5 = objc_alloc(MEMORY[0x1E69A8148]);
  iMChatItem = [itemCopy IMChatItem];
  guid = [iMChatItem guid];
  v8 = [v5 initWithEncodedMessagePartGUID:guid];
  messageGUID = [v8 messageGUID];

  v10 = MEMORY[0x1E69DC628];
  v11 = CKFrameworkBundle();
  v12 = [v11 localizedStringForKey:@"Message Details" value:&stru_1F04268F8 table:@"ChatKit"];
  v13 = [MEMORY[0x1E69DCAB8] systemImageNamed:@"info.circle"];
  v57[0] = MEMORY[0x1E69E9820];
  v57[1] = 3221225472;
  v57[2] = __52__CKChatController_Debug___internalMenuForChatItem___block_invoke;
  v57[3] = &unk_1E72EBF48;
  objc_copyWeak(&v59, &location);
  v14 = itemCopy;
  v58 = v14;
  v45 = [v10 actionWithTitle:v12 image:v13 identifier:0 handler:v57];

  v15 = MEMORY[0x1E69DC628];
  v16 = [MEMORY[0x1E69DCAB8] systemImageNamed:@"info.circle"];
  v54[0] = MEMORY[0x1E69E9820];
  v54[1] = 3221225472;
  v54[2] = __52__CKChatController_Debug___internalMenuForChatItem___block_invoke_2;
  v54[3] = &unk_1E72EBF48;
  objc_copyWeak(&v56, &location);
  v17 = v14;
  v55 = v17;
  v46 = [v15 actionWithTitle:@"Chat Item Details" image:v16 identifier:0 handler:v54];

  v18 = MEMORY[0x1E69DC628];
  v19 = CKFrameworkBundle();
  v20 = [v19 localizedStringForKey:@"Copy GUID" value:&stru_1F04268F8 table:@"ChatKit"];
  v21 = [MEMORY[0x1E69DCAB8] systemImageNamed:@"tag"];
  v52[0] = MEMORY[0x1E69E9820];
  v52[1] = 3221225472;
  v52[2] = __52__CKChatController_Debug___internalMenuForChatItem___block_invoke_268;
  v52[3] = &unk_1E72EC060;
  v22 = messageGUID;
  v53 = v22;
  v23 = [v18 actionWithTitle:v20 image:v21 identifier:0 handler:v52];

  v24 = MEMORY[0x1E69DC628];
  v25 = CKFrameworkBundle();
  v26 = [v25 localizedStringForKey:@"Copy Link" value:&stru_1F04268F8 table:@"ChatKit"];
  v27 = [MEMORY[0x1E69DCAB8] systemImageNamed:@"link"];
  v50[0] = MEMORY[0x1E69E9820];
  v50[1] = 3221225472;
  v50[2] = __52__CKChatController_Debug___internalMenuForChatItem___block_invoke_2_275;
  v50[3] = &unk_1E72EC060;
  v28 = v22;
  v51 = v28;
  v29 = [v24 actionWithTitle:v26 image:v27 identifier:0 handler:v50];

  v30 = MEMORY[0x1E69DC628];
  v31 = [MEMORY[0x1E69DCAB8] systemImageNamed:@"ant"];
  v47[0] = MEMORY[0x1E69E9820];
  v47[1] = 3221225472;
  v47[2] = __52__CKChatController_Debug___internalMenuForChatItem___block_invoke_3;
  v47[3] = &unk_1E72EFBD8;
  v32 = v17;
  v48 = v32;
  v49 = selfCopy;
  v33 = [v30 actionWithTitle:@"Tap-to-Radar" image:v31 identifier:0 handler:v47];

  v34 = objc_alloc_init(MEMORY[0x1E695DF70]);
  message = [v32 message];
  LOBYTE(itemCopy) = message == 0;

  if ((itemCopy & 1) == 0)
  {
    [v34 addObject:v33];
    [v34 addObject:v45];
  }

  [v34 addObject:v46];
  [v34 addObject:v23];
  [v34 addObject:v29];
  v36 = MEMORY[0x1E69DCC60];
  v37 = [MEMORY[0x1E69DCAB8] systemImageNamed:@"apple.logo"];
  v38 = [v34 copy];
  v39 = [v36 menuWithTitle:@"Internal" image:v37 identifier:0 options:0 children:v38];

  v40 = MEMORY[0x1E69DCC60];
  v61[0] = v39;
  v41 = [MEMORY[0x1E695DEC8] arrayWithObjects:v61 count:1];
  v42 = [v40 menuWithTitle:&stru_1F04268F8 image:0 identifier:0 options:1 children:v41];

  objc_destroyWeak(&v56);
  objc_destroyWeak(&v59);

  objc_destroyWeak(&location);

  return v42;
}

void __52__CKChatController_Debug___internalMenuForChatItem___block_invoke(uint64_t a1)
{
  WeakRetained = objc_loadWeakRetained((a1 + 40));
  v3 = [WeakRetained view];
  v4 = [v3 window];
  v5 = [v4 windowScene];
  v10 = [v5 delegate];

  v6 = [*(a1 + 32) message];
  if (v6)
  {
    v7 = v6;
    objc_opt_class();
    isKindOfClass = objc_opt_isKindOfClass();

    if (isKindOfClass)
    {
      v9 = [*(a1 + 32) message];
      [v10 showInspectorViewForMessage:v9];
    }
  }
}

void __52__CKChatController_Debug___internalMenuForChatItem___block_invoke_2(uint64_t a1)
{
  v15[1] = *MEMORY[0x1E69E9840];
  WeakRetained = objc_loadWeakRetained((a1 + 40));
  v3 = [WeakRetained collectionViewController];

  v4 = [v3 chatItems];
  v5 = [v4 indexOfObject:*(a1 + 32)];

  if (v5 == 0x7FFFFFFFFFFFFFFFLL)
  {
    v6 = &unk_1F04E7AB8;
  }

  else
  {
    v6 = [MEMORY[0x1E696AD98] numberWithInteger:v5];
  }

  v7 = objc_loadWeakRetained((a1 + 40));
  v8 = [v7 view];
  v9 = [v8 window];
  v10 = [v9 windowScene];
  v11 = [v10 delegate];

  objc_opt_class();
  if (objc_opt_isKindOfClass())
  {
    v15[0] = *(a1 + 32);
    v12 = [MEMORY[0x1E695DEC8] arrayWithObjects:v15 count:1];
    v14 = v6;
    v13 = [MEMORY[0x1E695DEC8] arrayWithObjects:&v14 count:1];
    [v11 showInspectorViewForChatItems:v12 parallelIndexes:v13];
  }
}

void __52__CKChatController_Debug___internalMenuForChatItem___block_invoke_268(uint64_t a1)
{
  v2 = [MEMORY[0x1E69DCD50] generalPasteboard];
  [v2 setString:*(a1 + 32)];
}

void __52__CKChatController_Debug___internalMenuForChatItem___block_invoke_2_275(uint64_t a1)
{
  v4 = [MEMORY[0x1E69DCD50] generalPasteboard];
  v2 = [MEMORY[0x1E696AEC0] stringWithFormat:@"messages://open?message-guid=%@", *(a1 + 32)];
  v3 = [MEMORY[0x1E695DFF8] URLWithString:v2];
  [v4 setURL:v3];
}

void __52__CKChatController_Debug___internalMenuForChatItem___block_invoke_3(uint64_t a1)
{
  v2 = [*(a1 + 32) message];
  v3 = [_TtC7ChatKit19TTRSheetViewFactory ttrSheetView:v2];

  [*(a1 + 40) presentViewController:v3 animated:1 completion:0];
}

- (void)effectPickerViewControllerClose:(id)close keepingSideMountContainer:(BOOL)container animated:(BOOL)animated
{
  closeCopy = close;
  effectPickerViewController = [(CKChatController *)self effectPickerViewController];

  if (effectPickerViewController == closeCopy)
  {
    entryView = [(CKChatController *)self entryView];
    composition = [entryView composition];
    isAudioComposition = [composition isAudioComposition];

    if ((isAudioComposition & 1) == 0)
    {
      entryView2 = [(CKChatController *)self entryView];
      contentView = [entryView2 contentView];
      [contentView setHidden:0];
    }

    effectPickerViewController2 = [(CKChatController *)self effectPickerViewController];
    [effectPickerViewController2 setDelegate:0];

    [(CKChatController *)self setEffectPickerViewController:0];
    [(CKChatController *)self setEffectPickerIsPresented:0];
    if (CKIsRunningInMacCatalyst())
    {
      v18[0] = MEMORY[0x1E69E9820];
      v18[1] = 3221225472;
      v18[2] = __107__CKChatController_ImpactEffectPicker__effectPickerViewControllerClose_keepingSideMountContainer_animated___block_invoke;
      v18[3] = &unk_1E72EBA18;
      v18[4] = self;
      [closeCopy dismissViewControllerAnimated:0 completion:v18];
      activeKeyboard = [MEMORY[0x1E69DCBB8] activeKeyboard];
      [activeKeyboard setTypingEnabled:1];
    }

    else
    {
      block[0] = MEMORY[0x1E69E9820];
      block[1] = 3221225472;
      block[2] = __107__CKChatController_ImpactEffectPicker__effectPickerViewControllerClose_keepingSideMountContainer_animated___block_invoke_2;
      block[3] = &unk_1E72ED8D8;
      animatedCopy = animated;
      block[4] = self;
      dispatch_async(MEMORY[0x1E69E96A0], block);
    }
  }
}

uint64_t __107__CKChatController_ImpactEffectPicker__effectPickerViewControllerClose_keepingSideMountContainer_animated___block_invoke_2(uint64_t a1)
{
  if (*(a1 + 40) == 1)
  {
    objc_initWeak(&location, *(a1 + 32));
    v2 = MEMORY[0x1E69DD250];
    v7[0] = MEMORY[0x1E69E9820];
    v7[1] = 3221225472;
    v7[2] = __107__CKChatController_ImpactEffectPicker__effectPickerViewControllerClose_keepingSideMountContainer_animated___block_invoke_3;
    v7[3] = &unk_1E72EBA18;
    v7[4] = *(a1 + 32);
    v5[0] = MEMORY[0x1E69E9820];
    v5[1] = 3221225472;
    v5[2] = __107__CKChatController_ImpactEffectPicker__effectPickerViewControllerClose_keepingSideMountContainer_animated___block_invoke_4;
    v5[3] = &unk_1E72EE728;
    objc_copyWeak(&v6, &location);
    [v2 animateWithDuration:32 delay:v7 options:v5 animations:0.2 completion:0.0];
    objc_destroyWeak(&v6);
    objc_destroyWeak(&location);
  }

  else
  {
    [*(a1 + 32) _resetEffectPickerViewController];
  }

  v3 = [MEMORY[0x1E69DCBB8] activeKeyboard];
  [v3 setTypingEnabled:1];

  return [*(a1 + 32) requestDismissKeyboardSnapshotForReason:4];
}

void __107__CKChatController_ImpactEffectPicker__effectPickerViewControllerClose_keepingSideMountContainer_animated___block_invoke_3(uint64_t a1)
{
  v1 = [*(a1 + 32) effectPickerWindow];
  [v1 setAlpha:0.0];
}

void __107__CKChatController_ImpactEffectPicker__effectPickerViewControllerClose_keepingSideMountContainer_animated___block_invoke_4(uint64_t a1)
{
  WeakRetained = objc_loadWeakRetained((a1 + 32));
  [WeakRetained _resetEffectPickerViewController];
}

- (void)_resetEffectPickerViewController
{
  effectPickerWindow = [(CKChatController *)self effectPickerWindow];
  [effectPickerWindow setAlpha:0.0];

  effectPickerWindow2 = [(CKChatController *)self effectPickerWindow];
  [effectPickerWindow2 setRootViewController:0];

  effectPickerWindow3 = [(CKChatController *)self effectPickerWindow];
  [effectPickerWindow3 setHidden:1];

  [(CKChatController *)self setEffectPickerWindow:0];
}

- (void)effectPickerViewController:(id)controller effectWithIdentifierSelected:(id)selected
{
  selectedCopy = selected;
  entryView = [(CKChatController *)self entryView];
  contentView = [entryView contentView];
  [contentView setHidden:0];

  v9[0] = MEMORY[0x1E69E9820];
  v9[1] = 3221225472;
  v9[2] = __96__CKChatController_ImpactEffectPicker__effectPickerViewController_effectWithIdentifierSelected___block_invoke;
  v9[3] = &unk_1E72EE370;
  v10 = selectedCopy;
  selfCopy = self;
  v8 = selectedCopy;
  [entryView compositionWithAcceptedAutocorrection:v9];
}

void __96__CKChatController_ImpactEffectPicker__effectPickerViewController_effectWithIdentifierSelected___block_invoke(uint64_t a1, void *a2)
{
  v4 = [a2 compositionWithExpressiveSendStyleID:*(a1 + 32)];
  [*(a1 + 40) selectAccountAndSendComposition:v4 completion:&__block_literal_global_60];
  v3 = [MEMORY[0x1E69DCBB8] activeKeyboard];
  [v3 setTypingEnabled:1];
}

- (BOOL)isMainTranscript
{
  delegate = [(CKCoreChatController *)self delegate];
  if (delegate)
  {
    objc_opt_class();
    isKindOfClass = objc_opt_isKindOfClass();
  }

  else
  {
    isKindOfClass = 0;
  }

  return isKindOfClass & 1;
}

- (BOOL)isInlineReply
{
  delegate = [(CKCoreChatController *)self delegate];
  if (delegate)
  {
    isKindOfClass = 0;
  }

  else
  {
    parentViewController = [(CKChatController *)self parentViewController];
    objc_opt_class();
    isKindOfClass = objc_opt_isKindOfClass();
  }

  return isKindOfClass & 1;
}

- (BOOL)isChatControllerShowingStandaloneWindow:(id)window
{
  delegate = [window delegate];
  objc_opt_class();
  isKindOfClass = objc_opt_isKindOfClass();

  return isKindOfClass & 1;
}

- (void)validateCommand:(id)command
{
  commandCopy = command;
  if (!CKIsRunningInMacCatalyst() && (_CKUIEnhancedMainMenuEnabled() & 1) == 0)
  {
    if ([commandCopy action] == sel_keyCommandApplyTextStyle_)
    {
      entryView = [(CKChatController *)self entryView];
      contentView = [entryView contentView];
      canApplyTextStyleFromKeyCommand = [contentView canApplyTextStyleFromKeyCommand];
    }

    else
    {
      if ([commandCopy action] != sel_keyCommandApplyTextEffect_)
      {
        v105.receiver = self;
        v105.super_class = CKChatController;
        [(CKChatController *)&v105 validateCommand:commandCopy];
        goto LABEL_84;
      }

      entryView = [(CKChatController *)self entryView];
      contentView = [entryView contentView];
      canApplyTextStyleFromKeyCommand = [contentView canApplyTextEffectFromKeyCommand];
    }

LABEL_53:
    v33 = canApplyTextStyleFromKeyCommand;

    attributes = [commandCopy attributes];
    if (v33)
    {
LABEL_54:
      v21 = attributes & 0xFFFFFFFFFFFFFFFELL;
LABEL_82:
      v20 = commandCopy;
      goto LABEL_83;
    }

    goto LABEL_81;
  }

  v104.receiver = self;
  v104.super_class = CKChatController;
  [(CKChatController *)&v104 validateCommand:commandCopy];
  if ([commandCopy action] == sel_keyCommandDeleteConversation_)
  {
    conversation = [(CKCoreChatController *)self conversation];

    if (!conversation)
    {
      v20 = commandCopy;
      v21 = 1;
LABEL_83:
      [v20 setAttributes:v21];
      goto LABEL_84;
    }
  }

  if ([commandCopy action] == sel_keyCommandSend_)
  {
    entryView = [(CKChatController *)self entryView];
    contentView = [entryView composition];
    canApplyTextStyleFromKeyCommand = [contentView hasContent];
    goto LABEL_53;
  }

  if ([commandCopy action] == sel_keyCommandReply_)
  {
    inlineReplyController = [(CKChatController *)self inlineReplyController];
    if (inlineReplyController)
    {
LABEL_40:

      goto LABEL_41;
    }

    objc_opt_class();
    if (objc_opt_isKindOfClass())
    {
LABEL_41:
      [commandCopy setAttributes:{objc_msgSend(commandCopy, "attributes") & 0xFFFFFFFFFFFFFFFELL}];
      v22 = CKFrameworkBundle();
      contentView2 = v22;
      v23 = @"HIDE_REPLIES";
LABEL_42:
      v24 = [v22 localizedStringForKey:v23 value:&stru_1F04268F8 table:@"ChatKit"];
      [commandCopy setTitle:v24];

      goto LABEL_43;
    }

    selectedChatItems = [(CKChatController *)self selectedChatItems];
    v17 = [selectedChatItems count];

    if (v17 <= 1)
    {
      conversation2 = [(CKCoreChatController *)self conversation];
      chat = [conversation2 chat];
      if ([chat isBusinessChat])
      {
      }

      else
      {
        isShowingOscarChat = [(CKChatController *)self isShowingOscarChat];

        if (!isShowingOscarChat)
        {
          [commandCopy setAttributes:{objc_msgSend(commandCopy, "attributes") & 0xFFFFFFFFFFFFFFFELL}];
          contentView2 = CKFrameworkBundle();
          if (v17 == 1)
          {
            v23 = @"REPLY_TO_MESSAGE";
          }

          else
          {
            v23 = @"REPLY_TO_LAST_MESSAGE";
          }

          goto LABEL_105;
        }
      }
    }

    attributes = [commandCopy attributes];
LABEL_81:
    v21 = attributes | 1;
    goto LABEL_82;
  }

  if ([commandCopy action] == sel_keyCommandReplyAlternate_)
  {
    inlineReplyController = [(CKChatController *)self inlineReplyController];
    if (!inlineReplyController)
    {
      objc_opt_class();
      if ((objc_opt_isKindOfClass() & 1) == 0)
      {
        v98 = 0;
        v99 = &v98;
        v100 = 0x3032000000;
        v101 = __Block_byref_object_copy__21;
        v102 = __Block_byref_object_dispose__21;
        v103 = 0;
        collectionViewController = [(CKCoreChatController *)self collectionViewController];
        chatItems = [collectionViewController chatItems];
        v97[0] = MEMORY[0x1E69E9820];
        v97[1] = 3221225472;
        v97[2] = __45__CKChatController_MenuBar__validateCommand___block_invoke;
        v97[3] = &unk_1E72EEC48;
        v97[4] = &v98;
        [chatItems enumerateObjectsWithOptions:2 usingBlock:v97];

        v37 = CKFrameworkBundle();
        v38 = [v37 localizedStringForKey:@"REPLY_TO_REPLY" value:&stru_1F04268F8 table:@"ChatKit"];
        [commandCopy setTitle:v38];

        if (v99[5] && ![(CKChatController *)self isShowingOscarChat])
        {
          v39 = [commandCopy attributes] & 0xFFFFFFFFFFFFFFFELL;
        }

        else
        {
          v39 = [commandCopy attributes] | 1;
        }

        [commandCopy setAttributes:v39];
        _Block_object_dispose(&v98, 8);

        goto LABEL_84;
      }

      goto LABEL_41;
    }

    goto LABEL_40;
  }

  if ([commandCopy action] == sel_keyCommandTapback_)
  {
    inlineReplyController2 = [(CKChatController *)self inlineReplyController];
    v26 = inlineReplyController2;
    if (inlineReplyController2)
    {
      selfCopy = inlineReplyController2;
    }

    else
    {
      selfCopy = self;
    }

    chat2 = selfCopy;

    if ([(CKChatController *)chat2 isFullScreenBalloonViewOnScreen])
    {
      [commandCopy setAttributes:{objc_msgSend(commandCopy, "attributes") & 0xFFFFFFFFFFFFFFFELL}];
      v29 = CKFrameworkBundle();
      firstObject = v29;
      v31 = @"HIDE_TAPBACKS";
    }

    else
    {
      selectedChatItems2 = [(CKChatController *)self selectedChatItems];
      v41 = [selectedChatItems2 count];

      if (v41 > 1 || [(CKChatController *)self isShowingOscarChat])
      {
        goto LABEL_62;
      }

      [commandCopy setAttributes:{objc_msgSend(commandCopy, "attributes") & 0xFFFFFFFFFFFFFFFELL}];
      if (v41 == 1)
      {
        selectedChatItems3 = [(CKChatController *)self selectedChatItems];
        firstObject = [selectedChatItems3 firstObject];

        if ([firstObject itemIsReplyContextPreview])
        {
          [commandCopy setAttributes:{objc_msgSend(commandCopy, "attributes") | 1}];
        }

        v32 = CKFrameworkBundle();
        v50 = [v32 localizedStringForKey:@"TAPBACK_MESSAGE" value:&stru_1F04268F8 table:@"ChatKit"];
        [commandCopy setTitle:v50];

        goto LABEL_51;
      }

      v29 = CKFrameworkBundle();
      firstObject = v29;
      v31 = @"TAPBACK_LAST_MESSAGE";
    }

LABEL_50:
    v32 = [v29 localizedStringForKey:v31 value:&stru_1F04268F8 table:@"ChatKit"];
    [commandCopy setTitle:v32];
LABEL_51:

LABEL_68:
    goto LABEL_84;
  }

  if ([commandCopy action] == sel_keyCommandEditMessage_)
  {
    [(CKChatController *)self _configureEditMessageCommand:commandCopy];
    goto LABEL_84;
  }

  if ([commandCopy action] == sel_showContactCardFromBuddyMenu_)
  {
    conversation3 = [(CKCoreChatController *)self conversation];
    chat2 = [conversation3 chat];

    if (!chat2 || [(CKChatController *)chat2 isBusinessChat])
    {
      v43 = commandCopy;
      isBusinessChat = 1;
      goto LABEL_67;
    }

    chatStyle = [(CKChatController *)chat2 chatStyle];
    [commandCopy setAttributes:chatStyle != 45];
    if (chatStyle != 45)
    {
      goto LABEL_68;
    }

    _recipientHandle = [(CKChatController *)self _recipientHandle];
    isContact = [_recipientHandle isContact];

    if (isContact)
    {
      goto LABEL_68;
    }

    v29 = CKFrameworkBundle();
    firstObject = v29;
    v31 = @"ADD_TO_CONTACTS";
    goto LABEL_50;
  }

  if ([commandCopy action] == sel_toggleDetailsFromConversationsMenu_)
  {
    conversation4 = [(CKCoreChatController *)self conversation];
    allowsShowingDetailsView = [conversation4 allowsShowingDetailsView];

    v21 = allowsShowingDetailsView ^ 1u;
    goto LABEL_82;
  }

  if ([commandCopy action] == sel_toggleUnreadState_)
  {
    conversation5 = [(CKCoreChatController *)self conversation];
    hasUnreadMessages = [conversation5 hasUnreadMessages];

    contentView2 = CKFrameworkBundle();
    if (hasUnreadMessages)
    {
      v23 = @"MARK_AS_READ";
    }

    else
    {
      v23 = @"MARK_AS_UNREAD";
    }

LABEL_105:
    v22 = contentView2;
    goto LABEL_42;
  }

  if ([commandCopy action] == sel_toggleHideAlerts_)
  {
    conversation6 = [(CKCoreChatController *)self conversation];
    contentView2 = conversation6;
    if (conversation6)
    {
      [commandCopy setState:{objc_msgSend(conversation6, "isMuted")}];
      v56 = [commandCopy attributes] & 0xFFFFFFFFFFFFFFFELL;
    }

    else
    {
      [commandCopy setState:0];
      v56 = [commandCopy attributes] | 1;
    }

    [commandCopy setAttributes:v56];
    goto LABEL_43;
  }

  if ([commandCopy action] == sel_blockUserFromBuddyMenu_)
  {
    conversation7 = [(CKCoreChatController *)self conversation];
    chat2 = [conversation7 chat];

    if (chat2 && ([(CKChatController *)chat2 isBusinessChat]& 1) == 0 && [(CKChatController *)chat2 chatStyle]== 45)
    {
      _recipientHandle2 = [(CKChatController *)self _recipientHandle];
      isLoginIMHandle = [_recipientHandle2 isLoginIMHandle];
      attributes2 = [commandCopy attributes];
      if (isLoginIMHandle)
      {
        [commandCopy setAttributes:attributes2 | 1];
        v61 = 0;
      }

      else
      {
        [commandCopy setAttributes:attributes2 & 0xFFFFFFFFFFFFFFFELL];
        v61 = [(CKChatController *)self handleIsBlocked:_recipientHandle2];
      }

      [commandCopy setState:v61];
    }

    else
    {
      [commandCopy setAttributes:{objc_msgSend(commandCopy, "attributes") | 1}];
      [commandCopy setState:0];
    }

    goto LABEL_68;
  }

  if ([commandCopy action] == sel_sendEmailFromBuddyMenu_)
  {
    chat2 = [(CKCoreChatController *)self conversation];
    _recipientHandle3 = [(CKChatController *)self _recipientHandle];
    email = [_recipientHandle3 email];
    if (email)
    {
      v64 = email;
      recipients = [(CKChatController *)chat2 recipients];
      v66 = [recipients count];

      if (v66 == 1)
      {
        goto LABEL_109;
      }
    }

    else
    {
    }

    goto LABEL_62;
  }

  if ([commandCopy action] == sel_sendFileFromBuddyMenu_)
  {
    conversation8 = [(CKCoreChatController *)self conversation];
    chat2 = [conversation8 chat];

    isBusinessChat = chat2 == 0;
    goto LABEL_63;
  }

  if ([commandCopy action] == sel_askToShareScreenFromBuddyMenu_ || objc_msgSend(commandCopy, "action") == sel_inviteToShareScreenFromBuddyMenu_)
  {
    conversation9 = [(CKCoreChatController *)self conversation];
    chat2 = [conversation9 recipient];

    if (!chat2)
    {
      goto LABEL_62;
    }

    detailsContactsManager = [(CKChatController *)self detailsContactsManager];
    v69 = [detailsContactsManager showScreenSharingButtonForEntity:chat2];
    goto LABEL_108;
  }

  if ([commandCopy action] == sel_faceTimeAudioFromBuddyMenu_ || objc_msgSend(commandCopy, "action") == sel_faceTimeVideoFromBuddyMenu_)
  {
    conversation10 = [(CKCoreChatController *)self conversation];
    isGroupConversation = [conversation10 isGroupConversation];

    conversation11 = [(CKCoreChatController *)self conversation];
    chat2 = [conversation11 chat];

    if (!isGroupConversation)
    {
      if (chat2)
      {
        isBusinessChat = [(CKChatController *)chat2 isBusinessChat];
      }

      else
      {
        isBusinessChat = 1;
      }

      goto LABEL_63;
    }

    if ([commandCopy action] == sel_faceTimeAudioFromBuddyMenu_)
    {
      v83 = CKFrameworkBundle();
      v84 = [v83 localizedStringForKey:@"GROUP_FACETIME_AUDIO" value:&stru_1F04268F8 table:@"ChatKit"];
      [commandCopy setTitle:v84];

      if (!chat2 || ([(CKChatController *)chat2 isBusinessChat]& 1) != 0)
      {
        goto LABEL_62;
      }

      detailsContactsManager = [(CKCoreChatController *)self conversation];
      v69 = [CKFaceTimeUtilities isFaceTimeAudioAvailable:detailsContactsManager];
    }

    else
    {
      if ([commandCopy action] != sel_faceTimeVideoFromBuddyMenu_)
      {
        goto LABEL_68;
      }

      v75 = CKFrameworkBundle();
      v76 = [v75 localizedStringForKey:@"GROUP_FACETIME_VIDEO" value:&stru_1F04268F8 table:@"ChatKit"];
      [commandCopy setTitle:v76];

      if (!chat2 || ([(CKChatController *)chat2 isBusinessChat]& 1) != 0)
      {
        goto LABEL_62;
      }

      detailsContactsManager = [(CKCoreChatController *)self conversation];
      v69 = [CKFaceTimeUtilities isFaceTimeVideoAvailable:detailsContactsManager];
    }

LABEL_108:
    v70 = v69;

    if (v70)
    {
LABEL_109:
      isBusinessChat = [commandCopy attributes] & 0xFFFFFFFFFFFFFFFELL;
      goto LABEL_63;
    }

LABEL_62:
    isBusinessChat = [commandCopy attributes] | 1;
LABEL_63:
    v43 = commandCopy;
LABEL_67:
    [v43 setAttributes:isBusinessChat];
    goto LABEL_68;
  }

  if ([commandCopy action] == sel_keyCommandApplyTextEffect_)
  {
    entryView2 = [(CKChatController *)self entryView];
    contentView2 = [entryView2 contentView];

    [commandCopy setAttributes:{objc_msgSend(commandCopy, "attributes") & 0xFFFFFFFFFFFFFFFELL | objc_msgSend(contentView2, "canApplyTextEffectFromKeyCommand") ^ 1}];
    [commandCopy setState:0];
    propertyList = [commandCopy propertyList];
    objc_opt_class();
    isKindOfClass = objc_opt_isKindOfClass();

    if (isKindOfClass)
    {
      propertyList2 = [commandCopy propertyList];
      integerValue = [propertyList2 integerValue];

      v82 = integerValue == [contentView2 activeTextEffectTypeInSelectedRange];
LABEL_138:
      [commandCopy setState:v82];
      goto LABEL_43;
    }

    goto LABEL_43;
  }

  if ([commandCopy action] == sel_keyCommandApplyTextStyle_)
  {
    entryView3 = [(CKChatController *)self entryView];
    contentView2 = [entryView3 contentView];

    [commandCopy setState:0];
    propertyList3 = [commandCopy propertyList];
    objc_opt_class();
    v87 = objc_opt_isKindOfClass();

    if (v87)
    {
      propertyList4 = [commandCopy propertyList];
      integerValue2 = [propertyList4 integerValue];

      canApplyTextStyleFromKeyCommand2 = [contentView2 canApplyTextStyleFromKeyCommand];
      if (integerValue2 == 2 && canApplyTextStyleFromKeyCommand2)
      {
        v91 = +[CKUIBehavior sharedBehaviors];
        balloonTextFont = [v91 balloonTextFont];

        selectedText = [contentView2 selectedText];
        v94 = [balloonTextFont ck_canToggleItalicTraitInText:selectedText];

        if ((v94 & 1) == 0)
        {
LABEL_132:
          v95 = [commandCopy attributes] | 1;
LABEL_137:
          [commandCopy setAttributes:v95];
          v82 = ([contentView2 activeTextStylesInSelectedRange] & integerValue2) != 0;
          goto LABEL_138;
        }
      }

      else if (!canApplyTextStyleFromKeyCommand2)
      {
        goto LABEL_132;
      }

      v95 = [commandCopy attributes] & 0xFFFFFFFFFFFFFFFELL;
      goto LABEL_137;
    }

LABEL_43:

    goto LABEL_84;
  }

  if ([commandCopy action] == sel_selectedQuickLook_)
  {
    shouldQuickLookSelectedChatItem = [(CKChatController *)self shouldQuickLookSelectedChatItem];
    attributes = [commandCopy attributes];
    if (!shouldQuickLookSelectedChatItem)
    {
      goto LABEL_81;
    }

    goto LABEL_54;
  }

  if ([commandCopy action] == sel_keyCommandToggleTimeStamp_)
  {
    contentView2 = [(CKCoreChatController *)self collectionViewController];
    isShowingTranscriptTimestamps = [contentView2 isShowingTranscriptTimestamps];
    v8 = CKFrameworkBundle();
    v9 = v8;
    if (isShowingTranscriptTimestamps)
    {
      v10 = @"HIDE_TRANSCRIPT_TIMESTAMPS";
    }

    else
    {
      v10 = @"SHOW_TRANSCRIPT_TIMESTAMPS";
    }

    v11 = [v8 localizedStringForKey:v10 value:&stru_1F04268F8 table:@"ChatKit"];
    [commandCopy setTitle:v11];

    goto LABEL_43;
  }

LABEL_84:
}

void __45__CKChatController_MenuBar__validateCommand___block_invoke(uint64_t a1, void *a2, uint64_t a3, _BYTE *a4)
{
  v10 = a2;
  objc_opt_class();
  isKindOfClass = objc_opt_isKindOfClass();
  v8 = v10;
  if (isKindOfClass)
  {
    v9 = v10;
    if ([v9 itemIsReply])
    {
      objc_storeStrong((*(*(a1 + 32) + 8) + 40), a2);
      *a4 = 1;
    }

    v8 = v10;
  }
}

- (id)_recipientHandle
{
  conversation = [(CKCoreChatController *)self conversation];
  v3 = conversation;
  if (conversation && ([conversation recipient], (v4 = objc_claimAutoreleasedReturnValue()) != 0))
  {
    v5 = v4;
    defaultIMHandle = [v4 defaultIMHandle];
  }

  else
  {
    defaultIMHandle = 0;
  }

  return defaultIMHandle;
}

- (void)toggleUnreadState:(id)state
{
  stateCopy = state;
  selfCopy = self;
  if (selfCopy && (objc_opt_respondsToSelector() & 1) != 0)
  {
    [(CKChatController *)selfCopy keyCommandToggleUnreadState];
  }
}

- (void)blockUserFromBuddyMenu:(id)menu
{
  conversation = [(CKCoreChatController *)self conversation];
  recipient = [conversation recipient];
  defaultIMHandle = [recipient defaultIMHandle];

  if (([defaultIMHandle isLoginIMHandle] & 1) == 0)
  {
    if ([(CKChatController *)self handleIsBlocked:defaultIMHandle])
    {
      mEMORY[0x1E69A7F20] = [MEMORY[0x1E69A7F20] sharedBlockList];
      cnContact = [defaultIMHandle cnContact];
      [mEMORY[0x1E69A7F20] unblockContact:cnContact];
    }

    else
    {
      [(CKChatController *)self presentBlockPersonAlertWithHandle:defaultIMHandle];
    }
  }
}

- (void)presentBlockPersonAlertWithHandle:(id)handle
{
  handleCopy = handle;
  v4 = MEMORY[0x1E696AEC0];
  v5 = CKFrameworkBundle();
  v6 = [v5 localizedStringForKey:@"BLOCK_PERSON_ALERT_TITLE" value:&stru_1F04268F8 table:@"ChatKit"];
  name = [handleCopy name];
  v8 = [v4 stringWithFormat:v6, name];

  mEMORY[0x1E69DC668] = [MEMORY[0x1E69DC668] sharedApplication];
  userInterfaceLayoutDirection = [mEMORY[0x1E69DC668] userInterfaceLayoutDirection];

  if (userInterfaceLayoutDirection == 1)
  {
    v11 = @"\u200F";
  }

  else
  {
    v11 = @"\u200E";
  }

  v12 = [(__CFString *)v11 stringByAppendingString:v8];

  v13 = MEMORY[0x1E696AEC0];
  v14 = CKFrameworkBundle();
  v15 = [v14 localizedStringForKey:@"BLOCK_PERSON_ALERT_TEXT" value:&stru_1F04268F8 table:@"ChatKit"];
  nameAndID = [handleCopy nameAndID];
  v17 = [v13 stringWithFormat:v15, nameAndID];

  mEMORY[0x1E69DC668]2 = [MEMORY[0x1E69DC668] sharedApplication];
  userInterfaceLayoutDirection2 = [mEMORY[0x1E69DC668]2 userInterfaceLayoutDirection];

  if (userInterfaceLayoutDirection2 == 1)
  {
    v20 = @"\u200F";
  }

  else
  {
    v20 = @"\u200E";
  }

  v21 = [(__CFString *)v20 stringByAppendingString:v17];

  v22 = [MEMORY[0x1E69DC650] alertControllerWithTitle:v12 message:v21 preferredStyle:1];
  v23 = CKFrameworkBundle();
  v24 = [v23 localizedStringForKey:@"BLOCK" value:&stru_1F04268F8 table:@"ChatKit"];
  v31[0] = MEMORY[0x1E69E9820];
  v31[1] = 3221225472;
  v31[2] = __63__CKChatController_MenuBar__presentBlockPersonAlertWithHandle___block_invoke;
  v31[3] = &unk_1E72EBFE8;
  v32 = handleCopy;
  v25 = handleCopy;
  v26 = [CKAlertAction actionWithTitle:v24 style:0 handler:v31];
  [v22 addAction:v26];

  v27 = CKFrameworkBundle();
  v28 = [v27 localizedStringForKey:@"CANCEL" value:&stru_1F04268F8 table:@"ChatKit"];
  v29 = [CKAlertAction actionWithTitle:v28 style:1 handler:0];
  [v22 addAction:v29];

  [(CKChatController *)self presentViewController:v22 animated:1 completion:0];
}

void __63__CKChatController_MenuBar__presentBlockPersonAlertWithHandle___block_invoke(uint64_t a1)
{
  v3 = [MEMORY[0x1E69A7F20] sharedBlockList];
  v2 = [*(a1 + 32) cnContact];
  [v3 blockContact:v2];
}

- (void)toggleDetailsFromConversationsMenu:(id)menu
{
  menuCopy = menu;
  selfCopy = self;
  if (selfCopy && (objc_opt_respondsToSelector() & 1) != 0)
  {
    [(CKChatController *)selfCopy keyCommandToggleDetails];
  }
}

- (void)sendEmailFromBuddyMenu:(id)menu
{
  conversation = [(CKCoreChatController *)self conversation];
  recipient = [conversation recipient];
  defaultIMHandle = [recipient defaultIMHandle];

  if (defaultIMHandle)
  {
    v6 = MEMORY[0x1E695DFF8];
    v7 = MEMORY[0x1E696AEC0];
    email = [defaultIMHandle email];
    v9 = [v7 stringWithFormat:@"mailto:%@", email];
    v10 = [v6 URLWithString:v9];

    mEMORY[0x1E69DC668] = [MEMORY[0x1E69DC668] sharedApplication];
    v13[0] = MEMORY[0x1E69E9820];
    v13[1] = 3221225472;
    v13[2] = __52__CKChatController_MenuBar__sendEmailFromBuddyMenu___block_invoke;
    v13[3] = &unk_1E72EB9C8;
    v14 = v10;
    v12 = v10;
    [mEMORY[0x1E69DC668] openURL:v12 options:MEMORY[0x1E695E0F8] completionHandler:v13];
  }
}

void __52__CKChatController_MenuBar__sendEmailFromBuddyMenu___block_invoke(uint64_t a1, int a2)
{
  v11 = *MEMORY[0x1E69E9840];
  if (IMOSLoggingEnabled())
  {
    v4 = OSLogHandleForIMFoundationCategory();
    if (os_log_type_enabled(v4, OS_LOG_TYPE_INFO))
    {
      v5 = @"NO";
      v6 = *(a1 + 32);
      if (a2)
      {
        v5 = @"YES";
      }

      v7 = 138412546;
      v8 = v6;
      v9 = 2112;
      v10 = v5;
      _os_log_impl(&dword_19020E000, v4, OS_LOG_TYPE_INFO, "Opened URL: %@ successfully: %@", &v7, 0x16u);
    }
  }
}

- (void)showContactCardFromBuddyMenu:(id)menu
{
  _recipientHandle = [(CKChatController *)self _recipientHandle];
  cnContact = [_recipientHandle cnContact];
  if (!cnContact)
  {
    goto LABEL_8;
  }

  v5 = cnContact;
  cnContact2 = [_recipientHandle cnContact];
  identifier = [cnContact2 identifier];
  if (!identifier)
  {
    goto LABEL_7;
  }

  v8 = identifier;
  cnContact3 = [_recipientHandle cnContact];
  identifier2 = [cnContact3 identifier];
  if (![identifier2 length])
  {

LABEL_7:
    goto LABEL_8;
  }

  cnContact4 = [_recipientHandle cnContact];
  hasBeenPersisted = [cnContact4 hasBeenPersisted];

  if (hasBeenPersisted)
  {
    defaultWorkspace = [MEMORY[0x1E6963608] defaultWorkspace];
    v14 = MEMORY[0x1E695DFF8];
    v15 = MEMORY[0x1E696AEC0];
    cnContact5 = [_recipientHandle cnContact];
    identifier3 = [cnContact5 identifier];
    v18 = [v15 stringWithFormat:@"contact://show?id=%@", identifier3];
    v19 = [v14 URLWithString:v18];
    [defaultWorkspace openSensitiveURL:v19 withOptions:0];

    goto LABEL_9;
  }

LABEL_8:
  defaultWorkspace = [_recipientHandle cnContactWithKeys:MEMORY[0x1E695E0F0]];
  [(CKChatController *)self presentAddContactViewController:defaultWorkspace];
LABEL_9:
}

- (void)presentAddContactViewController:(id)controller
{
  controllerCopy = controller;
  if (controllerCopy)
  {
    v5 = [MEMORY[0x1E695D148] viewControllerForNewContact:controllerCopy];
    mEMORY[0x1E69A7FD0] = [MEMORY[0x1E69A7FD0] sharedInstance];
    getContactStore = [mEMORY[0x1E69A7FD0] getContactStore];
    [v5 setContactStore:getContactStore];

    [v5 setDelegate:self];
    v8 = [objc_alloc(MEMORY[0x1E69DCCD8]) initWithRootViewController:v5];
    selfCopy = self;
    presentedViewController = [(CKChatController *)selfCopy presentedViewController];

    if (presentedViewController)
    {
      presentedViewController2 = [(CKChatController *)selfCopy presentedViewController];

      selfCopy = presentedViewController2;
    }

    [(CKChatController *)selfCopy presentViewController:v8 animated:1 completion:0];
  }

  else
  {
    if (!IMOSLoggingEnabled())
    {
      goto LABEL_6;
    }

    v5 = OSLogHandleForIMFoundationCategory();
    if (os_log_type_enabled(v5, OS_LOG_TYPE_INFO))
    {
      *v12 = 0;
      _os_log_impl(&dword_19020E000, v5, OS_LOG_TYPE_INFO, "Could not add CNContact because it was nil", v12, 2u);
    }
  }

LABEL_6:
}

- (void)sendFileFromBuddyMenu:(id)menu
{
  v4 = objc_alloc(MEMORY[0x1E69DC968]);
  v5 = +[CKUIBehavior sharedBehaviors];
  acceptableUTIs = [v5 acceptableUTIs];
  v7 = [v4 initWithDocumentTypes:acceptableUTIs inMode:0];

  [v7 setDelegate:self];
  [v7 setAllowsMultipleSelection:0];
  [(CKChatController *)self presentViewController:v7 animated:1 completion:0];
}

- (void)faceTimeAudioFromBuddyMenu:(id)menu
{
  menuCopy = menu;
  selfCopy = self;
  if (selfCopy && (objc_opt_respondsToSelector() & 1) != 0)
  {
    [(CKChatController *)selfCopy beginFacetimeCallWithVideo:0];
  }
}

- (void)faceTimeVideoFromBuddyMenu:(id)menu
{
  menuCopy = menu;
  selfCopy = self;
  if (selfCopy && (objc_opt_respondsToSelector() & 1) != 0)
  {
    [(CKChatController *)selfCopy beginFacetimeCallWithVideo:1];
  }
}

- (void)relayPhoneCallFromBuddyMenu:(id)menu
{
  menuCopy = menu;
  objc_opt_class();
  isKindOfClass = objc_opt_isKindOfClass();
  v5 = menuCopy;
  if (isKindOfClass)
  {
    propertyList = [menuCopy propertyList];
    objc_opt_class();
    if (objc_opt_isKindOfClass())
    {
      [(CKChatController *)self performRelayPhoneCall:propertyList];
    }

    v5 = menuCopy;
  }
}

- (void)performRelayPhoneCall:(id)call
{
  v17 = *MEMORY[0x1E69E9840];
  callCopy = call;
  if ([callCopy _appearsToBePhoneNumber])
  {
    v4 = objc_alloc_init(MEMORY[0x1E69D8A90]);
    v5 = objc_alloc(MEMORY[0x1E69D8BD0]);
    defaultProvider = [v4 defaultProvider];
    v7 = [v5 initWithProvider:defaultProvider];

    v8 = [objc_alloc(MEMORY[0x1E69D8C00]) initWithType:2 value:callCopy];
    [v7 setHandle:v8];
    v9 = [v7 URL];
    if (v9)
    {
      mEMORY[0x1E69DC668] = [MEMORY[0x1E69DC668] sharedApplication];
      v13[0] = MEMORY[0x1E69E9820];
      v13[1] = 3221225472;
      v13[2] = __51__CKChatController_MenuBar__performRelayPhoneCall___block_invoke;
      v13[3] = &unk_1E72EB9C8;
      v14 = v9;
      [mEMORY[0x1E69DC668] openURL:v14 options:MEMORY[0x1E695E0F8] completionHandler:v13];
    }

    else if (IMOSLoggingEnabled())
    {
      v12 = OSLogHandleForIMFoundationCategory();
      if (os_log_type_enabled(v12, OS_LOG_TYPE_INFO))
      {
        *buf = 138412290;
        v16 = 0;
        _os_log_impl(&dword_19020E000, v12, OS_LOG_TYPE_INFO, "Couldn't get URL from dial request: %@", buf, 0xCu);
      }
    }
  }

  else if (IMOSLoggingEnabled())
  {
    v11 = OSLogHandleForIMFoundationCategory();
    if (os_log_type_enabled(v11, OS_LOG_TYPE_INFO))
    {
      *buf = 138412290;
      v16 = callCopy;
      _os_log_impl(&dword_19020E000, v11, OS_LOG_TYPE_INFO, "Attempting to perform a relay phone call with string: %@, which does not appear to be a phone number", buf, 0xCu);
    }
  }
}

void __51__CKChatController_MenuBar__performRelayPhoneCall___block_invoke(uint64_t a1, int a2)
{
  v11 = *MEMORY[0x1E69E9840];
  if (IMOSLoggingEnabled())
  {
    v4 = OSLogHandleForIMFoundationCategory();
    if (os_log_type_enabled(v4, OS_LOG_TYPE_INFO))
    {
      v5 = @"NO";
      v6 = *(a1 + 32);
      if (a2)
      {
        v5 = @"YES";
      }

      v7 = 138412546;
      v8 = v6;
      v9 = 2112;
      v10 = v5;
      _os_log_impl(&dword_19020E000, v4, OS_LOG_TYPE_INFO, "Opened Phone Call: %@ successfully: %@", &v7, 0x16u);
    }
  }
}

- (void)selectedQuickLook:(id)look
{
  if (objc_opt_respondsToSelector())
  {

    [(CKChatController *)self quickLookSelectedChatItem];
  }
}

- (void)toggleHideAlerts:(id)alerts
{
  conversation = [(CKCoreChatController *)self conversation];
  if (conversation)
  {
    v5 = conversation;
    if ([conversation isMuted])
    {
      [v5 unmute];
    }

    else
    {
      distantFuture = [MEMORY[0x1E695DF00] distantFuture];
      [v5 setMutedUntilDate:distantFuture];
    }

    conversation = v5;
  }
}

- (BOOL)shouldQuickLookSelectedChatItem
{
  v15 = *MEMORY[0x1E69E9840];
  [(CKChatController *)self selectedChatItems];
  v10 = 0u;
  v11 = 0u;
  v12 = 0u;
  v3 = v13 = 0u;
  v4 = [v3 countByEnumeratingWithState:&v10 objects:v14 count:16];
  if (v4)
  {
    v5 = v4;
    v6 = *v11;
    while (2)
    {
      for (i = 0; i != v5; ++i)
      {
        if (*v11 != v6)
        {
          objc_enumerationMutation(v3);
        }

        if ([(CKChatController *)self shouldQuickLookChatItem:*(*(&v10 + 1) + 8 * i), v10])
        {
          v8 = 1;
          goto LABEL_11;
        }
      }

      v5 = [v3 countByEnumeratingWithState:&v10 objects:v14 count:16];
      if (v5)
      {
        continue;
      }

      break;
    }
  }

  v8 = 0;
LABEL_11:

  return v8;
}

- (BOOL)shouldPageSelectedChatItem
{
  selectedChatItems = [(CKChatController *)self selectedChatItems];
  if ([selectedChatItems count] == 1)
  {
    firstObject = [selectedChatItems firstObject];
    objc_opt_class();
    isKindOfClass = objc_opt_isKindOfClass();
  }

  else
  {
    isKindOfClass = 0;
  }

  return isKindOfClass & 1;
}

- (BOOL)shouldViewDetailsForSelectedChatItem
{
  selectedChatItems = [(CKChatController *)self selectedChatItems];
  if ([selectedChatItems count] == 1)
  {
    firstObject = [selectedChatItems firstObject];
    objc_opt_class();
    isKindOfClass = objc_opt_isKindOfClass();
  }

  else
  {
    isKindOfClass = 0;
  }

  return isKindOfClass & 1;
}

- (BOOL)shouldQuickLookChatItem:(id)item
{
  itemCopy = item;
  objc_opt_class();
  if ((objc_opt_isKindOfClass() & 1) == 0)
  {
    objc_opt_class();
    if (objc_opt_isKindOfClass())
    {
      goto LABEL_7;
    }

LABEL_9:
    v6 = 0;
    goto LABEL_10;
  }

  mediaObject = [itemCopy mediaObject];
  v5 = mediaObject;
  if (!mediaObject || ![mediaObject shouldBeQuickLooked] || (objc_msgSend(v5, "shouldShowViewer") & 1) == 0)
  {

    goto LABEL_9;
  }

LABEL_7:
  v6 = 1;
LABEL_10:

  return v6;
}

- (void)quickLookSelectedChatItem
{
  selfCopy = self;
  v28 = *MEMORY[0x1E69E9840];
  selectedChatItems = [(CKChatController *)self selectedChatItems];
  v23 = 0u;
  v24 = 0u;
  v25 = 0u;
  v26 = 0u;
  v4 = [selectedChatItems countByEnumeratingWithState:&v23 objects:v27 count:16];
  if (v4)
  {
    v5 = v4;
    v6 = *v24;
    v7 = *MEMORY[0x1E69A7588];
    v8 = 0x1E69A8000uLL;
    v22 = selfCopy;
    do
    {
      for (i = 0; i != v5; ++i)
      {
        if (*v24 != v6)
        {
          objc_enumerationMutation(selectedChatItems);
        }

        v10 = *(*(&v23 + 1) + 8 * i);
        if ([(CKChatController *)selfCopy shouldQuickLookChatItem:v10])
        {
          mediaObject = [v10 mediaObject];
          transfer = [mediaObject transfer];
          if ([transfer isRestoring])
          {
            fileURL = [mediaObject fileURL];
            [fileURL path];
            v14 = v5;
            v15 = v6;
            v16 = v7;
            v17 = selectedChatItems;
            v19 = v18 = v8;

            v20 = +[CKSyncController sharedInstance];
            [v20 prioritizeAttachmentAtPath:v19];

            v8 = v18;
            selectedChatItems = v17;
            v7 = v16;
            v6 = v15;
            v5 = v14;
            selfCopy = v22;
          }

          [(CKChatController *)selfCopy showViewerForMediaObject:mediaObject];
          sharedInstance = [*(v8 + 360) sharedInstance];
          [sharedInstance trackEvent:v7];
        }
      }

      v5 = [selectedChatItems countByEnumeratingWithState:&v23 objects:v27 count:16];
    }

    while (v5);
  }
}

- (void)scrollTranscriptPageUpDirection:(BOOL)direction toBounds:(BOOL)bounds
{
  boundsCopy = bounds;
  directionCopy = direction;
  collectionViewController = [(CKCoreChatController *)self collectionViewController];
  collectionView = [collectionViewController collectionView];

  if ([collectionView _isAnimatingScroll])
  {
    goto LABEL_20;
  }

  v8 = 1;
  if (boundsCopy && !directionCopy)
  {
    entryView = [(CKChatController *)self entryView];
    sendLaterPluginInfo = [entryView sendLaterPluginInfo];

    if (sendLaterPluginInfo)
    {
      v8 = 6;
    }

    else
    {
      v8 = 0;
    }
  }

  [collectionView setTranscriptScrollIntent:v8];
  [collectionView bounds];
  v12 = v11;
  [collectionView contentInset];
  v15 = v12 - (v13 + v14);
  [collectionView __ck_bottomOffset];
  v17 = v16;
  if (directionCopy)
  {
    v18 = 0.0;
    if (boundsCopy)
    {
      goto LABEL_13;
    }

    [collectionView contentOffset];
    v18 = fmax(v19 - v15, 0.0);
  }

  else
  {
    v18 = v16;
    if (!boundsCopy)
    {
      [collectionView contentOffset];
      v18 = fmin(v17, v15 + v20);
    }
  }

  if (v18 >= 20.0)
  {
    [collectionView setContentOffset:1 animated:{0.0, v18}];
    goto LABEL_15;
  }

LABEL_13:
  v21 = [MEMORY[0x1E696AC88] indexPathForItem:0 inSection:0];
  [collectionView scrollToItemAtIndexPath:v21 atScrollPosition:1 animated:1];

LABEL_15:
  if (v18 <= 0.0 || v18 >= v17)
  {
    collectionViewController2 = [(CKCoreChatController *)self collectionViewController];
    if (objc_opt_respondsToSelector())
    {
      [collectionViewController2 loadMessagesIfNeededSkipValidation];
    }
  }

LABEL_20:
}

- (void)keyCommandApplyTextEffect:(id)effect
{
  effectCopy = effect;
  objc_opt_class();
  isKindOfClass = objc_opt_isKindOfClass();
  v5 = effectCopy;
  if (isKindOfClass)
  {
    propertyList = [effectCopy propertyList];
    objc_opt_class();
    if (objc_opt_isKindOfClass())
    {
      integerValue = [propertyList integerValue];
      messageEditingViewController = [(CKChatController *)self messageEditingViewController];

      if (messageEditingViewController)
      {
        messageEditingViewController2 = [(CKChatController *)self messageEditingViewController];
        [messageEditingViewController2 modifySelectedTextByTogglingTextEffectType:integerValue];
      }

      else
      {
        messageEditingViewController2 = [(CKChatController *)self entryView];
        contentView = [messageEditingViewController2 contentView];
        [contentView applyTextEffect:integerValue];
      }
    }

    v5 = effectCopy;
  }
}

- (void)keyCommandApplyTextStyle:(id)style
{
  styleCopy = style;
  objc_opt_class();
  isKindOfClass = objc_opt_isKindOfClass();
  v5 = styleCopy;
  if (isKindOfClass)
  {
    propertyList = [styleCopy propertyList];
    objc_opt_class();
    if (objc_opt_isKindOfClass())
    {
      unsignedIntegerValue = [propertyList unsignedIntegerValue];
      messageEditingViewController = [(CKChatController *)self messageEditingViewController];

      if (messageEditingViewController)
      {
        messageEditingViewController2 = [(CKChatController *)self messageEditingViewController];
        [messageEditingViewController2 modifySelectedTextByTogglingTextStyle:unsignedIntegerValue];
      }

      else
      {
        messageEditingViewController2 = [(CKChatController *)self entryView];
        contentView = [messageEditingViewController2 contentView];
        [contentView applyTextStyle:unsignedIntegerValue];
      }
    }

    v5 = styleCopy;
  }
}

- (void)askToShareScreenFromBuddyMenu:(id)menu
{
  conversation = [(CKCoreChatController *)self conversation];
  if (conversation)
  {
    v7 = conversation;
    detailsContactsManager = [(CKChatController *)self detailsContactsManager];
    recipient = [v7 recipient];
    [detailsContactsManager inviteEntityToShareTheirScreen:recipient];

    conversation = v7;
  }
}

- (void)inviteToShareScreenFromBuddyMenu:(id)menu
{
  conversation = [(CKCoreChatController *)self conversation];
  if (conversation)
  {
    v7 = conversation;
    detailsContactsManager = [(CKChatController *)self detailsContactsManager];
    recipient = [v7 recipient];
    [detailsContactsManager shareMyScreenWithEntity:recipient];

    conversation = v7;
  }
}

- (void)spacePressed:(id)pressed
{
  selectedChatItems = [(CKChatController *)self selectedChatItems];
  v5[0] = MEMORY[0x1E69E9820];
  v5[1] = 3221225472;
  v5[2] = __42__CKChatController_MenuBar__spacePressed___block_invoke;
  v5[3] = &unk_1E72F0918;
  v5[4] = self;
  [selectedChatItems enumerateObjectsWithOptions:2 usingBlock:v5];
}

void __42__CKChatController_MenuBar__spacePressed___block_invoke(uint64_t a1, void *a2, uint64_t a3, _BYTE *a4)
{
  v15 = a2;
  objc_opt_class();
  if (objc_opt_isKindOfClass())
  {
    v6 = [*(a1 + 32) collectionViewController];
    v7 = [v6 balloonViewForChatItem:v15];

    if (!v15 || !v7)
    {
      goto LABEL_11;
    }

    objc_opt_class();
    if (objc_opt_isKindOfClass())
    {
      [v7 pausePlayback];
    }

    v8 = *(a1 + 32);
    v9 = [v8 collectionViewController];
    [v8 transcriptCollectionViewController:v9 balloonView:v7 tappedForChatItem:v15];
    goto LABEL_10;
  }

  objc_opt_class();
  isKindOfClass = objc_opt_isKindOfClass();
  v11 = v15;
  if ((isKindOfClass & 1) == 0)
  {
    goto LABEL_12;
  }

  v12 = [*(a1 + 32) collectionViewController];
  v7 = [v12 balloonViewForChatItem:v15];

  objc_opt_class();
  if (objc_opt_isKindOfClass())
  {
    v9 = [v7 currentAssetReference];
    v13 = *(a1 + 32);
    v14 = [v13 collectionViewController];
    [v13 transcriptCollectionViewController:v14 didTapPhotoStackForChatItem:v15 assetReference:v9];

LABEL_10:
  }

LABEL_11:
  *a4 = 1;

  v11 = v15;
LABEL_12:
}

- (id)_chatItemForReplyingToChatItem:(id)item explicitlySelected:(BOOL)selected
{
  selectedCopy = selected;
  itemCopy = item;
  objc_opt_class();
  v7 = itemCopy;
  if (objc_opt_isKindOfClass())
  {
    v7 = itemCopy;
    if (selectedCopy)
    {
      v7 = [(CKChatController *)self currentTopChatItemForAggregateChatItem:itemCopy];
    }
  }

  return v7;
}

- (void)keyCommandReply:(id)reply withModifier:(BOOL)modifier
{
  if (![(CKChatController *)self isShowingOscarChat])
  {
    chat = [(CKCoreChatController *)self chat];
    v7 = [chat supportsCapabilities:4];

    if (v7)
    {
      v11[0] = MEMORY[0x1E69E9820];
      v11[1] = 3221225472;
      v11[2] = __58__CKChatController_MenuBar__keyCommandReply_withModifier___block_invoke;
      v11[3] = &unk_1E72ED8D8;
      modifierCopy = modifier;
      v11[4] = self;
      v8 = _Block_copy(v11);
      inlineReplyController = [(CKChatController *)self inlineReplyController];

      if (inlineReplyController)
      {
        inlineReplyController2 = [(CKChatController *)self inlineReplyController];
        [inlineReplyController2 dismissController];
      }

      else
      {
        objc_opt_class();
        if (objc_opt_isKindOfClass())
        {
          [(CKChatController *)self dismissController];
        }

        else if ([(CKChatController *)self isFullScreenBalloonViewOnScreen])
        {
          [(CKChatController *)self _dismissFullScreenBubbleViewControllerAnimated:1 withSendAnimation:0 completion:v8];
        }

        else
        {
          v8[2](v8);
        }
      }
    }
  }
}

void __58__CKChatController_MenuBar__keyCommandReply_withModifier___block_invoke(uint64_t a1)
{
  v2 = CKIsRunningInMacCatalyst();
  if ((*(a1 + 40) & 1) != 0 || ([*(a1 + 32) selectedChatItems], v3 = objc_claimAutoreleasedReturnValue(), v4 = objc_msgSend(v3, "count"), v3, v4 != 1))
  {
    v14 = 0;
    v15 = &v14;
    v16 = 0x3032000000;
    v17 = __Block_byref_object_copy__21;
    v18 = __Block_byref_object_dispose__21;
    v19 = 0;
    v7 = [*(a1 + 32) collectionViewController];
    v8 = [v7 chatItems];
    v12[0] = MEMORY[0x1E69E9820];
    v12[1] = 3221225472;
    v12[2] = __58__CKChatController_MenuBar__keyCommandReply_withModifier___block_invoke_2;
    v12[3] = &unk_1E72F0940;
    v13 = *(a1 + 40);
    v12[4] = *(a1 + 32);
    v12[5] = &v14;
    [v8 enumerateObjectsWithOptions:2 usingBlock:v12];

    if (v15[5])
    {
      [*(a1 + 32) showInlineReplyControllerForChatItem:? presentKeyboard:?];
    }

    else if (IMOSLoggingEnabled())
    {
      v9 = OSLogHandleForIMFoundationCategory();
      if (os_log_type_enabled(v9, OS_LOG_TYPE_INFO))
      {
        *buf = 0;
        _os_log_impl(&dword_19020E000, v9, OS_LOG_TYPE_INFO, "CKChatController_MenuBar: Unable to identify a visible cell that's eligible for reply", buf, 2u);
      }
    }

    _Block_object_dispose(&v14, 8);
  }

  else
  {
    v5 = [*(a1 + 32) selectedChatItems];
    v10 = [v5 firstObject];

    v6 = [*(a1 + 32) _chatItemForReplyingToChatItem:v10 explicitlySelected:1];
    if ([v6 canInlineReply])
    {
      [*(a1 + 32) showInlineReplyControllerForChatItem:v6 presentKeyboard:v2 == 0];
    }
  }
}

void __58__CKChatController_MenuBar__keyCommandReply_withModifier___block_invoke_2(uint64_t a1, void *a2, uint64_t a3, _BYTE *a4)
{
  v13 = a2;
  objc_opt_class();
  isKindOfClass = objc_opt_isKindOfClass();
  v7 = v13;
  if (isKindOfClass)
  {
    v8 = v13;
    v9 = v8;
    if ((*(a1 + 48) & 1) == 0)
    {
      if (![v8 itemIsFromMe])
      {
        goto LABEL_8;
      }

      if ((*(a1 + 48) & 1) == 0)
      {
        goto LABEL_11;
      }
    }

    if (![v9 itemIsReply])
    {
LABEL_11:

      v7 = v13;
      goto LABEL_12;
    }

LABEL_8:
    if ([v9 canInlineReply])
    {
      v10 = [*(a1 + 32) _chatItemForReplyingToChatItem:v9 explicitlySelected:0];
      v11 = *(*(a1 + 40) + 8);
      v12 = *(v11 + 40);
      *(v11 + 40) = v10;
    }

    *a4 = 1;
    goto LABEL_11;
  }

LABEL_12:
}

- (void)keyCommandTapback:(id)tapback
{
  tapbackCopy = tapback;
  inlineReplyController = [(CKChatController *)self inlineReplyController];
  v6 = inlineReplyController;
  if (inlineReplyController)
  {
    selfCopy = inlineReplyController;
  }

  else
  {
    selfCopy = self;
  }

  v8 = selfCopy;

  collectionViewController = [(CKCoreChatController *)v8 collectionViewController];
  collectionView = [collectionViewController collectionView];
  if ([(CKChatController *)v8 isFullScreenBalloonViewOnScreen])
  {
    [(CKChatController *)v8 _dismissFullScreenBubbleViewControllerAnimated:1 withSendAnimation:0 completion:0];
  }

  else
  {
    if (!CKIsRunningInMacCatalyst() && (-[CKChatController clickyOrbChatItem](v8, "clickyOrbChatItem"), (v18 = objc_claimAutoreleasedReturnValue()) != 0) && (v19 = v18, [collectionView contextMenuInteraction], v20 = objc_claimAutoreleasedReturnValue(), v20, v19, v20))
    {
      contextMenuInteraction = [collectionView contextMenuInteraction];
      [contextMenuInteraction dismissMenu];
    }

    else
    {
      contextMenuInteraction = [(CKChatController *)self selectedChatItems];
      if ([contextMenuInteraction count] == 1)
      {
        firstObject = [contextMenuInteraction firstObject];
        if (([firstObject itemIsReplyContextPreview] & 1) == 0 && (objc_msgSend(firstObject, "isEditedMessageHistory") & 1) == 0)
        {
          selectedItems = [collectionViewController selectedItems];
          firstIndex = [selectedItems firstIndex];

          v15 = [MEMORY[0x1E696AC88] indexPathForItem:firstIndex inSection:0];
          [(CKChatController *)v8 showFullScreenAcknowledgmentPickerIfNeededForBalloonAtIndexPath:v15];
        }
      }

      else
      {
        firstObject = [collectionViewController chatItems];
        v22 = 0;
        v23 = &v22;
        v24 = 0x3032000000;
        v25 = __Block_byref_object_copy__21;
        v26 = __Block_byref_object_dispose__21;
        v27 = 0;
        v21[0] = MEMORY[0x1E69E9820];
        v21[1] = 3221225472;
        v21[2] = __47__CKChatController_MenuBar__keyCommandTapback___block_invoke;
        v21[3] = &unk_1E72EEC48;
        v21[4] = &v22;
        [firstObject enumerateObjectsWithOptions:2 usingBlock:v21];
        v16 = [collectionViewController cellForChatItem:v23[5]];
        v17 = [collectionView indexPathForCell:v16];
        [(CKChatController *)v8 showFullScreenAcknowledgmentPickerIfNeededForBalloonAtIndexPath:v17];

        _Block_object_dispose(&v22, 8);
      }
    }
  }
}

void __47__CKChatController_MenuBar__keyCommandTapback___block_invoke(uint64_t a1, void *a2, uint64_t a3, _BYTE *a4)
{
  v10 = a2;
  objc_opt_class();
  isKindOfClass = objc_opt_isKindOfClass();
  v8 = v10;
  if (isKindOfClass)
  {
    v9 = v10;
    if (([v9 itemIsFromMe] & 1) == 0 && (objc_msgSend(v9, "itemIsReplyContextPreview") & 1) == 0)
    {
      objc_storeStrong((*(*(a1 + 32) + 8) + 40), a2);
      *a4 = 1;
    }

    v8 = v10;
  }
}

- (void)_configureEditMessageCommand:(id)command
{
  commandCopy = command;
  currentChatController = [(CKChatController *)self currentChatController];
  conversation = [currentChatController conversation];
  supportsMessageEditing = [conversation supportsMessageEditing];

  if (supportsMessageEditing)
  {
    messageEditingViewController = [currentChatController messageEditingViewController];

    if (!messageEditingViewController)
    {
      hasSelectedChatItemsIncludingAssociatedTapback = [(CKChatController *)self hasSelectedChatItemsIncludingAssociatedTapback];
      v12 = CKFrameworkBundle();
      v13 = v12;
      if (hasSelectedChatItemsIncludingAssociatedTapback)
      {
        v14 = [v12 localizedStringForKey:@"EDIT_MESSAGE" value:&stru_1F04268F8 table:@"ChatKit"];
        [commandCopy setTitle:v14];

        [(CKChatController *)self selectedMessagePartItem];
      }

      else
      {
        v15 = [v12 localizedStringForKey:@"EDIT_LAST_MESSAGE" value:&stru_1F04268F8 table:@"ChatKit"];
        [commandCopy setTitle:v15];

        [(CKChatController *)self lastOutgoingMessagePartItem];
      }
      v16 = ;
      if (v16 && ([currentChatController conversation], v17 = objc_claimAutoreleasedReturnValue(), objc_msgSend(v17, "chat"), v18 = objc_claimAutoreleasedReturnValue(), v19 = objc_msgSend(v18, "supportsCapabilities:", 1), v18, v17, (v19 & 1) != 0))
      {
        canEditMessageText = [v16 canEditMessageText];
        attributes = [commandCopy attributes];
        if (canEditMessageText)
        {
          v22 = attributes & 0xFFFFFFFFFFFFFFFELL;
        }

        else
        {
          v22 = attributes | 1;
        }
      }

      else
      {
        v22 = [commandCopy attributes] | 1;
      }

      [commandCopy setAttributes:v22];

      goto LABEL_6;
    }

    v8 = CKFrameworkBundle();
    v9 = [v8 localizedStringForKey:@"CANCEL_EDIT" value:&stru_1F04268F8 table:@"ChatKit"];
    [commandCopy setTitle:v9];

    v10 = [commandCopy attributes] & 0xFFFFFFFFFFFFFFFELL;
  }

  else
  {
    v10 = [commandCopy attributes] | 1;
  }

  [commandCopy setAttributes:v10];
LABEL_6:
}

- (void)keyCommandEditMessage:(id)message
{
  messageCopy = message;
  currentChatController = [(CKChatController *)self currentChatController];
  messageEditingViewController = [currentChatController messageEditingViewController];

  if (messageEditingViewController)
  {
    if (IMOSLoggingEnabled())
    {
      v7 = OSLogHandleForIMFoundationCategory();
      if (os_log_type_enabled(v7, OS_LOG_TYPE_INFO))
      {
        *buf = 0;
        _os_log_impl(&dword_19020E000, v7, OS_LOG_TYPE_INFO, "Edit Message Shortcut pressed. Dismissing message editing.", buf, 2u);
      }
    }

    messageEditingViewController2 = [currentChatController messageEditingViewController];
    [messageEditingViewController2 dismissAndRejectChanges];
  }

  else
  {
    messageEditingViewController2 = [(CKChatController *)self _chatItemToEdit];
    if (messageEditingViewController2)
    {
      v12 = MEMORY[0x1E69E9820];
      v13 = 3221225472;
      v14 = __51__CKChatController_MenuBar__keyCommandEditMessage___block_invoke;
      v15 = &unk_1E72EB8D0;
      v9 = currentChatController;
      v16 = v9;
      messageEditingViewController2 = messageEditingViewController2;
      v17 = messageEditingViewController2;
      v10 = _Block_copy(&v12);
      if ([v9 isFullScreenBalloonViewOnScreen])
      {
        [v9 _dismissFullScreenBubbleViewControllerAnimated:1 withSendAnimation:0 completion:v10];
      }

      else
      {
        v10[2](v10);
      }
    }

    else if (IMOSLoggingEnabled())
    {
      v11 = OSLogHandleForIMFoundationCategory();
      if (os_log_type_enabled(v11, OS_LOG_TYPE_INFO))
      {
        *buf = 0;
        _os_log_impl(&dword_19020E000, v11, OS_LOG_TYPE_INFO, "Unable to identify an eligible item for editing. No op.", buf, 2u);
      }
    }
  }
}

uint64_t __51__CKChatController_MenuBar__keyCommandEditMessage___block_invoke(uint64_t a1)
{
  v2 = [*(a1 + 32) collectionView];
  v3 = [v2 contextMenuInteraction];

  if (v3)
  {
    v4 = [*(a1 + 32) collectionView];
    v5 = [v4 contextMenuInteraction];
    [v5 dismissMenu];
  }

  if (IMOSLoggingEnabled())
  {
    v6 = OSLogHandleForIMFoundationCategory();
    if (os_log_type_enabled(v6, OS_LOG_TYPE_INFO))
    {
      *v8 = 0;
      _os_log_impl(&dword_19020E000, v6, OS_LOG_TYPE_INFO, "Edit Message Shortcut pressed. Showing message editing.", v8, 2u);
    }
  }

  return [*(a1 + 32) showMessageEditingViewControllerForChatItem:*(a1 + 40) presentKeyboard:1];
}

- (id)_chatItemToEdit
{
  selectedMessagePartItem = [(CKChatController *)self selectedMessagePartItem];
  if (selectedMessagePartItem)
  {
    v4 = selectedMessagePartItem;
    if (([selectedMessagePartItem canEditMessageText] & 1) == 0)
    {
      v5 = 0;
      goto LABEL_10;
    }
  }

  else
  {
    lastOutgoingMessagePartItem = [(CKChatController *)self lastOutgoingMessagePartItem];
    v7 = lastOutgoingMessagePartItem;
    if (lastOutgoingMessagePartItem && [lastOutgoingMessagePartItem canEditMessageText])
    {
      v4 = v7;
    }

    else
    {
      v4 = 0;
    }
  }

  v4 = v4;
  v5 = v4;
LABEL_10:

  return v5;
}

- (id)currentChatController
{
  selfCopy = self;
  inlineReplyController = [(CKChatController *)self inlineReplyController];
  v4 = inlineReplyController;
  if (inlineReplyController)
  {
    selfCopy = inlineReplyController;
  }

  v5 = selfCopy;

  return selfCopy;
}

- (void)keyCommandPrint:(id)print
{
  collectionViewController = [(CKCoreChatController *)self collectionViewController];
  objc_opt_class();
  if (objc_opt_isKindOfClass() & 1) != 0 && (objc_opt_respondsToSelector())
  {
    [collectionViewController performSelector:sel_printTranscript];
  }
}

- (void)keyCommandDeleteConversation:(id)conversation
{
  conversationCopy = conversation;
  delegate = [(CKCoreChatController *)self delegate];
  v5 = objc_opt_respondsToSelector();

  if (v5)
  {
    delegate2 = [(CKCoreChatController *)self delegate];
    [delegate2 keyCommandDeleteConversation:conversationCopy];
  }

  else
  {
    [(CKChatController *)self recoverableDeleteConversation];
  }
}

- (void)_cancelDeletion:(id)deletion
{
  if (deletion)
  {
    (*(deletion + 2))(deletion, 0);
  }
}

- (void)keyCommandPage:(id)page
{
  pageCopy = page;
  selectedChatItems = [(CKChatController *)self selectedChatItems];
  v7[0] = MEMORY[0x1E69E9820];
  v7[1] = 3221225472;
  v7[2] = __44__CKChatController_MenuBar__keyCommandPage___block_invoke;
  v7[3] = &unk_1E72EE4E8;
  v7[4] = self;
  v8 = pageCopy;
  v6 = pageCopy;
  [selectedChatItems enumerateObjectsWithOptions:2 usingBlock:v7];
}

void __44__CKChatController_MenuBar__keyCommandPage___block_invoke(uint64_t a1, void *a2, uint64_t a3, _BYTE *a4)
{
  v6 = a2;
  objc_opt_class();
  if (objc_opt_isKindOfClass())
  {
    v7 = [*(a1 + 32) collectionViewController];
    v8 = [v7 balloonViewForChatItem:v6];

    objc_opt_class();
    if (objc_opt_isKindOfClass())
    {
      v10 = *(a1 + 40);
      v9 = (a1 + 40);
      v11 = [v10 input];
      v12 = [v11 isEqualToString:*MEMORY[0x1E69DDF28]];

      if (v12)
      {
        [v8 pageRightAnimated:1];
      }

      else
      {
        v13 = [*v9 input];
        v14 = [v13 isEqualToString:*MEMORY[0x1E69DDF10]];

        if (v14)
        {
          [v8 pageLeftAnimated:1];
        }

        else
        {
          v15 = IMLogHandleForCategory();
          if (os_log_type_enabled(v15, OS_LOG_TYPE_ERROR))
          {
            __44__CKChatController_MenuBar__keyCommandPage___block_invoke_cold_1(v9, v15);
          }
        }
      }
    }

    *a4 = 1;
  }
}

- (void)keyCommandShowDetails:(id)details
{
  selectedChatItems = [(CKChatController *)self selectedChatItems];
  v5[0] = MEMORY[0x1E69E9820];
  v5[1] = 3221225472;
  v5[2] = __51__CKChatController_MenuBar__keyCommandShowDetails___block_invoke;
  v5[3] = &unk_1E72F0918;
  v5[4] = self;
  [selectedChatItems enumerateObjectsWithOptions:2 usingBlock:v5];
}

void __51__CKChatController_MenuBar__keyCommandShowDetails___block_invoke(uint64_t a1, void *a2, uint64_t a3, _BYTE *a4)
{
  v11 = a2;
  objc_opt_class();
  if (objc_opt_isKindOfClass())
  {
    v6 = [*(a1 + 32) collectionViewController];
    v7 = [v6 balloonViewForChatItem:v11];

    objc_opt_class();
    if (objc_opt_isKindOfClass())
    {
      v8 = [v7 currentAssetReference];
      v9 = *(a1 + 32);
      v10 = [v9 collectionViewController];
      [v9 transcriptCollectionViewController:v10 didTapPhotoStackButtonForChatItem:v11 assetReference:v8];
    }

    *a4 = 1;
  }
}

- (void)escButtonPressed:(id)pressed
{
  inlineReplyController = [(CKChatController *)self inlineReplyController];
  v5 = inlineReplyController;
  if (inlineReplyController)
  {
    selfCopy = inlineReplyController;
  }

  else
  {
    selfCopy = self;
  }

  v9 = selfCopy;

  if ([(CKChatController *)v9 isFullScreenBalloonViewOnScreen])
  {
    [(CKChatController *)v9 _dismissFullScreenBubbleViewControllerAnimated:1 withSendAnimation:0 completion:0];
  }

  else
  {
    messageEditingViewController = [(CKChatController *)v9 messageEditingViewController];

    if (messageEditingViewController)
    {
      messageEditingViewController2 = [(CKChatController *)v9 messageEditingViewController];
      [messageEditingViewController2 dismissAndRejectChanges];
    }

    else
    {
      objc_opt_class();
      if (objc_opt_isKindOfClass())
      {
        [(CKChatController *)v9 dismissController];
      }

      else
      {
        objc_opt_class();
        if (objc_opt_isKindOfClass())
        {
          [(CKChatController *)v9 cancelCompose];
        }
      }
    }
  }
}

- (void)delete:(id)delete
{
  deleteCopy = delete;
  collectionViewController = [(CKCoreChatController *)self collectionViewController];
  [collectionViewController deleteSelectedChatItems:deleteCopy];
}

- (void)copy:(id)copy
{
  copyCopy = copy;
  if (IMOSLoggingEnabled())
  {
    v5 = OSLogHandleForIMFoundationCategory();
    if (os_log_type_enabled(v5, OS_LOG_TYPE_INFO))
    {
      *v7 = 0;
      _os_log_impl(&dword_19020E000, v5, OS_LOG_TYPE_INFO, "Copying selected transcript balloons to pasteboard", v7, 2u);
    }
  }

  collectionViewController = [(CKCoreChatController *)self collectionViewController];
  [collectionViewController copySelectedChatItemsToPasteboard];
}

- (void)updateCompositionInEntryViewWithComposition:(id)composition
{
  compositionCopy = composition;
  entryView = [(CKChatController *)self entryView];
  composition = [entryView composition];
  v6 = [composition compositionByAppendingComposition:compositionCopy];

  [entryView setComposition:v6];
}

- (void)documentPicker:(id)picker didPickDocumentsAtURLs:(id)ls
{
  v15[1] = *MEMORY[0x1E69E9840];
  pickerCopy = picker;
  lsCopy = ls;
  if ([lsCopy count] == 1)
  {
    v8 = objc_alloc(MEMORY[0x1E696ACA0]);
    v9 = [lsCopy objectAtIndexedSubscript:0];
    v10 = [v8 initWithContentsOfURL:v9];

    objc_initWeak(&location, self);
    v15[0] = v10;
    v11 = [MEMORY[0x1E695DEC8] arrayWithObjects:v15 count:1];
    v12[0] = MEMORY[0x1E69E9820];
    v12[1] = 3221225472;
    v12[2] = __67__CKChatController_MenuBar__documentPicker_didPickDocumentsAtURLs___block_invoke;
    v12[3] = &unk_1E72F0968;
    objc_copyWeak(&v13, &location);
    [CKComposition requestCompositionFromItemProviders:v11 completion:v12];

    objc_destroyWeak(&v13);
    objc_destroyWeak(&location);
  }
}

void __67__CKChatController_MenuBar__documentPicker_didPickDocumentsAtURLs___block_invoke(uint64_t a1, void *a2)
{
  v3 = a2;
  v5[0] = MEMORY[0x1E69E9820];
  v5[1] = 3221225472;
  v5[2] = __67__CKChatController_MenuBar__documentPicker_didPickDocumentsAtURLs___block_invoke_2;
  v5[3] = &unk_1E72EBB98;
  objc_copyWeak(&v7, (a1 + 32));
  v6 = v3;
  v4 = v3;
  dispatch_async(MEMORY[0x1E69E96A0], v5);

  objc_destroyWeak(&v7);
}

void __67__CKChatController_MenuBar__documentPicker_didPickDocumentsAtURLs___block_invoke_2(uint64_t a1)
{
  WeakRetained = objc_loadWeakRetained((a1 + 40));
  [WeakRetained updateCompositionInEntryViewWithComposition:*(a1 + 32)];
}

- (void)purgeAttachmentsForChat:(id)chat
{
  chat = [(CKCoreChatController *)self chat];
  guid = [chat guid];

  v6 = [CKAlertController alertControllerWithTitle:@"Purge attachments for this chat?" message:@"This will delete attachment files on disk but you can re-download them. Be sure to imtool kim after running this." preferredStyle:1];
  v7 = CKFrameworkBundle();
  v8 = [v7 localizedStringForKey:@"OK" value:&stru_1F04268F8 table:@"ChatKit"];
  v14[0] = MEMORY[0x1E69E9820];
  v14[1] = 3221225472;
  v14[2] = __53__CKChatController_MenuBar__purgeAttachmentsForChat___block_invoke;
  v14[3] = &unk_1E72EBFE8;
  v15 = guid;
  v9 = guid;
  v10 = [CKAlertAction actionWithTitle:v8 style:0 handler:v14];
  [v6 addAction:v10];

  v11 = CKFrameworkBundle();
  v12 = [v11 localizedStringForKey:@"Cancel" value:&stru_1F04268F8 table:@"ChatKit"];
  v13 = [CKAlertAction actionWithTitle:v12 style:0 handler:0];
  [v6 addAction:v13];

  [v6 presentFromViewController:self animated:1 completion:0];
}

void __53__CKChatController_MenuBar__purgeAttachmentsForChat___block_invoke(uint64_t a1, void *a2)
{
  v10 = *MEMORY[0x1E69E9840];
  v3 = a2;
  if (IMOSLoggingEnabled())
  {
    v4 = OSLogHandleForIMFoundationCategory();
    if (os_log_type_enabled(v4, OS_LOG_TYPE_INFO))
    {
      v5 = *(a1 + 32);
      v8 = 138412290;
      v9 = v5;
      _os_log_impl(&dword_19020E000, v4, OS_LOG_TYPE_INFO, "Purging attachments for chatGUID: %@", &v8, 0xCu);
    }
  }

  v6 = [MEMORY[0x1E69A5B50] sharedController];
  v7 = [v6 remoteDaemon];
  [v7 purgeAttachmentsForChatGUID:*(a1 + 32)];
}

- (void)showMessageHistoryViewController
{
  v13 = objc_alloc_init(CKMessageHistoryViewController);
  [(CKMessageHistoryViewController *)v13 setMessageHistoryDelegate:self];
  conversation = [(CKCoreChatController *)self conversation];
  [(CKMessageHistoryViewController *)v13 setMessageHistoryDataSource:conversation];
  currentDevice = [MEMORY[0x1E69DC938] currentDevice];
  userInterfaceIdiom = [currentDevice userInterfaceIdiom];

  if (userInterfaceIdiom == 1)
  {
    [(CKMessageHistoryViewController *)v13 setModalPresentationStyle:7];
    navigationController = [(CKChatController *)self navigationController];
    navigationBar = [navigationController navigationBar];

    presentationController = [(CKMessageHistoryViewController *)v13 presentationController];
    [presentationController setSourceView:navigationBar];

    [(CKChatController *)self presentViewController:v13 animated:1 completion:0];
  }

  else
  {
    navigationBar = [MEMORY[0x1E69DC650] alertControllerWithTitle:0 message:0 preferredStyle:0];
    [navigationBar _setSeparatedHeaderContentViewController:v13];
    v9 = MEMORY[0x1E69DC648];
    v10 = CKFrameworkBundle();
    v11 = [v10 localizedStringForKey:@"CANCEL" value:&stru_1F04268F8 table:@"ChatKit"];
    v12 = [v9 actionWithTitle:v11 style:1 handler:0];

    [navigationBar addAction:v12];
    [(CKChatController *)self presentViewController:navigationBar animated:1 completion:0];
  }
}

- (void)messageHistoryViewController:(id)controller didSelectDate:(id)date withMessages:(id)messages
{
  v21 = *MEMORY[0x1E69E9840];
  v16 = 0u;
  v17 = 0u;
  v18 = 0u;
  v19 = 0u;
  messagesCopy = messages;
  v7 = [messagesCopy countByEnumeratingWithState:&v16 objects:v20 count:16];
  v8 = messagesCopy;
  if (v7)
  {
    v9 = v7;
    v10 = *v17;
LABEL_3:
    v11 = 0;
    while (1)
    {
      if (*v17 != v10)
      {
        objc_enumerationMutation(messagesCopy);
      }

      v12 = *(*(&v16 + 1) + 8 * v11);
      if ([v12 messagePartCount] > 0)
      {
        break;
      }

      if (v9 == ++v11)
      {
        v9 = [messagesCopy countByEnumeratingWithState:&v16 objects:v20 count:16];
        if (v9)
        {
          goto LABEL_3;
        }

        v8 = messagesCopy;
        goto LABEL_12;
      }
    }

    v8 = v12;

    if (!v8)
    {
      goto LABEL_13;
    }

    guid = [v8 guid];
    conversation = [(CKCoreChatController *)self conversation];
    v15 = [conversation ensureMessageWithGUIDIsLoaded:guid];
    [(CKChatController *)self scrollToMessageGUID:guid partIndex:0x7FFFFFFFFFFFFFFFLL highlight:1 scrollPosition:1];
  }

LABEL_12:

LABEL_13:
}

- (id)dateOfNewestVisibleMessageForMessageHistoryViewController:(id)controller
{
  v33 = *MEMORY[0x1E69E9840];
  controllerCopy = controller;
  collectionView = [(CKChatController *)self collectionView];
  collectionViewController = [(CKCoreChatController *)self collectionViewController];
  chatItems = [collectionViewController chatItems];
  v26 = collectionView;
  indexPathsForVisibleItems = [collectionView indexPathsForVisibleItems];
  v28 = 0u;
  v29 = 0u;
  v30 = 0u;
  v31 = 0u;
  v7 = [indexPathsForVisibleItems countByEnumeratingWithState:&v28 objects:v32 count:16];
  if (v7)
  {
    v8 = v7;
    v9 = 0;
    v10 = *v29;
    v11 = off_1E72E5000;
    do
    {
      for (i = 0; i != v8; ++i)
      {
        if (*v29 != v10)
        {
          objc_enumerationMutation(indexPathsForVisibleItems);
        }

        v13 = *(*(&v28 + 1) + 8 * i);
        if (![v13 section])
        {
          item = [v13 item];
          if (item < [chatItems count])
          {
            v15 = [chatItems objectAtIndex:item];
            objc_opt_class();
            if (objc_opt_isKindOfClass())
            {
              v16 = v15;
              time = [v16 time];
              v18 = time;
              if (time && (!v9 || [time compare:v9] == 1))
              {
                v19 = v18;
                v20 = v9;
                v21 = v11;
                v22 = v19;

                v23 = v22;
                v11 = v21;
                v9 = v23;
              }
            }
          }
        }
      }

      v8 = [indexPathsForVisibleItems countByEnumeratingWithState:&v28 objects:v32 count:16];
    }

    while (v8);
  }

  else
  {
    v9 = 0;
  }

  return v9;
}

- (void)sendAnimationManagerWillStartAnimation:(id)animation context:(id)context
{
  contextCopy = context;
  v75[0] = MEMORY[0x1E69E9820];
  v75[1] = 3221225472;
  v75[2] = __82__CKChatController_SendAnimation__sendAnimationManagerWillStartAnimation_context___block_invoke;
  v75[3] = &unk_1E72EBA18;
  v75[4] = self;
  [MEMORY[0x1E69DD250] performWithoutAnimation:v75];
  entryView = [(CKChatController *)self entryView];
  collectionView = [(CKChatController *)self collectionView];
  [entryView placeholderHeight];
  aBlock[0] = MEMORY[0x1E69E9820];
  aBlock[1] = 3221225472;
  aBlock[2] = __82__CKChatController_SendAnimation__sendAnimationManagerWillStartAnimation_context___block_invoke_2;
  aBlock[3] = &unk_1E72EBC38;
  v74 = v8;
  v9 = entryView;
  v72 = v9;
  selfCopy = self;
  v10 = _Block_copy(aBlock);
  if ([(CKChatController *)self _shouldHideNavigationBarForSendAnimationContext:contextCopy])
  {
    v70[0] = MEMORY[0x1E69E9820];
    v70[1] = 3221225472;
    v70[2] = __82__CKChatController_SendAnimation__sendAnimationManagerWillStartAnimation_context___block_invoke_3;
    v70[3] = &unk_1E72EBA18;
    v70[4] = self;
    [MEMORY[0x1E69DD250] animateWithDuration:0x10000 delay:v70 options:0 animations:0.2 completion:0.0];
  }

  [contextCopy throwAnimationSourceRect];
  v11 = CGRectEqualToRect(v76, *MEMORY[0x1E695F058]);
  if (!v11)
  {
    [collectionView beginHoldingContentOffsetUpdatesForReason:@"ChatControllerSendAnimation"];
  }

  v12 = !v11;
  [collectionView setScrollEnabled:0];
  [(CKChatController *)self _contentInsetForSendAnimation];
  v14 = v13;
  v16 = v15;
  v18 = v17;
  v20 = v19;
  [collectionView contentInset];
  v22 = v21;
  [(CKScrollViewController *)self computedInsets];
  v24 = v23 - (v22 - v18);
  [collectionView setContentInset:{v14, v16, v18, v20}];
  [(CKScrollViewController *)self updateComputedInsetsForSendAnimation:v14, v16, v24, v20];
  [(CKScrollViewController *)self computedInsets];
  v26 = v25;
  v28 = v27;
  v30 = v29;
  v32 = v31;
  messages = [contextCopy messages];
  firstObject = [messages firstObject];
  scheduleType = [firstObject scheduleType];

  if (scheduleType == 2)
  {
    [collectionView __ck_bottomOffsetWithComputedInsets:{v26, v28, v30, v32}];
    v37 = v36;
    v39 = v38;
  }

  else
  {
    collectionViewController = [(CKCoreChatController *)self collectionViewController];
    latestScheduledMessageIndexPath = [collectionViewController latestScheduledMessageIndexPath];
    [collectionView __ck_bottomOffsetHidingIndexPath:latestScheduledMessageIndexPath computedInsets:{v26, v28, v30, v32}];
    v37 = v42;
    v39 = v43;
  }

  sendAnimationType = [contextCopy sendAnimationType];
  if (!sendAnimationType)
  {
    v53 = MEMORY[0x1E69DD250];
    v60[0] = MEMORY[0x1E69E9820];
    v60[1] = 3221225472;
    v60[2] = __82__CKChatController_SendAnimation__sendAnimationManagerWillStartAnimation_context___block_invoke_5;
    v60[3] = &unk_1E72F2540;
    v61 = collectionView;
    v62 = v37;
    v63 = v39;
    v64 = v12;
    [v53 animateWithDuration:v60 animations:0.3];

    goto LABEL_14;
  }

  if (sendAnimationType != 1)
  {
LABEL_14:
    v10[2](v10);
    goto LABEL_15;
  }

  v45 = MEMORY[0x1E69DD250];
  v65[0] = MEMORY[0x1E69E9820];
  v65[1] = 3221225472;
  v65[2] = __82__CKChatController_SendAnimation__sendAnimationManagerWillStartAnimation_context___block_invoke_4;
  v65[3] = &unk_1E72F2540;
  v66 = collectionView;
  v67 = v37;
  v68 = v39;
  v69 = v12;
  [v45 animateWithSpringDuration:6 bounce:v65 initialSpringVelocity:0 delay:0.3 options:0.0 animations:0.0 completion:0.0];

  v46 = MEMORY[0x1E69DD250];
  v58[0] = MEMORY[0x1E69E9820];
  v58[1] = 3221225472;
  v58[2] = __82__CKChatController_SendAnimation__sendAnimationManagerWillStartAnimation_context___block_invoke_6;
  v58[3] = &unk_1E72EBA18;
  v47 = v9;
  v59 = v47;
  [v46 performWithoutAnimation:v58];
  standardUserDefaults = [MEMORY[0x1E695E000] standardUserDefaults];
  ck_isUsingSpecialGlassDuringSendAnimationEnabled = [standardUserDefaults ck_isUsingSpecialGlassDuringSendAnimationEnabled];

  if (ck_isUsingSpecialGlassDuringSendAnimationEnabled)
  {
    v50 = MEMORY[0x1E69DD250];
    v56[0] = MEMORY[0x1E69E9820];
    v56[1] = 3221225472;
    v56[2] = __82__CKChatController_SendAnimation__sendAnimationManagerWillStartAnimation_context___block_invoke_7;
    v56[3] = &unk_1E72EBA18;
    v57 = v47;
    [v50 animateWithDuration:v56 animations:0.05];
  }

  v51 = [objc_alloc(MEMORY[0x1E69DCF88]) initWithMass:2.0 stiffness:447.0 damping:49.0 initialVelocity:{0.0, 0.0}];
  v52 = [objc_alloc(MEMORY[0x1E69DD278]) initWithDuration:v51 timingParameters:0.63636];
  v54[0] = MEMORY[0x1E69E9820];
  v54[1] = 3221225472;
  v54[2] = __82__CKChatController_SendAnimation__sendAnimationManagerWillStartAnimation_context___block_invoke_8;
  v54[3] = &unk_1E72EBDB8;
  v55 = v10;
  [v52 addAnimations:v54];
  [v52 startAnimation];

LABEL_15:
}

void __82__CKChatController_SendAnimation__sendAnimationManagerWillStartAnimation_context___block_invoke(uint64_t a1)
{
  v1 = [*(a1 + 32) entryView];
  [v1 invalidateCompositionForReason:1];
}

uint64_t __82__CKChatController_SendAnimation__sendAnimationManagerWillStartAnimation_context___block_invoke_2(uint64_t a1)
{
  [*(a1 + 32) frame];
  v2 = *(a1 + 40);

  return [v2 _setEntryViewFrame:0 animated:?];
}

void __82__CKChatController_SendAnimation__sendAnimationManagerWillStartAnimation_context___block_invoke_3(uint64_t a1)
{
  v1 = [*(a1 + 32) currentNavigationBarBasedOnSizeClass];
  [v1 setAlpha:0.0];
}

uint64_t __82__CKChatController_SendAnimation__sendAnimationManagerWillStartAnimation_context___block_invoke_4(uint64_t a1)
{
  result = [*(a1 + 32) setContentOffset:{*(a1 + 40), *(a1 + 48)}];
  if (*(a1 + 56) == 1)
  {
    v3 = *(a1 + 32);

    return [v3 beginHoldingContentOffsetUpdatesForReason:@"ChatControllerSendAnimation"];
  }

  return result;
}

uint64_t __82__CKChatController_SendAnimation__sendAnimationManagerWillStartAnimation_context___block_invoke_5(uint64_t a1)
{
  result = [*(a1 + 32) setContentOffset:{*(a1 + 40), *(a1 + 48)}];
  if (*(a1 + 56) == 1)
  {
    v3 = *(a1 + 32);

    return [v3 beginHoldingContentOffsetUpdatesForReason:@"ChatControllerSendAnimation"];
  }

  return result;
}

- (UIEdgeInsets)_contentInsetForSendAnimation
{
  entryView = [(CKChatController *)self entryView];
  collectionView = [(CKChatController *)self collectionView];
  [collectionView contentInset];
  v6 = v5;
  v8 = v7;
  v10 = v9;
  [entryView bounds];
  v12 = v11;
  [entryView placeholderHeight];
  v14 = v8 - (v12 - v13);
  [(CKScrollViewController *)self navigationBarInsetsWithoutPalette];
  v16 = v15;
  [(CKChatController *)self _currentlyVisibleBannerHeight];
  v18 = v16 + v17;

  v19 = v18;
  v20 = v6;
  v21 = v14;
  v22 = v10;
  result.right = v22;
  result.bottom = v21;
  result.left = v20;
  result.top = v19;
  return result;
}

- (void)sendAnimationManagerDidStopAnimation:(id)animation context:(id)context
{
  contextCopy = context;
  v6 = MEMORY[0x1E69DD250];
  v10 = MEMORY[0x1E69E9820];
  v11 = 3221225472;
  v12 = __80__CKChatController_SendAnimation__sendAnimationManagerDidStopAnimation_context___block_invoke;
  v13 = &unk_1E72EB8D0;
  selfCopy = self;
  v15 = contextCopy;
  v7 = contextCopy;
  [v6 animateWithDuration:0x20000 delay:&v10 options:0 animations:0.2 completion:0.0];
  [(CKScrollViewController *)self endHoldingScrollGeometryUpdatesForReason:@"ThrowAnimation", v10, v11, v12, v13, selfCopy];
  [(CKChatController *)self setIsAnimatingMessageSend:1];
  _fullscreenEffectsManager = [(CKChatController *)self _fullscreenEffectsManager];
  [_fullscreenEffectsManager endHoldingUpdatesForKey:@"CKFullscreenUpdatesSendAnimation"];

  collectionView = [(CKChatController *)self collectionView];
  [collectionView endHoldingContentOffsetUpdatesForReason:@"ChatControllerSendAnimation"];

  [(CKChatController *)self setThrowSendAnimationManager:0];
  [(CKChatController *)self _finishSendAnimation];
}

void __80__CKChatController_SendAnimation__sendAnimationManagerDidStopAnimation_context___block_invoke(uint64_t a1)
{
  if ([*(a1 + 32) _shouldHideNavigationBarForSendAnimationContext:*(a1 + 40)])
  {
    v2 = [*(a1 + 32) currentNavigationBarBasedOnSizeClass];
    [v2 setAlpha:1.0];
  }

  v3 = [*(a1 + 32) entryView];
  [v3 applyDefaultGlass];
}

- (id)_fullscreenEffectsManager
{
  collectionViewController = [(CKCoreChatController *)self collectionViewController];
  fullscreenEffectManager = [collectionViewController fullscreenEffectManager];

  return fullscreenEffectManager;
}

- (void)_finishSendAnimation
{
  conversation = [(CKCoreChatController *)self conversation];
  [conversation setIgnoringTypingUpdates:0];

  if (![(CKChatController *)self isAnimatingMessageSend])
  {
    return;
  }

  collectionViewController = [(CKCoreChatController *)self collectionViewController];
  [collectionViewController setHiddenItems:0];

  conversation2 = [(CKCoreChatController *)self conversation];
  chat = [conversation2 chat];
  guid = [chat guid];
  if (guid)
  {
    v8 = guid;
    conversation3 = [(CKCoreChatController *)self conversation];
    chat2 = [conversation3 chat];
    guid2 = [chat2 guid];
    v11 = +[CKConversationList sharedConversationList];
    pendingConversation = [v11 pendingConversation];
    chat3 = [pendingConversation chat];
    guid3 = [chat3 guid];
    v38 = [guid2 isEqualToString:guid3];

    if (!v38)
    {
      goto LABEL_7;
    }

    conversation2 = +[CKConversationList sharedConversationList];
    [conversation2 unpendConversation];
  }

  else
  {
  }

LABEL_7:
  conversation4 = [(CKCoreChatController *)self conversation];
  conversation5 = [(CKCoreChatController *)self conversation];
  objc_opt_class();
  isKindOfClass = objc_opt_isKindOfClass();

  if (isKindOfClass)
  {
    v18 = +[CKConversationList sharedConversationList];
    chat4 = [conversation4 chat];
    v20 = [v18 conversationForExistingChat:chat4];

    if (v20)
    {
      v21 = v20;

      conversation4 = v21;
    }
  }

  [(CKChatController *)self _didSendCompositionInConversation:conversation4];
  collectionViewController2 = [(CKCoreChatController *)self collectionViewController];
  collectionView = [collectionViewController2 collectionView];
  [(CKChatController *)self setSendingMessage:0];
  [(CKChatController *)self setIsAnimatingMessageSend:0];
  [(CKChatController *)self endHoldingAutorotationForKey:@"CKHoldingRotationReasonThrowAnimation"];
  [collectionView endDisablingTranscriptDynamicsForReason:5];
  [collectionView setScrollEnabled:1];
  conversation6 = [(CKCoreChatController *)self conversation];
  chat5 = [conversation6 chat];
  guid4 = [chat5 guid];
  if (!guid4)
  {

    goto LABEL_15;
  }

  v27 = guid4;
  conversation7 = [(CKCoreChatController *)self conversation];
  chat6 = [conversation7 chat];
  guid5 = [chat6 guid];
  +[CKConversationList sharedConversationList];
  v29 = v41 = conversation4;
  [v29 pendingConversation];
  v30 = v39 = collectionViewController2;
  chat7 = [v30 chat];
  guid6 = [chat7 guid];
  v35 = [guid5 isEqualToString:guid6];

  collectionViewController2 = v39;
  conversation4 = v41;

  if (v35)
  {
    conversation6 = +[CKConversationList sharedConversationList];
    [conversation6 unpendConversation];
LABEL_15:
  }

  [(CKChatController *)self _updateNavigationButtons];
  chat8 = [collectionViewController2 chat];
  [chat8 endHoldingChatItemsUpdatesForReason:*MEMORY[0x1E69A57E0]];
  [MEMORY[0x1E69DD258] attemptRotationToDeviceOrientation];
  [(CKChatController *)self _showOrHideNicknameBannerIfNeeded];
  if ([collectionView transcriptScrollIntent] == 3)
  {
    v34 = IMLogHandleForCategory();
    if (os_log_type_enabled(v34, OS_LOG_TYPE_ERROR))
    {
      [(CKChatController(SendAnimation) *)v34 _finishSendAnimation];
    }

    [collectionViewController2 updateTranscriptScrollIntentToBottomOrHistoryBasedOnCurrentContentOffset];
  }
}

- (BOOL)__shouldHideNavigationBarForThrowBalloonViewAttributesCollection:(id)collection inContainerView:(id)view framesOfAddedChatItems:(id)items
{
  v27 = *MEMORY[0x1E69E9840];
  itemsCopy = items;
  [(CKChatController *)self _convertedNavigationBarFrameInSendAnimationContainerView:view];
  v9 = v8;
  v11 = v10;
  v13 = v12;
  v15 = v14;
  v22 = 0u;
  v23 = 0u;
  v24 = 0u;
  v25 = 0u;
  v16 = itemsCopy;
  v17 = [v16 countByEnumeratingWithState:&v22 objects:v26 count:16];
  if (v17)
  {
    v18 = *v23;
    while (2)
    {
      for (i = 0; i != v17; ++i)
      {
        if (*v23 != v18)
        {
          objc_enumerationMutation(v16);
        }

        [*(*(&v22 + 1) + 8 * i) CGRectValue];
        MinY = CGRectGetMinY(v28);
        v29.origin.x = v9;
        v29.origin.y = v11;
        v29.size.width = v13;
        v29.size.height = v15;
        if (MinY < CGRectGetMaxY(v29))
        {
          LOBYTE(v17) = 1;
          goto LABEL_11;
        }
      }

      v17 = [v16 countByEnumeratingWithState:&v22 objects:v26 count:16];
      if (v17)
      {
        continue;
      }

      break;
    }
  }

LABEL_11:

  return v17;
}

- (BOOL)_shouldHideNavigationBarForSendAnimationContext:(id)context
{
  contextCopy = context;
  sendAnimationType = [contextCopy sendAnimationType];
  throwBalloonViewAttributesCollection = [contextCopy throwBalloonViewAttributesCollection];
  if (sendAnimationType == 1)
  {
    behindGlassContainerView = [contextCopy behindGlassContainerView];
  }

  else
  {
    if (sendAnimationType)
    {
      v8 = 0;
      goto LABEL_7;
    }

    behindGlassContainerView = [contextCopy containerView];
  }

  v8 = behindGlassContainerView;
LABEL_7:
  framesOfAddedChatItems = [contextCopy framesOfAddedChatItems];
  v10 = [(CKChatController *)self __shouldHideNavigationBarForThrowBalloonViewAttributesCollection:throwBalloonViewAttributesCollection inContainerView:v8 framesOfAddedChatItems:framesOfAddedChatItems];

  return v10;
}

- (CGRect)_convertedNavigationBarFrameInSendAnimationContainerView:(id)view
{
  viewCopy = view;
  currentNavigationBarBasedOnSizeClass = [(CKChatController *)self currentNavigationBarBasedOnSizeClass];
  superview = [currentNavigationBarBasedOnSizeClass superview];
  [currentNavigationBarBasedOnSizeClass frame];
  [superview convertRect:viewCopy toView:?];
  v8 = v7;
  v10 = v9;
  v12 = v11;
  v14 = v13;

  v15 = v8;
  v16 = v10;
  v17 = v12;
  v18 = v14;
  result.size.height = v18;
  result.size.width = v17;
  result.origin.y = v16;
  result.origin.x = v15;
  return result;
}

- (BOOL)throwAnimationUsesAnimatedReloadForMessages:(id)messages
{
  v20 = *MEMORY[0x1E69E9840];
  messagesCopy = messages;
  mEMORY[0x1E69A8070] = [MEMORY[0x1E69A8070] sharedFeatureFlags];
  isDiffableTranscriptDataSourceEnabled = [mEMORY[0x1E69A8070] isDiffableTranscriptDataSourceEnabled];

  if (isDiffableTranscriptDataSourceEnabled)
  {
    v6 = 0;
  }

  else
  {
    v17 = 0u;
    v18 = 0u;
    v15 = 0u;
    v16 = 0u;
    v7 = messagesCopy;
    v8 = [v7 countByEnumeratingWithState:&v15 objects:v19 count:16];
    if (v8)
    {
      v9 = v8;
      v10 = *v16;
      while (2)
      {
        for (i = 0; i != v9; ++i)
        {
          if (*v16 != v10)
          {
            objc_enumerationMutation(v7);
          }

          balloonBundleID = [*(*(&v15 + 1) + 8 * i) balloonBundleID];
          v13 = [balloonBundleID length];

          if (v13)
          {
            v6 = 0;
            goto LABEL_13;
          }
        }

        v9 = [v7 countByEnumeratingWithState:&v15 objects:v19 count:16];
        if (v9)
        {
          continue;
        }

        break;
      }
    }

    v6 = 1;
LABEL_13:
  }

  return v6;
}

- (void)throwAnimationManager:(id)manager canNowSendMessages:(id)messages
{
  messagesCopy = messages;
  v6 = [(CKChatController *)self throwAnimationUsesAnimatedReloadForMessages:messagesCopy];
  collectionViewController = [(CKCoreChatController *)self collectionViewController];
  v9[0] = MEMORY[0x1E69E9820];
  v9[1] = 3221225472;
  v9[2] = __76__CKChatController_SendAnimation__throwAnimationManager_canNowSendMessages___block_invoke;
  v9[3] = &unk_1E72EB8D0;
  v9[4] = self;
  v10 = messagesCopy;
  v8 = messagesCopy;
  [collectionViewController updateTranscript:v9 animated:v6 completion:0];
}

void __76__CKChatController_SendAnimation__throwAnimationManager_canNowSendMessages___block_invoke(uint64_t a1)
{
  v22 = *MEMORY[0x1E69E9840];
  v2 = [*(a1 + 32) conversation];
  v15 = 0u;
  v16 = 0u;
  v13 = 0u;
  v14 = 0u;
  obj = *(a1 + 40);
  v3 = [obj countByEnumeratingWithState:&v13 objects:v21 count:16];
  if (v3)
  {
    v5 = *v14;
    *&v4 = 138412546;
    v11 = v4;
    do
    {
      v6 = 0;
      do
      {
        if (*v14 != v5)
        {
          objc_enumerationMutation(obj);
        }

        v7 = *(*(&v13 + 1) + 8 * v6);
        if (IMOSLoggingEnabled())
        {
          v8 = OSLogHandleForIMFoundationCategory();
          if (os_log_type_enabled(v8, OS_LOG_TYPE_INFO))
          {
            v9 = [v7 guid];
            v10 = [v2 uniqueIdentifier];
            *buf = v11;
            v18 = v9;
            v19 = 2112;
            v20 = v10;
            _os_log_impl(&dword_19020E000, v8, OS_LOG_TYPE_INFO, "Throw animation is now sending message: %@ in conversation: %@", buf, 0x16u);
          }
        }

        [*(a1 + 32) sendMessage:v7 forConversation:v2 newComposition:{0, v11}];
        ++v6;
      }

      while (v3 != v6);
      v3 = [obj countByEnumeratingWithState:&v13 objects:v21 count:16];
    }

    while (v3);
  }
}

- (CGRect)throwAnimationWindowFrame:(id)frame
{
  navigationController = [(CKChatController *)self navigationController];
  view = [navigationController view];
  [view frame];
  v6 = v5;
  v8 = v7;
  v10 = v9;
  v12 = v11;

  v13 = v6;
  v14 = v8;
  v15 = v10;
  v16 = v12;
  result.size.height = v16;
  result.size.width = v15;
  result.origin.y = v14;
  result.origin.x = v13;
  return result;
}

- (id)throwAnimationContainerSuperview:(id)superview
{
  view = [(CKChatController *)self view];
  window = [view window];

  return window;
}

- (double)throwAnimationManagerTopHeaderHeight:(id)height
{
  [(CKScrollViewController *)self navigationBarInsetsWithoutPalette];
  v5 = v4;
  [(CKChatController *)self _currentlyVisibleBannerHeight];
  return v5 + v6;
}

- (void)throwAnimationManagerPrepareForThrowAnimation:(id)animation context:(id)context
{
  [(CKChatController *)self setIsAnimatingMessageSend:1, context];
  collectionView = [(CKChatController *)self collectionView];
  [collectionView beginDisablingTranscriptDynamicsForReason:5];
  [(CKChatController *)self beginHoldingAutorotationForKey:@"CKHoldingRotationReasonThrowAnimation"];
  [(CKScrollViewController *)self beginHoldingScrollGeometryUpdatesForReason:@"ThrowAnimation"];
  chat = [(CKCoreChatController *)self chat];
  [chat beginHoldingChatItemsUpdatesForReason:*MEMORY[0x1E69A57E0]];
  _fullscreenEffectsManager = [(CKChatController *)self _fullscreenEffectsManager];
  [_fullscreenEffectsManager beginHoldingUpdatesForKey:@"CKFullscreenUpdatesSendAnimation"];
}

- (id)_audioMessageThrowBalloonsForSendingMessages:(id)messages audioMessageSourceRect:(CGRect)rect contextContainerView:(id)view audioRecordingPillViewSnapshot:(id)snapshot
{
  height = rect.size.height;
  width = rect.size.width;
  y = rect.origin.y;
  x = rect.origin.x;
  v36[1] = *MEMORY[0x1E69E9840];
  snapshotCopy = snapshot;
  viewCopy = view;
  messagesCopy = messages;
  collectionViewController = [(CKCoreChatController *)self collectionViewController];
  chatItems = [collectionViewController chatItems];

  v18 = [chatItems __ck_indexesOfPartsOfMessages:messagesCopy];

  v19 = [chatItems objectAtIndexedSubscript:{objc_msgSend(v18, "firstIndex")}];
  v20 = CKBalloonViewForClass([v19 balloonViewClass]);
  [v20 configureForMessagePart:v19];
  [v20 setIsBeingUsedInThrowAnimation:1];
  [v20 setCanUseOpaqueMask:0];
  objc_opt_class();
  if (objc_opt_isKindOfClass())
  {
    v21 = v20;
    gradientReferenceView = [(CKCoreChatController *)self gradientReferenceView];
    [v21 setGradientReferenceView:gradientReferenceView];
  }

  [v20 prepareForDisplayIfNeeded];
  v23 = [objc_alloc(MEMORY[0x1E69DD250]) initWithFrame:{x, y, width, height}];
  clearColor = [MEMORY[0x1E69DC888] clearColor];
  [v23 setBackgroundColor:clearColor];

  [viewCopy addSubview:v23];
  v25 = *MEMORY[0x1E695EFF8];
  v26 = *(MEMORY[0x1E695EFF8] + 8);
  [v19 size];
  v28 = width - v27;
  [v19 size];
  [v20 setFrame:{v28, 0.0, v29, v30}];
  [v20 layoutIfNeeded];
  [v23 addSubview:v20];
  v31 = snapshotCopy;
  [v31 setFrame:{v25, v26, width, height}];
  [v23 insertSubview:v31 aboveSubview:v20];
  v32 = objc_alloc_init(CKSendAnimationSupplementaryViews);
  [(CKSendAnimationSupplementaryViews *)v32 setTextViewContainerView:v23];
  [(CKSendAnimationSupplementaryViews *)v32 setAudioMessagePillViewSnapshot:v31];

  v33 = objc_alloc_init(CKThrowBalloonViewAttributes);
  [(CKThrowBalloonViewAttributes *)v33 setSupplementaryViews:v32];
  [(CKThrowBalloonViewAttributes *)v33 setThrowBalloonView:v20];
  v36[0] = v33;
  v34 = [MEMORY[0x1E695DEC8] arrayWithObjects:v36 count:1];

  return v34;
}

- (id)_throwBalloonAttributesForSendAnimationWithType:(unint64_t)type shouldUseQuickReplySourceRect:(BOOL)rect quickReplySourceRect:(CGRect)sourceRect isRunningPhotosPlugin:(BOOL)plugin chatItem:(id)item isPhotosExtensionMediaPayload:(BOOL)payload pluginChatItemCounterInOut:(unint64_t *)out containerView:(id)self0 isChatItemFromShelf:(BOOL)self1 isLastChatItem:(BOOL)self2 currentBalloonOriginInOut:(CGPoint *)self3 quickReplySnapshotView:(id)self4
{
  payloadCopy = payload;
  width = sourceRect.size.width;
  rectCopy = rect;
  itemCopy = item;
  viewCopy = view;
  snapshotViewCopy = snapshotView;
  selfCopy = self;
  entryView = [(CKChatController *)self entryView];
  contentView = [entryView contentView];
  pluginView = [contentView pluginView];
  if (plugin || payloadCopy)
  {
    objc_opt_class();
    if (objc_opt_isKindOfClass())
    {
      v23 = 0;
      v24 = pluginView;
      v25 = entryView;
      goto LABEL_88;
    }
  }

  v208 = contentView;
  v219[0] = 0;
  v218 = 1.0;
  v26 = +[CKUIBehavior sharedBehaviors];
  [v26 balloonMaskTailSizeForTailShape:1];
  v28 = v27;

  v210 = objc_alloc_init(CKThrowBalloonViewAttributes);
  v215 = objc_alloc_init(CKSendAnimationSupplementaryViews);
  v29 = itemCopy;
  v30 = CKBalloonViewForClass([v29 balloonViewClass]);
  objc_opt_class();
  v209 = itemCopy;
  if (objc_opt_isKindOfClass())
  {
    objc_opt_class();
    if (objc_opt_isKindOfClass())
    {
      r1 = viewCopy;
      v31 = v29;
      v32 = v30;
      bundleIdentifier = [v31 bundleIdentifier];
      v34 = IMBalloonExtensionIDWithSuffix();
      v35 = [bundleIdentifier isEqualToString:v34];

      if (v35)
      {
        collectionViewController = [(CKCoreChatController *)selfCopy collectionViewController];
        transcriptIdentifier = [collectionViewController transcriptIdentifier];
        [v32 configureForTranscriptPlugin:v31 context:transcriptIdentifier];

        [v32 setShouldPerformSendAnimationOnAppear];
        v38 = objc_alloc(MEMORY[0x1E69DD648]);
        pluginView2 = [v32 pluginView];
        v40 = [v38 initWithSourceView:pluginView2];

        [v40 setHidesSourceView:1];
        [v40 setMatchesTransform:1];
        [v32 pluginInsets];
        [v40 setLayoutMargins:?];
        clearColor = [MEMORY[0x1E69DC888] clearColor];
        [v40 setBackgroundColor:clearColor];
      }

      else
      {
        entryView2 = [(CKChatController *)selfCopy entryView];
        contentView2 = [entryView2 contentView];
        v40 = [contentView2 pluginSnapshotViewForPluginAtIndex:*out isFromTextAttachment:v219 startingScaleMultiplier:&v218];

        clearColor = [(CKCoreChatController *)selfCopy collectionViewController];
        transcriptIdentifier2 = [clearColor transcriptIdentifier];
        [v32 configureForTranscriptPlugin:v31 context:transcriptIdentifier2];
      }

      [v32 setPluginSnapshotViewForThrowAnimation:v40];
      viewCopy = r1;
      v25 = entryView;
    }

    else
    {
      objc_opt_class();
      v25 = entryView;
      if (objc_opt_isKindOfClass())
      {
        [v30 configureForTranscriptPlugin:v29];
      }
    }

    if (out)
    {
      ++*out;
    }
  }

  else
  {
    objc_opt_class();
    v25 = entryView;
    if (objc_opt_isKindOfClass())
    {
      [v30 configureForMessagePart:v29];
    }

    else
    {
      [v30 configureForChatItem:v29];
    }
  }

  [v30 setIsBeingUsedInThrowAnimation:1];
  [v30 setCanUseOpaqueMask:0];
  objc_opt_class();
  if ((objc_opt_isKindOfClass() & 1) == 0)
  {
    if (type)
    {
      if (type == 1)
      {
        [viewCopy insertSubview:v30 atIndex:0];
      }
    }

    else
    {
      [viewCopy addSubview:v30];
    }
  }

  [v29 size];
  v46 = v45;
  v48 = v47;
  objc_opt_class();
  if (objc_opt_isKindOfClass())
  {
    v49 = v30;
    gradientReferenceView = [(CKCoreChatController *)selfCopy gradientReferenceView];
    [v49 setGradientReferenceView:gradientReferenceView];
  }

  [v30 prepareForDisplayIfNeeded];
  [v30 tailInsetsForPillSize:{v46, v48}];
  v53 = v46 + v51 + v52;
  v201 = v48;
  v56 = v48 + v54 + v55;
  objc_opt_class();
  isKindOfClass = objc_opt_isKindOfClass();
  if (isKindOfClass)
  {
    v58 = snapshotViewCopy;
    v59 = viewCopy;
    [v30 setFrame:{*MEMORY[0x1E695EFF8], *(MEMORY[0x1E695EFF8] + 8), v53, v56}];
    [v30 layoutIfNeeded];
    v60 = v30;
    textView = [v60 textView];
    [textView frame];
    x = v62;
    y = v64;
    v67 = v66;
    r1a = v68;

    mEMORY[0x1E69A8070] = [MEMORY[0x1E69A8070] sharedFeatureFlags];
    isAutomaticOutgoingTranslationEnabled = [mEMORY[0x1E69A8070] isAutomaticOutgoingTranslationEnabled];

    v196 = width;
    v198 = v56;
    v194 = v53;
    v195 = v46;
    v193 = v28;
    v199 = v67;
    if (isAutomaticOutgoingTranslationEnabled && ([MEMORY[0x1E69A8070] sharedFeatureFlags], v71 = objc_claimAutoreleasedReturnValue(), v72 = objc_msgSend(v71, "isSendAnimationRefreshEnabled"), v71, v72))
    {
      translationSecondaryTextView = [v60 translationSecondaryTextView];
      v74 = translationSecondaryTextView;
      if (translationSecondaryTextView && ([translationSecondaryTextView isHidden] & 1) == 0)
      {
        [v74 frame];
        v231.origin.x = v75;
        v231.origin.y = v76;
        v231.size.width = v77;
        v231.size.height = v78;
        v221.origin.x = x;
        v221.origin.y = y;
        v221.size.width = v67;
        v221.size.height = r1a;
        v222 = CGRectUnion(v221, v231);
        x = v222.origin.x;
        y = v222.origin.y;
        v199 = v222.size.width;
        r1a = v222.size.height;
      }

      viewCopy = v59;

      snapshotViewCopy = v58;
      v25 = entryView;
    }

    else
    {
      viewCopy = v59;
      snapshotViewCopy = v58;
    }

    [v60 bounds];
    v81 = v223.origin.x;
    v82 = v223.origin.y;
    v83 = v223.size.width;
    height = v223.size.height;
    v214 = y - v223.origin.y;
    MaxY = CGRectGetMaxY(v223);
    v224.origin.x = x;
    v224.origin.y = y;
    v224.size.width = v199;
    v224.size.height = r1a;
    v79 = MaxY - CGRectGetMaxY(v224);
    v225.origin.x = v81;
    v225.origin.y = v82;
    v225.size.width = v83;
    v225.size.height = height;
    CGRectGetMaxX(v225);
    v226.origin.x = x;
    v226.origin.y = y;
    v226.size.width = v199;
    v226.size.height = r1a;
    [v25 coverViewWidth];
    v87 = v193 + v86;
    if (rectCopy)
    {
      v80 = v196;
    }

    else
    {
      v80 = v87;
    }

    v56 = v198;
    v53 = v194;
    v46 = v195;
  }

  else
  {
    v214 = *MEMORY[0x1E69DDCE0];
    v79 = *(MEMORY[0x1E69DDCE0] + 16);
    v80 = *(MEMORY[0x1E695F058] + 16);
  }

  v88 = inOut->x;
  v89 = inOut->y - v214;
  mEMORY[0x1E69A8070]2 = [MEMORY[0x1E69A8070] sharedFeatureFlags];
  isAutomaticOutgoingTranslationEnabled2 = [mEMORY[0x1E69A8070]2 isAutomaticOutgoingTranslationEnabled];

  if (isAutomaticOutgoingTranslationEnabled2)
  {
    mEMORY[0x1E69A8070]3 = [MEMORY[0x1E69A8070] sharedFeatureFlags];
    isSendAnimationRefreshEnabled = [mEMORY[0x1E69A8070]3 isSendAnimationRefreshEnabled];

    if (isSendAnimationRefreshEnabled)
    {
      objc_opt_class();
      if (isKindOfClass & objc_opt_isKindOfClass())
      {
        v94 = v29;
        v95 = v30;
        alternateTranscriptText = [v94 alternateTranscriptText];
        v97 = alternateTranscriptText;
        if (alternateTranscriptText)
        {
          v98 = [alternateTranscriptText length];
          if (([v94 showTranslationAlternateText] & 1) == 0 && v98)
          {
            textView2 = [v95 textView];
            [textView2 frame];
            v89 = v89 + CGRectGetMaxY(v227);
          }
        }

        else
        {
          [v94 showTranslationAlternateText];
        }

        v25 = entryView;
      }
    }
  }

  objc_opt_class();
  v100 = objc_opt_isKindOfClass();
  v23 = v210;
  if (!shelf)
  {
    v118 = v100;
    v119 = v219[0];
    if ([v30 isAudioMessage])
    {
      [viewCopy convertRect:v25 fromView:{v88, v89, v53, v56}];
      [v30 setFrame:?];
      [v30 layoutIfNeeded];
      [v30 prepareForDisplayIfNeeded];
      itemCopy = v209;
      v24 = pluginView;
      goto LABEL_87;
    }

    objc_opt_class();
    if (objc_opt_isKindOfClass())
    {
      v207 = v79;
      v120 = v30;
      v228.origin.x = v88;
      v228.origin.y = v89;
      v228.size.width = v53;
      v228.size.height = v56;
      v121 = CGRectGetHeight(v228);
      v122 = [objc_alloc(MEMORY[0x1E69DD250]) initWithFrame:{v88, v89, v80, v121}];
      clearColor2 = [MEMORY[0x1E69DC888] clearColor];
      [v122 setBackgroundColor:clearColor2];

      if (type)
      {
        if (type == 1)
        {
          [viewCopy insertSubview:v122 atIndex:0];
        }
      }

      else
      {
        [viewCopy addSubview:v122];
      }

      [(CKSendAnimationSupplementaryViews *)v215 setTextViewContainerView:v122];
      [v120 frame];
      v137 = v136;
      v139 = v138;
      v229.origin.x = v88;
      v229.origin.y = v89;
      v229.size.width = v80;
      v229.size.height = v121;
      v140 = CGRectGetWidth(v229);
      [v120 frame];
      v141 = v140 - CGRectGetWidth(v230);
      v200 = [objc_alloc(MEMORY[0x1E69DD250]) initWithFrame:{v141, 0.0, v137, v139}];
      [v122 addSubview:?];
      [v120 setFrame:{v141, 0.0, v137, v139}];
      [v122 addSubview:v120];
      [v120 prepareForDisplayIfNeeded];
      v142 = CKBalloonViewForClass([v29 balloonViewClass]);
      [v142 configureForMessagePart:v29];
      if (([v142 balloonStyle] - 3) <= 1u)
      {
        [v142 setBalloonStyle:0];
      }

      if (type == 1)
      {
        v143 = 1;
      }

      else
      {
        if (type)
        {
LABEL_77:
          r1b = viewCopy;
          [v142 setIsBeingUsedInThrowAnimation:1];
          [v142 setCanUseOpaqueMask:0];
          [v142 prepareForDisplayIfNeeded];
          textView3 = [v142 textView];
          labelColor = [MEMORY[0x1E69DC888] labelColor];
          v146 = [v29 sendAnimationTextWithColor:labelColor];
          [textView3 setAttributedText:v146];

          [v142 setFrame:{v141, 0.0, v137, v139}];
          [v142 layoutIfNeeded];
          if (type == 1)
          {
            [v142 setAlpha:0.0];
            [v120 setAlpha:0.0];
            [v142 setHidden:1];
          }

          v213 = v122;
          [v122 insertSubview:v142 aboveSubview:v120];
          [(CKSendAnimationSupplementaryViews *)v215 setWhiteTextFadeView:v142];
          textView4 = [v120 textView];
          text = [textView4 text];
          _isNaturallyRTL = [text _isNaturallyRTL];

          if (_isNaturallyRTL)
          {
            textView5 = [v120 textView];
            [textView5 setHidden:1];

            textView6 = [v142 textView];
            [textView6 setHidden:1];

            v202 = v120;
            v152 = objc_alloc_init(MEMORY[0x1E69DD168]);
            transcriptText = [v29 transcriptText];
            [v152 setAttributedText:transcriptText];

            clearColor3 = [MEMORY[0x1E69DC888] clearColor];
            [v152 setBackgroundColor:clearColor3];

            [v152 setTextAlignment:2];
            textView7 = [v202 textView];
            [textView7 textContainerInset];
            [v152 setTextContainerInset:?];

            contentView3 = [v25 contentView];
            textView8 = [contentView3 textView];

            [textView8 bounds];
            [textView8 convertRect:v122 toView:?];
            v158 = v157;
            v160 = v159;
            v162 = v161;
            v164 = v163;
            [v152 setFrame:?];
            [v122 addSubview:v152];
            v165 = objc_alloc_init(MEMORY[0x1E69DD168]);
            labelColor2 = [MEMORY[0x1E69DC888] labelColor];
            v167 = [v29 sendAnimationTextWithColor:labelColor2];
            [v165 setAttributedText:v167];

            clearColor4 = [MEMORY[0x1E69DC888] clearColor];
            [v165 setBackgroundColor:clearColor4];

            [v165 setFrame:{v158, v160, v162, v164}];
            [v165 setTextAlignment:2];
            textView9 = [v202 textView];
            [textView9 textContainerInset];
            [v165 setTextContainerInset:?];

            [v122 addSubview:v165];
            [(CKSendAnimationSupplementaryViews *)v215 setWhiteTextFadeViewRTL:v165];
            [(CKSendAnimationSupplementaryViews *)v215 setBlueTextFadeViewRTL:v152];

            v25 = entryView;
            v120 = v202;
          }

          if (rectCopy)
          {
            button = snapshotViewCopy;
            view = [(CKChatController *)selfCopy view];
            collectionView = [(CKChatController *)selfCopy collectionView];
            [view insertSubview:button belowSubview:collectionView];

            [(CKSendAnimationSupplementaryViews *)v215 setQuickReplySnapshot:button];
            itemCopy = v209;
          }

          else
          {
            sendButton = [v25 sendButton];
            button = [sendButton button];

            [button frame];
            v175 = v174;
            v177 = v176;
            v179 = v178;
            v181 = v180;
            superview = [button superview];
            [v122 convertRect:superview fromView:{v175, v177, v179, v181}];
            v184 = v183;
            v186 = v185;
            v188 = v187;
            v190 = v189;

            v191 = [button snapshotViewAfterScreenUpdates:0];
            [v191 setFrame:{v184, v186, v188, v190}];
            [v122 insertSubview:v191 aboveSubview:v142];
            [(CKSendAnimationSupplementaryViews *)v215 setSendButtonSnapshot:v191];
            itemCopy = v209;
            if (!chatItem)
            {
              [v191 setHidden:1];
            }
          }

          inOut->y = v56 - (v207 + v214) + inOut->y;
          viewCopy = r1b;
          v24 = pluginView;
          v23 = v210;
          goto LABEL_87;
        }

        v143 = 8;
      }

      [v142 setColor:v143];
      goto LABEL_77;
    }

    v124 = v118 & v119;
    objc_opt_class();
    if (objc_opt_isKindOfClass())
    {
      objc_opt_class();
      itemCopy = v209;
      v24 = pluginView;
      if (!(v124 & 1 | ((objc_opt_isKindOfClass() & 1) == 0)))
      {
LABEL_57:
        [v30 setFrame:{v88, v89, v53, v56}];
        [v30 layoutIfNeeded];
        [v30 prepareForDisplayIfNeeded];
        v125 = v56 - (v79 + v214);
LABEL_68:
        inOut->y = v125 + inOut->y;
        goto LABEL_87;
      }
    }

    else
    {
      itemCopy = v209;
      v24 = pluginView;
      if ((v124 & 1) == 0)
      {
        goto LABEL_57;
      }
    }

    v126 = +[CKUIBehavior sharedBehaviors];
    [v25 coverViewWidth];
    [v126 composeBalloonMaxWidthForEntryContentViewWidth:?];
    v127 = v53;
    v128 = v79;
    v130 = v129 / v46;

    v131 = v46 * v130;
    v132 = v201 * v130;
    if (v130 >= 1.0)
    {
      v132 = v56;
      v131 = v127;
    }

    if (v218 >= 1.0)
    {
      v133 = v132;
    }

    else
    {
      v133 = v201 * v218;
    }

    if (v218 >= 1.0)
    {
      v134 = v131;
    }

    else
    {
      v134 = v46 * v218;
    }

    [v25 marginInsets];
    [v30 setFrame:{v88 + v135, v89, v134, v133}];
    [v30 layoutIfNeeded];
    [v30 prepareForDisplayIfNeeded];
    v125 = v133 - (v128 + v214);
    goto LABEL_68;
  }

  v24 = pluginView;
  [pluginView frame];
  v102 = v101;
  v104 = v103;
  v106 = v105;
  v108 = v107;
  superview2 = [pluginView superview];
  [viewCopy convertRect:superview2 fromView:{v102, v104, v106, v108}];
  v111 = v110;
  v113 = v112;
  v115 = v114;
  v117 = v116;

  [v30 setFrame:{v111, v113, v115, v117}];
  [v30 layoutIfNeeded];
  [v30 prepareForDisplayIfNeeded];
  itemCopy = v209;
LABEL_87:
  [(CKThrowBalloonViewAttributes *)v23 setSupplementaryViews:v215];
  [(CKThrowBalloonViewAttributes *)v23 setThrowBalloonView:v30];

  contentView = v208;
LABEL_88:

  return v23;
}

- (void)setupThrowBalloonsInSendAnimationContext:(id)context
{
  contextCopy = context;
  messages = [contextCopy messages];
  shouldUseQuickReplySourceRect = [contextCopy shouldUseQuickReplySourceRect];
  [contextCopy quickReplySourceRect];
  v7 = v6;
  v9 = v8;
  v11 = v10;
  v13 = v12;
  quickReplySnapshotView = [contextCopy quickReplySnapshotView];
  sendAnimationType = [contextCopy sendAnimationType];
  [contextCopy audioMessageSourceRect];
  v17 = v16;
  v19 = v18;
  v21 = v20;
  v23 = v22;
  audioRecordingPillViewSnapshot = [contextCopy audioRecordingPillViewSnapshot];
  if (sendAnimationType == 1)
  {
    behindGlassContainerView = [contextCopy behindGlassContainerView];
    goto LABEL_5;
  }

  if (!sendAnimationType)
  {
    behindGlassContainerView = [contextCopy containerView];
LABEL_5:
    v26 = behindGlassContainerView;
    goto LABEL_7;
  }

  v26 = 0;
LABEL_7:
  v27 = [(CKChatController *)self _makeThrowBalloonsForSendAnimationWithType:sendAnimationType inContainerView:v26 forSendingMessages:messages shouldUseQuickReplySourceRect:shouldUseQuickReplySourceRect quickReplySourceRect:quickReplySnapshotView quickReplySnapshotView:audioRecordingPillViewSnapshot audioMessageSourceRect:v7 audioRecordingPillViewSnapshot:v9, v11, v13, v17, v19, v21, v23];
  [contextCopy setThrowBalloonViewAttributesCollection:v27];
}

- (id)_makeThrowBalloonsForSendAnimationWithType:(unint64_t)type inContainerView:(id)view forSendingMessages:(id)messages shouldUseQuickReplySourceRect:(BOOL)rect quickReplySourceRect:(CGRect)sourceRect quickReplySnapshotView:(id)snapshotView audioMessageSourceRect:(CGRect)messageSourceRect audioRecordingPillViewSnapshot:(id)self0
{
  rectCopy = rect;
  height = messageSourceRect.size.height;
  width = messageSourceRect.size.width;
  y = messageSourceRect.origin.y;
  x = messageSourceRect.origin.x;
  v17 = sourceRect.size.height;
  v18 = sourceRect.size.width;
  v19 = sourceRect.origin.y;
  v20 = sourceRect.origin.x;
  viewCopy = view;
  messagesCopy = messages;
  snapshotViewCopy = snapshotView;
  snapshotCopy = snapshot;
  collectionViewController = [(CKCoreChatController *)self collectionViewController];
  entryView = [(CKChatController *)self entryView];
  contentView = [entryView contentView];
  contentView2 = [entryView contentView];
  pluginView = [contentView2 pluginView];

  composition = [(CKChatController *)self composition];
  shelfPluginPayload = [composition shelfPluginPayload];

  pluginBundleID = [shelfPluginPayload pluginBundleID];
  v64 = [pluginBundleID isEqualToString:*MEMORY[0x1E69A6A00]];

  pluginBundleID2 = [shelfPluginPayload pluginBundleID];
  v32 = IMBalloonExtensionIDWithSuffix();
  v72 = viewCopy;
  if ([pluginBundleID2 isEqualToString:v32] && (objc_opt_class(), (objc_opt_isKindOfClass() & 1) != 0))
  {
    shouldSendAsMediaObject = [shelfPluginPayload shouldSendAsMediaObject];
  }

  else
  {
    shouldSendAsMediaObject = 0;
  }

  lastObject = [messagesCopy lastObject];
  v66 = collectionViewController;
  chatItems = [collectionViewController chatItems];
  v35 = [chatItems __ck_indexesOfPartsOfMessages:messagesCopy];
  isAudioMessage = [lastObject isAudioMessage];
  v70 = v35;
  firstIndex = [v35 firstIndex];
  if (firstIndex != 0x7FFFFFFFFFFFFFFFLL)
  {
    v38 = firstIndex;
    if (firstIndex < [chatItems count])
    {
      v39 = [chatItems objectAtIndexedSubscript:v38];
      objc_opt_class();
      if (objc_opt_isKindOfClass())
      {
        CKBalloonViewForClass([v39 balloonViewClass]);
        v40 = shelfPluginPayload;
        v41 = entryView;
        v42 = messagesCopy;
        v44 = v43 = lastObject;
        objc_opt_class();
        isKindOfClass = objc_opt_isKindOfClass();

        lastObject = v43;
        messagesCopy = v42;
        entryView = v41;
        shelfPluginPayload = v40;

        if ((isAudioMessage & isKindOfClass) == 1)
        {
          v45 = v72;
          v46 = snapshotCopy;
          height = [(CKChatController *)self _audioMessageThrowBalloonsForSendingMessages:messagesCopy audioMessageSourceRect:v72 contextContainerView:snapshotCopy audioRecordingPillViewSnapshot:x, y, width, height];
          goto LABEL_19;
        }
      }

      else
      {
      }
    }
  }

  v97 = 0;
  v98 = &v97;
  v99 = 0x3010000000;
  v101 = 0;
  v102 = 0;
  v100 = &unk_190F92BB2;
  [contentView bounds];
  [contentView convertRect:v72 toView:?];
  v101 = v48;
  v102 = v49;
  [contentView contentOffset];
  v98[5] = v98[5] - v50;
  firstObject = [messagesCopy firstObject];
  scheduleType = [firstObject scheduleType];

  if ([entryView shouldShowSubject] && (objc_msgSend(lastObject, "subject"), v53 = objc_claimAutoreleasedReturnValue(), v53, !v53) || pluginView || scheduleType == 2)
  {
    textView = [contentView textView];
    [textView frame];
    v54 = shelfPluginPayload;
    v55 = entryView;
    v56 = messagesCopy;
    v57 = lastObject;
    v98[5] = v60 + v98[5];
  }

  else
  {
    v54 = shelfPluginPayload;
    v55 = entryView;
    v56 = messagesCopy;
    v57 = lastObject;
    if (rectCopy)
    {
      v58 = v98;
      v98[4] = v20;
      v58[5] = v19;
    }
  }

  v96[0] = 0;
  v96[1] = v96;
  v96[2] = 0x2020000000;
  v96[3] = 0;
  v90 = 0;
  v91 = &v90;
  v92 = 0x3032000000;
  v93 = __Block_byref_object_copy__32;
  v94 = __Block_byref_object_dispose__32;
  v95 = objc_alloc_init(MEMORY[0x1E695DF70]);
  v73[0] = MEMORY[0x1E69E9820];
  v73[1] = 3221225472;
  v73[2] = __241__CKChatController_SendAnimation___makeThrowBalloonsForSendAnimationWithType_inContainerView_forSendingMessages_shouldUseQuickReplySourceRect_quickReplySourceRect_quickReplySnapshotView_audioMessageSourceRect_audioRecordingPillViewSnapshot___block_invoke;
  v73[3] = &unk_1E72F2568;
  v74 = v70;
  v75 = contentView;
  selfCopy = self;
  v87 = rectCopy;
  v83 = v20;
  v84 = v19;
  v85 = v18;
  v86 = v17;
  v88 = v64;
  v89 = shouldSendAsMediaObject;
  typeCopy = type;
  v79 = v96;
  v45 = v72;
  v77 = v72;
  v80 = &v97;
  v78 = snapshotViewCopy;
  v81 = &v90;
  [chatItems enumerateObjectsAtIndexes:v74 options:0 usingBlock:v73];
  height = [v91[5] copy];

  _Block_object_dispose(&v90, 8);
  _Block_object_dispose(v96, 8);
  _Block_object_dispose(&v97, 8);
  v46 = snapshotCopy;
  lastObject = v57;
  messagesCopy = v56;
  entryView = v55;
  shelfPluginPayload = v54;
LABEL_19:

  return height;
}

void __241__CKChatController_SendAnimation___makeThrowBalloonsForSendAnimationWithType_inContainerView_forSendingMessages_shouldUseQuickReplySourceRect_quickReplySourceRect_quickReplySnapshotView_audioMessageSourceRect_audioRecordingPillViewSnapshot___block_invoke(uint64_t a1, void *a2, uint64_t a3)
{
  v5 = *(a1 + 32);
  v6 = a2;
  if ([v5 firstIndex] == a3)
  {
    v7 = [*(a1 + 40) pluginView];
    v8 = v7 != 0;
  }

  else
  {
    v8 = 0;
  }

  BYTE1(v12) = [*(a1 + 32) lastIndex] != a3;
  LOBYTE(v12) = v8;
  v13 = [*(a1 + 48) _throwBalloonAttributesForSendAnimationWithType:*(a1 + 96) shouldUseQuickReplySourceRect:*(a1 + 136) quickReplySourceRect:*(a1 + 137) isRunningPhotosPlugin:v6 chatItem:*(a1 + 138) isPhotosExtensionMediaPayload:*(*(a1 + 72) + 8) + 24 pluginChatItemCounterInOut:*(a1 + 104) containerView:*(a1 + 112) isChatItemFromShelf:*(a1 + 120) isLastChatItem:*(a1 + 128) currentBalloonOriginInOut:*(a1 + 56) quickReplySnapshotView:{v12, *(*(a1 + 80) + 8) + 32, *(a1 + 64)}];

  v9 = *(*(a1 + 88) + 8);
  v10 = *(v9 + 40);
  if (v13)
  {
    [*(v9 + 40) addObject:v13];
  }

  else
  {
    v11 = [MEMORY[0x1E695DFB0] null];
    [v10 addObject:v11];
  }
}

- (id)previewItemsForMediaObject:(id)object currentItemIndex:(int64_t *)index containsRestoring:(BOOL *)restoring
{
  objectCopy = object;
  if (objectCopy)
  {
    v9 = objc_alloc_init(MEMORY[0x1E695DF70]);
    v35 = 0;
    v36 = &v35;
    v37 = 0x2020000000;
    v38 = 0x7FFFFFFFFFFFFFFFLL;
    v31 = 0;
    v32 = &v31;
    v33 = 0x2020000000;
    v34 = 0;
    aBlock[0] = MEMORY[0x1E69E9820];
    aBlock[1] = 3221225472;
    aBlock[2] = __93__CKChatController_QuickLook__previewItemsForMediaObject_currentItemIndex_containsRestoring___block_invoke;
    aBlock[3] = &unk_1E72F3128;
    v10 = v9;
    v27 = v10;
    v11 = objectCopy;
    v28 = v11;
    v29 = &v35;
    v30 = &v31;
    v12 = _Block_copy(aBlock);
    v13 = [(CKChatController *)self _chatItemForMediaObject:v11];
    objc_opt_class();
    if (objc_opt_isKindOfClass())
    {
      v14 = v13;
      layoutGroupIdentifier = [v14 layoutGroupIdentifier];
    }

    else
    {
      layoutGroupIdentifier = 0;
    }

    collectionViewController = [(CKCoreChatController *)self collectionViewController];
    chatItems = [collectionViewController chatItems];

    v23[0] = MEMORY[0x1E69E9820];
    v23[1] = 3221225472;
    v23[2] = __93__CKChatController_QuickLook__previewItemsForMediaObject_currentItemIndex_containsRestoring___block_invoke_2;
    v23[3] = &unk_1E72F3150;
    v19 = layoutGroupIdentifier;
    v24 = v19;
    v20 = v12;
    v25 = v20;
    [chatItems enumerateObjectsUsingBlock:v23];
    if (index)
    {
      *index = v36[3];
    }

    if (restoring)
    {
      *restoring = *(v32 + 24);
    }

    v21 = v25;
    v16 = v10;

    _Block_object_dispose(&v31, 8);
    _Block_object_dispose(&v35, 8);
  }

  else
  {
    v16 = 0;
  }

  return v16;
}

void __93__CKChatController_QuickLook__previewItemsForMediaObject_currentItemIndex_containsRestoring___block_invoke(uint64_t a1, void *a2)
{
  v10 = a2;
  v3 = [v10 shouldBeQuickLooked];
  v4 = v10;
  if (v3)
  {
    v5 = [v10 transfer];
    v6 = [v5 isRestoring];
    if ((v6 & 1) != 0 || [v5 isFileDataReady])
    {
      [*(a1 + 32) addObject:v10];
      v7 = [v10 transferGUID];
      v8 = [*(a1 + 40) transferGUID];
      v9 = [v7 isEqualToString:v8];

      if (v9)
      {
        *(*(*(a1 + 48) + 8) + 24) = [*(a1 + 32) count] - 1;
      }

      if (v6)
      {
        *(*(*(a1 + 56) + 8) + 24) = 1;
      }
    }

    v4 = v10;
  }
}

void __93__CKChatController_QuickLook__previewItemsForMediaObject_currentItemIndex_containsRestoring___block_invoke_2(uint64_t a1, void *a2)
{
  v18 = *MEMORY[0x1E69E9840];
  v3 = a2;
  if (([v3 itemIsReplyContextPreview] & 1) == 0)
  {
    objc_opt_class();
    if (objc_opt_isKindOfClass())
    {
      if (![*(a1 + 32) length] || (v4 = *(a1 + 32), objc_msgSend(v3, "layoutGroupIdentifier"), v5 = objc_claimAutoreleasedReturnValue(), LODWORD(v4) = objc_msgSend(v4, "isEqualToString:", v5), v5, v4))
      {
        v6 = [v3 mediaObject];
        (*(*(a1 + 40) + 16))();
LABEL_16:
      }
    }

    else
    {
      objc_opt_class();
      if (objc_opt_isKindOfClass())
      {
        if (![*(a1 + 32) length] || (v7 = *(a1 + 32), objc_msgSend(v3, "layoutGroupIdentifier"), v8 = objc_claimAutoreleasedReturnValue(), LODWORD(v7) = objc_msgSend(v7, "isEqualToString:", v8), v8, v7))
        {
          v6 = [v3 mediaObjects];
          v13 = 0u;
          v14 = 0u;
          v15 = 0u;
          v16 = 0u;
          v9 = [v6 countByEnumeratingWithState:&v13 objects:v17 count:16];
          if (v9)
          {
            v10 = v9;
            v11 = *v14;
            do
            {
              v12 = 0;
              do
              {
                if (*v14 != v11)
                {
                  objc_enumerationMutation(v6);
                }

                (*(*(a1 + 40) + 16))();
                ++v12;
              }

              while (v10 != v12);
              v10 = [v6 countByEnumeratingWithState:&v13 objects:v17 count:16];
            }

            while (v10);
          }

          goto LABEL_16;
        }
      }
    }
  }
}

- (void)updateQLPreviewControllerIfVisible
{
  navigationController = [(CKChatController *)self navigationController];
  visibleViewController = [navigationController visibleViewController];

  objc_opt_class();
  if (objc_opt_isKindOfClass())
  {
    v5 = visibleViewController;
    currentPreviewItem = [v5 currentPreviewItem];
    objc_opt_class();
    if (objc_opt_isKindOfClass())
    {
      v12 = 0x7FFFFFFFFFFFFFFFLL;
      v11 = 0;
      v7 = [(CKChatController *)self previewItemsForMediaObject:currentPreviewItem currentItemIndex:&v12 containsRestoring:&v11];
      dataSource = [v5 dataSource];
      [dataSource setPreviewItems:v7];

      if (v11 == 1)
      {
        v9 = CKFrameworkBundle();
        v10 = [v9 localizedStringForKey:@"RESTORING" value:&stru_1F04268F8 table:@"ChatKit"];
        [v5 setLoadingTextForMissingFiles:v10];
      }

      else
      {
        [v5 setLoadingTextForMissingFiles:&stru_1F04268F8];
      }

      [v5 reloadData];
      [v5 setCurrentPreviewItemIndex:v12];
      [v5 refreshCurrentPreviewItem];
    }

    else
    {
      if (!IMOSLoggingEnabled())
      {
LABEL_11:

        goto LABEL_12;
      }

      v7 = OSLogHandleForIMFoundationCategory();
      if (os_log_type_enabled(v7, OS_LOG_TYPE_INFO))
      {
        *buf = 0;
        _os_log_impl(&dword_19020E000, v7, OS_LOG_TYPE_INFO, "currentPreviewItem could not be cast as CKMediaObject", buf, 2u);
      }
    }

    goto LABEL_11;
  }

LABEL_12:
}

- (void)updateQLPreviewControllerBarButtonItemsIfVisible
{
  previewController = [(CKChatController *)self previewController];
  [previewController updateBarButtonItems];
}

- (BOOL)_displayPreviewItemForMediaObject:(id)object
{
  v30 = *MEMORY[0x1E69E9840];
  objectCopy = object;
  v5 = +[CKUIBehavior sharedBehaviors];
  isSizeConstrained = [v5 isSizeConstrained];

  if (isSizeConstrained)
  {
    v7 = [(CKChatController *)self _displayMediaObjectFullscreen:objectCopy];
  }

  else
  {
    v27 = 0x7FFFFFFFFFFFFFFFLL;
    v26 = 0;
    v8 = [(CKChatController *)self previewItemsForMediaObject:objectCopy currentItemIndex:&v27 containsRestoring:&v26];
    v9 = [v8 count];
    v7 = v9 != 0;
    if (v9)
    {
      previewController = [(CKChatController *)self previewController];
      v11 = previewController == 0;

      if (v11 && !CKIsRunningInMacCatalyst())
      {
        v12 = objc_alloc_init(CKQLPreviewController);
        [(CKChatController *)self setPreviewController:v12];
      }

      previewController2 = [(CKChatController *)self previewController];
      [previewController2 setDelegate:self];
      v14 = objc_alloc_init(CKQLPreviewControllerDataSource);
      [(CKChatController *)self setQlPreviewDataSource:v14];

      qlPreviewDataSource = [(CKChatController *)self qlPreviewDataSource];
      [qlPreviewDataSource setPreviewItems:v8];

      qlPreviewDataSource2 = [(CKChatController *)self qlPreviewDataSource];
      [previewController2 setDataSource:qlPreviewDataSource2];

      [previewController2 reloadData];
      [previewController2 setCurrentPreviewItemIndex:v27];
      [previewController2 refreshCurrentPreviewItem];
      if (!CKIsRunningInMacCatalyst())
      {
        [previewController2 setModalPresentationStyle:0];
        if (v26 == 1)
        {
          v17 = CKFrameworkBundle();
          v18 = [v17 localizedStringForKey:@"RESTORING" value:&stru_1F04268F8 table:@"ChatKit"];
          [previewController2 setLoadingTextForMissingFiles:v18];
        }
      }

      entryView = [(CKChatController *)self entryView];
      contentView = [entryView contentView];
      -[CKChatController setEntryViewWasActiveOnPreview:](self, "setEntryViewWasActiveOnPreview:", [contentView isActive]);

      v25.receiver = self;
      v25.super_class = CKChatController;
      [(CKChatController *)&v25 becomeFirstResponder];
      if (CKIsRunningInMacCatalyst())
      {
        [previewController2 presentPreview];
      }

      else
      {
        if (IMOSLoggingEnabled())
        {
          v21 = OSLogHandleForIMFoundationCategory();
          if (os_log_type_enabled(v21, OS_LOG_TYPE_INFO))
          {
            *buf = 134217984;
            v29 = objectCopy;
            _os_log_impl(&dword_19020E000, v21, OS_LOG_TYPE_INFO, "will display preview for media object: %p", buf, 0xCu);
          }
        }

        [(CKChatController *)self setIsShowingPreview:1];
        collectionViewController = [(CKCoreChatController *)self collectionViewController];
        collectionView = [collectionViewController collectionView];
        [collectionView beginHoldingContentOffsetUpdatesForReason:@"ChatControllerQuickLook"];

        [(CKChatController *)self presentViewController:previewController2 animated:1 completion:0];
      }
    }
  }

  return v7;
}

- (void)_showReaderForAggregateChatItem:(id)item balloonView:(id)view
{
  viewCopy = view;
  v6 = [CKReaderViewController readerViewControllerForChatItem:item];
  [v6 setDelegate:self];
  if (CKIsRunningInMacCatalyst())
  {
    [v6 setModalPresentationStyle:7];
    popoverPresentationController = [v6 popoverPresentationController];
    [popoverPresentationController setSourceView:viewCopy];

    [(CKChatController *)self presentViewController:v6 animated:1 completion:0];
  }

  else
  {
    [(CKChatController *)self showViewController:v6 sender:self];
    inputController = [(CKCoreChatController *)self inputController];
    [inputController dismissAppCardIfNecessary];
  }
}

- (BOOL)_canReloadEntryView
{
  entryView = [(CKChatController *)self entryView];
  window = [entryView window];
  v4 = window != 0;

  return v4;
}

- (void)readerViewControllerWillDismiss:(id)dismiss
{
  dismissCopy = dismiss;
  v9 = +[CKReaderViewController readerScrollPositionCache];
  v4 = MEMORY[0x1E696B098];
  visibleRange = [dismissCopy visibleRange];
  v7 = [v4 valueWithRange:{visibleRange, v6}];
  messageGUID = [dismissCopy messageGUID];

  [v9 setObject:v7 forKey:messageGUID];
}

- (void)_dismissPresentedViewController:(id)controller
{
  v4 = CKIsRunningInMacCatalyst();
  presentedViewController = [(CKChatController *)self presentedViewController];
  v6 = presentedViewController;
  if (v4)
  {
    [presentedViewController dismissPreview];
  }

  else
  {
    [presentedViewController dismissViewControllerAnimated:1 completion:0];
  }

  [(CKChatController *)self becomeFirstResponder];
}

- (void)showViewerForMediaObject:(id)object
{
  v33 = *MEMORY[0x1E69E9840];
  objectCopy = object;
  navigationController = [(CKChatController *)self navigationController];
  visibleViewController = [navigationController visibleViewController];

  objc_opt_class();
  isKindOfClass = objc_opt_isKindOfClass();
  v8 = [visibleViewController conformsToProtocol:&unk_1F06826C0];
  previewController = [(CKChatController *)self previewController];
  presentingViewController = [previewController presentingViewController];

  if (IMOSLoggingEnabled())
  {
    v11 = OSLogHandleForIMFoundationCategory();
    if (os_log_type_enabled(v11, OS_LOG_TYPE_INFO))
    {
      v12 = @"NO";
      if (isKindOfClass)
      {
        v13 = @"YES";
      }

      else
      {
        v13 = @"NO";
      }

      if (v8)
      {
        v14 = @"YES";
      }

      else
      {
        v14 = @"NO";
      }

      v27 = 138412802;
      v28 = v13;
      v29 = 2112;
      v30 = v14;
      if (presentingViewController)
      {
        v12 = @"YES";
      }

      v31 = 2112;
      v32 = v12;
      _os_log_impl(&dword_19020E000, v11, OS_LOG_TYPE_INFO, "isChatControllerOnTop={%@} isAppCardOnTop={%@} isPreviewControllerAlreadyPresented={%@}", &v27, 0x20u);
    }
  }

  if (((isKindOfClass | v8) & (presentingViewController == 0)) != 0)
  {
    entryView = [(CKChatController *)self entryView];
    contentView = [entryView contentView];
    -[CKChatController setEntryViewWasActiveOnPreview:](self, "setEntryViewWasActiveOnPreview:", [contentView isActive]);

    if (CKIsRunningInMacCatalyst())
    {
      if ([objectCopy shouldBeQuickLooked])
      {
LABEL_16:
        [(CKChatController *)self _displayPreviewItemForMediaObject:objectCopy];
      }
    }

    else
    {
      if ([objectCopy mediaType] != 5)
      {
        if ([objectCopy mediaType] == 4)
        {
          [(CKChatController *)self _showVCardViewerForMediaObject:objectCopy];
          goto LABEL_21;
        }

        if ([objectCopy mediaType] == 7)
        {
          [(CKChatController *)self _showPassbookCardViewForMediaObject:objectCopy];
          goto LABEL_21;
        }

        if ([objectCopy mediaType] == 9)
        {
          [(CKChatController *)self _showWalletOrderImportViewForMediaObject:objectCopy];
          goto LABEL_21;
        }

        if (![objectCopy shouldBeQuickLooked])
        {
          goto LABEL_21;
        }

        goto LABEL_16;
      }

      v24 = +[CKUIBehavior sharedBehaviors];
      opensLocationsInMapsApp = [v24 opensLocationsInMapsApp];

      if (opensLocationsInMapsApp)
      {
        mapItem = [objectCopy mapItem];
        [mapItem openInMapsWithLaunchOptions:0];
      }

      else
      {
        [(CKChatController *)self _showMapViewerForMediaObject:objectCopy];
      }
    }
  }

  else if (IMOSLoggingEnabled())
  {
    v17 = OSLogHandleForIMFoundationCategory();
    if (os_log_type_enabled(v17, OS_LOG_TYPE_INFO))
    {
      v18 = objc_opt_class();
      v19 = NSStringFromClass(v18);
      navigationController2 = [(CKChatController *)self navigationController];
      topViewController = [navigationController2 topViewController];
      v22 = objc_opt_class();
      v23 = NSStringFromClass(v22);
      v27 = 138412546;
      v28 = v19;
      v29 = 2112;
      v30 = v23;
      _os_log_impl(&dword_19020E000, v17, OS_LOG_TYPE_INFO, "Criteria not met to show mediaObject. Transcript/AppCard isn't visibleViewController. visibleVC={%@} topVC={%@}", &v27, 0x16u);
    }
  }

LABEL_21:
}

- (void)showAlternateViewerForMediaObject:(id)object
{
  objectCopy = object;
  if ([objectCopy mediaType] == 5)
  {
    v4 = +[CKUIBehavior sharedBehaviors];
    showsPlaceCardForBalloonViewTitleTap = [v4 showsPlaceCardForBalloonViewTitleTap];

    if (showsPlaceCardForBalloonViewTitleTap)
    {
      [(CKChatController *)self _showVCardViewerForMediaObject:objectCopy];
    }
  }
}

- (void)_showPassbookCardViewForMediaObject:(id)object
{
  objectCopy = object;
  if ([MEMORY[0x193AF5EC0](@"PKPassLibrary" @"PassKit")])
  {
    pass = [objectCopy pass];
    v6 = [CKPassKitHelper addPassesViewControllerForPass:pass];
    v7 = v6;
    if (v6)
    {
      [v6 performSelector:sel_setDelegate_ withObject:self];
      [(CKChatController *)self setTargetFirstResponder:[(CKChatController *)self entryViewWasActiveOnPreview]];
      v11.receiver = self;
      v11.super_class = CKChatController;
      [(CKChatController *)&v11 becomeFirstResponder];
      collectionViewController = [(CKCoreChatController *)self collectionViewController];
      collectionView = [collectionViewController collectionView];
      [collectionView beginHoldingContentOffsetUpdatesForReason:@"ChatControllerQuickLook"];

      navigationController = [(CKChatController *)self navigationController];
      [navigationController presentViewController:v7 animated:1 completion:0];
    }
  }
}

- (void)addPassesViewControllerDidFinish:(id)finish
{
  navigationController = [(CKChatController *)self navigationController];
  v5[0] = MEMORY[0x1E69E9820];
  v5[1] = 3221225472;
  v5[2] = __64__CKChatController_QuickLook__addPassesViewControllerDidFinish___block_invoke;
  v5[3] = &unk_1E72EBA18;
  v5[4] = self;
  [navigationController dismissViewControllerAnimated:1 completion:v5];
}

void __64__CKChatController_QuickLook__addPassesViewControllerDidFinish___block_invoke(uint64_t a1)
{
  v2 = [*(a1 + 32) entryViewWasActiveOnPreview];
  v3 = *(a1 + 32);
  if (v2)
  {
    [v3 setEntryViewWasActiveOnPreview:0];
    v3 = *(a1 + 32);
    v4 = 1;
  }

  else
  {
    v4 = 0;
  }

  [v3 setTargetFirstResponder:v4];
  [*(a1 + 32) becomeFirstResponder];
  v5 = [*(a1 + 32) firstResponder];
  [v5 reloadInputViews];

  v7 = [*(a1 + 32) collectionViewController];
  v6 = [v7 collectionView];
  [v6 endHoldingContentOffsetUpdatesForReason:@"ChatControllerQuickLook"];
}

- (void)_showWalletOrderImportViewForMediaObject:(id)object
{
  v50 = *MEMORY[0x1E69E9840];
  objectCopy = object;
  getFKOrderImportPreviewControllerProviderClass();
  v5 = objc_opt_class();
  if ((objc_opt_respondsToSelector() & 1) != 0 && [v5 canProvidePreviewControllerForMessages])
  {
    v43 = 0;
    v44 = &v43;
    v45 = 0x2050000000;
    v6 = getFKOrderMessagesPreviewMetadataClass_softClass;
    v46 = getFKOrderMessagesPreviewMetadataClass_softClass;
    if (!getFKOrderMessagesPreviewMetadataClass_softClass)
    {
      *buf = MEMORY[0x1E69E9820];
      *&buf[8] = 3221225472;
      *&buf[16] = __getFKOrderMessagesPreviewMetadataClass_block_invoke;
      v48 = &unk_1E72EB968;
      v49 = &v43;
      __getFKOrderMessagesPreviewMetadataClass_block_invoke(buf);
      v6 = v44[3];
    }

    v7 = v6;
    _Block_object_dispose(&v43, 8);
    v8 = objc_opt_class();
    if ((objc_opt_respondsToSelector() & 1) != 0 && ([objectCopy fileURL], v9 = objc_claimAutoreleasedReturnValue(), objc_msgSend(v8, "walletDeepLinkForExistingOrderAtURL:", v9), v10 = objc_claimAutoreleasedReturnValue(), v9, v10))
    {
      if (IMOSLoggingEnabled())
      {
        v11 = OSLogHandleForIMFoundationCategory();
        if (os_log_type_enabled(v11, OS_LOG_TYPE_INFO))
        {
          absoluteString = [v10 absoluteString];
          *buf = 138412290;
          *&buf[4] = absoluteString;
          _os_log_impl(&dword_19020E000, v11, OS_LOG_TYPE_INFO, "Order file is already tracked, viewing in Wallet with url: %@", buf, 0xCu);
        }
      }

      mEMORY[0x1E69DC668] = [MEMORY[0x1E69DC668] sharedApplication];
      [mEMORY[0x1E69DC668] openURL:v10];
    }

    else
    {
      FKOrderImportPreviewControllerProviderClass = getFKOrderImportPreviewControllerProviderClass();
      fileURL = [objectCopy fileURL];
      v41 = 0;
      v42[0] = MEMORY[0x1E69E9820];
      v42[1] = 3221225472;
      v42[2] = __72__CKChatController_QuickLook___showWalletOrderImportViewForMediaObject___block_invoke;
      v42[3] = &unk_1E72F3178;
      v42[4] = self;
      v16 = [FKOrderImportPreviewControllerProviderClass makeViewControllerWithOrderURL:fileURL completion:v42 error:&v41];
      v10 = v41;

      if (v10)
      {
        if (IMOSLoggingEnabled())
        {
          v17 = OSLogHandleForIMFoundationCategory();
          if (os_log_type_enabled(v17, OS_LOG_TYPE_INFO))
          {
            fileURL2 = [objectCopy fileURL];
            *buf = 138412546;
            *&buf[4] = fileURL2;
            *&buf[12] = 2112;
            *&buf[14] = v10;
            _os_log_impl(&dword_19020E000, v17, OS_LOG_TYPE_INFO, "Failed to create Add to Wallet VC for order at %@: %@", buf, 0x16u);
          }
        }

        if ([v10 code] == 1)
        {
          v19 = MEMORY[0x193AF5ED0]("PKCreateAlertControllerForWalletUninstalled", @"PassKitUI");
          _showWalletOrderImportViewForMediaObject__makeWalletUninstalledAlert = v19;
          if (v19)
          {
            v20 = v19(0);
            navigationController = [(CKChatController *)self navigationController];
            [navigationController presentViewController:v20 animated:1 completion:0];
          }

          else if (IMOSLoggingEnabled())
          {
            v38 = OSLogHandleForIMFoundationCategory();
            if (os_log_type_enabled(v38, OS_LOG_TYPE_INFO))
            {
              *buf = 0;
              _os_log_impl(&dword_19020E000, v38, OS_LOG_TYPE_INFO, "Unable to show Wallet Uninstalled alert because weak-link of PKCreateAlertControllerForWalletUninstalled() failed.", buf, 2u);
            }
          }
        }

        else
        {
          v27 = MEMORY[0x1E69DC650];
          v28 = CKFrameworkBundle();
          v29 = [v28 localizedStringForKey:@"WALLET_ORDER_INVALID_TITLE" value:&stru_1F04268F8 table:@"ChatKit"];
          v30 = CKFrameworkBundle();
          v31 = [v30 localizedStringForKey:@"WALLET_ORDER_INVALID_DESCRIPTION" value:&stru_1F04268F8 table:@"ChatKit"];
          v32 = [v27 alertControllerWithTitle:v29 message:v31 preferredStyle:1];

          v33 = MEMORY[0x1E69DC648];
          v34 = CKFrameworkBundle();
          v35 = [v34 localizedStringForKey:@"DISMISS" value:&stru_1F04268F8 table:@"ChatKit"];
          v36 = [v33 actionWithTitle:v35 style:0 handler:0];
          [v32 addAction:v36];

          navigationController2 = [(CKChatController *)self navigationController];
          [navigationController2 presentViewController:v32 animated:1 completion:0];
        }
      }

      else if (v16)
      {
        [(CKChatController *)self setWalletOrderImportViewController:v16];
        presentationController = [v16 presentationController];
        [presentationController setDelegate:self];

        collectionViewController = [(CKCoreChatController *)self collectionViewController];
        collectionView = [collectionViewController collectionView];
        [collectionView beginHoldingContentOffsetUpdatesForReason:@"ChatControllerQuickLook"];

        delegate = [(CKCoreChatController *)self delegate];
        [delegate updateSupportedInterfaceOrientations:2];

        v26 = dispatch_time(0, 100000000);
        v39[0] = MEMORY[0x1E69E9820];
        v39[1] = 3221225472;
        v39[2] = __72__CKChatController_QuickLook___showWalletOrderImportViewForMediaObject___block_invoke_324;
        v39[3] = &unk_1E72EB8D0;
        v39[4] = self;
        v40 = v16;
        dispatch_after(v26, MEMORY[0x1E69E96A0], v39);
      }
    }
  }
}

void __72__CKChatController_QuickLook___showWalletOrderImportViewForMediaObject___block_invoke(uint64_t a1, uint64_t a2, void *a3)
{
  v13 = *MEMORY[0x1E69E9840];
  v4 = a3;
  v5 = IMOSLoggingEnabled();
  if (v4)
  {
    if (v5)
    {
      v6 = OSLogHandleForIMFoundationCategory();
      if (os_log_type_enabled(v6, OS_LOG_TYPE_INFO))
      {
        *buf = 138412290;
        v12 = v4;
        _os_log_impl(&dword_19020E000, v6, OS_LOG_TYPE_INFO, "CKChatController_QuickLook failed to add order file to Wallet: %@", buf, 0xCu);
      }

LABEL_9:
    }
  }

  else if (v5)
  {
    v6 = OSLogHandleForIMFoundationCategory();
    if (os_log_type_enabled(v6, OS_LOG_TYPE_INFO))
    {
      *buf = 0;
      _os_log_impl(&dword_19020E000, v6, OS_LOG_TYPE_INFO, "Finished adding order file to Wallet", buf, 2u);
    }

    goto LABEL_9;
  }

  v8 = *(a1 + 32);
  v7 = (a1 + 32);
  [v8 _walletOrderImportControllerDismissed];
  v9 = [*v7 navigationController];
  v10[0] = MEMORY[0x1E69E9820];
  v10[1] = 3221225472;
  v10[2] = __72__CKChatController_QuickLook___showWalletOrderImportViewForMediaObject___block_invoke_307;
  v10[3] = &unk_1E72EBA18;
  v10[4] = *v7;
  [v9 dismissViewControllerAnimated:1 completion:v10];
}

void __72__CKChatController_QuickLook___showWalletOrderImportViewForMediaObject___block_invoke_307(uint64_t a1)
{
  v1 = [*(a1 + 32) delegate];
  [v1 stopForcingOrientation];
}

void __72__CKChatController_QuickLook___showWalletOrderImportViewForMediaObject___block_invoke_324(uint64_t a1)
{
  v2 = [*(a1 + 32) navigationController];
  [v2 presentViewController:*(a1 + 40) animated:1 completion:0];
}

- (void)_showMapViewerForMediaObject:(id)object
{
  v27 = *MEMORY[0x1E69E9840];
  objectCopy = object;
  if (_showMapViewerForMediaObject___pred_CLLocationCoordinate2DIsValidCoreLocation != -1)
  {
    [CKChatController(QuickLook) _showMapViewerForMediaObject:];
  }

  objc_opt_class();
  if (objc_opt_isKindOfClass())
  {
    v5 = objectCopy;
    if ((_showMapViewerForMediaObject___CLLocationCoordinate2DIsValid)([(__CFString *)v5 coordinate]))
    {
      v6 = MEMORY[0x193AF5EC0](@"MUPlaceViewController", @"MapsUI");
      if (v6)
      {
        v7 = [v6 alloc];
        mapItem = [(__CFString *)v5 mapItem];
        v9 = [v7 initWithMapItem:mapItem];

        v10 = +[CKUIBehavior sharedBehaviors];
        usesPopovers = [v10 usesPopovers];

        if (usesPopovers)
        {
          entryView = [(CKChatController *)self entryView];
          contentView = [entryView contentView];
          isActive = [contentView isActive];

          [(CKChatController *)self setTargetFirstResponder:isActive];
          v15 = [objc_alloc(MEMORY[0x1E69DC708]) initWithBarButtonSystemItem:0 target:self action:sel_dismissPresentedViewController_];
          navigationItem = [v9 navigationItem];
          [navigationItem setLeftBarButtonItem:v15];

          v17 = [objc_alloc(MEMORY[0x1E69DCCD8]) initWithRootViewController:v9];
          navigationBar = [v17 navigationBar];
          v19 = +[CKUIBehavior sharedBehaviors];
          theme = [v19 theme];
          [navigationBar setBarStyle:{objc_msgSend(theme, "navBarStyle")}];

          [v17 setModalPresentationStyle:3];
          [(CKChatController *)self presentViewController:v17 animated:1 completion:0];
        }

        else
        {
          [(CKChatController *)self showViewController:v9 sender:self];
        }
      }

      else if (IMOSLoggingEnabled())
      {
        v22 = OSLogHandleForIMFoundationCategory();
        if (os_log_type_enabled(v22, OS_LOG_TYPE_INFO))
        {
          v23 = 138412546;
          v24 = @"MUPlaceViewController";
          v25 = 2112;
          v26 = @"MapsUI";
          _os_log_impl(&dword_19020E000, v22, OS_LOG_TYPE_INFO, "Failed weak linking %@ from %@.", &v23, 0x16u);
        }
      }
    }

    else
    {
      if (IMOSLoggingEnabled())
      {
        v21 = OSLogHandleForIMFoundationCategory();
        if (os_log_type_enabled(v21, OS_LOG_TYPE_INFO))
        {
          v23 = 138412290;
          v24 = v5;
          _os_log_impl(&dword_19020E000, v21, OS_LOG_TYPE_INFO, "The location for this media object is invalid. [%@]", &v23, 0xCu);
        }
      }

      [(CKChatController *)self _showVCardViewerForMediaObject:v5];
    }
  }
}

void *__60__CKChatController_QuickLook___showMapViewerForMediaObject___block_invoke()
{
  result = MEMORY[0x193AF5ED0]("CLLocationCoordinate2DIsValid", @"CoreLocation");
  _showMapViewerForMediaObject___CLLocationCoordinate2DIsValid = result;
  return result;
}

- (void)_showVCardViewerForMediaObject:(id)object
{
  v21 = *MEMORY[0x1E69E9840];
  objectCopy = object;
  data = [objectCopy data];
  if (!data)
  {
    data = objc_alloc_init(MEMORY[0x1E695DEF0]);
  }

  v17 = 0;
  v6 = [MEMORY[0x1E695CE30] contactsWithData:data error:&v17];
  v7 = v17;
  if (!v6 || ![v6 count])
  {
    if (IMOSLoggingEnabled())
    {
      v8 = OSLogHandleForIMFoundationCategory();
      if (os_log_type_enabled(v8, OS_LOG_TYPE_INFO))
      {
        *buf = 138412290;
        v20 = v7;
        _os_log_impl(&dword_19020E000, v8, OS_LOG_TYPE_INFO, "Couldn't get contacts out of vcard data: %@", buf, 0xCu);
      }
    }

    v9 = objc_alloc_init(MEMORY[0x1E695CF18]);
    v18 = v9;
    v10 = [MEMORY[0x1E695DEC8] arrayWithObjects:&v18 count:1];

    v6 = v10;
  }

  v11 = [objc_alloc(MEMORY[0x1E695D1D8]) initWithContacts:v6 contactStore:0];
  v12 = objc_alloc_init(MEMORY[0x1E69DCCC8]);
  [v12 configureWithTransparentBackground];
  viewController = [v11 viewController];
  navigationItem = [viewController navigationItem];
  [navigationItem setStandardAppearance:v12];

  inputController = [(CKCoreChatController *)self inputController];
  [inputController dismissAppCardIfNecessary];

  viewController2 = [v11 viewController];
  [(CKChatController *)self showViewController:viewController2 sender:self];
}

- (void)_showVCalViewerForMediaObject:(id)object
{
  objectCopy = object;
  v4 = +[CKUIBehavior sharedBehaviors];
  if ([v4 showsVCalViewer] && EKEventStoreClass())
  {
    v5 = EKICSPreviewControllerClass();

    if (!v5)
    {
      goto LABEL_6;
    }

    v4 = objc_alloc_init(EKEventStoreClass());
    v6 = objc_alloc(EKICSPreviewControllerClass());
    data = [objectCopy data];
    v8 = [v6 initWithData:data eventStore:v4 options:2147483649];

    viewController = [v8 viewController];
    [(CKChatController *)self showViewController:viewController sender:self];
  }

LABEL_6:
}

- (void)restoreEntryViewAfterPreview
{
  if (IMOSLoggingEnabled())
  {
    v3 = OSLogHandleForIMFoundationCategory();
    if (os_log_type_enabled(v3, OS_LOG_TYPE_INFO))
    {
      *buf = 0;
      _os_log_impl(&dword_19020E000, v3, OS_LOG_TYPE_INFO, "Calling restoreEntryViewAfterPreview", buf, 2u);
    }
  }

  if ([(CKChatController *)self isShowingPreview])
  {
    [(CKChatController *)self setIsShowingPreview:0];
    if (IMOSLoggingEnabled())
    {
      v4 = OSLogHandleForIMFoundationCategory();
      if (os_log_type_enabled(v4, OS_LOG_TYPE_INFO))
      {
        *v6 = 0;
        _os_log_impl(&dword_19020E000, v4, OS_LOG_TYPE_INFO, "restoreEntryViewAfterPreview: Setting showing preview to NO", v6, 2u);
      }
    }

    if ([(CKChatController *)self entryViewWasActiveOnPreview])
    {
      [(CKChatController *)self setEntryViewWasActiveOnPreview:0];
      v5 = 1;
    }

    else
    {
      v5 = 0;
    }

    [(CKChatController *)self setTargetFirstResponder:v5];
    [(CKChatController *)self addOrRemoveEntryViewIfNeeded];
    [(CKChatController *)self becomeFirstResponder];
  }
}

- (BOOL)previewController:(id)controller shouldDetectMachineReadableCodeForPreviewItem:(id)item
{
  v4 = [(CKCoreChatController *)self chat:controller];
  v5 = [v4 isFiltered] == 0;

  return v5;
}

- (id)excludedActivityTypesForPreviewController:(id)controller
{
  v9[1] = *MEMORY[0x1E69E9840];
  controllerCopy = controller;
  currentPreviewItem = [controllerCopy currentPreviewItem];
  objc_opt_class();
  if ((objc_opt_isKindOfClass() & 1) != 0 && ([currentPreviewItem mediaType] & 0xFFFFFFFE) == 2)
  {
    v9[0] = *MEMORY[0x1E69CDAF8];
    v5 = [MEMORY[0x1E695DEC8] arrayWithObjects:v9 count:1];
    if (IMOSLoggingEnabled())
    {
      v6 = OSLogHandleForIMFoundationCategory();
      if (os_log_type_enabled(v6, OS_LOG_TYPE_INFO))
      {
        *v8 = 0;
        _os_log_impl(&dword_19020E000, v6, OS_LOG_TYPE_INFO, "Will exclude system UIActivityTypeSaveToCameraRoll from ShareSheet.", v8, 2u);
      }
    }
  }

  else
  {
    v5 = 0;
  }

  return v5;
}

- (id)additionalActivitiesTypesForPreviewController:(id)controller
{
  v14[1] = *MEMORY[0x1E69E9840];
  controllerCopy = controller;
  currentPreviewItem = [controllerCopy currentPreviewItem];
  objc_opt_class();
  if (objc_opt_isKindOfClass())
  {
    v5 = currentPreviewItem;
    if (([v5 mediaType] & 0xFFFFFFFE) == 2)
    {
      v6 = [[CKSaveToPhotosActivity alloc] initWithMediaObject:v5 presenterViewController:controllerCopy];
      v14[0] = v6;
      v7 = [MEMORY[0x1E695DEC8] arrayWithObjects:v14 count:1];
    }

    else
    {
      v7 = 0;
    }
  }

  else
  {
    v7 = 0;
  }

  if (IMOSLoggingEnabled())
  {
    v8 = OSLogHandleForIMFoundationCategory();
    if (os_log_type_enabled(v8, OS_LOG_TYPE_INFO))
    {
      v9 = [v7 count];
      v10 = &stru_1F04268F8;
      if (!v9)
      {
        v10 = @" NOT";
      }

      v12 = 138412290;
      v13 = v10;
      _os_log_impl(&dword_19020E000, v8, OS_LOG_TYPE_INFO, "Will%@ present additional activities on ShareSheet.", &v12, 0xCu);
    }
  }

  return v7;
}

- (void)previewControllerWillDismiss:(id)dismiss
{
  dismissCopy = dismiss;
  v5 = +[CKUIBehavior sharedBehaviors];
  presentsQuickLookController = [v5 presentsQuickLookController];

  if (presentsQuickLookController)
  {
    collectionViewController = [(CKCoreChatController *)self collectionViewController];
    collectionView = [collectionViewController collectionView];
    chatItems = [collectionViewController chatItems];
    currentPreviewItem = [dismissCopy currentPreviewItem];
    v11 = [chatItems __ck_indexOfMediaObject:currentPreviewItem];

    if (v11 != 0x7FFFFFFFFFFFFFFFLL)
    {
      v12 = [MEMORY[0x1E696AC88] indexPathForRow:v11 inSection:0];
      v13 = [collectionView cellForItemAtIndexPath:v12];
      if (!v13)
      {
        [collectionView beginDisablingTranscriptDynamicsForReason:6];
        collectionView2 = [(CKChatController *)self collectionView];
        v15[0] = MEMORY[0x1E69E9820];
        v15[1] = 3221225472;
        v15[2] = __60__CKChatController_QuickLook__previewControllerWillDismiss___block_invoke;
        v15[3] = &unk_1E72EB8D0;
        v16 = collectionView;
        v17 = v12;
        [collectionView2 performContentOffsetUpdateTemporarilyOverridingHoldStatus:v15];
      }
    }
  }
}

void __60__CKChatController_QuickLook__previewControllerWillDismiss___block_invoke(uint64_t a1)
{
  [MEMORY[0x1E6979518] begin];
  v2 = MEMORY[0x1E6979518];
  v3[0] = MEMORY[0x1E69E9820];
  v3[1] = 3221225472;
  v3[2] = __60__CKChatController_QuickLook__previewControllerWillDismiss___block_invoke_2;
  v3[3] = &unk_1E72EBA18;
  v4 = *(a1 + 32);
  [v2 setCompletionBlock:v3];
  [*(a1 + 32) scrollToItemAtIndexPath:*(a1 + 40) atScrollPosition:2 animated:0];
  [MEMORY[0x1E6979518] commit];
}

- (void)previewControllerDidDismiss:(id)dismiss
{
  v8 = *MEMORY[0x1E69E9840];
  dismissCopy = dismiss;
  if (IMOSLoggingEnabled())
  {
    v5 = OSLogHandleForIMFoundationCategory();
    if (os_log_type_enabled(v5, OS_LOG_TYPE_INFO))
    {
      v6 = 136315138;
      v7 = "[CKChatController(QuickLook) previewControllerDidDismiss:]";
      _os_log_impl(&dword_19020E000, v5, OS_LOG_TYPE_INFO, "Dismissing %s", &v6, 0xCu);
    }
  }

  [(CKChatController *)self setTargetFirstResponder:0];
  [(CKChatController *)self setPreviewController:0];
  [(CKChatController *)self restoreEntryViewAfterPreview];
}

- (BOOL)previewController:(id)controller canShareItem:(id)item
{
  itemCopy = item;
  if (objc_opt_respondsToSelector())
  {
    canShareItem = [itemCopy canShareItem];
  }

  else
  {
    canShareItem = 1;
  }

  return canShareItem;
}

- (void)previewController:(id)controller willTransitionToState:(int64_t)state
{
  v6 = +[CKUIBehavior sharedBehaviors];
  presentsQuickLookController = [v6 presentsQuickLookController];

  if (state == 3 && presentsQuickLookController)
  {
    collectionViewController = [(CKCoreChatController *)self collectionViewController];
    collectionView = [collectionViewController collectionView];
    window = [collectionView window];
    [window layoutIfNeeded];
  }
}

- (void)previewController:(id)controller didTransitionToState:(int64_t)state
{
  if (state == 3)
  {
    currentPreviewItem = [controller currentPreviewItem];
    objc_opt_class();
    if (objc_opt_isKindOfClass())
    {
      collectionViewController = [(CKCoreChatController *)self collectionViewController];
      chatItems = [collectionViewController chatItems];
      v8 = [chatItems __ck_indexOfMediaObject:currentPreviewItem];

      if (v8 != 0x7FFFFFFFFFFFFFFFLL)
      {
        v9 = [MEMORY[0x1E696AC88] indexPathForRow:v8 inSection:0];
        collectionViewController2 = [(CKCoreChatController *)self collectionViewController];
        collectionView = [collectionViewController2 collectionView];

        v12 = [collectionView cellForItemAtIndexPath:v9];
        if (v12)
        {
          v13 = [collectionView cellForItemAtIndexPath:v9];
          balloonView = [v13 balloonView];
          v15 = +[CKUIBehavior sharedBehaviors];
          [balloonView setCanUseOpaqueMask:{objc_msgSend(v15, "transcriptCanUseOpaqueMask")}];

          objc_opt_class();
          if (objc_opt_isKindOfClass())
          {
            [balloonView removeTransitionView];
          }
        }
      }
    }

    collectionViewController3 = [(CKCoreChatController *)self collectionViewController];
    collectionView2 = [collectionViewController3 collectionView];
    [collectionView2 endHoldingContentOffsetUpdatesForReason:@"ChatControllerQuickLook"];
  }
}

- (CGRect)previewController:(id)controller frameForPreviewItem:(id)item inSourceView:(id *)view
{
  v5 = 0.0;
  v6 = 0.0;
  v7 = 1.0;
  v8 = 1.0;
  result.size.height = v8;
  result.size.width = v7;
  result.origin.y = v6;
  result.origin.x = v5;
  return result;
}

- (id)previewController:(id)controller transitionViewForPreviewItem:(id)item uncroppedSourceFrame:(CGRect *)frame
{
  v64 = *MEMORY[0x1E69E9840];
  controllerCopy = controller;
  itemCopy = item;
  if (IMOSLoggingEnabled())
  {
    v10 = OSLogHandleForIMFoundationCategory();
    if (os_log_type_enabled(v10, OS_LOG_TYPE_INFO))
    {
      v11 = objc_opt_class();
      v12 = NSStringFromClass(v11);
      *buf = 138412546;
      *&buf[4] = v12;
      *&buf[12] = 2048;
      *&buf[14] = itemCopy;
      _os_log_impl(&dword_19020E000, v10, OS_LOG_TYPE_INFO, "QuickLook did request preview view for transition to item <%@: %p>.", buf, 0x16u);
    }
  }

  objc_opt_class();
  if ((objc_opt_isKindOfClass() & 1) == 0)
  {
    goto LABEL_16;
  }

  if (IMOSLoggingEnabled())
  {
    v13 = OSLogHandleForIMFoundationCategory();
    if (os_log_type_enabled(v13, OS_LOG_TYPE_INFO))
    {
      *buf = 0;
      _os_log_impl(&dword_19020E000, v13, OS_LOG_TYPE_INFO, "> Item is found to be a CKMediaObject.", buf, 2u);
    }
  }

  collectionViewController = [(CKCoreChatController *)self collectionViewController];
  collectionView = [collectionViewController collectionView];
  chatItems = [collectionViewController chatItems];
  v17 = [chatItems __ck_indexOfMediaObject:itemCopy];

  if (IMOSLoggingEnabled())
  {
    v18 = OSLogHandleForIMFoundationCategory();
    if (os_log_type_enabled(v18, OS_LOG_TYPE_INFO))
    {
      *buf = 134217984;
      *&buf[4] = v17;
      _os_log_impl(&dword_19020E000, v18, OS_LOG_TYPE_INFO, "> Media Object is found to be at row {%ld) in the transcript.", buf, 0xCu);
    }
  }

  if (v17 != 0x7FFFFFFFFFFFFFFFLL)
  {
    v58 = [MEMORY[0x1E696AC88] indexPathForRow:v17 inSection:0];
    v21 = [collectionView cellForItemAtIndexPath:v58];
    objc_opt_class();
    if ((objc_opt_isKindOfClass() & 1) == 0)
    {
      v22 = IMLogHandleForCategory();
      if (os_log_type_enabled(v22, OS_LOG_TYPE_ERROR))
      {
        [CKChatController(QuickLook) previewController:v21 transitionViewForPreviewItem:v58 uncroppedSourceFrame:v22];
      }

      uncroppedSourceView3 = 0;
      goto LABEL_52;
    }

    v22 = v21;
    balloonView = [v22 balloonView];
    [balloonView setHidden:0];
    [balloonView setCanUseOpaqueMask:0];
    [balloonView prepareForDisplayIfNeeded];
    [v22 layoutIfNeeded];
    objc_opt_class();
    if (objc_opt_isKindOfClass())
    {
      v24 = balloonView;
      [v24 uncroppedSourceFrame];
      frame->origin.x = v25;
      frame->origin.y = v26;
      frame->size.width = v27;
      frame->size.height = v28;
      if (IMOSLoggingEnabled())
      {
        v29 = OSLogHandleForIMFoundationCategory();
        if (os_log_type_enabled(v29, OS_LOG_TYPE_INFO))
        {
          log = v29;
          uncroppedSourceView = [v24 uncroppedSourceView];
          v30 = objc_opt_class();
          v31 = NSStringFromClass(v30);
          uncroppedSourceView2 = [v24 uncroppedSourceView];
          *buf = 138412546;
          v55 = v31;
          *&buf[4] = v31;
          *&buf[12] = 2048;
          *&buf[14] = uncroppedSourceView2;
          _os_log_impl(&dword_19020E000, log, OS_LOG_TYPE_INFO, "> For a CKAttachmentBalloonView, we are returning <%@: %p>.", buf, 0x16u);

          v29 = log;
        }
      }

      uncroppedSourceView3 = [v24 uncroppedSourceView];

      goto LABEL_51;
    }

    objc_opt_class();
    if ((objc_opt_isKindOfClass() & 1) == 0)
    {
      objc_opt_class();
      if (objc_opt_isKindOfClass())
      {
        v35 = *(MEMORY[0x1E695F058] + 16);
        *buf = *MEMORY[0x1E695F058];
        *&buf[16] = v35;
        uncroppedSourceView3 = [balloonView transitionViewForCurrentItem:itemCopy sourceFrame:buf];
        v36 = *&buf[16];
        frame->origin = *buf;
        frame->size = v36;
        if (IMOSLoggingEnabled())
        {
          v37 = OSLogHandleForIMFoundationCategory();
          if (os_log_type_enabled(v37, OS_LOG_TYPE_INFO))
          {
            v38 = objc_opt_class();
            v39 = NSStringFromClass(v38);
            *v59 = 138412546;
            v60 = v39;
            v61 = 2048;
            v62 = uncroppedSourceView3;
            _os_log_impl(&dword_19020E000, v37, OS_LOG_TYPE_INFO, "> For a CKPhotoStackBalloonView, we are returning <%@: %p>.", v59, 0x16u);
          }
        }

        goto LABEL_51;
      }

      if (!IMOSLoggingEnabled())
      {
        goto LABEL_50;
      }

      v49 = OSLogHandleForIMFoundationCategory();
      if (os_log_type_enabled(v49, OS_LOG_TYPE_INFO))
      {
        v52 = objc_opt_class();
        v53 = NSStringFromClass(v52);
        *buf = 138412546;
        *&buf[4] = v53;
        *&buf[12] = 2048;
        *&buf[14] = balloonView;
        _os_log_impl(&dword_19020E000, v49, OS_LOG_TYPE_INFO, "> For all other balloonView types, we are returning <%@: %p>.", buf, 0x16u);
      }

      goto LABEL_49;
    }

    objc_opt_class();
    if (objc_opt_isKindOfClass())
    {
      [itemCopy originalSize];
    }

    else
    {
      objc_opt_class();
      if ((objc_opt_isKindOfClass() & 1) == 0)
      {
LABEL_42:
        if (!IMOSLoggingEnabled())
        {
LABEL_50:
          uncroppedSourceView3 = balloonView;
LABEL_51:

LABEL_52:
          goto LABEL_53;
        }

        v49 = OSLogHandleForIMFoundationCategory();
        if (os_log_type_enabled(v49, OS_LOG_TYPE_INFO))
        {
          v50 = objc_opt_class();
          v51 = NSStringFromClass(v50);
          *buf = 138412546;
          *&buf[4] = v51;
          *&buf[12] = 2048;
          *&buf[14] = balloonView;
          _os_log_impl(&dword_19020E000, v49, OS_LOG_TYPE_INFO, "> For a CKImageBalloonView, we are returning <%@: %p>.", buf, 0x16u);
        }

LABEL_49:

        goto LABEL_50;
      }

      [itemCopy pxSize];
    }

    v40 = v33;
    v41 = v34;
    [balloonView bounds];
    frame->origin.x = AdaptSizeToRect(v42, v43, v44, v45, v40, v41);
    frame->origin.y = v46;
    frame->size.width = v47;
    frame->size.height = v48;
    goto LABEL_42;
  }

LABEL_16:
  if (IMOSLoggingEnabled())
  {
    v19 = OSLogHandleForIMFoundationCategory();
    if (os_log_type_enabled(v19, OS_LOG_TYPE_INFO))
    {
      *buf = 0;
    }
  }

  uncroppedSourceView3 = 0;
LABEL_53:

  return uncroppedSourceView3;
}

- (id)_previewingViewControllerForHitView:(id)view indexPath:(id)path
{
  v58 = *MEMORY[0x1E69E9840];
  viewCopy = view;
  pathCopy = path;
  collectionViewController = [(CKCoreChatController *)self collectionViewController];
  v9 = [collectionViewController balloonViewAtIndexPath:pathCopy];

  objc_opt_class();
  if ((objc_opt_isKindOfClass() & 1) == 0)
  {
    objc_opt_class();
    if ((objc_opt_isKindOfClass() & 1) == 0)
    {
      objc_opt_class();
      if ((objc_opt_isKindOfClass() & 1) == 0)
      {
        goto LABEL_50;
      }

      v35 = +[CKUIBehavior sharedBehaviors];
      disableTranscriptClickyOrbContextMenu = [v35 disableTranscriptClickyOrbContextMenu];

      if (disableTranscriptClickyOrbContextMenu)
      {
        goto LABEL_50;
      }
    }
  }

  collectionViewController2 = [(CKCoreChatController *)self collectionViewController];
  chatItems = [collectionViewController2 chatItems];

  if (pathCopy)
  {
    if (![pathCopy section])
    {
      item = [pathCopy item];
      if (item < [chatItems count])
      {
        v52 = [chatItems objectAtIndex:{objc_msgSend(pathCopy, "item")}];
        objc_opt_class();
        v13 = v52;
        if (objc_opt_isKindOfClass())
        {
          mediaObject = [v52 mediaObject];
          dataSource = mediaObject;
          if ([mediaObject shouldBeQuickLooked])
          {
            v53 = 0;
            v16 = [(CKChatController *)self previewItemsForMediaObject:mediaObject currentItemIndex:&v53 containsRestoring:0];
            previewController = [(CKChatController *)self previewController];
            v18 = previewController == 0;

            if (v18)
            {
              v19 = objc_alloc_init(CKQLPreviewController);
              [(CKChatController *)self setPreviewController:v19];

              previewController2 = [(CKChatController *)self previewController];
              [previewController2 setDelegate:self];
            }

            qlPreviewDataSource = [(CKChatController *)self qlPreviewDataSource];
            previewItems = [qlPreviewDataSource previewItems];
            v23 = [v16 isEqualToArray:previewItems];

            if ((v23 & 1) == 0)
            {
              v24 = objc_alloc_init(CKQLPreviewControllerDataSource);
              [(CKChatController *)self setQlPreviewDataSource:v24];

              qlPreviewDataSource2 = [(CKChatController *)self qlPreviewDataSource];
              [qlPreviewDataSource2 setPreviewItems:v16];
            }

            previewController3 = [(CKChatController *)self previewController];
            qlPreviewDataSource3 = [(CKChatController *)self qlPreviewDataSource];
            [previewController3 setDataSource:qlPreviewDataSource3];

            previewController4 = [(CKChatController *)self previewController];
            [previewController4 setCurrentPreviewItemIndex:v53];

            previewController5 = [(CKChatController *)self previewController];
            [previewController5 refreshCurrentPreviewItem];

            objc_opt_class();
            if ((objc_opt_isKindOfClass() & 1) != 0 && [viewCopy invisibleInkEffectEnabled])
            {
              invisibleInkEffectController = [viewCopy invisibleInkEffectController];
              [(CKChatController *)self setPreviewInvisibleInkEffectController:invisibleInkEffectController];
              if (([invisibleInkEffectController isSuspended] & 1) == 0)
              {
                v31 = CKBalloonViewForClass([v52 balloonViewClass]);
                [v31 configureForMessagePart:v52];
                [v31 setInvisibleInkEffectEnabled:0];
                [v31 setCanUseOpaqueMask:0];
                [v31 prepareForDisplayIfNeeded];
                [(CKChatController *)self setPreviewRevealView:v31];
              }
            }

            if (IMOSLoggingEnabled())
            {
              v32 = OSLogHandleForIMFoundationCategory();
              if (os_log_type_enabled(v32, OS_LOG_TYPE_INFO))
              {
                previewController6 = [(CKChatController *)self previewController];
                *buf = 138412290;
                v55 = previewController6;
                _os_log_impl(&dword_19020E000, v32, OS_LOG_TYPE_INFO, "clicky orb: providing previewController: %@", buf, 0xCu);
              }
            }

            previewController7 = [(CKChatController *)self previewController];

            goto LABEL_22;
          }

          objc_opt_class();
          if (objc_opt_isKindOfClass())
          {
            if (_previewingViewControllerForHitView_indexPath___pred_CLLocationCoordinate2DIsValidCoreLocation != -1)
            {
              [CKChatController(QuickLook) _previewingViewControllerForHitView:indexPath:];
              dataSource = mediaObject;
            }

            if ((_previewingViewControllerForHitView_indexPath___CLLocationCoordinate2DIsValid)([dataSource coordinate]))
            {
              v44 = MEMORY[0x193AF5EC0](@"MUPlaceViewController", @"MapsUI");
              if (v44)
              {
                v45 = [v44 alloc];
                mapItem = [dataSource mapItem];
                previewController7 = [v45 initWithMapItem:mapItem];

                title = [mediaObject title];
                [(__CFString *)previewController7 setTitle:title];

                if (IMOSLoggingEnabled())
                {
                  v48 = OSLogHandleForIMFoundationCategory();
                  if (os_log_type_enabled(v48, OS_LOG_TYPE_INFO))
                  {
                    *buf = 138412290;
                    v55 = previewController7;
                    _os_log_impl(&dword_19020E000, v48, OS_LOG_TYPE_INFO, "clicky orb: providing placeViewController: %@", buf, 0xCu);
                  }
                }
              }

              else
              {
                if (!IMOSLoggingEnabled())
                {
                  previewController7 = 0;
                  goto LABEL_37;
                }

                v51 = OSLogHandleForIMFoundationCategory();
                if (os_log_type_enabled(v51, OS_LOG_TYPE_INFO))
                {
                  *buf = 138412546;
                  v55 = @"MUPlaceViewController";
                  v56 = 2112;
                  v57 = @"MapsUI";
                  _os_log_impl(&dword_19020E000, v51, OS_LOG_TYPE_INFO, "Failed weak linking %@ from %@.", buf, 0x16u);
                }

                previewController7 = 0;
              }

LABEL_22:
              dataSource = mediaObject;
LABEL_37:

              goto LABEL_55;
            }
          }

          v13 = v52;
        }

        else
        {
          objc_opt_class();
          if (objc_opt_isKindOfClass())
          {
            dataSource = [v52 dataSource];
            v37 = v9;
            stackView = [v37 stackView];
            currentAssetReference = [stackView currentAssetReference];
            previewController7 = [(CKChatController *)self _previewViewControllerForAssetReference:currentAssetReference dataSource:dataSource previewDelegate:self previewMode:2];
            [(__CFString *)previewController7 setChatItem:v52];
            if (IMOSLoggingEnabled())
            {
              v40 = OSLogHandleForIMFoundationCategory();
              if (os_log_type_enabled(v40, OS_LOG_TYPE_INFO))
              {
                *buf = 138412290;
                v55 = previewController7;
                _os_log_impl(&dword_19020E000, v40, OS_LOG_TYPE_INFO, "clicky orb: providing previewViewController: %@", buf, 0xCu);
              }
            }

            goto LABEL_37;
          }

          objc_opt_class();
          if (objc_opt_isKindOfClass())
          {
            dataSource = v52;
            collectionViewController3 = [(CKCoreChatController *)self collectionViewController];
            transcriptIdentifier = [collectionViewController3 transcriptIdentifier];
            previewController7 = [dataSource contentViewControllerForContext:transcriptIdentifier];

            if (IMOSLoggingEnabled())
            {
              v43 = OSLogHandleForIMFoundationCategory();
              if (os_log_type_enabled(v43, OS_LOG_TYPE_INFO))
              {
                *buf = 138412290;
                v55 = previewController7;
                _os_log_impl(&dword_19020E000, v43, OS_LOG_TYPE_INFO, "clicky orb: providing peekVC: %@", buf, 0xCu);
              }
            }

            goto LABEL_37;
          }
        }
      }
    }
  }

LABEL_50:
  if (IMOSLoggingEnabled())
  {
    v49 = OSLogHandleForIMFoundationCategory();
    if (os_log_type_enabled(v49, OS_LOG_TYPE_INFO))
    {
      *buf = 0;
      _os_log_impl(&dword_19020E000, v49, OS_LOG_TYPE_INFO, "clicky orb: not providing any previewingViewController", buf, 2u);
    }
  }

  previewController7 = 0;
LABEL_55:

  return previewController7;
}

void *__77__CKChatController_QuickLook___previewingViewControllerForHitView_indexPath___block_invoke()
{
  result = MEMORY[0x193AF5ED0]("CLLocationCoordinate2DIsValid", @"CoreLocation");
  _previewingViewControllerForHitView_indexPath___CLLocationCoordinate2DIsValid = result;
  return result;
}

- (id)_previewingViewControllerForLocation:(CGPoint)location inSourceView:(id)view
{
  y = location.y;
  x = location.x;
  viewCopy = view;
  v8 = [viewCopy hitTest:0 withEvent:{x, y}];
  objc_opt_class();
  if (objc_opt_isKindOfClass())
  {
    superview = [v8 superview];

    v8 = superview;
  }

  collectionViewController = [(CKCoreChatController *)self collectionViewController];
  collectionView = [collectionViewController collectionView];

  [collectionView convertPoint:viewCopy fromView:{x, y}];
  v13 = v12;
  v15 = v14;

  v16 = [collectionView indexPathForItemAtPoint:{v13, v15}];
  v17 = [(CKChatController *)self _previewingViewControllerForHitView:v8 indexPath:v16];

  return v17;
}

- (id)previewingContext:(id)context viewControllerForLocation:(CGPoint)location
{
  y = location.y;
  x = location.x;
  contextCopy = context;
  v8 = +[CKUIBehavior sharedBehaviors];
  disableTranscriptOrb = [v8 disableTranscriptOrb];

  if (disableTranscriptOrb)
  {
    v10 = 0;
  }

  else
  {
    sourceView = [contextCopy sourceView];
    v10 = [(CKChatController *)self _previewingViewControllerForLocation:sourceView inSourceView:x, y];
  }

  return v10;
}

- (void)willPresentPreviewViewController:(id)controller forLocation:(CGPoint)location inSourceView:(id)view
{
  y = location.y;
  x = location.x;
  viewCopy = view;
  controllerCopy = controller;
  collectionViewController = [(CKCoreChatController *)self collectionViewController];
  collectionView = [collectionViewController collectionView];
  [collectionView convertPoint:viewCopy fromView:{x, y}];
  v14 = v13;
  v16 = v15;

  collectionViewController2 = [(CKCoreChatController *)self collectionViewController];
  collectionView2 = [collectionViewController2 collectionView];
  v19 = [collectionView2 indexPathForItemAtPoint:{v14, v16}];

  collectionViewController3 = [(CKCoreChatController *)self collectionViewController];
  collectionView3 = [collectionViewController3 collectionView];
  v22 = [collectionView3 cellForItemAtIndexPath:v19];

  v23 = v22;
  [(CKScrollViewController *)self beginHoldingScrollGeometryUpdatesForReason:@"PreviewController"];
  v24 = objc_opt_respondsToSelector();
  v25 = v23;
  if (v24)
  {
    balloonView = [v23 balloonView];
    [balloonView setCanUseOpaqueMask:0];
    [balloonView prepareForDisplayIfNeeded];

    v25 = balloonView;
  }

  v32 = v25;
  [(CKChatController *)self setPreviewSourceView:v25];
  presentationController = [controllerCopy presentationController];

  [presentationController setSourceView:v32];
  [v32 bounds];
  [presentationController setSourceRect:?];
  entryView = [(CKChatController *)self entryView];
  contentView = [entryView contentView];
  -[CKChatController setEntryViewWasActiveOnPreview:](self, "setEntryViewWasActiveOnPreview:", [contentView isActive]);

  collectionViewController4 = [(CKCoreChatController *)self collectionViewController];
  collectionView4 = [collectionViewController4 collectionView];
  [collectionView4 beginHoldingContentOffsetUpdatesForReason:@"ChatControllerQuickLook"];
}

- (void)previewingContext:(id)context commitViewController:(id)controller
{
  contextCopy = context;
  controllerCopy = controller;
  mEMORY[0x1E69A8168] = [MEMORY[0x1E69A8168] sharedInstance];
  [mEMORY[0x1E69A8168] trackEvent:*MEMORY[0x1E69A7588]];

  if (IMOSLoggingEnabled())
  {
    v9 = OSLogHandleForIMFoundationCategory();
    if (os_log_type_enabled(v9, OS_LOG_TYPE_INFO))
    {
      *buf = 0;
      _os_log_impl(&dword_19020E000, v9, OS_LOG_TYPE_INFO, "commitViewController: Setting showing preview to YES", buf, 2u);
    }
  }

  [(CKChatController *)self setIsShowingPreview:1];
  previewController = [(CKChatController *)self previewController];
  previewController2 = [(CKChatController *)self previewController];

  if (previewController2 != controllerCopy)
  {
    [(CKChatController *)self restoreEntryViewAfterPreview];
    previewSourceView = [(CKChatController *)self previewSourceView];
    objc_opt_class();
    if (objc_opt_isKindOfClass())
    {
      collectionViewController = [(CKCoreChatController *)self collectionViewController];
      previewSourceView2 = [(CKChatController *)self previewSourceView];
      v15 = [collectionViewController indexPathForBalloonView:previewSourceView2];

      if (v15)
      {
        objc_opt_class();
        if (objc_opt_isKindOfClass())
        {
          pluginViewController = [previewSourceView pluginViewController];
          if ([pluginViewController conformsToProtocol:&unk_1F06F8A18] && (objc_opt_respondsToSelector() & 1) != 0)
          {
            handlePresentationAction = [pluginViewController handlePresentationAction];

            if (handlePresentationAction)
            {
              goto LABEL_19;
            }

            goto LABEL_18;
          }
        }
      }
    }

LABEL_18:
    [(CKChatController *)self showViewController:controllerCopy sender:self];
LABEL_19:

    goto LABEL_20;
  }

  v18.receiver = self;
  v18.super_class = CKChatController;
  [(CKChatController *)&v18 becomeFirstResponder];
  if (CKIsRunningInMacCatalyst())
  {
    [previewController presentPreview];
  }

  else
  {
    [(CKChatController *)self presentViewController:previewController animated:1 completion:0];
  }

LABEL_20:
}

- (void)didDismissPreviewViewController:(id)controller committing:(BOOL)committing
{
  [(CKScrollViewController *)self endHoldingScrollGeometryUpdatesForReason:@"PreviewController"];
  previewSourceView = [(CKChatController *)self previewSourceView];
  objc_opt_class();
  if (objc_opt_isKindOfClass())
  {
    v6 = +[CKUIBehavior sharedBehaviors];
    [previewSourceView setCanUseOpaqueMask:{objc_msgSend(v6, "transcriptCanUseOpaqueMask")}];

    [previewSourceView prepareForDisplayIfNeeded];
  }

  [(CKChatController *)self setPreviewSourceView:0];
  previewInvisibleInkEffectController = [(CKChatController *)self previewInvisibleInkEffectController];
  [previewInvisibleInkEffectController returnBorrowedEffectView];

  previewInvisibleInkEffectController2 = [(CKChatController *)self previewInvisibleInkEffectController];
  [previewInvisibleInkEffectController2 setSuspended:0];

  [(CKChatController *)self setPreviewInvisibleInkEffectController:0];
  if (!committing)
  {
    collectionViewController = [(CKCoreChatController *)self collectionViewController];
    collectionView = [collectionViewController collectionView];
    [collectionView endHoldingContentOffsetUpdatesForReason:@"ChatControllerQuickLook"];
  }
}

- (id)previewActionsForPreviewController:(id)controller
{
  v4 = MEMORY[0x1E695DF70];
  controllerCopy = controller;
  array = [v4 array];
  currentPreviewItem = [controllerCopy currentPreviewItem];

  objc_opt_class();
  if (objc_opt_isKindOfClass())
  {
    v8 = currentPreviewItem;
    collectionViewController = [(CKCoreChatController *)self collectionViewController];
    chatItems = [collectionViewController chatItems];
    v11 = [chatItems __ck_indexOfMediaObject:v8];

    collectionViewController2 = [(CKCoreChatController *)self collectionViewController];
    chatItems2 = [collectionViewController2 chatItems];
    v14 = [chatItems2 objectAtIndex:v11];

    if ([v14 canCopy])
    {
      v15 = MEMORY[0x1E69DCE00];
      v16 = CKFrameworkBundle();
      v17 = [v16 localizedStringForKey:@"COPY" value:&stru_1F04268F8 table:@"ChatKit"];
      v36[0] = MEMORY[0x1E69E9820];
      v36[1] = 3221225472;
      v36[2] = __66__CKChatController_QuickLook__previewActionsForPreviewController___block_invoke;
      v36[3] = &unk_1E72F31A0;
      v37 = v8;
      v18 = [v15 actionWithTitle:v17 style:0 handler:v36];
      [array addObject:v18];
    }

    if ([v14 canExport])
    {
      v19 = MEMORY[0x1E69DCE00];
      v20 = CKFrameworkBundle();
      v21 = [v20 localizedStringForKey:@"BALLOON_EXPORT_CALLOUT" value:&stru_1F04268F8 table:@"ChatKit"];
      v34[0] = MEMORY[0x1E69E9820];
      v34[1] = 3221225472;
      v34[2] = __66__CKChatController_QuickLook__previewActionsForPreviewController___block_invoke_2;
      v34[3] = &unk_1E72F31A0;
      v35 = v8;
      v22 = [v19 actionWithTitle:v21 style:0 handler:v34];
      [array addObject:v22];
    }

    if ([v14 canForward])
    {
      v23 = MEMORY[0x1E69DCE00];
      v24 = CKFrameworkBundle();
      v25 = [v24 localizedStringForKey:@"FORWARD" value:&stru_1F04268F8 table:@"ChatKit"];
      v28 = MEMORY[0x1E69E9820];
      v29 = 3221225472;
      v30 = __66__CKChatController_QuickLook__previewActionsForPreviewController___block_invoke_515;
      v31 = &unk_1E72F31C8;
      selfCopy = self;
      v33 = v14;
      v26 = [v23 actionWithTitle:v25 style:0 handler:&v28];
      [array addObject:{v26, v28, v29, v30, v31, selfCopy}];
    }
  }

  return array;
}

void __66__CKChatController_QuickLook__previewActionsForPreviewController___block_invoke(uint64_t a1)
{
  v5[1] = *MEMORY[0x1E69E9840];
  v2 = [MEMORY[0x1E69DCD50] generalPasteboard];
  v3 = [*(a1 + 32) pasteboardItemProvider];
  v5[0] = v3;
  v4 = [MEMORY[0x1E695DEC8] arrayWithObjects:v5 count:1];
  [v2 setItemProviders:v4];
}

void __66__CKChatController_QuickLook__previewActionsForPreviewController___block_invoke_2(uint64_t a1)
{
  v2 = [[CKMediaObjectExportManager alloc] initWithMediaObject:*(a1 + 32)];
  [(CKMediaObjectExportManager *)v2 setMetricsSource:*MEMORY[0x1E69A7640]];
  v3[0] = MEMORY[0x1E69E9820];
  v3[1] = 3221225472;
  v3[2] = __66__CKChatController_QuickLook__previewActionsForPreviewController___block_invoke_3;
  v3[3] = &unk_1E72EC088;
  v4 = *(a1 + 32);
  [(CKMediaObjectExportManager *)v2 exportQueuedMediaObjectsWithCompletion:v3];
}

void __66__CKChatController_QuickLook__previewActionsForPreviewController___block_invoke_3(uint64_t a1, int a2, void *a3)
{
  v14 = *MEMORY[0x1E69E9840];
  v5 = a3;
  v6 = IMOSLoggingEnabled();
  if (a2)
  {
    if (v6)
    {
      v7 = OSLogHandleForIMFoundationCategory();
      if (os_log_type_enabled(v7, OS_LOG_TYPE_INFO))
      {
        v8 = *(a1 + 32);
        v10 = 138412290;
        v11 = v8;
        _os_log_impl(&dword_19020E000, v7, OS_LOG_TYPE_INFO, "Successfully quick saved media object: %@", &v10, 0xCu);
      }

LABEL_9:
    }
  }

  else if (v6)
  {
    v7 = OSLogHandleForIMFoundationCategory();
    if (os_log_type_enabled(v7, OS_LOG_TYPE_INFO))
    {
      v9 = *(a1 + 32);
      v10 = 138412546;
      v11 = v5;
      v12 = 2112;
      v13 = v9;
      _os_log_impl(&dword_19020E000, v7, OS_LOG_TYPE_INFO, "Error quick saving media object. error: %@, mediaObject: %@", &v10, 0x16u);
    }

    goto LABEL_9;
  }
}

void __66__CKChatController_QuickLook__previewActionsForPreviewController___block_invoke_515(uint64_t a1)
{
  v8[1] = *MEMORY[0x1E69E9840];
  [*(a1 + 32) setIsShowingPreview:0];
  v8[0] = *(a1 + 40);
  v2 = [MEMORY[0x1E695DEC8] arrayWithObjects:v8 count:1];
  v3 = [*(a1 + 32) entryView];
  v4 = [v3 shouldShowSubject];
  v5 = [*(a1 + 32) textInputContextIdentifier];
  v6 = [CKComposition compositionForMessageParts:v2 preserveSubject:v4 contextIdentifier:v5];

  v7 = [*(a1 + 32) delegate];
  [v7 chatController:*(a1 + 32) forwardComposition:v6];
}

- (BOOL)shouldShowReplyButtonForMediaObject:(id)object previewController:(id)controller
{
  controller = [(CKChatController *)self _chatItemForMediaObject:object, controller];
  if (controller)
  {
    conversation = [(CKCoreChatController *)self conversation];
    v7 = [conversation canReplyToChatItem:controller];
  }

  else
  {
    v7 = 0;
  }

  return v7;
}

- (void)replyButtonTappedForMediaObject:(id)object previewController:(id)controller
{
  controllerCopy = controller;
  v6 = [(CKChatController *)self _chatItemForMediaObject:object];
  if (v6)
  {
    [(CKChatController *)self showModalInlineReplyControllerForChatItem:v6 fromViewController:controllerCopy];
  }
}

- (void)saveButtonTappedForMediaObject:(id)object previewController:(id)controller
{
  v9[1] = *MEMORY[0x1E69E9840];
  v5 = [(CKChatController *)self chatItemForMediaObject:object previewController:controller];
  v6 = v5;
  if (v5)
  {
    v9[0] = v5;
    v7 = [MEMORY[0x1E695DEC8] arrayWithObjects:v9 count:1];
    [CKChatItem unloadSizesOfChatItems:v7];

    chat = [(CKCoreChatController *)self chat];
    [chat _reloadChatItemsForPhotoSaveStatusChange];
  }
}

- (BOOL)shouldHideInteractionOptions
{
  conversation = [(CKCoreChatController *)self conversation];
  hasLeftGroupChat = [conversation hasLeftGroupChat];

  isReadOnly = [(CKCoreChatController *)self isReadOnly];
  conversation2 = [(CKCoreChatController *)self conversation];
  isBusinessChatDisabled = [conversation2 isBusinessChatDisabled];

  return ([(CKChatController *)self isEditing]& 1) != 0 || (hasLeftGroupChat & 1) != 0 || isBusinessChatDisabled & 1 | ![(CKCoreChatController *)self shouldDisplayTextEntry]| isReadOnly;
}

- (BOOL)previewControllerIsInGroupConversation:(id)conversation
{
  conversation = [(CKCoreChatController *)self conversation];
  isGroupConversation = [conversation isGroupConversation];

  return isGroupConversation;
}

- (void)sendMessageAcknowledgment:(int64_t)acknowledgment chatItem:(id)item previewController:(id)controller
{
  itemCopy = item;
  chat = [(CKCoreChatController *)self chat];
  [chat sendMessageAcknowledgment:acknowledgment forChatItem:itemCopy];
}

- (id)contextualCKChatItemsForPreviewController:(id)controller
{
  collectionViewController = [(CKCoreChatController *)self collectionViewController];
  chatItems = [collectionViewController chatItems];

  return chatItems;
}

- (void)previewControllerDidCancelDismiss:(id)dismiss
{
  collectionViewController = [(CKCoreChatController *)self collectionViewController];
  [collectionViewController endHoldingUpdatesAfterQuicklookCancelsDismiss];
}

- (id)_chatItemForMediaObject:(id)object
{
  v42 = *MEMORY[0x1E69E9840];
  objectCopy = object;
  v36 = 0u;
  v37 = 0u;
  v38 = 0u;
  v39 = 0u;
  collectionViewController = [(CKCoreChatController *)self collectionViewController];
  chatItems = [collectionViewController chatItems];

  v30 = [chatItems countByEnumeratingWithState:&v36 objects:v41 count:16];
  if (!v30)
  {
    goto LABEL_22;
  }

  v6 = *v37;
  v26 = *v37;
  v27 = chatItems;
  do
  {
    for (i = 0; i != v30; ++i)
    {
      if (*v37 != v6)
      {
        objc_enumerationMutation(chatItems);
      }

      v8 = *(*(&v36 + 1) + 8 * i);
      objc_opt_class();
      if (objc_opt_isKindOfClass())
      {
        v9 = v8;
        mediaObject = [v9 mediaObject];
        transferGUID = [mediaObject transferGUID];
        transferGUID2 = [objectCopy transferGUID];
        v13 = [transferGUID isEqualToString:transferGUID2];

        if (v13)
        {
          goto LABEL_23;
        }

        goto LABEL_8;
      }

      objc_opt_class();
      if (objc_opt_isKindOfClass())
      {
        v28 = v8;
        v14 = v8;
        v32 = 0u;
        v33 = 0u;
        v34 = 0u;
        v35 = 0u;
        v29 = v14;
        aggregateChatItems = [v14 aggregateChatItems];
        v16 = [aggregateChatItems countByEnumeratingWithState:&v32 objects:v40 count:16];
        if (!v16)
        {
LABEL_18:

          v6 = v26;
          chatItems = v27;
          v8 = v28;
LABEL_8:

          continue;
        }

        v17 = v16;
        v18 = *v33;
LABEL_12:
        v19 = 0;
        while (1)
        {
          if (*v33 != v18)
          {
            objc_enumerationMutation(aggregateChatItems);
          }

          v20 = *(*(&v32 + 1) + 8 * v19);
          mediaObject2 = [v20 mediaObject];
          transferGUID3 = [mediaObject2 transferGUID];
          transferGUID4 = [objectCopy transferGUID];
          v24 = [transferGUID3 isEqualToString:transferGUID4];

          if (v24)
          {
            break;
          }

          if (v17 == ++v19)
          {
            v17 = [aggregateChatItems countByEnumeratingWithState:&v32 objects:v40 count:16];
            if (v17)
            {
              goto LABEL_12;
            }

            goto LABEL_18;
          }
        }

        v9 = v20;

        v6 = v26;
        chatItems = v27;
        if (v9)
        {
          goto LABEL_23;
        }
      }
    }

    v30 = [chatItems countByEnumeratingWithState:&v36 objects:v41 count:16];
  }

  while (v30);
LABEL_22:
  v9 = 0;
LABEL_23:

  return v9;
}

- (BOOL)respondsToSelector:(SEL)selector
{
  if (sel_animateRevealWithInteractionProgress_forPreviewingAtLocation_inSourceView_containerView_ == selector)
  {
    previewRevealView = [(CKChatController *)self previewRevealView];
    v3 = previewRevealView != 0;
  }

  else
  {
    v6.receiver = self;
    v6.super_class = CKChatController;
    return [(CKChatController *)&v6 respondsToSelector:?];
  }

  return v3;
}

- (void)animateRevealWithInteractionProgress:(id)progress forPreviewingAtLocation:(CGPoint)location inSourceView:(id)view containerView:(id)containerView
{
  progressCopy = progress;
  viewCopy = view;
  objc_opt_class();
  if ((objc_opt_isKindOfClass() & 1) != 0 && ([progressCopy didEnd] & 1) == 0)
  {
    mEMORY[0x1E69DC668] = [MEMORY[0x1E69DC668] sharedApplication];
    keyWindow = [mEMORY[0x1E69DC668] keyWindow];

    [viewCopy bounds];
    [viewCopy convertRect:keyWindow toView:?];
    v12 = v11;
    v14 = v13;
    v16 = v15;
    v18 = v17;
    previewRevealView = [(CKChatController *)self previewRevealView];
    [keyWindow addSubview:previewRevealView];

    previewRevealView2 = [(CKChatController *)self previewRevealView];
    [previewRevealView2 setFrame:{v12, v14, v16, v18}];

    previewRevealView3 = [(CKChatController *)self previewRevealView];
    previewInvisibleInkEffectController = [(CKChatController *)self previewInvisibleInkEffectController];
    borrowEffectView = [previewInvisibleInkEffectController borrowEffectView];
    [previewRevealView3 addSubview:borrowEffectView];

    [progressCopy addProgressObserver:self];
  }

  else
  {
    [(CKChatController *)self setPreviewRevealView:0];
  }
}

- (void)interactionProgressDidUpdate:(id)update
{
  v4 = MEMORY[0x1E69793D0];
  v5 = *MEMORY[0x1E6979EB8];
  updateCopy = update;
  v7 = [v4 functionWithName:v5];
  [updateCopy percentComplete];
  v9 = v8;

  *&v10 = v9;
  [v7 _solveForInput:v10];
  v12 = v11 * 0.0175 + 1.0;
  previewRevealView = [(CKChatController *)self previewRevealView];
  CGAffineTransformMakeScale(&v14, v12, v12);
  [previewRevealView setTransform:&v14];
}

- (void)interactionProgress:(id)progress didEnd:(BOOL)end
{
  progressCopy = progress;
  previewRevealView = [(CKChatController *)self previewRevealView];
  [previewRevealView removeFromSuperview];

  [(CKChatController *)self setPreviewRevealView:0];
  [progressCopy removeProgressObserver:self];
}

- (void)updateFTButton
{
  callStateResolver = [(CKChatController *)self callStateResolver];
  navBarFaceTimeCallButton = [(CKChatController *)self navBarFaceTimeCallButton];
  v4 = [callStateResolver updateCallStateForCallButton:navBarFaceTimeCallButton];
}

- (void)button:(id)button requestsJoinActiveCallWithVideoEnabled:(BOOL)enabled
{
  enabledCopy = enabled;
  buttonCopy = button;
  navBarFaceTimeCallButton = [(CKChatController *)self navBarFaceTimeCallButton];

  if (navBarFaceTimeCallButton == buttonCopy)
  {
    conversation = [(CKCoreChatController *)self conversation];
    chat = [conversation chat];
    conversation2 = [chat conversation];

    if (conversation2)
    {
      conversation3 = [(CKCoreChatController *)self conversation];
      chat2 = [conversation3 chat];
      [chat2 joinExistingTUConversation];
    }

    else
    {
      IsGreenTea = IMDeviceIsGreenTea();
      conversation3 = [(CKCoreChatController *)self conversation];
      chat3 = [conversation3 chat];
      chat2 = chat3;
      if (IsGreenTea)
      {
        [chat3 initiateTUDialRequestWithVideoEnabled:enabledCopy];
      }

      else
      {
        [chat3 initiateTUConversationWithVideoEnabled:enabledCopy];
      }
    }
  }
}

- (void)buttonRequestsOpenJoinedCall:(id)call
{
  callCopy = call;
  navBarFaceTimeCallButton = [(CKChatController *)self navBarFaceTimeCallButton];

  if (navBarFaceTimeCallButton == callCopy)
  {
    conversation = [(CKCoreChatController *)self conversation];
    chat = [conversation chat];
    conversation2 = [chat conversation];

    if (conversation2 && [conversation2 state] && objc_msgSend(conversation2, "state") != 1)
    {
      [CKFaceTimeUtilities showCallControlsForConversation:conversation2];
    }

    else
    {
      conversation3 = [(CKCoreChatController *)self conversation];
      chat2 = [conversation3 chat];
      [chat2 joinExistingTUConversation];
    }
  }
}

- (void)buttonRequestsStartFaceTimeAudio:(id)audio
{
  audioCopy = audio;
  navBarFaceTimeCallButton = [(CKChatController *)self navBarFaceTimeCallButton];

  if (navBarFaceTimeCallButton == audioCopy)
  {
    conversation = [(CKCoreChatController *)self conversation];
    chat = [conversation chat];
    [chat initiateTUConversationWithVideoEnabled:0];
  }
}

- (void)buttonRequestsStartFaceTimeVideo:(id)video
{
  videoCopy = video;
  navBarFaceTimeCallButton = [(CKChatController *)self navBarFaceTimeCallButton];

  if (navBarFaceTimeCallButton == videoCopy)
  {
    conversation = [(CKCoreChatController *)self conversation];
    chat = [conversation chat];
    [chat initiateTUConversationWithVideoEnabled:1];
  }
}

- (void)buttonRequestsLeaveJoinedCall:(id)call
{
  conversation = [(CKCoreChatController *)self conversation];
  chat = [conversation chat];
  [chat leaveCurrentTUCall];
}

- (void)button:(id)button requestsStartFaceTimeWithScreenShareType:(unint64_t)type
{
  v13 = *MEMORY[0x1E69E9840];
  buttonCopy = button;
  navBarFaceTimeCallButton = [(CKChatController *)self navBarFaceTimeCallButton];

  if (navBarFaceTimeCallButton == buttonCopy)
  {
    v8 = IMLogHandleForCategory();
    if (os_log_type_enabled(v8, OS_LOG_TYPE_INFO))
    {
      v11 = 134217984;
      typeCopy = type;
      _os_log_impl(&dword_19020E000, v8, OS_LOG_TYPE_INFO, "Request to start screenShare call detected type={%ld).", &v11, 0xCu);
    }

    conversation = [(CKCoreChatController *)self conversation];
    chat = [conversation chat];
    [chat initiateTUConversationWithScreenShareType:type];
  }
}

- (void)presentCollaborationPopoverUI
{
  aBlock[0] = MEMORY[0x1E69E9820];
  aBlock[1] = 3221225472;
  aBlock[2] = __64__CKChatController_Collaboration__presentCollaborationPopoverUI__block_invoke;
  aBlock[3] = &unk_1E72F3CB0;
  aBlock[4] = self;
  v3 = _Block_copy(aBlock);
  if (CKIsRunningInMacCatalyst() && ([MEMORY[0x1E6994FD0] instancesRespondToSelector:sel_initWithCollaborationSharingOptions_layoutMargins_userDidChangeOption_contentSizeDidChange_] & 1) != 0)
  {
    v4 = 0;
  }

  else
  {
    v5 = [MEMORY[0x1E6994FD0] instancesRespondToSelector:sel_initWithCollaborationSharingOptionsView_userDidChangeOption_];
    v6 = objc_alloc(MEMORY[0x1E6994FD0]);
    composition = [(CKChatController *)self composition];
    collaborationShareOptions = [composition collaborationShareOptions];
    v9 = collaborationShareOptions;
    if (v5)
    {
      v4 = [v6 initWithCollaborationSharingOptionsView:collaborationShareOptions userDidChangeOption:v3];
    }

    else
    {
      optionsGroups = [collaborationShareOptions optionsGroups];
      v17[0] = MEMORY[0x1E69E9820];
      v17[1] = 3221225472;
      v17[2] = __64__CKChatController_Collaboration__presentCollaborationPopoverUI__block_invoke_2;
      v17[3] = &unk_1E72F3CD8;
      v17[4] = self;
      v4 = [v6 initWithSharingOptionsView:optionsGroups userDidChangeOption:v17];
    }
  }

  [v4 setModalPresentationStyle:1];
  [v4 setModalTransitionStyle:0];
  v11 = [objc_alloc(MEMORY[0x1E69DC708]) initWithBarButtonSystemItem:0 target:self action:sel__dismissCollaborationPopoverUI];
  navigationItem = [v4 navigationItem];
  [navigationItem setRightBarButtonItem:v11];

  v13 = [[CKFullscreenBrowserNavigationController alloc] initWithRootViewController:v4];
  navigationBar = [(CKFullscreenBrowserNavigationController *)v13 navigationBar];
  [navigationBar setTranslucent:0];
  [navigationBar _setShadowAlpha:0.0];
  systemGroupedBackgroundColor = [MEMORY[0x1E69DC888] systemGroupedBackgroundColor];
  [navigationBar _setBackgroundColor:systemGroupedBackgroundColor];

  v16 = +[CKAdaptivePresentationController sharedInstance];
  [v16 presentViewController:v13 fromViewController:self presentationHandler:0 dismissalHandler:0 animated:1 completion:0];
}

void __64__CKChatController_Collaboration__presentCollaborationPopoverUI__block_invoke(uint64_t a1, uint64_t a2, uint64_t a3, uint64_t a4, void *a5)
{
  v6 = *(a1 + 32);
  v7 = a5;
  v8 = [v6 composition];
  v12 = [v8 shelfPluginPayload];

  [v12 setSkipConfigurePlugin:0];
  v9 = [v7 summary];
  [v12 setCollaborationOptionsSummary:v9];

  v10 = [*(a1 + 32) composition];
  v11 = [v10 compositionByAppendingText:0 shelfPluginPayload:v12 shelfMediaObject:0 collaborationShareOptions:v7];

  [*(a1 + 32) setComposition:v11];
}

void __64__CKChatController_Collaboration__presentCollaborationPopoverUI__block_invoke_2(uint64_t a1, uint64_t a2, uint64_t a3, uint64_t a4, uint64_t a5)
{
  v8 = [MEMORY[0x1E697B720] shareOptionsWithOptionsGroups:a5];
  v6 = [*(a1 + 32) composition];
  v7 = [v6 compositionWithCollaborationShareOptions:v8];
  [*(a1 + 32) setComposition:v7];
}

- (void)_dismissCollaborationPopoverUI
{
  v2 = +[CKAdaptivePresentationController sharedInstance];
  [v2 dismissViewControllerAnimated:1 completion:0];
}

- (void)presentCollaborationFailureAlertForComposition:(id)composition sharingURL:(id)l error:(id)error completion:(id)completion
{
  compositionCopy = composition;
  lCopy = l;
  errorCopy = error;
  completionCopy = completion;
  if ([MEMORY[0x1E696AF00] isMainThread])
  {
    [(CKChatController *)self _actuallyPresentCollaborationFailureAlertForComposition:compositionCopy sharingURL:lCopy error:errorCopy completion:completionCopy];
  }

  else
  {
    block[0] = MEMORY[0x1E69E9820];
    block[1] = 3221225472;
    block[2] = __110__CKChatController_Collaboration__presentCollaborationFailureAlertForComposition_sharingURL_error_completion___block_invoke;
    block[3] = &unk_1E72EDAE0;
    block[4] = self;
    v15 = compositionCopy;
    v16 = lCopy;
    v17 = errorCopy;
    v18 = completionCopy;
    dispatch_sync(MEMORY[0x1E69E96A0], block);
  }
}

- (void)_actuallyPresentCollaborationFailureAlertForComposition:(id)composition sharingURL:(id)l error:(id)error completion:(id)completion
{
  compositionCopy = composition;
  lCopy = l;
  errorCopy = error;
  v13 = compositionCopy;
  v14 = errorCopy;
  completionCopy = completion;
  sourceApplicationID = [compositionCopy sourceApplicationID];
  LODWORD(compositionCopy) = [sourceApplicationID isEqual:@"com.apple.FaceTime"];

  if (compositionCopy)
  {
    v17 = [MEMORY[0x1E695DFF8] URLWithString:@"messages://"];
    TUOpenURL();
  }

  v198 = completionCopy;
  selfCopy = self;
  if (!v14)
  {
    goto LABEL_24;
  }

  domain = [v14 domain];
  v19 = [domain isEqualToString:*MEMORY[0x1E695B740]];

  if (v19)
  {
    composition = [(CKChatController *)self composition];
    shelfPluginPayload = [composition shelfPluginPayload];

    collaborationMetadata = [shelfPluginPayload collaborationMetadata];
    initiatorHandle = [collaborationMetadata initiatorHandle];

    code = [v14 code];
    v195 = initiatorHandle;
    if (code > 109)
    {
      if (code == 110)
      {
        v122 = CKFrameworkBundle();
        v115 = shelfPluginPayload;
        v27 = [v122 localizedStringForKey:@"COLLABORATION_ERROR_PRIVATE_MANATEE_UNAVAILABLE_ALERT_TITLE" value:&stru_1F04268F8 table:@"ChatKit"];

        v116 = CKFrameworkBundle();
        mEMORY[0x1E69A8288] = v116;
        v117 = @"COLLABORATION_ERROR_PRIVATE_MANATEE_UNAVAILABLE_ALERT_MESSAGE";
LABEL_74:
        shelfPluginPayload = v115;
        v37 = [v116 localizedStringForKey:v117 value:&stru_1F04268F8 table:@"ChatKit"];
        v34 = 1;
        v36 = 1;
        goto LABEL_106;
      }

      if (code == 111)
      {
LABEL_31:
        mEMORY[0x1E69A8288] = [MEMORY[0x1E69A8288] sharedManager];
        v65 = [mEMORY[0x1E69A8288] appNameFromSharingURL:lCopy];
        if (v65)
        {
          v66 = MEMORY[0x1E696AEC0];
          CKFrameworkBundle();
          v67 = v190 = shelfPluginPayload;
          [v67 localizedStringForKey:@"COLLABORATION_ERROR_COULD_NOT_START_COLLABORATION_MESSAGE" value:&stru_1F04268F8 table:@"ChatKit"];
          v186 = v65;
          v69 = v68 = v14;
          mEMORY[0x1E69A8288]2 = [MEMORY[0x1E69A8288] sharedManager];
          v71 = [mEMORY[0x1E69A8288]2 appNameFromSharingURL:lCopy];
          v72 = [v66 stringWithFormat:v69, v71];

          v14 = v68;
          v65 = v186;

          shelfPluginPayload = v190;
          mEMORY[0x1E69DC668] = [MEMORY[0x1E69DC668] sharedApplication];
          userInterfaceLayoutDirection = [mEMORY[0x1E69DC668] userInterfaceLayoutDirection];

          if (userInterfaceLayoutDirection == 1)
          {
            v75 = @"\u200F";
          }

          else
          {
            v75 = @"\u200E";
          }

          v76 = [(__CFString *)v75 stringByAppendingString:v72];
        }

        else
        {
          v72 = CKFrameworkBundle();
          v76 = [v72 localizedStringForKey:@"COLLABORATION_ERROR_UNKNOWN_MESSAGE" value:&stru_1F04268F8 table:@"ChatKit"];
        }

        v37 = v76;

        v34 = 0;
        v27 = 0;
LABEL_65:
        v36 = 3;
        goto LABEL_106;
      }

      if (code != 140)
      {
LABEL_75:
        mEMORY[0x1E69A8288] = [MEMORY[0x1E69A8288] sharedManager];
        v123 = [mEMORY[0x1E69A8288] appNameFromSharingURL:lCopy];
        if (v123)
        {
          v124 = MEMORY[0x1E696AEC0];
          CKFrameworkBundle();
          v125 = v192 = shelfPluginPayload;
          [v125 localizedStringForKey:@"COLLABORATION_ERROR_COULD_NOT_START_COLLABORATION_MESSAGE" value:&stru_1F04268F8 table:@"ChatKit"];
          v188 = v123;
          v127 = v126 = v14;
          mEMORY[0x1E69A8288]3 = [MEMORY[0x1E69A8288] sharedManager];
          v129 = [mEMORY[0x1E69A8288]3 appNameFromSharingURL:lCopy];
          v129 = [v124 stringWithFormat:v127, v129];

          v14 = v126;
          v123 = v188;

          shelfPluginPayload = v192;
          mEMORY[0x1E69DC668]2 = [MEMORY[0x1E69DC668] sharedApplication];
          userInterfaceLayoutDirection2 = [mEMORY[0x1E69DC668]2 userInterfaceLayoutDirection];

          if (userInterfaceLayoutDirection2 == 1)
          {
            v133 = @"\u200F";
          }

          else
          {
            v133 = @"\u200E";
          }

          v134 = [(__CFString *)v133 stringByAppendingString:v129];
        }

        else
        {
          v129 = CKFrameworkBundle();
          v134 = [v129 localizedStringForKey:@"COLLABORATION_ERROR_UNKNOWN_MESSAGE" value:&stru_1F04268F8 table:@"ChatKit"];
        }

        v37 = v134;

        v34 = 0;
        v36 = 0;
        v27 = 0;
        goto LABEL_106;
      }

LABEL_28:
      v55 = CKFrameworkBundle();
      v56 = shelfPluginPayload;
      v27 = [v55 localizedStringForKey:@"COLLABORATION_ERROR_NOT_ENOUGH_SPACE_TITLE" value:&stru_1F04268F8 table:@"ChatKit"];

      v57 = MEMORY[0x1E696AEC0];
      CKFrameworkBundle();
      v59 = v58 = v14;
      v60 = [v59 localizedStringForKey:@"COLLABORATION_ERROR_NOT_ENOUGH_SPACE_MESSAGE" value:&stru_1F04268F8 table:@"ChatKit"];
      v61 = [MEMORY[0x1E696AAF0] stringFromByteCount:objc_msgSend(v13 countStyle:{"mediaObjectsFileSize"), 3}];
      mEMORY[0x1E69A8288] = [v57 stringWithFormat:v60, v61];

      shelfPluginPayload = v56;
      v14 = v58;
      mEMORY[0x1E69DC668]3 = [MEMORY[0x1E69DC668] sharedApplication];
      userInterfaceLayoutDirection3 = [mEMORY[0x1E69DC668]3 userInterfaceLayoutDirection];

      if (userInterfaceLayoutDirection3 == 1)
      {
        v64 = @"\u200F";
      }

      else
      {
        v64 = @"\u200E";
      }

LABEL_58:
      v97 = [(__CFString *)v64 stringByAppendingString:mEMORY[0x1E69A8288]];
    }

    else
    {
      switch(code)
      {
        case 3:
        case 4:
          v25 = CKFrameworkBundle();
          v26 = shelfPluginPayload;
          v27 = [v25 localizedStringForKey:@"COLLABORATION_ERROR_NO_INTERNET_CONNECTION_TITLE" value:&stru_1F04268F8 table:@"ChatKit"];

          v28 = CKFrameworkBundle();
          mEMORY[0x1E69A8288] = v28;
          v30 = @"COLLABORATION_ERROR_NO_INTERNET_CONNECTION_MESSAGE";
          goto LABEL_70;
        case 6:
          v118 = CKFrameworkBundle();
          v26 = shelfPluginPayload;
          v27 = [v118 localizedStringForKey:@"COLLABORATION_ERROR_ICLOUD_UNAVAILABLE_TITLE" value:&stru_1F04268F8 table:@"ChatKit"];

          v28 = CKFrameworkBundle();
          mEMORY[0x1E69A8288] = v28;
          v30 = @"COLLABORATION_ERROR_TRY_AGAIN_LATER";
          goto LABEL_70;
        case 7:
        case 23:
        case 34:
          goto LABEL_31;
        case 9:
          v114 = CKFrameworkBundle();
          v115 = shelfPluginPayload;
          v27 = [v114 localizedStringForKey:@"COLLABORATION_ERROR_NOT_AUTHENTICATED_ALERT_TITLE" value:&stru_1F04268F8 table:@"ChatKit"];

          v116 = CKFrameworkBundle();
          mEMORY[0x1E69A8288] = v116;
          v117 = @"COLLABORATION_ERROR_NOT_AUTHENTICATED_ALERT_MESSAGE";
          goto LABEL_74;
        case 18:
          mEMORY[0x1E69A8288]4 = [MEMORY[0x1E69A8288] sharedManager];
          v99 = [mEMORY[0x1E69A8288]4 appNameFromSharingURL:lCopy];
          if (v99)
          {
            v100 = MEMORY[0x1E696AEC0];
            CKFrameworkBundle();
            v101 = v187 = mEMORY[0x1E69A8288]4;
            [v101 localizedStringForKey:@"COLLABORATION_ERROR_INCOMPATIBLE_VERSION_ALERT_TITLE" value:&stru_1F04268F8 table:@"ChatKit"];
            v191 = shelfPluginPayload;
            v103 = v102 = v14;
            mEMORY[0x1E69A8288]5 = [MEMORY[0x1E69A8288] sharedManager];
            [mEMORY[0x1E69A8288]5 appNameFromSharingURL:lCopy];
            v106 = v105 = v99;
            v106 = [v100 stringWithFormat:v103, v106];

            v99 = v105;
            v14 = v102;
            shelfPluginPayload = v191;

            mEMORY[0x1E69DC668]4 = [MEMORY[0x1E69DC668] sharedApplication];
            userInterfaceLayoutDirection4 = [mEMORY[0x1E69DC668]4 userInterfaceLayoutDirection];

            v110 = userInterfaceLayoutDirection4 == 1;
            mEMORY[0x1E69A8288]4 = v187;
            if (v110)
            {
              v111 = @"\u200F";
            }

            else
            {
              v111 = @"\u200E";
            }

            v112 = [(__CFString *)v111 stringByAppendingString:v106];
          }

          else
          {
            v106 = CKFrameworkBundle();
            v112 = [v106 localizedStringForKey:@"COLLABORATION_ERROR_UNKNOWN_MESSAGE" value:&stru_1F04268F8 table:@"ChatKit"];
          }

          v27 = v112;

          mEMORY[0x1E69A8288] = CKFrameworkBundle();
          v37 = [mEMORY[0x1E69A8288] localizedStringForKey:@"COLLABORATION_ERROR_INCOMPATIBLE_VERSION_ALERT_MESSAGE" value:&stru_1F04268F8 table:@"ChatKit"];
          v36 = 2;
          v34 = 1;
          goto LABEL_106;
        case 25:
          goto LABEL_28;
        case 27:
          v119 = CKFrameworkBundle();
          v26 = shelfPluginPayload;
          v27 = [v119 localizedStringForKey:@"COLLABORATION_ERROR_LIMIT_EXCEEDED_TITLE" value:&stru_1F04268F8 table:@"ChatKit"];

          v28 = CKFrameworkBundle();
          mEMORY[0x1E69A8288] = v28;
          v30 = @"COLLABORATION_ERROR_LIMIT_EXCEEDED_MESSAGE";
          goto LABEL_70;
        case 29:
          v120 = CKFrameworkBundle();
          v26 = shelfPluginPayload;
          v27 = [v120 localizedStringForKey:@"COLLABORATION_ERROR_TOO_MANY_PARTICIPANTS_ALERT_TITLE" value:&stru_1F04268F8 table:@"ChatKit"];

          v28 = CKFrameworkBundle();
          mEMORY[0x1E69A8288] = v28;
          v30 = @"COLLABORATION_ERROR_TOO_MANY_PARTICIPANTS_ALERT_MESSAGE";
LABEL_70:
          shelfPluginPayload = v26;
          v97 = [v28 localizedStringForKey:v30 value:&stru_1F04268F8 table:@"ChatKit"];
          break;
        case 32:
          v84 = MEMORY[0x1E696AEC0];
          v85 = CKFrameworkBundle();
          v86 = [v85 localizedStringForKey:@"COLLABORATION_ERROR_RESTRICTION_ENABLED_TITLE" value:&stru_1F04268F8 table:@"ChatKit"];
          [v84 stringWithFormat:v86, initiatorHandle];
          v88 = v87 = v14;

          mEMORY[0x1E69DC668]5 = [MEMORY[0x1E69DC668] sharedApplication];
          userInterfaceLayoutDirection5 = [mEMORY[0x1E69DC668]5 userInterfaceLayoutDirection];

          if (userInterfaceLayoutDirection5 == 1)
          {
            v91 = @"\u200F";
          }

          else
          {
            v91 = @"\u200E";
          }

          v27 = [(__CFString *)v91 stringByAppendingString:v88];

          v92 = MEMORY[0x1E696AEC0];
          v93 = CKFrameworkBundle();
          v94 = [v93 localizedStringForKey:@"COLLABORATION_ERROR_RESTRICTION_ENABLED_MESSAGE" value:&stru_1F04268F8 table:@"ChatKit"];
          mEMORY[0x1E69A8288] = [v92 stringWithFormat:v94, initiatorHandle];

          v14 = v87;
          mEMORY[0x1E69DC668]6 = [MEMORY[0x1E69DC668] sharedApplication];
          userInterfaceLayoutDirection6 = [mEMORY[0x1E69DC668]6 userInterfaceLayoutDirection];

          if (userInterfaceLayoutDirection6 == 1)
          {
            v64 = @"\u200F";
          }

          else
          {
            v64 = @"\u200E";
          }

          goto LABEL_58;
        case 33:
          v113 = CKFrameworkBundle();
          v27 = [v113 localizedStringForKey:@"COLLABORATION_ERROR_PARTICIPANT_MAY_NEED_VERIFICATION_ALERT_TITLE" value:&stru_1F04268F8 table:@"ChatKit"];

          mEMORY[0x1E69A8288] = CKFrameworkBundle();
          v37 = [mEMORY[0x1E69A8288] localizedStringForKey:@"COLLABORATION_ERROR_PARTICIPANT_MAY_NEED_VERIFICATION_ALERT_MESSAGE" value:&stru_1F04268F8 table:@"ChatKit"];
          v34 = 0;
          goto LABEL_65;
        case 36:
          v121 = CKFrameworkBundle();
          v115 = shelfPluginPayload;
          v27 = [v121 localizedStringForKey:@"COLLABORATION_ERROR_ACCOUNT_TEMPORARILY_UNAVAILABLE_ALERT_TITLE" value:&stru_1F04268F8 table:@"ChatKit"];

          v116 = CKFrameworkBundle();
          mEMORY[0x1E69A8288] = v116;
          v117 = @"COLLABORATION_ERROR_ACCOUNT_TEMPORARILY_UNAVAILABLE_ALERT_MESSAGE";
          goto LABEL_74;
        default:
          goto LABEL_75;
      }
    }

    v37 = v97;
    v34 = 0;
    v36 = 0;
LABEL_106:

    v35 = 0;
    goto LABEL_107;
  }

  domain2 = [v14 domain];
  v32 = [domain2 isEqualToString:@"CKCollaborationErrorDomain"];

  if (!v32)
  {
    domain3 = [v14 domain];
    v43 = [domain3 isEqualToString:@"CKCollaborationStatusErrorDomain"];

    if (v43)
    {
      code2 = [v14 code];
      v27 = 0;
      v45 = @"COLLABORATION_ERROR_FOLDER_UNMODIFIABLE_SUBITEM_MESSAGE";
      v46 = @"COLLABORATION_ERROR_FOLDER_UNMODIFIABLE_SUBITEM_TITLE";
      v36 = 4;
      if (code2 <= 2)
      {
        if (!code2)
        {
          v47 = CKFrameworkBundle();
          v48 = v47;
          v49 = @"COLLABORATION_ERROR_ITEM_CANNOT_BE_SHARED_TITLE";
          goto LABEL_90;
        }

        if (code2 != 1)
        {
          v36 = 0;
          v34 = 0;
          if (code2 == 2)
          {
            v47 = CKFrameworkBundle();
            v48 = v47;
            v49 = @"COLLABORATION_ERROR_ITEM_IS_ALREADY_SHARED_BY_ANOTHER_TITLE";
            goto LABEL_90;
          }

          goto LABEL_95;
        }
      }

      else
      {
        if (code2 <= 4)
        {
          if (code2 == 3)
          {
            v153 = IMLogHandleForCategory();
            if (os_log_type_enabled(v153, OS_LOG_TYPE_ERROR))
            {
              [CKChatController(Collaboration) _actuallyPresentCollaborationFailureAlertForComposition:sharingURL:error:completion:];
            }

            v27 = 0;
            goto LABEL_94;
          }

          v47 = CKFrameworkBundle();
          v48 = v47;
          v49 = @"COLLABORATION_ERROR_ITEM_IS_ALREADY_SHARED_BY_ME_TITLE";
LABEL_90:
          v27 = [v47 localizedStringForKey:v49 value:&stru_1F04268F8 table:@"ChatKit"];

LABEL_94:
          v36 = 0;
          v34 = 0;
          goto LABEL_95;
        }

        if (code2 != 5)
        {
          v36 = 0;
          v34 = 0;
          if (code2 == 6)
          {
            v45 = @"COLLABORATION_ERROR_FOLDER_HAS_SHARED_SUBITEM_MESSAGE";
            v36 = 5;
            v46 = @"COLLABORATION_ERROR_FOLDER_HAS_SHARED_SUBITEM_TITLE";
            goto LABEL_50;
          }

LABEL_95:
          mEMORY[0x1E69A8288]6 = [MEMORY[0x1E69A8288] sharedManager];
          v193 = [mEMORY[0x1E69A8288]6 appNameFromSharingURL:lCopy];
          if (v193)
          {
            v154 = MEMORY[0x1E696AEC0];
            v189 = CKFrameworkBundle();
            v155 = [v189 localizedStringForKey:@"COLLABORATION_ERROR_COULD_NOT_START_COLLABORATION_MESSAGE" value:&stru_1F04268F8 table:@"ChatKit"];
            mEMORY[0x1E69A8288]7 = [MEMORY[0x1E69A8288] sharedManager];
            [mEMORY[0x1E69A8288]7 appNameFromSharingURL:lCopy];
            v158 = v157 = v14;
            v158 = [v154 stringWithFormat:v155, v158];

            v14 = v157;
            mEMORY[0x1E69DC668]7 = [MEMORY[0x1E69DC668] sharedApplication];
            userInterfaceLayoutDirection7 = [mEMORY[0x1E69DC668]7 userInterfaceLayoutDirection];

            if (userInterfaceLayoutDirection7 == 1)
            {
              v162 = @"\u200F";
            }

            else
            {
              v162 = @"\u200E";
            }

            v163 = [(__CFString *)v162 stringByAppendingString:v158];
          }

          else
          {
            v158 = CKFrameworkBundle();
            v163 = [v158 localizedStringForKey:@"COLLABORATION_ERROR_UNKNOWN_MESSAGE" value:&stru_1F04268F8 table:@"ChatKit"];
          }

          v37 = v163;
          self = selfCopy;

          v35 = 0;
          goto LABEL_108;
        }
      }

LABEL_50:
      v82 = CKFrameworkBundle();
      v27 = [v82 localizedStringForKey:v46 value:&stru_1F04268F8 table:@"ChatKit"];

      v83 = CKFrameworkBundle();
      v37 = [v83 localizedStringForKey:v45 value:&stru_1F04268F8 table:@"ChatKit"];

      v34 = 2;
      if (v37)
      {
        v35 = 0;
LABEL_107:
        self = selfCopy;
        goto LABEL_108;
      }

      goto LABEL_95;
    }

    v54 = IMLogHandleForCategory();
    if (os_log_type_enabled(v54, OS_LOG_TYPE_ERROR))
    {
      [CKChatController(Collaboration) _actuallyPresentCollaborationFailureAlertForComposition:sharingURL:error:completion:];
    }

LABEL_24:
    v35 = 0;
    v34 = 0;
    v36 = 0;
    v37 = 0;
    v27 = 0;
    goto LABEL_108;
  }

  code3 = [v14 code];
  v34 = 0;
  v35 = 0;
  if (code3 > 2)
  {
    if (code3 == 3)
    {
      conversation = [(CKCoreChatController *)self conversation];
      chat = [conversation chat];
      isGroupChat = [chat isGroupChat];

      if (!isGroupChat)
      {
        conversation2 = [(CKCoreChatController *)self conversation];
        recipient = [conversation2 recipient];
        abbreviatedDisplayName = [recipient abbreviatedDisplayName];

        v138 = MEMORY[0x1E696AEC0];
        v139 = CKFrameworkBundle();
        [v139 localizedStringForKey:@"COLLABORATION_ERROR_SINGLE_RECIPIENT_CANNOT_JOIN_TITLE" value:&stru_1F04268F8 table:@"ChatKit"];
        v141 = v140 = v14;
        v137 = [v138 stringWithFormat:v141, abbreviatedDisplayName];

        mEMORY[0x1E69DC668]8 = [MEMORY[0x1E69DC668] sharedApplication];
        userInterfaceLayoutDirection8 = [mEMORY[0x1E69DC668]8 userInterfaceLayoutDirection];

        if (userInterfaceLayoutDirection8 == 1)
        {
          v145 = @"\u200F";
        }

        else
        {
          v145 = @"\u200E";
        }

        v27 = [(__CFString *)v145 stringByAppendingString:v137];

        v146 = MEMORY[0x1E696AEC0];
        v147 = CKFrameworkBundle();
        v148 = [v147 localizedStringForKey:@"COLLABORATION_ERROR_SINGLE_RECIPIENT_CANNOT_JOIN_MESSAGE" value:&stru_1F04268F8 table:@"ChatKit"];
        v1372 = [v146 stringWithFormat:v148, abbreviatedDisplayName];

        v14 = v140;
        mEMORY[0x1E69DC668]9 = [MEMORY[0x1E69DC668] sharedApplication];
        userInterfaceLayoutDirection9 = [mEMORY[0x1E69DC668]9 userInterfaceLayoutDirection];

        if (userInterfaceLayoutDirection9 == 1)
        {
          v152 = @"\u200F";
        }

        else
        {
          v152 = @"\u200E";
        }

        v37 = [(__CFString *)v152 stringByAppendingString:v1372];

        self = selfCopy;
        goto LABEL_87;
      }

      v81 = CKFrameworkBundle();
      v27 = [v81 localizedStringForKey:@"COLLABORATION_ERROR_ALL_RECIPIENTS_CANNOT_JOIN_TITLE" value:&stru_1F04268F8 table:@"ChatKit"];

      v51 = CKFrameworkBundle();
      v52 = v51;
      v53 = @"COLLABORATION_ERROR_ALL_RECIPIENTS_CANNOT_JOIN_MESSAGE";
    }

    else
    {
      v36 = 0;
      v37 = 0;
      v27 = 0;
      if (code3 != 4)
      {
        goto LABEL_108;
      }

      v50 = CKFrameworkBundle();
      v27 = [v50 localizedStringForKey:@"COLLABORATION_ERROR_SOME_RECIPIENTS_CANNOT_JOIN_TITLE" value:&stru_1F04268F8 table:@"ChatKit"];

      v51 = CKFrameworkBundle();
      v52 = v51;
      v53 = @"COLLABORATION_ERROR_SOME_RECIPIENTS_CANNOT_JOIN_MESSAGE";
    }

    v37 = [v51 localizedStringForKey:v53 value:&stru_1F04268F8 table:@"ChatKit"];

    self = selfCopy;
LABEL_87:
    v34 = 0;
    v36 = 0;
    v35 = 1;
    goto LABEL_108;
  }

  if (code3 == 1)
  {
    v77 = CKFrameworkBundle();
    v27 = [v77 localizedStringForKey:@"COLLABORATION_ERROR_URL_INACCESSABLE_TITLE" value:&stru_1F04268F8 table:@"ChatKit"];

    v39 = CKFrameworkBundle();
    v40 = v39;
    v41 = @"COLLABORATION_ERROR_URL_INACCESSABLE_MESSAGE";
    goto LABEL_41;
  }

  v36 = 0;
  v37 = 0;
  v27 = 0;
  if (code3 == 2)
  {
    v38 = CKFrameworkBundle();
    v27 = [v38 localizedStringForKey:@"COLLABORATION_ERROR_MISSING_FILE_FOR_URL_TITLE" value:&stru_1F04268F8 table:@"ChatKit"];

    v39 = CKFrameworkBundle();
    v40 = v39;
    v41 = @"COLLABORATION_ERROR_MISSING_FILE_FOR_URL_MESSAGE";
LABEL_41:
    v37 = [v39 localizedStringForKey:v41 value:&stru_1F04268F8 table:@"ChatKit"];

    self = selfCopy;
    v35 = 0;
    v34 = 0;
    v36 = 0;
  }

LABEL_108:
  collaborationFailureCount = [(CKChatController *)self collaborationFailureCount];
  [(CKChatController *)self setCollaborationFailureCount:collaborationFailureCount + 1];
  if ((v35 & 1) != 0 || collaborationFailureCount < 3)
  {
    if (v27)
    {
      if (v37)
      {
        goto LABEL_123;
      }
    }

    else
    {
      v183 = CKFrameworkBundle();
      v27 = [v183 localizedStringForKey:@"COLLABORATION_ERROR_OCCURRED_TITLE" value:&stru_1F04268F8 table:@"ChatKit"];

      if (v37)
      {
        goto LABEL_123;
      }
    }

    v197 = v14;
    mEMORY[0x1E69A8288]8 = CKFrameworkBundle();
    v182 = [mEMORY[0x1E69A8288]8 localizedStringForKey:@"COLLABORATION_ERROR_UNKNOWN_MESSAGE" value:&stru_1F04268F8 table:@"ChatKit"];
  }

  else
  {
    v197 = v14;
    v165 = CKFrameworkBundle();
    v166 = [v165 localizedStringForKey:@"COLLABORATION_ERROR_OCCURRED_TITLE" value:&stru_1F04268F8 table:@"ChatKit"];

    mEMORY[0x1E69A8288]8 = [MEMORY[0x1E69A8288] sharedManager];
    v168 = [mEMORY[0x1E69A8288]8 appNameFromSharingURL:lCopy];
    if (v168)
    {
      v169 = MEMORY[0x1E696AEC0];
      v170 = CKFrameworkBundle();
      v171 = [v170 localizedStringForKey:@"COLLABORATION_ERROR_COULD_NOT_START_COLLABORATION_MESSAGE" value:&stru_1F04268F8 table:@"ChatKit"];
      mEMORY[0x1E69A8288]9 = [MEMORY[0x1E69A8288] sharedManager];
      [mEMORY[0x1E69A8288]9 appNameFromSharingURL:lCopy];
      v194 = v37;
      v173 = v166;
      v174 = lCopy;
      v176 = v175 = v13;
      v176 = [v169 stringWithFormat:v171, v176];

      mEMORY[0x1E69DC668]10 = [MEMORY[0x1E69DC668] sharedApplication];
      userInterfaceLayoutDirection10 = [mEMORY[0x1E69DC668]10 userInterfaceLayoutDirection];

      v110 = userInterfaceLayoutDirection10 == 1;
      v13 = v175;
      lCopy = v174;
      v166 = v173;
      v180 = v194;
      if (v110)
      {
        v181 = @"\u200F";
      }

      else
      {
        v181 = @"\u200E";
      }

      v182 = [(__CFString *)v181 stringByAppendingString:v176];
    }

    else
    {
      v180 = CKFrameworkBundle();
      v182 = [v180 localizedStringForKey:@"COLLABORATION_ERROR_UNKNOWN_MESSAGE" value:&stru_1F04268F8 table:@"ChatKit"];
      v176 = v37;
    }

    v34 = 0;
    v36 = 0;
    v27 = v166;
  }

  v37 = v182;
  v14 = v197;
  self = selfCopy;
LABEL_123:
  v184 = IMLogHandleForCategory();
  if (os_log_type_enabled(v184, OS_LOG_TYPE_ERROR))
  {
    [CKChatController(Collaboration) _actuallyPresentCollaborationFailureAlertForComposition:sharingURL:error:completion:];
  }

  v185 = [CKAlertController alertControllerWithTitle:v27 message:v37 preferredStyle:1];
  [v185 setWantsWindowedPresentation:0];
  [(CKChatController *)self _addDefaultButtonToSharingErrorAlertController:v185 sharingURL:lCopy defaultButtonAction:v36 completion:v198];
  [(CKChatController *)self _addOtherButtonToSharingErrorAlertController:v185 otherButtonAction:v34 completion:v198];

  [v185 presentFromViewController:self animated:1 completion:0];
}

- (void)_addOtherButtonToSharingErrorAlertController:(id)controller otherButtonAction:(int64_t)action completion:(id)completion
{
  controllerCopy = controller;
  completionCopy = completion;
  if (action == 1)
  {
    v10 = @"NOT_NOW";
  }

  else
  {
    if (action != 2)
    {
      goto LABEL_7;
    }

    v10 = @"CANCEL";
  }

  v11 = CKFrameworkBundle();
  v12 = [v11 localizedStringForKey:v10 value:&stru_1F04268F8 table:@"ChatKit"];

  if (v12)
  {
    v14 = MEMORY[0x1E69E9820];
    v15 = 3221225472;
    v16 = __109__CKChatController_Collaboration___addOtherButtonToSharingErrorAlertController_otherButtonAction_completion___block_invoke;
    v17 = &unk_1E72F35A0;
    selfCopy = self;
    v19 = completionCopy;
    v13 = [CKAlertAction actionWithTitle:v12 style:1 handler:&v14];
    [controllerCopy addAction:{v13, v14, v15, v16, v17, selfCopy}];
  }

LABEL_7:
}

uint64_t __109__CKChatController_Collaboration___addOtherButtonToSharingErrorAlertController_otherButtonAction_completion___block_invoke(uint64_t a1)
{
  v2 = [*(a1 + 32) entryView];
  [v2 configureForDisplayMode:1];

  v3 = [*(a1 + 32) entryView];
  v4 = [v3 sendButton];
  [v4 setEnabled:1];

  v5 = [*(a1 + 32) entryView];
  [v5 updateEntryView];

  v6 = IMLogHandleForCategory();
  if (os_log_type_enabled(v6, OS_LOG_TYPE_INFO))
  {
    *v8 = 0;
    _os_log_impl(&dword_19020E000, v6, OS_LOG_TYPE_INFO, "User tapped other alert button", v8, 2u);
  }

  result = *(a1 + 40);
  if (result)
  {
    return (*(result + 16))(result, 0);
  }

  return result;
}

- (void)_addDefaultButtonToSharingErrorAlertController:(id)controller sharingURL:(id)l defaultButtonAction:(int64_t)action completion:(id)completion
{
  controllerCopy = controller;
  lCopy = l;
  completionCopy = completion;
  if (action > 5)
  {
    v15 = 0;
  }

  else
  {
    v13 = off_1E72F3ED8[action];
    v14 = CKFrameworkBundle();
    v15 = [v14 localizedStringForKey:v13 value:&stru_1F04268F8 table:@"ChatKit"];
  }

  v19 = MEMORY[0x1E69E9820];
  v20 = 3221225472;
  v21 = __124__CKChatController_Collaboration___addDefaultButtonToSharingErrorAlertController_sharingURL_defaultButtonAction_completion___block_invoke;
  v22 = &unk_1E72F3D00;
  v23 = lCopy;
  selfCopy = self;
  v25 = completionCopy;
  actionCopy = action;
  v16 = completionCopy;
  v17 = lCopy;
  v18 = [CKAlertAction actionWithTitle:v15 style:0 handler:&v19];
  [controllerCopy addAction:{v18, v19, v20, v21, v22}];
}

void __124__CKChatController_Collaboration___addDefaultButtonToSharingErrorAlertController_sharingURL_defaultButtonAction_completion___block_invoke(uint64_t a1, void *a2)
{
  v31 = *MEMORY[0x1E69E9840];
  v3 = a2;
  v4 = 0;
  v5 = *(a1 + 56);
  if (v5 <= 2)
  {
    if (v5 == 1)
    {
      v12 = [MEMORY[0x1E6963608] defaultWorkspace];
      v13 = [MEMORY[0x1E695DFF8] URLWithString:@"prefs:root=APPLE_ACCOUNT&path=APPLE_ACCOUNT_CONTACT"];
      v28 = 0;
      [v12 openSensitiveURL:v13 withOptions:0 error:&v28];
      v7 = v28;

      v14 = IMLogHandleForCategory();
      v9 = v14;
      if (v7)
      {
        if (os_log_type_enabled(v14, OS_LOG_TYPE_ERROR))
        {
          __124__CKChatController_Collaboration___addDefaultButtonToSharingErrorAlertController_sharingURL_defaultButtonAction_completion___block_invoke_cold_1();
        }
      }

      else if (os_log_type_enabled(v14, OS_LOG_TYPE_INFO))
      {
        *buf = 0;
        _os_log_impl(&dword_19020E000, v9, OS_LOG_TYPE_INFO, "Opened user apple account settings page ok", buf, 2u);
      }
    }

    else
    {
      if (v5 != 2)
      {
        goto LABEL_24;
      }

      v6 = [MEMORY[0x1E69A8288] sharedManager];
      v7 = [v6 appStoreURLFromSharingURL:*(a1 + 32)];

      if (v7)
      {
        v8 = [MEMORY[0x1E6963608] defaultWorkspace];
        v27 = 0;
        [v8 openSensitiveURL:v7 withOptions:0 error:&v27];
        v9 = v27;

        v10 = IMLogHandleForCategory();
        v11 = v10;
        if (v9)
        {
          if (os_log_type_enabled(v10, OS_LOG_TYPE_ERROR))
          {
            __124__CKChatController_Collaboration___addDefaultButtonToSharingErrorAlertController_sharingURL_defaultButtonAction_completion___block_invoke_cold_2();
          }
        }

        else if (os_log_type_enabled(v10, OS_LOG_TYPE_INFO))
        {
          *buf = 0;
          _os_log_impl(&dword_19020E000, v11, OS_LOG_TYPE_INFO, "Opened App Store updates page ok", buf, 2u);
        }
      }

      else
      {
        v9 = IMLogHandleForCategory();
        if (os_log_type_enabled(v9, OS_LOG_TYPE_ERROR))
        {
          __124__CKChatController_Collaboration___addDefaultButtonToSharingErrorAlertController_sharingURL_defaultButtonAction_completion___block_invoke_cold_3(a1 + 32, v9, v15, v16, v17, v18, v19, v20);
        }
      }
    }

    v4 = 0;
  }

  else if (v5 == 5)
  {
    v4 = 3;
  }

  else if (v5 == 4)
  {
    v4 = 2;
  }

  else
  {
    v4 = v5 == 3;
  }

LABEL_24:
  v21 = [*(a1 + 40) entryView];
  [v21 configureForDisplayMode:1];

  v22 = [*(a1 + 40) entryView];
  v23 = [v22 sendButton];
  [v23 setEnabled:1];

  v24 = [*(a1 + 40) entryView];
  [v24 updateEntryView];

  v25 = IMLogHandleForCategory();
  if (os_log_type_enabled(v25, OS_LOG_TYPE_INFO))
  {
    *buf = 134217984;
    v30 = v4;
    _os_log_impl(&dword_19020E000, v25, OS_LOG_TYPE_INFO, "User tapped default alert button, action: %ld", buf, 0xCu);
  }

  v26 = *(a1 + 48);
  if (v26)
  {
    (*(v26 + 16))(v26, v4);
  }
}

- (id)shareMetadataWithDugongTokensForCKShare:(id)share shareURL:(id)l
{
  v29 = *MEMORY[0x1E69E9840];
  shareCopy = share;
  v22 = objc_alloc_init(MEMORY[0x1E695DF90]);
  v24 = 0u;
  v25 = 0u;
  v26 = 0u;
  v27 = 0u;
  obj = [shareCopy participants];
  v4 = [obj countByEnumeratingWithState:&v24 objects:v28 count:16];
  if (v4)
  {
    v5 = v4;
    v6 = *v25;
    do
    {
      for (i = 0; i != v5; ++i)
      {
        if (*v25 != v6)
        {
          objc_enumerationMutation(obj);
        }

        v8 = *(*(&v24 + 1) + 8 * i);
        userIdentity = [v8 userIdentity];
        lookupInfo = [userIdentity lookupInfo];
        phoneNumber = [lookupInfo phoneNumber];
        v12 = phoneNumber;
        if (phoneNumber)
        {
          emailAddress = phoneNumber;
        }

        else
        {
          userIdentity2 = [v8 userIdentity];
          lookupInfo2 = [userIdentity2 lookupInfo];
          emailAddress = [lookupInfo2 emailAddress];
        }

        invitationToken = [v8 invitationToken];
        v17 = invitationToken;
        if (emailAddress)
        {
          v18 = invitationToken == 0;
        }

        else
        {
          v18 = 1;
        }

        if (!v18)
        {
          if (MEMORY[0x193AF5D40](emailAddress))
          {
            v19 = IMCanonicalizeFormattedString();

            emailAddress = v19;
          }

          [v22 setObject:v17 forKey:emailAddress];
        }
      }

      v5 = [obj countByEnumeratingWithState:&v24 objects:v28 count:16];
    }

    while (v5);
  }

  return v22;
}

- (void)addParticipant:(id)participant toCollaboration:(id)collaboration forChatGUID:(id)d containerSetupInfo:(id)info completionHandler:(id)handler
{
  participantCopy = participant;
  collaborationCopy = collaboration;
  dCopy = d;
  infoCopy = info;
  handlerCopy = handler;
  v22[0] = MEMORY[0x1E69E9820];
  v22[1] = 3221225472;
  v22[2] = __120__CKChatController_GroupCollaboration__addParticipant_toCollaboration_forChatGUID_containerSetupInfo_completionHandler___block_invoke;
  v22[3] = &unk_1E72F3D28;
  v22[4] = self;
  v23 = participantCopy;
  v24 = collaborationCopy;
  v25 = infoCopy;
  v26 = dCopy;
  v27 = handlerCopy;
  v17 = dCopy;
  v18 = handlerCopy;
  v19 = infoCopy;
  v20 = collaborationCopy;
  v21 = participantCopy;
  [(CKChatController *)self _isShareBearURL:v20 completionHandler:v22];
}

uint64_t __120__CKChatController_GroupCollaboration__addParticipant_toCollaboration_forChatGUID_containerSetupInfo_completionHandler___block_invoke(void *a1, int a2)
{
  v3 = a1[4];
  v4 = a1[5];
  v5 = a1[6];
  v6 = a1[9];
  if (a2)
  {
    return [v3 _addParticipant:v4 toShareBearURL:v5 containerSetupInfo:a1[7] completionHandler:v6];
  }

  else
  {
    return [v3 _addParticipant:v4 toShareURL:v5 forChatGUID:a1[8] completionHandler:v6];
  }
}

- (void)removeParticipant:(id)participant fromCollaboration:(id)collaboration forChatGUID:(id)d containerSetupInfo:(id)info completionHandler:(id)handler
{
  participantCopy = participant;
  collaborationCopy = collaboration;
  dCopy = d;
  infoCopy = info;
  handlerCopy = handler;
  v22[0] = MEMORY[0x1E69E9820];
  v22[1] = 3221225472;
  v22[2] = __125__CKChatController_GroupCollaboration__removeParticipant_fromCollaboration_forChatGUID_containerSetupInfo_completionHandler___block_invoke;
  v22[3] = &unk_1E72F3D28;
  v22[4] = self;
  v23 = participantCopy;
  v24 = collaborationCopy;
  v25 = infoCopy;
  v26 = dCopy;
  v27 = handlerCopy;
  v17 = dCopy;
  v18 = handlerCopy;
  v19 = infoCopy;
  v20 = collaborationCopy;
  v21 = participantCopy;
  [(CKChatController *)self _isShareBearURL:v20 completionHandler:v22];
}

uint64_t __125__CKChatController_GroupCollaboration__removeParticipant_fromCollaboration_forChatGUID_containerSetupInfo_completionHandler___block_invoke(void *a1, int a2)
{
  v3 = a1[4];
  v4 = a1[5];
  v5 = a1[6];
  v6 = a1[9];
  if (a2)
  {
    return [v3 _removeParticipant:v4 fromShareBearURL:v5 containerSetupInfo:a1[7] completionHandler:v6];
  }

  else
  {
    return [v3 _removeParticipant:v4 fromShareURL:v5 forChatGUID:a1[8] completionHandler:v6];
  }
}

- (void)_addParticipant:(id)participant toShareBearURL:(id)l containerSetupInfo:(id)info completionHandler:(id)handler
{
  participantCopy = participant;
  lCopy = l;
  infoCopy = info;
  handlerCopy = handler;
  cKCloudSharingClass = [(CKChatController *)self CKCloudSharingClass];
  if (objc_opt_respondsToSelector())
  {
    v15[0] = MEMORY[0x1E69E9820];
    v15[1] = 3221225472;
    v15[2] = __108__CKChatController_GroupCollaboration___addParticipant_toShareBearURL_containerSetupInfo_completionHandler___block_invoke;
    v15[3] = &unk_1E72F3D50;
    v20 = handlerCopy;
    v16 = lCopy;
    selfCopy = self;
    v18 = participantCopy;
    v19 = infoCopy;
    [(objc_class *)cKCloudSharingClass ckMetadataFromShareURL:v16 containerSetupInfo:v19 completionHandler:v15];
  }
}

void __108__CKChatController_GroupCollaboration___addParticipant_toShareBearURL_containerSetupInfo_completionHandler___block_invoke(void *a1, void *a2, void *a3)
{
  v15 = *MEMORY[0x1E69E9840];
  v5 = a2;
  v6 = a3;
  if (v6 || ([v5 share], v8 = objc_claimAutoreleasedReturnValue(), v8, !v8))
  {
    v7 = IMLogHandleForCategory();
    if (os_log_type_enabled(v7, OS_LOG_TYPE_ERROR))
    {
      __108__CKChatController_GroupCollaboration___addParticipant_toShareBearURL_containerSetupInfo_completionHandler___block_invoke_cold_1();
    }

    (*(a1[8] + 16))();
  }

  else
  {
    v9 = IMLogHandleForCategory();
    if (os_log_type_enabled(v9, OS_LOG_TYPE_INFO))
    {
      v10 = a1[4];
      v13 = 138412290;
      v14 = v10;
      _os_log_impl(&dword_19020E000, v9, OS_LOG_TYPE_INFO, "Fetching share for URL: %@", &v13, 0xCu);
    }

    v11 = a1[5];
    v12 = [v5 share];
    [v11 _addParticipantToShare:v12 withHandle:a1[6] toCollaboration:a1[4] containerSetupInfo:a1[7] completionHandler:a1[8]];
  }
}

- (void)_addParticipantToShare:(id)share withHandle:(id)handle toCollaboration:(id)collaboration containerSetupInfo:(id)info completionHandler:(id)handler
{
  v63 = *MEMORY[0x1E69E9840];
  shareCopy = share;
  handleCopy = handle;
  collaborationCopy = collaboration;
  infoCopy = info;
  handlerCopy = handler;
  v15 = objc_alloc_init(MEMORY[0x1E695DF70]);
  v16 = objc_alloc_init(MEMORY[0x1E695DF70]);
  mEMORY[0x1E69A7FD0] = [MEMORY[0x1E69A7FD0] sharedInstance];
  v18 = [mEMORY[0x1E69A7FD0] fetchCNContactForHandleWithID:handleCopy];

  if (v18)
  {
    v42 = handlerCopy;
    v43 = collaborationCopy;
    v44 = handleCopy;
    v45 = shareCopy;
    v59 = 0u;
    v60 = 0u;
    v57 = 0u;
    v58 = 0u;
    phoneNumbers = [v18 phoneNumbers];
    v20 = [phoneNumbers countByEnumeratingWithState:&v57 objects:v62 count:16];
    if (v20)
    {
      v21 = v20;
      v22 = *v58;
      do
      {
        v23 = 0;
        do
        {
          if (*v58 != v22)
          {
            objc_enumerationMutation(phoneNumbers);
          }

          value = [*(*(&v57 + 1) + 8 * v23) value];
          stringValue = [value stringValue];
          v26 = IMNormalizeFormattedString();

          [v15 addObject:v26];
          ++v23;
        }

        while (v21 != v23);
        v21 = [phoneNumbers countByEnumeratingWithState:&v57 objects:v62 count:16];
      }

      while (v21);
    }

    v55 = 0u;
    v56 = 0u;
    v53 = 0u;
    v54 = 0u;
    emailAddresses = [v18 emailAddresses];
    v28 = [emailAddresses countByEnumeratingWithState:&v53 objects:v61 count:16];
    shareCopy = v45;
    if (v28)
    {
      v29 = v28;
      v30 = *v54;
      do
      {
        v31 = 0;
        do
        {
          if (*v54 != v30)
          {
            objc_enumerationMutation(emailAddresses);
          }

          value2 = [*(*(&v53 + 1) + 8 * v31) value];
          v33 = IMNormalizeFormattedString();

          [v16 addObject:v33];
          ++v31;
        }

        while (v29 != v31);
        v29 = [emailAddresses countByEnumeratingWithState:&v53 objects:v61 count:16];
      }

      while (v29);
    }

    collaborationCopy = v43;
    handleCopy = v44;
    handlerCopy = v42;
  }

  if (![v15 count] && !objc_msgSend(v16, "count"))
  {
    v34 = IMNormalizeFormattedString();
    IsEmail = IMStringIsEmail();

    if (IsEmail)
    {
      v36 = v16;
    }

    else
    {
      v36 = v15;
    }

    [v36 addObject:handleCopy];
  }

  cKCloudSharingClass = [(CKChatController *)self CKCloudSharingClass];
  v48[0] = MEMORY[0x1E69E9820];
  v48[1] = 3221225472;
  v48[2] = __127__CKChatController_GroupCollaboration___addParticipantToShare_withHandle_toCollaboration_containerSetupInfo_completionHandler___block_invoke;
  v48[3] = &unk_1E72EDC70;
  v49 = collaborationCopy;
  v50 = v16;
  v51 = v15;
  v52 = handlerCopy;
  v38 = handlerCopy;
  v39 = v15;
  v40 = v16;
  v41 = collaborationCopy;
  [(objc_class *)cKCloudSharingClass addParticipantsToShare:shareCopy containerSetupInfo:infoCopy emailAddresses:v40 phoneNumbers:v39 completionHandler:v48];
}

void __127__CKChatController_GroupCollaboration___addParticipantToShare_withHandle_toCollaboration_containerSetupInfo_completionHandler___block_invoke(uint64_t a1, void *a2, void *a3, void *a4)
{
  v16 = *MEMORY[0x1E69E9840];
  v7 = a2;
  v8 = a3;
  v9 = a4;
  if (!v7 || !v8)
  {
    v10 = IMLogHandleForCategory();
    if (os_log_type_enabled(v10, OS_LOG_TYPE_ERROR))
    {
      __127__CKChatController_GroupCollaboration___addParticipantToShare_withHandle_toCollaboration_containerSetupInfo_completionHandler___block_invoke_cold_1();
    }
  }

  v11 = IMLogHandleForCategory();
  v12 = v11;
  if (v9)
  {
    if (os_log_type_enabled(v11, OS_LOG_TYPE_ERROR))
    {
      __127__CKChatController_GroupCollaboration___addParticipantToShare_withHandle_toCollaboration_containerSetupInfo_completionHandler___block_invoke_cold_2();
    }

    v12 = IMLogHandleForCategory();
    if (os_log_type_enabled(v12, OS_LOG_TYPE_ERROR))
    {
      __127__CKChatController_GroupCollaboration___addParticipantToShare_withHandle_toCollaboration_containerSetupInfo_completionHandler___block_invoke_cold_3();
    }
  }

  else if (os_log_type_enabled(v11, OS_LOG_TYPE_INFO))
  {
    v13 = *(a1 + 32);
    v14 = 138412290;
    v15 = v13;
    _os_log_impl(&dword_19020E000, v12, OS_LOG_TYPE_INFO, "Successfully added participant to share: %@", &v14, 0xCu);
  }

  (*(*(a1 + 56) + 16))();
}

- (void)_removeParticipant:(id)participant fromShareBearURL:(id)l containerSetupInfo:(id)info completionHandler:(id)handler
{
  v53 = *MEMORY[0x1E69E9840];
  participantCopy = participant;
  lCopy = l;
  infoCopy = info;
  handlerCopy = handler;
  v14 = objc_alloc_init(MEMORY[0x1E695DF70]);
  mEMORY[0x1E69A7FD0] = [MEMORY[0x1E69A7FD0] sharedInstance];
  v16 = [mEMORY[0x1E69A7FD0] fetchCNContactForHandleWithID:participantCopy];

  if (v16)
  {
    selfCopy = self;
    v34 = handlerCopy;
    v35 = infoCopy;
    v36 = lCopy;
    v49 = 0u;
    v50 = 0u;
    v47 = 0u;
    v48 = 0u;
    phoneNumbers = [v16 phoneNumbers];
    v18 = [phoneNumbers countByEnumeratingWithState:&v47 objects:v52 count:16];
    if (v18)
    {
      v19 = v18;
      v20 = *v48;
      do
      {
        v21 = 0;
        do
        {
          if (*v48 != v20)
          {
            objc_enumerationMutation(phoneNumbers);
          }

          value = [*(*(&v47 + 1) + 8 * v21) value];
          stringValue = [value stringValue];
          v24 = IMNormalizeFormattedString();

          [v14 addObject:v24];
          ++v21;
        }

        while (v19 != v21);
        v19 = [phoneNumbers countByEnumeratingWithState:&v47 objects:v52 count:16];
      }

      while (v19);
    }

    v45 = 0u;
    v46 = 0u;
    v43 = 0u;
    v44 = 0u;
    emailAddresses = [v16 emailAddresses];
    v26 = [emailAddresses countByEnumeratingWithState:&v43 objects:v51 count:16];
    if (v26)
    {
      v27 = v26;
      v28 = *v44;
      do
      {
        v29 = 0;
        do
        {
          if (*v44 != v28)
          {
            objc_enumerationMutation(emailAddresses);
          }

          value2 = [*(*(&v43 + 1) + 8 * v29) value];
          v31 = IMNormalizeFormattedString();

          [v14 addObject:v31];
          ++v29;
        }

        while (v27 != v29);
        v27 = [emailAddresses countByEnumeratingWithState:&v43 objects:v51 count:16];
      }

      while (v27);
    }

    infoCopy = v35;
    lCopy = v36;
    self = selfCopy;
    handlerCopy = v34;
  }

  if (![v14 count])
  {
    [v14 addObject:participantCopy];
  }

  cKCloudSharingClass = [(CKChatController *)self CKCloudSharingClass];
  if (objc_opt_respondsToSelector())
  {
    v37[0] = MEMORY[0x1E69E9820];
    v37[1] = 3221225472;
    v37[2] = __113__CKChatController_GroupCollaboration___removeParticipant_fromShareBearURL_containerSetupInfo_completionHandler___block_invoke;
    v37[3] = &unk_1E72F3D50;
    v42 = handlerCopy;
    v38 = participantCopy;
    v39 = v14;
    selfCopy2 = self;
    v41 = infoCopy;
    [(objc_class *)cKCloudSharingClass ckMetadataFromShareURL:lCopy containerSetupInfo:v41 completionHandler:v37];
  }
}

void __113__CKChatController_GroupCollaboration___removeParticipant_fromShareBearURL_containerSetupInfo_completionHandler___block_invoke(uint64_t a1, void *a2, void *a3)
{
  v51 = *MEMORY[0x1E69E9840];
  v5 = a2;
  v6 = a3;
  v7 = IMLogHandleForCategory();
  v8 = v7;
  if (!v5 || v6)
  {
    if (os_log_type_enabled(v7, OS_LOG_TYPE_ERROR))
    {
      __108__CKChatController_GroupCollaboration___addParticipant_toShareBearURL_containerSetupInfo_completionHandler___block_invoke_cold_1();
    }

    (*(*(a1 + 64) + 16))();
  }

  else
  {
    if (os_log_type_enabled(v7, OS_LOG_TYPE_INFO))
    {
      v9 = *(a1 + 32);
      *buf = 138412290;
      v50 = v9;
      _os_log_impl(&dword_19020E000, v8, OS_LOG_TYPE_INFO, "Removing participant: %@ from share", buf, 0xCu);
    }

    v10 = [v5 share];
    [v10 participants];
    v43 = 0u;
    v44 = 0u;
    v45 = 0u;
    v11 = v46 = 0u;
    v36 = [v11 countByEnumeratingWithState:&v43 objects:v48 count:16];
    if (v36)
    {
      v12 = *v44;
      v35 = v5;
      v37 = v11;
      v38 = a1;
      v33 = *v44;
      v34 = v10;
      do
      {
        v13 = 0;
        do
        {
          if (*v44 != v12)
          {
            objc_enumerationMutation(v11);
          }

          v14 = *(*(&v43 + 1) + 8 * v13);
          v15 = [v14 userIdentity];
          v16 = [v15 lookupInfo];
          v17 = [v16 phoneNumber];
          v18 = v17;
          if (v17)
          {
            v19 = v17;
          }

          else
          {
            v20 = [v14 userIdentity];
            v21 = [v20 lookupInfo];
            v19 = [v21 emailAddress];
          }

          v41 = 0u;
          v42 = 0u;
          v39 = 0u;
          v40 = 0u;
          v22 = *(a1 + 40);
          v23 = [v22 countByEnumeratingWithState:&v39 objects:v47 count:16];
          if (v23)
          {
            v24 = v23;
            v25 = *v40;
            while (2)
            {
              for (i = 0; i != v24; ++i)
              {
                if (*v40 != v25)
                {
                  objc_enumerationMutation(v22);
                }

                v27 = *(*(&v39 + 1) + 8 * i);
                v28 = [v19 lowercaseString];
                v29 = [v27 lowercaseString];
                v30 = [v28 isEqualToString:v29];

                if (v30)
                {
                  v10 = v34;
                  [v34 removeParticipant:v14];

                  v11 = v37;
                  [*(v38 + 48) _updateShare:v34 containerSetupInfo:*(v38 + 56) completionHandler:*(v38 + 64)];
                  v6 = 0;
                  v5 = v35;
                  goto LABEL_30;
                }
              }

              v24 = [v22 countByEnumeratingWithState:&v39 objects:v47 count:16];
              if (v24)
              {
                continue;
              }

              break;
            }
          }

          ++v13;
          v11 = v37;
          a1 = v38;
          v12 = v33;
        }

        while (v13 != v36);
        v6 = 0;
        v5 = v35;
        v10 = v34;
        v36 = [v37 countByEnumeratingWithState:&v43 objects:v48 count:16];
      }

      while (v36);
    }

    v31 = IMLogHandleForCategory();
    if (os_log_type_enabled(v31, OS_LOG_TYPE_INFO))
    {
      v32 = *(a1 + 32);
      *buf = 138412290;
      v50 = v32;
      _os_log_impl(&dword_19020E000, v31, OS_LOG_TYPE_INFO, "Participant: %@ is already removed from the share", buf, 0xCu);
    }

    (*(*(a1 + 64) + 16))();
LABEL_30:
  }
}

- (void)_addParticipant:(id)participant toShareURL:(id)l forChatGUID:(id)d completionHandler:(id)handler
{
  participantCopy = participant;
  lCopy = l;
  handlerCopy = handler;
  aBlock[0] = MEMORY[0x1E69E9820];
  aBlock[1] = 3221225472;
  aBlock[2] = __97__CKChatController_GroupCollaboration___addParticipant_toShareURL_forChatGUID_completionHandler___block_invoke;
  aBlock[3] = &unk_1E72F3D78;
  v13 = handlerCopy;
  v27 = v13;
  dCopy = d;
  v15 = _Block_copy(aBlock);
  v20[0] = MEMORY[0x1E69E9820];
  v20[1] = 3221225472;
  v20[2] = __97__CKChatController_GroupCollaboration___addParticipant_toShareURL_forChatGUID_completionHandler___block_invoke_289;
  v20[3] = &unk_1E72F3DC8;
  v25 = 0;
  v21 = participantCopy;
  v22 = lCopy;
  v23 = v13;
  v24 = v15;
  v16 = v15;
  v17 = lCopy;
  v18 = participantCopy;
  v19 = v13;
  [(CKChatController *)self _collaborationMetadataForURL:v17 forChatGUID:dCopy completionHandler:v20];
}

void __97__CKChatController_GroupCollaboration___addParticipant_toShareURL_forChatGUID_completionHandler___block_invoke(uint64_t a1, void *a2, void *a3)
{
  v5 = a2;
  v6 = a3;
  v7 = IMLogHandleForCategory();
  v8 = v7;
  if (!v5 || v6)
  {
    if (os_log_type_enabled(v7, OS_LOG_TYPE_ERROR))
    {
      __97__CKChatController_GroupCollaboration___addParticipant_toShareURL_forChatGUID_completionHandler___block_invoke_cold_1();
    }

    v9 = *(*(a1 + 32) + 16);
  }

  else
  {
    if (os_log_type_enabled(v7, OS_LOG_TYPE_INFO))
    {
      *v10 = 0;
      _os_log_impl(&dword_19020E000, v8, OS_LOG_TYPE_INFO, "Added to Collaboration", v10, 2u);
    }

    v9 = *(*(a1 + 32) + 16);
  }

  v9();
}

void __97__CKChatController_GroupCollaboration___addParticipant_toShareURL_forChatGUID_completionHandler___block_invoke_289(uint64_t a1, void *a2)
{
  v20[1] = *MEMORY[0x1E69E9840];
  v3 = a2;
  if (v3)
  {
    v4 = objc_alloc(MEMORY[0x1E695DFD8]);
    v20[0] = *(a1 + 32);
    v5 = [MEMORY[0x1E695DEC8] arrayWithObjects:v20 count:1];
    v6 = [v4 initWithArray:v5];

    v7 = objc_alloc(MEMORY[0x1E69D37C0]);
    v8 = MEMORY[0x1E69E96A0];
    v9 = [v7 initWithTargetSerialQueue:MEMORY[0x1E69E96A0] synchronous:0];
    v13[0] = MEMORY[0x1E69E9820];
    v13[1] = 3221225472;
    v13[2] = __97__CKChatController_GroupCollaboration___addParticipant_toShareURL_forChatGUID_completionHandler___block_invoke_293;
    v13[3] = &unk_1E72F3DA0;
    v19 = *(a1 + 64);
    v14 = v9;
    v15 = v6;
    v16 = *(a1 + 40);
    v17 = v3;
    v18 = *(a1 + 56);
    v10 = v6;
    v11 = v9;
    dispatch_async(v8, v13);
  }

  else
  {
    v12 = IMLogHandleForCategory();
    if (os_log_type_enabled(v12, OS_LOG_TYPE_ERROR))
    {
      __97__CKChatController_GroupCollaboration___addParticipant_toShareURL_forChatGUID_completionHandler___block_invoke_289_cold_1();
    }

    (*(*(a1 + 48) + 16))();
  }
}

uint64_t __97__CKChatController_GroupCollaboration___addParticipant_toShareURL_forChatGUID_completionHandler___block_invoke_293(uint64_t a1)
{
  v2 = *(a1 + 72);
  v3 = IMLogHandleForCategory();
  v4 = os_log_type_enabled(v3, OS_LOG_TYPE_INFO);
  if (v2 == 1)
  {
    if (v4)
    {
      *buf = 0;
      _os_log_impl(&dword_19020E000, v3, OS_LOG_TYPE_INFO, "Add Handshake: Using the URL to add participant", buf, 2u);
    }

    return [*(a1 + 32) addParticipantHandles:*(a1 + 40) withFileURL:*(a1 + 48) metadata:*(a1 + 56) timeout:*(a1 + 64) completion:10.0];
  }

  else
  {
    if (v4)
    {
      *v6 = 0;
      _os_log_impl(&dword_19020E000, v3, OS_LOG_TYPE_INFO, "Add Handshake: Using metadata to add participant", v6, 2u);
    }

    return [*(a1 + 32) addParticipantHandles:*(a1 + 40) withMetadata:*(a1 + 56) timeout:*(a1 + 64) completion:10.0];
  }
}

- (void)_removeParticipant:(id)participant fromShareURL:(id)l forChatGUID:(id)d completionHandler:(id)handler
{
  participantCopy = participant;
  lCopy = l;
  dCopy = d;
  handlerCopy = handler;
  v18[0] = MEMORY[0x1E69E9820];
  v18[1] = 3221225472;
  v18[2] = __102__CKChatController_GroupCollaboration___removeParticipant_fromShareURL_forChatGUID_completionHandler___block_invoke;
  v18[3] = &unk_1E72F3E18;
  v18[4] = self;
  v19 = dCopy;
  v21 = lCopy;
  v22 = handlerCopy;
  v23 = 0;
  v20 = participantCopy;
  v14 = lCopy;
  v15 = participantCopy;
  v16 = handlerCopy;
  v17 = dCopy;
  [(CKChatController *)self _highlightForShareURL:v14 completionHandler:v18];
}

void __102__CKChatController_GroupCollaboration___removeParticipant_fromShareURL_forChatGUID_completionHandler___block_invoke(uint64_t a1, uint64_t a2)
{
  v42[1] = *MEMORY[0x1E69E9840];
  v3 = [*(a1 + 32) _attributionFromHighlight:a2 forChatGUID:*(a1 + 40)];
  v4 = [v3 uniqueIdentifier];
  v5 = [v3 collaborationMetadata];
  aBlock[0] = MEMORY[0x1E69E9820];
  aBlock[1] = 3221225472;
  aBlock[2] = __102__CKChatController_GroupCollaboration___removeParticipant_fromShareURL_forChatGUID_completionHandler___block_invoke_2;
  aBlock[3] = &unk_1E72F3DF0;
  v6 = v4;
  v38 = v6;
  v41 = *(a1 + 64);
  v39 = *(a1 + 48);
  v40 = *(a1 + 40);
  v7 = _Block_copy(aBlock);
  if (v5)
  {
    v8 = [v5 handleToIdentityMap];
    v9 = v8;
    if (v8)
    {
      v10 = [v8 objectForKeyedSubscript:*(a1 + 48)];
      v11 = v10;
      if (v10)
      {
        v12 = MEMORY[0x1E695DFD8];
        v42[0] = v10;
        v13 = [MEMORY[0x1E695DEC8] arrayWithObjects:v42 count:1];
        v14 = [v12 setWithArray:v13];

        v15 = objc_alloc(MEMORY[0x1E69D37C0]);
        v16 = MEMORY[0x1E69E96A0];
        v17 = [v15 initWithTargetSerialQueue:MEMORY[0x1E69E96A0] synchronous:0];
        block[0] = MEMORY[0x1E69E9820];
        block[1] = 3221225472;
        block[2] = __102__CKChatController_GroupCollaboration___removeParticipant_fromShareURL_forChatGUID_completionHandler___block_invoke_296;
        block[3] = &unk_1E72F3DA0;
        v36 = *(a1 + 72);
        v31 = v17;
        v32 = v14;
        v33 = *(a1 + 56);
        v34 = v5;
        v35 = v7;
        v18 = v14;
        v19 = v17;
        dispatch_async(v16, block);
      }

      else
      {
        v22 = IMLogHandleForCategory();
        if (os_log_type_enabled(v22, OS_LOG_TYPE_ERROR))
        {
          __102__CKChatController_GroupCollaboration___removeParticipant_fromShareURL_forChatGUID_completionHandler___block_invoke_cold_1(v22, v23, v24, v25, v26, v27, v28, v29);
        }

        (*(*(a1 + 64) + 16))();
      }
    }

    else
    {
      v21 = IMLogHandleForCategory();
      if (os_log_type_enabled(v21, OS_LOG_TYPE_ERROR))
      {
        __102__CKChatController_GroupCollaboration___removeParticipant_fromShareURL_forChatGUID_completionHandler___block_invoke_cold_2();
      }

      (*(*(a1 + 64) + 16))();
    }
  }

  else
  {
    v20 = IMLogHandleForCategory();
    if (os_log_type_enabled(v20, OS_LOG_TYPE_ERROR))
    {
      __102__CKChatController_GroupCollaboration___removeParticipant_fromShareURL_forChatGUID_completionHandler___block_invoke_cold_3();
    }

    (*(*(a1 + 64) + 16))();
  }
}

void __102__CKChatController_GroupCollaboration___removeParticipant_fromShareURL_forChatGUID_completionHandler___block_invoke_2(void *a1, void *a2, void *a3)
{
  v15 = *MEMORY[0x1E69E9840];
  v5 = a2;
  v6 = a3;
  v7 = v6;
  if (v5 && !v6 && a1[4])
  {
    v8 = IMLogHandleForCategory();
    if (os_log_type_enabled(v8, OS_LOG_TYPE_INFO))
    {
      v9 = a1[5];
      v13 = 138412290;
      v14 = v9;
      _os_log_impl(&dword_19020E000, v8, OS_LOG_TYPE_INFO, "Removing %@ from Collaboration", &v13, 0xCu);
    }

    v10 = [MEMORY[0x1E69A5AF8] sharedRegistry];
    v11 = [v10 existingChatWithGUID:a1[6]];

    if (v11)
    {
      [v11 sendUpdatedCollaborationMetadata:v5 forMessageGUID:a1[4]];
    }

    (*(a1[7] + 16))();
  }

  else
  {
    v12 = IMLogHandleForCategory();
    if (os_log_type_enabled(v12, OS_LOG_TYPE_ERROR))
    {
      __102__CKChatController_GroupCollaboration___removeParticipant_fromShareURL_forChatGUID_completionHandler___block_invoke_2_cold_1();
    }

    (*(a1[7] + 16))();
  }
}

uint64_t __102__CKChatController_GroupCollaboration___removeParticipant_fromShareURL_forChatGUID_completionHandler___block_invoke_296(uint64_t a1)
{
  v2 = *(a1 + 72);
  v3 = IMLogHandleForCategory();
  v4 = os_log_type_enabled(v3, OS_LOG_TYPE_INFO);
  if (v2 == 1)
  {
    if (v4)
    {
      *buf = 0;
      _os_log_impl(&dword_19020E000, v3, OS_LOG_TYPE_INFO, "Remove Handshake: Using the URL to remove participant", buf, 2u);
    }

    return [*(a1 + 32) removeParticipantIdentities:*(a1 + 40) withFileURL:*(a1 + 48) metadata:*(a1 + 56) timeout:*(a1 + 64) completion:10.0];
  }

  else
  {
    if (v4)
    {
      *v6 = 0;
      _os_log_impl(&dword_19020E000, v3, OS_LOG_TYPE_INFO, "Remove Handshake: Using metadata to remove participant", v6, 2u);
    }

    return [*(a1 + 32) removeParticipantIdentities:*(a1 + 40) withMetadata:*(a1 + 56) timeout:*(a1 + 64) completion:10.0];
  }
}

- (Class)CKCloudSharingClass
{
  if (CKCloudSharingClass_onceToken != -1)
  {
    [CKChatController(GroupCollaboration) CKCloudSharingClass];
  }

  v3 = CKCloudSharingClass_CKCloudSharingClass;

  return v3;
}

uint64_t __59__CKChatController_GroupCollaboration__CKCloudSharingClass__block_invoke()
{
  result = MEMORY[0x193AF5EC0](@"CSCloudSharing", @"CloudSharing");
  CKCloudSharingClass_CKCloudSharingClass = result;
  return result;
}

- (void)_updateShare:(id)share containerSetupInfo:(id)info completionHandler:(id)handler
{
  shareCopy = share;
  infoCopy = info;
  handlerCopy = handler;
  cKCloudSharingClass = [(CKChatController *)self CKCloudSharingClass];
  if (objc_opt_respondsToSelector())
  {
    v12[0] = MEMORY[0x1E69E9820];
    v12[1] = 3221225472;
    v12[2] = __90__CKChatController_GroupCollaboration___updateShare_containerSetupInfo_completionHandler___block_invoke;
    v12[3] = &unk_1E72F3E40;
    v13 = handlerCopy;
    [(objc_class *)cKCloudSharingClass updateShare:shareCopy containerSetupInfo:infoCopy completionHandler:v12];
  }
}

void __90__CKChatController_GroupCollaboration___updateShare_containerSetupInfo_completionHandler___block_invoke(uint64_t a1, void *a2, void *a3, void *a4)
{
  v21 = *MEMORY[0x1E69E9840];
  v7 = a2;
  v8 = a3;
  v9 = a4;
  v10 = v9;
  if (v8)
  {
    v11 = v9 == 0;
  }

  else
  {
    v11 = 0;
  }

  v12 = v11;
  v13 = IMLogHandleForCategory();
  v14 = v13;
  if (v12)
  {
    if (os_log_type_enabled(v13, OS_LOG_TYPE_INFO))
    {
      LOWORD(v15) = 0;
      _os_log_impl(&dword_19020E000, v14, OS_LOG_TYPE_INFO, "Successfully updated share", &v15, 2u);
    }
  }

  else if (os_log_type_enabled(v13, OS_LOG_TYPE_ERROR))
  {
    v15 = 138412802;
    v16 = v8;
    v17 = 2112;
    v18 = v7;
    v19 = 2112;
    v20 = v10;
    _os_log_error_impl(&dword_19020E000, v14, OS_LOG_TYPE_ERROR, "Error while updating CKShare: %@ for URL: %@ error: %@", &v15, 0x20u);
  }

  (*(*(a1 + 32) + 16))();
}

- (void)_highlightForShareURL:(id)l completionHandler:(id)handler
{
  lCopy = l;
  handlerCopy = handler;
  mEMORY[0x1E69A5C78] = [MEMORY[0x1E69A5C78] sharedController];
  v15 = 0;
  v8 = [mEMORY[0x1E69A5C78] collaborationHighlightForURL:lCopy error:&v15];
  v9 = v15;

  if (v9)
  {
    v10 = 1;
  }

  else
  {
    v10 = v8 == 0;
  }

  if (v10)
  {
    v11 = IMLogHandleForCategory();
    if (os_log_type_enabled(v11, OS_LOG_TYPE_ERROR))
    {
      [CKChatController(GroupCollaboration) _highlightForShareURL:completionHandler:];
    }

    handlerCopy[2](handlerCopy, 0);
  }

  else
  {
    mEMORY[0x1E69A5C78]2 = [MEMORY[0x1E69A5C78] sharedController];
    v13[0] = MEMORY[0x1E69E9820];
    v13[1] = 3221225472;
    v13[2] = __80__CKChatController_GroupCollaboration___highlightForShareURL_completionHandler___block_invoke;
    v13[3] = &unk_1E72F3E68;
    v14 = handlerCopy;
    [mEMORY[0x1E69A5C78]2 fetchAttributionsForHighlight:v8 completionHandler:v13];
  }
}

- (id)_attributionFromHighlight:(id)highlight forChatGUID:(id)d
{
  v30 = *MEMORY[0x1E69E9840];
  highlightCopy = highlight;
  dCopy = d;
  attributions = [highlightCopy attributions];
  v8 = [attributions count];

  if (v8)
  {
    v23 = 0u;
    v24 = 0u;
    v21 = 0u;
    v22 = 0u;
    attributions2 = [highlightCopy attributions];
    v10 = [attributions2 countByEnumeratingWithState:&v21 objects:v29 count:16];
    if (v10)
    {
      v11 = v10;
      v12 = *v22;
LABEL_4:
      v13 = 0;
      while (1)
      {
        if (*v22 != v12)
        {
          objc_enumerationMutation(attributions2);
        }

        v14 = *(*(&v21 + 1) + 8 * v13);
        conversationIdentifier = [v14 conversationIdentifier];
        v16 = [conversationIdentifier isEqualToString:dCopy];

        if (v16)
        {
          break;
        }

        if (v11 == ++v13)
        {
          v11 = [attributions2 countByEnumeratingWithState:&v21 objects:v29 count:16];
          if (v11)
          {
            goto LABEL_4;
          }

          goto LABEL_10;
        }
      }

      v17 = v14;
      v18 = IMLogHandleForCategory();
      if (os_log_type_enabled(v18, OS_LOG_TYPE_INFO))
      {
        *buf = 138412546;
        v26 = v17;
        v27 = 2112;
        v28 = highlightCopy;
        _os_log_impl(&dword_19020E000, v18, OS_LOG_TYPE_INFO, "Found matching attribution (%@) for highlight (%@)", buf, 0x16u);
      }

      if (v17)
      {
        goto LABEL_19;
      }
    }

    else
    {
LABEL_10:
    }

    v19 = IMLogHandleForCategory();
    if (os_log_type_enabled(v19, OS_LOG_TYPE_ERROR))
    {
      [CKChatController(GroupCollaboration) _attributionFromHighlight:forChatGUID:];
    }
  }

  else
  {
    v19 = IMLogHandleForCategory();
    if (os_log_type_enabled(v19, OS_LOG_TYPE_ERROR))
    {
      [CKChatController(GroupCollaboration) _attributionFromHighlight:forChatGUID:];
    }
  }

  v17 = 0;
LABEL_19:

  return v17;
}

- (void)_collaborationMetadataForURL:(id)l forChatGUID:(id)d completionHandler:(id)handler
{
  lCopy = l;
  dCopy = d;
  handlerCopy = handler;
  mEMORY[0x1E69A5C78] = [MEMORY[0x1E69A5C78] sharedController];
  v22 = 0;
  v11 = [mEMORY[0x1E69A5C78] collaborationHighlightForURL:lCopy error:&v22];
  v12 = v22;

  if (v12 || !v11)
  {
    v13 = IMLogHandleForCategory();
    if (os_log_type_enabled(v13, OS_LOG_TYPE_ERROR))
    {
      [CKChatController(GroupCollaboration) _highlightForShareURL:completionHandler:];
    }

    handlerCopy[2](handlerCopy, 0);
  }

  mEMORY[0x1E69A5C78]2 = [MEMORY[0x1E69A5C78] sharedController];
  v18[0] = MEMORY[0x1E69E9820];
  v18[1] = 3221225472;
  v18[2] = __99__CKChatController_GroupCollaboration___collaborationMetadataForURL_forChatGUID_completionHandler___block_invoke;
  v18[3] = &unk_1E72F3E90;
  v20 = dCopy;
  v21 = handlerCopy;
  v19 = lCopy;
  v15 = dCopy;
  v16 = handlerCopy;
  v17 = lCopy;
  [mEMORY[0x1E69A5C78]2 fetchAttributionsForHighlight:v11 completionHandler:v18];
}

void __99__CKChatController_GroupCollaboration___collaborationMetadataForURL_forChatGUID_completionHandler___block_invoke(void *a1, void *a2)
{
  v28 = *MEMORY[0x1E69E9840];
  v3 = a2;
  v4 = [v3 attributions];
  v5 = [v4 count];

  if (!v5)
  {
    v6 = IMLogHandleForCategory();
    if (os_log_type_enabled(v6, OS_LOG_TYPE_ERROR))
    {
      __99__CKChatController_GroupCollaboration___collaborationMetadataForURL_forChatGUID_completionHandler___block_invoke_cold_1();
    }

    (*(a1[6] + 16))();
  }

  v21 = 0u;
  v22 = 0u;
  v19 = 0u;
  v20 = 0u;
  v7 = [v3 attributions];
  v8 = [v7 countByEnumeratingWithState:&v19 objects:v27 count:16];
  if (v8)
  {
    v9 = v8;
    v10 = *v20;
LABEL_7:
    v11 = 0;
    while (1)
    {
      if (*v20 != v10)
      {
        objc_enumerationMutation(v7);
      }

      v12 = *(*(&v19 + 1) + 8 * v11);
      v13 = [v12 conversationIdentifier];
      v14 = [v13 isEqualToString:a1[5]];

      if (v14)
      {
        break;
      }

      if (v9 == ++v11)
      {
        v9 = [v7 countByEnumeratingWithState:&v19 objects:v27 count:16];
        if (v9)
        {
          goto LABEL_7;
        }

        goto LABEL_13;
      }
    }

    v15 = [v12 collaborationMetadata];
    v16 = IMLogHandleForCategory();
    if (os_log_type_enabled(v16, OS_LOG_TYPE_INFO))
    {
      v17 = a1[4];
      *buf = 138412546;
      v24 = v15;
      v25 = 2112;
      v26 = v17;
      _os_log_impl(&dword_19020E000, v16, OS_LOG_TYPE_INFO, "Found collaboration metadata (%@) for URL (%@)", buf, 0x16u);
    }

    if (v15)
    {
      goto LABEL_20;
    }
  }

  else
  {
LABEL_13:
  }

  v18 = IMLogHandleForCategory();
  if (os_log_type_enabled(v18, OS_LOG_TYPE_ERROR))
  {
    __99__CKChatController_GroupCollaboration___collaborationMetadataForURL_forChatGUID_completionHandler___block_invoke_cold_2();
  }

  (*(a1[6] + 16))();
  v15 = 0;
LABEL_20:
  (*(a1[6] + 16))();
}

- (void)_isShareBearURL:(id)l completionHandler:(id)handler
{
  lCopy = l;
  handlerCopy = handler;
  v7 = MEMORY[0x1E69635C0];
  v10[0] = MEMORY[0x1E69E9820];
  v10[1] = 3221225472;
  v10[2] = __74__CKChatController_GroupCollaboration___isShareBearURL_completionHandler___block_invoke;
  v10[3] = &unk_1E72F3EB8;
  v11 = lCopy;
  v12 = handlerCopy;
  v8 = handlerCopy;
  v9 = lCopy;
  [v7 getAppLinkWithURL:v9 completionHandler:v10];
}

void __74__CKChatController_GroupCollaboration___isShareBearURL_completionHandler___block_invoke(uint64_t a1, void *a2, void *a3)
{
  v5 = a2;
  v6 = a3;
  v7 = v6;
  if (!v5 || v6)
  {
    v8 = IMLogHandleForCategory();
    if (os_log_type_enabled(v8, OS_LOG_TYPE_ERROR))
    {
      __74__CKChatController_GroupCollaboration___isShareBearURL_completionHandler___block_invoke_cold_1();
    }
  }

  v9 = [v5 targetApplicationRecord];
  v10 = [v9 bundleIdentifier];

  LODWORD(v9) = [v10 isEqualToString:@"com.apple.CloudKit.ShareBear"];
  v11 = IMLogHandleForCategory();
  v12 = os_log_type_enabled(v11, OS_LOG_TYPE_INFO);
  if (v9)
  {
    if (v12)
    {
      v16 = 0;
      v13 = "ShareBear identifier: CloudKit or iCloud Drive app";
      v14 = &v16;
LABEL_11:
      _os_log_impl(&dword_19020E000, v11, OS_LOG_TYPE_INFO, v13, v14, 2u);
    }
  }

  else if (v12)
  {
    v15 = 0;
    v13 = "Share URL is coming from a 3rd party app";
    v14 = &v15;
    goto LABEL_11;
  }

  (*(*(a1 + 40) + 16))(*(a1 + 40));
}

- (void)createCollaborationFailureAlertForNotice:(id)notice
{
  noticeCopy = notice;
  v5 = CKFrameworkBundle();
  v6 = [v5 localizedStringForKey:@"FAILED_COLLABORATION_UPDATE_ALERT_TITLE" value:&stru_1F04268F8 table:@"ChatKit"];

  if (!noticeCopy)
  {
    localizedName = 0;
    bundleIdentifier = 0;
    v16 = 0;
    goto LABEL_16;
  }

  notice = [noticeCopy notice];
  metadata = [notice metadata];
  contentTitle = [metadata contentTitle];

  notice2 = [noticeCopy notice];
  metadata2 = [notice2 metadata];
  bundleIdentifier = [metadata2 bundleIdentifier];

  v58 = 0;
  v13 = [MEMORY[0x1E6963620] bundleRecordWithBundleIdentifier:bundleIdentifier allowPlaceholder:0 error:&v58];
  v14 = v13;
  if (!v58)
  {
    v17 = v6;
    localizedName = [v13 localizedName];
    notice3 = [noticeCopy notice];
    metadata3 = [notice3 metadata];
    type = [metadata3 type];

    if (type == 8)
    {
      v21 = @"FAILED_COLLABORATION_ADD_UPDATE_ALERT_MESSAGE";
    }

    else
    {
      notice4 = [noticeCopy notice];
      metadata4 = [notice4 metadata];
      type2 = [metadata4 type];

      if (type2 != 9)
      {
        v16 = 0;
LABEL_14:
        v6 = v17;
        goto LABEL_15;
      }

      v21 = @"FAILED_COLLABORATION_REMOVE_UPDATE_ALERT_MESSAGE";
    }

    v25 = MEMORY[0x1E696AEC0];
    v26 = CKFrameworkBundle();
    v27 = [v26 localizedStringForKey:v21 value:&stru_1F04268F8 table:@"ChatKit"];
    v28 = [v25 stringWithFormat:v27, contentTitle, localizedName];

    mEMORY[0x1E69DC668] = [MEMORY[0x1E69DC668] sharedApplication];
    userInterfaceLayoutDirection = [mEMORY[0x1E69DC668] userInterfaceLayoutDirection];

    if (userInterfaceLayoutDirection == 1)
    {
      v31 = @"\u200F";
    }

    else
    {
      v31 = @"\u200E";
    }

    v16 = [(__CFString *)v31 stringByAppendingString:v28];

    goto LABEL_14;
  }

  localizedName = 0;
  v16 = 0;
LABEL_15:

LABEL_16:
  v32 = [CKAlertController alertControllerWithTitle:v6 message:v16 preferredStyle:1];
  v33 = 0x1E72E4000;
  selfCopy = self;
  if ([localizedName length])
  {
    v35 = MEMORY[0x1E696AEC0];
    v36 = CKFrameworkBundle();
    [v36 localizedStringForKey:@"FAILED_COLLABORATION_OPEN_IN_APP" value:&stru_1F04268F8 table:@"ChatKit"];
    v37 = v32;
    v38 = selfCopy;
    v39 = v16;
    v40 = noticeCopy;
    v41 = bundleIdentifier;
    v43 = v42 = v6;
    v44 = [v35 stringWithFormat:v43, localizedName];

    v6 = v42;
    bundleIdentifier = v41;
    noticeCopy = v40;
    v16 = v39;
    selfCopy = v38;
    v32 = v37;

    mEMORY[0x1E69DC668]2 = [MEMORY[0x1E69DC668] sharedApplication];
    userInterfaceLayoutDirection2 = [mEMORY[0x1E69DC668]2 userInterfaceLayoutDirection];

    v47 = userInterfaceLayoutDirection2 == 1;
    v33 = 0x1E72E4000uLL;
    if (v47)
    {
      v48 = @"\u200F";
    }

    else
    {
      v48 = @"\u200E";
    }

    v49 = [(__CFString *)v48 stringByAppendingString:v44];

    v55[0] = MEMORY[0x1E69E9820];
    v55[1] = 3221225472;
    v55[2] = __81__CKChatController_GroupCollaboration__createCollaborationFailureAlertForNotice___block_invoke;
    v55[3] = &unk_1E72EC710;
    v56 = bundleIdentifier;
    v57 = selfCopy;
    v50 = [CKAlertAction actionWithTitle:v49 style:0 handler:v55];
    [v32 addAction:v50];
  }

  v51 = *(v33 + 1824);
  v52 = CKFrameworkBundle();
  v53 = [v52 localizedStringForKey:@"OK" value:&stru_1F04268F8 table:@"ChatKit"];
  v54 = [v51 actionWithTitle:v53 style:0 handler:&__block_literal_global_323_0];
  [v32 addAction:v54];

  [v32 presentFromViewController:selfCopy animated:1 completion:0];
}

void __81__CKChatController_GroupCollaboration__createCollaborationFailureAlertForNotice___block_invoke(uint64_t a1)
{
  if ([*(a1 + 32) length])
  {
    v2 = [MEMORY[0x1E6963608] defaultWorkspace];
    [v2 openApplicationWithBundleID:*(a1 + 32)];
  }

  v3 = [*(a1 + 40) entryView];
  [v3 configureForDisplayMode:1];

  v4 = [*(a1 + 40) entryView];
  [v4 updateEntryView];
}

- (void)createCollaborationFailureAlertForFailedMetadataLoadWithFallback:(BOOL)fallback URL:(id)l
{
  fallbackCopy = fallback;
  lCopy = l;
  v6 = CKFrameworkBundle();
  v27 = [v6 localizedStringForKey:@"FAILED_COLLABORATION_METADATA_ALERT_MESSAGE_TITLE" value:&stru_1F04268F8 table:@"ChatKit"];

  mEMORY[0x1E69A8288] = [MEMORY[0x1E69A8288] sharedManager];
  v8 = [mEMORY[0x1E69A8288] appNameFromSharingURL:lCopy];
  if (v8)
  {
    v9 = MEMORY[0x1E696AEC0];
    v10 = CKFrameworkBundle();
    v11 = [v10 localizedStringForKey:@"FAILED_COLLABORATION_METADATA_ALERT_MESSAGE" value:&stru_1F04268F8 table:@"ChatKit"];
    mEMORY[0x1E69A8288]2 = [MEMORY[0x1E69A8288] sharedManager];
    v13 = [mEMORY[0x1E69A8288]2 appNameFromSharingURL:lCopy];
    v14 = [v9 stringWithFormat:v11, v13];

    mEMORY[0x1E69DC668] = [MEMORY[0x1E69DC668] sharedApplication];
    userInterfaceLayoutDirection = [mEMORY[0x1E69DC668] userInterfaceLayoutDirection];

    if (userInterfaceLayoutDirection == 1)
    {
      v17 = @"\u200F";
    }

    else
    {
      v17 = @"\u200E";
    }

    v18 = [(__CFString *)v17 stringByAppendingString:v14];
  }

  else
  {
    v14 = CKFrameworkBundle();
    v18 = [v14 localizedStringForKey:@"COLLABORATION_ERROR_UNKNOWN_MESSAGE" value:&stru_1F04268F8 table:@"ChatKit"];
  }

  v19 = v18;

  if (fallbackCopy)
  {
    v20 = CKFrameworkBundle();
    v21 = [v20 localizedStringForKey:@"FAILED_COLLABORATION_FALLBACK_SENDASCOPY" value:&stru_1F04268F8 table:@"ChatKit"];

    v22 = [v19 stringByAppendingString:v21];

    v19 = v22;
  }

  v23 = CKFrameworkBundle();
  v24 = [v23 localizedStringForKey:@"OK" value:&stru_1F04268F8 table:@"ChatKit"];

  v25 = [CKAlertController alertControllerWithTitle:v27 message:v19 preferredStyle:1];
  v29[0] = MEMORY[0x1E69E9820];
  v29[1] = 3221225472;
  v29[2] = __109__CKChatController_GroupCollaboration__createCollaborationFailureAlertForFailedMetadataLoadWithFallback_URL___block_invoke;
  v29[3] = &unk_1E72EBFE8;
  v29[4] = self;
  v26 = [CKAlertAction actionWithTitle:v24 style:0 handler:v29];
  [v25 addAction:v26];

  [v25 presentFromViewController:self animated:1 completion:0];
}

void __109__CKChatController_GroupCollaboration__createCollaborationFailureAlertForFailedMetadataLoadWithFallback_URL___block_invoke(uint64_t a1)
{
  v2 = [*(a1 + 32) entryView];
  [v2 configureForDisplayMode:1];

  v3 = [*(a1 + 32) entryView];
  [v3 updateEntryView];
}

- (void)presentReplaceCompositionAlertWithConfirmationBlock:(id)block cancelBlock:(id)cancelBlock
{
  blockCopy = block;
  cancelBlockCopy = cancelBlock;
  v7 = CKFrameworkBundle();
  v8 = [v7 localizedStringForKey:@"SHELF_REPLACE_ITEM_TITLE" value:&stru_1F04268F8 table:@"ChatKit"];
  v9 = CKFrameworkBundle();
  v10 = [v9 localizedStringForKey:@"SHELF_REPLACE_ITEM" value:&stru_1F04268F8 table:@"ChatKit"];
  v11 = [CKAlertController alertControllerWithTitle:v8 message:v10 preferredStyle:1];

  v12 = CKFrameworkBundle();
  v13 = [v12 localizedStringForKey:@"SHELF_REPLACE_ITEM_OK_ACTION_TITLE" value:&stru_1F04268F8 table:@"ChatKit"];
  v23[0] = MEMORY[0x1E69E9820];
  v23[1] = 3221225472;
  v23[2] = __104__CKChatController_GroupCollaboration__presentReplaceCompositionAlertWithConfirmationBlock_cancelBlock___block_invoke;
  v23[3] = &unk_1E72EC218;
  v24 = blockCopy;
  v14 = blockCopy;
  v15 = [CKAlertAction actionWithTitle:v13 style:0 handler:v23];
  [v11 addAction:v15];

  v16 = CKFrameworkBundle();
  v17 = [v16 localizedStringForKey:@"SHELF_REPLACE_ITEM_CANCEL_ACTION_TITLE" value:&stru_1F04268F8 table:@"ChatKit"];
  v21[0] = MEMORY[0x1E69E9820];
  v21[1] = 3221225472;
  v21[2] = __104__CKChatController_GroupCollaboration__presentReplaceCompositionAlertWithConfirmationBlock_cancelBlock___block_invoke_2;
  v21[3] = &unk_1E72EC218;
  v22 = cancelBlockCopy;
  v18 = cancelBlockCopy;
  v19 = [CKAlertAction actionWithTitle:v17 style:0 handler:v21];
  [v11 addAction:v19];

  [v11 presentFromViewController:self animated:1 completion:0];
}

uint64_t __104__CKChatController_GroupCollaboration__presentReplaceCompositionAlertWithConfirmationBlock_cancelBlock___block_invoke(uint64_t a1)
{
  result = *(a1 + 32);
  if (result)
  {
    return (*(result + 16))();
  }

  return result;
}

uint64_t __104__CKChatController_GroupCollaboration__presentReplaceCompositionAlertWithConfirmationBlock_cancelBlock___block_invoke_2(uint64_t a1)
{
  result = *(a1 + 32);
  if (result)
  {
    return (*(result + 16))();
  }

  return result;
}

- (BOOL)shouldShowTipsWithAlignment:(int64_t)alignment
{
  if (!alignment && (-[CKChatController _anyTranscriptBannerIsVisible](self, "_anyTranscriptBannerIsVisible") || -[CKChatController _anySuggestionPresenterWantsToShowBanner](self, "_anySuggestionPresenterWantsToShowBanner")) || (-[CKChatController traitCollection](self, "traitCollection"), v4 = objc_claimAutoreleasedReturnValue(), v5 = [v4 verticalSizeClass], v4, v5 == 1))
  {
    v6 = 0;
  }

  else
  {
    objc_opt_class();
    v6 = objc_opt_isKindOfClass() ^ 1;
  }

  return v6 & 1;
}

- (void)determineIfSendMenuShouldElevateCheckInWithCompletion:(id)completion
{
  completionCopy = completion;
  if ([(CKChatController *)self _shouldCheckWithSafetyMonitor])
  {
    _recipientHandleID = [(CKChatController *)self _recipientHandleID];
    if ([_recipientHandleID length])
    {
      mEMORY[0x1E69A8218] = [MEMORY[0x1E69A8218] sharedCoordinator];
      v7[0] = MEMORY[0x1E69E9820];
      v7[1] = 3221225472;
      v7[2] = __89__CKChatController_SafetyMonitor__determineIfSendMenuShouldElevateCheckInWithCompletion___block_invoke;
      v7[3] = &unk_1E72ED1F0;
      v8 = completionCopy;
      [mEMORY[0x1E69A8218] checkPreferredHandlesCacheForReceiverWith:_recipientHandleID completion:v7];
    }
  }

  else
  {
    (*(completionCopy + 2))(completionCopy, 0);
  }
}

void __89__CKChatController_SafetyMonitor__determineIfSendMenuShouldElevateCheckInWithCompletion___block_invoke(uint64_t a1, char a2)
{
  v3[0] = MEMORY[0x1E69E9820];
  v3[1] = 3221225472;
  v3[2] = __89__CKChatController_SafetyMonitor__determineIfSendMenuShouldElevateCheckInWithCompletion___block_invoke_2;
  v3[3] = &unk_1E72ED478;
  v4 = *(a1 + 32);
  v5 = a2;
  dispatch_async(MEMORY[0x1E69E96A0], v3);
}

- (void)updateSendMenuShouldElevateCheckIn
{
  v2[0] = MEMORY[0x1E69E9820];
  v2[1] = 3221225472;
  v2[2] = __69__CKChatController_SafetyMonitor__updateSendMenuShouldElevateCheckIn__block_invoke;
  v2[3] = &unk_1E72EB9C8;
  v2[4] = self;
  [(CKChatController *)self determineIfSendMenuShouldElevateCheckInWithCompletion:v2];
}

void __69__CKChatController_SafetyMonitor__updateSendMenuShouldElevateCheckIn__block_invoke(uint64_t a1, uint64_t a2)
{
  v3 = [*(a1 + 32) conversation];
  [v3 setElevateCheckIn:a2];
}

- (void)showCheckInTips:(id)tips
{
  tipsCopy = tips;
  if (CKIsRunningInMacCatalyst() || ![(CKChatController *)self _shouldCheckWithSafetyMonitor])
  {
    (*(tipsCopy + 2))(tipsCopy, 0, 0);
  }

  else
  {
    _sendertHandleID = [(CKChatController *)self _sendertHandleID];
    v11 = 0;
    v12 = &v11;
    v13 = 0x3032000000;
    v14 = __Block_byref_object_copy__45;
    v15 = __Block_byref_object_dispose__45;
    _recipientHandleID = [(CKChatController *)self _recipientHandleID];
    if ([_sendertHandleID length] && objc_msgSend(v12[5], "length"))
    {
      mEMORY[0x1E69A8218] = [MEMORY[0x1E69A8218] sharedCoordinator];
      v7 = v12[5];
      v8[0] = MEMORY[0x1E69E9820];
      v8[1] = 3221225472;
      v8[2] = __51__CKChatController_SafetyMonitor__showCheckInTips___block_invoke;
      v8[3] = &unk_1E72F4B80;
      v9 = tipsCopy;
      v10 = &v11;
      [mEMORY[0x1E69A8218] shouldShowTipKitSuggestionForInitiator:_sendertHandleID andReceiver:v7 completion:v8];
    }

    _Block_object_dispose(&v11, 8);
  }
}

void __51__CKChatController_SafetyMonitor__showCheckInTips___block_invoke(uint64_t a1, char a2)
{
  block[0] = MEMORY[0x1E69E9820];
  block[1] = 3221225472;
  block[2] = __51__CKChatController_SafetyMonitor__showCheckInTips___block_invoke_2;
  block[3] = &unk_1E72F4B58;
  v4 = *(a1 + 32);
  v9 = a2;
  v5 = *(a1 + 40);
  v7 = v4;
  v8 = v5;
  dispatch_async(MEMORY[0x1E69E96A0], block);
}

- (BOOL)_shouldCheckWithSafetyMonitor
{
  mEMORY[0x1E69A8070] = [MEMORY[0x1E69A8070] sharedFeatureFlags];
  isZelkovaEnabled = [mEMORY[0x1E69A8070] isZelkovaEnabled];

  if (!isZelkovaEnabled)
  {
    return 0;
  }

  conversation = [(CKCoreChatController *)self conversation];
  isGroupConversation = [conversation isGroupConversation];

  if (isGroupConversation)
  {
    return 0;
  }

  conversation2 = [(CKCoreChatController *)self conversation];
  sendingService = [conversation2 sendingService];
  __ck_isSMS = [sendingService __ck_isSMS];

  return __ck_isSMS ^ 1;
}

- (id)_recipientHandleID
{
  v19 = *MEMORY[0x1E69E9840];
  v14 = 0u;
  v15 = 0u;
  v16 = 0u;
  v17 = 0u;
  conversation = [(CKCoreChatController *)self conversation];
  recipients = [conversation recipients];

  v4 = [recipients countByEnumeratingWithState:&v14 objects:v18 count:16];
  if (v4)
  {
    v5 = v4;
    v6 = 0;
    v7 = *v15;
    do
    {
      for (i = 0; i != v5; ++i)
      {
        if (*v15 != v7)
        {
          objc_enumerationMutation(recipients);
        }

        v9 = *(*(&v14 + 1) + 8 * i);
        if (([v9 isMe] & 1) == 0)
        {
          defaultIMHandle = [v9 defaultIMHandle];
          v11 = [defaultIMHandle ID];
          im_stripCategoryLabel = [v11 im_stripCategoryLabel];

          v6 = im_stripCategoryLabel;
        }
      }

      v5 = [recipients countByEnumeratingWithState:&v14 objects:v18 count:16];
    }

    while (v5);
  }

  else
  {
    v6 = 0;
  }

  return v6;
}

- (id)_sendertHandleID
{
  conversation = [(CKCoreChatController *)self conversation];
  senderIdentifier = [conversation senderIdentifier];
  im_stripCategoryLabel = [senderIdentifier im_stripCategoryLabel];

  return im_stripCategoryLabel;
}

- (void)_kickPhotoKit
{
  if (CKIsRunningInMessages())
  {
    block[0] = MEMORY[0x1E69E9820];
    block[1] = 3221225472;
    block[2] = __45__CKChatController_MediaInput___kickPhotoKit__block_invoke;
    block[3] = &unk_1E72EBA18;
    block[4] = self;
    if (_kickPhotoKit_onceToken != -1)
    {
      dispatch_once(&_kickPhotoKit_onceToken, block);
    }
  }
}

void __45__CKChatController_MediaInput___kickPhotoKit__block_invoke(uint64_t a1)
{
  v2 = dispatch_get_global_queue(17, 0);
  block[0] = MEMORY[0x1E69E9820];
  block[1] = 3221225472;
  block[2] = __45__CKChatController_MediaInput___kickPhotoKit__block_invoke_2;
  block[3] = &unk_1E72EBA18;
  block[4] = *(a1 + 32);
  dispatch_async(v2, block);
}

void __45__CKChatController_MediaInput___kickPhotoKit__block_invoke_2(uint64_t a1)
{
  v2 = [MEMORY[0x1E69A8070] sharedFeatureFlags];
  v3 = [v2 isRedesignedDetailsViewEnabled];

  if (v3)
  {
    [MEMORY[0x1E69789A8] openPhotoLibraryWithWellKnownIdentifier:1 error:0];
  }

  else
  {
    [MEMORY[0x1E69789A8] sharedPhotoLibrary];
  }
  v4 = ;
  [v4 registerChangeObserver:*(a1 + 32)];
  [v4 unregisterChangeObserver:*(a1 + 32)];
}

- (void)showMediaPicker:(id)picker animated:(BOOL)animated
{
  pickerCopy = picker;
  [(CKChatController *)self setImagePickerController:pickerCopy];
  [(CKChatController *)self updateRaiseGesture];
  entryView = [(CKChatController *)self entryView];
  contentView = [entryView contentView];
  isActive = [contentView isActive];

  sourceType = [pickerCopy sourceType];
  if (!CKIsRunningInMessagesViewService())
  {
    if (sourceType == 1)
    {
      v10 = +[CKUIBehavior sharedBehaviors];
      canPresentOverKeyboard = [v10 canPresentOverKeyboard];

      [(CKChatController *)self beginHoldingAutorotationForKey:@"CKAutorotationHoldImagePicker"];
      if (!canPresentOverKeyboard)
      {
        goto LABEL_3;
      }
    }

    else
    {
      [(CKChatController *)self beginHoldingAutorotationForKey:@"CKAutorotationHoldImagePicker"];
    }

    aBlock[0] = MEMORY[0x1E69E9820];
    aBlock[1] = 3221225472;
    aBlock[2] = __57__CKChatController_MediaInput__showMediaPicker_animated___block_invoke;
    aBlock[3] = &unk_1E72EC410;
    aBlock[4] = self;
    v12 = _Block_copy(aBlock);
    v16[0] = MEMORY[0x1E69E9820];
    v16[1] = 3221225472;
    v16[2] = __57__CKChatController_MediaInput__showMediaPicker_animated___block_invoke_2;
    v16[3] = &unk_1E72EC438;
    v16[4] = self;
    v13 = _Block_copy(v16);
    v14 = +[CKAdaptivePresentationController sharedInstance];
    [v14 presentViewController:pickerCopy fromViewController:self presentationHandler:v12 dismissalHandler:v13 animated:1 completion:0];

    goto LABEL_9;
  }

  [(CKChatController *)self beginHoldingAutorotationForKey:@"CKAutorotationHoldImagePicker"];
LABEL_3:
  v15.receiver = self;
  v15.super_class = CKChatController;
  [(CKChatController *)&v15 becomeFirstResponder];
  [(CKChatController *)self presentViewController:pickerCopy animated:1 completion:0];
  [(CKChatController *)self setTargetFirstResponder:isActive];
LABEL_9:
}

id __57__CKChatController_MediaInput__showMediaPicker_animated___block_invoke(uint64_t a1, void *a2, void *a3)
{
  v6 = [*(a1 + 32) view];
  [v6 frame];
  *a2 = v7;
  a2[1] = v8;
  a2[2] = v9;
  a2[3] = v10;

  result = [*(a1 + 32) view];
  *a3 = result;
  return result;
}

void __57__CKChatController_MediaInput__showMediaPicker_animated___block_invoke_2(uint64_t a1)
{
  [*(a1 + 32) hideMediaPickerAnimated:0];
  v2 = [*(a1 + 32) entryView];
  v3 = [v2 contentView];
  v4 = [v3 isActive];

  if ((v4 & 1) == 0)
  {
    v5 = *(a1 + 32);

    [v5 becomeFirstResponder];
  }
}

- (void)hideMediaPickerAnimated:(BOOL)animated completion:(id)completion
{
  animatedCopy = animated;
  completionCopy = completion;
  imagePickerController = [(CKChatController *)self imagePickerController];
  v8 = imagePickerController;
  if (imagePickerController)
  {
    sourceType = [imagePickerController sourceType];
    v10 = CKScrollViewHoldingScrollGeometryReasonTypeCameraOverlay;
    if (sourceType != 1)
    {
      v10 = CKScrollViewHoldingScrollGeometryReasonTypePhotoLibraryOverlay;
    }

    v11 = *v10;
    presentingViewController = [v8 presentingViewController];

    [(CKScrollViewController *)self endHoldingScrollGeometryUpdatesForReason:v11];
    if (presentingViewController)
    {
      v17 = MEMORY[0x1E69E9820];
      v18 = 3221225472;
      v19 = __67__CKChatController_MediaInput__hideMediaPickerAnimated_completion___block_invoke;
      v20 = &unk_1E72EE5D8;
      selfCopy = self;
      v22 = completionCopy;
      v13 = _Block_copy(&v17);
      v14 = [CKAdaptivePresentationController sharedInstance:v17];
      presentedViewController = [v14 presentedViewController];

      if (presentedViewController == v8)
      {
        +[CKAdaptivePresentationController sharedInstance];
      }

      else
      {
        [v8 presentingViewController];
      }
      v16 = ;
      [v16 dismissViewControllerAnimated:animatedCopy completion:v13];
    }
  }

  [(CKChatController *)self endHoldingAutorotationForKey:@"CKAutorotationHoldImagePicker"];
  [(CKChatController *)self setImagePickerController:0];
  [(CKChatController *)self updateRaiseGesture];
}

void __67__CKChatController_MediaInput__hideMediaPickerAnimated_completion___block_invoke(uint64_t a1)
{
  v2 = *(a1 + 40);
  if (v2)
  {
    (*(v2 + 16))();
  }

  v3 = [*(a1 + 32) entryView];
  v4 = [v3 contentView];
  v5 = [v4 isActive];

  if ((v5 & 1) == 0)
  {
    v6 = *(a1 + 32);

    [v6 becomeFirstResponder];
  }
}

- (id)makeThrowAnimationManagerForComposition:(id)composition
{
  v4 = MEMORY[0x1E69A8070];
  compositionCopy = composition;
  sharedFeatureFlags = [v4 sharedFeatureFlags];
  isSendAnimationRefreshEnabled = [sharedFeatureFlags isSendAnimationRefreshEnabled];

  if (isSendAnimationRefreshEnabled)
  {
    +[CKThrowAnimationManager glassThrowSendAnimationManager];
  }

  else
  {
    +[CKThrowAnimationManager nonGlassThrowSendAnimationManager];
  }
  v8 = ;
  [v8 setThrowManagerDelegate:self];
  [v8 setSendAnimationManagerDelegate:self];
  [v8 setSendAnimationBalloonProvider:self];
  isAudioComposition = [compositionCopy isAudioComposition];

  if (isAudioComposition)
  {
    [(CKChatController *)self configureThrowAnimationManagerForAudioSendAnimation:v8];
  }

  return v8;
}

- (void)configureThrowAnimationManagerForAudioSendAnimation:(id)animation
{
  animationCopy = animation;
  entryView = [(CKChatController *)self entryView];
  [entryView audioRecordingPillViewFrameInThrowViewCoordinates];
  v7 = v6;
  v9 = v8;
  v11 = v10;
  v13 = v12;

  [animationCopy setAudioMessageSourceRect:{v7, v9, v11, v13}];
  entryView2 = [(CKChatController *)self entryView];
  audioRecordingPillViewSnapshot = [entryView2 audioRecordingPillViewSnapshot];

  [animationCopy setAudioRecordingPillViewSnapshot:audioRecordingPillViewSnapshot];
}

- (void)photoGridDisplayedChatItemChanged:(id)changed
{
  changedCopy = changed;
  photosGridViewController = [(CKChatController *)self photosGridViewController];
  if (photosGridViewController)
  {
    photoGridMomentShareChatItem = [(CKChatController *)self photoGridMomentShareChatItem];

    if (photoGridMomentShareChatItem)
    {
      v7 = [(CKChatController *)self _tapbackStatusManagerForChatItem:changedCopy];
      [(CKChatController *)self setPhotoGridMomentShareChatItem:changedCopy];
      viewModel = [photosGridViewController viewModel];
      v12[0] = MEMORY[0x1E69E9820];
      v12[1] = 3221225472;
      v12[2] = __69__CKChatController_PhotosSupport__photoGridDisplayedChatItemChanged___block_invoke;
      v12[3] = &unk_1E72F6F78;
      v13 = v7;
      v9 = v7;
      [viewModel performChanges:v12];
    }

    else
    {
      photoGridDataSourceManager = [(CKChatController *)self photoGridDataSourceManager];
      dataSource = [changedCopy dataSource];
      [photoGridDataSourceManager setMediaObjectDataSource:dataSource];
    }
  }
}

void __69__CKChatController_PhotosSupport__photoGridDisplayedChatItemChanged___block_invoke(uint64_t a1, void *a2)
{
  v3 = a2;
  if (objc_opt_respondsToSelector())
  {
    [v3 setTapbackStatusManager:*(a1 + 32)];
  }
}

- (void)_presentGridForPendingMomentShareChatItem:(id)item
{
  itemCopy = item;
  momentShareURL = [itemCopy momentShareURL];
  if (momentShareURL)
  {
    mEMORY[0x1E69A5B50] = [MEMORY[0x1E69A5B50] sharedController];
    remoteDaemon = [mEMORY[0x1E69A5B50] remoteDaemon];
    message = [itemCopy message];
    guid = [message guid];
    chat = [(CKCoreChatController *)self chat];
    guid2 = [chat guid];
    [remoteDaemon upgradeCompleteMyMomentLinkToStackWithMessageGUID:guid chatGUID:guid2];

    [(CKChatController *)self setMomentShareFetchGeneration:[(CKChatController *)self momentShareFetchGeneration]+ 1];
    v13[0] = MEMORY[0x1E69E9820];
    v13[1] = 3221225472;
    v13[2] = __77__CKChatController_PhotosSupport___presentGridForPendingMomentShareChatItem___block_invoke;
    v13[3] = &unk_1E72F6FA0;
    v13[4] = self;
    v14 = itemCopy;
    [(CKChatController *)self _gridViewNavigationControllerForMomentShareURL:momentShareURL chatItem:v14 tapbackManager:0 completionHandler:v13];
  }

  else
  {
    v12 = IMLogHandleForCategory();
    if (os_log_type_enabled(v12, OS_LOG_TYPE_ERROR))
    {
      [CKChatController(PhotosSupport) _presentGridForPendingMomentShareChatItem:];
    }
  }
}

void __77__CKChatController_PhotosSupport___presentGridForPendingMomentShareChatItem___block_invoke(uint64_t a1, void *a2, uint64_t a3)
{
  v5 = a2;
  if (v5)
  {
    [*(a1 + 32) _presentGridViewNavigationController:v5];
  }

  else if (a3 != 1)
  {
    v6 = IMLogHandleForCategory();
    if (os_log_type_enabled(v6, OS_LOG_TYPE_ERROR))
    {
      __77__CKChatController_PhotosSupport___presentGridForPendingMomentShareChatItem___block_invoke_cold_1(a1, a3);
    }
  }
}

- (void)_presentGridForChatItem:(id)item assetReference:(id)reference
{
  itemCopy = item;
  referenceCopy = reference;
  [(CKChatController *)self setPhotoGridMomentShareChatItem:0];
  [(CKChatController *)self setPhotoGridDataSourceManager:0];
  [(CKChatController *)self setPhotoGridDisplayedChatItemGUID:0];
  v10[0] = MEMORY[0x1E69E9820];
  v10[1] = 3221225472;
  v10[2] = __74__CKChatController_PhotosSupport___presentGridForChatItem_assetReference___block_invoke;
  v10[3] = &unk_1E72F6FC8;
  v10[4] = self;
  v11 = itemCopy;
  v12 = referenceCopy;
  v8 = referenceCopy;
  v9 = itemCopy;
  [(CKChatController *)self _gridViewNavigationControllerForChatItem:v9 assetReference:v8 completionHandler:v10];
}

void __74__CKChatController_PhotosSupport___presentGridForChatItem_assetReference___block_invoke(uint64_t a1, void *a2, uint64_t a3)
{
  v5 = a2;
  if (v5)
  {
    [*(a1 + 32) _presentGridViewNavigationController:v5];
  }

  else if (a3 != 1)
  {
    v6 = IMLogHandleForCategory();
    if (os_log_type_enabled(v6, OS_LOG_TYPE_ERROR))
    {
      __74__CKChatController_PhotosSupport___presentGridForChatItem_assetReference___block_invoke_cold_1(a1, a3);
    }
  }
}

- (void)_presentGridViewNavigationController:(id)controller
{
  controllerCopy = controller;
  [(CKScrollViewController *)self beginHoldingScrollGeometryUpdatesForReason:@"ShowingPhotoGridOverlay"];
  [(CKChatController *)self presentViewController:controllerCopy animated:1 completion:&__block_literal_global_243];
}

- (void)_gridViewNavigationControllerForMomentShareURL:(id)l chatItem:(id)item tapbackManager:(id)manager completionHandler:(id)handler
{
  lCopy = l;
  itemCopy = item;
  managerCopy = manager;
  handlerCopy = handler;
  momentShareFetchGeneration = [(CKChatController *)self momentShareFetchGeneration];
  v15 = IMLogHandleForCategory();
  if (os_log_type_enabled(v15, OS_LOG_TYPE_DEBUG))
  {
    [CKChatController(PhotosSupport) _gridViewNavigationControllerForMomentShareURL:chatItem:tapbackManager:completionHandler:];
  }

  chat = [(CKCoreChatController *)self chat];
  momentShareCache = [chat momentShareCache];

  absoluteString = [lCopy absoluteString];
  v23[0] = MEMORY[0x1E69E9820];
  v23[1] = 3221225472;
  v23[2] = __124__CKChatController_PhotosSupport___gridViewNavigationControllerForMomentShareURL_chatItem_tapbackManager_completionHandler___block_invoke;
  v23[3] = &unk_1E72F6FF0;
  v27 = handlerCopy;
  v28 = momentShareFetchGeneration;
  v23[4] = self;
  v24 = lCopy;
  v25 = itemCopy;
  v26 = managerCopy;
  v19 = managerCopy;
  v20 = itemCopy;
  v21 = lCopy;
  v22 = handlerCopy;
  [momentShareCache momentShareForURLString:absoluteString completionHandler:v23];
}

void __124__CKChatController_PhotosSupport___gridViewNavigationControllerForMomentShareURL_chatItem_tapbackManager_completionHandler___block_invoke(uint64_t a1, void *a2, void *a3)
{
  v25 = *MEMORY[0x1E69E9840];
  v5 = a2;
  v6 = a3;
  v7 = [*(a1 + 32) momentShareFetchGeneration];
  if (*(a1 + 72) != v7)
  {
    v14 = v7;
    v15 = IMLogHandleForCategory();
    if (os_log_type_enabled(v15, OS_LOG_TYPE_DEFAULT))
    {
      v16 = *(a1 + 72);
      *v22 = 134218240;
      *&v22[4] = v16;
      *&v22[12] = 2048;
      *&v22[14] = v14;
      _os_log_impl(&dword_19020E000, v15, OS_LOG_TYPE_DEFAULT, "Cancelled fetch with generation: %td, current: %td", v22, 0x16u);
    }

    v17 = *(*(a1 + 64) + 16);
    goto LABEL_20;
  }

  v8 = IMLogHandleForCategory();
  v9 = v8;
  if (!v5)
  {
    if (os_log_type_enabled(v8, OS_LOG_TYPE_ERROR))
    {
      v20 = *(a1 + 40);
      v21 = *(a1 + 72);
      *v22 = 138412802;
      *&v22[4] = v20;
      *&v22[12] = 2048;
      *&v22[14] = v21;
      *&v22[22] = 2112;
      v23 = v6;
      _os_log_error_impl(&dword_19020E000, v9, OS_LOG_TYPE_ERROR, "Failed to fetch moment share for URL: %@, generation: %td, error: %@", v22, 0x20u);
    }

    IsPermanent = IMMomentShareCacheErrorIsPermanent();
    v19 = IMLogHandleForCategory();
    if (os_log_type_enabled(v19, OS_LOG_TYPE_DEBUG))
    {
      __124__CKChatController_PhotosSupport___gridViewNavigationControllerForMomentShareURL_chatItem_tapbackManager_completionHandler___block_invoke_cold_3(IsPermanent, v19);
    }

    v17 = *(*(a1 + 64) + 16);
LABEL_20:
    v17();
    goto LABEL_21;
  }

  if (os_log_type_enabled(v8, OS_LOG_TYPE_DEBUG))
  {
    __124__CKChatController_PhotosSupport___gridViewNavigationControllerForMomentShareURL_chatItem_tapbackManager_completionHandler___block_invoke_cold_1();
  }

  v10 = v5;
  if ([v10 status] == 2)
  {
    v11 = IMLogHandleForCategory();
    if (os_log_type_enabled(v11, OS_LOG_TYPE_DEFAULT))
    {
      *v22 = 138412290;
      *&v22[4] = v10;
      _os_log_impl(&dword_19020E000, v11, OS_LOG_TYPE_DEFAULT, "Will accept moment share: %@", v22, 0xCu);
    }

    *v22 = MEMORY[0x1E69E9820];
    *&v22[8] = 3221225472;
    *&v22[16] = ___AcceptMomentShareIfNecessary_block_invoke;
    v23 = &unk_1E72EC088;
    v24 = v10;
    [v24 acceptMomentShareWithCompletion:v22];
  }

  v12 = IMLogHandleForCategory();
  if (os_log_type_enabled(v12, OS_LOG_TYPE_DEBUG))
  {
    __124__CKChatController_PhotosSupport___gridViewNavigationControllerForMomentShareURL_chatItem_tapbackManager_completionHandler___block_invoke_cold_2();
  }

  v13 = [*(a1 + 32) _gridViewNavigationControllerForMomentShare:v10 chatItem:*(a1 + 48) tapbackManager:*(a1 + 56)];
  (*(*(a1 + 64) + 16))();

LABEL_21:
}

- (id)_gridViewNavigationControllerForMomentShare:(id)share chatItem:(id)item tapbackManager:(id)manager
{
  itemCopy = item;
  managerCopy = manager;
  shareCopy = share;
  if ([shareCopy status] == 1)
  {
    v11 = 3;
  }

  else
  {
    v11 = 2;
  }

  v12 = [objc_alloc(MEMORY[0x1E69C33A0]) initWithMomentShare:shareCopy activityType:v11 sourceType:1];

  v13 = objc_alloc_init(MEMORY[0x1E69C33A8]);
  if (objc_opt_respondsToSelector())
  {
    createSession = [v12 createSession];
    v15 = [CKCMMAssetActionManager assetActionManagerWithCMMSession:createSession chatItem:itemCopy presentedFromInlineReply:[(CKCoreChatController *)self isInline] chatActionHelper:self performerDelegate:self];
    v16 = objc_opt_class();
    v26[0] = MEMORY[0x1E69E9820];
    v26[1] = 3221225472;
    v26[2] = __103__CKChatController_PhotosSupport___gridViewNavigationControllerForMomentShare_chatItem_tapbackManager___block_invoke;
    v26[3] = &unk_1E72F7018;
    v26[4] = self;
    v27 = managerCopy;
    v17 = [v13 workflowViewControllerWithSession:createSession embedInNavigationControllerOfClass:v16 assetActionManager:v15 assetCollectionActionManager:0 photosViewConfigurationBlock:v26];
  }

  else
  {
    v18 = objc_opt_class();
    v20 = MEMORY[0x1E69E9820];
    v21 = 3221225472;
    v22 = __103__CKChatController_PhotosSupport___gridViewNavigationControllerForMomentShare_chatItem_tapbackManager___block_invoke_2;
    v23 = &unk_1E72F7018;
    selfCopy = self;
    v25 = managerCopy;
    v17 = [v13 workflowViewControllerWithContext:v12 embedInNavigationControllerOfClass:v18 photosViewConfigurationBlock:&v20];
  }

  [v17 setModalPresentationStyle:{3, v20, v21, v22, v23, selfCopy}];
  objc_opt_class();
  if (objc_opt_isKindOfClass())
  {
    [(CKChatController *)self _configureGridControllerForStackTransition:v17 chatItem:itemCopy];
  }

  return v17;
}

void __103__CKChatController_PhotosSupport___gridViewNavigationControllerForMomentShare_chatItem_tapbackManager___block_invoke(uint64_t a1, void *a2)
{
  v3 = a2;
  _ApplyCommonGridConfiguration(v3, *(a1 + 32));
  [v3 setAllowsDragAndDrop:0];
  [v3 setAllowedBehaviors:{objc_msgSend(v3, "allowedBehaviors") | 0x200}];
  if ([*(a1 + 32) isInline])
  {
    [v3 setAllowedActions:{objc_msgSend(v3, "allowedActions") & 0xFFFFFFFFFFFEFFDFLL}];
  }

  [v3 setAllowedBehaviors:{objc_msgSend(v3, "allowedBehaviors") & 0xFFFFFFFFFFFFFFBFLL}];
  [v3 setTapbackStatusManager:*(a1 + 40)];
}

void __103__CKChatController_PhotosSupport___gridViewNavigationControllerForMomentShare_chatItem_tapbackManager___block_invoke_2(uint64_t a1, void *a2)
{
  v3 = *(a1 + 32);
  v4 = a2;
  _ApplyCommonGridConfiguration(v4, v3);
  [v4 setAllowsDragAndDrop:0];
  [v4 setTapbackStatusManager:*(a1 + 40)];
}

- (void)_gridViewNavigationControllerForChatItem:(id)item assetReference:(id)reference completionHandler:(id)handler
{
  itemCopy = item;
  referenceCopy = reference;
  handlerCopy = handler;
  [(CKChatController *)self setMomentShareFetchGeneration:[(CKChatController *)self momentShareFetchGeneration]+ 1];
  v11 = [(CKChatController *)self _tapbackStatusManagerForChatItem:itemCopy];
  momentShareURL = [itemCopy momentShareURL];
  if (momentShareURL)
  {
    v15[0] = MEMORY[0x1E69E9820];
    v15[1] = 3221225472;
    v15[2] = __109__CKChatController_PhotosSupport___gridViewNavigationControllerForChatItem_assetReference_completionHandler___block_invoke;
    v15[3] = &unk_1E72F7040;
    v15[4] = self;
    v16 = itemCopy;
    v17 = referenceCopy;
    v18 = v11;
    v19 = handlerCopy;
    [(CKChatController *)self _gridViewNavigationControllerForMomentShareURL:momentShareURL chatItem:v16 tapbackManager:v18 completionHandler:v15];
  }

  else
  {
    v13 = IMLogHandleForCategory();
    if (os_log_type_enabled(v13, OS_LOG_TYPE_DEBUG))
    {
      [CKChatController(PhotosSupport) _gridViewNavigationControllerForChatItem:assetReference:completionHandler:];
    }

    v14 = [(CKChatController *)self _regularGridViewNavigationControllerForChatItem:itemCopy assetReference:referenceCopy tapbackManager:v11];
    (*(handlerCopy + 2))(handlerCopy, v14, 0);
  }
}

void __109__CKChatController_PhotosSupport___gridViewNavigationControllerForChatItem_assetReference_completionHandler___block_invoke(uint64_t a1, void *a2, uint64_t a3)
{
  v5 = a2;
  v6 = v5;
  if (v5 || a3 != 3)
  {
    if (v5)
    {
      [*(a1 + 32) setPhotoGridMomentShareChatItem:*(a1 + 40)];
      v9 = *(a1 + 32);
      v10 = [*(a1 + 40) IMChatItem];
      v11 = [v10 guid];
      [v9 setPhotoGridDisplayedChatItemGUID:v11];
    }

    (*(*(a1 + 64) + 16))();
  }

  else
  {
    v7 = IMLogHandleForCategory();
    if (os_log_type_enabled(v7, OS_LOG_TYPE_DEBUG))
    {
      __109__CKChatController_PhotosSupport___gridViewNavigationControllerForChatItem_assetReference_completionHandler___block_invoke_cold_1();
    }

    v8 = [*(a1 + 32) _regularGridViewNavigationControllerForChatItem:*(a1 + 40) assetReference:*(a1 + 48) tapbackManager:*(a1 + 56)];
    (*(*(a1 + 64) + 16))();
  }
}

- (id)_regularGridViewNavigationControllerForChatItem:(id)item assetReference:(id)reference tapbackManager:(id)manager
{
  itemCopy = item;
  managerCopy = manager;
  dataSource = [itemCopy dataSource];
  v9 = [[CKMediaObjectAssetDataSourceManager alloc] initWithDataSource:dataSource];
  iMChatItem = [itemCopy IMChatItem];
  guid = [iMChatItem guid];
  [(CKChatController *)self setPhotoGridDisplayedChatItemGUID:guid];

  [(CKChatController *)self setPhotoGridDataSourceManager:v9];
  v12 = [objc_alloc(MEMORY[0x1E69C45C8]) initWithDataSourceManager:v9];
  v13 = [[CKMediaObjectAssetActionManager alloc] initWithChatItem:itemCopy presentedFromInlineReply:[(CKCoreChatController *)self isInline] chatActionHelper:self selectionManager:v12];
  v14 = objc_alloc(MEMORY[0x1E69A2908]);
  v15 = objc_alloc_init(CKMediaObjectImageProvider);
  v28 = v13;
  v16 = [v14 initWithDataSourceManager:v9 mediaProvider:v15 selectionManager:v12 assetActionManager:v13 assetCollectionActionManager:0];

  v17 = objc_alloc_init(CKImportStatusManager);
  [v16 setAssetImportStatusManager:v17];

  _ApplyCommonGridConfiguration(v16, self);
  [v16 setTapbackStatusManager:managerCopy];

  [v16 setAllowedActions:{objc_msgSend(v16, "allowedActions") | 0x1A000}];
  [v16 setAllowedActions:{objc_msgSend(v16, "allowedActions") & 0xFFFFFFFFFFFFFB7FLL}];
  [v16 setAllowedBehaviors:{objc_msgSend(v16, "allowedBehaviors") | 0x80}];
  if (-[CKCoreChatController isInline](self, "isInline") || ([itemCopy message], v18 = objc_claimAutoreleasedReturnValue(), v19 = -[CKChatController _allowsMultipleSelectionForMessage:](self, "_allowsMultipleSelectionForMessage:", v18), v18, !v19))
  {
    [v16 setAllowedActions:{objc_msgSend(v16, "allowedActions") & 0xFFFFFFFFFFFFFFDFLL}];
  }

  [v16 setWantsTabBarHidden:1];
  [v16 setPrefersActionsInToolbar:1];
  message = [itemCopy message];
  if ([message isFromMe])
  {
    v21 = 0;
  }

  else
  {
    v22 = MEMORY[0x1E69A5C30];
    iMChatItem2 = [itemCopy IMChatItem];
    v21 = [v22 photosSyndicationIdentifiersForMessage:message transcriptChatItem:iMChatItem2];
  }

  v24 = [[CKPhotosGridFooterViewModel alloc] initAssetsDataSourceManager:v9 syndicationIdentifiers:v21];
  [v16 setFooterViewModel:v24];
  [v16 setFooterVisibilityStyle:2];
  v25 = [objc_alloc(MEMORY[0x1E69C38F8]) initWithConfiguration:v16];
  [v25 setCk_chatController:self];
  v26 = [objc_alloc(MEMORY[0x1E69DCCD8]) initWithRootViewController:v25];
  [v26 setModalPresentationStyle:3];
  [(CKChatController *)self _configureGridControllerForStackTransition:v26 chatItem:itemCopy];

  return v26;
}

- (BOOL)_allowsMultipleSelectionForMessage:(id)message
{
  messageCopy = message;
  v4 = [messageCopy scheduleType] != 2 || objc_msgSend(messageCopy, "scheduleState") != 1;

  return v4;
}

- (void)_configureGridControllerForStackTransition:(id)transition chatItem:(id)item
{
  itemCopy = item;
  transitionCopy = transition;
  collectionViewController = [(CKCoreChatController *)self collectionViewController];
  v9 = [collectionViewController balloonViewForChatItem:itemCopy];

  objc_opt_class();
  if (objc_opt_isKindOfClass())
  {
    stackView = [v9 stackView];
  }

  else
  {
    stackView = 0;
  }

  v12 = stackView;
  gridTransitioningDelegate = [stackView gridTransitioningDelegate];
  [transitionCopy setTransitioningDelegate:gridTransitioningDelegate];
}

- (void)_presentViewerForChatItem:(id)item assetReference:(id)reference
{
  v15 = *MEMORY[0x1E69E9840];
  itemCopy = item;
  referenceCopy = reference;
  asset = [referenceCopy asset];
  objc_opt_class();
  isKindOfClass = objc_opt_isKindOfClass();

  if (isKindOfClass)
  {
    [(CKScrollViewController *)self beginHoldingScrollGeometryUpdatesForReason:@"ShowingPhotoGridOverlay"];
    dataSource = [itemCopy dataSource];
    v11 = [(CKChatController *)self _previewViewControllerForAssetReference:referenceCopy dataSource:dataSource previewDelegate:self previewMode:2];

    [v11 setChatItem:itemCopy];
    [(CKChatController *)self presentViewController:v11 animated:1 completion:0];
  }

  else if (IMOSLoggingEnabled())
  {
    v12 = OSLogHandleForIMFoundationCategory();
    if (os_log_type_enabled(v12, OS_LOG_TYPE_INFO))
    {
      v13 = 136315138;
      v14 = "[CKChatController(PhotosSupport) _presentViewerForChatItem:assetReference:]";
      _os_log_impl(&dword_19020E000, v12, OS_LOG_TYPE_INFO, "%s got non-CKMediaObjectBackedAsset PXDisplayAsset!", &v13, 0xCu);
    }
  }
}

- (id)_tapbackStatusManagerForChatItem:(id)item
{
  itemCopy = item;
  v5 = objc_alloc_init(CKMediaObjectTapbackManager);
  [(CKMediaObjectTapbackManager *)v5 setChatItem:itemCopy];

  view = [(CKChatController *)self view];
  [(CKMediaObjectTapbackManager *)v5 setGradientReferenceView:view];

  [(CKMediaObjectTapbackManager *)v5 setOriginatedFromGridView:1];
  [(CKMediaObjectTapbackManager *)v5 setInvertTapbackTailDirection:1];
  [(CKMediaObjectTapbackManager *)v5 setPhotoGridTapbackPileDelegate:self];

  return v5;
}

- (void)presentedPreviewControllerDidSelectNavigateToGrid
{
  previewController = [(CKChatController *)self previewController];
  objc_opt_class();
  if (objc_opt_isKindOfClass())
  {
    previewController2 = [(CKChatController *)self previewController];
    chatItem = [previewController2 chatItem];
    objc_opt_class();
    isKindOfClass = objc_opt_isKindOfClass();

    if (isKindOfClass)
    {
      previewController3 = [(CKChatController *)self previewController];
      chatItem2 = [previewController3 chatItem];
      dataSource = [chatItem2 dataSource];
      currentPreviewItem = [previewController3 currentPreviewItem];
      v10 = [dataSource assetReferenceForMediaObject:currentPreviewItem];

      v14[0] = MEMORY[0x1E69E9820];
      v14[1] = 3221225472;
      v14[2] = __84__CKChatController_PhotosSupport__presentedPreviewControllerDidSelectNavigateToGrid__block_invoke;
      v14[3] = &unk_1E72F6FC8;
      v14[4] = self;
      v15 = chatItem2;
      v16 = v10;
      v11 = v10;
      v12 = chatItem2;
      [(CKChatController *)self _gridViewNavigationControllerForChatItem:v12 assetReference:v11 completionHandler:v14];
    }
  }

  else
  {
  }
}

void __84__CKChatController_PhotosSupport__presentedPreviewControllerDidSelectNavigateToGrid__block_invoke(uint64_t a1, void *a2, uint64_t a3)
{
  v5 = a2;
  if (v5)
  {
    v6 = [*(a1 + 32) previewController];
    v7 = [v6 view];
    v8 = [v7 window];

    v9 = [v8 snapshotViewAfterScreenUpdates:0];
    v10 = [*(a1 + 32) view];
    [v8 bounds];
    [v10 convertRect:v8 fromCoordinateSpace:?];
    [v9 setFrame:?];

    v11 = [*(a1 + 32) view];
    [v11 addSubview:v9];

    [*(a1 + 32) setIsTransitioningFromQLPreviewToGrid:1];
    v12 = [*(a1 + 32) previewController];
    [v12 dismissViewControllerAnimated:0 completion:0];

    v13 = *(a1 + 32);
    v15[0] = MEMORY[0x1E69E9820];
    v15[1] = 3221225472;
    v15[2] = __84__CKChatController_PhotosSupport__presentedPreviewControllerDidSelectNavigateToGrid__block_invoke_2;
    v15[3] = &unk_1E72EB8D0;
    v15[4] = v13;
    v16 = v9;
    v14 = v9;
    [v13 presentViewController:v5 animated:1 completion:v15];

LABEL_6:
    goto LABEL_7;
  }

  if (a3 != 1)
  {
    v8 = IMLogHandleForCategory();
    if (os_log_type_enabled(v8, OS_LOG_TYPE_ERROR))
    {
      __84__CKChatController_PhotosSupport__presentedPreviewControllerDidSelectNavigateToGrid__block_invoke_cold_1(a1, a3);
    }

    goto LABEL_6;
  }

LABEL_7:
}

uint64_t __84__CKChatController_PhotosSupport__presentedPreviewControllerDidSelectNavigateToGrid__block_invoke_2(uint64_t a1)
{
  [*(a1 + 32) setIsTransitioningFromQLPreviewToGrid:0];
  v2 = *(a1 + 40);

  return [v2 removeFromSuperview];
}

- (void)presentedPreviewControllerDidSelectDismissToGrid
{
  previewController = [(CKChatController *)self previewController];
  [previewController dismissViewControllerAnimated:1 completion:0];
}

- (id)_previewViewControllerForAssetReference:(id)reference photosViewController:(id)controller previewMode:(int64_t)mode
{
  controllerCopy = controller;
  referenceCopy = reference;
  viewModel = [controllerCopy viewModel];
  currentDataSource = [viewModel currentDataSource];

  v12 = [(CKChatController *)self _previewViewControllerForAssetReference:referenceCopy dataSource:currentDataSource previewDelegate:controllerCopy previewMode:mode];

  return v12;
}

- (id)_previewViewControllerForAssetReference:(id)reference dataSource:(id)source previewDelegate:(id)delegate previewMode:(int64_t)mode
{
  referenceCopy = reference;
  sourceCopy = source;
  delegateCopy = delegate;
  v13 = objc_alloc_init(CKQLPreviewController);
  objc_opt_class();
  if (objc_opt_isKindOfClass())
  {
    [(CKQLPreviewController *)v13 setChatControllerPreviewDelegate:self];
  }

  [(QLPreviewController *)v13 setDelegate:delegateCopy];
  v14 = objc_alloc_init(CKQLPreviewControllerDataSource);
  objc_opt_class();
  if (objc_opt_isKindOfClass())
  {
    mediaObjects = [sourceCopy mediaObjects];
    [(CKQLPreviewControllerDataSource *)v14 setPreviewItems:mediaObjects];

    [(QLPreviewController *)v13 setDataSource:v14];
    [(CKChatController *)self setQlPreviewDataSource:v14];
    if (referenceCopy)
    {
      [referenceCopy indexPath];
      v16 = v28;
    }

    else
    {
      v16 = 0;
      v27[1] = 0u;
      v28 = 0u;
    }

    [(QLPreviewController *)v13 setCurrentPreviewItemIndex:v16];
    [(CKChatController *)self setPreviewController:v13];
    entryView = [(CKChatController *)self entryView];
    contentView = [entryView contentView];
    -[CKChatController setEntryViewWasActiveOnPreview:](self, "setEntryViewWasActiveOnPreview:", [contentView isActive]);

    if (![(CKChatController *)self photosGridViewPresented])
    {
      v27[0].receiver = self;
      v27[0].super_class = CKChatController;
      [(objc_super *)v27 becomeFirstResponder];
    }

    v21 = objc_alloc(MEMORY[0x1E69DC708]);
    v22 = [MEMORY[0x1E69DCAB8] systemImageNamed:@"square.grid.2x2"];
    v23 = &selRef_presentedPreviewControllerDidSelectNavigateToGrid;
    if (mode != 2)
    {
      v23 = &selRef_presentedPreviewControllerDidSelectDismissToGrid;
    }

    v24 = [v21 initWithImage:v22 style:0 target:self action:*v23];

    navigationItem = [(CKQLPreviewController *)v13 navigationItem];
    [navigationItem setLeftBarButtonItem:v24];

    v18 = v13;
  }

  else
  {
    v17 = IMLogHandleForCategory();
    if (os_log_type_enabled(v17, OS_LOG_TYPE_ERROR))
    {
      [CKChatController(PhotosSupport) _previewViewControllerForAssetReference:dataSource:previewDelegate:previewMode:];
    }

    v18 = 0;
  }

  return v18;
}

- (void)_presentPreviewViewControllerFromPhotosViewController:(id)controller assetReference:(id)reference
{
  controllerCopy = controller;
  referenceCopy = reference;
  v8 = [(CKChatController *)self _previewViewControllerForAssetReference:referenceCopy photosViewController:controllerCopy previewMode:0];
  if (v8)
  {
    [controllerCopy presentViewController:v8 animated:1 completion:0];
  }

  else
  {
    v9 = IMLogHandleForCategory();
    if (os_log_type_enabled(v9, OS_LOG_TYPE_ERROR))
    {
      [CKChatController(PhotosSupport) _presentPreviewViewControllerFromPhotosViewController:assetReference:];
    }
  }
}

- (BOOL)photosViewController:(id)controller didPickAssetReference:(id)reference
{
  controllerCopy = controller;
  referenceCopy = reference;
  [(CKChatController *)self _presentPreviewViewControllerFromPhotosViewController:controllerCopy assetReference:referenceCopy];

  return 1;
}

- (void)_showTapbackReplyOverlayFromPhotosViewController:(id)controller assetReference:(id)reference presentTapbackKeyboardInput:(BOOL)input
{
  inputCopy = input;
  referenceCopy = reference;
  controllerCopy = controller;
  v10 = [controllerCopy regionOfInterestForAssetReference:referenceCopy image:0 shouldSnapshotPlaceholder:0];
  view = [controllerCopy view];

  [v10 rectInCoordinateSpace:view];
  v13 = v12;
  v15 = v14;
  v17 = v16;
  v19 = v18;

  placeholderViewFactory = [v10 placeholderViewFactory];

  if (placeholderViewFactory)
  {
    placeholderViewFactory2 = [v10 placeholderViewFactory];
    placeholderViewFactory = (placeholderViewFactory2)[2](placeholderViewFactory2, v10);
  }

  [(CKChatController *)self setPhotoGridTapbackSnapshotRect:v13, v15, v17, v19];
  photoGridMomentShareChatItem = [(CKChatController *)self photoGridMomentShareChatItem];

  if (photoGridMomentShareChatItem)
  {
    photoGridMomentShareChatItem2 = [(CKChatController *)self photoGridMomentShareChatItem];
    dataSource = [photoGridMomentShareChatItem2 dataSource];
    chatItem = [dataSource chatItemForAssetReference:referenceCopy];

    if (chatItem)
    {
      goto LABEL_8;
    }

    photoGridMomentShareChatItem3 = [(CKChatController *)self photoGridMomentShareChatItem];
    dataSource2 = [photoGridMomentShareChatItem3 dataSource];
    chatItem = [dataSource2 temporaryChatItemForAssetReference:referenceCopy];
  }

  else
  {
    photoGridMomentShareChatItem3 = [referenceCopy asset];
    chatItem = [photoGridMomentShareChatItem3 chatItem];
  }

LABEL_8:
  v28 = [(CKChatController *)self _fullScreenBalloonViewControllerForPhotosGridViewWithChatItem:chatItem snapshotView:placeholderViewFactory presentTapbackKeyboardInput:inputCopy];
  [(CKCoreChatController *)self setFullScreenBalloonViewController:v28];
  v29 = IMLogHandleForCategory();
  if (os_log_type_enabled(v29, OS_LOG_TYPE_DEFAULT))
  {
    *v31 = 0;
    _os_log_impl(&dword_19020E000, v29, OS_LOG_TYPE_DEFAULT, "_fullScreenBalloonViewController has been set", v31, 2u);
  }

  [v28 setModalPresentationStyle:6];
  presentedViewController = [(CKChatController *)self presentedViewController];
  [presentedViewController presentViewController:v28 animated:0 completion:0];
}

- (void)photosViewController:(id)controller didDoubleTapAssetReference:(id)reference
{
  controllerCopy = controller;
  referenceCopy = reference;
  if ([(CKCoreChatController *)self _shouldAllowReply])
  {
    [(CKChatController *)self _showTapbackReplyOverlayFromPhotosViewController:controllerCopy assetReference:referenceCopy presentTapbackKeyboardInput:0];
  }
}

- (id)photosViewController:(id)controller dragItemProviderForAssetReference:(id)reference
{
  asset = [reference asset];
  objc_opt_class();
  if (objc_opt_isKindOfClass())
  {
    chatItem = [asset chatItem];
    dragItemProvider = [chatItem dragItemProvider];
  }

  else
  {
    dragItemProvider = 0;
  }

  return dragItemProvider;
}

- (void)actionManager:(id)manager presentInlineReplyControllerForChatItem:(id)item
{
  v6 = [(CKChatController *)self modalInlineReplyControllerForChatItem:item];
  photosGridViewController = [(CKChatController *)self photosGridViewController];
  if (photosGridViewController && v6)
  {
    [photosGridViewController presentViewController:v6 animated:1 completion:0];
  }
}

- (void)retractScheduledChatItem:(id)item
{
  itemCopy = item;
  iMChatItem = [itemCopy IMChatItem];
  objc_opt_class();
  isKindOfClass = objc_opt_isKindOfClass();

  if (isKindOfClass)
  {
    conversation = [(CKCoreChatController *)self conversation];
    iMChatItem2 = [itemCopy IMChatItem];
    [conversation retractMessagePart:iMChatItem2];
  }

  else
  {
    conversation = IMLogHandleForCategory();
    if (os_log_type_enabled(conversation, OS_LOG_TYPE_ERROR))
    {
      [CKChatController(PhotosSupport) retractScheduledChatItem:];
    }
  }
}

- (void)retractScheduledChatItems:(id)items fromAggregateChatItem:(id)item
{
  v33 = *MEMORY[0x1E69E9840];
  itemsCopy = items;
  itemCopy = item;
  iMChatItem = [itemCopy IMChatItem];
  objc_opt_class();
  isKindOfClass = objc_opt_isKindOfClass();

  if (isKindOfClass)
  {
    selfCopy = self;
    v24 = itemCopy;
    array = [MEMORY[0x1E695DF70] array];
    v28 = 0u;
    v29 = 0u;
    v30 = 0u;
    v31 = 0u;
    v25 = itemsCopy;
    v11 = itemsCopy;
    v12 = [v11 countByEnumeratingWithState:&v28 objects:v32 count:16];
    if (v12)
    {
      v13 = v12;
      v14 = *v29;
      do
      {
        for (i = 0; i != v13; ++i)
        {
          if (*v29 != v14)
          {
            objc_enumerationMutation(v11);
          }

          v16 = *(*(&v28 + 1) + 8 * i);
          iMChatItem2 = [v16 IMChatItem];
          objc_opt_class();
          v18 = objc_opt_isKindOfClass();

          if (v18)
          {
            iMChatItem3 = [v16 IMChatItem];
            [array addObject:iMChatItem3];
          }

          else
          {
            iMChatItem3 = IMLogHandleForCategory();
            if (os_log_type_enabled(iMChatItem3, OS_LOG_TYPE_ERROR))
            {
              [(CKChatController(PhotosSupport) *)&buf retractScheduledChatItems:v27 fromAggregateChatItem:iMChatItem3];
            }
          }
        }

        v13 = [v11 countByEnumeratingWithState:&v28 objects:v32 count:16];
      }

      while (v13);
    }

    conversation = [(CKCoreChatController *)selfCopy conversation];
    itemCopy = v24;
    iMChatItem4 = [v24 IMChatItem];
    if (iMChatItem4 && [array count])
    {
      [conversation retractScheduledMessageParts:array fromAggregateChatItem:iMChatItem4];
    }

    else
    {
      v22 = IMLogHandleForCategory();
      if (os_log_type_enabled(v22, OS_LOG_TYPE_ERROR))
      {
        [CKChatController(PhotosSupport) retractScheduledChatItems:fromAggregateChatItem:];
      }
    }

    itemsCopy = v25;
  }

  else
  {
    array = IMLogHandleForCategory();
    if (os_log_type_enabled(array, OS_LOG_TYPE_ERROR))
    {
      [CKChatController(PhotosSupport) retractScheduledChatItems:fromAggregateChatItem:];
    }
  }
}

- (void)deleteMediaObjectAttachmentGUIDs:(id)ds originalStackCount:(int64_t)count
{
  v12 = *MEMORY[0x1E69E9840];
  dsCopy = ds;
  v7 = IMLogHandleForCategory();
  if (os_log_type_enabled(v7, OS_LOG_TYPE_DEFAULT))
  {
    v10 = 138412290;
    v11 = dsCopy;
    _os_log_impl(&dword_19020E000, v7, OS_LOG_TYPE_DEFAULT, "deleting media object attachments %@", &v10, 0xCu);
  }

  chat = [(CKCoreChatController *)self chat];
  [chat deleteTransfers:dsCopy];

  v9 = count - [dsCopy count];
  if (v9 <= [MEMORY[0x1E69A5BF8] _attachmentStackAggregationThreshold])
  {
    [(CKChatController *)self dismissViewControllerAnimated:1 completion:0];
  }
}

- (id)_assetReferenceForDisplayedGridChatItem:(id)item selectionSnapshot:(id)snapshot
{
  v22 = *MEMORY[0x1E69E9840];
  itemCopy = item;
  snapshotCopy = snapshot;
  photosGridViewController = [(CKChatController *)self photosGridViewController];
  viewModel = [photosGridViewController viewModel];
  currentDataSource = [viewModel currentDataSource];

  objc_opt_class();
  if (objc_opt_isKindOfClass())
  {
    v11 = currentDataSource;
    mediaObject = [itemCopy mediaObject];
    v13 = [v11 assetReferenceForMediaObject:mediaObject];
    if (!v13)
    {
      v14 = IMLogHandleForCategory();
      if (os_log_type_enabled(v14, OS_LOG_TYPE_ERROR))
      {
        [CKChatController(PhotosSupport) _assetReferenceForDisplayedGridChatItem:mediaObject selectionSnapshot:?];
      }
    }
  }

  else
  {
    photoGridMomentShareChatItem = [(CKChatController *)self photoGridMomentShareChatItem];
    if (photoGridMomentShareChatItem && (v16 = photoGridMomentShareChatItem, objc_opt_class(), isKindOfClass = objc_opt_isKindOfClass(), v16, (isKindOfClass & 1) != 0))
    {
      if (snapshotCopy)
      {
        [snapshotCopy cursorIndexPath];
      }

      else
      {
        v20 = 0u;
        v21 = 0u;
      }

      v13 = [currentDataSource assetReferenceAtItemIndexPath:&v20];
      if (v13)
      {
        goto LABEL_15;
      }

      v11 = IMLogHandleForCategory();
      if (os_log_type_enabled(v11, OS_LOG_TYPE_ERROR))
      {
        if (snapshotCopy)
        {
          [snapshotCopy cursorIndexPath];
        }

        else
        {
          v20 = 0u;
          v21 = 0u;
        }

        v19 = PXSimpleIndexPathDescription();
        LODWORD(v20) = 138543362;
        *(&v20 + 4) = v19;
        _os_log_error_impl(&dword_19020E000, v11, OS_LOG_TYPE_ERROR, "nil asset reference for data source at index path %{public}@", &v20, 0xCu);
      }
    }

    else
    {
      v11 = IMLogHandleForCategory();
      if (os_log_type_enabled(v11, OS_LOG_TYPE_ERROR))
      {
        [CKChatController(PhotosSupport) _assetReferenceForDisplayedGridChatItem:selectionSnapshot:];
      }
    }

    v13 = 0;
  }

LABEL_15:

  return v13;
}

- (void)actionManager:(id)manager quickLookChatItem:(id)item
{
  itemCopy = item;
  managerCopy = manager;
  photosGridViewController = [(CKChatController *)self photosGridViewController];
  selectionManager = [managerCopy selectionManager];

  selectionSnapshot = [selectionManager selectionSnapshot];
  v11 = [(CKChatController *)self _assetReferenceForDisplayedGridChatItem:itemCopy selectionSnapshot:selectionSnapshot];

  if (v11)
  {
    [(CKChatController *)self _presentPreviewViewControllerFromPhotosViewController:photosGridViewController assetReference:v11];
  }

  else
  {
    v12 = IMLogHandleForCategory();
    if (os_log_type_enabled(v12, OS_LOG_TYPE_ERROR))
    {
      [CKChatController(PhotosSupport) actionManager:quickLookChatItem:];
    }
  }
}

- (void)actionManager:(id)manager tapbackChatItem:(id)item
{
  itemCopy = item;
  managerCopy = manager;
  photosGridViewController = [(CKChatController *)self photosGridViewController];
  selectionManager = [managerCopy selectionManager];

  selectionSnapshot = [selectionManager selectionSnapshot];
  v11 = [(CKChatController *)self _assetReferenceForDisplayedGridChatItem:itemCopy selectionSnapshot:selectionSnapshot];

  if (v11)
  {
    [(CKChatController *)self _showTapbackReplyOverlayFromPhotosViewController:photosGridViewController assetReference:v11 presentTapbackKeyboardInput:0];
  }

  else
  {
    v12 = IMLogHandleForCategory();
    if (os_log_type_enabled(v12, OS_LOG_TYPE_ERROR))
    {
      [CKChatController(PhotosSupport) actionManager:tapbackChatItem:];
    }
  }
}

- (id)actionManager:(id)manager tapbackElementsForChatItem:(id)item
{
  managerCopy = manager;
  itemCopy = item;
  photosGridViewController = [(CKChatController *)self photosGridViewController];
  selectionManager = [managerCopy selectionManager];
  selectionSnapshot = [selectionManager selectionSnapshot];
  v11 = [(CKChatController *)self _assetReferenceForDisplayedGridChatItem:itemCopy selectionSnapshot:selectionSnapshot];

  objc_initWeak(location, self);
  if (v11)
  {
    v25[0] = MEMORY[0x1E69E9820];
    v25[1] = 3221225472;
    v25[2] = __76__CKChatController_PhotosSupport__actionManager_tapbackElementsForChatItem___block_invoke;
    v25[3] = &unk_1E72F7068;
    objc_copyWeak(&v26, location);
    v21[0] = MEMORY[0x1E69E9820];
    v21[1] = 3221225472;
    v21[2] = __76__CKChatController_PhotosSupport__actionManager_tapbackElementsForChatItem___block_invoke_2;
    v21[3] = &unk_1E72F7090;
    objc_copyWeak(&v24, location);
    v12 = photosGridViewController;
    v22 = v12;
    v13 = v11;
    v23 = v13;
    v17[0] = MEMORY[0x1E69E9820];
    v17[1] = 3221225472;
    v17[2] = __76__CKChatController_PhotosSupport__actionManager_tapbackElementsForChatItem___block_invoke_3;
    v17[3] = &unk_1E72F7090;
    objc_copyWeak(&v20, location);
    v18 = v12;
    v19 = v13;
    v14 = [(CKChatController *)self buildTapbackMenuElementsForChatItem:itemCopy sendHandler:v25 emojiKeyboardHandler:v21 detailsHandler:v17];

    objc_destroyWeak(&v20);
    objc_destroyWeak(&v24);
    objc_destroyWeak(&v26);
  }

  else
  {
    v15 = IMLogHandleForCategory();
    if (os_log_type_enabled(v15, OS_LOG_TYPE_ERROR))
    {
      [CKChatController(PhotosSupport) actionManager:tapbackChatItem:];
    }

    v14 = MEMORY[0x1E695E0F0];
  }

  objc_destroyWeak(location);

  return v14;
}

void __76__CKChatController_PhotosSupport__actionManager_tapbackElementsForChatItem___block_invoke(uint64_t a1, void *a2, void *a3, uint64_t a4)
{
  v7 = a3;
  v8 = a2;
  WeakRetained = objc_loadWeakRetained((a1 + 32));
  [WeakRetained sendTapback:v8 chatItem:v7 isRemoval:a4];
}

void __76__CKChatController_PhotosSupport__actionManager_tapbackElementsForChatItem___block_invoke_2(uint64_t a1)
{
  WeakRetained = objc_loadWeakRetained((a1 + 48));
  [WeakRetained _showTapbackReplyOverlayFromPhotosViewController:*(a1 + 32) assetReference:*(a1 + 40) presentTapbackKeyboardInput:1];
}

void __76__CKChatController_PhotosSupport__actionManager_tapbackElementsForChatItem___block_invoke_3(uint64_t a1)
{
  WeakRetained = objc_loadWeakRetained((a1 + 48));
  [WeakRetained _showTapbackReplyOverlayFromPhotosViewController:*(a1 + 32) assetReference:*(a1 + 40) presentTapbackKeyboardInput:0];
}

- (void)actionManager:(id)manager copyChatItems:(id)items
{
  itemsCopy = items;
  collectionViewController = [(CKCoreChatController *)self collectionViewController];
  [collectionViewController copyChatItemsToPasteboard:itemsCopy];
}

- (void)actionManager:(id)manager forwardChatItems:(id)items
{
  itemsCopy = items;
  if ([(CKChatController *)self photosGridViewPresented])
  {
    [(CKChatController *)self dismissViewControllerAnimated:0 completion:0];
  }

  entryView = [(CKChatController *)self entryView];
  shouldShowSubject = [entryView shouldShowSubject];
  chatInputTranscriptIdentifier = [(CKChatController *)self chatInputTranscriptIdentifier];
  v10 = [CKComposition compositionForMessageParts:itemsCopy preserveSubject:shouldShowSubject contextIdentifier:chatInputTranscriptIdentifier];

  delegate = [(CKCoreChatController *)self delegate];
  [delegate chatController:self forwardComposition:v10];
}

- (void)selectAllForActionManager:(id)manager
{
  managerCopy = manager;
  photosGridViewController = [(CKChatController *)self photosGridViewController];
  viewModel = [photosGridViewController viewModel];
  v9 = 0;
  v10 = &v9;
  v11 = 0x2020000000;
  isInSelectMode = [viewModel isInSelectMode];
  v8[0] = MEMORY[0x1E69E9820];
  v8[1] = 3221225472;
  v8[2] = __61__CKChatController_PhotosSupport__selectAllForActionManager___block_invoke;
  v8[3] = &unk_1E72F70B8;
  v8[4] = &v9;
  [viewModel performChanges:v8];
  if ((v10[3] & 1) == 0)
  {
    v7 = IMLogHandleForCategory();
    if (os_log_type_enabled(v7, OS_LOG_TYPE_ERROR))
    {
      [CKChatController(PhotosSupport) selectAllForActionManager:];
    }
  }

  _Block_object_dispose(&v9, 8);
}

void __61__CKChatController_PhotosSupport__selectAllForActionManager___block_invoke(uint64_t a1, void *a2)
{
  v3 = a2;
  v4 = v3;
  v6 = v3;
  if ((*(*(*(a1 + 32) + 8) + 24) & 1) == 0)
  {
    v5 = [v3 canEnterSelectMode];
    v4 = v6;
    if (v5)
    {
      [v6 setIsInSelectMode:1];
      v4 = v6;
      *(*(*(a1 + 32) + 8) + 24) = 1;
    }
  }

  if (*(*(*(a1 + 32) + 8) + 24) == 1)
  {
    [v4 selectAll];
    v4 = v6;
  }
}

- (BOOL)actionPerformer:(id)performer transitionToViewController:(id)controller transitionType:(int64_t)type
{
  performerCopy = performer;
  controllerCopy = controller;
  if (type == 1)
  {
    presentedViewController = [(CKChatController *)self presentedViewController];
    navigationController = [presentedViewController navigationController];

    v11 = navigationController != 0;
    if (navigationController)
    {
      v11 = 1;
      [navigationController pushViewController:controllerCopy animated:1];
    }
  }

  else
  {
    if (type != 2)
    {
      v11 = 0;
      goto LABEL_8;
    }

    navigationController = [(CKChatController *)self presentedViewController];
    v11 = 1;
    [navigationController presentViewController:controllerCopy animated:1 completion:0];
  }

LABEL_8:
  return v11;
}

- (BOOL)photosGridViewPresented
{
  photosGridViewController = [(CKChatController *)self photosGridViewController];
  v3 = photosGridViewController != 0;

  return v3;
}

- (id)photosGridViewController
{
  v17 = *MEMORY[0x1E69E9840];
  presentedViewController = [(CKChatController *)self presentedViewController];
  if (presentedViewController)
  {
    presentedViewController2 = [(CKChatController *)self presentedViewController];
    objc_opt_class();
    isKindOfClass = objc_opt_isKindOfClass();

    if (isKindOfClass)
    {
      v14 = 0u;
      v15 = 0u;
      v12 = 0u;
      v13 = 0u;
      presentedViewController3 = [(CKChatController *)self presentedViewController];
      viewControllers = [presentedViewController3 viewControllers];

      presentedViewController = [viewControllers countByEnumeratingWithState:&v12 objects:v16 count:16];
      if (presentedViewController)
      {
        v8 = *v13;
        while (2)
        {
          for (i = 0; i != presentedViewController; i = i + 1)
          {
            if (*v13 != v8)
            {
              objc_enumerationMutation(viewControllers);
            }

            v10 = *(*(&v12 + 1) + 8 * i);
            objc_opt_class();
            if (objc_opt_isKindOfClass())
            {
              presentedViewController = v10;
              goto LABEL_14;
            }
          }

          presentedViewController = [viewControllers countByEnumeratingWithState:&v12 objects:v16 count:16];
          if (presentedViewController)
          {
            continue;
          }

          break;
        }
      }

LABEL_14:
    }

    else
    {
      presentedViewController = 0;
    }
  }

  return presentedViewController;
}

- (id)_fullScreenBalloonViewControllerForPhotosGridViewWithChatItem:(id)item snapshotView:(id)view presentTapbackKeyboardInput:(BOOL)input
{
  inputCopy = input;
  viewCopy = view;
  itemCopy = item;
  if (inputCopy)
  {
    +[CKFullScreenBalloonViewDisplayConfiguration tapbackKeyboardInputContext];
  }

  else
  {
    +[CKFullScreenBalloonViewDisplayConfiguration tapbackPickerContext];
  }
  v10 = ;
  [v10 setShouldHideBalloonTail:1];
  [v10 setSnapshotView:viewCopy];

  v11 = [CKFullScreenBalloonViewControllerPhone alloc];
  v12 = [(CKChatController *)self _interfaceActionsForChatItem:itemCopy];
  v13 = [(CKFullScreenBalloonViewControllerPhone *)v11 initWithChatItem:itemCopy interfaceActions:v12 displayConfiguration:v10 delegate:self];

  return v13;
}

- (id)currentTopChatItemForAggregateChatItem:(id)item
{
  itemCopy = item;
  collectionViewController = [(CKCoreChatController *)self collectionViewController];
  v6 = [collectionViewController balloonViewForChatItem:itemCopy];

  objc_opt_class();
  chatItem = itemCopy;
  if (objc_opt_isKindOfClass())
  {
    stackView = [v6 stackView];
    currentAssetReference = [stackView currentAssetReference];
    asset = [currentAssetReference asset];
    chatItem = [asset chatItem];
  }

  return chatItem;
}

- (void)photosGridFullScreenBalloonViewControllerHandleDismissTap:(id)tap
{
  v3.receiver = self;
  v3.super_class = CKChatController;
  [(CKCoreChatController *)&v3 fullScreenBalloonViewControllerHandleDismissTap:tap];
}

- (void)photosGridFullScreenBalloonViewController:(id)controller verticallyScrollTranscriptByAmount:(double)amount animated:(BOOL)animated duration:(double)duration completion:(id)completion
{
  if (completion)
  {
    (*(completion + 2))(completion, amount, duration);
  }
}

- (void)photosGridFullScreenBalloonViewController:(id)controller replyButtonPressedForChatItem:(id)item
{
  controllerCopy = controller;
  itemCopy = item;
  v10[0] = MEMORY[0x1E69E9820];
  v10[1] = 3221225472;
  v10[2] = __107__CKChatController_PhotosSupport__photosGridFullScreenBalloonViewController_replyButtonPressedForChatItem___block_invoke;
  v10[3] = &unk_1E72EB880;
  v10[4] = self;
  v11 = itemCopy;
  v12 = controllerCopy;
  v8 = controllerCopy;
  v9 = itemCopy;
  [(CKChatController *)self _dismissFullScreenBubbleViewControllerAnimated:1 withSendAnimation:0 completion:v10];
}

- (BOOL)photosGridFullScreenBalloonViewControllerShouldShowReplyButton:(id)button
{
  v4.receiver = self;
  v4.super_class = CKChatController;
  return [(CKCoreChatController *)&v4 fullScreenBalloonViewControllerShouldShowReplyButton:button];
}

- (CGRect)photosGridFullScreenBalloonViewControllerSafeAreaLayoutFrame:(id)frame
{
  presentedViewController = [(CKChatController *)self presentedViewController];
  safeAreaLayoutGuide = [presentedViewController safeAreaLayoutGuide];
  [safeAreaLayoutGuide layoutFrame];
  v6 = v5;
  v8 = v7;
  v10 = v9;
  v12 = v11;

  v13 = v6;
  v14 = v8;
  v15 = v10;
  v16 = v12;
  result.size.height = v16;
  result.size.width = v15;
  result.origin.y = v14;
  result.origin.x = v13;
  return result;
}

- (id)photosViewController:(id)controller configurationForContextMenuInteraction:(id)interaction assetReference:(id)reference
{
  controllerCopy = controller;
  interactionCopy = interaction;
  referenceCopy = reference;
  v11 = controllerCopy;
  objc_initWeak(&location, self);
  v12 = MEMORY[0x1E69DC8D8];
  v23[0] = MEMORY[0x1E69E9820];
  v23[1] = 3221225472;
  v23[2] = __110__CKChatController_PhotosSupport__photosViewController_configurationForContextMenuInteraction_assetReference___block_invoke;
  v23[3] = &unk_1E72F70E0;
  objc_copyWeak(&v26, &location);
  v13 = referenceCopy;
  v24 = v13;
  v14 = v11;
  v25 = v14;
  v19[0] = MEMORY[0x1E69E9820];
  v19[1] = 3221225472;
  v19[2] = __110__CKChatController_PhotosSupport__photosViewController_configurationForContextMenuInteraction_assetReference___block_invoke_2;
  v19[3] = &unk_1E72F7108;
  objc_copyWeak(&v22, &location);
  v15 = v13;
  v20 = v15;
  v16 = v14;
  v21 = v16;
  v17 = [v12 configurationWithIdentifier:0 previewProvider:v23 actionProvider:v19];

  objc_destroyWeak(&v22);
  objc_destroyWeak(&v26);
  objc_destroyWeak(&location);

  return v17;
}

id __110__CKChatController_PhotosSupport__photosViewController_configurationForContextMenuInteraction_assetReference___block_invoke(uint64_t a1)
{
  WeakRetained = objc_loadWeakRetained((a1 + 48));
  v3 = [WeakRetained _previewViewControllerForAssetReference:*(a1 + 32) photosViewController:*(a1 + 40) previewMode:1];

  return v3;
}

id __110__CKChatController_PhotosSupport__photosViewController_configurationForContextMenuInteraction_assetReference___block_invoke_2(id *a1)
{
  WeakRetained = objc_loadWeakRetained(a1 + 6);
  if (!WeakRetained)
  {
    goto LABEL_5;
  }

  v3 = [a1[4] asset];
  objc_opt_class();
  if (objc_opt_isKindOfClass())
  {
    v4 = [a1[4] asset];
    v5 = [(CKMediaObjectAssetActionManager *)v4 chatItem];
    objc_opt_class();
    if (objc_opt_isKindOfClass())
    {
      v6 = [a1[5] viewModel];
      v7 = [v6 isInSelectMode];

      if (v7)
      {
LABEL_5:
        v8 = 0;
        goto LABEL_11;
      }

      v9 = [a1[4] asset];
      v3 = [v9 chatItem];

      v4 = -[CKMediaObjectAssetActionManager initWithChatItem:presentedFromInlineReply:chatActionHelper:selectionManager:]([CKMediaObjectAssetActionManager alloc], "initWithChatItem:presentedFromInlineReply:chatActionHelper:selectionManager:", v3, [WeakRetained isInline], WeakRetained, 0);
      [WeakRetained setPhotoGridClickyOrbChatItem:v3];
      [(PXActionManager *)v4 setPerformerDelegate:WeakRetained];
      v8 = [(CKMediaObjectAssetActionManager *)v4 actionContextMenu];
    }

    else
    {

      v8 = 0;
    }
  }

  else
  {
    v8 = 0;
  }

LABEL_11:

  return v8;
}

- (void)photosViewController:(id)controller commitPreviewViewControllerForContextMenuInteraction:(id)interaction
{
  controllerCopy = controller;
  previewController = [(CKChatController *)self previewController];
  if (previewController)
  {
    [controllerCopy presentViewController:previewController animated:0 completion:0];
  }
}

- (id)photosViewController:(id)controller accessoriesForContextMenuInteraction:(id)interaction assetReference:(id)reference
{
  controllerCopy = controller;
  referenceCopy = reference;
  asset = [referenceCopy asset];
  objc_opt_class();
  isKindOfClass = objc_opt_isKindOfClass();

  if ((isKindOfClass & 1) != 0 && ([referenceCopy asset], v11 = objc_claimAutoreleasedReturnValue(), objc_msgSend(v11, "chatItem"), v12 = objc_claimAutoreleasedReturnValue(), v11, v12))
  {
    objc_opt_class();
    if (objc_opt_isKindOfClass())
    {
      selfCopy = controllerCopy;
    }

    else
    {
      selfCopy = self;
    }

    v14 = [(CKChatController *)self contextMenuAccessoryViewsForChatItem:v12 containingViewController:selfCopy];
  }

  else
  {
    v14 = 0;
  }

  return v14;
}

- (void)photosViewController:(id)controller contextMenuInteraction:(id)interaction willEndForConfiguration:(id)configuration animator:(id)animator
{
  if ([(CKChatController *)self acknowledgmentToSend:controller])
  {
    chat = [(CKCoreChatController *)self chat];
    acknowledgmentToSend = [(CKChatController *)self acknowledgmentToSend];
    photoGridClickyOrbChatItem = [(CKChatController *)self photoGridClickyOrbChatItem];
    [chat sendMessageAcknowledgment:acknowledgmentToSend forChatItem:photoGridClickyOrbChatItem];

    [(CKChatController *)self setAcknowledgmentToSend:0];
  }

  [(CKChatController *)self setPhotoGridClickyOrbChatItem:0];
}

- (id)photosViewController:(id)controller contextMenuInteraction:(id)interaction styleForMenuWithConfiguration:(id)configuration
{
  controllerCopy = controller;
  defaultStyle = [MEMORY[0x1E69DD440] defaultStyle];
  v7 = controllerCopy;
  view = [v7 view];
  [view layoutMargins];
  v10 = v9;
  v12 = v11;
  v14 = v13;

  view2 = [v7 view];

  window = [view2 window];
  [window safeAreaInsets];
  v18 = v17;
  v19 = +[CKUIBehavior sharedBehaviors];
  [v19 messageAcknowledgmentPickerBarSize];
  v21 = v18 + v20;

  v22 = +[CKUIBehavior sharedBehaviors];
  [v22 attributionViewHeight];
  v24 = v23;
  v25 = +[CKUIBehavior sharedBehaviors];
  [v25 attributionViewMinPadding];
  v27 = v21 + v24 + v26;

  [defaultStyle preferredEdgeInsets];
  [defaultStyle setPreferredEdgeInsets:{fmax(v28, v27), v10, v12, v14}];

  return defaultStyle;
}

- (void)tapbackPileViewTapped:(id)tapped asset:(id)asset
{
  v17 = *MEMORY[0x1E69E9840];
  tappedCopy = tapped;
  assetCopy = asset;
  if (IMOSLoggingEnabled())
  {
    v8 = OSLogHandleForIMFoundationCategory();
    if (os_log_type_enabled(v8, OS_LOG_TYPE_INFO))
    {
      v15 = 138412290;
      v16 = tappedCopy;
      _os_log_impl(&dword_19020E000, v8, OS_LOG_TYPE_INFO, "Detected tap on view: %@", &v15, 0xCu);
    }
  }

  photosGridViewController = [(CKChatController *)self photosGridViewController];
  viewModel = [photosGridViewController viewModel];
  currentDataSource = [viewModel currentDataSource];

  objc_opt_class();
  if (objc_opt_isKindOfClass())
  {
    v12 = currentDataSource;
    mediaObject = [assetCopy mediaObject];
    v14 = [v12 assetReferenceForMediaObject:mediaObject];

    [(CKChatController *)self _showTapbackReplyOverlayFromPhotosViewController:photosGridViewController assetReference:v14 presentTapbackKeyboardInput:0];
  }
}

- (id)addContactOptionsMenuWithNicknameUpdate:(id)update
{
  v4 = MEMORY[0x1E695DF70];
  updateCopy = update;
  v6 = objc_alloc_init(v4);
  v7 = [(CKChatController *)self createNewContactActionWithNicknameUpdate:updateCopy];
  [v6 addObject:v7];

  v8 = [(CKChatController *)self addToExistingContactActionWithNicknameUpdate:updateCopy];

  [v6 addObject:v8];
  v9 = MEMORY[0x1E69DCC60];
  v10 = [v6 copy];
  v11 = [v9 menuWithTitle:&stru_1F04268F8 children:v10];

  return v11;
}

- (id)createNewContactActionWithNicknameUpdate:(id)update
{
  updateCopy = update;
  v5 = CKFrameworkBundle();
  v6 = [v5 localizedStringForKey:@"CREATE_NEW_CONTACT" value:&stru_1F04268F8 table:@"ChatKit"];

  v7 = [MEMORY[0x1E69DCAB8] systemImageNamed:@"person.crop.circle"];
  objc_initWeak(&location, self);
  aBlock[0] = MEMORY[0x1E69E9820];
  aBlock[1] = 3221225472;
  aBlock[2] = __71__CKChatController_Contacts__createNewContactActionWithNicknameUpdate___block_invoke;
  aBlock[3] = &unk_1E72EBF48;
  objc_copyWeak(&v14, &location);
  v8 = updateCopy;
  v13 = v8;
  v9 = _Block_copy(aBlock);
  v10 = [MEMORY[0x1E69DC628] actionWithTitle:v6 image:v7 identifier:v6 handler:v9];

  objc_destroyWeak(&v14);
  objc_destroyWeak(&location);

  return v10;
}

void __71__CKChatController_Contacts__createNewContactActionWithNicknameUpdate___block_invoke(uint64_t a1)
{
  WeakRetained = objc_loadWeakRetained((a1 + 40));
  [WeakRetained createContactWithNicknameUpdate:*(a1 + 32)];
}

- (id)addToExistingContactActionWithNicknameUpdate:(id)update
{
  updateCopy = update;
  v5 = CKFrameworkBundle();
  v6 = [v5 localizedStringForKey:@"ADD_TO_EXISTING_CONTACT" value:&stru_1F04268F8 table:@"ChatKit"];

  v7 = [MEMORY[0x1E69DCAB8] systemImageNamed:@"person.crop.circle.badge.plus"];
  objc_initWeak(&location, self);
  aBlock[0] = MEMORY[0x1E69E9820];
  aBlock[1] = 3221225472;
  aBlock[2] = __75__CKChatController_Contacts__addToExistingContactActionWithNicknameUpdate___block_invoke;
  aBlock[3] = &unk_1E72EBF48;
  objc_copyWeak(&v14, &location);
  v8 = updateCopy;
  v13 = v8;
  v9 = _Block_copy(aBlock);
  v10 = [MEMORY[0x1E69DC628] actionWithTitle:v6 image:v7 identifier:v6 handler:v9];

  objc_destroyWeak(&v14);
  objc_destroyWeak(&location);

  return v10;
}

void __75__CKChatController_Contacts__addToExistingContactActionWithNicknameUpdate___block_invoke(uint64_t a1)
{
  v2 = *(a1 + 32);
  WeakRetained = objc_loadWeakRetained((a1 + 40));
  [WeakRetained setCurrentNicknameUpdate:v2];

  v4 = objc_loadWeakRetained((a1 + 40));
  [v4 selectContact];
}

- (void)showUpdatePromptForNicknameUpdate:(id)update sourceView:(id)view completionBlock:(id)block
{
  updateCopy = update;
  blockCopy = block;
  viewCopy = view;
  v10 = CKFrameworkBundle();
  v50 = [v10 localizedStringForKey:@"UPDATE_PHOTO_AND_NAME_TITLE" value:&stru_1F04268F8 table:@"ChatKit"];

  v11 = [CKAlertController alertControllerWithTitle:v50 message:0 preferredStyle:0];
  nickname = [updateCopy nickname];
  v13 = [(CKChatController *)self contactForNickname:nickname];

  v14 = CKFrameworkBundle();
  v15 = [v14 localizedStringForKey:@"NAME_AND_PHOTO" value:&stru_1F04268F8 table:@"ChatKit"];
  v61[0] = MEMORY[0x1E69E9820];
  v61[1] = 3221225472;
  v61[2] = __91__CKChatController_Contacts__showUpdatePromptForNicknameUpdate_sourceView_completionBlock___block_invoke;
  v61[3] = &unk_1E72EDA18;
  v61[4] = self;
  v16 = v13;
  v62 = v16;
  v17 = updateCopy;
  v63 = v17;
  v18 = blockCopy;
  v64 = v18;
  v19 = [CKAlertAction actionWithTitle:v15 style:0 handler:v61];
  [v11 addAction:v19];

  v20 = CKFrameworkBundle();
  v21 = [v20 localizedStringForKey:@"PHOTO_ONLY" value:&stru_1F04268F8 table:@"ChatKit"];
  v57[0] = MEMORY[0x1E69E9820];
  v57[1] = 3221225472;
  v57[2] = __91__CKChatController_Contacts__showUpdatePromptForNicknameUpdate_sourceView_completionBlock___block_invoke_2;
  v57[3] = &unk_1E72EDA18;
  v57[4] = self;
  v22 = v16;
  v58 = v22;
  v23 = v17;
  v59 = v23;
  v24 = v18;
  v60 = v24;
  v25 = [CKAlertAction actionWithTitle:v21 style:0 handler:v57];
  [v11 addAction:v25];

  v26 = CKFrameworkBundle();
  v27 = [v26 localizedStringForKey:@"NAME_ONLY" value:&stru_1F04268F8 table:@"ChatKit"];
  v53[0] = MEMORY[0x1E69E9820];
  v53[1] = 3221225472;
  v53[2] = __91__CKChatController_Contacts__showUpdatePromptForNicknameUpdate_sourceView_completionBlock___block_invoke_3;
  v53[3] = &unk_1E72EDA18;
  v53[4] = self;
  v54 = v22;
  v55 = v23;
  v28 = v24;
  v56 = v28;
  v29 = v23;
  v30 = v22;
  v31 = [CKAlertAction actionWithTitle:v27 style:0 handler:v53];
  [v11 addAction:v31];

  v32 = CKFrameworkBundle();
  v33 = [v32 localizedStringForKey:@"CANCEL" value:&stru_1F04268F8 table:@"ChatKit"];
  v51[0] = MEMORY[0x1E69E9820];
  v51[1] = 3221225472;
  v51[2] = __91__CKChatController_Contacts__showUpdatePromptForNicknameUpdate_sourceView_completionBlock___block_invoke_4;
  v51[3] = &unk_1E72EC218;
  v52 = v28;
  v34 = v28;
  v35 = [CKAlertAction actionWithTitle:v33 style:1 handler:v51];
  [v11 addAction:v35];

  popoverPresentationController = [v11 popoverPresentationController];
  view = [(CKChatController *)self view];
  [popoverPresentationController setSourceView:view];

  popoverPresentationController2 = [v11 popoverPresentationController];
  view2 = [(CKChatController *)self view];
  [viewCopy frame];
  v41 = v40;
  v43 = v42;
  v45 = v44;
  v47 = v46;
  superview = [viewCopy superview];

  [view2 convertRect:superview fromView:{v41, v43, v45, v47}];
  [popoverPresentationController2 setSourceRect:?];

  [v11 presentFromViewController:self animated:1 completion:0];
}

uint64_t __91__CKChatController_Contacts__showUpdatePromptForNicknameUpdate_sourceView_completionBlock___block_invoke(uint64_t a1)
{
  [*(a1 + 32) updateContact:*(a1 + 40) withNicknameUpdate:*(a1 + 48) updateType:6 addHandleToContact:0 presentationMode:3];
  result = *(a1 + 56);
  if (result)
  {
    v3 = *(result + 16);

    return v3();
  }

  return result;
}

uint64_t __91__CKChatController_Contacts__showUpdatePromptForNicknameUpdate_sourceView_completionBlock___block_invoke_2(uint64_t a1)
{
  [*(a1 + 32) updateContact:*(a1 + 40) withNicknameUpdate:*(a1 + 48) updateType:4 addHandleToContact:0 presentationMode:3];
  result = *(a1 + 56);
  if (result)
  {
    v3 = *(result + 16);

    return v3();
  }

  return result;
}

uint64_t __91__CKChatController_Contacts__showUpdatePromptForNicknameUpdate_sourceView_completionBlock___block_invoke_3(uint64_t a1)
{
  [*(a1 + 32) updateContact:*(a1 + 40) withNicknameUpdate:*(a1 + 48) updateType:2 addHandleToContact:0 presentationMode:3];
  result = *(a1 + 56);
  if (result)
  {
    v3 = *(result + 16);

    return v3();
  }

  return result;
}

uint64_t __91__CKChatController_Contacts__showUpdatePromptForNicknameUpdate_sourceView_completionBlock___block_invoke_4(uint64_t a1)
{
  result = *(a1 + 32);
  if (result)
  {
    return (*(result + 16))(result, 0);
  }

  return result;
}

- (void)updateContactQuietlyForNicknameUpdate:(id)update updateType:(unint64_t)type
{
  updateCopy = update;
  nickname = [updateCopy nickname];
  v8 = [(CKChatController *)self contactForNickname:nickname];

  [(CKChatController *)self updateContact:v8 withNicknameUpdate:updateCopy updateType:type addHandleToContact:0 presentationMode:3];
}

- (id)updateOptionsMenuForContact:(id)contact withNicknameUpdate:(id)update withCompletionBlock:(id)block
{
  v8 = MEMORY[0x1E695DF70];
  blockCopy = block;
  updateCopy = update;
  contactCopy = contact;
  v12 = objc_alloc_init(v8);
  v13 = [(CKChatController *)self nameAndPhotoForContact:contactCopy andNicknameUpdate:updateCopy withCompletionBlock:blockCopy];
  [v12 addObject:v13];

  v14 = [(CKChatController *)self nameOnlyForContact:contactCopy andNicknameUpdate:updateCopy withCompletionBlock:blockCopy];
  [v12 addObject:v14];

  v15 = [(CKChatController *)self photoOnlyForContact:contactCopy andNicknameUpdate:updateCopy withCompletionBlock:blockCopy];

  [v12 addObject:v15];
  v16 = MEMORY[0x1E69DCC60];
  v17 = [v12 copy];
  v18 = [v16 menuWithTitle:&stru_1F04268F8 children:v17];

  return v18;
}

- (id)nameAndPhotoForContact:(id)contact andNicknameUpdate:(id)update withCompletionBlock:(id)block
{
  contactCopy = contact;
  updateCopy = update;
  blockCopy = block;
  v11 = CKFrameworkBundle();
  v12 = [v11 localizedStringForKey:@"NAME_AND_PHOTO" value:&stru_1F04268F8 table:@"ChatKit"];

  objc_initWeak(&location, self);
  aBlock[0] = MEMORY[0x1E69E9820];
  aBlock[1] = 3221225472;
  aBlock[2] = __91__CKChatController_Contacts__nameAndPhotoForContact_andNicknameUpdate_withCompletionBlock___block_invoke;
  aBlock[3] = &unk_1E72F77A0;
  objc_copyWeak(&v23, &location);
  v13 = contactCopy;
  v20 = v13;
  v14 = updateCopy;
  v21 = v14;
  v15 = blockCopy;
  v22 = v15;
  v16 = _Block_copy(aBlock);
  v17 = [MEMORY[0x1E69DC628] actionWithTitle:v12 image:0 identifier:v12 handler:v16];

  objc_destroyWeak(&v23);
  objc_destroyWeak(&location);

  return v17;
}

uint64_t __91__CKChatController_Contacts__nameAndPhotoForContact_andNicknameUpdate_withCompletionBlock___block_invoke(uint64_t a1)
{
  WeakRetained = objc_loadWeakRetained((a1 + 56));
  [WeakRetained updateContact:*(a1 + 32) withNicknameUpdate:*(a1 + 40) updateType:6 addHandleToContact:0 presentationMode:3];

  v3 = *(*(a1 + 48) + 16);

  return v3();
}

- (id)nameOnlyForContact:(id)contact andNicknameUpdate:(id)update withCompletionBlock:(id)block
{
  contactCopy = contact;
  updateCopy = update;
  blockCopy = block;
  v11 = CKFrameworkBundle();
  v12 = [v11 localizedStringForKey:@"NAME_ONLY" value:&stru_1F04268F8 table:@"ChatKit"];

  objc_initWeak(&location, self);
  aBlock[0] = MEMORY[0x1E69E9820];
  aBlock[1] = 3221225472;
  aBlock[2] = __87__CKChatController_Contacts__nameOnlyForContact_andNicknameUpdate_withCompletionBlock___block_invoke;
  aBlock[3] = &unk_1E72F77A0;
  objc_copyWeak(&v23, &location);
  v13 = contactCopy;
  v20 = v13;
  v14 = updateCopy;
  v21 = v14;
  v15 = blockCopy;
  v22 = v15;
  v16 = _Block_copy(aBlock);
  v17 = [MEMORY[0x1E69DC628] actionWithTitle:v12 image:0 identifier:v12 handler:v16];

  objc_destroyWeak(&v23);
  objc_destroyWeak(&location);

  return v17;
}

uint64_t __87__CKChatController_Contacts__nameOnlyForContact_andNicknameUpdate_withCompletionBlock___block_invoke(uint64_t a1)
{
  WeakRetained = objc_loadWeakRetained((a1 + 56));
  [WeakRetained updateContact:*(a1 + 32) withNicknameUpdate:*(a1 + 40) updateType:2 addHandleToContact:0 presentationMode:3];

  v3 = *(*(a1 + 48) + 16);

  return v3();
}

- (id)photoOnlyForContact:(id)contact andNicknameUpdate:(id)update withCompletionBlock:(id)block
{
  contactCopy = contact;
  updateCopy = update;
  blockCopy = block;
  v11 = CKFrameworkBundle();
  v12 = [v11 localizedStringForKey:@"PHOTO_ONLY" value:&stru_1F04268F8 table:@"ChatKit"];

  objc_initWeak(&location, self);
  aBlock[0] = MEMORY[0x1E69E9820];
  aBlock[1] = 3221225472;
  aBlock[2] = __88__CKChatController_Contacts__photoOnlyForContact_andNicknameUpdate_withCompletionBlock___block_invoke;
  aBlock[3] = &unk_1E72F77A0;
  objc_copyWeak(&v23, &location);
  v13 = contactCopy;
  v20 = v13;
  v14 = updateCopy;
  v21 = v14;
  v15 = blockCopy;
  v22 = v15;
  v16 = _Block_copy(aBlock);
  v17 = [MEMORY[0x1E69DC628] actionWithTitle:v12 image:0 identifier:v12 handler:v16];

  objc_destroyWeak(&v23);
  objc_destroyWeak(&location);

  return v17;
}

uint64_t __88__CKChatController_Contacts__photoOnlyForContact_andNicknameUpdate_withCompletionBlock___block_invoke(uint64_t a1)
{
  WeakRetained = objc_loadWeakRetained((a1 + 56));
  [WeakRetained updateContact:*(a1 + 32) withNicknameUpdate:*(a1 + 40) updateType:4 addHandleToContact:0 presentationMode:3];

  v3 = *(*(a1 + 48) + 16);

  return v3();
}

- (id)contactForNickname:(id)nickname
{
  v3 = MEMORY[0x1E69A7FD0];
  nicknameCopy = nickname;
  sharedInstance = [v3 sharedInstance];
  handle = [nicknameCopy handle];

  v7 = [sharedInstance fetchCNContactForHandleWithID:handle];

  mEMORY[0x1E69A7FD0] = [MEMORY[0x1E69A7FD0] sharedInstance];
  keysForNicknameHandling = [MEMORY[0x1E69A7FD0] keysForNicknameHandling];
  v10 = [mEMORY[0x1E69A7FD0] completedContact:v7 withKeys:keysForNicknameHandling];

  return v10;
}

- (void)createContactWithNicknameUpdate:(id)update
{
  if (update)
  {
    [(CKChatController *)self updateContact:0 withNicknameUpdate:update updateType:*MEMORY[0x1E69A77E8] addHandleToContact:1 presentationMode:1];
  }
}

- (void)updateContact:(id)contact withNicknameUpdate:(id)update updateType:(unint64_t)type addHandleToContact:(BOOL)toContact presentationMode:(unint64_t)mode
{
  toContactCopy = toContact;
  v33 = *MEMORY[0x1E69E9840];
  contactCopy = contact;
  updateCopy = update;
  if (updateCopy)
  {
    v14 = [(CKCoreChatController *)self createMutableContact:contactCopy withNicknameUpdate:updateCopy updateType:type addHandleToContact:toContactCopy];
    if (mode <= 1)
    {
      if (mode)
      {
        if (mode == 1)
        {
          v15 = [MEMORY[0x1E695D148] viewControllerForNewContact:v14];
          mEMORY[0x1E69A7FD0] = [MEMORY[0x1E69A7FD0] sharedInstance];
          getContactStore = [mEMORY[0x1E69A7FD0] getContactStore];
          [v15 setContactStore:getContactStore];

          [v15 setDelegate:self];
          v18 = [objc_alloc(MEMORY[0x1E69DCCD8]) initWithRootViewController:v15];
          viewControllerToPresentFrom = [(CKChatController *)self viewControllerToPresentFrom];
LABEL_23:
          v26 = viewControllerToPresentFrom;
          [viewControllerToPresentFrom presentViewController:v18 animated:1 completion:0];

          goto LABEL_24;
        }

        goto LABEL_24;
      }

      if (!IMOSLoggingEnabled())
      {
        goto LABEL_24;
      }

      v23 = OSLogHandleForIMFoundationCategory();
      if (os_log_type_enabled(v23, OS_LOG_TYPE_INFO))
      {
        LOWORD(v29) = 0;
        _os_log_impl(&dword_19020E000, v23, OS_LOG_TYPE_INFO, "CKContactController_Nicknames: invalid presentation mode for updating contact!", &v29, 2u);
      }

LABEL_21:

      goto LABEL_24;
    }

    if (mode == 2)
    {
      v15 = [MEMORY[0x1E695D148] viewControllerForUpdatingContact:contactCopy withPropertiesFromContact:v14];
      mEMORY[0x1E69A7FD0]2 = [MEMORY[0x1E69A7FD0] sharedInstance];
      getContactStore2 = [mEMORY[0x1E69A7FD0]2 getContactStore];
      [v15 setContactStore:getContactStore2];

      [v15 setDelegate:self];
      v18 = [objc_alloc(MEMORY[0x1E69DCCD8]) initWithRootViewController:v15];
      viewControllerToPresentFrom = [(CKChatController *)self viewControllerToPresentFrom];
      goto LABEL_23;
    }

    if (mode != 3)
    {
LABEL_24:

      goto LABEL_25;
    }

    [(CKCoreChatController *)self saveContact:v14 shouldUpdate:contactCopy != 0];
    if ((~type & 6) != 0)
    {
      v27 = IMOSLoggingEnabled();
      if ((type & 2) != 0)
      {
        if (!v27)
        {
          goto LABEL_24;
        }

        v23 = OSLogHandleForIMFoundationCategory();
        if (os_log_type_enabled(v23, OS_LOG_TYPE_INFO))
        {
          LOWORD(v29) = 0;
          _os_log_impl(&dword_19020E000, v23, OS_LOG_TYPE_INFO, "Contact update mode silent with name update", &v29, 2u);
        }

        goto LABEL_21;
      }

      if (v27)
      {
        v28 = OSLogHandleForIMFoundationCategory();
        if (os_log_type_enabled(v28, OS_LOG_TYPE_INFO))
        {
          LOWORD(v29) = 0;
          _os_log_impl(&dword_19020E000, v28, OS_LOG_TYPE_INFO, "Contact update mode silent", &v29, 2u);
        }
      }
    }

    else if (IMOSLoggingEnabled())
    {
      v20 = OSLogHandleForIMFoundationCategory();
      if (os_log_type_enabled(v20, OS_LOG_TYPE_INFO))
      {
        LOWORD(v29) = 0;
        _os_log_impl(&dword_19020E000, v20, OS_LOG_TYPE_INFO, "Contact update mode silent with name and photo update", &v29, 2u);
      }
    }

    mEMORY[0x1E69A5C10] = [MEMORY[0x1E69A5C10] sharedInstance];
    handle = [updateCopy handle];
    [mEMORY[0x1E69A5C10] clearPendingNicknameUpdatesForHandle:handle forceClear:1];

    goto LABEL_24;
  }

  if (IMOSLoggingEnabled())
  {
    v14 = OSLogHandleForIMFoundationCategory();
    if (os_log_type_enabled(v14, OS_LOG_TYPE_INFO))
    {
      v29 = 138412546;
      v30 = contactCopy;
      v31 = 2112;
      v32 = 0;
      _os_log_impl(&dword_19020E000, v14, OS_LOG_TYPE_INFO, "CKChatController_Nicknames: unable to update contact %@ with nickname update %@", &v29, 0x16u);
    }

    goto LABEL_24;
  }

LABEL_25:
}

- (void)contactViewController:(id)controller didCompleteWithContact:(id)contact
{
  controllerCopy = controller;
  acceptedContactBanner = [(CKChatController *)self acceptedContactBanner];

  if (acceptedContactBanner)
  {
    [(CKChatController *)self dismissController:controllerCopy withCompletion:0];

    conversation = [(CKCoreChatController *)self conversation];
    chat = [conversation chat];
    [chat setValue:MEMORY[0x1E695E118] forChatProperty:*MEMORY[0x1E69A6AE8]];

    [(CKChatController *)self showOrHideAcceptedContactBannerIfNeeded];
  }

  else
  {
    presentingViewController = [controllerCopy presentingViewController];

    v14[0] = MEMORY[0x1E69E9820];
    v14[1] = 3221225472;
    v14[2] = __75__CKChatController_Contacts__contactViewController_didCompleteWithContact___block_invoke;
    v14[3] = &unk_1E72EBA18;
    v14[4] = self;
    [presentingViewController dismissViewControllerAnimated:1 completion:v14];

    if (contact)
    {
      mEMORY[0x1E69A5C10] = [MEMORY[0x1E69A5C10] sharedInstance];
      currentNicknameUpdate = [(CKChatController *)self currentNicknameUpdate];
      handle = [currentNicknameUpdate handle];
      [mEMORY[0x1E69A5C10] clearPendingNicknameUpdatesForHandle:handle forceClear:1];
    }

    [(CKChatController *)self becomeFirstResponder];
  }
}

uint64_t __75__CKChatController_Contacts__contactViewController_didCompleteWithContact___block_invoke(uint64_t a1)
{
  [*(a1 + 32) _showOrHideNicknameBannerIfNeeded];
  v2 = *(a1 + 32);

  return [v2 showOrHideAcceptedContactBannerIfNeeded];
}

- (void)selectContact
{
  viewControllerToPresentFrom = [(CKChatController *)self viewControllerToPresentFrom];
  contactPicker = [(CKChatController *)self contactPicker];
  [viewControllerToPresentFrom presentViewController:contactPicker animated:1 completion:0];
}

- (id)viewControllerToPresentFrom
{
  selfCopy = self;
  presentedViewController = [(CKChatController *)selfCopy presentedViewController];

  if (presentedViewController)
  {
    presentedViewController2 = [(CKChatController *)selfCopy presentedViewController];

    selfCopy = presentedViewController2;
  }

  return selfCopy;
}

- (void)dismissController:(id)controller withCompletion:(id)completion
{
  completionCopy = completion;
  presentingViewController = [controller presentingViewController];
  [presentingViewController dismissViewControllerAnimated:1 completion:completionCopy];
}

- (void)contactPicker:(id)picker didSelectContact:(id)contact
{
  pickerCopy = picker;
  contactCopy = contact;
  acceptedContactBanner = [(CKChatController *)self acceptedContactBanner];

  if (acceptedContactBanner)
  {
    v9 = objc_alloc_init(CKNicknameUpdate);
    chat = [(CKCoreChatController *)self chat];
    recipient = [chat recipient];
    [(CKNicknameUpdate *)v9 setHandle:recipient];

    v15[0] = MEMORY[0x1E69E9820];
    v15[1] = 3221225472;
    v15[2] = __61__CKChatController_Contacts__contactPicker_didSelectContact___block_invoke_2;
    v15[3] = &unk_1E72EB880;
    v15[4] = self;
    v16 = contactCopy;
    v17 = v9;
    v12 = v9;
    v13 = contactCopy;
    [(CKChatController *)self dismissController:pickerCopy withCompletion:v15];
  }

  else
  {
    v18[0] = MEMORY[0x1E69E9820];
    v18[1] = 3221225472;
    v18[2] = __61__CKChatController_Contacts__contactPicker_didSelectContact___block_invoke;
    v18[3] = &unk_1E72EB8D0;
    v18[4] = self;
    v19 = contactCopy;
    v14 = contactCopy;
    [(CKChatController *)self dismissController:pickerCopy withCompletion:v18];
  }
}

void __61__CKChatController_Contacts__contactPicker_didSelectContact___block_invoke(uint64_t a1)
{
  v1 = *(a1 + 32);
  v2 = *(a1 + 40);
  v3 = [v1 currentNicknameUpdate];
  [v1 updateContact:v2 withNicknameUpdate:v3 updateType:6 addHandleToContact:1 presentationMode:2];
}

- (void)updateContact:(id)contact withHandle:(id)handle
{
  v15[1] = *MEMORY[0x1E69E9840];
  contactCopy = contact;
  handleCopy = handle;
  v7 = handleCopy;
  if (contactCopy && [handleCopy length])
  {
    if ([v7 _appearsToBeEmail])
    {
      v8 = [MEMORY[0x1E695CEE0] labeledValueWithLabel:*MEMORY[0x1E695CB60] value:v7];
      emailAddresses = [contactCopy emailAddresses];

      if (!emailAddresses)
      {
        v15[0] = v8;
        emailAddresses2 = [MEMORY[0x1E695DEC8] arrayWithObjects:v15 count:1];
        [contactCopy setEmailAddresses:emailAddresses2];
LABEL_12:

        goto LABEL_13;
      }

      emailAddresses2 = [contactCopy emailAddresses];
      phoneNumbers2 = [emailAddresses2 arrayByAddingObject:v8];
      [contactCopy setEmailAddresses:phoneNumbers2];
LABEL_11:

      goto LABEL_12;
    }

    if ([v7 _appearsToBePhoneNumber])
    {
      v8 = [objc_alloc(MEMORY[0x1E695CF50]) initWithStringValue:v7];
      emailAddresses2 = [MEMORY[0x1E695CEE0] labeledValueWithLabel:*MEMORY[0x1E695CB90] value:v8];
      phoneNumbers = [contactCopy phoneNumbers];

      if (phoneNumbers)
      {
        phoneNumbers2 = [contactCopy phoneNumbers];
        v13 = [phoneNumbers2 arrayByAddingObject:emailAddresses2];
        [contactCopy setPhoneNumbers:v13];
      }

      else
      {
        v14 = emailAddresses2;
        phoneNumbers2 = [MEMORY[0x1E695DEC8] arrayWithObjects:&v14 count:1];
        [contactCopy setPhoneNumbers:phoneNumbers2];
      }

      goto LABEL_11;
    }
  }

LABEL_13:
}

- (void)_walletOrderImportControllerDismissed
{
  [(CKChatController *)self setWalletOrderImportViewController:0];
  [(CKChatController *)self becomeFirstResponder];
  firstResponder = [(CKChatController *)self firstResponder];
  [firstResponder reloadInputViews];

  collectionViewController = [(CKCoreChatController *)self collectionViewController];
  collectionView = [collectionViewController collectionView];
  [collectionView endHoldingContentOffsetUpdatesForReason:@"ChatControllerQuickLook"];
}

- (void)stageLocationRequestComposition
{
  mEMORY[0x1E69A8070] = [MEMORY[0x1E69A8070] sharedFeatureFlags];
  isWaldoEnabled = [mEMORY[0x1E69A8070] isWaldoEnabled];

  if (isWaldoEnabled)
  {
    MSMessageClass_0 = getMSMessageClass_0();
    if (objc_opt_respondsToSelector())
    {
      findMyLocationRequestMessage = [MSMessageClass_0 findMyLocationRequestMessage];
      v6 = [CKComposition compositionWithMSMessage:findMyLocationRequestMessage appExtensionIdentifier:*MEMORY[0x1E69A6938]];
      [(CKChatController *)self _evaluateMetricsForStagingLocation];
      [(CKChatController *)self setComposition:v6];
    }
  }
}

- (void)stageFindMyCompositionWithShareType:(int64_t)type
{
  mEMORY[0x1E69A8070] = [MEMORY[0x1E69A8070] sharedFeatureFlags];
  isWaldoEnabled = [mEMORY[0x1E69A8070] isWaldoEnabled];

  if (isWaldoEnabled)
  {
    MSMessageClass_0 = getMSMessageClass_0();
    if (objc_opt_respondsToSelector())
    {
      v9 = [MSMessageClass_0 findMyLocationShareMessageWithDuration:type];
      v8 = [CKComposition compositionWithMSMessage:v9 appExtensionIdentifier:*MEMORY[0x1E69A6938]];
      [(CKChatController *)self _evaluateMetricsForStagingLocation];
      [(CKChatController *)self setComposition:v8];
    }
  }
}

- (void)stageCurrentLocationComposition
{
  mEMORY[0x1E69A5BC0] = [MEMORY[0x1E69A5BC0] sharedInstance];
  currentLocation = [mEMORY[0x1E69A5BC0] currentLocation];
  if (currentLocation && [mEMORY[0x1E69A5BC0] locationAuthorizationDetermined] && (objc_msgSend(mEMORY[0x1E69A5BC0], "locationAuthorizationDenied") & 1) == 0)
  {
    conversation = [(CKCoreChatController *)self conversation];
    v6 = [_TtC7ChatKit33CKDetailsControllerLocationHelper mapURLFor:currentLocation in:conversation];

    [(CKChatController *)self _stageCurrentLocationInEntryViewForURL:v6];
  }

  else
  {
    objc_initWeak(&location, self);
    v7[0] = MEMORY[0x1E69E9820];
    v7[1] = 3221225472;
    v7[2] = __61__CKChatController_Location__stageCurrentLocationComposition__block_invoke_2;
    v7[3] = &unk_1E72EC8F0;
    v8 = currentLocation;
    objc_copyWeak(&v9, &location);
    [mEMORY[0x1E69A5BC0] startUpdatingCurrentLocationWithAuthorizedHandler:&__block_literal_global_268 updateHandler:v7];
    objc_destroyWeak(&v9);

    objc_destroyWeak(&location);
  }
}

void __61__CKChatController_Location__stageCurrentLocationComposition__block_invoke_2(uint64_t a1, void *a2, void *a3)
{
  v16 = *MEMORY[0x1E69E9840];
  v5 = a2;
  v6 = a3;
  v7 = v6;
  if (v6 && [v6 code] != 42)
  {
    if (IMOSLoggingEnabled())
    {
      v13 = OSLogHandleForIMFoundationCategory();
      if (os_log_type_enabled(v13, OS_LOG_TYPE_INFO))
      {
        v14 = 138412290;
        v15 = v7;
        _os_log_impl(&dword_19020E000, v13, OS_LOG_TYPE_INFO, "Received unknown error while trying to send current location: %@. Aborting _stageCurrentLocation.", &v14, 0xCu);
      }
    }
  }

  else
  {
    v8 = *(a1 + 32);
    WeakRetained = objc_loadWeakRetained((a1 + 40));
    v10 = [WeakRetained conversation];
    v11 = [_TtC7ChatKit33CKDetailsControllerLocationHelper mapURLFor:v8 in:v10];

    v12 = objc_loadWeakRetained((a1 + 40));
    [v12 _stageCurrentLocationInEntryViewForURL:v11];
  }
}

- (void)_stageCurrentLocationInEntryViewForURL:(id)l
{
  lCopy = l;
  conversation = [(CKCoreChatController *)self conversation];
  chat = [conversation chat];

  if ([chat authorizationToSendCurrentLocationMessageDenied])
  {
    currentLocationDeniedAlert = [(CKChatController *)self currentLocationDeniedAlert];
    [currentLocationDeniedAlert presentFromViewController:self animated:1 completion:0];
  }

  else if ([chat canSendCurrentLocationMessage])
  {
    v8 = objc_alloc_init(MEMORY[0x1E696ECE0]);
    block[0] = MEMORY[0x1E69E9820];
    block[1] = 3221225472;
    block[2] = __69__CKChatController_Location___stageCurrentLocationInEntryViewForURL___block_invoke;
    block[3] = &unk_1E72EB880;
    v11 = v8;
    v12 = lCopy;
    selfCopy = self;
    v9 = v8;
    dispatch_async(MEMORY[0x1E69E96A0], block);
  }
}

void __69__CKChatController_Location___stageCurrentLocationInEntryViewForURL___block_invoke(uint64_t a1)
{
  v1 = *(a1 + 32);
  v3[0] = MEMORY[0x1E69E9820];
  v3[1] = 3221225472;
  v3[2] = __69__CKChatController_Location___stageCurrentLocationInEntryViewForURL___block_invoke_2;
  v3[3] = &unk_1E72EC940;
  v2 = *(a1 + 40);
  v4 = vextq_s8(v2, v2, 8uLL);
  [v1 startFetchingMetadataForURL:v2.i64[0] completionHandler:v3];
}

void __69__CKChatController_Location___stageCurrentLocationInEntryViewForURL___block_invoke_2(uint64_t a1, void *a2)
{
  v3 = *(a1 + 32);
  v4 = a2;
  v5 = [v3 conversation];
  v6 = [v5 chat];
  v7 = [v6 account];
  v8 = [v7 loginIMHandle];

  v9 = [v8 name];
  [v4 setTitle:v9];

  [v4 setURL:*(a1 + 40)];
  v10 = [CKBrowserItemPayload createBrowserItemPayloadWithRichLinkMetadata:v4];

  v11[0] = MEMORY[0x1E69E9820];
  v11[1] = 3221225472;
  v11[2] = __69__CKChatController_Location___stageCurrentLocationInEntryViewForURL___block_invoke_3;
  v11[3] = &unk_1E72EC918;
  v11[4] = *(a1 + 32);
  [CKComposition compositionWithShelfPluginPayload:v10 completionHandler:v11];
}

- (id)currentLocationDeniedAlert
{
  v2 = CKFrameworkBundle();
  v3 = [v2 localizedStringForKey:@"TURN_ON_LOCATION_SERVICES_TO_SEND_LOCATION" value:&stru_1F04268F8 table:@"ChatKit"];
  v4 = [CKAlertController alertControllerWithTitle:v3 message:0 preferredStyle:1];

  v5 = CKFrameworkBundle();
  v6 = [v5 localizedStringForKey:@"CANCEL" value:&stru_1F04268F8 table:@"ChatKit"];
  v7 = [CKAlertAction actionWithTitle:v6 style:1 handler:0];
  [v4 addAction:v7];

  v8 = CKFrameworkBundle();
  v9 = [v8 localizedStringForKey:@"SETTINGS" value:&stru_1F04268F8 table:@"ChatKit"];
  v10 = [CKAlertAction actionWithTitle:v9 style:0 handler:&__block_literal_global_257_0];

  [v4 addAction:v10];

  return v4;
}

void __56__CKChatController_Location__currentLocationDeniedAlert__block_invoke()
{
  v1 = [MEMORY[0x1E6963608] defaultWorkspace];
  v0 = [MEMORY[0x1E695DFF8] URLWithString:@"prefs:root=Privacy&path=LOCATION"];
  [v1 openSensitiveURL:v0 withOptions:0];
}

- (void)_evaluateMetricsForStagingLocation
{
  v3 = objc_alloc_init(MEMORY[0x1E695DF90]);
  [v3 setValue:&unk_1F04E8550 forKey:*MEMORY[0x1E69A77A0]];
  [v3 setValue:*MEMORY[0x1E69A6938] forKey:*MEMORY[0x1E69A77A8]];
  mEMORY[0x1E69A8168] = [MEMORY[0x1E69A8168] sharedInstance];
  [mEMORY[0x1E69A8168] trackEvent:*MEMORY[0x1E69A7570] withDictionary:v3];
}

- (void)_handleSetAsBackgroundActionForAssetURL:(id)l
{
  v30[1] = *MEMORY[0x1E69E9840];
  lCopy = l;
  ck_temporaryImageDirectoryURL = [MEMORY[0x1E69C07E8] ck_temporaryImageDirectoryURL];
  path = [ck_temporaryImageDirectoryURL path];

  defaultManager = [MEMORY[0x1E696AC08] defaultManager];
  v29 = 0;
  v8 = [defaultManager createDirectoryAtPath:path withIntermediateDirectories:1 attributes:0 error:&v29];
  v9 = v29;

  if (v8)
  {
    v10 = MEMORY[0x1E695DFF8];
    path2 = [lCopy path];
    lastPathComponent = [path2 lastPathComponent];
    v13 = [path stringByAppendingPathComponent:lastPathComponent];
    v14 = [v10 fileURLWithPath:v13];

    defaultManager2 = [MEMORY[0x1E696AC08] defaultManager];
    v28 = 0;
    [defaultManager2 copyItemAtURL:lCopy toURL:v14 error:&v28];

    if (v14)
    {
      v16 = MEMORY[0x193AF5EC0](@"PFPosterMediaURLImage", @"PhotosFormats");
      if (v16)
      {
        v17 = v16;
        v18 = [objc_alloc(MEMORY[0x1E69C07E8]) initWithConfigurationType:0];
        v26 = [[v17 alloc] initWithImageAtURL:v14];
        v30[0] = v26;
        v19 = [MEMORY[0x1E695DEC8] arrayWithObjects:v30 count:1];
        v25 = v18;
        [v18 setMedia:v19];

        v27 = 0;
        v20 = [v18 ck_newPosterKitPosterConfigurationForPlayground:0 withError:&v27];
        conversation = [(CKCoreChatController *)self conversation];
        v22 = [_TtC7ChatKit22CKPosterEditingHelpers makeEditingViewControllerConfigurationForPosterContents:v20 conversation:conversation];

        v23 = [[CKPRUISPosterEditingViewController alloc] initWithEditingConfiguration:v22];
        [(CKPRUISPosterEditingViewController *)v23 setDelegate:self];
        traitCollection = [(CKChatController *)self traitCollection];
        [(CKPRUISPosterEditingViewController *)v23 setModalPresentationStyle:[_TtC7ChatKit22CKPosterEditingHelpers preferredEditorModalPresentationStyleForTraitCollection:traitCollection]];

        [(CKChatController *)self presentViewController:v23 animated:1 completion:0];
      }
    }
  }

  else
  {
    v14 = 0;
  }
}

- (void)editingViewController:(id)controller didFinishWithConfiguration:(id)configuration
{
  v25 = *MEMORY[0x1E69E9840];
  controllerCopy = controller;
  configurationCopy = configuration;
  [controllerCopy dismissViewControllerAnimated:1 completion:0];
  if (configurationCopy)
  {
    Helper_x8__OBJC_CLASS___PRSPosterArchiver = gotLoadHelper_x8__OBJC_CLASS___PRSPosterArchiver(v8);
    v11 = *(v10 + 4088);
    v22 = 0;
    v12 = [v11 archiveConfiguration:configurationCopy format:1 error:{&v22, Helper_x8__OBJC_CLASS___PRSPosterArchiver}];
    v13 = v22;
    v14 = v13;
    if (v12)
    {
      if (v13 && IMOSLoggingEnabled())
      {
        v15 = OSLogHandleForIMFoundationCategory();
        if (os_log_type_enabled(v15, OS_LOG_TYPE_INFO))
        {
          *buf = 138412290;
          v24 = v14;
          _os_log_impl(&dword_19020E000, v15, OS_LOG_TYPE_INFO, "Poster archiver provided final URL but emitted error. Trying to send anyway. Error: %@", buf, 0xCu);
        }
      }

      providerBundleIdentifier = [configurationCopy providerBundleIdentifier];
      uUID = [MEMORY[0x1E696AFB0] UUID];
      uUIDString = [uUID UUIDString];

      v19 = [[_TtC7ChatKit22CKTranscriptBackground alloc] initWithPosterFileURL:v12 fileName:uUIDString backgroundIdentifier:uUIDString extensionIdentifier:providerBundleIdentifier extensionIsPlayground:0];
      [(CKCoreChatController *)self setNewTranscriptBackground:v19];
    }

    else if (IMOSLoggingEnabled())
    {
      v21 = OSLogHandleForIMFoundationCategory();
      if (os_log_type_enabled(v21, OS_LOG_TYPE_INFO))
      {
        *buf = 138412290;
        v24 = v14;
        _os_log_impl(&dword_19020E000, v21, OS_LOG_TYPE_INFO, "Failed to archive poster configuration, no persisted URL. Error: %@", buf, 0xCu);
      }
    }
  }

  else if (IMOSLoggingEnabled())
  {
    v20 = OSLogHandleForIMFoundationCategory();
    if (os_log_type_enabled(v20, OS_LOG_TYPE_INFO))
    {
      *buf = 0;
      _os_log_impl(&dword_19020E000, v20, OS_LOG_TYPE_INFO, "No configuration returned", buf, 2u);
    }
  }
}

- (void)receivedBalloonEmphasisNotification:(id)notification
{
  v4 = sub_190D50FB0();
  v5 = *(v4 - 8);
  MEMORY[0x1EEE9AC00](v4);
  v7 = &v9 - ((v6 + 15) & 0xFFFFFFFFFFFFFFF0);
  sub_190D50F60();
  selfCopy = self;
  sub_19086A504();

  (*(v5 + 8))(v7, v4);
}

- (void)emphasizeMessageWithMessageGUID:(id)d
{
  dCopy = d;
  selfCopy = self;
  collectionViewController = [(CKCoreChatController *)selfCopy collectionViewController];
  objc_opt_self();
  v6 = swift_dynamicCastObjCClass();
  if (v6)
  {
    [v6 beginEmphasisWithMessageGUID_];
    v7 = collectionViewController;
  }

  else
  {
    v7 = dCopy;
    dCopy = selfCopy;
    selfCopy = collectionViewController;
  }
}

- (void)updateEmphasis
{
  selfCopy = self;
  collectionViewController = [(CKCoreChatController *)selfCopy collectionViewController];
  objc_opt_self();
  v3 = swift_dynamicCastObjCClass();
  if (v3)
  {
    [v3 updateEmphasis];
    v4 = collectionViewController;
  }

  else
  {
    v4 = selfCopy;
    selfCopy = collectionViewController;
  }
}

- (void)testEmphasis
{
  selfCopy = self;
  sub_19086ABE0();
}

- (id)makeNavigationBarContext
{
  selfCopy = self;
  v3 = sub_1908709C4();

  return v3;
}

- (id)preferredNavigationBarTitleText
{
  selfCopy = self;
  conversation = [(CKCoreChatController *)selfCopy conversation];
  v4 = [(CKConversation *)conversation displayNameForDisplayContext:1];

  if (v4)
  {
    sub_190D56F10();

    v5 = sub_190D56ED0();
  }

  else
  {

    v5 = 0;
  }

  return v5;
}

- (BOOL)allowsNavigationBarTitleInteraction
{
  selfCopy = self;
  conversation = [(CKCoreChatController *)selfCopy conversation];
  allowsShowingDetailsView = [(CKConversation *)conversation allowsShowingDetailsView];

  return allowsShowingDetailsView;
}

- (int64_t)currentTranscriptNavigationBarMode
{
  selfCopy = self;
  v3 = sub_1908725C0();

  return v3;
}

- (int64_t)currentTranscriptNavigationBarTitleDisplayMode
{
  if ([(CKChatController *)self shouldShowAvatarViewInTranscriptNavigationBar])
  {
    return 0;
  }

  else
  {
    return 3;
  }
}

- (int64_t)entryViewPositioningGuideForCurrentTapbackPickerPresentation
{
  selfCopy = self;
  v3 = sub_19089DBFC();

  return v3;
}

- (id)pickerAccessoryViewForChatItem:(id)item containingViewController:(id)controller
{
  itemCopy = item;
  controllerCopy = controller;
  selfCopy = self;
  v9 = sub_19089DE64(itemCopy, controllerCopy);

  return v9;
}

- (void)tapbackPickerBalloonParentView:(id)view didInsertTapback:(id)tapback
{
  viewCopy = view;
  tapbackCopy = tapback;
  selfCopy = self;
  CKChatController.tapbackPickerBalloonParentView(_:didInsertTapback:)(viewCopy, tapbackCopy);
}

- (void)tapbackPickerBalloonParentView:(id)view requestedPresentPlugin:(id)plugin payloadID:(id)d
{
  if (plugin)
  {
    v7 = sub_190D56D90();
  }

  else
  {
    v7 = 0;
  }

  dCopy = d;
  selfCopy = self;
  inputController = [(CKCoreChatController *)selfCopy inputController];
  if (inputController)
  {
    v10 = inputController;
    if (v7)
    {
      v11 = sub_190D56D60();
    }

    else
    {
      v11 = 0;
    }

    [(CKChatInputController *)v10 _presentPluginIfNecessaryWithPayload:v11 withPayloadID:dCopy];
  }

  else
  {
  }
}

- (void)tapbackPickerBalloonParentViewRequestedAppCardDismiss:(id)dismiss
{
  dismissCopy = dismiss;
  selfCopy = self;
  _sSo16CKChatControllerC7ChatKitE53tapbackPickerBalloonParentViewRequestedAppCardDismissyyAC07TapbackfghI0CF_0();
}

- (id)tapbackMenuElementsForChatItem:(id)item
{
  itemCopy = item;
  selfCopy = self;
  sub_19089EE74(itemCopy);

  sub_1902188FC(0, &unk_1EAD45090);
  v6 = sub_190D57160();

  return v6;
}

- (id)buildTapbackMenuElementsForChatItem:(id)item sendHandler:(id)handler emojiKeyboardHandler:(id)keyboardHandler detailsHandler:(id)detailsHandler
{
  v10 = _Block_copy(handler);
  v11 = _Block_copy(keyboardHandler);
  v12 = _Block_copy(detailsHandler);
  if (v10)
  {
    v13 = swift_allocObject();
    v13[2] = v10;
    v10 = sub_1908A1C54;
    if (v11)
    {
      goto LABEL_3;
    }

LABEL_6:
    v14 = 0;
    if (v12)
    {
      goto LABEL_4;
    }

    goto LABEL_7;
  }

  v13 = 0;
  if (!v11)
  {
    goto LABEL_6;
  }

LABEL_3:
  v14 = swift_allocObject();
  *(v14 + 16) = v11;
  v11 = sub_1908A1DE0;
  if (v12)
  {
LABEL_4:
    v15 = swift_allocObject();
    *(v15 + 16) = v12;
    v12 = sub_19084CED8;
    goto LABEL_8;
  }

LABEL_7:
  v15 = 0;
LABEL_8:
  itemCopy = item;
  selfCopy = self;
  sub_19089F36C(itemCopy, v10, v13, v11, v14, v12, v15);
  sub_19022123C(v12);
  sub_19022123C(v11);
  sub_19022123C(v10);

  sub_1902188FC(0, &unk_1EAD45090);
  v18 = sub_190D57160();

  return v18;
}

- (void)tapbackPickerViewController:(id)controller didSelectTapback:(id)tapback
{
  controllerCopy = controller;
  tapbackCopy = tapback;
  selfCopy = self;
  CKChatController.tapbackPickerViewController(_:didSelectTapback:)(controllerCopy, tapbackCopy);
}

- (void)tapbackPickerViewController:(id)controller didDeselectTapback:(id)tapback
{
  controllerCopy = controller;
  tapbackCopy = tapback;
  selfCopy = self;
  CKChatController.tapbackPickerViewController(_:didDeselectTapback:)(controllerCopy, tapbackCopy);
}

- (id)contextualCKChatItemsForTapbackPickerViewController:(id)controller
{
  selfCopy = self;
  contextualChatItemsForTapbackPicker = [(CKCoreChatController *)selfCopy contextualChatItemsForTapbackPicker];
  if (!contextualChatItemsForTapbackPicker)
  {
    sub_1902188FC(0, &qword_1EAD450F0);
    sub_190D57180();
    contextualChatItemsForTapbackPicker = sub_190D57160();
  }

  return contextualChatItemsForTapbackPicker;
}

- (id)smartEmojiResponses:(id)responses chatItem:(id)item
{
  itemCopy = item;
  selfCopy = self;
  sub_190A37388(item);

  v8 = sub_190D57160();

  return v8;
}

- (void)configureFooterIfNeeded
{
  selfCopy = self;
  CKChatController.configureFooterIfNeeded()();
}

- (void)transcriptCollectionViewController:(id)controller didTapIntroductionsButton:(id)button ofType:(int64_t)type
{
  controllerCopy = controller;
  buttonCopy = button;
  selfCopy = self;
  sub_190991AA0(button, type);
}

- (id)deleteAlertFor:(int64_t)for
{
  selfCopy = self;
  v5 = CKChatController.deleteAlert(for:)(for);

  return v5;
}

- (BOOL)wantsMessageRequestsTip
{
  selfCopy = self;
  v3 = CKChatController.wantsMessageRequestsTip()();

  return v3;
}

- (void)updateNumberOfUnknownChatsOpenedIfNeeded
{
  selfCopy = self;
  CKChatController.updateNumberOfUnknownChatsOpenedIfNeeded()();
}

- (BOOL)needsFooter
{
  selfCopy = self;
  v3 = CKChatController.needsFooter()();

  return v3;
}

- (void)setCustomAcknowledgementConversation:(id)conversation
{
  conversationCopy = conversation;
  selfCopy = self;
  customAcknowledgementDebouncer = [(CKChatController *)selfCopy customAcknowledgementDebouncer];
  [(CKCustomAcknowledgementDebouncer *)customAcknowledgementDebouncer setConversation:conversationCopy];
}

- (void)sendCustomAcknowledgementMessage:(id)message
{
  messageCopy = message;
  selfCopy = self;
  customAcknowledgementDebouncer = [(CKChatController *)selfCopy customAcknowledgementDebouncer];
  sub_19099B204(messageCopy);
}

- (NSArray)keyCommands
{
  selfCopy = self;
  v3 = CKChatController.keyCommands.getter();

  if (v3)
  {
    sub_1909DB4E4();
    v4 = sub_190D57160();
  }

  else
  {
    v4 = 0;
  }

  return v4;
}

- (void)keyCommandSelectTapback:(id)tapback
{
  tapbackCopy = tapback;
  selfCopy = self;
  sub_1909DB180(tapbackCopy);
}

- (void)keyCommandToggleTimeStamp:(id)stamp
{
  selfCopy = self;
  collectionViewController = [(CKCoreChatController *)selfCopy collectionViewController];
  objc_opt_self();
  v4 = swift_dynamicCastObjCClass();
  if (v4)
  {
    [v4 toggleTimeStamp];
    v5 = collectionViewController;
  }

  else
  {
    v5 = selfCopy;
    selfCopy = collectionViewController;
  }
}

- (void)presentLoadingIndicatorCoverIfNeeded
{
  selfCopy = self;
  CKChatController.presentLoadingIndicatorCoverIfNeeded()();
}

- (void)removeLoadingIndicatorCoverIfNeeded
{
  selfCopy = self;
  CKChatController.removeLoadingIndicatorCoverIfNeeded()();
}

- (void)clearTranslationCache
{
  v2 = __swift_instantiateConcreteTypeFromMangledNameV2(&qword_1EAD5BAF0);
  MEMORY[0x1EEE9AC00](v2 - 8);
  v4 = &v9 - v3;
  v5 = sub_190D572E0();
  (*(*(v5 - 8) + 56))(v4, 1, 1, v5);
  sub_190D572A0();
  v6 = sub_190D57290();
  v7 = swift_allocObject();
  v8 = MEMORY[0x1E69E85E0];
  *(v7 + 16) = v6;
  *(v7 + 24) = v8;
  sub_190857E08(0, 0, v4, &unk_190DEB9F0, v7);
}

- (void)showTranslationTips:(id)tips
{
  v5 = __swift_instantiateConcreteTypeFromMangledNameV2(&qword_1EAD5BAF0);
  MEMORY[0x1EEE9AC00](v5 - 8);
  v7 = &v14 - v6;
  v8 = _Block_copy(tips);
  v9 = swift_allocObject();
  *(v9 + 16) = v8;
  *(v9 + 24) = self;
  v10 = sub_190D572E0();
  (*(*(v10 - 8) + 56))(v7, 1, 1, v10);
  v11 = swift_allocObject();
  v11[2] = 0;
  v11[3] = 0;
  v11[4] = &unk_190DEB9D0;
  v11[5] = v9;
  v12 = swift_allocObject();
  v12[2] = 0;
  v12[3] = 0;
  v12[4] = &unk_190DEB9D8;
  v12[5] = v11;
  selfCopy = self;
  sub_190C798DC(0, 0, v7, &unk_190DEB9E0, v12);
}

- (void)startDownloadingTranslationAssetsForLanguageCodes:(NSArray *)codes completion:(id)completion
{
  v7 = __swift_instantiateConcreteTypeFromMangledNameV2(&qword_1EAD5BAF0);
  MEMORY[0x1EEE9AC00](v7 - 8);
  v9 = &v17 - v8;
  v10 = _Block_copy(completion);
  v11 = swift_allocObject();
  v11[2] = codes;
  v11[3] = v10;
  v11[4] = self;
  v12 = sub_190D572E0();
  (*(*(v12 - 8) + 56))(v9, 1, 1, v12);
  v13 = swift_allocObject();
  v13[2] = 0;
  v13[3] = 0;
  v13[4] = &unk_190DEB960;
  v13[5] = v11;
  v14 = swift_allocObject();
  v14[2] = 0;
  v14[3] = 0;
  v14[4] = &unk_190DEB968;
  v14[5] = v13;
  codesCopy = codes;
  selfCopy = self;
  sub_190C798DC(0, 0, v9, &unk_190DEB970, v14);
}

- (void)startDownloadFor:(NSArray *)for completionHandler:(id)handler
{
  v7 = __swift_instantiateConcreteTypeFromMangledNameV2(&qword_1EAD5BAF0);
  MEMORY[0x1EEE9AC00](v7 - 8);
  v9 = &v17 - v8;
  v10 = _Block_copy(handler);
  v11 = swift_allocObject();
  v11[2] = for;
  v11[3] = v10;
  v11[4] = self;
  v12 = sub_190D572E0();
  (*(*(v12 - 8) + 56))(v9, 1, 1, v12);
  v13 = swift_allocObject();
  v13[2] = 0;
  v13[3] = 0;
  v13[4] = &unk_190DEB938;
  v13[5] = v11;
  v14 = swift_allocObject();
  v14[2] = 0;
  v14[3] = 0;
  v14[4] = &unk_190DEB940;
  v14[5] = v13;
  forCopy = for;
  selfCopy = self;
  sub_190C798DC(0, 0, v9, &unk_190DEB948, v14);
}

- (void)enableAutomaticTranslationForLanguageCode:(id)code userTranslationCode:(id)translationCode affectedMessageGUIDs:(id)ds
{
  v7 = __swift_instantiateConcreteTypeFromMangledNameV2(&qword_1EAD5BAF0);
  MEMORY[0x1EEE9AC00](v7 - 8);
  v9 = &v21 - v8;
  v10 = sub_190D56F10();
  v12 = v11;
  if (translationCode)
  {
    translationCode = sub_190D56F10();
    v14 = v13;
  }

  else
  {
    v14 = 0;
  }

  v15 = sub_190D57180();
  v16 = sub_190D572E0();
  (*(*(v16 - 8) + 56))(v9, 1, 1, v16);
  sub_190D572A0();
  selfCopy = self;
  v18 = sub_190D57290();
  v19 = swift_allocObject();
  v20 = MEMORY[0x1E69E85E0];
  v19[2] = v18;
  v19[3] = v20;
  v19[4] = selfCopy;
  v19[5] = v10;
  v19[6] = v12;
  v19[7] = translationCode;
  v19[8] = v14;
  v19[9] = v15;
  sub_190857E08(0, 0, v9, &unk_190DEB928, v19);
}

- (BOOL)shouldOfferTranslateConversationInTranslateMenu
{
  selfCopy = self;
  v3 = sub_190A757BC();

  return v3 & 1;
}

- (void)translateConversationForChatItem:(id)item
{
  v5 = __swift_instantiateConcreteTypeFromMangledNameV2(&qword_1EAD5BAF0);
  MEMORY[0x1EEE9AC00](v5 - 8);
  v7 = &v15 - v6;
  v8 = sub_190D572E0();
  (*(*(v8 - 8) + 56))(v7, 1, 1, v8);
  sub_190D572A0();
  itemCopy = item;
  selfCopy = self;
  v11 = itemCopy;
  v12 = sub_190D57290();
  v13 = swift_allocObject();
  v14 = MEMORY[0x1E69E85E0];
  v13[2] = v12;
  v13[3] = v14;
  v13[4] = selfCopy;
  v13[5] = v11;
  sub_190857E08(0, 0, v7, &unk_190DEB908, v13);
}

- (void)presentTranslationLanguagePickerWithCompletionHandler:(id)handler
{
  v5 = __swift_instantiateConcreteTypeFromMangledNameV2(&qword_1EAD5BAF0);
  MEMORY[0x1EEE9AC00](v5 - 8);
  v7 = &v14 - v6;
  v8 = _Block_copy(handler);
  v9 = swift_allocObject();
  *(v9 + 16) = v8;
  *(v9 + 24) = self;
  v10 = sub_190D572E0();
  (*(*(v10 - 8) + 56))(v7, 1, 1, v10);
  v11 = swift_allocObject();
  v11[2] = 0;
  v11[3] = 0;
  v11[4] = &unk_190DEB8F0;
  v11[5] = v9;
  v12 = swift_allocObject();
  v12[2] = 0;
  v12[3] = 0;
  v12[4] = &unk_190DD75C0;
  v12[5] = v11;
  selfCopy = self;
  sub_190C798DC(0, 0, v7, &unk_190DD75C8, v12);
}

- (id)textSelectionActionWithChatItem:(id)item
{
  itemCopy = item;
  selfCopy = self;
  CKChatController.textSelectionAction(chatItem:)(v6, itemCopy);
  v8 = v7;

  return v8;
}

- (id)setBackgroundActionForChatItem:(id)item
{
  itemCopy = item;
  selfCopy = self;
  CKChatController.setBackgroundAction(chatItem:)(v7, item);
  v9 = v8;

  return v9;
}

- (void)presentRedesignedDetailsViewForConversation:(id)conversation
{
  conversationCopy = conversation;
  selfCopy = self;
  v5 = [(CKChatController *)selfCopy redesignedDetailsViewForConversation:conversationCopy];
  [(CKChatController *)selfCopy performPlatformSpecificDetailsPresentation:v5];
}

- (id)redesignedDetailsViewForConversation:(id)conversation
{
  conversationCopy = conversation;
  selfCopy = self;
  CKChatController.redesignedDetailsView(for:)(v6, conversationCopy);
  v8 = v7;

  return v8;
}

- (void)performPlatformSpecificDetailsPresentation:(id)presentation
{
  presentationCopy = presentation;
  selfCopy = self;
  CKChatController.performPlatformSpecificDetailsPresentation(_:)(presentationCopy);
}

- (void)detailsCoordinatorDidRequestNewCompose:(id)compose addresses:(id)addresses
{
  v5 = sub_190D57180();
  v6 = swift_allocObject();
  swift_unknownObjectWeakInit();
  v7 = swift_allocObject();
  *(v7 + 16) = v6;
  *(v7 + 24) = v5;
  v10[4] = sub_190B72FA8;
  v10[5] = v7;
  v10[0] = MEMORY[0x1E69E9820];
  v10[1] = 1107296256;
  v10[2] = sub_190840E6C;
  v10[3] = &block_descriptor_30_3;
  v8 = _Block_copy(v10);
  selfCopy = self;

  [(CKChatController *)selfCopy dismissDetailsViewAndShowConversationListWithCompletion:v8];

  _Block_release(v8);
}

- (void)detailsCoordinatorDidRequestNavigationToConversationList:(id)list
{
  v5[4] = nullsub_10;
  v5[5] = 0;
  v5[0] = MEMORY[0x1E69E9820];
  v5[1] = 1107296256;
  v5[2] = sub_190840E6C;
  v5[3] = &block_descriptor_22_0;
  v4 = _Block_copy(v5);
  [(CKChatController *)self dismissDetailsViewAndShowConversationListWithCompletion:v4];
  _Block_release(v4);
}

- (void)dismissDetailsView
{
  selfCopy = self;
  CKChatController.dismissDetailsView()();
}

- (void)detailsCoordinatorDidDismiss:(id)dismiss
{
  dismissCopy = dismiss;
  selfCopy = self;
  CKChatController.detailsCoordinatorDidDismiss(_:)(dismissCopy);
}

- (void)detailsCoordinatorRequestedContactsPopover:(id)popover sourceView:(id)view activeHandle:(id)handle contact:(id)contact
{
  if (!view)
  {
    popoverCopy = popover;
    view = [popoverCopy view];
    if (view)
    {
    }

    else
    {
      __break(1u);
    }
  }
}

- (void)didSelectTranscriptBackground:(id)background
{
  backgroundCopy = background;
  selfCopy = self;
  CKChatController.didSelectTranscriptBackground(_:)(background);
}

- (id)transcriptContextChatItemProvider
{
  selfCopy = self;
  collectionViewController = [(CKCoreChatController *)selfCopy collectionViewController];
  chatItems = [(CKCoreTranscriptControllerProtocol *)collectionViewController chatItems];

  sub_1902188FC(0, &qword_1EAD450F0);
  sub_190D57180();

  v5 = sub_190D57160();

  return v5;
}

- (void)didPresentEditorTranscriptBackground:(BOOL)background
{
  selfCopy = self;
  CKChatController.didPresentEditorTranscriptBackground(_:)(background);
}

- (BOOL)shouldPresentDetailsInInspector
{
  selfCopy = self;
  v3 = CKChatController.shouldPresentDetailsInInspector.getter();

  return v3 & 1;
}

- (void)scrollToMessageWith:(id)with in:(id)in withInlineReplyOverlay:(BOOL)overlay
{
  v8 = sub_190D56F10();
  v10 = v9;
  inCopy = in;
  selfCopy = self;
  sub_190BD8A4C(v8, v10, overlay);
}

void __111__CKChatController_ClickyOrbConformance___exportActionForChatItem_shouldUseTopMostChatItemIfAggregateChatItem___block_invoke_412_cold_1(uint64_t a1, uint64_t a2, NSObject *a3)
{
  *v3 = 138412546;
  *&v3[4] = a1;
  *&v3[12] = 2112;
  *&v3[14] = *(a2 + 32);
  OUTLINED_FUNCTION_2(&dword_19020E000, a2, a3, "Error saving media objects: %@. mediaObjects: %@", *v3, *&v3[8], *&v3[16], *MEMORY[0x1E69E9840]);
}

void __96__CKChatController_CKChatController_Stickers___sendStickerForDragItem_previewSize_dropLocation___block_invoke_263_cold_2(void *a1, uint64_t a2, NSObject *a3)
{
  *v3 = 138412546;
  *&v3[4] = *a1;
  *&v3[12] = 2112;
  *&v3[14] = *(a2 + 40);
  OUTLINED_FUNCTION_2(&dword_19020E000, a2, a3, "Missing stickerPackGUID for sticker: %@ loaded from drag item: %@. Aborting sticker send to avoid a blastdoor explosion for the recipient.", *v3, *&v3[8], *&v3[16], *MEMORY[0x1E69E9840]);
}

void __96__CKChatController_CKChatController_Stickers___sendStickerForDragItem_previewSize_dropLocation___block_invoke_275_cold_1()
{
  OUTLINED_FUNCTION_3();
  OUTLINED_FUNCTION_0();
  _os_log_error_impl(v0, v1, v2, v3, v4, 0xCu);
}

void __96__CKChatController_CKChatController_Stickers___sendStickerForDragItem_previewSize_dropLocation___block_invoke_288_cold_1()
{
  OUTLINED_FUNCTION_3();
  OUTLINED_FUNCTION_0();
  _os_log_error_impl(v0, v1, v2, v3, v4, 0xCu);
}

- (void)transcriptNavigationBar:didTapToPerformAction:.cold.1()
{
  OUTLINED_FUNCTION_1();
  OUTLINED_FUNCTION_0();
  _os_log_error_impl(v0, v1, v2, v3, v4, 2u);
}

- (void)presentationControllerDidDismiss:(NSObject *)a3 .cold.1(uint64_t a1, void *a2, NSObject *a3)
{
  v17 = *MEMORY[0x1E69E9840];
  v6 = [a2 entryView];
  v7 = [v6 recursiveDescription];
  v8 = [a2 entryView];
  v9 = [v8 isFirstResponder];
  v10 = @"NO";
  v11 = 138412802;
  v12 = a1;
  v13 = 2112;
  if (v9)
  {
    v10 = @"YES";
  }

  v14 = v7;
  v15 = 2112;
  v16 = v10;
  _os_log_error_impl(&dword_19020E000, a3, OS_LOG_TYPE_ERROR, "Returned to transcript without an entry view window. PresentationController: %@, entryView.recursiveDescription: %@, entryView.isFirstResponder: %@", &v11, 0x20u);
}

void __47__CKChatController_sendComposition_animations___block_invoke_cold_1()
{
  OUTLINED_FUNCTION_1();
  OUTLINED_FUNCTION_0();
  _os_log_error_impl(v0, v1, v2, v3, v4, 2u);
}

void __54__CKChatController_transcriptScrollWithConfiguration___block_invoke_cold_1()
{
  OUTLINED_FUNCTION_1();
  OUTLINED_FUNCTION_0();
  _os_log_error_impl(v0, v1, v2, v3, v4, 2u);
}

- (void)transcriptCollectionViewController:balloonView:didRequestReaderViewControllerForChatItem:.cold.1()
{
  OUTLINED_FUNCTION_1();
  OUTLINED_FUNCTION_0();
  _os_log_error_impl(v0, v1, v2, v3, v4, 2u);
}

- (void)transcriptCollectionViewController:selectedPollAddChoice:.cold.1()
{
  OUTLINED_FUNCTION_3();
  OUTLINED_FUNCTION_0();
  _os_log_error_impl(v0, v1, v2, v3, v4, 0xCu);
}

- (void)transcriptCollectionViewController:(void *)a1 balloonViewDidRequestSendCustomAcknowledgementPayload:forPlugin:error:.cold.3(void *a1)
{
  v1 = [a1 conversation];
  OUTLINED_FUNCTION_4();
  OUTLINED_FUNCTION_0_3();
  _os_log_error_impl(v2, v3, v4, v5, v6, 0x16u);
}

- (void)_updateCatchUpButtonVisibilityResumingFromBackground:(void *)a1 .cold.1(void *a1)
{
  [a1 item];
  OUTLINED_FUNCTION_3();
  OUTLINED_FUNCTION_11();
  OUTLINED_FUNCTION_0_3();
  _os_log_error_impl(v1, v2, v3, v4, v5, 0x16u);
}

- (void)_animationPropertiesToUseInUpdateForReasons:followingHoldForReason:.cold.1()
{
  OUTLINED_FUNCTION_1();
  OUTLINED_FUNCTION_0();
  _os_log_error_impl(v0, v1, v2, v3, v4, 2u);
}

- (void)_animationPropertiesToUseInUpdateForReasons:followingHoldForReason:.cold.2()
{
  OUTLINED_FUNCTION_3();
  OUTLINED_FUNCTION_0();
  _os_log_error_impl(v0, v1, v2, v3, v4, 0xCu);
}

- (void)_transferUpdated:.cold.1()
{
  OUTLINED_FUNCTION_9();
  v2 = [v1 error];
  v3 = [v0 error];
  [v3 code];
  OUTLINED_FUNCTION_11();
  OUTLINED_FUNCTION_0_3();
  _os_log_error_impl(v4, v5, v6, v7, v8, 0x16u);
}

- (void)_updateFauxKeyboardLayoutGuideIfNeededForKeyboardAppearanceNotification:.cold.1()
{
  OUTLINED_FUNCTION_3();
  OUTLINED_FUNCTION_0();
  _os_log_error_impl(v0, v1, v2, v3, v4, 0xCu);
}

- (void)sendSticker:(void *)a1 withDragTarget:draggedSticker:.cold.1(void *a1)
{
  v1 = [a1 description];
  OUTLINED_FUNCTION_3();
  OUTLINED_FUNCTION_0_3();
  _os_log_error_impl(v2, v3, v4, v5, v6, 0xCu);
}

- (void)requestShowKeyboardSnapshotForReason:.cold.1()
{
  OUTLINED_FUNCTION_9();
  v2 = [MEMORY[0x1E696AAA8] currentHandler];
  [v2 handleFailureInMethod:v1 object:v0 file:@"CKChatController.m" lineNumber:9115 description:{@"Invalid parameter not satisfying: %@", @"reason != CKKeyboardSnapshotReasonNone"}];
}

- (uint64_t)requestShowKeyboardSnapshotForReason:(void *)a3 .cold.2(uint64_t a1, uint64_t a2, void *a3)
{
  v6 = [MEMORY[0x1E696AAA8] currentHandler];
  *a3 = v6;
  return [v6 handleFailureInMethod:a1 object:a2 file:@"CKChatController.m" lineNumber:9161 description:@"+[UIKeyboard snapshotViewForOptions:UIKBSnapshotOptionWindow] returned nil. Unexpected."];
}

- (void)requestDismissKeyboardSnapshotForReason:.cold.1()
{
  OUTLINED_FUNCTION_9();
  v2 = [MEMORY[0x1E696AAA8] currentHandler];
  [v2 handleFailureInMethod:v1 object:v0 file:@"CKChatController.m" lineNumber:9259 description:{@"Invalid parameter not satisfying: %@", @"reason != CKKeyboardSnapshotReasonNone"}];
}

+ (void)donateStickerToRecents:(void *)a1 .cold.1(void *a1)
{
  v1 = [a1 fileURL];
  OUTLINED_FUNCTION_3();
  OUTLINED_FUNCTION_0_3();
  _os_log_error_impl(v2, v3, v4, v5, v6, 0xCu);
}

+ (void)donateStickerToRecents:(void *)a1 .cold.2(void *a1)
{
  v1 = [a1 description];
  OUTLINED_FUNCTION_3();
  OUTLINED_FUNCTION_0_3();
  _os_log_error_impl(v2, v3, v4, v5, v6, 0xCu);
}

+ (void)donateStickerToRecentsWithIdentifier:representations:stickerEffectType:externalURI:name:accessibilityLabel:metadata:ckAttributionInfo:.cold.1()
{
  OUTLINED_FUNCTION_1();
  OUTLINED_FUNCTION_0();
  _os_log_error_impl(v0, v1, v2, v3, v4, 2u);
}

void __154__CKChatController_donateStickerToRecentsWithIdentifier_representations_stickerEffectType_externalURI_name_accessibilityLabel_metadata_ckAttributionInfo___block_invoke_cold_1()
{
  OUTLINED_FUNCTION_3();
  OUTLINED_FUNCTION_0();
  _os_log_error_impl(v0, v1, v2, v3, v4, 0xCu);
}

- (void)_sendAutomaticallyPlacedSticker:stickerReactionSession:forChatItem:forParentChatItem:stickerFrame:animationCompletionHandler:.cold.1()
{
  OUTLINED_FUNCTION_1();
  OUTLINED_FUNCTION_0();
  _os_log_error_impl(v0, v1, v2, v3, v4, 2u);
}

- (void)_sendAutomaticallyPlacedSticker:stickerReactionSession:forChatItem:forParentChatItem:stickerFrame:animationCompletionHandler:.cold.2()
{
  OUTLINED_FUNCTION_1();
  OUTLINED_FUNCTION_0();
  _os_log_error_impl(v0, v1, v2, v3, v4, 2u);
}

- (void)_sendAutomaticallyPlacedSticker:stickerReactionSession:forChatItem:forParentChatItem:stickerFrame:animationCompletionHandler:.cold.3()
{
  OUTLINED_FUNCTION_1();
  OUTLINED_FUNCTION_0();
  _os_log_error_impl(v0, v1, v2, v3, v4, 2u);
}

void __145__CKChatController__sendAutomaticallyPlacedSticker_stickerReactionSession_forChatItem_forParentChatItem_stickerFrame_animationCompletionHandler___block_invoke_cold_1()
{
  OUTLINED_FUNCTION_1();
  OUTLINED_FUNCTION_0();
  _os_log_error_impl(v0, v1, v2, v3, v4, 2u);
}

void __62__CKChatController_sendCompositionForFileProvider_completion___block_invoke_cold_1(void *a1)
{
  v1 = [a1 description];
  OUTLINED_FUNCTION_3();
  OUTLINED_FUNCTION_0_3();
  _os_log_error_impl(v2, v3, v4, v5, v6, 0xCu);
}

void __62__CKChatController_sendCompositionForFileProvider_completion___block_invoke_1259_cold_1()
{
  OUTLINED_FUNCTION_3();
  OUTLINED_FUNCTION_0();
  _os_log_error_impl(v0, v1, v2, v3, v4, 0xCu);
}

void __93__CKChatController__sendCollaborationCompositionForFileProvider_sharingURL_share_completion___block_invoke_2_cold_1()
{
  OUTLINED_FUNCTION_1();
  OUTLINED_FUNCTION_0();
  _os_log_error_impl(v0, v1, v2, v3, v4, 2u);
}

void __73__CKChatController__sendCompositionForFileProviderCloudDrive_completion___block_invoke_cold_1()
{
  v2 = 138412546;
  OUTLINED_FUNCTION_4();
  OUTLINED_FUNCTION_2(&dword_19020E000, v0, v1, "_sendCompositionForFileProviderCloudDrive: Received unexpected error getting sharing status for url: %@, error: %@", v2);
}

void __76__CKChatController__startSharingForURLForFileProviderCloudDrive_completion___block_invoke_cold_1()
{
  OUTLINED_FUNCTION_11();
  OUTLINED_FUNCTION_0();
  _os_log_error_impl(v0, v1, v2, v3, v4, 0x16u);
}

- (void)_updateAndSendCompositionForFileProvider:(const char *)a1 share:sharingURL:completion:.cold.1(const char *a1)
{
  v1 = NSStringFromSelector(a1);
  OUTLINED_FUNCTION_3();
  OUTLINED_FUNCTION_0_3();
  _os_log_error_impl(v2, v3, v4, v5, v6, 0xCu);
}

- (void)_updateAndSendCompositionForFileProvider:(const char *)a1 share:sharingURL:completion:.cold.2(const char *a1)
{
  v1 = NSStringFromSelector(a1);
  OUTLINED_FUNCTION_3();
  OUTLINED_FUNCTION_0_3();
  _os_log_error_impl(v2, v3, v4, v5, v6, 0xCu);
}

void __89__CKChatController__updateAndSendCompositionForFileProvider_share_sharingURL_completion___block_invoke_1306_cold_1()
{
  OUTLINED_FUNCTION_3();
  OUTLINED_FUNCTION_0();
  _os_log_error_impl(v0, v1, v2, v3, v4, 0xCu);
}

void __89__CKChatController__updateAndSendCompositionForFileProvider_share_sharingURL_completion___block_invoke_3_cold_1()
{
  v2 = 138412546;
  OUTLINED_FUNCTION_4();
  OUTLINED_FUNCTION_2(&dword_19020E000, v0, v1, "_checkCloudSharingStatusUpdateAndSendCompositionForFileProvider: Received unexpected error while getting sharing status for url: %@, error: %@", v2);
}

void __87__CKChatController__removeSubsharesAndSendFileProviderComposition_shareURL_completion___block_invoke_cold_1()
{
  OUTLINED_FUNCTION_3();
  OUTLINED_FUNCTION_0();
  _os_log_error_impl(v0, v1, v2, v3, v4, 0xCu);
}

- (void)_updateAndSendCompositionForExistingCloudKitShare:(const char *)a1 share:attempt:completion:.cold.1(const char *a1)
{
  v1 = NSStringFromSelector(a1);
  OUTLINED_FUNCTION_3();
  OUTLINED_FUNCTION_0_3();
  _os_log_error_impl(v2, v3, v4, v5, v6, 0xCu);
}

- (void)_updateAndSendCompositionForExistingCloudKitShare:(const char *)a1 share:attempt:completion:.cold.2(const char *a1)
{
  v1 = NSStringFromSelector(a1);
  OUTLINED_FUNCTION_3();
  OUTLINED_FUNCTION_0_3();
  _os_log_error_impl(v2, v3, v4, v5, v6, 0xCu);
}

void __95__CKChatController__updateAndSendCompositionForExistingCloudKitShare_share_attempt_completion___block_invoke_cold_1()
{
  v2 = 134218242;
  OUTLINED_FUNCTION_4();
  OUTLINED_FUNCTION_2(&dword_19020E000, v0, v1, "addParticipantsToShare to share failed attempt: %ld error: %@", v2);
}

void __95__CKChatController__updateAndSendCompositionForExistingCloudKitShare_share_attempt_completion___block_invoke_cold_2()
{
  OUTLINED_FUNCTION_3();
  OUTLINED_FUNCTION_0();
  _os_log_error_impl(v0, v1, v2, v3, v4, 0xCu);
}

- (void)sendCompositionForPendingCollaboration:completion:.cold.1()
{
  OUTLINED_FUNCTION_1();
  OUTLINED_FUNCTION_0();
  _os_log_error_impl(v0, v1, v2, v3, v4, 2u);
}

- (void)sendCompositionForPendingCollaboration:completion:.cold.2()
{
  OUTLINED_FUNCTION_1();
  OUTLINED_FUNCTION_0();
  _os_log_error_impl(v0, v1, v2, v3, v4, 2u);
}

- (void)_presentCollabInvalidFileProviderLocationAlertIfNecessaryForPayload:collaborationType:.cold.1()
{
  OUTLINED_FUNCTION_3();
  OUTLINED_FUNCTION_0();
  _os_log_error_impl(v0, v1, v2, v3, v4, 0xCu);
}

void __115__CKChatController__presentCollabAddToMessagesGroupAlertIfNecessary_collaborationType_sendBlock_completionHandler___block_invoke_cold_1()
{
  OUTLINED_FUNCTION_3();
  OUTLINED_FUNCTION_0();
  _os_log_error_impl(v0, v1, v2, v3, v4, 0xCu);
}

- (void)textPasteConfigurationSupporting:(const char *)a1 combineItemAttributedStrings:forRange:.cold.1(const char *a1)
{
  v1 = NSStringFromSelector(a1);
  OUTLINED_FUNCTION_3();
  OUTLINED_FUNCTION_8(&dword_19020E000, v2, v3, "returned from %@", v4, v5, v6, v7, v8);
}

- (void)textPasteConfigurationSupporting:(const char *)a1 performPasteOfAttributedString:toRange:.cold.1(const char *a1)
{
  v1 = NSStringFromSelector(a1);
  OUTLINED_FUNCTION_3();
  OUTLINED_FUNCTION_8(&dword_19020E000, v2, v3, "performed paste in %@", v4, v5, v6, v7, v8);
}

- (void)dragInteraction:previewForLiftingItem:session:.cold.3()
{
  OUTLINED_FUNCTION_4();
  OUTLINED_FUNCTION_6();
  _os_log_debug_impl(v0, v1, v2, v3, v4, 0x16u);
}

- (void)dragInteraction:session:didEndWithOperation:.cold.1()
{
  OUTLINED_FUNCTION_4();
  OUTLINED_FUNCTION_6();
  _os_log_debug_impl(v0, v1, v2, v3, v4, 0x16u);
}

- (void)dragPreviewParametersForBalloonView:.cold.1()
{
  v0 = [objc_opt_class() description];
  OUTLINED_FUNCTION_3();
  OUTLINED_FUNCTION_0_3();
  _os_log_error_impl(v1, v2, v3, v4, v5, 0xCu);
}

- (void)dropInteraction:(void *)a1 performDrop:.cold.2(void *a1)
{
  [a1 count];
  OUTLINED_FUNCTION_3();
  OUTLINED_FUNCTION_8(&dword_19020E000, v1, v2, "Perform drop with %ld itemProviders", v3, v4, v5, v6, v7);
}

- (void)dropInteraction:previewForDroppingItem:withDefault:.cold.2()
{
  OUTLINED_FUNCTION_11();
  OUTLINED_FUNCTION_6();
  _os_log_debug_impl(v0, v1, v2, v3, v4, 0x16u);
}

- (void)showInlineReplyControllerForChatItem:presentKeyboard:replyTransitionProperties:.cold.1()
{
  OUTLINED_FUNCTION_1();
  OUTLINED_FUNCTION_0();
  _os_log_error_impl(v0, v1, v2, v3, v4, 2u);
}

- (void)messageEditingViewController:contentInsetsForChatItemGuid:.cold.1()
{
  v0 = objc_opt_class();
  v1 = NSStringFromClass(v0);
  OUTLINED_FUNCTION_3();
  OUTLINED_FUNCTION_0_3();
  _os_log_error_impl(v2, v3, v4, v5, v6, 0xCu);
}

- (void)messageEditingViewController:contentInsetsForChatItemGuid:.cold.2()
{
  OUTLINED_FUNCTION_3();
  OUTLINED_FUNCTION_0();
  _os_log_error_impl(v0, v1, v2, v3, v4, 0xCu);
}

- (void)messageEditingViewController:contentInsetsForChatItemGuid:.cold.3()
{
  OUTLINED_FUNCTION_3();
  OUTLINED_FUNCTION_0();
  _os_log_error_impl(v0, v1, v2, v3, v4, 0xCu);
}

- (void)inlineReplyControllerIsAppearing:.cold.1()
{
  OUTLINED_FUNCTION_1();
  OUTLINED_FUNCTION_0();
  _os_log_error_impl(v0, v1, v2, v3, v4, 2u);
}

void __44__CKChatController_MenuBar__keyCommandPage___block_invoke_cold_1(id *a1, NSObject *a2)
{
  v6 = *MEMORY[0x1E69E9840];
  v3 = [*a1 input];
  v4 = 138412290;
  v5 = v3;
  _os_log_error_impl(&dword_19020E000, a2, OS_LOG_TYPE_ERROR, "Unexpected input key for paging key command %@", &v4, 0xCu);
}

void __127__CKChatController_GroupCollaboration___addParticipantToShare_withHandle_toCollaboration_containerSetupInfo_completionHandler___block_invoke_cold_1()
{
  OUTLINED_FUNCTION_6_1(*MEMORY[0x1E69E9840]);
  OUTLINED_FUNCTION_0_1();
  OUTLINED_FUNCTION_2(&dword_19020E000, v0, v1, "Error while adding participant to shareURL: %@ - share: %@");
}

void __127__CKChatController_GroupCollaboration___addParticipantToShare_withHandle_toCollaboration_containerSetupInfo_completionHandler___block_invoke_cold_3()
{
  OUTLINED_FUNCTION_0_1();
  OUTLINED_FUNCTION_0();
  _os_log_error_impl(v0, v1, v2, v3, v4, 0x16u);
}

void __97__CKChatController_GroupCollaboration___addParticipant_toShareURL_forChatGUID_completionHandler___block_invoke_289_cold_1()
{
  OUTLINED_FUNCTION_1();
  OUTLINED_FUNCTION_0();
  _os_log_error_impl(v0, v1, v2, v3, v4, 2u);
}

void __102__CKChatController_GroupCollaboration___removeParticipant_fromShareURL_forChatGUID_completionHandler___block_invoke_cold_2()
{
  OUTLINED_FUNCTION_1();
  OUTLINED_FUNCTION_0();
  _os_log_error_impl(v0, v1, v2, v3, v4, 2u);
}

void __102__CKChatController_GroupCollaboration___removeParticipant_fromShareURL_forChatGUID_completionHandler___block_invoke_cold_3()
{
  OUTLINED_FUNCTION_1();
  OUTLINED_FUNCTION_0();
  _os_log_error_impl(v0, v1, v2, v3, v4, 2u);
}

void __74__CKChatController_GroupCollaboration___isShareBearURL_completionHandler___block_invoke_cold_1()
{
  OUTLINED_FUNCTION_6_1(*MEMORY[0x1E69E9840]);
  OUTLINED_FUNCTION_0_1();
  OUTLINED_FUNCTION_2(&dword_19020E000, v0, v1, "Unable to get app link for url: %@, error: %@");
}

void __77__CKChatController_PhotosSupport___presentGridForPendingMomentShareChatItem___block_invoke_cold_1(uint64_t a1, uint64_t a2)
{
  v2 = @"No Error";
  if (a2 == 3)
  {
    v2 = @"Permanent";
  }

  if (a2 == 2)
  {
    v2 = @"Transient";
  }

  v8 = v2;
  OUTLINED_FUNCTION_0_3();
  _os_log_error_impl(v3, v4, v5, v6, v7, 0x16u);
}

void __74__CKChatController_PhotosSupport___presentGridForChatItem_assetReference___block_invoke_cold_1(uint64_t a1, uint64_t a2)
{
  v2 = @"No Error";
  if (a2 == 3)
  {
    v2 = @"Permanent";
  }

  if (a2 == 2)
  {
    v2 = @"Transient";
  }

  v3 = v2;
  OUTLINED_FUNCTION_3_4();
  OUTLINED_FUNCTION_0_3();
  _os_log_error_impl(v4, v5, v6, v7, v8, 0x20u);
}

void __124__CKChatController_PhotosSupport___gridViewNavigationControllerForMomentShareURL_chatItem_tapbackManager_completionHandler___block_invoke_cold_3(char a1, NSObject *a2)
{
  v3 = *MEMORY[0x1E69E9840];
  v2[0] = 67109120;
  v2[1] = a1 & 1;
  _os_log_debug_impl(&dword_19020E000, a2, OS_LOG_TYPE_DEBUG, "Failed to create and return a CMM grid view navigation controller (permanent: %d)", v2, 8u);
}

void __84__CKChatController_PhotosSupport__presentedPreviewControllerDidSelectNavigateToGrid__block_invoke_cold_1(uint64_t a1, uint64_t a2)
{
  v2 = @"No Error";
  if (a2 == 3)
  {
    v2 = @"Permanent";
  }

  if (a2 == 2)
  {
    v2 = @"Transient";
  }

  v3 = v2;
  OUTLINED_FUNCTION_3_4();
  OUTLINED_FUNCTION_0_3();
  _os_log_error_impl(v4, v5, v6, v7, v8, 0x20u);
}

@end