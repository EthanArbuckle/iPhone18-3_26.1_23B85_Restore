uint64_t sub_1002D948C(uint64_t a1, uint64_t a2, uint64_t a3, uint64_t a4, uint64_t a5, uint64_t a6)
{
  v7 = ((0x21E966DDu % (v6 - 1553)) ^ 0xCB5FDFBF) + 2 * (0x21E966DDu % (v6 - 1553));
  if (v7 + 882909249 >= 3)
  {
    v8 = 1978345467;
  }

  else
  {
    v8 = 1978345470;
  }

  return (*(a6 + 8 * ((117 * (v8 + v7 == 1095436221)) ^ (v6 - 114))))(141636387, 599282036, 46711345, 1052047427, 2080107929, 3614675250, 1095436221);
}

uint64_t sub_1002DAF30(uint64_t a1, uint64_t a2, uint64_t a3, uint64_t a4, uint64_t a5, uint64_t a6, uint64_t a7, uint64_t a8, uint64_t a9, uint64_t a10, uint64_t a11, uint64_t a12, uint64_t a13, uint64_t a14, uint64_t a15, uint64_t a16, uint64_t a17, uint64_t a18, uint64_t a19, uint64_t a20, uint64_t a21, uint64_t a22, uint64_t a23, uint64_t a24, uint64_t a25, uint64_t a26, uint64_t a27, uint64_t a28, uint64_t a29, uint64_t a30, uint64_t a31, uint64_t a32, uint64_t a33, uint64_t a34, uint64_t a35, uint64_t a36, uint64_t a37, uint64_t a38, uint64_t a39, uint64_t a40, uint64_t a41, uint64_t a42, uint64_t a43, uint64_t a44, uint64_t a45)
{
  v48 = v45 + 1549;
  *(v47 - 208) = 0x906249FEB2907B24;
  *(v47 - 200) = 0x798D38F436DABF7FLL;
  *(v47 - 192) = 0x906249FEB2907B24;
  *(v47 - 184) = 0x798D38F436DABF7FLL;
  v50 = a2 != 1622093268 && (a2 & 0xF) == ((v45 + 774) ^ 0x4CB);
  return (*(v46 + 8 * ((11 * v50) ^ v48)))(a1, a2, 1622093268, a4, a5, a6, a7, a8, a9, a10, a11, a12, a13, a14, a15, a16, a17, a18, a19, a20, a21, a22, a23, a24, a25, a26, a27, a28, a29, a30, a31, a32, a33, a34, a35, a36, a37, a38, a39, a40, a41, a42, a43, a44, a45);
}

uint64_t sub_1002DCA60@<X0>(uint64_t a1@<X0>, int a2@<W1>, unsigned int a3@<W2>, int a4@<W8>)
{
  v13 = v10 < v8;
  if (v13 == a3 + 1455529988 < v8)
  {
    v13 = a3 + 1455529988 < v10;
  }

  v14 = (a1 + (v7 ^ 0x748C135E8B050469) + a3 + ((a3 < v9) << 32) - 0x748C135EDD186F47);
  v15 = (((a1 + (v7 ^ 0x8B050469) + a3 + 585601209) ^ *(*(v6 + 1072) + (*(v5 + 1592) & v4))) & 0x7FFFFFFF) * a4;
  *v14 ^= byte_100385AE0[((v7 ^ 0x8B050469) + a3 + 585601209) & 0xF | (16 * (((v15 ^ HIWORD(v15)) * a4) >> 24))] ^ (113 * (v15 ^ BYTE2(v15)));
  return (*(v12 + 8 * ((!v13 * a2) ^ v11)))();
}

uint64_t sub_1002DCB78@<X0>(uint64_t a1@<X0>, int a2@<W8>)
{
  v9 = (a1 + (v6 - 2122285071));
  v10 = *v9;
  LODWORD(v9) = ((v9 ^ *(*(v4 + 1072) + (*(v3 + 1592) & v2))) & 0x7FFFFFFF) * a2;
  v11 = (v9 ^ (v9 >> 16)) * a2;
  **(v7 + 16) = byte_10038F8D0[v11 >> 24] ^ v10 ^ byte_100393210[v11 >> 24] ^ byte_1003A5E90[(v11 >> 24) + 5] ^ v11 ^ (-101 * BYTE3(v11));
  return (*(v8 + 8 * (v5 - 365)))();
}

uint64_t sub_1002DCCB0(uint64_t a1, uint64_t a2, uint64_t a3, uint64_t a4, uint64_t a5, uint64_t a6, uint64_t a7, uint64_t a8, uint64_t a9, uint64_t a10, uint64_t a11, uint64_t a12, uint64_t a13, uint64_t a14, uint64_t a15, uint64_t a16, uint64_t a17, uint64_t a18, uint64_t a19, uint64_t a20, uint64_t a21, uint64_t a22, uint64_t a23, uint64_t a24, uint64_t a25, uint64_t a26, uint64_t a27, uint64_t a28, uint64_t a29, uint64_t a30, uint64_t a31, uint64_t a32, uint64_t a33, uint64_t a34, uint64_t a35, uint64_t a36, uint64_t a37, uint64_t a38, uint64_t a39, uint64_t a40, uint64_t a41, uint64_t a42, uint64_t a43, uint64_t a44, uint64_t a45, uint64_t a46, uint64_t a47, uint64_t a48, uint64_t a49, uint64_t a50)
{
  v52 = (((HIDWORD(a32) ^ a25 ^ 0xD5BF2485) - ((2 * (HIDWORD(a32) ^ a25 ^ 0xD5BF2485) + 1071322170) & 0x21213820) - 1870780883) ^ 0x90909C10) + a21;
  v53 = (v52 ^ 0xEBF8FFF) - 247435263 + ((2 * v52) & 0x1D7F1FFE);
  v54 = (v53 ^ 0xA1C13AC5) - 2 * ((v53 ^ 0xA1C13AC5) & 0x2EB05E7F ^ v53 & 0x10) - 1364173201;
  v55 = (((v54 ^ 0xAEB05E6F) + v53) ^ 0x5F674B74) + ((2 * ((v54 ^ 0xAEB05E6F) + v53)) & 0xBECE96E8) - 1600605043 + ((((2 * v54) ^ 0x5D60BCDE) - ((2 * ((2 * v54) ^ 0x5D60BCDE)) & 0x42A8A170) - 1588309831) ^ 0x5EABAF46);
  v56 = ((v55 - ((2 * v55) & 0x4AA2858) - 2108353492) ^ 0x7DAAEBD2) + v53;
  v57 = (((v56 - 1744425056 - ((2 * v56) & 0x300C5F40) + 8) | 1) - 8) ^ 0x98062FA0;
  HIDWORD(a50) = 169 * (v51 ^ 0x8D);
  v58 = (((678018117 << (BYTE4(a50) ^ 0x53)) & 0xF7FDBBDE) + 1787804444 - ((678018117 << (BYTE4(a50) ^ 0x53)) & 0xC6FD757E) + 695939017) * ((v57 + 1783587643 + ((2 * (v57 & 0x6A4F633E ^ (v56 | 0xFFFFFFFB))) ^ 0xB) + 1) ^ 0x6A4F633B);
  LOBYTE(v58) = v58 - ((2 * v58) & 0x76) + 59;
  v59 = HIDWORD(a10) ^ a12 ^ 0x407983A6 ^ dword_100389AD0[(v58 ^ v50) ^ 0xCF];
  v60 = a10 ^ 0x86B70F35 ^ (v59 - 2034823371 - ((2 * v59) & 0xD6E1E6A));
  *(a1 + 4 * (v58 ^ 0x3Bu)) = (v60 - ((2 * v60) & 0x4FE8E574) + 670331578) ^ 0x50076113;
  return (*(&off_1003E7570 + v51))(1111706867, 2074146592, 2625717568, 3338499454, 2080300527, 4160601054, 695939017, 71166582, a9, a10, a11, a12, a13, a14, a15, a16, a17, a18, a19, a20, a21, a22, a23, a24, a25, a26, a27, a28, a29, a30, a31, a32, a33, a34, a35, a36, a37, a38, a39, a40, a41, a42, a43, a44, a45, a46, a1, a48, a49, a50);
}

uint64_t sub_1002DCFF4(uint64_t a1, uint64_t a2, uint64_t a3, uint64_t a4, uint64_t a5, uint64_t a6, uint64_t a7, uint64_t a8, uint64_t a9, uint64_t a10, uint64_t a11, uint64_t a12, uint64_t a13, uint64_t a14, uint64_t a15, uint64_t a16, uint64_t a17, uint64_t a18, uint64_t a19, uint64_t a20, uint64_t a21, uint64_t a22, uint64_t a23, uint64_t a24, uint64_t a25, uint64_t a26, uint64_t a27, uint64_t a28, uint64_t a29, uint64_t a30, uint64_t a31, uint64_t a32, uint64_t a33, uint64_t a34, uint64_t a35, uint64_t a36, uint64_t a37, uint64_t a38, uint64_t a39, uint64_t a40, uint64_t a41, uint64_t a42, uint64_t a43, uint64_t a44, uint64_t a45, uint64_t a46, uint64_t a47, uint64_t a48, uint64_t a49, int a50, int a51, uint64_t a52, uint64_t a53, uint64_t a54, uint64_t a55)
{
  LODWORD(a21) = -810860798;
  LODWORD(a17) = a26 ^ HIDWORD(a12) ^ HIDWORD(a36);
  v357 = v55 ^ 0xCB60F681;
  v56 = ((a51 + 24) ^ 0x51 ^ (11 * (v55 ^ 0x81))) + (((v55 ^ 0x81) * ((a51 + 77) ^ 9)) & 0x76) + *(a41 + (v55 ^ 0xCB60F681));
  v57 = byte_1003A75F0[(v56 - ((2 * v56 - 110) & 0x96) - 108) ^ 0x63];
  v58 = -7 * v57 - ((HIDWORD(a30) - 14 * v57) & 0xFFFFFFCA);
  v59 = (-7 * v57 - ((BYTE4(a30) - 14 * v57) & 0xCA) + 64);
  LODWORD(v356) = v55 & 0xFFFFFFFD ^ 0xCB60F683;
  v60 = v356 + 942870835 + ((2 * (v356 & 0x3833113D ^ (v55 | 0x7FFFFFF3))) ^ 0x1D) + 1;
  v61 = ((v58 + 64) ^ 0xFFFFFFE5) + 25;
  v62 = (50 * v57 - ((36 * v57 + 44) & 0x30) + 47) & 0x32;
  LOBYTE(v60) = ~(11 * (v60 ^ 0x33)) + *(a41 + (v60 ^ 0x38331133u)) + 22 * (v60 ^ 0x33);
  LODWORD(a43) = v55 & 0xFFFFFFF7;
  v63 = ((2 * v55) & 0xFFFFEBEC ^ 0x96C1E910) + (v55 & 0xFFFFFFF7 ^ 0x349F0377);
  v64 = byte_1003AEFD0[(v60 - ((2 * v60 + 10) & 0x20) + 21) ^ 0x43];
  v65 = (v62 ^ 0xFFFFFFCF) + (v61 ^ 0xFFFFFFBA) + ((2 * v61) & 0x74) + 71;
  v66 = v64 & 0xF0;
  v67 = (((v58 + 64) >> 7) & 1 | 0x64) ^ (v59 >> 4) ^ 0x25 ^ (v65 - 2 * (v65 & 0x4F ^ v61 & 1) + 78);
  v68 = ((v67 - ((2 * v67) & 0x74)) << 24) + 973078528;
  LOBYTE(v65) = -11 * v63 - ((-22 * v63 - 44) & 0x9A) - 73;
  v69 = (16 * v64 - ((32 * v64) & 0xC0) - 23) ^ (v64 & 0x20 | 0xC0);
  v70 = (((v66 & 0xFFFFFFF0 | (v69 >> 4)) ^ 0xA0) - 2 * ((v66 & 0x50 | (v69 >> 4) & 0x57) ^ (v69 >> 4) & 6) - 47) ^ 0xD3;
  v71 = (((v70 - ((2 * v70) & 0xAA)) << 8) + 442979584) ^ 0x1A675500;
  LOBYTE(v65) = (((v65 & 0x97 ^ 0xED) - ((2 * (v65 & 0x97 ^ 0xED)) & 0x42) + 33) ^ 0x20) & (((v65 & 0x68 ^ 0xDE) + 92 - ((2 * (v65 & 0x68 ^ 0xDE)) & 0xB8)) ^ 0x5C);
  LOBYTE(v63) = *(a41 + v63 + 2562) - ((v65 - ((2 * v65) & 0x18) - 116) ^ 0x8C);
  v72 = (v71 + 992805824 - ((2 * v71) & 0x765A0600)) ^ 0x3B2D03C0 | ((v68 ^ 0x3A000000) + 69590135 - ((2 * v68) & 0x8000000)) ^ 0x425DC77;
  v73 = v72 - 1473809954 - ((2 * v72) & 0x504EE3BC);
  v74 = byte_1003A75F0[(((v63 - ((2 * v63) & 0xAE) - 41) ^ 0xD4) + 4)];
  v75 = -7 * v74 + ((14 * v74 + 9) | 0xFFFFFFE3) - 22;
  v76 = (v55 & 0xFFFFFFFB ^ 0xCB60F685) - 1600766044 + ((2 * ((v55 & 0xFFFFFFFB ^ 0xCB60F685) & 0x20963FA8 ^ (v55 | 0x7FFFFFF7))) ^ 0x19) + 1;
  HIDWORD(v356) = v76 ^ 0xA0963FA4;
  v77 = ((22 * (v76 ^ 0xA4)) & 0x1E) + ((11 * (v76 ^ 0xFFFFFFA4)) ^ 0xF) + *(a41 + (v76 ^ 0xA0963FA4));
  v78 = (v77 + 100);
  v79 = v75 ^ (v75 >> 7) ^ (v75 >> 4) ^ 0x9B;
  v80 = (((v79 - ((2 * v79) & 0xD0)) << 24) + 1744830464) ^ 0x68000000;
  v81 = 2 * v77 - ((4 * v77 - 44) & 0xFFFFFF87) + 45;
  v82 = (v78 | ((v78 < 0x6F) << 8)) + (v81 & 0xB0 ^ 0x10818059) - ((2 * v81) & 0x140);
  v83 = byte_1003A75F0[(v82 - ((2 * v82 - 553844960) & 0xC6B9577A) - 757388467) ^ 0xE35CABBFLL];
  v84 = v80 - 711842171 - ((2 * v80) & 0xAA000000);
  v85 = -7 * v83 - ((HIDWORD(a30) - 14 * v83) & 0xFFFFFF9C) - 87;
  v86 = (v55 & 0xFFFFFFF4 ^ 0xCB60F68B) + 1864942129 - ((2 * (v55 & 0xFFFFFFF4 ^ 0xCB60F68B)) & 0xDE518462);
  LODWORD(a37) = v86 ^ 0x6F28C231;
  LOBYTE(v86) = ((11 * (v86 ^ 0x31)) ^ 0x3F) + ((22 * (v86 ^ 0x31)) & 0x7E) + *(a41 + (v86 ^ 0x6F28C231));
  v87 = (v85 >> 4) & 1 ^ (v85 >> 7) & 1;
  v88 = v86 - ((2 * v86 + 10) & 0x1C) + 83;
  v89 = (v85 >> 4) & 0xE;
  if ((v87 & v85) != 0)
  {
    v90 = (v85 ^ 0x4E) - v87 - ((2 * ((v85 ^ 0x4E) - v87)) & 0x30) + 24;
  }

  else
  {
    v90 = v85 ^ ((v85 >> 7) & 1 | 0xFFFFFFC8) ^ ((v85 >> 4) & 1 | 0x54) ^ 0xCA;
  }

  v91 = byte_10038A800[v88 ^ 0x5CLL];
  v92 = ((((v89 ^ v90 ^ 0xFE) - ((2 * (v89 ^ v90 ^ 0xFE)) & 0xFFFFFFDF)) << 24) + 1862270976) ^ 0x6F000000;
  HIDWORD(v351) = v92 + 754790961 - ((2 * v92) & 0x58000000);
  LODWORD(v355) = v55 & 0xFFFFFFF9 ^ 0xCB60F687;
  v93 = ((11 * ((v355 - 75 - ((2 * v355) & 0x6A)) ^ 0xB5)) ^ 0xFB) + ((22 * ((v355 - 75 - ((2 * v355) & 0x6A)) ^ 0xB5)) & 0xF7) + *(a41 + ((v355 - 1564612171 - ((2 * v355) & 0x457BD36A)) ^ 0xA2BDE9B5));
  HIDWORD(v94) = v91 ^ 2;
  LODWORD(v94) = (v91 ^ 0xFFFFFFDF) << 24;
  v95 = byte_1003AEFD0[(v93 - ((2 * v93 + 18) & 0xAC) - 33) ^ 0x86];
  v96 = (v94 >> 27) - ((2 * (v94 >> 27)) & 0xFFFFFF87) + 67;
  LODWORD(a35) = v55 & 0xFFFFFFF0 ^ 0xCB60F68F;
  v97 = ((11 * ((a35 - 46 - ((2 * a35) & 0xA4)) ^ 0xD2)) ^ 0x4E) + ((22 * ((a35 - 46 - ((2 * a35) & 0xA4)) ^ 0xD2)) & 0x9C) + *(a41 + ((a35 - 41217070 - ((2 * a35) & 0xFB1627A4)) ^ 0xFD8B13D2));
  v98 = v84 ^ 0xD5922685 | ((v96 ^ 0x53 ^ (v96 >> 2) & 0x39) + 617091380 - ((2 * (v96 ^ 0x53 ^ (v96 >> 2) & 0x39)) & 0x68)) ^ 0x24C81134;
  v99 = v98 - 1922914445 - ((2 * v98) & 0x1AC54EE6);
  v100 = byte_10038A800[(v97 - ((2 * v97 + 108) & 0x6E) + 109) ^ 0x88];
  v101 = ((((v95 ^ 0x26 ^ (v95 >> 4) & 2) - ((2 * (v95 ^ 0x26 ^ (v95 >> 4) & 2)) & 0x1F8)) << 8) + 1881275392) ^ 0x7021FC00;
  HIDWORD(v94) = v100 ^ 2;
  LODWORD(v94) = (v100 ^ 0xFFFFFFDF) << 24;
  LODWORD(v351) = v101 - ((2 * v101) & 0x4649800);
  v102 = (v94 >> 27) - ((2 * (v94 >> 27)) & 0x4E);
  HIDWORD(v355) = v55 & 0xFFFFFFF5 ^ 0xCB60F68B;
  v103 = HIDWORD(v355) + 644451115 + ((2 * (HIDWORD(v355) & 0x26698B35 ^ (v55 | 0x7FFFFFEB))) ^ 0x3D) + 1;
  LOBYTE(v103) = ((22 * (v103 ^ 0x2B)) & 0x76) + ((11 * (v103 ^ 0x2B)) ^ 0x3B) + *(a41 + (v103 ^ 0x26698B2Bu)) - 1;
  v104 = byte_1003AEFD0[(v103 - ((2 * v103 - 108) & 0x87) - 115) ^ 0x13];
  v105 = (((v104 >> 4) | 0xDDDDDDDD) ^ v104) & 0x6B ^ 0xFFFFFFDD;
  v106 = v104 & 0x94 ^ 0x8F ^ (v105 - ((2 * v105) & 0x36) - 101);
  v107 = (((v106 - ((2 * v106) & 0xD0)) << 8) + 318203904) ^ 0x12F76800;
  v108 = (v107 + 1367839487 - ((2 * v107) & 0x230F2400)) ^ 0x518792FF | v99 ^ 0x8D62A773;
  v109 = (v55 & 0xFFFFFFFC ^ 0xCB60F683) - 301555190 + ((2 * ((v55 & 0xFFFFFFFC ^ 0xCB60F683) & 0x6E06A21C ^ (v55 | 0x7FFFFFEB))) ^ 0x2D) + 1;
  LODWORD(a32) = v109 ^ 0xEE06A20A;
  LOBYTE(v109) = ((11 * (v109 ^ 0xA)) ^ 0xDF) + ((22 * (v109 ^ 0xA)) & 0xBF) + *(a41 + (v109 ^ 0xEE06A20A));
  v110 = byte_10038A800[(v109 - ((2 * v109 + 74) & 0xC3) - 122) ^ 0x28];
  v111 = v108 - 1028660168 - ((2 * v108) & 0x855FC870);
  LODWORD(v354) = -882837879;
  v112 = (v55 & 0xFFFFFFF6 ^ 0xCB60F689) + 920096598 - ((2 * (v55 & 0xFFFFFFF6 ^ 0xCB60F689)) & 0x6DAF1EAC);
  HIDWORD(v94) = v110 ^ 2;
  LODWORD(v94) = (v110 ^ 0xFFFFFFDF) << 24;
  v113 = (v94 >> 27) - ((2 * (v94 >> 27)) & 0xFFFFFFDA) + 109;
  v114 = (v113 ^ 0x6D) - ((2 * (v113 ^ 0x6D)) & 0xF2);
  LODWORD(a29) = v112 ^ 0x36D78F56;
  LOBYTE(v112) = ((11 * (v112 ^ 0x56)) ^ 0x7F) + 22 * (v112 ^ 0x56) + *(a41 + (v112 ^ 0x36D78F56));
  v115 = v73 ^ 0xA82771DE | (((v113 >> 2) & 0x39 ^ 0x19) + 887513580 - ((2 * ((v113 >> 2) & 0x39 ^ 0x19)) & 0xDDDDDDDD)) ^ 0x34E661EC;
  v116 = byte_1003922C0[(v112 + ((116 - 2 * v112) | 0xBF) - 90) ^ 0x2ELL] ^ 0x72;
  v117 = (((v116 - ((2 * v116) & 0xA6)) << 16) + 173211648) ^ 0xA530000;
  v118 = (v55 & 0xFFFFFFF2 ^ 0xCB60F68D) - 1867622664 - ((2 * (v55 & 0xFFFFFFF2 ^ 0xCB60F68D)) & 0x215CADF0);
  v119 = v117 - ((2 * v117) & 0x9960000) - 993315335;
  HIDWORD(v354) = v118 ^ 0x90AE56F8;
  LOBYTE(v118) = ((11 * (v118 ^ 0xF8)) ^ 0x7F) + 22 * (v118 ^ 0xF8) + *(a41 + (v118 ^ 0x90AE56F8));
  v120 = (((v111 & 0xBE00647C | v119 & 0xA40000) ^ 0x82806438) - 338722506 - ((2 * ((v111 & 0xBE00647C | v119 & 0xA40000) ^ 0x82806438)) & 0x55080068)) ^ 0xEBCF8136 | (((v111 & 0x41009B83 | v119 & 0x5B0000) ^ 0x404B8000) - 955243687 - ((2 * ((v111 & 0x41009B83 | v119 & 0x5B0000) ^ 0x404B8000)) & 0x82200602)) ^ 0xC7102359;
  v111 ^= 0xC2AFE438;
  v121 = v111 - ((v120 - 1645447664 - ((2 * v120) & 0x3BD8EC20)) ^ 0x9DEC7610);
  v122 = (v119 ^ ((v119 ^ 0x3B34CA06) - ((2 * (v119 ^ 0x3B34CA06) + 2) & 0xE4CC3F04) - 228188285) ^ 0x1E2D9DA1 ^ (v121 - ((2 * v121) & 0x51016FB4) + 679524314)) + v111;
  v123 = byte_1003922C0[(v118 - ((2 * v118 + 10) & 0xC3) + 102) ^ 0xD4] ^ 0x1A;
  v124 = (((v123 - ((2 * v123) & 0x17A)) << 16) + 1589444608) ^ 0x5EBD0000;
  v125 = (v102 + 39) ^ 0x2E ^ ((v102 + 39) >> 2) & 0x39;
  v126 = (v124 + 1684151868 - ((2 * v124) & 0x48C40000)) ^ 0x64621E3C | (v125 - 1652956683 - ((2 * v125) & 0x1EA)) ^ 0x9D79E1F5;
  v127 = v126 - 518155932 - ((2 * v126) & 0x423B22C8);
  v128 = (v55 & 0xFFFFFFFE ^ 0xCB60F681) + 2087556097 + ((2 * ((v55 & 0xFFFFFFFE ^ 0xCB60F681) & 0x7C6D9406 ^ (v55 | 0x7FFFFFF9))) ^ 0xF) + 1;
  LODWORD(v352) = v128 ^ 0x7C6D9401;
  LOBYTE(v119) = ((11 * (v128 | 1)) ^ 0x63) + ((22 * (v128 | 1)) & 0xC7) + *(a41 + (v128 ^ 0x7C6D9401));
  v129 = (v55 & 0xFFFFFFF1 ^ 0xCB60F68F) + 1620641771 + ((2 * ((v55 & 0xFFFFFFF1 ^ 0xCB60F68F) & 0x609907F1 ^ (v55 | 0x7FFFFFEF))) ^ 0x35) + 1;
  HIDWORD(v353) = v129 ^ 0x609907EB;
  LOBYTE(v129) = ((11 * (v129 ^ 0xEB)) ^ 0x3F) + ((22 * (v129 ^ 0xEB)) & 0x7E) + *(a41 + (v129 ^ 0x609907EB));
  v130 = (v55 & 0xFFFFFFF3 ^ 0xCB60F68D) + 1417713652 - ((2 * (v55 & 0xFFFFFFF3 ^ 0xCB60F68D)) & 0xA9012FE8);
  LOBYTE(v117) = v129 - ((2 * v129 + 10) & 0x12);
  v131 = byte_1003922C0[(v119 - ((2 * v119 + 66) & 0xA4) - 13) ^ 2] ^ 0x28;
  v132 = (((v131 - ((2 * v131) & 0xB2)) << 16) + 2102984704) ^ 0x7D590000;
  v133 = (v132 - 266024838 - ((2 * v132) & 0x60480000)) ^ 0xF024C87A | (v114 - 1482150535) ^ 0x8A323DA8 ^ (v115 - ((2 * v115) & 0x5B3421A2) + 765071569);
  HIDWORD(a26) = v130 ^ 0x548097F4;
  LOBYTE(v114) = ((22 * (((v55 & 0xF3 ^ 0x8D) - 12 - ((2 * (v55 & 0xF3 ^ 0x8D)) & 0xE8)) ^ 0xF4)) & 0x7E) + ((11 * (v130 ^ 0xF4)) ^ 0xBF) + *(a41 + (v130 ^ 0x548097F4)) + 65;
  LODWORD(v353) = v55 & 0xFFFFFFFA ^ 0xCB60F685;
  LOBYTE(v129) = v114 - ((2 * v114) & 0xA2) + 81;
  LOBYTE(v130) = (2 * v129 - ((4 * v129) & 8) + 5) & 8;
  v134 = byte_1003AEFD0[(v117 + 78) ^ 0x6CLL];
  v135 = ((((v134 ^ 0xF7 ^ (v134 >> 4) & 2) - ((2 * (v134 ^ 0xF7 ^ (v134 >> 4) & 2)) & 0x12C)) << 8) + 877499904) ^ 0x344D9600;
  v136 = (v135 - 340489317 - ((2 * v135) & 0x57691600)) ^ 0xEBB48B9B | v127 ^ 0xE11D9164;
  v137 = byte_1003A75F0[(v130 + (v129 ^ 0x55) - 2 * ((v130 + (v129 ^ 0x55)) & 0x4F ^ (v129 ^ 0x55) & 3) + 76) ^ 0xD7];
  v138 = -7 * v137 + ((a30 + 14 * v137) | 0xFFFFFFAD) - 123;
  v139 = ((11 * ((v353 + 209138680 - ((2 * v353) & 0x18EE67F0)) ^ 0xFFFFFFF8)) ^ 0x6B) + ((22 * ((v353 + 209138680 - ((2 * v353) & 0x18EE67F0)) ^ 0xFFFFFFF8)) & 0xFFFFFFD6) + *(a41 + ((v353 + 209138680 - ((2 * v353) & 0x18EE67F0)) ^ 0xC7733F8u));
  HIDWORD(v352) = v55 & 0xFFFFFFF8 ^ 0xCB60F687;
  v140 = v138 & 0xC6 ^ (v138 >> 4) ^ ((v138 >> 7) & 1 | 0xFE) ^ 0x73 ^ ((v138 & 0x39 ^ 0xFFFFFFEF) - 2 * ((v138 & 0x39 ^ 0xFFFFFFEF) & 0xF) - 113);
  v141 = (((v140 - ((2 * v140) & 0x74)) << 24) - 1174405120) ^ 0xBA000000;
  v142 = v139 - ((2 * v139 + 50) & 0x54) - 61;
  v143 = ((v142 & 0xE ^ 0xFFFFFFF5) - ((2 * v142) & 0x10) - 56) ^ 0x48;
  v144 = (v142 ^ 0x3D792DB3) + ((2 * (v142 ^ 0x44)) & 0x1EE) + (v143 ^ 0x304208) - ((2 * v143) & 0x1EE);
  v145 = (2 * (v144 + 1) - 4 * ((v144 - 1034514431) & 0xC570EED ^ (v144 + 1) & 0x29) - 1654964856) ^ 0x18AE1D88;
  v146 = (v142 ^ 0xFB53BF02) + ((2 * (v142 ^ 0xFFFFFFB5)) & 0x16E) + 78397754 + ((v145 + 876450195 - ((2 * v145) & 0x687B2324)) ^ 0x343D9193);
  v147 = byte_1003922C0[(v146 + 21258325 - ((2 * v146) & 0x288C0AA)) ^ 0x1446055] ^ 0x5C;
  v148 = (((v147 - ((2 * v147) & 0x19C)) << 16) - 1999765504) ^ 0x88CE0000;
  v149 = (v148 - 343893342 - ((2 * v148) & 0x57000000)) ^ 0xEB809AA2 | HIDWORD(v351) ^ 0x2CFD3231;
  v150 = (v141 + 2003128989 - ((2 * v141) & 0xEE000000)) ^ 0x7765529D | (v136 - 1908346371 - ((2 * v136) & 0x1C81E3FA)) ^ 0x8E40F1FD;
  LOBYTE(v139) = ((11 * ((BYTE4(v352) + 11 - ((2 * BYTE4(v352)) & 0x16)) ^ 0xB)) ^ 0xBF) + ((22 * ((BYTE4(v352) + 11 - ((2 * BYTE4(v352)) & 0x16)) ^ 0xB)) & 0x7E) + *(a41 + ((HIDWORD(v352) + 984372235 - ((2 * HIDWORD(v352)) & 0x7558A816)) ^ 0x3AAC540Bu));
  v151 = byte_10038A800[(v139 - ((2 * v139 - 118) & 0xB0) - 99) ^ 0x2DLL];
  HIDWORD(v94) = v151 ^ 2;
  LODWORD(v94) = (v151 ^ 0xFFFFFFDF) << 24;
  v152 = (v94 >> 27) - ((2 * (v94 >> 27)) & 0x5E);
  HIDWORD(v94) = (v122 ^ 0xEAFF77B2) + 352356430 + ((2 * v122) & 0xD5FEEF64);
  LODWORD(v94) = HIDWORD(v94);
  v153 = (v149 + 1608607483 - ((2 * v149) & 0xBFC2CDF6)) ^ 0x5FE166FB;
  v154 = v153 | (v351 + 19657) & 0x7F00 ^ 0x4C00;
  v155 = v154 - 877450494 - 2 * (v154 & 0x4BB32B22 ^ v153 & 0x20);
  v152 -= 81;
  v156 = (((v351 + 19657) & 0x8000) + 1386555650 + (v152 ^ 0xAF) - ((2 * (v152 ^ 0xAF)) & 4)) ^ 0x52A52902;
  v157 = (v156 + 931797404 - ((2 * v156) & 0x6F143338)) ^ 0x378A199C;
  v158 = v157 - (((v155 ^ 0xCBB32B02 | v157) + 212506879 - ((2 * (v155 ^ 0xCBB32B02 | v157)) & 0x195531FE)) ^ 0xCAA98FF);
  v159 = (((4 * HIDWORD(a21)) ^ 0x1BC75334) - ((2 * ((4 * HIDWORD(a21)) ^ 0x1BC75334)) & 0x9800FF48) + 1275101095) ^ ((HIDWORD(a21) >> 30) | 0xECE4C2A4);
  v160 = (v155 ^ ((v155 ^ 0x344CD4FD) - ((2 * (v155 ^ 0x344CD4FD) + 2) & 0x3E5A24D0) + 523047529) ^ 0x61BCEC4F ^ (v158 - ((2 * v158) & 0x6A45AA4A) - 1256008411)) + v157;
  v161 = ((2 * v160) & 0x7F7EEB5E) + (v160 ^ 0xBFBF75AF);
  v162 = ((v152 >> 2) & 0x39 ^ 0x29) - 220457546 - ((2 * ((v152 >> 2) & 0x39 ^ 0x29)) & 0x60);
  v163 = v161 + 1077971537;
  v164 = ((((v161 + 1077971537) ^ v162 ^ 0xF2DC15B6) - 2 * (((v161 + 1077971537) ^ v162 ^ 0xF2DC15B6) & 0x5F5A967F ^ ((v161 + 1077971537) ^ v162) & 8) - 547711369) ^ 0x20A56988) + v161;
  v165 = (v94 >> 30) - ((2 * (v94 >> 30)) & 0xE07639F6) + 1882922235;
  v166 = v159 ^ ~v165;
  v167 = v159 ^ 0xFB257B98 ^ v165;
  v168 = v150 - ((2 * v150) & 0xB8950C28) - 599095788;
  v169 = (v162 ^ 0xD23EA49) - ((2 * (v162 ^ 0xD23EA49) + 2) & 0xF43B778E) - 98714680;
  v170 = (v162 ^ v169 ^ 0x7CA3B2C7 ^ (v164 - ((2 * v164 - 2139024220) & 0xE8C4396C) - 1264408824)) + v163;
  v171 = HIDWORD(a35) ^ a36 ^ HIDWORD(a20);
  v172 = v171 ^ HIDWORD(a32) ^ v168;
  v173 = v171 ^ (((HIDWORD(a31) - 2112389658) ^ 0x36C800E7 ^ (v133 + 919077095 - ((2 * v133) & 0x6D9001CE))) - ((2 * ((HIDWORD(a31) - 2112389658) ^ 0x36C800E7 ^ (v133 + 919077095 - ((2 * v133) & 0x6D9001CE)))) & 0xC584A628) + 1656902420);
  v174 = v171 ^ ((__PAIR64__(v166, v167) >> 2) - ((2 * (__PAIR64__(v166, v167) >> 2)) & 0x1B0296A2) + 226577233);
  v175 = v171 ^ a31 ^ (v170 - ((2 * v170) & 0xDA88FE2E) - 314278121);
  v176 = *(a19 + 4 * (v172 ^ 0x84u)) ^ *(a49 + 4 * (HIBYTE(v173) ^ 0x1C)) ^ *(a53 + 4 * (BYTE1(v174) ^ 0x6Du)) ^ *(a47 + 4 * (BYTE2(v175) ^ 0xC0u));
  v177 = *(a49 + 4 * (HIBYTE(v175) ^ 2)) ^ *(a53 + 4 * (BYTE1(v172) ^ 0x5Bu)) ^ *(a19 + 4 * ((v171 ^ (((BYTE4(a31) - 26) ^ 0xE7 ^ (v133 - 25 - ((2 * v133) & 0xCE))) - ((2 * ((BYTE4(a31) - 26) ^ 0xE7 ^ (v133 - 25 - ((2 * v133) & 0xCE)))) & 0x28) + 20)) ^ 0x16u)) ^ *(a47 + 4 * (BYTE2(v174) ^ 0x77u));
  v178 = *(a53 + 4 * (BYTE1(v175) ^ 0x5Du));
  v179 = *(a47 + 4 * (BYTE2(v172) ^ 0xBAu)) ^ *(a53 + 4 * (((v171 ^ (((WORD2(a31) + 32230) ^ 0xE7 ^ (v133 + 231 - ((2 * v133) & 0x1CE))) - ((2 * ((WORD2(a31) + 32230) ^ 0xE7 ^ (v133 + 231 - ((2 * v133) & 0x1CE)))) & 0xA628) + 21268)) >> 8) ^ 0xDDu)) ^ *(a49 + 4 * (HIBYTE(v174) ^ 0xB1)) ^ *(a19 + 4 * (v175 ^ 0x81u));
  v180 = v178 ^ *(a49 + 4 * (HIBYTE(v172) ^ 0xD3)) ^ *(a19 + 4 * (v174 ^ 0x82u)) ^ *(a47 + 4 * (BYTE2(v173) ^ 0xF8u));
  v181 = *(a19 + 4 * (v180 ^ 0xB1u)) ^ 0x43075F2A;
  v182 = *(a47 + 4 * (BYTE2(v177) ^ 0xEEu)) ^ 0xC3F7EB70 ^ *(a53 + 4 * (BYTE1(v179) ^ 0xAu)) ^ *(a49 + 4 * (HIBYTE(v176) ^ 0x4C));
  v183 = v181 + v182;
  v184 = (v181 & v182) - ((2 * (v181 & v182)) & 0x3B331DDE);
  v185 = ((2 * v184 - 1154277922) ^ 0xBB331DDE) + 1975693405 - 2 * (((2 * v184 - 1154277922) ^ 0xBB331DDE) & 0x75C2B07C ^ (2 * v184 - 1154277922) & 0x20);
  v186 = *(a47 + 4 * (BYTE2(v179) ^ 0x49u)) ^ *(a49 + 4 * (HIBYTE(v177) ^ 0x99)) ^ *(a53 + 4 * (BYTE1(v180) ^ 0x55u)) ^ *(a19 + 4 * (v176 ^ 0x30u));
  v187 = *(a47 + 4 * (BYTE2(v176) ^ 0x2Cu));
  v188 = (v183 ^ 0x5A7F2FFD) + ((2 * v183) & 0xB4FE5FFA) - 1518284796 + (v185 ^ 0x8A3D4FA2);
  v189 = *(a53 + 4 * (BYTE1(v176) ^ 0x19u)) ^ *(a49 + 4 * (HIBYTE(v179) ^ 0x97));
  v190 = *(a53 + 4 * (BYTE1(v177) ^ 0x33u));
  v191 = v188 - ((2 * v188) & 0x1A4B21FA) - 1926917891;
  v192 = v189 ^ *(a47 + 4 * (BYTE2(v180) ^ 0xFEu)) ^ *(a19 + 4 * (v177 ^ 0x57u));
  v193 = v190 ^ v187 ^ *(a49 + 4 * (HIBYTE(v180) ^ 0x9B)) ^ *(a19 + 4 * (v179 ^ 0x10u));
  v194 = ((((v192 ^ 0xC0EA0B49) >> (v169 & 8)) - 134090637 - ((2 * ((v192 ^ 0xC0EA0B49) >> (v169 & 8))) & 0xF003E0E6)) ^ 0xF801F073) >> (v169 & 8 ^ 8);
  v195 = *(a53 + 4 * (BYTE1(v191) ^ 0x16u));
  v196 = *(a53 + 4 * ((v194 - ((2 * v194) & 0x34) - 102) ^ 0x9Au)) ^ *(a47 + 4 * (BYTE2(v186) ^ 0x53u)) ^ *(a19 + 4 * (v193 ^ 0xA2u)) ^ *(a49 + 4 * (HIBYTE(v191) ^ 0xC3));
  v197 = *(a19 + 4 * ((v188 - ((2 * v188) & 0xFA) - 3) ^ 0xA9u));
  v198 = *(a53 + 4 * (BYTE1(v193) ^ 0xEAu)) ^ *(a49 + 4 * (HIBYTE(v186) ^ 0xD7)) ^ *(a47 + 4 * (BYTE2(v192) ^ 0xEAu));
  v199 = *(a47 + 4 * (BYTE2(v191) ^ 0x98u));
  v200 = __PAIR64__(v198 ^ 0xF0B45A ^ v197, v198 ^ ~v197) >> 31;
  HIDWORD(v94) = ~v200;
  LODWORD(v94) = (v200 - ((2 * v200) & 0x14C6BBD8) + 174284268) ^ 0x17C2C136;
  v201 = (v94 >> 1) - ((2 * (v94 >> 1)) & 0x1F08956) + 16270507;
  v202 = *(a49 + 4 * (HIBYTE(v192) ^ 0xC0)) ^ *(a47 + 4 * (BYTE2(v193) ^ 0xE4u)) ^ *(a19 + 4 * (v186 ^ 3u)) ^ v195;
  HIDWORD(v94) = v202 ^ 0x45A;
  LODWORD(v94) = v202 ^ 0x80F0B000;
  v203 = (v94 >> 12) - ((2 * (v94 >> 12)) & 0xCE23070C) + 1729201030;
  v204 = *(a49 + 4 * (HIBYTE(v193) ^ 0xDB)) ^ *(a53 + 4 * (BYTE1(v186) ^ 0xB5u)) ^ *(a19 + 4 * (v192 ^ 0x49u)) ^ v199;
  HIDWORD(v94) = v203 ^ 0xE3BB5;
  LODWORD(v94) = v203 ^ 0xF2C00000;
  v205 = (v94 >> 20) + 1293493467 + (~(2 * (v94 >> 20)) | 0x65CDB64B);
  v206 = *(a47 + 4 * (BYTE2(v201) ^ 0xEEu)) ^ *(a49 + 4 * (HIBYTE(v196) ^ 0x42)) ^ *(a53 + 4 * (BYTE1(v205) ^ 0xA2u)) ^ *(a19 + 4 * (v204 ^ 0x8Du));
  v207 = *(a47 + 4 * (BYTE2(v205) ^ 0x46u)) ^ *(a49 + 4 * (HIBYTE(v201) ^ 0x1B)) ^ *(a53 + 4 * (BYTE1(v204) ^ 0x55u)) ^ *(a19 + 4 * (v196 ^ 0x3Fu));
  v208 = *(a19 + 4 * (v201 ^ 0xFAu)) ^ *(a53 + 4 * (BYTE1(v196) ^ 0xB5u)) ^ *(a47 + 4 * (BYTE2(v204) ^ 0x38u)) ^ *(a49 + 4 * (HIBYTE(v205) ^ 0x63));
  v209 = *(a49 + 4 * (HIBYTE(v204) ^ 0xE)) ^ *(a47 + 4 * (BYTE2(v196) ^ 0x95u)) ^ *(a53 + 4 * (BYTE1(v201) ^ 0x8Au)) ^ *(a19 + 4 * (((v94 >> 20) - 37 + (~(2 * (v94 >> 20)) | 0x4B)) ^ 0xA8u));
  v210 = *(a49 + 4 * (HIBYTE(v206) ^ 0xCC));
  v211 = ((((v209 ^ 0x226F4D3) >> (v210 & 8 ^ 8)) - 1547570049 - ((2 * ((v209 ^ 0x226F4D3) >> (v210 & 8 ^ 8))) & 0x4783E8FE)) ^ 0xA3C1F47F) >> (v210 & 8);
  v212 = *(a49 + 4 * (HIBYTE(v207) ^ 0x59)) ^ *(a47 + 4 * (BYTE2(v208) ^ 0xEEu)) ^ *(a19 + 4 * (v206 ^ 0x17u)) ^ *(a53 + 4 * ((v211 - ((2 * v211) & 0x36) - 101) ^ 0x9Bu));
  v213 = *(a49 + 4 * (HIBYTE(v209) ^ 2));
  v214 = *(a47 + 4 * (BYTE2(v207) ^ 0x32u)) ^ v210 ^ *(a53 + 4 * (BYTE1(v208) ^ 0x15u)) ^ *(a19 + 4 * (v209 ^ 0xD3u));
  v215 = *(a47 + 4 * (BYTE2(v206) ^ 0xF4u));
  v216 = v215 ^ 0xB159A015;
  v217 = v213 ^ ((v213 ^ 0x4CC44355) - ((2 * (v213 ^ 0x4CC44355) + 2) & 0xF866F20A) + 2083748102) ^ ((v215 ^ 0xB159A015) - (v213 ^ 0x2621CBF ^ v215) - ((2 * ((v215 ^ 0xB159A015) - (v213 ^ 0x2621CBF ^ v215))) & 0xC7B54B3C) - 472210018);
  v218 = (v217 ^ 0x2CD26031) + v216 - ((2 * ((v217 ^ 0x2CD26031) + v216)) & 0x5B1477BA) - 1383449635;
  v219 = *(a19 + 4 * (v208 ^ 4u));
  v220 = *(a19 + 4 * (v207 ^ 0x2Bu)) ^ *(a47 + 4 * (BYTE2(v209) ^ 0x26u)) ^ *(a53 + 4 * (BYTE1(v206) ^ 0xAAu)) ^ *(a49 + 4 * (HIBYTE(v208) ^ 0x8C));
  v221 = v219 ^ *(a53 + 4 * (BYTE1(v207) ^ 0xAAu)) ^ v218;
  v222 = *(a49 + 4 * (HIBYTE(v214) ^ 0xFD)) ^ *(a19 + 4 * ((v219 ^ *(a53 + 4 * (BYTE1(v207) ^ 0xAAu)) ^ v218) ^ 0xFu)) ^ *(a53 + 4 * (BYTE1(v220) ^ 0x33u)) ^ *(a47 + 4 * (BYTE2(v212) ^ 0x12u));
  v223 = *(a47 + 4 * (BYTE2(v214) ^ 0xD0u)) ^ *(a49 + 4 * (HIBYTE(v221) ^ 5));
  v224 = *(a53 + 4 * (BYTE1(v212) ^ 0x92u));
  v225 = *(a47 + 4 * (BYTE2(v220) ^ 0xCu)) ^ *(a19 + 4 * (v214 ^ 0xCBu)) ^ *(a53 + 4 * (BYTE1(v221) ^ 0x54u)) ^ *(a49 + 4 * (HIBYTE(v212) ^ 0x24));
  v226 = 2 * (((v224 ^ 0xC195F7CF) & (v223 ^ 0x2621CBF)) + (~(2 * ((v224 ^ 0xC195F7CF) & (v223 ^ 0x2621CBF))) | 0x3054C0FD)) - 810860796;
  v227 = (((v226 ^ 0xCFAB3F02) + 332661601 - ((2 * (v226 ^ 0xCFAB3F02)) & 0x27A806C0)) ^ 0x13D40361) + (v223 ^ 0xC3F7EB70 ^ v224);
  v228 = (((v226 ^ 0xCFAB3F02) + 1074332340 - 2 * ((v226 ^ 0xCFAB3F02) & 0x400902BC ^ v226 & 8)) ^ 0xBFF6FD4B) + (v227 ^ 0xFD7FFFAE) + ((2 * v227) & 0xFAFFFF5C) + 41943123;
  v229 = *(a49 + 4 * (HIBYTE(v220) ^ 0x28)) ^ *(a53 + 4 * (BYTE1(v214) ^ 0x8Cu)) ^ *(a47 + 4 * (BYTE2(v221) ^ 0x32u)) ^ *(a19 + 4 * (v212 ^ 0xBAu));
  v230 = (v228 - ((2 * v228) & 0x1AE93450) - 1921738200) ^ *(a19 + 4 * (v220 ^ 0xE4u));
  v231 = *(a47 + 4 * (BYTE2(v222) ^ 0x7Eu));
  v232 = *(a53 + 4 * (BYTE1(v229) ^ 0x5Eu)) ^ *(a49 + 4 * (HIBYTE(v222) ^ 0xC2)) ^ *(a47 + 4 * (BYTE2(v225) ^ 0x9Cu));
  v233 = *(a53 + 4 * ~(v222 >> 8));
  v234 = HIBYTE(v230) ^ 0xAA;
  v235 = *(a49 + 4 * (HIBYTE(v225) ^ 0x66)) ^ *(a47 + 4 * (BYTE2(v229) ^ 0x60u)) ^ *(a19 + 4 * (v222 ^ 0xA5u)) ^ *(a53 + 4 * (BYTE1(v230) ^ 0xE8u));
  v236 = *(a19 + 4 * (v230 ^ 0x94u));
  v237 = *(a49 + 4 * (HIBYTE(v229) ^ 0xCE)) ^ *(a47 + 4 * (BYTE2(v230) ^ 0xC9u));
  v238 = *(a19 + 4 * (v225 ^ 0x45u)) ^ v233;
  v239 = *(a53 + 4 * (BYTE1(v225) ^ 0xD9u)) ^ v231 ^ *(a19 + 4 * (v229 ^ 0xFBu));
  v240 = v238 ^ v237;
  v241 = v239 ^ *(a49 + 4 * v234);
  v242 = *(a53 + 4 * (((v238 ^ v237) >> 8) ^ 0x3Du));
  v243 = *(a19 + 4 * (v241 ^ 0xFAu));
  v244 = v242 ^ *(a47 + 4 * (BYTE2(v235) ^ 0xE7u));
  v245 = v244 ^ *(a49 + 4 * (((v236 ^ v232) >> 24) ^ 0x3A)) ^ 0xC3F7EB70;
  v246 = (v243 ^ 0x43075F2A) + v245;
  v247 = (2 * (((v243 ^ 0x43075F2A) & v245) + ~((2 * ((v243 ^ 0x43075F2A) & v245)) & 0x67401A3E)) + 1732254272) ^ 0x67401A3E;
  v248 = (v246 ^ 0x3E3AFF6A) - 1044053865 + ((2 * v246) & 0x7C75FED4) + ((v247 - ((2 * v247) & 0xB35E35FC) - 642835713) ^ 0x2650E500);
  v249 = *(a47 + 4 * (BYTE2(v240) ^ 0x77u)) ^ *(a49 + 4 * (HIBYTE(v235) ^ 0xDC)) ^ *(a53 + 4 * (BYTE1(v241) ^ 0x10u));
  v250 = *(a47 + 4 * (BYTE2(v241) ^ 0xCDu)) ^ *(a49 + 4 * (HIBYTE(v240) ^ 0x92));
  v251 = *(a19 + 4 * (v240 ^ 0x6Cu)) ^ *(a53 + 4 * (BYTE1(v235) ^ 0xD7u)) ^ *(a49 + 4 * (HIBYTE(v241) ^ 0xF6));
  v252 = v251 ^ *(a47 + 4 * (((v236 ^ v232) >> 16) ^ 0x8Bu));
  v253 = ((v252 & 0xB9239E9B ^ 0x4FFC6566) & (v252 & 0x46DC6164 ^ 0xFD6BBEFF)) + 2013407140 - 2 * ((v252 & 0xB9239E9B ^ 0x4FFC6566) & (v252 & 0x46DC6164 ^ 0xFD6BBEFF) & 0x780227B6 ^ (v252 & 0xB9239E9B ^ 0x4FFC6566) & 0x12);
  v254 = *(a19 + 4 * (v235 ^ 0xCDu));
  v255 = v250 ^ v254 ^ *(a53 + 4 * (((v236 ^ v232) >> 8) ^ 0xBAu));
  v256 = *(a19 + 4 * ((v236 ^ v232) ^ 0xD2u)) ^ v249;
  v257 = v248 - ((2 * v248) & 0xF179DF4E) - 121835609;
  v258 = *(a49 + 4 * (HIBYTE(v257) ^ 0xD)) ^ *(a53 + 4 * (BYTE1(v255) ^ 0x80u)) ^ *(a47 + 4 * (BYTE2(v256) ^ 0xD2u)) ^ *(a19 + 4 * (v253 ^ 0xA4u));
  HIDWORD(v94) = v258 ^ 0x30B45A;
  LODWORD(v94) = v258 ^ 0x80FFFFFF;
  v259 = (v94 >> 22) - ((2 * (v94 >> 22)) & 0x5F8FEB8E) - 1345849913;
  HIDWORD(v94) = v259 ^ 0x2F4;
  LODWORD(v94) = v259 ^ 0x112AD800;
  v260 = (v94 >> 10) - ((2 * (v94 >> 10)) & 0xE00CBCC2);
  v262 = *(a53 + 4 * (BYTE1(v256) ^ 9u)) ^ *(a49 + 4 * (HIBYTE(v253) ^ 0x78)) ^ *(a47 + 4 * (BYTE2(v257) ^ 0x89u));
  v263 = (v236 & 0x40 ^ 0x3FA54EFF) + 2 * (v236 & 0x40);
  v264 = *(a19 + 4 * ((v250 ^ v254 ^ *(a53 + 4 * (((v236 ^ v232) >> 8) ^ 0xBAu))) ^ 0xC6u));
  v265 = v264 & 0x425AB118;
  v266 = v262 ^ v264;
  v265 ^= 0x42021108u;
  v267 = (v262 & 0x425AB118 ^ 0x4252A110) + v265;
  v268 = (2 * ((v265 & (v262 ^ 0x4252A110)) - ((2 * (v265 & (v262 ^ 0x4252A110))) & 0x244220)) - 651768022) ^ 0xD926CF2A;
  v269 = (v267 ^ 0xBECFFFDE) + ((2 * v267) & 0xD9FE630) + 1093664803 + ((v268 - ((2 * v268) & 0x8A59FB6C) + 1160576439) ^ 0xBAD30248);
  v270 = v269 + 532198942 + (~(2 * v269) | 0xC08E93C5);
  v271 = v263 - 33621569;
  if (((v263 - 1067798271) & (v232 ^ 0xC3F7EB40)) + 1890901062 - ((2 * ((v263 - 1067798271) & (v232 ^ 0xC3F7EB40))) & 0xE169B800) != 1890901062)
  {
    v271 = 2101974973 - v263;
  }

  v272 = ((v232 ^ 0xC3F7EB70) - 1034176702 + v271 - ((2 * ((v232 ^ 0xC3F7EB70) - 1034176702 + v271)) & 0x11877474) + 147044922) ^ v236 & 0xFFFFFFBF;
  v273 = ((((v272 ^ 0xF1BFEB98) >> (v237 & 8 ^ 8)) + 26182870 - ((2 * ((v272 ^ 0xF1BFEB98) >> (v237 & 8 ^ 8))) & 0x31F09AC)) ^ 0x18F84D6) >> (v237 & 8);
  v274 = *(a19 + 4 * (v272 ^ 0x98u)) ^ v249;
  v275 = (2 * (v250 & 0x400)) ^ 0x800 | v250 & 0x400;
  v276 = v244 ^ v243 ^ *(a49 + 4 * (HIBYTE(v272) ^ 0xF1));
  v277 = *(a53 + 4 * ((v273 - ((2 * v273) & 0x80) - 64) ^ 0xC0u)) ^ 0xC195F7CF;
  v278 = ((v275 - 1024) & v277) + 294972454 - ((2 * ((v275 - 1024) & v277)) & 0x2329D810) == 294972454;
  v279 = v275 + 748492880;
  v280 = 748494928 - v275;
  if (!v278)
  {
    v279 = v280;
  }

  v281 = v251 ^ *(a47 + 4 * (BYTE2(v272) ^ 0xBFu));
  v282 = v250 & 0xFFFFFBFF ^ v254 ^ (v277 - 748493904 + v279 - ((2 * (v277 - 748493904 + v279)) & 0xE1CE1088) - 253294524);
  v283 = *(a47 + 4 * (BYTE2(v274) ^ 0xD2u)) ^ *(a19 + 4 * (v281 ^ 0x66u)) ^ *(a49 + 4 * (HIBYTE(v276) ^ 0x75)) ^ *(a53 + 4 * (BYTE1(v282) ^ 0x7Bu));
  v284 = *(a47 + 4 * (BYTE2(v281) ^ 0x68u)) ^ *(a53 + 4 * (BYTE1(v276) ^ 0x6Au));
  v285 = *(a47 + 4 * (BYTE2(v276) ^ 0xC5u)) ^ *(a49 + 4 * (HIBYTE(v281) ^ 0x4D));
  v286 = *(a47 + 4 * (BYTE2(v282) ^ 0x27u)) ^ *(a53 + 4 * (BYTE1(v281) ^ 0x24u)) ^ *(a49 + 4 * (HIBYTE(v274) ^ 0x29)) ^ *(a19 + 4 * (v276 ^ 0x67u));
  v287 = *(a49 + 4 * (HIBYTE(v282) ^ 0xA)) ^ v284 ^ *(a19 + 4 * ((*(a19 + 4 * (v272 ^ 0x98u)) ^ v249) ^ 0xF0u));
  v288 = v285 ^ *(a53 + 4 * (BYTE1(v274) ^ 9u));
  v289 = ((2 * v283) & 0x536FFEBA ^ 0x13619000) + (v283 ^ 0x240737FF);
  v290 = ((2 * v286) & 0xE7FFDBFC ^ 0x4124CA10) + (v286 ^ 0xD76D98F6);
  v291 = v288 ^ *(a19 + 4 * (v282 ^ 0x4Du));
  v292 = ((2 * (((v260 - 268018079) ^ 0x31A999D2) - 54983864)) & 0x83FEBBE8) + ((((v260 - 268018079) ^ 0x31A999D2) - 54983864) ^ 0x41FF5DF4) - v289;
  v261 = *(a47 + 4 * (BYTE2(v255) ^ 0x55u)) ^ *(a49 + 4 * (HIBYTE(v256) ^ 0x29)) ^ *(a53 + 4 * (BYTE1(v253) ^ 0x27u)) ^ *(a19 + 4 * (v257 ^ 0x9Au));
  v293 = (v261 & 0xFFFFFFEF ^ 0x180470F2 ^ ((v261 & 0x10 ^ 0x3C960612) - 24)) - 651653269;
  v294 = ((2 * v293) & 0xF5D6FFFE) + (v293 ^ 0x7AEB7FFF) - v290;
  v295 = v294 - ((2 * v294 - 232203266) & 0xDF50817C);
  v296 = ((2 * v291) & 0x7DF7BBE6 ^ 0x2557A340) + (v291 ^ 0xEC540C5B);
  v297 = ((2 * ((v266 & 0xBDA54EE7 ^ 0x4D47D7AD ^ v270) - 123154961)) & 0xFBF8EF4A) + (((v266 & 0xBDA54EE7 ^ 0x4D47D7AD ^ v270) - 123154961) ^ 0xFDFC77A5) - v296;
  v298 = ((2049466841 * ((v295 + 1757195965) ^ 0x9A7D37E4)) ^ 0xE99F6FF7) + ((-196033614 * ((v295 + 1757195965) ^ 0x9A7D37E4)) & 0xD33EDFEE);
  v299 = v297 - ((2 * v297 - 2114007908) & 0xD6FC1056) - 1401065863;
  v300 = (*(a19 + 4 * (v256 ^ 0xF0u)) ^ *(a47 + 4 * (BYTE2(v253) ^ 2u)) ^ *(a49 + 4 * (HIBYTE(v255) ^ 0x3B)) ^ 0x9F374194 ^ *(a53 + 4 * (BYTE1(v257) ^ 0x31u))) - 601152054;
  v301 = (v292 - ((2 * v292 + 1332822738) & 0x40273FC8) - 2016657075) ^ 0xE753055;
  v302 = ((2 * v287) & 0x7BEF5FEE ^ 0x3A6E0328) + (v287 ^ 0xA2C0EE63);
  v303 = ((2 * v300) & 0xDDB55EBC) + (v300 ^ 0x6EDAAF5E) - v302;
  v304 = ((1274095089 * v301) ^ 0xEBEDFF5F) + ((-1746777118 * v301) & 0xD7DBFEBE) + v298;
  v305 = (v303 - ((2 * v303 - 1640365774) & 0x81E3E420) + 269415081) ^ 0x92178B1A;
  v306 = 1932989815 * v305 - ((1718495982 * v305) & 0x46CBDF52) - 1553600599;
  v307 = ((2 * (v306 ^ (v298 + 375427081))) & 0xE153BA6E ^ 0x40439A42) + (v306 ^ (v298 + 375427081) ^ 0x53CC329E);
  v308 = v299 & 0xFFFFDFFF ^ 0xD57EF4A0 ^ (1895835661 - (~(2 * (v299 & 0x2000)) & 0x64005104 | v299 & 0x2000));
  v309 = 1308476001 * v308 - 940125343 - ((-1678015294 * v308) & 0x8FEDA6C2);
  v310 = v309 ^ v306;
  v311 = (v309 ^ (v304 + 712151210) ^ 0xC7F6D361) + 304385129 - 2 * ((v309 ^ (v304 + 712151210) ^ 0xC7F6D361) & 0x12248C6F ^ (v309 ^ (v304 + 712151210)) & 6);
  v312 = (v310 ^ 0x9B6CC337) + v304 - ((2 * ((v310 ^ 0x9B6CC337) + v304) + 350560598) & 0x2390432A) + 1010479680;
  v313 = v307 + 257303241;
  v314 = ((2 * ((v311 ^ 0x12248C69) + v307 + 257303241)) & 0xDEA7EFAE) + (((v311 ^ 0x12248C69) + v307 + 257303241) ^ 0xEF53F7D7);
  v315 = v312 ^ (-159475862 - v307 - ((22264430 - 2 * v307) & 0xBA97466));
  v316 = ((2 * v315) & 0xAEF3FF56 ^ 0x28313744) + (v315 ^ 0x4365640D);
  v317 = v314 - v316;
  v318 = (v310 ^ 0x755B1D5D ^ v312) - (v314 - v316) - 1747322836;
  v319 = ((2 * v318) & 0xF9D34F7E) + (v318 ^ 0x7CE9A7BF);
  v320 = v289 - v316 - 2 * ((v289 - v316 + 1092174368) & 0x583547FC ^ (v289 - v316) & 4) + 424577560;
  v321 = v302 - v319 - ((2 * (v302 - v319) + 277415412) & 0x2DEEDC04) + 1060892924;
  v322 = v290 - v317 - ((2 * (v290 - v317) + 687360456) & 0x36595CE0) - 1347890348;
  v323 = ((2 * v319 - ((4 * v319 + 207184132) & 0x58605A08) - 1302536825) ^ 0xAC302D05) + v313;
  v324 = v296 - v319 + (v323 ^ 0xF5AD5B7F) + ((2 * v323) & 0xEB5AB6FE);
  v325 = v324 - ((2 * v324 - 1937021276) & 0xF1C31918) - 1087946786;
  v326 = *(a24 + 4 * (HIBYTE(v325) ^ 0x78));
  v327 = (v326 & 0x400000 | ((((v326 & 0x400000u) >> 22) & 1) << 23) | 0xBF3DE37F) ^ 0x800000;
  v328 = *(a52 + 4 * (((v324 - ((2 * v324 + 26276) & 0x1918) + 16350) >> 8) ^ 0x8Cu)) ^ *(a24 + 4 * (HIBYTE(v322) ^ 0x1B)) ^ *(a22 + 4 * (BYTE2(v321) ^ 0xF7u)) ^ *(a55 + 4 * (v320 ^ 0xF8u));
  v329 = (v328 ^ 0xF9C9D622) + 2008156231 - 2 * ((v328 ^ 0xF9C9D622) & 0x77B20857 ^ v328 & 0x10);
  v330 = *(a22 + 4 * (BYTE2(v320) ^ 0x35u));
  v278 = ((v330 ^ 0x11800000) & (v327 + 1082268801)) + 1227073751 - ((2 * ((v330 ^ 0x11800000) & (v327 + 1082268801))) & 0x92041100) == 1227073751;
  v331 = v327 + 1811832283;
  v332 = -352705319 - v327;
  if (v278)
  {
    v332 = v331;
  }

  v333 = (v330 ^ 0x11BD6904) - 729563482 + v332 - ((2 * ((v330 ^ 0x11BD6904) - 729563482 + v332)) & 0x24C316B8);
  v334 = a17 ^ *(a24 + 4 * (HIBYTE(v320) ^ 0xD8)) ^ *(a22 + 4 * (BYTE2(v322) ^ 0x2Cu)) ^ *(a52 + 4 * (BYTE1(v321) ^ 0x6Eu)) ^ *(a55 + 4 * (v325 ^ 0x8Cu));
  v335 = *(a22 + 4 * (BYTE2(v325) ^ 0xE1u));
  v336 = a17 ^ *(a52 + 4 * (BYTE1(v322) ^ 0xAEu)) ^ *(a55 + 4 * (v321 ^ 2u)) ^ v326 & 0xFFBFFFFF;
  v337 = HIDWORD(a36) ^ HIDWORD(a37) ^ a26 ^ *(a24 + 4 * (HIBYTE(v321) ^ 0x96)) ^ *(a55 + 4 * (v322 ^ 0x70u)) ^ *(a52 + 4 * (BYTE1(v320) ^ 0x47u)) ^ v335;
  HIDWORD(v338) = v337 ^ 3;
  LODWORD(v338) = v337 ^ 0x8D9B6BB0;
  v339 = (v338 >> 3) - ((2 * (v338 >> 3)) & 0xD471D54E) - 365368665;
  HIDWORD(v338) = v339 ^ 0x17C47B27;
  LODWORD(v338) = v339 ^ 0x60000000;
  v340 = (v338 >> 29) - ((2 * (v338 >> 29)) & 0x459A1E96) - 1563619509;
  LOBYTE(v339) = ((v338 >> 29) - ((2 * (v338 >> 29)) & 0x96) + 75) & 8;
  v341 = ((((a17 ^ v329 ^ 0xB9082A1E) >> (v339 ^ 8)) - 1158375056 - ((2 * ((a17 ^ v329 ^ 0xB9082A1E) >> (v339 ^ 8))) & 0x75E932E0)) ^ 0xBAF49970) >> v339;
  v342 = byte_1003A70D0[(v341 - ((2 * v341) & 8) + 4) ^ 0x70];
  *(a41 + v355) = v342 ^ 0xF2 ^ (v342 >> 2) & 0x1B;
  *(a41 + v356) = byte_1003A70D0[BYTE1(v334) ^ 0xC8] ^ 0x31 ^ (byte_1003A70D0[BYTE1(v334) ^ 0xC8] >> 2) & 0x1B;
  v343 = byte_10038A2E0[BYTE2(v334) ^ 0x19];
  *(a41 + v352) = v343 ^ (v343 >> 4) ^ (v343 >> 1) ^ 0x3C;
  v344 = byte_10038A2E0[BYTE2(v340) ^ 0x15];
  v345 = (v344 >> 3) ^ 0x16;
  v346 = 2 * ((v345 & (v344 ^ 0xB5)) - ((2 * (v345 & (v344 ^ 0xB5))) & 0x34));
  LOBYTE(v345) = ((v345 + (v344 ^ 0xB5)) ^ 0xAA) + ((2 * (v345 + (v344 ^ 0xB5))) & 0x54) + ((((v346 + 52) ^ 0x34) - ((2 * (v346 + 52)) & 0x94) + 74) ^ 0xB5) + 87;
  *(a41 + a29) = v344 ^ (((v345 - ((2 * v345) & 0x64) - 78) & 0xFE) >> 1) ^ 0xE1;
  v347 = v336 ^ (v333 + 308382556);
  LOBYTE(v345) = byte_1003ADB60[HIBYTE(v347) ^ 0xBELL];
  LOBYTE(v345) = v345 - 2 * ((v345 + 6) & 7 ^ v345 & 1) + 28;
  *(a41 + HIDWORD(a26)) = v345 ^ 0xD1 ^ (((8 * v345) ^ 0x30) - ((2 * ((8 * v345) ^ 0x30)) & 0x20) - 112);
  *(a41 + a32) = byte_10038CF20[v334 ^ 0x98] ^ 0x1A;
  LOBYTE(v345) = byte_1003ADB60[HIBYTE(v334) ^ 0xCLL];
  LOBYTE(v345) = v345 - ((2 * v345 + 44) & 0x50) - 66;
  *(a41 + v357) = v345 ^ 0x85 ^ (((8 * v345) ^ 0x40) - ((2 * ((8 * v345) ^ 0x40)) & 0xE0) - 16);
  *(a41 + a35) = byte_10038CF20[(v336 ^ (v333 + 92)) ^ 0xE1] ^ 0x9D;
  LOBYTE(v345) = byte_1003ADB60[HIBYTE(v340) ^ 0x66];
  LOBYTE(v333) = v345 - ((2 * v345 + 44) & 0x34) - 80;
  *(a41 + (a43 ^ 0xCB60F689)) = v333 ^ 0x3D ^ (((8 * v333) ^ 0xD0) - 16 * (v345 & 1) - 118);
  LOBYTE(v345) = byte_1003A70D0[BYTE1(v340) ^ 0x7FLL];
  LOBYTE(v333) = (((v345 ^ 0xD7) + 13) ^ 0x7B) + ((2 * ((v345 ^ 0xD7) + 13)) & 0xF7) + ((((2 * v345) ^ 0xAE) - ((2 * ((2 * v345) ^ 0xAE)) & 0x10) + 25) & 0x1A ^ 0xE7) - 122;
  *(a41 + HIDWORD(v355)) = (v345 >> 2) & 0x1B ^ (v333 - ((2 * v333) & 0xC3) - 31) ^ 0xF0;
  LOBYTE(v345) = byte_10038CF20[((v338 >> 29) - ((2 * (v338 >> 29)) & 0x96) + 75) ^ 0x61];
  LOBYTE(v333) = (v345 & 0x13 ^ 0xEE) - ((2 * (v345 & 0x13 ^ 0xEE)) & 0xB4) - 38;
  *(a41 + a37) = v333 & 0x59 ^ 0x58 ^ (((v345 & 0xEC ^ 0xD3) - ((2 * (v345 & 0xEC ^ 0xD3)) & 0x6E) - 73) ^ 0xEE) & (v333 ^ 0xDA);
  *(a41 + HIDWORD(v353)) = byte_1003A70D0[BYTE1(v347) ^ 0xCDLL] ^ 0x39 ^ (byte_1003A70D0[BYTE1(v347) ^ 0xCDLL] >> 2) & 0x1B;
  *(a41 + HIDWORD(v352)) = byte_10038CF20[(a17 ^ v329) ^ 0x1CLL] ^ 0xCF;
  LOBYTE(v345) = byte_1003ADB60[((a17 ^ v329) >> 24) ^ 0xD3];
  LOBYTE(v345) = (v345 ^ 0x80) - ((2 * v345 + 44) & 0xD4);
  *(a41 + HIDWORD(v356)) = v345 ^ 0xD7 ^ (((8 * v345) ^ 0x50) - ((16 * v345) & 0x55) - 82);
  v348 = byte_10038A2E0[((a17 ^ v329) >> 16) ^ 0x42];
  LOBYTE(v333) = (((v348 ^ 0xB5) + 98) ^ 0x37) + ((2 * ((v348 ^ 0xB5) + 98)) & 0x6E) + ((((2 * v348) ^ 0x6A) - ((2 * ((2 * v348) ^ 0x6A)) & 0x48) + 36) & 0xC4 ^ 0xFB) - 54;
  *(a41 + v353) = (v348 >> 4) ^ (v348 >> 1) ^ 0x86 ^ (v333 - ((2 * v333) & 0xAE) - 41);
  v349 = byte_10038A2E0[BYTE2(v347) ^ 0x45];
  LOBYTE(v349) = (((v349 >> 4) ^ (v349 >> 1)) & 3 ^ v349 & 0x83 | ((v349 >> 4) ^ (v349 >> 1) ^ v349) & 0x7C) ^ 0xE;
  *(a41 + HIDWORD(v354)) = (v349 - ((2 * v349) & 0x5A) - 83) ^ 0xD1;
  HIDWORD(a23) = a51 - 179;
  return (*(&off_1003E7570 + ((704 * (((v357 - 882837887 - ((2 * v357 + 32) & 0x96C1ED02) + 16) ^ 0xCB60F681) < HIDWORD(a29))) ^ a51)))(byte_1003ADB60, 52, byte_10038A2E0, byte_10038CF20, 80, &off_1003E7570, a53, a52, a9, a10, a11, a12, a13, a14, a15, a16, a17, a18, a19, a20, a21, a22, a23, a24, v351, a26, v352, v353, a29, a30, a31, a32, v354, v355, a35, a36, a37, a38, a39, a40, a41, v356, a43, a44, a45);
}

char *sub_1002E07B8(char *result, char *a2, unint64_t a3)
{
  if (((a2 ^ result) & 7) == 0)
  {
    v5 = -result & 7;
    if ((-result & 7u) <= 3)
    {
      if ((-result & 7u) <= 1)
      {
        if (!v5)
        {
LABEL_27:
          v13 = a3 >= v5;
          v14 = a3 - v5;
          if (!v13)
          {
            v14 = 0;
          }

          if (v14 >= 8)
          {
            v15 = ((v14 >> 3) + 7) >> 3;
            v16 = (v14 >> 3) & 7;
            if (v16 > 3)
            {
              if (((v14 >> 3) & 7) <= 5)
              {
                if (v16 == 4)
                {
                  goto LABEL_58;
                }

                goto LABEL_57;
              }

              if (v16 == 6)
              {
                goto LABEL_56;
              }

              goto LABEL_55;
            }

            if (((v14 >> 3) & 7) > 1)
            {
              if (v16 == 2)
              {
                goto LABEL_60;
              }

              goto LABEL_59;
            }

            if (!v16)
            {
              goto LABEL_54;
            }

            while (1)
            {
              v32 = *result;
              result += 8;
              *a2 = v32;
              a2 += 8;
              if (!--v15)
              {
                break;
              }

LABEL_54:
              v25 = *result;
              result += 8;
              *a2 = v25;
              a2 += 8;
LABEL_55:
              v26 = *result;
              result += 8;
              *a2 = v26;
              a2 += 8;
LABEL_56:
              v27 = *result;
              result += 8;
              *a2 = v27;
              a2 += 8;
LABEL_57:
              v28 = *result;
              result += 8;
              *a2 = v28;
              a2 += 8;
LABEL_58:
              v29 = *result;
              result += 8;
              *a2 = v29;
              a2 += 8;
LABEL_59:
              v30 = *result;
              result += 8;
              *a2 = v30;
              a2 += 8;
LABEL_60:
              v31 = *result;
              result += 8;
              *a2 = v31;
              a2 += 8;
            }
          }

          v33 = v14 & 7;
          if (v33 <= 3)
          {
            if (v33 <= 1)
            {
              if (!v33)
              {
                return result;
              }

LABEL_78:
              *a2 = *result;
              return result;
            }

            if (v33 == 2)
            {
LABEL_77:
              v39 = *result++;
              *a2++ = v39;
              goto LABEL_78;
            }

LABEL_76:
            v38 = *result++;
            *a2++ = v38;
            goto LABEL_77;
          }

          if (v33 > 5)
          {
            if (v33 != 6)
            {
              v34 = *result++;
              *a2++ = v34;
            }

            v35 = *result++;
            *a2++ = v35;
          }

          else if (v33 == 4)
          {
            goto LABEL_75;
          }

          v36 = *result++;
          *a2++ = v36;
LABEL_75:
          v37 = *result++;
          *a2++ = v37;
          goto LABEL_76;
        }

LABEL_26:
        v12 = *result++;
        *a2++ = v12;
        goto LABEL_27;
      }

      if (v5 == 2)
      {
LABEL_25:
        v11 = *result++;
        *a2++ = v11;
        goto LABEL_26;
      }

LABEL_24:
      v10 = *result++;
      *a2++ = v10;
      goto LABEL_25;
    }

    if ((-result & 7u) > 5)
    {
      if (v5 != 6)
      {
        v6 = *result++;
        *a2++ = v6;
      }

      v7 = *result++;
      *a2++ = v7;
    }

    else if (v5 == 4)
    {
      goto LABEL_23;
    }

    v8 = *result++;
    *a2++ = v8;
LABEL_23:
    v9 = *result++;
    *a2++ = v9;
    goto LABEL_24;
  }

  if ((a3 + 7) >= 8)
  {
    v3 = (a3 + 7) >> 3;
    v4 = a3 & 7;
    if (v4 > 3)
    {
      if ((a3 & 7) <= 5)
      {
        if (v4 == 4)
        {
          goto LABEL_49;
        }

        goto LABEL_48;
      }

      if (v4 == 6)
      {
        goto LABEL_47;
      }

      goto LABEL_46;
    }

    if ((a3 & 7) > 1)
    {
      if (v4 == 2)
      {
        goto LABEL_51;
      }

      goto LABEL_50;
    }

    if ((a3 & 7) == 0)
    {
      goto LABEL_45;
    }

    while (1)
    {
      v24 = *result++;
      *a2++ = v24;
      if (!--v3)
      {
        break;
      }

LABEL_45:
      v17 = *result++;
      *a2++ = v17;
LABEL_46:
      v18 = *result++;
      *a2++ = v18;
LABEL_47:
      v19 = *result++;
      *a2++ = v19;
LABEL_48:
      v20 = *result++;
      *a2++ = v20;
LABEL_49:
      v21 = *result++;
      *a2++ = v21;
LABEL_50:
      v22 = *result++;
      *a2++ = v22;
LABEL_51:
      v23 = *result++;
      *a2++ = v23;
    }
  }

  return result;
}

_BYTE *sub_1002E0A14(_BYTE *result, unsigned int a2, unint64_t a3)
{
  v3 = -result & 7;
  if (v3 > a3)
  {
    LODWORD(v3) = a3;
  }

  if (v3 > 3)
  {
    if (v3 > 5)
    {
      if (v3 != 6)
      {
        if (v3 != 7)
        {
          goto LABEL_20;
        }

        *result++ = a2;
      }

      *result++ = a2;
    }

    else if (v3 == 4)
    {
LABEL_16:
      *result++ = a2;
      goto LABEL_17;
    }

    *result++ = a2;
    goto LABEL_16;
  }

  switch(v3)
  {
    case 1:
LABEL_19:
      *result++ = a2;
      break;
    case 2:
LABEL_18:
      *result++ = a2;
      goto LABEL_19;
    case 3:
LABEL_17:
      *result++ = a2;
      goto LABEL_18;
  }

LABEL_20:
  v4 = a3 - v3;
  if (v4 >= 8)
  {
    v5 = 0x101010101010101 * a2;
    v6 = ((v4 >> 3) + 7) >> 3;
    v7 = (v4 >> 3) & 7;
    if (v7 > 3)
    {
      if (((v4 >> 3) & 7) <= 5)
      {
        if (v7 == 4)
        {
          goto LABEL_36;
        }

        goto LABEL_35;
      }

      if (v7 == 6)
      {
        goto LABEL_34;
      }

      goto LABEL_33;
    }

    if (((v4 >> 3) & 7) > 1)
    {
      if (v7 == 2)
      {
        goto LABEL_38;
      }

      goto LABEL_37;
    }

    if (!v7)
    {
      goto LABEL_32;
    }

    while (1)
    {
      *result = v5;
      result += 8;
      if (!--v6)
      {
        break;
      }

LABEL_32:
      *result = v5;
      result += 8;
LABEL_33:
      *result = v5;
      result += 8;
LABEL_34:
      *result = v5;
      result += 8;
LABEL_35:
      *result = v5;
      result += 8;
LABEL_36:
      *result = v5;
      result += 8;
LABEL_37:
      *result = v5;
      result += 8;
LABEL_38:
      *result = v5;
      result += 8;
    }
  }

  v8 = v4 & 7;
  if (v8 > 3)
  {
    if (v8 > 5)
    {
      if (v8 != 6)
      {
        *result++ = a2;
      }

      *result++ = a2;
    }

    else if (v8 == 4)
    {
      goto LABEL_53;
    }

    *result++ = a2;
LABEL_53:
    *result++ = a2;
LABEL_54:
    *result++ = a2;
LABEL_55:
    *result++ = a2;
    goto LABEL_56;
  }

  if (v8 > 1)
  {
    if (v8 == 2)
    {
      goto LABEL_55;
    }

    goto LABEL_54;
  }

  if (v8)
  {
LABEL_56:
    *result = a2;
  }

  return result;
}

id copyLoggingHandle()
{
  if (copyLoggingHandle_onceToken != -1)
  {
    copyLoggingHandle_cold_1();
  }

  v1 = copyLoggingHandle_logHandle;

  return v1;
}

id __copy_helper_block_e8_32s40s(uint64_t a1, uint64_t a2)
{
  v3 = *(a2 + 32);
  v4 = *(a2 + 40);

  return v4;
}

void maLog(uint64_t a1, uint64_t a2, id a3, ...)
{
  va_start(va, a3);
  v5 = a3;
  v6 = [[NSMutableString alloc] initWithFormat:v5 arguments:va];

  if (a1 && gPersistentLogFunctionNameLoggingEnabled == 1)
  {
    v7 = [NSString stringWithFormat:@"%s: %@", a1, v6];

    v6 = v7;
  }

  v8 = +[MALog getSharedInstance];
  [v8 logMessage:v6 toSyslog:a2];
}

NSError *createAndLogError(uint64_t a1, uint64_t a2, void *a3, uint64_t a4, id a5, void *a6, ...)
{
  va_start(va, a6);
  v11 = a5;
  v12 = a6;
  v13 = a3;
  v14 = [[NSMutableString alloc] initWithFormat:v12 arguments:va];

  v15 = createMobileActivationError(a1, a2, v13, a4, v11, @"%@", v14);
  if (a1 && gPersistentLogFunctionNameLoggingEnabled == 1)
  {
    if (v11)
    {
      v16 = [NSString stringWithFormat:@"%s: %@ // %@", a1, v14, v11];
    }

    else
    {
      v16 = [NSString stringWithFormat:@"%s: %@", a1, v14, v20];
    }

    v17 = v16;

    v14 = v17;
  }

  v18 = +[MALog getSharedInstance];
  [v18 logMessage:v14 toSyslog:0];

  return v15;
}

void deleteExpiredPersistentLogFiles()
{
  v0 = +[MALog getSharedInstance];
  [v0 deleteExpiredLogFiles];
}

void __copyLoggingHandle_block_invoke(id a1)
{
  v1 = os_log_create("com.apple.mobileactivationd", "daemon");
  v2 = copyLoggingHandle_logHandle;
  copyLoggingHandle_logHandle = v1;
}

void __copyRTCResetSerialQueue_block_invoke(id a1)
{
  v1 = dispatch_queue_attr_make_with_autorelease_frequency(0, DISPATCH_AUTORELEASE_FREQUENCY_WORK_ITEM);
  v2 = dispatch_queue_create("com.apple.mobileactivationd.rtcreset", v1);
  v3 = copyRTCResetSerialQueue_queue;
  copyRTCResetSerialQueue_queue = v2;
}

id copyMobileActivationSerialQueue()
{
  if (copyMobileActivationSerialQueue_onceToken != -1)
  {
    copyMobileActivationSerialQueue_cold_1();
  }

  v1 = copyMobileActivationSerialQueue_queue;

  return v1;
}

void __copyMobileActivationSerialQueue_block_invoke(id a1)
{
  v1 = dispatch_queue_attr_make_with_autorelease_frequency(0, DISPATCH_AUTORELEASE_FREQUENCY_WORK_ITEM);
  v2 = dispatch_queue_create("com.apple.mobileactivationd", v1);
  v3 = copyMobileActivationSerialQueue_queue;
  copyMobileActivationSerialQueue_queue = v2;
}

uint64_t certificatePublicKeyMatchesSystemPublicKey(uint64_t a1, uint64_t a2, __SecCertificate *a3, NSError **a4)
{
  v5 = a3;
  error = 0;
  if (a3)
  {
    if (a2 == 2)
    {
      v21 = 0;
      v22 = 0;
      v8 = security_copy_system_key(a1, &v22, &v21);
      v9 = v22;
      v10 = v21;
      if (!v8)
      {
        MobileActivationError = createMobileActivationError("certificatePublicKeyMatchesSystemPublicKey", 205, @"com.apple.MobileActivation.ErrorDomain", -1, v10, @"Failed to copy UIK.");
        goto LABEL_17;
      }

      if (v9)
      {
LABEL_10:
        v14 = SecCertificateCopyKey(v5);
        v5 = v14;
        if (v14)
        {
          v11 = SecKeyCopyExternalRepresentation(v14, &error);
          if (v11)
          {
            if ([v9 isEqualToData:v11])
            {
              v12 = 1;
              goto LABEL_24;
            }

            v17 = createMobileActivationError("certificatePublicKeyMatchesSystemPublicKey", 236, @"com.apple.MobileActivation.ErrorDomain", -1, 0, @"Certificate public key does not match systemKey public key.");
          }

          else
          {
            v17 = createMobileActivationError("certificatePublicKeyMatchesSystemPublicKey", 229, @"com.apple.MobileActivation.ErrorDomain", -1, error, @"Failed to encode certificate public key as data.");
          }

          v16 = v17;

LABEL_22:
          v10 = v16;
          if (a4)
          {
            goto LABEL_23;
          }

LABEL_7:
          v12 = 0;
          goto LABEL_24;
        }

        v16 = createMobileActivationError("certificatePublicKeyMatchesSystemPublicKey", 223, @"com.apple.MobileActivation.ErrorDomain", -1, 0, @"Failed to retrieve certificate public key.");

LABEL_18:
        v11 = 0;
        goto LABEL_22;
      }
    }

    else
    {
      v10 = 0;
      v8 = 0;
    }

    v13 = v10;
    v20 = v10;
    v9 = libaks_system_key_get_public(a2, a1, &v20);
    v10 = v20;

    if (v9)
    {
      goto LABEL_10;
    }

    MobileActivationError = createMobileActivationError("certificatePublicKeyMatchesSystemPublicKey", 214, @"com.apple.MobileActivation.ErrorDomain", -1, v10, @"Failed to query systemKey (%d / %d) public key.", a2, a1);
LABEL_17:
    v16 = MobileActivationError;

    v5 = 0;
    goto LABEL_18;
  }

  v10 = createMobileActivationError("certificatePublicKeyMatchesSystemPublicKey", 197, @"com.apple.MobileActivation.ErrorDomain", -2, 0, @"Invalid input.");
  v9 = 0;
  v8 = 0;
  v11 = 0;
  if (!a4)
  {
    goto LABEL_7;
  }

LABEL_23:
  v18 = v10;
  v12 = 0;
  *a4 = v10;
LABEL_24:
  if (v8)
  {
    CFRelease(v8);
  }

  if (v5)
  {
    CFRelease(v5);
  }

  if (error)
  {
    CFRelease(error);
  }

  error = 0;

  return v12;
}

void scheduleXPCActivity(void *a1, const char *a2, unsigned int a3, int a4, unsigned int a5, unsigned int a6, void *a7)
{
  v13 = a1;
  v14 = a7;
  v28 = 0;
  v29 = &v28;
  v30 = 0x3032000000;
  v31 = __Block_byref_object_copy_;
  v32 = __Block_byref_object_dispose_;
  v33 = 0;
  v15 = xpc_dictionary_create(0, 0, 0);
  xpc_dictionary_set_BOOL(v15, XPC_ACTIVITY_REPEATING, 0);
  xpc_dictionary_set_int64(v15, XPC_ACTIVITY_DELAY, a3);
  xpc_dictionary_set_string(v15, XPC_ACTIVITY_PRIORITY, XPC_ACTIVITY_PRIORITY_UTILITY);
  xpc_dictionary_set_BOOL(v15, XPC_ACTIVITY_ALLOW_BATTERY, 1);
  xpc_dictionary_set_BOOL(v15, XPC_ACTIVITY_POWER_NAP, 1);
  xpc_dictionary_set_int64(v15, XPC_ACTIVITY_GRACE_PERIOD, 30);
  xpc_dictionary_set_BOOL(v15, XPC_ACTIVITY_REQUIRES_CLASS_C, 0);
  if (a4)
  {
    xpc_dictionary_set_BOOL(v15, XPC_ACTIVITY_REQUIRE_NETWORK_CONNECTIVITY, 1);
    xpc_dictionary_set_int64(v15, XPC_ACTIVITY_NETWORK_UPLOAD_SIZE, a5);
    xpc_dictionary_set_int64(v15, XPC_ACTIVITY_NETWORK_DOWNLOAD_SIZE, a6);
  }

  if (a3 <= 0x1E)
  {
    v16 = os_transaction_create();
    v17 = v29[5];
    v29[5] = v16;

    v18 = dispatch_time(0, 30000000000);
    v19 = dispatch_get_global_queue(0, 0);
    block[0] = _NSConcreteStackBlock;
    block[1] = 3254779904;
    block[2] = __scheduleXPCActivity_block_invoke;
    block[3] = &__block_descriptor_40_e8_32r_e5_v8__0l;
    block[4] = &v28;
    dispatch_after(v18, v19, block);
  }

  handler[0] = _NSConcreteStackBlock;
  handler[1] = 3254779904;
  handler[2] = __scheduleXPCActivity_block_invoke_21;
  handler[3] = &__block_descriptor_64_e8_32s40bs48r_e33_v16__0__NSObject_OS_xpc_object__8l;
  v25 = &v28;
  v26 = a2;
  v20 = v14;
  v24 = v20;
  v21 = v13;
  v23 = v21;
  xpc_activity_register(a2, v15, handler);

  _Block_object_dispose(&v28, 8);
}

void sub_1002E1EAC(_Unwind_Exception *a1, uint64_t a2, uint64_t a3, uint64_t a4, uint64_t a5, uint64_t a6, uint64_t a7, uint64_t a8, uint64_t a9, uint64_t a10, uint64_t a11, uint64_t a12, uint64_t a13, uint64_t a14, uint64_t a15, ...)
{
  va_start(va, a15);
  _Block_object_dispose(va, 8);
  _Unwind_Resume(a1);
}

uint64_t __Block_byref_object_copy_(uint64_t result, uint64_t a2)
{
  *(result + 40) = *(a2 + 40);
  *(a2 + 40) = 0;
  return result;
}

void __scheduleXPCActivity_block_invoke(uint64_t a1)
{
  v1 = *(*(a1 + 32) + 8);
  v2 = *(v1 + 40);
  *(v1 + 40) = 0;
}

void __scheduleXPCActivity_block_invoke_21(uint64_t a1, id a2)
{
  v3 = a2;
  if (xpc_activity_get_state(v3) == 2 && xpc_activity_should_defer(v3))
  {
    if (xpc_activity_set_state(v3, 3))
    {
      goto LABEL_9;
    }

    v4 = copyLoggingHandle();
    if (os_log_type_enabled(v4, OS_LOG_TYPE_FAULT))
    {
      __scheduleXPCActivity_block_invoke_21_cold_1(a1, v4);
    }
  }

  if (xpc_activity_get_state(v3) == 2)
  {
    v5 = *(*(a1 + 48) + 8);
    v6 = *(v5 + 40);
    *(v5 + 40) = 0;

    (*(*(a1 + 40) + 16))();
  }

LABEL_9:
}

void __copy_helper_block_e8_32s40b48r(uint64_t a1, uint64_t a2)
{
  v4 = *(a2 + 32);
  _Block_object_assign((a1 + 40), *(a2 + 40), 7);
  v5 = *(a2 + 48);

  _Block_object_assign((a1 + 48), v5, 8);
}

void __destroy_helper_block_e8_32s40s48r(uint64_t a1)
{
  _Block_object_dispose(*(a1 + 48), 8);

  v2 = *(a1 + 32);
}

uint64_t validateOIDKeyUsageProperties(void *a1, NSError **a2)
{
  v3 = a1;
  v4 = v3;
  if (v3 && (v5 = [v3 objectForKeyedSubscript:@"5"], v5, v5))
  {
    v6 = 0;
    v7 = 1;
  }

  else
  {
    v6 = createMobileActivationError("validateOIDKeyUsageProperties", 367, @"com.apple.MobileActivation.ErrorDomain", -27, 0, @"Missing 'sepClient' property.");
    if (a2)
    {
      v6 = v6;
      v7 = 0;
      *a2 = v6;
    }

    else
    {
      v7 = 0;
    }
  }

  return v7;
}

uint64_t validateCertificateOID(uint64_t a1, id a2, NSError **a3)
{
  v5 = a2;
  v15 = 0;
  v6 = lockcrypto_query_certificate_properties(a1, v5, &v15);
  v7 = v15;
  if (v6)
  {
    if (![v5 isEqualToString:@"1.2.840.113635.100.8.5"])
    {
      v10 = 1;
      goto LABEL_12;
    }

    v14 = v7;
    v8 = validateOIDKeyUsageProperties(v6, &v14);
    v9 = v14;

    if (v8)
    {
      v10 = 1;
      v7 = v9;
      goto LABEL_12;
    }

    v11 = createMobileActivationError("validateCertificateOID", 393, @"com.apple.MobileActivation.ErrorDomain", -27, v9, @"Failed to validate OID %@.", v5);
    v7 = v9;
  }

  else
  {
    v11 = createMobileActivationError("validateCertificateOID", 389, @"com.apple.MobileActivation.ErrorDomain", -26, v7, @"Failed to query OID %@.", v5);
  }

  if (a3)
  {
    v12 = v11;
    v10 = 0;
    *a3 = v11;
  }

  else
  {
    v10 = 0;
  }

  v7 = v11;
LABEL_12:

  return v10;
}

uint64_t validateCertificateOIDArray(uint64_t a1, id a2, NSError **a3)
{
  v5 = a2;
  if (![v5 count])
  {
    v10 = createMobileActivationError("validateCertificateOIDArray", 415, @"com.apple.MobileActivation.ErrorDomain", -1, 0, @"Empty OID list.");
    v6 = 0;
    if (!a3)
    {
      goto LABEL_16;
    }

    goto LABEL_20;
  }

  v6 = objc_opt_new();
  if (!v6)
  {
    v10 = createMobileActivationError("validateCertificateOIDArray", 421, @"com.apple.MobileActivation.ErrorDomain", -1, 0, @"Failed to allocate array.");
    if (!a3)
    {
      goto LABEL_16;
    }

LABEL_20:
    v18 = v10;
    v16 = 0;
    *a3 = v10;
    goto LABEL_22;
  }

  v20 = a3;
  v21 = v5;
  v25 = 0u;
  v26 = 0u;
  v23 = 0u;
  v24 = 0u;
  v7 = v5;
  v8 = [v7 countByEnumeratingWithState:&v23 objects:v27 count:16];
  if (v8)
  {
    v9 = v8;
    v10 = 0;
    v11 = *v24;
    do
    {
      v12 = 0;
      v13 = v10;
      do
      {
        if (*v24 != v11)
        {
          objc_enumerationMutation(v7);
        }

        v14 = *(*(&v23 + 1) + 8 * v12);
        v22 = v13;
        v15 = validateCertificateOID(a1, v14, &v22);
        v10 = v22;

        if ((v15 & 1) == 0)
        {
          [v6 addObject:v14];
        }

        v12 = v12 + 1;
        v13 = v10;
      }

      while (v9 != v12);
      v9 = [v7 countByEnumeratingWithState:&v23 objects:v27 count:16];
    }

    while (v9);
  }

  else
  {
    v10 = 0;
  }

  if (![v6 count])
  {
    v16 = 1;
    v5 = v21;
    goto LABEL_22;
  }

  v17 = createMobileActivationError("validateCertificateOIDArray", 433, @"com.apple.MobileActivation.ErrorDomain", -27, v10, @"Failed to validate OID(s): %@", v6);

  v10 = v17;
  a3 = v20;
  v5 = v21;
  if (v20)
  {
    goto LABEL_20;
  }

LABEL_16:
  v16 = 0;
LABEL_22:

  return v16;
}

NSError **copyDCRT(void *a1, __SecCertificate **a2, SecCertificateRef *a3, void *a4, NSError **a5)
{
  v9 = a1;
  v10 = a4;
  v57 = v9;
  if (platform_supports_activation())
  {
    v11 = data_ark_copy(v9, 0, @"ActivationState");
    v12 = isNSString(v11);

    if (!v12)
    {
      v12 = @"Unactivated";
    }

    v56 = v12;
    if (([(__CFString *)v12 isEqualToString:@"Activated"]& 1) == 0)
    {
      v13 = createMobileActivationError("copyDCRT", 474, @"com.apple.MobileActivation.ErrorDomain", -8, 0, @"Device is not activated (%@).", v12);
      v14 = 0;
      v15 = 0;
      v16 = 0;
      v17 = 0;
      v18 = 0;
      v55 = 0;
      v58 = 0;
      goto LABEL_48;
    }
  }

  else
  {
    v56 = 0;
  }

  v19 = [v10 objectForKeyedSubscript:@"CanonicalizeDcrtOIDs"];
  v18 = v19;
  if (v19)
  {
    v20 = isNSNumber(v19);

    if (!v20)
    {
      v13 = createMobileActivationError("copyDCRT", 481, @"com.apple.MobileActivation.ErrorDomain", -1, 0, @"Invalid option (%@).", @"CanonicalizeDcrtOIDs");
      v14 = 0;
      v15 = 0;
      v16 = 0;
      v17 = 0;
      v55 = 0;
      goto LABEL_51;
    }
  }

  v21 = [v10 objectForKeyedSubscript:@"ValidateCriticalDcrtOIDs"];
  v22 = v21;
  v55 = v21;
  if (v21)
  {
    v20 = isNSNumber(v21);

    if (!v20)
    {
      v13 = createMobileActivationError("copyDCRT", 487, @"com.apple.MobileActivation.ErrorDomain", -1, 0, @"Invalid option (%@).", @"ValidateCriticalDcrtOIDs");
      v14 = 0;
      v15 = 0;
      v16 = 0;
      v17 = 0;
      goto LABEL_51;
    }
  }

  v23 = [v10 objectForKeyedSubscript:@"sdcrtAttestation"];
  v17 = v23;
  if (v23)
  {
    v20 = isNSNumber(v23);

    if (!v20)
    {
      v13 = createMobileActivationError("copyDCRT", 493, @"com.apple.MobileActivation.ErrorDomain", -1, 0, @"Invalid option (%@).", @"sdcrtAttestation");
      v14 = 0;
      v15 = 0;
      v16 = 0;
LABEL_51:
      v58 = 0;
      v38 = 0;
      if (!a5)
      {
        goto LABEL_53;
      }

      goto LABEL_52;
    }
  }

  v51 = a2;
  if (([v17 BOOLValue] & 1) != 0 || objc_msgSend(v18, "BOOLValue"))
  {
    v24 = copy_required_dcrt_oids();
LABEL_16:
    v58 = v24;
    goto LABEL_17;
  }

  if ([v22 BOOLValue])
  {
    v24 = copy_critical_dcrt_oids();
    goto LABEL_16;
  }

  v58 = 0;
LABEL_17:
  v25 = [v17 BOOLValue];
  if (v25)
  {
    v26 = @"SDCRT";
  }

  else
  {
    v26 = @"DCRT";
  }

  v27 = @"SDAK";
  if (!v25)
  {
    v27 = @"DAK";
  }

  v52 = v27;
  if (v25)
  {
    v28 = 10;
  }

  else
  {
    v28 = 9;
  }

  v29 = copy_dcrt_path();
  v30 = [v17 BOOLValue];
  v31 = &SDCRT_FILENAME;
  if (!v30)
  {
    v31 = &DCRT_FILENAME;
  }

  v15 = [v29 stringByAppendingPathComponent:*v31];

  if (!v15)
  {
    MobileActivationError = createMobileActivationError("copyDCRT", 521, @"com.apple.MobileActivation.ErrorDomain", -1, 0, @"Failed to create %@ file path.", v26);
LABEL_46:
    v13 = MobileActivationError;
    v14 = 0;
LABEL_47:
    v16 = 0;
    goto LABEL_48;
  }

  v54 = v26;
  v32 = +[NSFileManager defaultManager];
  v33 = [(NSFileManager *)v32 fileExistsAtPath:v15];

  if ((v33 & 1) == 0)
  {
    MobileActivationError = createMobileActivationError("copyDCRT", 526, @"com.apple.MobileActivation.ErrorDomain", -10, 0, @"%@ is unavailable.", v54);
    goto LABEL_46;
  }

  v50 = a3;
  v34 = [[NSData alloc] initWithContentsOfFile:v15];
  v14 = v34;
  if (!v34)
  {
    v13 = createMobileActivationError("copyDCRT", 532, @"com.apple.MobileActivation.ErrorDomain", -1, 0, @"Failed to encode %@.", v54);
    goto LABEL_47;
  }

  v61 = 0;
  v16 = parseDERCertificatesFromChain(v34, &v61);
  v35 = v61;
  v36 = v35;
  if (!v16)
  {
    v13 = createMobileActivationError("copyDCRT", 538, @"com.apple.MobileActivation.ErrorDomain", -1, v35, @"Failed to query certificate(s) from DER data.");

LABEL_48:
    v38 = 0;
    v20 = 0;
    if (!a5)
    {
      goto LABEL_53;
    }

LABEL_52:
    v42 = v13;
    v43 = a5;
    a5 = 0;
    *v43 = v13;
    goto LABEL_53;
  }

  v48 = a5;
  v49 = v35;
  v37 = [(NSError *)v16 objectAtIndexedSubscript:0];
  v38 = SecCertificateCreateWithData(kCFAllocatorDefault, v37);

  if (!v38)
  {
    v45 = 544;
LABEL_67:
    v13 = createMobileActivationError("copyDCRT", v45, @"com.apple.MobileActivation.ErrorDomain", -1, v49, @"Failed to create certificate from pem data.");

    v20 = 0;
    goto LABEL_70;
  }

  v39 = [(NSError *)v16 objectAtIndexedSubscript:1];
  v20 = SecCertificateCreateWithData(kCFAllocatorDefault, v39);

  if (!v20)
  {
    v45 = 550;
    goto LABEL_67;
  }

  v60 = v49;
  v47 = certificatePublicKeyMatchesSystemPublicKey(2, v28, v38, &v60);
  v13 = v60;

  if (v47)
  {
    if (!v58)
    {
LABEL_37:
      if (v51)
      {
        *v51 = v38;
        v38 = 0;
      }

      if (v50)
      {
        *v50 = v20;
        v20 = 0;
      }

      a5 = v14;
      v14 = a5;
      goto LABEL_53;
    }

    v59 = v13;
    v40 = validateCertificateOIDArray(v38, v58, &v59);
    v53 = v59;

    if (v40)
    {
      v13 = v53;
      goto LABEL_37;
    }

    v13 = createMobileActivationError("copyDCRT", 560, @"com.apple.MobileActivation.ErrorDomain", -10, v53, @"Failed to validate %@.", v54);
  }

  else
  {
    v46 = createMobileActivationError("copyDCRT", 555, @"com.apple.MobileActivation.ErrorDomain", -10, v13, @"%@ does not match committed %@.", v54, v52);

    v13 = v46;
  }

LABEL_70:
  a5 = v48;
  if (v48)
  {
    goto LABEL_52;
  }

LABEL_53:
  if (v38)
  {
    CFRelease(v38);
  }

  if (v20)
  {
    CFRelease(v20);
  }

  return a5;
}

uint64_t storeDCRT(void *a1, void *a2, void *a3, NSError **a4)
{
  v6 = a1;
  v7 = a2;
  v8 = a3;
  v9 = v8;
  if (!v7)
  {
    v17 = createMobileActivationError("storeDCRT", 617, @"com.apple.MobileActivation.ErrorDomain", -2, 0, @"Invalid input.");
    v18 = 0;
    v19 = 0;
    v13 = 0;
    v20 = 0;
    v89 = 0;
    v90 = 0;
    v86 = 0;
    v87 = 0;
    v88 = 0;
    v84 = 0;
    v85 = 0;
    goto LABEL_8;
  }

  if (!v8)
  {
    v87 = 0;
    v22 = 0;
    v11 = 0;
    v23 = 0;
    v81 = 0;
    v12 = a4;
    goto LABEL_18;
  }

  v10 = [v8 objectForKeyedSubscript:@"UseCommittedDAK"];
  v11 = v10;
  v12 = a4;
  if (v10 && (v13 = isNSNumber(v10), v13, !v13))
  {
    v89 = v11;
    v17 = createMobileActivationError("storeDCRT", 624, @"com.apple.MobileActivation.ErrorDomain", -1, 0, @"Invalid value for option (%@).", @"UseCommittedDAK");
    v18 = 0;
    v19 = 0;
    v20 = 0;
    v90 = 0;
    v86 = 0;
    v87 = 0;
  }

  else
  {
    v14 = [v9 objectForKeyedSubscript:@"ServerResponseDate"];
    v15 = isNSDate(v14);

    v16 = v15 != 0;
    if (v15)
    {
      v87 = [v9 objectForKeyedSubscript:@"ServerResponseDate"];
    }

    else
    {
      v87 = 0;
    }

    v24 = [v9 objectForKeyedSubscript:@"SkipCertificateValidation"];
    v22 = v24;
    if (!v24 || (v13 = isNSNumber(v24), v13, v13))
    {
      v25 = [v9 objectForKeyedSubscript:@"sdcrtAttestation"];
      v23 = v25;
      if (v25)
      {
        v13 = isNSNumber(v25);

        if (!v13)
        {
          v89 = v11;
          v90 = v23;
          v86 = v22;
          v17 = createMobileActivationError("storeDCRT", 641, @"com.apple.MobileActivation.ErrorDomain", -1, 0, @"Invalid option (%@).", @"sdcrtAttestation");
          v18 = 0;
          v19 = 0;
LABEL_75:
          v20 = 0;
          goto LABEL_76;
        }
      }

      v81 = v16;
LABEL_18:
      v90 = v23;
      v26 = [v23 BOOLValue];
      if (v26)
      {
        v27 = @"SDAK";
      }

      else
      {
        v27 = @"DAK";
      }

      if (v26)
      {
        v28 = @"SDCRT";
      }

      else
      {
        v28 = @"DCRT";
      }

      v105 = 0;
      if (v26)
      {
        v29 = 10;
      }

      else
      {
        v29 = 9;
      }

      v83 = v29;
      v18 = parseDERCertificatesFromChain(v7, &v105);
      v21 = v105;
      v89 = v11;
      v86 = v22;
      if (v18)
      {
        v88 = v18;
        v79 = v27;
        v80 = v28;
        if ([v22 BOOLValue])
        {
          v77 = v7;
          *v82 = v6;
          v84 = 0;
          v85 = 0;
          v20 = 0;
          v13 = 0;
          v19 = 0;
          goto LABEL_30;
        }

        if (is_internal_build())
        {
          v39 = [NSUserDefaults alloc];
          v40 = [v39 persistentDomainForName:@"com.apple.mobileactivationd"];

          v41 = [v40 objectForKeyedSubscript:@"UseQACertificates"];
          v42 = isNSNumber(v41);

          v85 = v40;
          if (v42)
          {
            v43 = [v40 objectForKeyedSubscript:@"UseQACertificates"];
            v44 = [v43 BOOLValue];

            goto LABEL_47;
          }
        }

        else
        {
          v85 = 0;
        }

        v44 = 0;
LABEL_47:
        v104 = v21;
        is_legacy = security_committed_uik_is_legacy(&v104);
        v47 = v104;

        if (!is_legacy && v47)
        {
          v17 = createMobileActivationError("storeDCRT", 671, @"com.apple.MobileActivation.ErrorDomain", -1, v47, @"Failed to query legacy UIK support.");

          v18 = 0;
          v19 = 0;
          v13 = 0;
          v20 = 0;
          v84 = 0;
          goto LABEL_77;
        }

        v48 = platform_supports_activation() ^ 1 | is_legacy;
        v49 = [v90 BOOLValue];
        if (v48)
        {
          v50 = 2;
        }

        else
        {
          v50 = 1;
        }

        if (v49)
        {
          v51 = 5;
        }

        else
        {
          v51 = v50;
        }

        v103 = v47;
        v52 = copyRootCertificate(v51, v44, &v103);
        v53 = v103;

        if (v52)
        {
          v102 = v53;
          v20 = lockcrypto_cert_from_pem_data(v52, &v102);
          v54 = v102;

          v84 = v52;
          if (v20)
          {
            v78 = v54;
            v55 = [v88 objectAtIndexedSubscript:0];
            v13 = SecCertificateCreateWithData(kCFAllocatorDefault, v55);

            if (v13)
            {
              v56 = [v88 objectAtIndexedSubscript:1];
              v19 = SecCertificateCreateWithData(kCFAllocatorDefault, v56);

              if (v19)
              {
                if ([v89 BOOLValue])
                {
                  v57 = 2;
                }

                else
                {
                  v57 = 3;
                }

                v101 = v78;
                v58 = certificatePublicKeyMatchesSystemPublicKey(v57, v83, v13, &v101);
                v59 = v101;

                if (v58)
                {
                  v100 = v59;
                  v60 = evaluateBAATrustWithCerts(v13, v19, v20, v48 & 1, v81, v87, &v100);
                  v17 = v100;

                  if ((v60 & 1) == 0)
                  {
                    v69 = createMobileActivationError("storeDCRT", 724, @"com.apple.MobileActivation.ErrorDomain", -1, v17, @"Failed to verify %@.", v80);

                    v18 = 0;
                    v21 = 0;
                    goto LABEL_90;
                  }

                  v77 = v7;
                  *v82 = v6;
                  v98 = 0u;
                  v99 = 0u;
                  v96 = 0u;
                  v97 = 0u;
                  obj = copy_required_dcrt_oids();
                  v61 = [(NSArray *)obj countByEnumeratingWithState:&v96 objects:v108 count:16];
                  if (v61)
                  {
                    v62 = v61;
                    v76 = *v97;
                    while (2)
                    {
                      v63 = 0;
                      v64 = v17;
                      do
                      {
                        if (*v97 != v76)
                        {
                          objc_enumerationMutation(obj);
                        }

                        v65 = *(*(&v96 + 1) + 8 * v63);
                        v95 = v64;
                        v66 = lockcrypto_query_certificate_properties(v13, v65, &v95);
                        v17 = v95;

                        if (!v66)
                        {
                          v74 = createMobileActivationError("storeDCRT", 732, @"com.apple.MobileActivation.ErrorDomain", -1, v17, @"%@ is missing required OID: %@", v80, v65);

                          v17 = v74;
                          goto LABEL_103;
                        }

                        v63 = v63 + 1;
                        v64 = v17;
                      }

                      while (v62 != v63);
                      v62 = [(NSArray *)obj countByEnumeratingWithState:&v96 objects:v108 count:16];
                      if (v62)
                      {
                        continue;
                      }

                      break;
                    }
                  }

LABEL_103:

                  v21 = 0;
                  if (v17)
                  {
                    v18 = 0;
                    goto LABEL_44;
                  }

LABEL_30:
                  v30 = +[NSFileManager defaultManager];
                  v31 = copy_dcrt_path();
                  v106 = NSFilePosixPermissions;
                  v107 = &off_1003FBC18;
                  v32 = [NSDictionary dictionaryWithObjects:&v107 forKeys:&v106 count:1];
                  v94 = v21;
                  v33 = [(NSFileManager *)v30 createDirectoryAtPath:v31 withIntermediateDirectories:1 attributes:v32 error:&v94];
                  v34 = v94;

                  if (v33)
                  {
                    v35 = copy_dcrt_path();
                    v36 = [v90 BOOLValue];
                    v37 = &SDCRT_FILENAME;
                    if (!v36)
                    {
                      v37 = &DCRT_FILENAME;
                    }

                    v21 = [v35 stringByAppendingPathComponent:*v37];

                    v7 = v77;
                    if (!v21)
                    {
                      v17 = createMobileActivationError("storeDCRT", 751, @"com.apple.MobileActivation.ErrorDomain", -1, 0, @"Failed to create %@ file path.", v80);

                      v18 = 0;
                      v6 = *v82;
                      goto LABEL_9;
                    }

                    v93 = v34;
                    v38 = store_data(v21, v77, &v93);
                    v17 = v93;

                    v6 = *v82;
                    if (v38)
                    {
                      if ([v89 BOOLValue])
                      {
                        v18 = 1;
                      }

                      else
                      {
                        v92 = v17;
                        v70 = libaks_system_key_operate(v83, 2, &v92);
                        v71 = v92;

                        if (v70)
                        {
                          v18 = 1;
                          v17 = v71;
                        }

                        else
                        {
                          v17 = createMobileActivationError("storeDCRT", 766, @"com.apple.MobileActivation.ErrorDomain", -1, v71, @"Failed to commit %@.", v79);

                          v18 = 0;
                        }
                      }

                      if (v17)
                      {
                        v73 = +[NSFileManager defaultManager];
                        [(NSFileManager *)v73 removeItemAtPath:v21 error:0];
                      }

LABEL_9:
                      v12 = a4;
                      if (!a4)
                      {
                        goto LABEL_80;
                      }

                      goto LABEL_78;
                    }

                    v69 = createMobileActivationError("storeDCRT", 756, @"com.apple.MobileActivation.ErrorDomain", -1, v17, @"Failed to store %@ at %@.", v80, v21);

                    v18 = 0;
LABEL_90:
                    v17 = v69;
                    goto LABEL_9;
                  }

                  v45 = copy_dcrt_path();
                  v17 = createMobileActivationError("storeDCRT", 745, @"com.apple.MobileActivation.ErrorDomain", -1, v34, @"Failed to create %@.", v45);

                  v18 = 0;
                  v21 = 0;
LABEL_44:
                  v6 = *v82;
                  v7 = v77;
                  goto LABEL_9;
                }

                v17 = createMobileActivationError("storeDCRT", 717, @"com.apple.MobileActivation.ErrorDomain", -1, v59, @"%@ public key does not match %@ public key.", v80, v79);
                v72 = v59;
              }

              else
              {
                v17 = createMobileActivationError("storeDCRT", 710, @"com.apple.MobileActivation.ErrorDomain", -1, 0, @"Failed to create certificate.");
                v72 = v78;
              }

              v18 = 0;
            }

            else
            {
              v17 = createMobileActivationError("storeDCRT", 704, @"com.apple.MobileActivation.ErrorDomain", -1, 0, @"Failed to create certificate.");

              v18 = 0;
              v19 = 0;
            }
          }

          else
          {
            v17 = createMobileActivationError("storeDCRT", 698, @"com.apple.MobileActivation.ErrorDomain", -1, v54, @"Failed to create certificate from pem data.");

            v18 = 0;
            v19 = 0;
            v13 = 0;
          }
        }

        else
        {
          v17 = createMobileActivationError("storeDCRT", 692, @"com.apple.MobileActivation.ErrorDomain", -1, v53, @"Failed to load BAA root CA certificate.");

          v18 = 0;
          v19 = 0;
          v13 = 0;
          v20 = 0;
          v84 = 0;
        }

LABEL_8:
        v21 = 0;
        goto LABEL_9;
      }

      v17 = createMobileActivationError("storeDCRT", 654, @"com.apple.MobileActivation.ErrorDomain", -1, v21, @"Failed to decode certificates.");

      v19 = 0;
      v13 = 0;
      goto LABEL_75;
    }

    v86 = v22;
    v89 = v11;
    v17 = createMobileActivationError("storeDCRT", 635, @"com.apple.MobileActivation.ErrorDomain", -1, 0, @"Invalid value for option (%@).", @"SkipCertificateValidation");
    v18 = 0;
    v19 = 0;
    v20 = 0;
    v90 = 0;
  }

LABEL_76:
  v88 = 0;
  v84 = 0;
  v85 = 0;
LABEL_77:
  v21 = 0;
  if (!v12)
  {
    goto LABEL_80;
  }

LABEL_78:
  if ((v18 & 1) == 0)
  {
    v67 = v17;
    *v12 = v17;
  }

LABEL_80:
  if (v13)
  {
    CFRelease(v13);
  }

  if (v19)
  {
    CFRelease(v19);
  }

  if (v20)
  {
    CFRelease(v20);
  }

  return v18;
}

uint64_t deleteDCRT(uint64_t a1, void *a2, NSError **a3)
{
  v4 = [a2 objectForKeyedSubscript:@"sdcrtAttestation"];
  v5 = v4;
  if (v4)
  {
    v6 = isNSNumber(v4);

    if (!v6)
    {
      v15 = createMobileActivationError("deleteDCRT", 800, @"com.apple.MobileActivation.ErrorDomain", -1, 0, @"Invalid option (%@).", @"sdcrtAttestation");
      v10 = 0;
      if (a3)
      {
        goto LABEL_11;
      }

LABEL_15:
      v18 = 0;
      goto LABEL_16;
    }
  }

  v7 = copy_dcrt_path();
  v8 = [v5 BOOLValue];
  v9 = &SDCRT_FILENAME;
  if (!v8)
  {
    v9 = &DCRT_FILENAME;
  }

  v10 = [v7 stringByAppendingPathComponent:*v9];

  if (v10)
  {
    v11 = +[NSFileManager defaultManager];
    v12 = [(NSFileManager *)v11 fileExistsAtPath:v10];

    if (v12)
    {
      v13 = +[NSFileManager defaultManager];
      v20 = 0;
      v14 = [(NSFileManager *)v13 removeItemAtPath:v10 error:&v20];
      v15 = v20;

      if ((v14 & 1) == 0)
      {
        v16 = createMobileActivationError("deleteDCRT", 812, @"com.apple.MobileActivation.ErrorDomain", -1, v15, @"Failed to delete %@.", v10);

        v15 = v16;
        if (!a3)
        {
          goto LABEL_15;
        }

        goto LABEL_11;
      }
    }

    else
    {
      v15 = 0;
    }

    v18 = 1;
    goto LABEL_16;
  }

  v15 = createMobileActivationError("deleteDCRT", 806, @"com.apple.MobileActivation.ErrorDomain", -1, 0, @"Failed to create DCRT file path.");
  if (!a3)
  {
    goto LABEL_15;
  }

LABEL_11:
  v17 = v15;
  v18 = 0;
  *a3 = v15;
LABEL_16:

  return v18;
}

uint64_t deleteUCRT(uint64_t a1, NSError **a2)
{
  v3 = +[NSFileManager defaultManager];
  v4 = copy_ucrt_path();
  v5 = [(NSFileManager *)v3 fileExistsAtPath:v4];

  if (!v5)
  {
    v9 = 0;
    goto LABEL_6;
  }

  v6 = +[NSFileManager defaultManager];
  v7 = copy_ucrt_path();
  v15 = 0;
  v8 = [(NSFileManager *)v6 removeItemAtPath:v7 error:&v15];
  v9 = v15;

  if (v8)
  {
LABEL_6:
    v13 = 1;
    goto LABEL_9;
  }

  v10 = copy_ucrt_path();
  v11 = createMobileActivationError("deleteUCRT", 836, @"com.apple.MobileActivation.ErrorDomain", -1, v9, @"Failed to delete %@.", v10);

  if (a2)
  {
    v12 = v11;
    v13 = 0;
    *a2 = v11;
  }

  else
  {
    v13 = 0;
  }

  v9 = v11;
LABEL_9:

  return v13;
}

uint64_t storeUCRT(void *a1, void *a2, void *a3, NSError **a4)
{
  v45 = a1;
  v6 = a2;
  v7 = a3;
  v8 = v7;
  if (!v6)
  {
    v12 = createMobileActivationError("storeUCRT", 873, @"com.apple.MobileActivation.ErrorDomain", -2, 0, @"Invalid input.");
    v13 = 0;
    v14 = 0;
    v15 = 0;
    v11 = 0;
    v16 = 0;
    v17 = 0;
    v10 = &__kCFBooleanFalse;
    goto LABEL_34;
  }

  if (v7)
  {
    v9 = [v7 objectForKeyedSubscript:@"UseCommittedUIK"];
    v10 = v9;
    if (v9)
    {
      v11 = isNSNumber(v9);

      if (!v11)
      {
        v12 = createMobileActivationError("storeUCRT", 880, @"com.apple.MobileActivation.ErrorDomain", -1, 0, @"Invalid option (%@).", @"UseCommittedUIK");
        v13 = 0;
        v14 = 0;
        v15 = 0;
LABEL_27:
        v16 = 0;
        v17 = 0;
        goto LABEL_34;
      }
    }
  }

  else
  {
    v10 = &__kCFBooleanFalse;
  }

  v18 = copyLoggingHandle();
  if (os_log_type_enabled(v18, OS_LOG_TYPE_DEFAULT))
  {
    v19 = formatURLResponse(v6, 200, 0);
    *buf = 138412290;
    v57 = v19;
    _os_log_impl(&_mh_execute_header, v18, OS_LOG_TYPE_DEFAULT, "Activation message:\n%@", buf, 0xCu);
  }

  v13 = [v8 mutableCopy];
  [v13 setObject:&__kCFBooleanTrue forKeyedSubscript:@"UseEnhancedValidation"];
  [v13 setObject:&__kCFBooleanTrue forKeyedSubscript:@"UseEnhancedValidationWithVersionCheck"];
  v53 = 0;
  v14 = lockcrypto_decode_pems(v6, "CERTIFICATE", &v53);
  v20 = v53;
  if (!v14)
  {
    v12 = createMobileActivationError("storeUCRT", 893, @"com.apple.MobileActivation.ErrorDomain", -1, v20, @"Failed to query certificate(s) from pem data.");

    v15 = 0;
    v11 = 0;
    goto LABEL_27;
  }

  v21 = [v14 objectAtIndexedSubscript:0];
  v17 = SecCertificateCreateWithData(kCFAllocatorDefault, v21);

  if (!v17)
  {
    v12 = createMobileActivationError("storeUCRT", 899, @"com.apple.MobileActivation.ErrorDomain", -1, v20, @"Failed to create certificate from pem data.");
    v37 = v20;
LABEL_33:

    v15 = 0;
    v11 = 0;
    v16 = 0;
    goto LABEL_34;
  }

  if ([v10 BOOLValue])
  {
    v22 = 2;
  }

  else
  {
    v22 = 3;
  }

  v52 = v20;
  v23 = certificatePublicKeyMatchesSystemPublicKey(v22, 2, v17, &v52);
  v24 = v52;

  if ((v23 & 1) == 0)
  {
    v12 = createMobileActivationError("storeUCRT", 904, @"com.apple.MobileActivation.ErrorDomain", -1, v24, @"UCRT public key does not match UIK public key.");
    v37 = v24;
    goto LABEL_33;
  }

  v51 = v24;
  v25 = verify_ucrt(v6, v13, &v51);
  v26 = v51;

  if ((v25 & 1) == 0)
  {
    v12 = createMobileActivationError("storeUCRT", 909, @"com.apple.MobileActivation.ErrorDomain", -1, v26, @"Failed to verify UCRT.");
LABEL_32:
    v37 = v26;
    goto LABEL_33;
  }

  v41 = +[NSFileManager defaultManager];
  v27 = copy_ucrt_path();
  v54 = NSFilePosixPermissions;
  v55 = &off_1003FBC18;
  v28 = [NSDictionary dictionaryWithObjects:&v55 forKeys:&v54 count:1];
  v50 = v26;
  v29 = [(NSFileManager *)v41 createDirectoryAtPath:v27 withIntermediateDirectories:1 attributes:v28 error:&v50];
  v42 = v50;

  if ((v29 & 1) == 0)
  {
    v26 = copy_ucrt_path();
    v12 = createMobileActivationError("storeUCRT", 966, @"com.apple.MobileActivation.ErrorDomain", -1, v42, @"Failed to create %@.", v26);

    goto LABEL_32;
  }

  v30 = v42;
  v31 = copy_ucrt_path();
  v16 = [v31 stringByAppendingPathComponent:@"ucrt.pem"];

  if (!v16)
  {
    MobileActivationError = createMobileActivationError("storeUCRT", 972, @"com.apple.MobileActivation.ErrorDomain", -1, 0, @"Failed to create UCRT file path.");
LABEL_42:
    v12 = MobileActivationError;

    v15 = 0;
    v11 = 0;
    goto LABEL_34;
  }

  v49 = v42;
  v32 = store_data(v16, v6, &v49);
  v30 = v49;

  if ((v32 & 1) == 0)
  {
    MobileActivationError = createMobileActivationError("storeUCRT", 977, @"com.apple.MobileActivation.ErrorDomain", -1, v30, @"Failed to store UCRT at %@.", v16);
    goto LABEL_42;
  }

  if (([v10 BOOLValue] & 1) == 0)
  {
    v48 = v30;
    v33 = libaks_system_key_operate(2, 2, &v48);
    v34 = v48;

    if ((v33 & 1) == 0)
    {
      v12 = createMobileActivationError("storeUCRT", 985, @"com.apple.MobileActivation.ErrorDomain", -1, v34, @"Failed to commit UIK.");

      v11 = 0;
      v15 = 0;
      goto LABEL_47;
    }

    v30 = v34;
  }

  v47 = v30;
  v35 = security_delete_legacy_uik(&v47);
  v12 = v47;

  if (v35)
  {
    v36 = +[GestaltHlpr getSharedInstance];
    v11 = [v36 copyAnswer:@"BuildVersion"];

    v15 = isNSString(v11);
    if (v15)
    {
      v15 = 1;
      data_ark_set(v45, 0, @"LastActivated", v11, 1);
      data_ark_set(v45, 0, @"ActivationState", @"Activated", 1);
      goto LABEL_47;
    }

    v43 = createMobileActivationError("storeUCRT", 999, @"com.apple.MobileActivation.ErrorDomain", -1, 0, @"Failed to retrieve build version.");
  }

  else
  {
    v43 = createMobileActivationError("storeUCRT", 992, @"com.apple.MobileActivation.ErrorDomain", -1, v12, @"Failed to delete legacy UIK.");

    v11 = 0;
    v15 = 0;
  }

  v12 = v43;
LABEL_47:
  if (v12)
  {
    v44 = +[NSFileManager defaultManager];
    [(NSFileManager *)v44 removeItemAtPath:v16 error:0];
  }

LABEL_34:
  if (a4 && (v15 & 1) == 0)
  {
    v38 = v12;
    *a4 = v12;
  }

  if (v17)
  {
    CFRelease(v17);
  }

  return v15;
}

uint64_t verify_ucrt(void *a1, void *a2, NSError **a3)
{
  v5 = a1;
  v6 = a2;
  v7 = v6;
  if (v6)
  {
    v8 = [v6 objectForKeyedSubscript:@"UseEnhancedValidation"];
    v9 = isNSNumber(v8);

    if (v9)
    {
      v10 = [v7 objectForKeyedSubscript:@"UseEnhancedValidation"];
      v11 = [v10 BOOLValue];
    }

    else
    {
      v11 = 0;
    }

    v14 = [v7 objectForKeyedSubscript:@"UseEnhancedValidationWithVersionCheck"];
    v15 = isNSNumber(v14);

    if (v15)
    {
      v16 = [v7 objectForKeyedSubscript:@"UseEnhancedValidationWithVersionCheck"];
      v13 = [v16 BOOLValue];
    }

    else
    {
      v13 = 0;
    }

    v17 = [v7 objectForKeyedSubscript:@"ServerResponseDate"];
    v18 = isNSDate(v17);

    if (v18)
    {
      v12 = [v7 objectForKeyedSubscript:@"ServerResponseDate"];
      v19 = 1;
      goto LABEL_13;
    }

    v12 = 0;
  }

  else
  {
    v12 = 0;
    v11 = 0;
    v13 = 0;
  }

  v19 = 0;
LABEL_13:
  v99 = a3;
  if (is_internal_build())
  {
    v20 = [NSUserDefaults alloc];
    v21 = [v20 persistentDomainForName:@"com.apple.mobileactivationd"];

    v22 = [v21 objectForKeyedSubscript:@"UseQACertificates"];
    v23 = isNSNumber(v22);

    v106 = v21;
    if (v23)
    {
      v24 = [v21 objectForKeyedSubscript:@"UseQACertificates"];
      v25 = [v24 BOOLValue];

      goto LABEL_18;
    }
  }

  else
  {
    v106 = 0;
  }

  v25 = 0;
LABEL_18:
  v127 = 0;
  v107 = v5;
  v26 = lockcrypto_decode_pems(v5, "CERTIFICATE", &v127);
  v27 = v127;
  v104 = v26;
  v105 = v12;
  if (!v26)
  {
    v33 = createMobileActivationError("verify_ucrt", 3257, @"com.apple.MobileActivation.ErrorDomain", -1, v27, @"Failed to query certificate(s) from pem data.");
    v32 = 0;
    v117 = 0;
    cf = 0;
    v102 = 0;
    v103 = 0;
    v100 = 0;
    v101 = 0;
    v113 = 0;
    v108 = 0;
    v109 = 0;
    v34 = 0;
    v35 = 0;
LABEL_61:
    v114 = 0;
    v115 = 0;
    v111 = 0;
    v112 = 0;
    v110 = 0;
    v67 = 0;
    v68 = 0;
    goto LABEL_62;
  }

  v97 = v13;
  v28 = [v26 objectAtIndexedSubscript:0];
  v29 = SecCertificateCreateWithData(kCFAllocatorDefault, v28);

  if (!v29)
  {
    v33 = createMobileActivationError("verify_ucrt", 3263, @"com.apple.MobileActivation.ErrorDomain", -1, v27, @"Failed to create certificate from pem data.");
    v32 = 0;
    cf = 0;
    goto LABEL_52;
  }

  cf = v29;
  if ([v26 count] >= 2)
  {
    v30 = [v26 objectAtIndexedSubscript:1];
    v31 = SecCertificateCreateWithData(kCFAllocatorDefault, v30);

    if (v31)
    {
      v117 = v31;
      v32 = 0;
      goto LABEL_28;
    }

    v33 = createMobileActivationError("verify_ucrt", 3274, @"com.apple.MobileActivation.ErrorDomain", -1, v27, @"Failed to create intermediate certificate from pem data.");
    v32 = 0;
LABEL_52:
    v117 = 0;
LABEL_59:
    v103 = 0;
LABEL_60:
    v101 = 0;
    v102 = 0;
    v113 = 0;
    v100 = 0;
    v108 = 0;
    v109 = 0;
    v34 = 0;
    v35 = 0;
    v26 = 0;
    goto LABEL_61;
  }

  v126 = v27;
  v32 = copyRootCertificate(9, v25, &v126);
  v36 = v126;

  if (!v32)
  {
    v33 = createMobileActivationError("verify_ucrt", 3284, @"com.apple.MobileActivation.ErrorDomain", -1, v36, @"Failed to load UCRT intermediate CA certificate.");
    v117 = 0;
LABEL_54:
    v103 = 0;
LABEL_55:
    v101 = 0;
    v102 = 0;
    v113 = 0;
    v114 = 0;
    v100 = 0;
    v108 = 0;
    v109 = 0;
    v34 = 0;
    v35 = 0;
    v26 = 0;
    v115 = 0;
    v111 = 0;
    v112 = 0;
    v110 = 0;
    v67 = 0;
    v68 = 0;
    v27 = v36;
    goto LABEL_62;
  }

  v125 = v36;
  v37 = lockcrypto_cert_from_pem_data(v32, &v125);
  v27 = v125;

  if (!v37)
  {
    v33 = createMobileActivationError("verify_ucrt", 3290, @"com.apple.MobileActivation.ErrorDomain", -1, v27, @"Failed to create certificate from pem data.");
    goto LABEL_52;
  }

  v117 = v37;
LABEL_28:
  v38 = v27;
  v124 = v27;
  v39 = lockcrypto_extract_public_key_size(cf, &v124);
  v27 = v124;

  if (!v39)
  {
    MobileActivationError = createMobileActivationError("verify_ucrt", 3299, @"com.apple.MobileActivation.ErrorDomain", -1, v27, @"Failed to query UCRT public key size.");
LABEL_58:
    v33 = MobileActivationError;
    goto LABEL_59;
  }

  if (v39 == P256_PUBKEY_BYTES_LEN)
  {
    v40 = 7;
    goto LABEL_36;
  }

  if (v39 != P384_PUBKEY_BYTES_LEN)
  {
    MobileActivationError = createMobileActivationError("verify_ucrt", 3308, @"com.apple.MobileActivation.ErrorDomain", -1, 0, @"Invalid key size: %d", v39);
    goto LABEL_58;
  }

  v40 = 8;
LABEL_36:
  v123 = v27;
  v42 = copyRootCertificate(v40, v25, &v123);
  v36 = v123;

  v43 = v32;
  v32 = v42;

  if (!v42)
  {
    v33 = createMobileActivationError("verify_ucrt", 3314, @"com.apple.MobileActivation.ErrorDomain", -1, v36, @"Failed to load UCRT root CA certificate.");
    goto LABEL_54;
  }

  v122 = v36;
  v44 = lockcrypto_cert_from_pem_data(v42, &v122);
  v27 = v122;

  if (!v44)
  {
    MobileActivationError = createMobileActivationError("verify_ucrt", 3320, @"com.apple.MobileActivation.ErrorDomain", -1, v27, @"Failed to create certificate from pem data.");
    goto LABEL_58;
  }

  v121 = v27;
  v103 = v44;
  v45 = evaluateUCRTTrustWithCerts(cf, v117, v44, v19, v12, &v121);
  v36 = v121;

  if ((v45 & 1) == 0)
  {
    v33 = createMobileActivationError("verify_ucrt", 3327, @"com.apple.MobileActivation.ErrorDomain", -1, v36, @"Failed to verify UCRT.");
    goto LABEL_55;
  }

  v120 = v36;
  v46 = lockcrypto_query_certificate_properties(cf, @"1.2.840.113635.100.10.1", &v120);
  v27 = v120;

  if (!v46)
  {
    v33 = createMobileActivationError("verify_ucrt", 3339, @"com.apple.MobileActivation.ErrorDomain", -1, v27, @"Failed to query UCRT device identifiers.");
    goto LABEL_60;
  }

  v116 = v32;
  v47 = [v46 objectForKeyedSubscript:@"srnm"];
  v114 = [v46 objectForKeyedSubscript:@"udid"];
  v112 = [v46 objectForKeyedSubscript:@"meid"];
  v111 = [v46 objectForKeyedSubscript:@"imei"];
  v110 = [v46 objectForKeyedSubscript:@"ime2"];
  v48 = +[GestaltHlpr getSharedInstance];
  v49 = [v48 copyAnswer:@"SerialNumber"];

  v115 = v47;
  v50 = isNSString(v47);
  v101 = v49;
  v102 = v46;
  if (!v50)
  {
    goto LABEL_74;
  }

  v51 = v50;
  v52 = isNSString(v49);
  if (!v52)
  {

    goto LABEL_74;
  }

  v53 = v52;
  v54 = [v49 isEqualToString:v115];

  if ((v54 & 1) == 0)
  {
LABEL_74:
    v33 = createMobileActivationError("verify_ucrt", 3351, @"com.apple.MobileActivation.ErrorDomain", -1, 0, @"Invalid Serial.");
    v113 = 0;
LABEL_75:
    v100 = 0;
    goto LABEL_76;
  }

  v55 = +[GestaltHlpr getSharedInstance];
  v113 = [v55 copyAnswer:@"UniqueDeviceID"];

  v56 = isNSString(v114);
  if (!v56)
  {
    goto LABEL_81;
  }

  v57 = v56;
  v58 = isNSString(v113);
  if (!v58)
  {

    goto LABEL_81;
  }

  v59 = v58;
  v60 = [v113 isEqualToString:v114];

  if ((v60 & 1) == 0)
  {
LABEL_81:
    v33 = createMobileActivationError("verify_ucrt", 3357, @"com.apple.MobileActivation.ErrorDomain", -1, 0, @"Invalid UDID.");
    goto LABEL_75;
  }

  if (((v11 | v97) & 1) == 0)
  {
    v100 = 0;
    v108 = 0;
    v109 = 0;
LABEL_83:
    v34 = 0;
    v35 = 0;
    v26 = 0;
    v67 = 0;
    v68 = 0;
    v70 = 1;
    v33 = v27;
    goto LABEL_84;
  }

  v61 = isNSString(v112);

  if (v61)
  {
    v62 = +[GestaltHlpr getSharedInstance];
    v63 = [v62 copyAnswer:@"MobileEquipmentIdentifier"];

    v64 = isNSString(v63);
    if (!v64 || (v65 = v64, v66 = [v63 isEqualToString:v112], v65, (v66 & 1) == 0))
    {
      v100 = v63;
      v33 = createMobileActivationError("verify_ucrt", 3365, @"com.apple.MobileActivation.ErrorDomain", -1, 0, @"Invalid MEID.");
LABEL_76:
      v109 = 0;
LABEL_77:
      v108 = 0;
LABEL_78:
      v34 = 0;
LABEL_79:
      v35 = 0;
      v26 = 0;
      v67 = 0;
      v68 = 0;
      goto LABEL_62;
    }
  }

  else
  {
    v63 = 0;
  }

  v75 = isNSString(v111);

  v100 = v63;
  if (v75)
  {
    v76 = +[GestaltHlpr getSharedInstance];
    v77 = [v76 copyAnswer:@"InternationalMobileEquipmentIdentity"];

    v109 = v77;
    v78 = isNSString(v77);
    if (!v78 || (v79 = v78, v80 = [v77 isEqualToString:v111], v79, (v80 & 1) == 0))
    {
      v33 = createMobileActivationError("verify_ucrt", 3373, @"com.apple.MobileActivation.ErrorDomain", -1, 0, @"Invalid IMEI.");
      goto LABEL_77;
    }
  }

  else
  {
    v109 = 0;
  }

  v81 = isNSString(v110);

  if (v81)
  {
    v82 = +[GestaltHlpr getSharedInstance];
    v83 = [v82 copyAnswer:@"xRyzf9zFE/ycr/wJPweZvQ"];

    v108 = v83;
    v84 = isNSString(v83);
    if (!v84 || (v85 = v84, v86 = [v83 isEqualToString:v110], v85, (v86 & 1) == 0))
    {
      v33 = createMobileActivationError("verify_ucrt", 3381, @"com.apple.MobileActivation.ErrorDomain", -1, 0, @"Invalid IMEI2.");
      goto LABEL_78;
    }
  }

  else
  {
    v108 = 0;
  }

  if (!v97)
  {
    goto LABEL_83;
  }

  v119 = v27;
  v34 = lockcrypto_query_certificate_properties(cf, @"1.2.840.113635.100.8.7", &v119);
  v98 = v119;

  if (!v34)
  {
    v27 = v98;
    v33 = createMobileActivationError("verify_ucrt", 3392, @"com.apple.MobileActivation.ErrorDomain", -1, v98, @"Failed to query UCRT device OS information.");
    goto LABEL_79;
  }

  v67 = [v34 objectForKeyedSubscript:@"1400"];
  v68 = [v34 objectForKeyedSubscript:@"1403"];
  v87 = isNSString(v67);

  if (!v87)
  {
    v35 = 0;
LABEL_104:
    v92 = isNSString(v68);

    if (v92)
    {
      v93 = +[GestaltHlpr getSharedInstance];
      v26 = [v93 copyAnswer:@"BuildVersion"];

      v94 = isNSString(v26);
      if (!v94 || (v95 = v94, v96 = [v26 isEqualToString:v68], v95, (v96 & 1) == 0))
      {
        v33 = createMobileActivationError("verify_ucrt", 3410, @"com.apple.MobileActivation.ErrorDomain", -1, 0, @"Invalid BuildVersion.");
        goto LABEL_108;
      }
    }

    else
    {
      v26 = 0;
    }

    v70 = 1;
    v33 = v98;
LABEL_84:
    v72 = v106;
    v71 = v107;
    v73 = cf;
LABEL_65:
    CFRelease(v73);
    goto LABEL_66;
  }

  v88 = +[GestaltHlpr getSharedInstance];
  v35 = [v88 copyAnswer:@"ProductVersion"];

  v89 = isNSString(v35);
  if (v89)
  {
    v90 = v89;
    v91 = [v35 isEqualToString:v67];

    if (v91)
    {
      goto LABEL_104;
    }
  }

  v33 = createMobileActivationError("verify_ucrt", 3402, @"com.apple.MobileActivation.ErrorDomain", -1, 0, @"Invalid ProductVersion.");
  v26 = 0;
LABEL_108:
  v27 = v98;
LABEL_62:
  v116 = v32;

  if (v99)
  {
    v69 = v33;
    *v99 = v33;
  }

  v70 = 0;
  v72 = v106;
  v71 = v107;
  v73 = cf;
  if (cf)
  {
    goto LABEL_65;
  }

LABEL_66:
  if (v117)
  {
    CFRelease(v117);
  }

  if (v103)
  {
    CFRelease(v103);
  }

  return v70;
}

SecCertificateRef copyUCRT(void *a1, NSError **a2)
{
  v3 = data_ark_copy(a1, 0, @"ActivationState");
  v4 = isNSString(v3);

  if (!v4)
  {
    v4 = @"Unactivated";
  }

  if (([(__CFString *)v4 isEqualToString:@"Activated"]& 1) == 0)
  {
    v12 = createMobileActivationError("copyUCRT", 1043, @"com.apple.MobileActivation.ErrorDomain", -8, 0, @"Device is not activated (%@).", v4);
    v10 = 0;
    v6 = 0;
    goto LABEL_14;
  }

  v5 = copy_ucrt_path();
  v6 = [v5 stringByAppendingPathComponent:@"ucrt.pem"];

  if (!v6)
  {
    MobileActivationError = createMobileActivationError("copyUCRT", 1049, @"com.apple.MobileActivation.ErrorDomain", -1, 0, @"Failed to create UCRT file path.");
LABEL_13:
    v12 = MobileActivationError;
    v10 = 0;
    goto LABEL_14;
  }

  v7 = +[NSFileManager defaultManager];
  v8 = [(NSFileManager *)v7 fileExistsAtPath:v6];

  if ((v8 & 1) == 0)
  {
    MobileActivationError = createMobileActivationError("copyUCRT", 1054, @"com.apple.MobileActivation.ErrorDomain", -4, 0, @"UCRT is unavailable.");
    goto LABEL_13;
  }

  v9 = [[NSData alloc] initWithContentsOfFile:v6];
  v10 = v9;
  if (!v9)
  {
    v12 = createMobileActivationError("copyUCRT", 1060, @"com.apple.MobileActivation.ErrorDomain", -1, 0, @"Failed to encode UCRT.");
LABEL_14:
    v11 = 0;
    if (!a2)
    {
LABEL_19:
      v14 = 0;
      goto LABEL_20;
    }

    goto LABEL_15;
  }

  v20 = 0;
  v11 = lockcrypto_decode_pems(v9, "CERTIFICATE", &v20);
  v12 = v20;
  if (!v11)
  {
    v15 = createMobileActivationError("copyUCRT", 1066, @"com.apple.MobileActivation.ErrorDomain", -1, v12, @"Failed to query certificate(s) from pem data.");
LABEL_18:
    v18 = v15;

    v12 = v18;
    if (!a2)
    {
      goto LABEL_19;
    }

LABEL_15:
    v17 = v12;
    v14 = 0;
    *a2 = v12;
    goto LABEL_20;
  }

  v13 = [v11 objectAtIndexedSubscript:0];
  v14 = SecCertificateCreateWithData(kCFAllocatorDefault, v13);

  if (!v14)
  {
    v15 = createMobileActivationError("copyUCRT", 1072, @"com.apple.MobileActivation.ErrorDomain", -1, 0, @"Failed to create certificate from pem data.");
    goto LABEL_18;
  }

LABEL_20:

  return v14;
}

NSDictionary *create_ucrt_info(void *a1, void *a2, NSError **a3)
{
  v4 = a1;
  v5 = a2;
  error = 0;
  v46 = v5;
  v47 = v4;
  if (!v4)
  {
    v9 = createMobileActivationError("create_ucrt_info", 1126, @"com.apple.MobileActivation.ErrorDomain", -2, 0, @"Invalid input.");
    v44 = 0;
    goto LABEL_7;
  }

  v6 = v5;
  if (v5)
  {
    v7 = [v5 objectForKeyedSubscript:@"UseCommittedUIK"];
    v8 = v7;
    if (v7)
    {
      v4 = isNSNumber(v7);

      if (!v4)
      {
        v44 = v8;
        v9 = createMobileActivationError("create_ucrt_info", 1141, @"com.apple.MobileActivation.ErrorDomain", -2, 0, @"Invalid option (%@).", @"UseCommittedUIK");
LABEL_7:
        v10 = 0;
        v11 = 0;
        ReferenceKeyBlob = 0;
        v45 = 0;
        v13 = 0;
        v14 = 0;
        v15 = 0;
        v16 = 0;
        v17 = 0;
        goto LABEL_28;
      }
    }
  }

  else
  {
    v8 = 0;
  }

  v18 = +[GestaltHlpr getSharedInstance];
  v19 = [v18 copyAnswer:@"HasPKA"];

  v17 = isNSNumber(v19);
  v44 = v8;
  v45 = v19;
  if (!v17)
  {
    v9 = createMobileActivationError("create_ucrt_info", 1148, @"com.apple.MobileActivation.ErrorDomain", -1, 0, @"Failed to retrieve PKA state.");
    v10 = 0;
    v11 = 0;
    ReferenceKeyBlob = 0;
    v13 = 0;
    v14 = 0;
    v15 = 0;
    v16 = 0;
LABEL_27:
    v4 = 0;
    goto LABEL_28;
  }

  if ([v8 BOOLValue])
  {
    v20 = 2;
  }

  else
  {
    v20 = 3;
  }

  v56 = 0;
  v10 = security_copy_system_key(v20, 0, &v56);
  v21 = v56;
  if (!v10)
  {
    v9 = createMobileActivationError("create_ucrt_info", 1157, @"com.apple.MobileActivation.ErrorDomain", -1, v21, @"Failed to copy UIK.");

LABEL_26:
    v11 = 0;
    ReferenceKeyBlob = 0;
    v13 = 0;
    v14 = 0;
    v15 = 0;
    v16 = 0;
    v17 = 0;
    goto LABEL_27;
  }

  v22 = SecAccessControlCreateWithFlags(0, kSecAttrAccessibleAlwaysThisDeviceOnlyPrivate, 0x40000000uLL, &error);
  if (!v22)
  {
    v9 = createMobileActivationError("create_ucrt_info", 1166, @"com.apple.MobileActivation.ErrorDomain", -1, error, @"Failed to create access control.");

    CFRelease(v10);
    v10 = 0;
    goto LABEL_26;
  }

  v23 = v22;
  v55 = v21;
  ReferenceKeyBlob = createReferenceKeyBlob(v22, [v19 BOOLValue], 0, &v55);
  v24 = v55;

  cf = v23;
  v42 = v10;
  v43 = ReferenceKeyBlob;
  if (!ReferenceKeyBlob)
  {
    v9 = createMobileActivationError("create_ucrt_info", 1172, @"com.apple.MobileActivation.ErrorDomain", -1, v24, @"Failed to create ref key.");
    v37 = v24;
LABEL_36:

    v4 = 0;
    v17 = 0;
    v16 = 0;
    v15 = 0;
    v14 = 0;
LABEL_40:
    v13 = 0;
    goto LABEL_41;
  }

  v54 = v24;
  ReferenceKeyBlob = security_create_attestation(ReferenceKeyBlob, v10, &v54);
  v25 = v54;

  if (!ReferenceKeyBlob)
  {
    v9 = createMobileActivationError("create_ucrt_info", 1180, @"com.apple.MobileActivation.ErrorDomain", -11, v25, @"Failed to attest ref key to UIK.");
    v37 = v25;
    goto LABEL_36;
  }

  v53 = v25;
  v14 = copy_uik_certificate_info(v6, &v53);
  v26 = v53;

  if (!v14)
  {
    v9 = createMobileActivationError("create_ucrt_info", 1215, @"com.apple.MobileActivation.ErrorDomain", -1, v26, @"Failed to copy UIK certification info.");

    v4 = 0;
    v17 = 0;
    v16 = 0;
LABEL_39:
    v15 = 0;
    goto LABEL_40;
  }

  v52 = v26;
  v16 = copy_device_id_info(v27, &v52);
  v28 = v52;

  if (!v16)
  {
    v9 = createMobileActivationError("create_ucrt_info", 1223, @"com.apple.MobileActivation.ErrorDomain", -1, v28, @"Failed to copy device id info.");

    v4 = 0;
    v17 = 0;
    goto LABEL_39;
  }

  v51 = v28;
  v15 = copy_device_info(v29, &v51);
  v30 = v51;

  if (!v15)
  {
    v9 = createMobileActivationError("create_ucrt_info", 1231, @"com.apple.MobileActivation.ErrorDomain", -1, v30, @"Failed to copy device info.");

    v4 = 0;
    v17 = 0;
    goto LABEL_40;
  }

  v31 = is_product_cellular();
  if (v31)
  {
    v50 = v30;
    v13 = copy_baseband_request_info(v31, v32, &v50);
    v33 = v50;

    if (v13)
    {
      v30 = v33;
      goto LABEL_46;
    }

    v9 = createMobileActivationError("create_ucrt_info", 1242, @"com.apple.MobileActivation.ErrorDomain", -1, v33, @"Failed to copy baseband request info.");

    v4 = 0;
    v17 = 0;
LABEL_41:
    v11 = 0;
    v10 = 0;
    goto LABEL_42;
  }

  v13 = 0;
LABEL_46:
  v60[0] = @"DeviceID";
  v60[1] = @"DeviceInfo";
  v61[0] = v16;
  v61[1] = v15;
  v60[2] = @"UIKCertification";
  v61[2] = v14;
  v38 = [NSDictionary dictionaryWithObjects:v61 forKeys:v60 count:3];
  v17 = [NSMutableDictionary dictionaryWithDictionary:v38];

  if (v13)
  {
    [(NSMutableDictionary *)v17 setObject:v13 forKeyedSubscript:@"BasebandRequestInfo"];
  }

  v49 = 0;
  v10 = [NSPropertyListSerialization dataWithPropertyList:v17 format:100 options:0 error:&v49];
  v9 = v49;

  if (v10)
  {
    v39 = SecKeyCreateSignature(v43, kSecKeyAlgorithmECDSASignatureMessageX962SHA256, v10, &error);
    v11 = v39;
    if (v39)
    {
      v58[0] = @"ActivationInfoXML";
      v58[1] = @"RKCertification";
      v59[0] = v10;
      v59[1] = ReferenceKeyBlob;
      v58[2] = @"RKSignature";
      v59[2] = v39;
      v4 = [NSDictionary dictionaryWithObjects:v59 forKeys:v58 count:3];
      goto LABEL_42;
    }

    v40 = createMobileActivationError("create_ucrt_info", 1283, @"com.apple.MobileActivation.ErrorDomain", -1, error, @"Failed to sign activation data with ref key.");

    v4 = 0;
  }

  else
  {
    v40 = createMobileActivationError("create_ucrt_info", 1274, @"com.apple.MobileActivation.ErrorDomain", -1, v9, @"Could not convert dictionary to xml data.");

    v4 = 0;
    v11 = 0;
  }

  v9 = v40;
LABEL_42:
  CFRelease(cf);
  CFRelease(v42);
  if (v43)
  {
    CFRelease(v43);
  }

LABEL_28:
  if (error)
  {
    CFRelease(error);
  }

  error = 0;
  if (a3 && !v4)
  {
    v34 = v9;
    *a3 = v9;
  }

  v35 = v4;

  return v4;
}

__SecKey *copy_uik_certificate_info(void *a1, NSError **a2)
{
  v3 = a1;
  v4 = v3;
  if (!v3)
  {
    v6 = 0;
LABEL_6:
    if ([v6 BOOLValue])
    {
      v14 = 2;
    }

    else
    {
      v14 = 3;
    }

    v35 = 0;
    v11 = security_copy_system_key(v14, 0, &v35);
    v15 = v35;
    v16 = v15;
    if (!v11)
    {
      v8 = createMobileActivationError("copy_uik_certificate_info", 2822, @"com.apple.MobileActivation.ErrorDomain", -1, v15, @"Failed to copy UIK.");

      v9 = 0;
      v33 = 0;
      v10 = 0;
      v12 = 0;
      v13 = 0;
      v7 = 0;
      goto LABEL_23;
    }

    v31 = a2;
    v34 = v15;
    v7 = security_create_system_key_attestation(v11, 0, 0, &v34);
    v8 = v34;

    v32 = v7;
    if (v7)
    {
      v17 = +[GestaltHlpr getSharedInstance];
      v18 = [v17 copyAnswer:@"BluetoothAddress"];

      v33 = v18;
      v12 = isNSString(v18);

      if (v12)
      {
        v19 = +[GestaltHlpr getSharedInstance];
        v9 = [v19 copyAnswer:@"WifiAddress"];

        v12 = isNSString(v9);
        if (v12)
        {
          v20 = +[GestaltHlpr getSharedInstance];
          v10 = [v20 copyAnswer:@"EthernetMacAddress"];

          v21 = isNSString(v10);
          if (v21 || !v10 && (device_supports_missing_emac() & 1) != 0)
          {
            v22 = +[GestaltHlpr getSharedInstance];
            v13 = [v22 copyAnswer:@"BoardId"];

            v12 = isNSNumber(v13);
            if (v12)
            {
              v23 = +[GestaltHlpr getSharedInstance];
              v12 = [v23 copyAnswer:@"ChipID"];

              v24 = isNSNumber(v12);
              if (v24)
              {
                v36[0] = @"UIKCertification";
                v36[1] = @"BluetoothAddress";
                v37[0] = v7;
                v37[1] = v33;
                v36[2] = @"WifiAddress";
                v36[3] = @"BoardId";
                v37[2] = v9;
                v37[3] = v13;
                v36[4] = @"ChipID";
                v37[4] = v12;
                v25 = [NSDictionary dictionaryWithObjects:v37 forKeys:v36 count:5];
                v7 = [(NSDictionary *)v25 mutableCopy];

                [(__SecKey *)v7 setObject:v10 forKeyedSubscript:@"EthernetMacAddress"];
LABEL_22:
                CFRelease(v11);
                a2 = v31;
                v11 = v32;
                goto LABEL_23;
              }

              MobileActivationError = createMobileActivationError("copy_uik_certificate_info", 2881, @"com.apple.MobileActivation.ErrorDomain", -1, 0, @"Failed to retrieve chip id.");
            }

            else
            {
              MobileActivationError = createMobileActivationError("copy_uik_certificate_info", 2875, @"com.apple.MobileActivation.ErrorDomain", -1, 0, @"Failed to retrieve board id.");
            }

            v26 = MobileActivationError;

            v7 = 0;
          }

          else
          {
            v26 = createMobileActivationError("copy_uik_certificate_info", 2867, @"com.apple.MobileActivation.ErrorDomain", -1, 0, @"Failed to retrieve ethernet mac address.");

            v7 = 0;
            v13 = 0;
            v12 = 0;
          }
        }

        else
        {
          v26 = createMobileActivationError("copy_uik_certificate_info", 2854, @"com.apple.MobileActivation.ErrorDomain", -1, 0, @"Failed to retrieve WiFi address.");

          v7 = 0;
          v13 = 0;
          v10 = 0;
        }

LABEL_21:
        v8 = v26;
        goto LABEL_22;
      }

      v26 = createMobileActivationError("copy_uik_certificate_info", 2848, @"com.apple.MobileActivation.ErrorDomain", -1, 0, @"Failed to retrieve bluetooth address.");

      v7 = 0;
      v13 = 0;
      v10 = 0;
    }

    else
    {
      v26 = createMobileActivationError("copy_uik_certificate_info", 2830, @"com.apple.MobileActivation.ErrorDomain", -11, v8, @"Failed to attest UIK to SIK.");

      v13 = 0;
      v12 = 0;
      v10 = 0;
      v33 = 0;
    }

    v9 = 0;
    goto LABEL_21;
  }

  v5 = [v3 objectForKeyedSubscript:@"UseCommittedUIK"];
  v6 = v5;
  if (!v5)
  {
    goto LABEL_6;
  }

  v7 = isNSNumber(v5);

  if (v7)
  {
    goto LABEL_6;
  }

  v8 = createMobileActivationError("copy_uik_certificate_info", 2812, @"com.apple.MobileActivation.ErrorDomain", -2, 0, @"Invalid option (%@).", @"UseCommittedUIK");
  v9 = 0;
  v33 = 0;
  v10 = 0;
  v11 = 0;
  v12 = 0;
  v13 = 0;
LABEL_23:
  if (a2 && !v7)
  {
    v27 = v8;
    *a2 = v8;
  }

  v28 = v7;

  return v7;
}

id copy_device_id_info(uint64_t a1, NSError **a2)
{
  v3 = +[GestaltHlpr getSharedInstance];
  v10 = 0;
  v4 = [v3 copyDeviceIDInfo:&v10];
  v5 = v10;

  if (v4)
  {
    v6 = v5 == 0;
  }

  else
  {
    v6 = 0;
  }

  if (v6)
  {
    v8 = v4;
    v7 = 0;
  }

  else
  {
    v7 = createMobileActivationError("copy_device_id_info", 2744, @"com.apple.MobileActivation.ErrorDomain", -1, 0, @"Failed to copy device ID info: %@", v5);
    if (a2)
    {
      v7 = v7;
      v8 = 0;
      *a2 = v7;
    }

    else
    {
      v8 = 0;
    }
  }

  return v8;
}

id copy_device_info(uint64_t a1, NSError **a2)
{
  v3 = +[GestaltHlpr getSharedInstance];
  v10 = 0;
  v4 = [v3 copyDeviceInfo:&v10];
  v5 = v10;

  if (v4)
  {
    v6 = v5 == 0;
  }

  else
  {
    v6 = 0;
  }

  if (v6)
  {
    v8 = v4;
    v7 = 0;
  }

  else
  {
    v7 = createMobileActivationError("copy_device_info", 2769, @"com.apple.MobileActivation.ErrorDomain", -1, 0, @"Failed to copy device info: %@", v5);
    if (a2)
    {
      v7 = v7;
      v8 = 0;
      *a2 = v7;
    }

    else
    {
      v8 = 0;
    }
  }

  return v8;
}

void *copy_baseband_request_info(uint64_t a1, uint64_t a2, NSError **a3)
{
  if (!is_product_cellular())
  {
    v8 = createMobileActivationError("copy_baseband_request_info", 2075, @"com.apple.MobileActivation.ErrorDomain", -3, 0, @"BasebandInfo does not exist for non cellular devices.");
    v4 = 0;
    goto LABEL_11;
  }

  v4 = objc_alloc_init(NSMutableDictionary);
  if (!v4)
  {
    v8 = createMobileActivationError("copy_baseband_request_info", 2081, @"com.apple.MobileActivation.ErrorDomain", -1, 0, @"Failed to create BasebandRequestInfo dictionary.");
LABEL_11:
    v6 = 0;
    v7 = 0;
    v9 = 0;
    v10 = 0;
    v11 = 0;
    v5 = 0;
    if (!a3)
    {
      goto LABEL_30;
    }

    goto LABEL_22;
  }

  v5 = +[MATelephonyInfo sharedInstance];
  if (!v5)
  {
    v8 = createMobileActivationError("copy_baseband_request_info", 2087, @"com.apple.MobileActivation.ErrorDomain", -1, 0, @"Failed to copy telephony instance.");
    v6 = 0;
    v7 = 0;
    v9 = 0;
LABEL_20:
    v10 = 0;
    goto LABEL_21;
  }

  [v4 setObject:&__kCFBooleanTrue forKeyedSubscript:@"ActivationRequiresActivationTicket"];
  [v4 setObject:&__kCFBooleanTrue forKeyedSubscript:@"SupportsPostponement"];
  v6 = [(MATelephonyInfo *)v5 copyPhoneNumberWithSlotID:1 error:0];
  if (v6)
  {
    [v4 setObject:v6 forKeyedSubscript:@"PhoneNumber"];
  }

  if ([(MATelephonyInfo *)v5 dualSIMCapable])
  {
    v7 = [(MATelephonyInfo *)v5 copyPhoneNumberWithSlotID:2 error:0];
    if (v7)
    {
      [v4 setObject:v7 forKeyedSubscript:@"PhoneNumber2"];
    }
  }

  else
  {
    v7 = 0;
  }

  v23 = 0;
  v9 = [(MATelephonyInfo *)v5 copySIMStatusWithSlotID:1 error:&v23];
  v12 = v23;
  if (!v9)
  {
    v8 = createMobileActivationError("copy_baseband_request_info", 2111, @"com.apple.MobileActivation.ErrorDomain", -1, v12, @"Failed to retrieve SIM status.");

    goto LABEL_20;
  }

  if ([(MATelephonyInfo *)v5 dualSIMCapable])
  {
    v22 = v12;
    v10 = [(MATelephonyInfo *)v5 copySIMStatusWithSlotID:2 error:&v22];
    v13 = v22;

    if (v10)
    {
      v12 = v13;
      goto LABEL_24;
    }

    v8 = createMobileActivationError("copy_baseband_request_info", 2118, @"com.apple.MobileActivation.ErrorDomain", -1, v13, @"Failed to retrieve SIM status.");

LABEL_21:
    v11 = 0;
    if (!a3)
    {
      goto LABEL_30;
    }

    goto LABEL_22;
  }

  v10 = 0;
LABEL_24:
  v21 = v12;
  v11 = copy_postponement_info(&v21);
  v8 = v21;

  if (v11)
  {
    v16 = [v11 objectForKey:@"InternationalMobileEquipmentIdentity"];

    if (v16)
    {
      [v11 setObject:v9 forKeyedSubscript:@"SIMStatus"];
      [v11 setObject:v10 forKeyedSubscript:@"SIMStatus2"];
      [v11 removeObjectForKey:kCTPostponementStatus];
      [v11 removeObjectForKey:kCTPostponementStatusErrorReason];
      [v11 removeObjectForKey:kCTPostponementInfoUniqueID];
      [v4 addEntriesFromDictionary:v11];
      v4 = v4;
      v15 = v4;
      goto LABEL_31;
    }

    MobileActivationError = createMobileActivationError("copy_baseband_request_info", 2130, @"com.apple.MobileActivation.ErrorDomain", -1, 0, @"Postponement info is missing required identifiers (%@ / %@) : %@", v9, v10, @"InternationalMobileEquipmentIdentity");
  }

  else
  {
    MobileActivationError = createMobileActivationError("copy_baseband_request_info", 2125, @"com.apple.MobileActivation.ErrorDomain", -1, v8, @"Failed to retrieve postponement info (%@ / %@).", v9, v10);
  }

  v18 = MobileActivationError;

  v8 = v18;
  if (!a3)
  {
LABEL_30:
    v15 = 0;
    goto LABEL_31;
  }

LABEL_22:
  v14 = v8;
  v15 = 0;
  *a3 = v8;
LABEL_31:
  v19 = v15;

  return v15;
}

id copyUCRTVersionInformation(void *a1, NSError **a2)
{
  v3 = a1;
  v4 = v3;
  if (!v3)
  {
    v14 = createMobileActivationError("copyUCRTVersionInformation", 1365, @"com.apple.MobileActivation.ErrorDomain", -1, 0, @"Invalid input.");
    v15 = 0;
    v5 = 0;
    goto LABEL_14;
  }

  v22 = 0;
  v5 = copyUCRT(v3, &v22);
  v6 = v22;
  if (!v5)
  {
    v14 = createMobileActivationError("copyUCRTVersionInformation", 1371, @"com.apple.MobileActivation.ErrorDomain", -1, v6, @"Failed to copy UCRT.");

    v15 = 0;
    goto LABEL_14;
  }

  v23 = 0;
  v7 = lockcrypto_query_certificate_properties(v5, @"1.2.840.113635.100.8.7", &v23);
  v8 = v23;
  v21 = a2;
  if (!v7)
  {
    v16 = createAndLogError("copy_ucrt_version_info", 123, @"com.apple.MobileActivation.ErrorDomain", -1, v8, @"Failed to query UCRT device OS information.");

    v10 = 0;
    v9 = 0;
    v8 = v16;
    goto LABEL_9;
  }

  v9 = [v7 objectForKeyedSubscript:@"1400"];
  v10 = [v7 objectForKeyedSubscript:@"1403"];
  v11 = objc_alloc_init(NSMutableDictionary);
  [v11 setObject:v9 forKeyedSubscript:@"ProductVersion"];
  [v11 setObject:v10 forKeyedSubscript:@"BuildVersion"];
  if (!v11)
  {
LABEL_9:
    v17 = v8;
    v11 = 0;
    v12 = 1;
    v13 = v8;
    goto LABEL_10;
  }

  v12 = 0;
  v13 = v6;
LABEL_10:

  v14 = v13;
  if (v12)
  {
    v18 = createMobileActivationError("copyUCRTVersionInformation", 1377, @"com.apple.MobileActivation.ErrorDomain", -1, v14, @"Failed to copy UCRT version info.");

    v15 = 0;
    v14 = v18;
  }

  else
  {
    v15 = v11;
  }

  a2 = v21;
LABEL_14:
  if (a2 && !v15)
  {
    v19 = v14;
    *a2 = v14;
  }

  if (v5)
  {
    CFRelease(v5);
  }

  return v15;
}

char *create_cert_request(void *a1, void *a2)
{
  v3 = a1;
  v36 = 0;
  v37 = &v36;
  v38 = 0x3032000000;
  v39 = __Block_byref_object_copy_;
  v40 = __Block_byref_object_dispose_;
  v41 = 0;
  v30 = 0;
  v31 = &v30;
  v32 = 0x3032000000;
  v33 = __Block_byref_object_copy_;
  v34 = __Block_byref_object_dispose_;
  v35 = 0;
  v24 = 0;
  v25 = &v24;
  v26 = 0x3032000000;
  v27 = __Block_byref_object_copy_;
  v28 = __Block_byref_object_dispose_;
  v29 = 0;
  if (create_cert_request_onceToken != -1)
  {
    create_cert_request_cold_1();
  }

  v4 = create_cert_request_queue;
  if (!create_cert_request_queue)
  {
    MobileActivationError = createMobileActivationError("create_cert_request", 1871, @"com.apple.MobileActivation.ErrorDomain", -1, 0, @"Failed to create queue.");
LABEL_7:
    v7 = MobileActivationError;
    v5 = 0;
LABEL_8:
    v8 = v37[5];
    v37[5] = v7;

    goto LABEL_9;
  }

  block[0] = _NSConcreteStackBlock;
  block[1] = 3254779904;
  block[2] = __create_cert_request_block_invoke_2;
  block[3] = &__block_descriptor_64_e8_32s40r48r56r_e5_v8__0l;
  v21 = &v30;
  v20 = v3;
  v22 = &v24;
  v23 = &v36;
  dispatch_sync(v4, block);

  if (v37[5])
  {
    v5 = 0;
LABEL_9:
    v9 = 0;
    goto LABEL_10;
  }

  v12 = +[NSUUID UUID];
  v5 = v12;
  if (!v12)
  {
    MobileActivationError = createMobileActivationError("create_cert_request", 1911, @"com.apple.MobileActivation.ErrorDomain", -1, 0, @"Failed to create UUID.");
    goto LABEL_7;
  }

  v13 = [(NSUUID *)v12 UUIDString];
  v9 = v13;
  if (!v13)
  {
    v7 = createMobileActivationError("create_cert_request", 1917, @"com.apple.MobileActivation.ErrorDomain", -1, 0, @"Failed to create UUID string.");
    goto LABEL_8;
  }

  v14 = v31[5];
  v15 = v25[5];
  v16 = v37;
  obj = v37[5];
  v10 = lockcrypto_create_cert_request(v13, v14, v15, &obj);
  objc_storeStrong(v16 + 5, obj);
  if (v10)
  {
    goto LABEL_12;
  }

  v17 = createMobileActivationError("create_cert_request", 1923, @"com.apple.MobileActivation.ErrorDomain", -1, v37[5], @"Failed to create cert request.");
LABEL_10:
  v10 = 0;
  if (a2)
  {
    *a2 = v37[5];
  }

LABEL_12:
  _Block_object_dispose(&v24, 8);

  _Block_object_dispose(&v30, 8);
  _Block_object_dispose(&v36, 8);

  return v10;
}

void sub_1002E78E4(_Unwind_Exception *a1, uint64_t a2, uint64_t a3, uint64_t a4, uint64_t a5, uint64_t a6, uint64_t a7, uint64_t a8, uint64_t a9, uint64_t a10, uint64_t a11, ...)
{
  va_start(va1, a11);
  va_start(va, a11);
  v13 = va_arg(va1, void);
  v15 = va_arg(va1, void);
  v16 = va_arg(va1, void);
  v17 = va_arg(va1, void);
  v18 = va_arg(va1, void);
  v19 = va_arg(va1, void);
  _Block_object_dispose(va, 8);
  _Block_object_dispose(va1, 8);
  _Block_object_dispose((v11 - 112), 8);
  _Unwind_Resume(a1);
}

void __create_cert_request_block_invoke(id a1)
{
  v1 = dispatch_queue_attr_make_with_autorelease_frequency(0, DISPATCH_AUTORELEASE_FREQUENCY_WORK_ITEM);
  v2 = dispatch_queue_create("com.apple.mobileactivationd.fairplay", v1);
  v3 = create_cert_request_queue;
  create_cert_request_queue = v2;
}

void __create_cert_request_block_invoke_2(uint64_t a1)
{
  v2 = data_ark_copy(*(a1 + 32), 0, @"PublicKey");
  v3 = *(*(a1 + 40) + 8);
  v4 = *(v3 + 40);
  *(v3 + 40) = v2;

  v5 = data_ark_copy(*(a1 + 32), 0, @"PrivateKey");
  v6 = *(*(a1 + 48) + 8);
  v7 = *(v6 + 40);
  *(v6 + 40) = v5;

  v8 = isNSData(*(*(*(a1 + 40) + 8) + 40));
  if (!v8 || (v9 = v8, v10 = isNSData(*(*(*(a1 + 48) + 8) + 40)), v10, v9, !v10))
  {
    v11 = *(*(a1 + 40) + 8);
    v12 = *(v11 + 40);
    *(v11 + 40) = 0;

    v13 = *(*(a1 + 48) + 8);
    v14 = *(v13 + 40);
    *(v13 + 40) = 0;

    v15 = *(*(a1 + 40) + 8);
    v16 = *(v15 + 40);
    v17 = *(*(a1 + 48) + 8);
    v24 = *(v17 + 40);
    obj = v16;
    v18 = *(*(a1 + 56) + 8);
    v23 = *(v18 + 40);
    v19 = lockcrypto_genenerate_keypair(1024, &obj, &v24, &v23);
    objc_storeStrong((v15 + 40), obj);
    objc_storeStrong((v17 + 40), v24);
    objc_storeStrong((v18 + 40), v23);
    if (v19)
    {
      data_ark_set(*(a1 + 32), 0, @"PublicKey", *(*(*(a1 + 40) + 8) + 40), 0);
      data_ark_set(*(a1 + 32), 0, @"PrivateKey", *(*(*(a1 + 48) + 8) + 40), 0);
    }

    else
    {
      v20 = createMobileActivationError("create_cert_request_block_invoke_2", 1885, @"com.apple.MobileActivation.ErrorDomain", -1, *(*(*(a1 + 56) + 8) + 40), @"Failed to generate public/or private key.");
      v21 = *(*(a1 + 56) + 8);
      v22 = *(v21 + 40);
      *(v21 + 40) = v20;
    }
  }
}

void __copy_helper_block_e8_32s40r48r56r(uint64_t a1, uint64_t a2)
{
  v4 = *(a2 + 32);
  _Block_object_assign((a1 + 40), *(a2 + 40), 8);
  _Block_object_assign((a1 + 48), *(a2 + 48), 8);
  v5 = *(a2 + 56);

  _Block_object_assign((a1 + 56), v5, 8);
}

void __destroy_helper_block_e8_32s40r48r56r(uint64_t a1)
{
  _Block_object_dispose(*(a1 + 56), 8);
  _Block_object_dispose(*(a1 + 48), 8);
  _Block_object_dispose(*(a1 + 40), 8);
  v2 = *(a1 + 32);
}

uint64_t deliver_baseband_ticket(int a1, id a2, void *a3, NSError **a4)
{
  v6 = a2;
  v7 = a3;
  v8 = objc_alloc_init(NSMutableDictionary);
  v27 = v7;
  if (!v6 || !v7)
  {
    MobileActivationError = createMobileActivationError("deliver_baseband_ticket", 1950, @"com.apple.MobileActivation.ErrorDomain", -2, 0, @"Invalid input(s).");
LABEL_18:
    v20 = MobileActivationError;
    v9 = 0;
    v17 = 0;
    v12 = 0;
LABEL_19:
    v15 = 0;
    v13 = 0;
    goto LABEL_20;
  }

  if (([v7 isEqualToString:@"Activated"] & 1) == 0 && (objc_msgSend(v7, "isEqualToString:", @"FactoryActivated") & 1) == 0)
  {
    MobileActivationError = createMobileActivationError("deliver_baseband_ticket", 1955, @"com.apple.MobileActivation.ErrorDomain", -8, 0, @"Device is not activated: %@", v7);
    goto LABEL_18;
  }

  v9 = [v6 objectForKeyedSubscript:@"ActivationTicket"];
  v10 = isNSString(v9);

  if (!v10)
  {
    v11 = [v6 objectForKeyedSubscript:@"WildcardTicket"];

    v9 = v11;
  }

  v12 = isNSString(v9);

  if (!v12)
  {
    v20 = createMobileActivationError("deliver_baseband_ticket", 1968, @"com.apple.MobileActivation.ErrorDomain", -1, 0, @"Account token missing activation ticket.");
    v17 = 0;
    goto LABEL_19;
  }

  [v8 setObject:v9 forKeyedSubscript:@"ActivationTicket"];
  [v8 setObject:v7 forKeyedSubscript:@"ActivationState"];
  v13 = [v6 objectForKeyedSubscript:@"PhoneNumberNotificationURL"];
  if (v13)
  {
    [v8 setObject:v13 forKeyedSubscript:@"PhoneNumberNotificationURL"];
  }

  v12 = [v6 objectForKeyedSubscript:@"ActivityURL"];
  v14 = isNSString(v12);

  if (v14)
  {
    [v8 setObject:v12 forKeyedSubscript:@"ActivityURL"];
  }

  v15 = [v6 objectForKeyedSubscript:@"PostponementInfo"];
  v16 = isNSDictionary(v15);

  if (v16)
  {
    [v8 addEntriesFromDictionary:v15];
  }

  v17 = _CTServerConnectionCreate();
  if (v17)
  {
    v18 = _CTServerConnectionSetPostponementTicket();
    if (!HIDWORD(v18))
    {
      v19 = v8;
      v20 = 0;
      v21 = 1;
LABEL_23:
      CFRelease(v17);
      v24 = v21;
      goto LABEL_24;
    }

    v26 = createMobileActivationError("deliver_baseband_ticket", 1998, @"com.apple.MobileActivation.ErrorDomain", -1, 0, @"Failed to issue baseband ticket: %d.%d", v18, HIDWORD(v18));
  }

  else
  {
    v26 = createMobileActivationError("deliver_baseband_ticket", 1992, @"com.apple.MobileActivation.ErrorDomain", -1, 0, @"Failed to connect to CommCenter.");
  }

  v20 = v26;
LABEL_20:
  v19 = v8;
  if (a4)
  {
    v23 = v20;
    *a4 = v20;
  }

  v21 = 0;
  v24 = 0;
  if (v17)
  {
    goto LABEL_23;
  }

LABEL_24:

  return v24;
}

id copy_postponement_info(NSError **a1)
{
  v2 = _CTServerConnectionCreate();
  if (v2)
  {
    v3 = _CTServerConnectionCopyPostponementStatus();
    MobileActivationError = createMobileActivationError("copy_postponement_info", 2032, @"com.apple.MobileActivation.ErrorDomain", -1, 0, @"Failed to copy postponement status: %ld.%ld", v3, v3 >> 32);
  }

  else
  {
    MobileActivationError = createMobileActivationError("copy_postponement_info", 2026, @"com.apple.MobileActivation.ErrorDomain", -1, 0, @"Failed to connect to CommCenter.");
  }

  v5 = MobileActivationError;
  if (a1)
  {
    v6 = v5;
    *a1 = v5;
  }

  if (v2)
  {
    CFRelease(v2);
  }

  return 0;
}

NSDictionary *create_activation_info()
{
  v0 = __chkstk_darwin();
  v68 = v1;
  v3 = v2;
  v4 = v0;
  v5 = v3;
  memset(v88, 0, 256);
  v82 = 256;
  bzero(v87, 0x1000uLL);
  v81 = 4096;
  error = 0;
  v60 = v5;
  v61 = v4;
  if (!v4)
  {
    v9 = createMobileActivationError("create_activation_info", 2189, @"com.apple.MobileActivation.ErrorDomain", -2, 0, @"Invalid input.");
    v10 = 0;
    v11 = 0;
    v12 = 0;
    v66 = 0;
    v67 = 0;
    v63 = 0;
    v64 = 0;
    v65 = 0;
    v13 = 0;
    v14 = 0;
    v15 = 0;
    v16 = 0;
    v58 = 0;
    v59 = 0;
LABEL_28:
    v62 = 0;
    v8 = 0;
    goto LABEL_29;
  }

  if (v5)
  {
    v6 = [v5 objectForKeyedSubscript:@"UseCommittedUIK"];
    v7 = v6;
    if (v6)
    {
      v8 = isNSNumber(v6);

      if (!v8)
      {
        v59 = v7;
        v9 = createMobileActivationError("create_activation_info", 2196, @"com.apple.MobileActivation.ErrorDomain", -2, 0, @"Invalid option (%@).", @"UseCommittedUIK");
        v10 = 0;
        v11 = 0;
        v12 = 0;
        v66 = 0;
        v67 = 0;
        v63 = 0;
        v64 = 0;
        v65 = 0;
        v13 = 0;
        v14 = 0;
        v15 = 0;
        v16 = 0;
        v4 = 0;
        v58 = 0;
        v62 = 0;
        goto LABEL_29;
      }
    }
  }

  else
  {
    v7 = 0;
  }

  v17 = +[GestaltHlpr getSharedInstance];
  v18 = [v17 copyAnswer:@"HasPKA"];

  v19 = isNSNumber(v18);
  v58 = v18;
  v59 = v7;
  if (!v19)
  {
    v9 = createMobileActivationError("create_activation_info", 2203, @"com.apple.MobileActivation.ErrorDomain", -1, 0, @"Failed to retrieve PKA state.");
LABEL_26:
    v10 = 0;
    v11 = 0;
    v12 = 0;
    v66 = 0;
    v67 = 0;
    v63 = 0;
    v65 = 0;
    v13 = 0;
    goto LABEL_27;
  }

  if ([v7 BOOLValue])
  {
    v20 = 2;
  }

  else
  {
    v20 = 3;
  }

  v79 = 0;
  v13 = security_copy_system_key(v20, 0, &v79);
  v21 = v79;
  if (!v13)
  {
    v9 = createMobileActivationError("create_activation_info", 2211, @"com.apple.MobileActivation.ErrorDomain", -1, v21, @"Failed to copy UIK.");

    v10 = 0;
    v11 = 0;
    v12 = 0;
    v66 = 0;
    v67 = 0;
    v63 = 0;
    v65 = 0;
LABEL_27:
    v14 = 0;
    v15 = 0;
    v64 = 0;
    v16 = 0;
    v4 = 0;
    goto LABEL_28;
  }

  v22 = SecAccessControlCreateWithFlags(0, kSecAttrAccessibleAlwaysThisDeviceOnlyPrivate, 0x40000000uLL, &error);
  if (!v22)
  {
    v9 = createMobileActivationError("create_activation_info", 2220, @"com.apple.MobileActivation.ErrorDomain", -1, error, @"Failed to create access control.");

    CFRelease(v13);
    goto LABEL_26;
  }

  v78 = v21;
  cf = v22;
  ReferenceKeyBlob = createReferenceKeyBlob(v22, [v18 BOOLValue], 0, &v78);
  v24 = v78;

  v56 = v13;
  v57 = ReferenceKeyBlob;
  if (!ReferenceKeyBlob)
  {
    v9 = createMobileActivationError("create_activation_info", 2226, @"com.apple.MobileActivation.ErrorDomain", -1, v24, @"Failed to create ref key.");
    v39 = v24;
LABEL_37:

    v10 = 0;
    v11 = 0;
    v12 = 0;
    v66 = 0;
    v67 = 0;
    v63 = 0;
    v64 = 0;
    v65 = 0;
    v13 = 0;
    v14 = 0;
    v15 = 0;
    v16 = 0;
    v4 = 0;
    v62 = 0;
LABEL_47:
    v8 = 0;
    goto LABEL_48;
  }

  v77 = v24;
  v25 = security_create_attestation(ReferenceKeyBlob, v13, &v77);
  v26 = v77;

  if (!v25)
  {
    v9 = createMobileActivationError("create_activation_info", 2234, @"com.apple.MobileActivation.ErrorDomain", -11, v26, @"Failed to attest ref key to UIK.");
    v39 = v26;
    goto LABEL_37;
  }

  v76 = v26;
  v15 = copy_uik_certificate_info(v5, &v76);
  v27 = v76;

  v62 = v25;
  if (!v15)
  {
    v9 = createMobileActivationError("create_activation_info", 2242, @"com.apple.MobileActivation.ErrorDomain", -1, v27, @"Failed to copy UIK certification info.");

    v10 = 0;
    v11 = 0;
    v12 = 0;
    v66 = 0;
    v67 = 0;
    v63 = 0;
    v64 = 0;
    v65 = 0;
    v13 = 0;
    v14 = 0;
LABEL_46:
    v16 = 0;
    v4 = 0;
    goto LABEL_47;
  }

  v75 = v27;
  v11 = copy_device_id_info(v28, &v75);
  v29 = v75;

  v64 = v15;
  if (!v11)
  {
    v9 = createMobileActivationError("create_activation_info", 2250, @"com.apple.MobileActivation.ErrorDomain", -1, v29, @"Failed to copy device id info.");

    v10 = 0;
    v12 = 0;
    v67 = 0;
    v63 = 0;
LABEL_42:
    v66 = 0;
    goto LABEL_43;
  }

  v74 = v29;
  v14 = copy_device_info(v30, &v74);
  v31 = v74;

  v67 = v11;
  if (!v14)
  {
    v9 = createMobileActivationError("create_activation_info", 2258, @"com.apple.MobileActivation.ErrorDomain", -1, v31, @"Failed to copy device info.");

    v10 = 0;
    v11 = 0;
    v12 = 0;
    v63 = 0;
    v65 = 0;
    v66 = 0;
    v13 = 0;
LABEL_45:
    v15 = 0;
    goto LABEL_46;
  }

  v73 = v31;
  v11 = copy_activation_request_info(v4, v5, &v73);
  v32 = v73;

  v66 = v11;
  v63 = v14;
  if (!v11)
  {
    v9 = createMobileActivationError("create_activation_info", 2266, @"com.apple.MobileActivation.ErrorDomain", -1, v32, @"Failed to copy activation request info.");

    v10 = 0;
    v12 = 0;
    goto LABEL_42;
  }

  v33 = is_product_cellular();
  if (v33)
  {
    v72 = v32;
    v11 = copy_baseband_request_info(v33, v34, &v72);
    v35 = v72;

    v65 = v11;
    if (v11)
    {
      v32 = v35;
      goto LABEL_51;
    }

    v9 = createMobileActivationError("create_activation_info", 2275, @"com.apple.MobileActivation.ErrorDomain", -1, v35, @"Failed to copy baseband request info.");

    v10 = 0;
    v12 = 0;
LABEL_43:
    v65 = 0;
    v13 = 0;
LABEL_44:
    v14 = 0;
    goto LABEL_45;
  }

  v65 = 0;
LABEL_51:
  v71 = v32;
  v13 = copy_regulatory_images_request_info(&v71);
  v40 = v71;

  if (!v13)
  {
    v9 = createMobileActivationError("create_activation_info", 2284, @"com.apple.MobileActivation.ErrorDomain", -1, v40, @"Failed to copy regulatory images request info.");

    v10 = 0;
    v11 = 0;
    v12 = 0;
    goto LABEL_44;
  }

  v14 = copy_software_update_request_info();
  v41 = v40;

  if (!v14)
  {
    v9 = createMobileActivationError("create_activation_info", 2292, @"com.apple.MobileActivation.ErrorDomain", -1, v41, @"Failed to copy managed update request info.");

    v10 = 0;
    v11 = 0;
    v12 = 0;
    goto LABEL_45;
  }

  v70 = v41;
  v15 = create_cert_request(v4, &v70);
  v42 = v70;

  if (!v15)
  {
    v9 = createMobileActivationError("create_activation_info", 2299, @"com.apple.MobileActivation.ErrorDomain", -1, v42, @"Failed to create certificate request.");

    v10 = 0;
    v11 = 0;
    v12 = 0;
    goto LABEL_46;
  }

  v85[0] = @"DeviceID";
  v85[1] = @"DeviceInfo";
  v86[0] = v67;
  v86[1] = v63;
  v85[2] = @"ActivationRequestInfo";
  v85[3] = @"RegulatoryImages";
  v86[2] = v66;
  v86[3] = v13;
  v85[4] = @"SoftwareUpdateRequestInfo";
  v85[5] = @"DeviceCertRequest";
  v86[4] = v14;
  v86[5] = v15;
  v85[6] = @"UIKCertification";
  v86[6] = v64;
  v43 = [NSDictionary dictionaryWithObjects:v86 forKeys:v85 count:7];
  v11 = [NSMutableDictionary dictionaryWithDictionary:v43];

  if (v65)
  {
    [(NSMutableDictionary *)v11 setObject:v65 forKeyedSubscript:@"BasebandRequestInfo"];
  }

  v44 = [v5 objectForKeyedSubscript:@"ActivationLockInfo"];
  v45 = isNSString(v44);

  if (v45)
  {
    v46 = [v5 objectForKeyedSubscript:@"ActivationLockInfo"];
    [(NSMutableDictionary *)v11 setObject:v46 forKeyedSubscript:@"ActivationLockInfo"];
  }

  v69 = 0;
  v12 = [NSPropertyListSerialization dataWithPropertyList:v11 format:100 options:0 error:&v69];
  v9 = v69;

  if (!v12)
  {
    v54 = createMobileActivationError("create_activation_info", 2328, @"com.apple.MobileActivation.ErrorDomain", -1, v9, @"Could not convert dictionary to xml data.");

    v10 = 0;
    v16 = 0;
    v4 = 0;
    v8 = 0;
LABEL_70:
    v9 = v54;
    goto LABEL_48;
  }

  v8 = SecKeyCreateSignature(v57, kSecKeyAlgorithmECDSASignatureMessageX962SHA256, v12, &error);
  if (!v8)
  {
    v54 = createMobileActivationError("create_activation_info", 2336, @"com.apple.MobileActivation.ErrorDomain", -1, error, @"Failed to sign activation data with ref key.");

    v10 = 0;
    v16 = 0;
    v4 = 0;
    goto LABEL_70;
  }

  v4 = malloc_type_malloc(0x23uLL, 0x61C93ED9uLL);
  if (!v4)
  {
    v54 = createMobileActivationError("create_activation_info", 2344, @"com.apple.MobileActivation.ErrorDomain", -1, 0, @"Failed to allocate sha1 digest memory.");

    v10 = 0;
    v16 = 0;
    goto LABEL_70;
  }

  [(NSData *)v12 bytes];
  [(NSData *)v12 length];
  v53 = v4;
  if (CCDigest())
  {
    MobileActivationError = createMobileActivationError("create_activation_info", 2354, @"com.apple.MobileActivation.ErrorDomain", -1, 0, @"Failed to digest data.");
LABEL_73:
    v52 = MobileActivationError;

    v10 = 0;
    v16 = 0;
LABEL_74:
    v4 = 0;
    goto LABEL_75;
  }

  *v4 = 0xE2B050609302130;
  *(v4 + 2) = 85590531;
  *(v4 + 6) = 1024;
  *(v4 + 14) = 20;
  wyjYwk(v4, 35, v88, &v82, v87, &v81);
  if (v48)
  {
    MobileActivationError = createMobileActivationError("create_activation_info", 2387, @"com.apple.MobileActivation.ErrorDomain", -1, 0, @"Failed to compute activation signature: %ld", v48);
    goto LABEL_73;
  }

  v49 = [NSData alloc];
  v16 = [v49 initWithBytes:v88 length:v82];
  if (!v16)
  {
    v52 = createMobileActivationError("create_activation_info", 2394, @"com.apple.MobileActivation.ErrorDomain", -1, 0, @"Failed to encode activation signature.");

    v10 = 0;
    goto LABEL_74;
  }

  v50 = [NSData alloc];
  v51 = [v50 initWithBytes:v87 length:v81];
  v4 = v51;
  if (v51)
  {
    v83[0] = @"ActivationInfoXML";
    v83[1] = @"FairPlaySignature";
    v84[0] = v12;
    v84[1] = v16;
    v83[2] = @"FairPlayCertChain";
    v83[3] = @"RKCertification";
    v84[2] = v51;
    v84[3] = v62;
    v83[4] = @"RKSignature";
    v84[4] = v8;
    v10 = [NSDictionary dictionaryWithObjects:v84 forKeys:v83 count:5];
    goto LABEL_76;
  }

  v52 = createMobileActivationError("create_activation_info", 2400, @"com.apple.MobileActivation.ErrorDomain", -1, 0, @"Failed to encode certificate chain.");

  v10 = 0;
LABEL_75:
  v9 = v52;
LABEL_76:
  free(v53);
LABEL_48:
  CFRelease(cf);
  CFRelease(v56);
  if (v57)
  {
    CFRelease(v57);
  }

LABEL_29:
  if (error)
  {
    CFRelease(error);
  }

  error = 0;
  if (v68 && !v10)
  {
    v36 = v9;
    *v68 = v9;
  }

  v37 = v10;

  return v10;
}

NSDictionary *copy_activation_request_info(void *a1, id a2, NSError **a3)
{
  v5 = a2;
  v6 = data_ark_copy(a1, 0, @"ActivationState");
  if (v6)
  {
    v7 = [v5 objectForKeyedSubscript:@"ActivationRandomness"];
    v8 = v7;
    if (v7 && (v9 = isNSString(v7), v9, v9))
    {
      v16[0] = @"FMiPAccountExists";
      v10 = [NSNumber numberWithBool:FindMyDeviceIsEnabled(0)];
      v17[0] = v10;
      v17[1] = v6;
      v16[1] = @"ActivationState";
      v16[2] = @"ActivationRandomness";
      v17[2] = v8;
      v11 = [NSDictionary dictionaryWithObjects:v17 forKeys:v16 count:3];

      v12 = 0;
      if (!a3)
      {
        goto LABEL_11;
      }
    }

    else
    {
      v12 = createMobileActivationError("copy_activation_request_info", 1836, @"com.apple.MobileActivation.ErrorDomain", -2, 0, @"Invalid nonce.");
      v11 = 0;
      if (!a3)
      {
        goto LABEL_11;
      }
    }
  }

  else
  {
    v12 = createMobileActivationError("copy_activation_request_info", 1827, @"com.apple.MobileActivation.ErrorDomain", -1, 0, @"Failed to lookup activation state.");
    v11 = 0;
    v8 = 0;
    if (!a3)
    {
      goto LABEL_11;
    }
  }

  if (!v11)
  {
    v13 = v12;
    *a3 = v12;
  }

LABEL_11:
  v14 = v11;

  return v11;
}

id copy_regulatory_images_request_info(NSError **a1)
{
  v2 = +[GestaltHlpr getSharedInstance];
  v12 = 0;
  v3 = [v2 copyRegulatoryImagesInfo:&v12];
  v4 = v12;

  if (v3)
  {
    v5 = v4 == 0;
  }

  else
  {
    v5 = 0;
  }

  if (v5)
  {
    v9 = v3;
    v7 = 0;
  }

  else
  {
    v6 = createMobileActivationError("copy_regulatory_images_request_info", 1796, @"com.apple.MobileActivation.ErrorDomain", -1, 0, @"Failed to regulatory images info: %@", v4);
    v7 = v6;
    if (a1)
    {
      v8 = v6;
      v9 = 0;
      *a1 = v7;
    }

    else
    {
      v9 = 0;
    }
  }

  v10 = v9;

  return v9;
}

NSDictionary *copy_software_update_request_info()
{
  v2 = @"Enabled";
  v3 = &__kCFBooleanTrue;
  v0 = [NSDictionary dictionaryWithObjects:&v3 forKeys:&v2 count:1];

  return v0;
}

NSDictionary *create_activation_info_legacy()
{
  v0 = __chkstk_darwin();
  v42 = v1;
  v3 = v2;
  v4 = v0;
  v5 = v3;
  v57 = 0uLL;
  v58 = 0;
  memset(v56, 0, 35);
  memset(v55, 0, sizeof(v55));
  v51 = 256;
  bzero(v54, 0x1000uLL);
  v50 = 4096;
  v38 = v5;
  v39 = v4;
  if (!v4)
  {
    v18 = createMobileActivationError("create_activation_info_legacy", 2454, @"com.apple.MobileActivation.ErrorDomain", -2, 0, @"Invalid input.");
    v7 = 0;
LABEL_11:
    v8 = 0;
LABEL_12:
    v19 = 0;
    v20 = 0;
    v21 = 0;
    v22 = 0;
    v40 = 0;
    v41 = 0;
    v11 = 0;
LABEL_13:
    v16 = 0;
LABEL_14:
    v23 = 0;
    goto LABEL_15;
  }

  v6 = objc_alloc_init(NSMutableDictionary);
  v7 = v6;
  if (!v6)
  {
    v18 = createMobileActivationError("create_activation_info_legacy", 2461, @"com.apple.MobileActivation.ErrorDomain", -1, 0, @"Failed to create dictionary.");
    goto LABEL_11;
  }

  v49 = 0;
  v8 = copy_device_id_info(v6, &v49);
  v9 = v49;
  v10 = v9;
  if (!v8)
  {
    v18 = createMobileActivationError("create_activation_info_legacy", 2469, @"com.apple.MobileActivation.ErrorDomain", -1, v9, @"Failed to copy device id info.");

    goto LABEL_12;
  }

  v41 = v8;
  v48 = v9;
  v11 = copy_device_info(v9, &v48);
  v12 = v48;

  if (!v11)
  {
    v18 = createMobileActivationError("create_activation_info_legacy", 2477, @"com.apple.MobileActivation.ErrorDomain", -1, v12, @"Failed to copy device info.");

    v8 = 0;
    v19 = 0;
    v20 = 0;
    v21 = 0;
    v22 = 0;
    v40 = 0;
    goto LABEL_13;
  }

  v40 = v11;
  v47 = v12;
  v11 = copy_activation_request_info(v4, v5, &v47);
  v13 = v47;

  if (!v11)
  {
    v18 = createMobileActivationError("create_activation_info_legacy", 2485, @"com.apple.MobileActivation.ErrorDomain", -1, v13, @"Failed to copy activation request info.");

    v8 = 0;
    v19 = 0;
    v20 = 0;
    v21 = 0;
    v22 = 0;
    goto LABEL_13;
  }

  v14 = is_product_cellular();
  if (!v14)
  {
    v16 = 0;
    goto LABEL_25;
  }

  v46 = v13;
  v16 = copy_baseband_request_info(v14, v15, &v46);
  v17 = v46;

  if (!v16)
  {
    v18 = createMobileActivationError("create_activation_info_legacy", 2494, @"com.apple.MobileActivation.ErrorDomain", -1, v17, @"Failed to copy baseband request info.");

    v8 = 0;
    v19 = 0;
    v20 = 0;
    v21 = 0;
    v22 = 0;
    goto LABEL_14;
  }

  v13 = v17;
LABEL_25:
  v45 = v13;
  v23 = copy_regulatory_images_request_info(&v45);
  v27 = v45;

  if (v23)
  {
    v44 = v27;
    v19 = create_cert_request(v4, &v44);
    v28 = v44;

    if (v19)
    {
      [v7 addEntriesFromDictionary:v41];
      [v7 addEntriesFromDictionary:v40];
      [v7 addEntriesFromDictionary:v11];
      [v7 addEntriesFromDictionary:v23];
      if (v16)
      {
        [v7 addEntriesFromDictionary:v16];
      }

      [v7 setObject:v19 forKeyedSubscript:@"DeviceCertRequest"];
      v43 = 0;
      v8 = [NSPropertyListSerialization dataWithPropertyList:v7 format:100 options:0 error:&v43];
      v18 = v43;

      if (v8)
      {
        [(NSData *)v8 bytes];
        [(NSData *)v8 length];
        if (CCDigest())
        {
          v29 = @"Failed to digest data.";
          v30 = 2538;
        }

        else
        {
          *&v56[0] = 0xE2B050609302130;
          DWORD2(v56[0]) = 85590531;
          WORD6(v56[0]) = 1024;
          BYTE14(v56[0]) = 20;
          *(v56 + 15) = v57;
          *(&v56[1] + 15) = v58;
          wyjYwk(v56, 35, v55, &v51, v54, &v50);
          if (!v32)
          {
            v33 = [NSData alloc];
            v20 = [v33 initWithBytes:v55 length:v51];
            if (v20)
            {
              v34 = [NSData alloc];
              v35 = [v34 initWithBytes:v54 length:v50];
              v21 = v35;
              if (v35)
              {
                v52[0] = @"ActivationInfoXML";
                v52[1] = @"FairPlaySignature";
                v53[0] = v8;
                v53[1] = v20;
                v52[2] = @"FairPlayCertChain";
                v52[3] = @"ActivationInfoComplete";
                v53[2] = v35;
                v53[3] = &__kCFBooleanTrue;
                v22 = [NSDictionary dictionaryWithObjects:v53 forKeys:v52 count:4];
                goto LABEL_15;
              }

              v37 = createMobileActivationError("create_activation_info_legacy", 2585, @"com.apple.MobileActivation.ErrorDomain", -1, 0, @"Failed to encode certificate chain.");

              goto LABEL_42;
            }

            v37 = createMobileActivationError("create_activation_info_legacy", 2579, @"com.apple.MobileActivation.ErrorDomain", -1, 0, @"Failed to encode activation signature.");

LABEL_41:
            v21 = 0;
LABEL_42:
            v22 = 0;
            v18 = v37;
            goto LABEL_15;
          }

          v36 = v32;
          v29 = @"Failed to compute activation signature: %ld";
          v30 = 2572;
        }

        MobileActivationError = createMobileActivationError("create_activation_info_legacy", v30, @"com.apple.MobileActivation.ErrorDomain", -1, 0, v29, v36);
      }

      else
      {
        MobileActivationError = createMobileActivationError("create_activation_info_legacy", 2529, @"com.apple.MobileActivation.ErrorDomain", -1, v18, @"Could not convert dictionary to xml data.");
      }

      v37 = MobileActivationError;

      v20 = 0;
      goto LABEL_41;
    }

    v18 = createMobileActivationError("create_activation_info_legacy", 2510, @"com.apple.MobileActivation.ErrorDomain", -1, v28, @"Failed to create certificate request.");

    v8 = 0;
  }

  else
  {
    v18 = createMobileActivationError("create_activation_info_legacy", 2503, @"com.apple.MobileActivation.ErrorDomain", -1, v27, @"Failed to copy regulatory images request info.");

    v8 = 0;
    v19 = 0;
  }

  v20 = 0;
  v21 = 0;
  v22 = 0;
LABEL_15:
  if (v42 && !v22)
  {
    v24 = v18;
    *v42 = v18;
  }

  v25 = v22;

  return v25;
}

NSDictionary *create_baseband_info(void *a1, __SecKey *a2, __SecCertificate *a3, __SecCertificate *a4, void *a5, NSError **a6)
{
  v10 = a1;
  error = 0;
  v45 = a5;
  v46 = v10;
  if (!v10 || !a2 || !a3 || !a4)
  {
    v30 = createMobileActivationError("create_baseband_info", 2623, @"com.apple.MobileActivation.ErrorDomain", -2, 0, @"Invalid input(s).");
    v33 = 0;
    v28 = 0;
    v29 = 0;
    v26 = 0;
    v16 = 0;
    v22 = 0;
    v32 = 0;
    v13 = 0;
    v43 = 0;
    v44 = 0;
    v11 = 0;
    goto LABEL_31;
  }

  v11 = objc_alloc_init(NSMutableData);
  if (!v11)
  {
    MobileActivationError = createMobileActivationError("create_baseband_info", 2631, @"com.apple.MobileActivation.ErrorDomain", -1, 0, @"Failed to create data.");
LABEL_20:
    v30 = MobileActivationError;
    v33 = 0;
    v28 = 0;
    v29 = 0;
    v26 = 0;
    v16 = 0;
    v22 = 0;
    v32 = 0;
    v13 = 0;
    v43 = 0;
    v44 = 0;
    goto LABEL_31;
  }

  v12 = SecCertificateCopyData(a3);
  if (!v12)
  {
    MobileActivationError = createMobileActivationError("create_baseband_info", 2637, @"com.apple.MobileActivation.ErrorDomain", -1, 0, @"Failed to copy certificate data.");
    goto LABEL_20;
  }

  v53 = 0;
  v44 = v12;
  v13 = lockcrypto_create_pem(v12, "CERTIFICATE", &v53);
  v14 = v53;
  if (!v13)
  {
    v35 = createMobileActivationError("create_baseband_info", 2643, @"com.apple.MobileActivation.ErrorDomain", -1, 0, @"Failed to create PEM data.");
LABEL_23:
    v30 = v35;

    v33 = 0;
    v28 = 0;
    v29 = 0;
    v26 = 0;
    v16 = 0;
    v22 = 0;
    v32 = 0;
    v43 = 0;
    goto LABEL_31;
  }

  [v11 appendData:v13];
  v15 = SecCertificateCopyData(a4);
  if (!v15)
  {
    v35 = createMobileActivationError("create_baseband_info", 2651, @"com.apple.MobileActivation.ErrorDomain", -1, 0, @"Failed to copy certificate data.");
    goto LABEL_23;
  }

  v52 = v14;
  v43 = v15;
  v16 = lockcrypto_create_pem(v15, "CERTIFICATE", &v52);
  v17 = v52;

  v18 = v13;
  v13 = v16;

  if (!v16)
  {
    v30 = createMobileActivationError("create_baseband_info", 2657, @"com.apple.MobileActivation.ErrorDomain", -1, 0, @"Failed to create PEM data.");
    v36 = v17;
LABEL_26:

    v33 = 0;
    v28 = 0;
    v29 = 0;
    v26 = 0;
    v22 = 0;
LABEL_30:
    v32 = 0;
    goto LABEL_31;
  }

  v19 = [@"\n" dataUsingEncoding:4];
  [v11 appendData:v19];

  v51 = v17;
  v16 = copy_device_id_info([v11 appendData:v16], &v51);
  v20 = v51;

  if (!v16)
  {
    v30 = createMobileActivationError("create_baseband_info", 2668, @"com.apple.MobileActivation.ErrorDomain", -1, v20, @"Failed to copy device id info.");
    v36 = v20;
    goto LABEL_26;
  }

  v50 = v20;
  v22 = copy_device_info(v21, &v50);
  v23 = v50;

  if (!v22)
  {
    v37 = createMobileActivationError("create_baseband_info", 2676, @"com.apple.MobileActivation.ErrorDomain", -1, v23, @"Failed to copy device info.");
LABEL_29:
    v30 = v37;

    v33 = 0;
    v28 = 0;
    v29 = 0;
    v26 = 0;
    goto LABEL_30;
  }

  v24 = is_product_cellular();
  if (!v24)
  {
    v37 = createMobileActivationError("create_baseband_info", 2683, @"com.apple.MobileActivation.ErrorDomain", -3, v23, @"Device doesn't support telephony.");
    goto LABEL_29;
  }

  v42 = v13;
  v49 = v23;
  v26 = copy_baseband_request_info(v24, v25, &v49);
  v27 = v49;

  if (!v26)
  {
    v30 = createMobileActivationError("create_baseband_info", 2689, @"com.apple.MobileActivation.ErrorDomain", -1, v27, @"Failed to copy baseband request info.");

    v33 = 0;
    v28 = 0;
    v29 = 0;
    v32 = 0;
    goto LABEL_41;
  }

  v57[0] = @"BasebandRequestInfo";
  v57[1] = @"DeviceID";
  v58[0] = v26;
  v58[1] = v16;
  v57[2] = @"DeviceInfo";
  v58[2] = v22;
  v28 = [NSDictionary dictionaryWithObjects:v58 forKeys:v57 count:3];
  v48 = 0;
  v29 = [NSPropertyListSerialization dataWithPropertyList:v28 format:100 options:0 error:&v48];
  v30 = v48;

  if (!v29)
  {
    v41 = createMobileActivationError("create_baseband_info", 2702, @"com.apple.MobileActivation.ErrorDomain", -1, v30, @"Could not convert dictionary to xml data.");

    v33 = 0;
    v32 = 0;
LABEL_40:
    v30 = v41;
    goto LABEL_41;
  }

  v31 = SecKeyCreateSignature(a2, kSecKeyAlgorithmECDSASignatureMessageX962SHA256, v29, &error);
  v32 = v31;
  if (!v31)
  {
    v41 = createMobileActivationError("create_baseband_info", 2710, @"com.apple.MobileActivation.ErrorDomain", -1, error, @"Failed to sign baseband data with ref key.");

    v33 = 0;
    goto LABEL_40;
  }

  v55[0] = @"ActivationInfoXML";
  v55[1] = @"RKCertification";
  v56[0] = v29;
  v56[1] = v11;
  v55[2] = @"RKSignature";
  v56[2] = v31;
  v33 = [NSDictionary dictionaryWithObjects:v56 forKeys:v55 count:3];
LABEL_41:
  v13 = v42;
LABEL_31:
  if (error)
  {
    CFRelease(error);
  }

  error = 0;
  if (a6 && !v33)
  {
    v38 = v30;
    *a6 = v30;
  }

  v39 = v33;

  return v33;
}

uint64_t valid_ucrt_and_uik_legacy(uint64_t a1, void *a2, NSError **a3)
{
  if (!a1 || !a2)
  {
    v9 = createMobileActivationError("valid_ucrt_and_uik_legacy", 2965, @"com.apple.MobileActivation.ErrorDomain", -2, 0, @"Invalid input(s).");
    v5 = 0;
    goto LABEL_10;
  }

  v18 = 0;
  v5 = libaks_ref_key_get_public(a2, &v18);
  v6 = v18;
  if (!v5)
  {
    v9 = createMobileActivationError("valid_ucrt_and_uik_legacy", 2973, @"com.apple.MobileActivation.ErrorDomain", -1, v6, @"Failed to retrieve UIK public key.");

LABEL_10:
    v8 = 0;
    v10 = 0;
    if (!a3)
    {
      goto LABEL_12;
    }

    goto LABEL_11;
  }

  v19 = a1;
  v7 = [NSArray arrayWithObjects:&v19 count:1];
  v17 = v6;
  v8 = lockcrypto_extract_public(v7, &v17);
  v9 = v17;

  if (v8)
  {
    v10 = SecKeyCopyExternalRepresentation(v8, 0);
    if (v10)
    {
      if ([v5 isEqualToData:v10])
      {
        v11 = 1;
LABEL_13:
        CFRelease(v8);
        v13 = v11;
        goto LABEL_14;
      }

      MobileActivationError = createMobileActivationError("valid_ucrt_and_uik_legacy", 2994, @"com.apple.MobileActivation.ErrorDomain", -1, 0, @"UCRT public key does not match UIK public key.");
    }

    else
    {
      MobileActivationError = createMobileActivationError("valid_ucrt_and_uik_legacy", 2987, @"com.apple.MobileActivation.ErrorDomain", -1, 0, @"Failed to encode UCRT public key as data.");
    }

    v15 = MobileActivationError;
  }

  else
  {
    v15 = createMobileActivationError("valid_ucrt_and_uik_legacy", 2981, @"com.apple.MobileActivation.ErrorDomain", -1, v9, @"Failed to retrieve UCRT public key.");

    v10 = 0;
  }

  v9 = v15;
  if (a3)
  {
LABEL_11:
    v12 = v9;
    *a3 = v9;
  }

LABEL_12:
  v11 = 0;
  v13 = 0;
  if (v8)
  {
    goto LABEL_13;
  }

LABEL_14:

  return v13;
}

uint64_t valid_ucrt_and_uik(__SecCertificate *a1, SecKeyRef key, NSError **a3)
{
  v4 = a1;
  error = 0;
  if (!a1)
  {
    v10 = createMobileActivationError("valid_ucrt_and_uik", 3030, @"com.apple.MobileActivation.ErrorDomain", -2, 0, @"Invalid ucrt.");
    v7 = 0;
    v6 = 0;
    goto LABEL_14;
  }

  if (!key)
  {
    v10 = createMobileActivationError("valid_ucrt_and_uik", 3042, @"com.apple.MobileActivation.ErrorDomain", -1, 0, @"Invalid UIK.");
    v7 = 0;
    v6 = 0;
LABEL_13:
    v4 = 0;
    goto LABEL_14;
  }

  v5 = SecKeyCopyPublicKey(key);
  v6 = v5;
  if (!v5)
  {
    v10 = createMobileActivationError("valid_ucrt_and_uik", 3050, @"com.apple.MobileActivation.ErrorDomain", -1, 0, @"Failed to copy UIK public key.");
    v7 = 0;
    goto LABEL_13;
  }

  v7 = SecKeyCopyExternalRepresentation(v5, &error);
  if (!v7)
  {
    v10 = createMobileActivationError("valid_ucrt_and_uik", 3056, @"com.apple.MobileActivation.ErrorDomain", -1, error, @"Failed to copy UIK public key buffer.");
    goto LABEL_13;
  }

  v8 = SecCertificateCopyKey(v4);
  v4 = v8;
  if (v8)
  {
    v9 = SecKeyCopyExternalRepresentation(v8, 0);
    if (v9)
    {
      if (([(__CFData *)v7 isEqualToData:v9]& 1) != 0)
      {
        v10 = 0;
        v11 = 1;
        goto LABEL_21;
      }

      MobileActivationError = createMobileActivationError("valid_ucrt_and_uik", 3078, @"com.apple.MobileActivation.ErrorDomain", -1, 0, @"UCRT public key does not match UIK public key.");
    }

    else
    {
      MobileActivationError = createMobileActivationError("valid_ucrt_and_uik", 3071, @"com.apple.MobileActivation.ErrorDomain", -1, 0, @"Failed to encode UCRT public key as data.");
    }

    v10 = MobileActivationError;
    if (!a3)
    {
      goto LABEL_20;
    }

LABEL_15:
    v12 = v10;
    v11 = 0;
    *a3 = v10;
    goto LABEL_21;
  }

  v10 = createMobileActivationError("valid_ucrt_and_uik", 3065, @"com.apple.MobileActivation.ErrorDomain", -1, 0, @"Failed to retrieve UCRT public key.");
LABEL_14:
  v9 = 0;
  if (a3)
  {
    goto LABEL_15;
  }

LABEL_20:
  v11 = 0;
LABEL_21:
  if (error)
  {
    CFRelease(error);
  }

  error = 0;
  if (v6)
  {
    CFRelease(v6);
  }

  if (v4)
  {
    CFRelease(v4);
  }

  return v11;
}

uint64_t data_ark_register_set_notification(void *a1, void *a2, void *a3, void *a4, int a5)
{
  v9 = a1;
  v10 = a2;
  v11 = a3;
  v12 = a4;
  v23 = 0;
  v24 = &v23;
  v25 = 0x2020000000;
  v26 = 0;
  if (v9)
  {
    v13 = [v9 queue];
    v16[0] = _NSConcreteStackBlock;
    v16[1] = 3254779904;
    v16[2] = __data_ark_register_set_notification_block_invoke;
    v16[3] = &__block_descriptor_76_e8_32s40s48s56s64r_e5_v8__0l;
    v22 = a5;
    v21 = &v23;
    v17 = v9;
    v18 = v10;
    v19 = v11;
    v20 = v12;
    dispatch_barrier_sync(v13, v16);

    v14 = *(v24 + 24);
  }

  else
  {
    v14 = 0;
  }

  _Block_object_dispose(&v23, 8);

  return v14 & 1;
}

void sub_1002EB1A0(_Unwind_Exception *a1, uint64_t a2, uint64_t a3, uint64_t a4, uint64_t a5, uint64_t a6, uint64_t a7, uint64_t a8, uint64_t a9, uint64_t a10, uint64_t a11, ...)
{
  va_start(va, a11);
  _Block_object_dispose(va, 8);
  _Unwind_Resume(a1);
}

void __data_ark_register_set_notification_block_invoke(uint64_t a1)
{
  if ((*(a1 + 72) & 8) != 0)
  {
    v2 = [*(a1 + 32) change_notifications];
    *(*(*(a1 + 64) + 8) + 24) = _register_notification(v2, *(a1 + 40), *(a1 + 48), *(a1 + 56));
  }

  if ((*(*(*(a1 + 64) + 8) + 24) & 1) == 0)
  {
    if ((*(a1 + 72) & 2) == 0 || (v3 = [*(a1 + 32) set_notifications], *(*(*(a1 + 64) + 8) + 24) = _register_notification(v3, *(a1 + 40), *(a1 + 48), *(a1 + 56)), v3, (*(*(*(a1 + 64) + 8) + 24) & 1) == 0))
    {
      if ((*(a1 + 72) & 4) != 0)
      {
        v4 = [*(a1 + 32) remove_notifications];
        *(*(*(a1 + 64) + 8) + 24) = _register_notification(v4, *(a1 + 40), *(a1 + 48), *(a1 + 56));
      }
    }
  }
}

__CFString *_register_notification(void *a1, void *a2, void *a3, void *a4)
{
  v7 = a1;
  v8 = a2;
  v9 = a3;
  v10 = a4;
  v11 = v10;
  if (v7 && v10)
  {
    v12 = _create_mapkey(v8, v9);
    if (v12)
    {
      [v7 setObject:v11 forKeyedSubscript:v12];

      v12 = 1;
    }

    else
    {
      maLog("_register_notification", 0, @"failed to create mapkey for %@-%@", v8, v9);
    }
  }

  else
  {
    maLog("_register_notification", 0, @"invalid inputs");
    v12 = 0;
  }

  return v12;
}

void __copy_helper_block_e8_32s40s48s56s64r(uint64_t a1, uint64_t a2)
{
  v4 = *(a2 + 32);
  v5 = *(a2 + 40);
  v6 = *(a2 + 48);
  v7 = *(a2 + 56);
  v8 = *(a2 + 64);

  _Block_object_assign((a1 + 64), v8, 8);
}

void __destroy_helper_block_e8_32s40s48s56s64r(uint64_t a1)
{
  _Block_object_dispose(*(a1 + 64), 8);

  v2 = *(a1 + 32);
}

uint64_t data_ark_set(void *a1, void *a2, void *a3, void *a4, char a5)
{
  v9 = a1;
  v10 = a2;
  v11 = a3;
  v12 = a4;
  v23 = 0;
  v24 = &v23;
  v25 = 0x2020000000;
  v26 = 0;
  if (v9)
  {
    v13 = [v9 queue];
    v16[0] = _NSConcreteStackBlock;
    v16[1] = 3254779904;
    v16[2] = __data_ark_set_block_invoke;
    v16[3] = &__block_descriptor_73_e8_32s40s48s56s64r_e5_v8__0l;
    v17 = v9;
    v18 = v12;
    v19 = v10;
    v22 = a5;
    v20 = v11;
    v21 = &v23;
    dispatch_barrier_sync(v13, v16);

    v14 = *(v24 + 24);
  }

  else
  {
    v14 = 0;
  }

  _Block_object_dispose(&v23, 8);

  return v14 & 1;
}

void sub_1002EB61C(_Unwind_Exception *a1, uint64_t a2, uint64_t a3, uint64_t a4, uint64_t a5, uint64_t a6, uint64_t a7, uint64_t a8, uint64_t a9, uint64_t a10, uint64_t a11, ...)
{
  va_start(va, a11);
  _Block_object_dispose(va, 8);
  _Unwind_Resume(a1);
}

void __data_ark_set_block_invoke(uint64_t a1)
{
  v2 = [*(a1 + 32) path];
  v3 = load_dict(v2);

  if (!*(a1 + 40))
  {
    maLog("data_ark_set_block_invoke", 0, @"invalid value");
    goto LABEL_34;
  }

  v4 = [*(a1 + 32) store];

  if (!v4)
  {
    goto LABEL_34;
  }

  if (!v3)
  {
    v3 = objc_alloc_init(NSMutableDictionary);
  }

  v5 = _create_mapkey(*(a1 + 48), *(a1 + 56));
  v6 = _create_mapkey(*(a1 + 48), 0);
  v7 = [*(a1 + 32) store];
  v8 = [v7 objectForKeyedSubscript:v5];

  v9 = !v8 || ([v8 isEqual:*(a1 + 40)] & 1) == 0;
  v10 = *(a1 + 40);
  v11 = [*(a1 + 32) store];
  [v11 setObject:v10 forKeyedSubscript:v5];

  if (*(a1 + 72))
  {
    goto LABEL_13;
  }

  v12 = [(NSMutableDictionary *)v3 objectForKey:v5];

  if (!v12)
  {
    goto LABEL_15;
  }

  if (*(a1 + 72))
  {
LABEL_13:
    [(NSMutableDictionary *)v3 setObject:*(a1 + 40) forKey:v5];
  }

  else
  {
    [(NSMutableDictionary *)v3 removeObjectForKey:v5];
  }

  v13 = [*(a1 + 32) path];
  store_dict(v13, v3, 0);

LABEL_15:
  if (v9)
  {
    v14 = [*(a1 + 32) change_notifications];

    if (v14)
    {
      v15 = [*(a1 + 32) change_notifications];
      v16 = [v15 objectForKeyedSubscript:v5];

      if (v16)
      {
        [*(a1 + 32) postNotification:v16];
      }

      if (v6)
      {
        v17 = [*(a1 + 32) change_notifications];
        v18 = [v17 objectForKeyedSubscript:v6];

        if (v18)
        {
          [*(a1 + 32) postNotification:v18];
          v16 = v18;
        }

        else
        {
          v16 = 0;
        }
      }
    }
  }

  v19 = [*(a1 + 32) set_notifications];

  if (v19)
  {
    v20 = [*(a1 + 32) set_notifications];
    v21 = [v20 objectForKeyedSubscript:v5];

    if (v21)
    {
      [*(a1 + 32) postNotification:v21];
    }

    if (v6)
    {
      v22 = [*(a1 + 32) set_notifications];
      v23 = [v22 objectForKeyedSubscript:v6];

      if (v23)
      {
        [*(a1 + 32) postNotification:v23];
        v21 = v23;
      }

      else
      {
        v21 = 0;
      }
    }
  }

  *(*(*(a1 + 64) + 8) + 24) = 1;

LABEL_34:
}

uint64_t __Block_byref_object_copy__0(uint64_t result, uint64_t a2)
{
  *(result + 40) = *(a2 + 40);
  *(a2 + 40) = 0;
  return result;
}

void __copy_helper_block_e8_32s40s48s56r(uint64_t a1, uint64_t a2)
{
  v4 = *(a2 + 32);
  v5 = *(a2 + 40);
  v6 = *(a2 + 48);
  v7 = *(a2 + 56);

  _Block_object_assign((a1 + 56), v7, 8);
}

void __destroy_helper_block_e8_32s40s48s56r(uint64_t a1)
{
  _Block_object_dispose(*(a1 + 56), 8);

  v2 = *(a1 + 32);
}

void data_ark_remove(void *a1, void *a2, void *a3)
{
  v5 = a1;
  v6 = a2;
  v7 = a3;
  if (v5)
  {
    v8 = [v5 queue];
    block[0] = _NSConcreteStackBlock;
    block[1] = 3254779904;
    block[2] = __data_ark_remove_block_invoke;
    block[3] = &__block_descriptor_56_e8_32s40s48s_e5_v8__0l;
    v10 = v5;
    v11 = v6;
    v12 = v7;
    dispatch_barrier_sync(v8, block);
  }
}

void __data_ark_remove_block_invoke(id *a1)
{
  v2 = [a1[4] path];
  v3 = load_dict(v2);

  v4 = [a1[4] store];
  if (v4)
  {
    v4 = _create_mapkey(a1[5], a1[6]);
    v5 = [a1[4] store];
    v6 = [v5 objectForKey:v4];

    if (v6)
    {
      v7 = [a1[4] store];
      [v7 removeObjectForKey:v4];

      [(NSMutableDictionary *)v3 removeObjectForKey:v4];
      if (v3)
      {
        v8 = [a1[4] path];
        store_dict(v8, v3, 0);
      }

      v9 = [a1[4] remove_notifications];

      if (v9)
      {
        v10 = [a1[4] remove_notifications];
        v11 = [v10 objectForKeyedSubscript:v4];

        if (v11)
        {
          [a1[4] postNotification:v11];
        }
      }
    }
  }
}

id __copy_helper_block_e8_32s40s48s(uint64_t a1, uint64_t a2)
{
  v3 = *(a2 + 32);
  v4 = *(a2 + 40);
  v5 = *(a2 + 48);

  return v5;
}

void __destroy_helper_block_e8_32s40s48s(uint64_t a1)
{
  v2 = *(a1 + 32);
}

uint64_t data_ark_exists(void *a1, void *a2, void *a3)
{
  v5 = a1;
  v6 = a2;
  v7 = a3;
  v16 = 0;
  v17 = &v16;
  v18 = 0x2020000000;
  v19 = 0;
  if (v5)
  {
    v8 = [v5 queue];
    v11[0] = _NSConcreteStackBlock;
    v11[1] = 3254779904;
    v11[2] = __data_ark_exists_block_invoke;
    v11[3] = &__block_descriptor_64_e8_32s40s48s56r_e5_v8__0l;
    v12 = v5;
    v13 = v6;
    v14 = v7;
    v15 = &v16;
    dispatch_sync(v8, v11);

    v9 = *(v17 + 24);
  }

  else
  {
    v9 = 0;
  }

  _Block_object_dispose(&v16, 8);

  return v9 & 1;
}

void sub_1002EBF14(_Unwind_Exception *a1, uint64_t a2, uint64_t a3, uint64_t a4, uint64_t a5, uint64_t a6, uint64_t a7, uint64_t a8, uint64_t a9, ...)
{
  va_start(va, a9);
  _Block_object_dispose(va, 8);
  _Unwind_Resume(a1);
}

void __data_ark_exists_block_invoke(uint64_t a1)
{
  v2 = [*(a1 + 32) store];

  if (v2)
  {
    v3 = _create_mapkey(*(a1 + 40), *(a1 + 48));
    v4 = [*(a1 + 32) store];
    v5 = [v4 objectForKey:v3];
    *(*(*(a1 + 56) + 8) + 24) = v5 != 0;
  }
}

void ___copy_domain_block_invoke(uint64_t a1, id a2, void *a3)
{
  v5 = a2;
  v6 = a3;
  if ([v5 hasPrefix:*(a1 + 32)])
  {
    v7 = *(a1 + 32);
    v8 = *(*(*(a1 + 40) + 8) + 40);
    v9 = [v5 substringFromIndex:{objc_msgSend(v7, "length")}];
    [v8 setObject:v6 forKeyedSubscript:v9];
  }
}

void __copy_helper_block_e8_32s40r(uint64_t a1, uint64_t a2)
{
  v4 = *(a2 + 32);
  v5 = *(a2 + 40);

  _Block_object_assign((a1 + 40), v5, 8);
}

void __destroy_helper_block_e8_32s40r(uint64_t a1)
{
  _Block_object_dispose(*(a1 + 40), 8);
  v2 = *(a1 + 32);
}

void sub_1002ECD78(_Unwind_Exception *a1, uint64_t a2, uint64_t a3, uint64_t a4, uint64_t a5, uint64_t a6, uint64_t a7, uint64_t a8, uint64_t a9, ...)
{
  va_start(va, a9);
  _Block_object_dispose(va, 8);
  _Unwind_Resume(a1);
}

void sub_1002EDF28(_Unwind_Exception *a1, uint64_t a2, uint64_t a3, uint64_t a4, uint64_t a5, uint64_t a6, uint64_t a7, uint64_t a8, uint64_t a9, uint64_t a10, uint64_t a11, uint64_t a12, uint64_t a13, uint64_t a14, uint64_t a15, uint64_t a16, uint64_t a17, uint64_t a18, uint64_t a19, uint64_t a20, uint64_t a21, uint64_t a22, uint64_t a23, uint64_t a24, uint64_t a25, uint64_t a26, uint64_t a27, uint64_t a28, uint64_t a29, uint64_t a30, char a31, uint64_t a32, uint64_t a33, uint64_t a34, uint64_t a35, uint64_t a36, char a37, uint64_t a38, uint64_t a39, uint64_t a40, uint64_t a41, uint64_t a42, char a43)
{
  _Block_object_dispose(&a31, 8);
  _Block_object_dispose(&a37, 8);
  _Block_object_dispose(&a43, 8);
  _Block_object_dispose((v43 - 256), 8);
  _Unwind_Resume(a1);
}

uint64_t __Block_byref_object_copy__1(uint64_t result, uint64_t a2)
{
  *(result + 40) = *(a2 + 40);
  *(a2 + 40) = 0;
  return result;
}

void __copy_helper_block_e8_32s40s48r56r64r72r(uint64_t a1, uint64_t a2)
{
  v4 = *(a2 + 32);
  v5 = *(a2 + 40);
  _Block_object_assign((a1 + 48), *(a2 + 48), 8);
  _Block_object_assign((a1 + 56), *(a2 + 56), 8);
  _Block_object_assign((a1 + 64), *(a2 + 64), 8);
  v6 = *(a2 + 72);

  _Block_object_assign((a1 + 72), v6, 8);
}

void __destroy_helper_block_e8_32s40s48r56r64r72r(uint64_t a1)
{
  _Block_object_dispose(*(a1 + 72), 8);
  _Block_object_dispose(*(a1 + 64), 8);
  _Block_object_dispose(*(a1 + 56), 8);
  _Block_object_dispose(*(a1 + 48), 8);

  v2 = *(a1 + 32);
}

uint64_t libInFieldCollectionLibraryCore()
{
  v2 = 0;
  v3 = &v2;
  v4 = 0x2020000000;
  v0 = libInFieldCollectionLibraryCore_frameworkLibrary;
  v5 = libInFieldCollectionLibraryCore_frameworkLibrary;
  if (!libInFieldCollectionLibraryCore_frameworkLibrary)
  {
    v6 = *off_1003D1060;
    v7 = 0;
    v3[3] = _sl_dlopen();
    libInFieldCollectionLibraryCore_frameworkLibrary = v3[3];
    v0 = v3[3];
  }

  _Block_object_dispose(&v2, 8);
  return v0;
}

void sub_1002EE5D8(_Unwind_Exception *a1, uint64_t a2, uint64_t a3, uint64_t a4, uint64_t a5, uint64_t a6, uint64_t a7, ...)
{
  va_start(va, a7);
  _Block_object_dispose(va, 8);
  _Unwind_Resume(a1);
}

uint64_t __libInFieldCollectionLibraryCore_block_invoke(uint64_t a1)
{
  result = _sl_dlopen();
  *(*(*(a1 + 32) + 8) + 24) = result;
  libInFieldCollectionLibraryCore_frameworkLibrary = *(*(*(a1 + 32) + 8) + 24);
  return result;
}

void *__getvsPHbdGfSymbolLoc_block_invoke(uint64_t a1)
{
  v2 = libInFieldCollectionLibrary();
  result = dlsym(v2, "vsPHbdGf");
  *(*(*(a1 + 32) + 8) + 24) = result;
  getvsPHbdGfSymbolLoc_ptr = *(*(*(a1 + 32) + 8) + 24);
  return result;
}

uint64_t libInFieldCollectionLibrary()
{
  v1 = 0;
  result = libInFieldCollectionLibraryCore();
  if (!result)
  {
    libInFieldCollectionLibrary_cold_1(&v1);
  }

  return result;
}

void *__getZshgJnRaSlwnSymbolLoc_block_invoke(uint64_t a1)
{
  v2 = libInFieldCollectionLibrary();
  result = dlsym(v2, "ZshgJnRaSlwn");
  *(*(*(a1 + 32) + 8) + 24) = result;
  getZshgJnRaSlwnSymbolLoc_ptr = *(*(*(a1 + 32) + 8) + 24);
  return result;
}

void reply_and_disconnect(int a1, id a2, void *a3, void *a4)
{
  v6 = a2;
  v7 = a3;
  v8 = a4;
  if ([v7 isEqualToString:@"Error"])
  {
    maLog("reply_and_disconnect", 0, @"Error occurred processing host request (%@): %@", v6, v8);
  }

  v9 = &__NSDictionary0__struct;
  if (v7 && v8)
  {
    objc_opt_class();
    if (objc_opt_isKindOfClass())
    {
      v10 = [(NSString *)v8 localizedDescription];
      v11 = [(NSString *)v8 userInfo];
      v12 = [NSString stringWithFormat:@"%@ (%@)", v10, v11];

      v8 = v12;
    }

    v14 = v7;
    v15 = v8;
    v9 = [NSDictionary dictionaryWithObjects:&v15 forKeys:&v14 count:1];
  }

  v13 = lockdown_send_message();
  if (v13)
  {
    maLog("reply_and_disconnect", 0, @"Failed to send response message: %d", v13);
  }

  lockdown_disconnect();
}

BOOL init_lockdown_server(void *a1, void *a2)
{
  v3 = a1;
  v4 = a2;
  v9 = 0;
  v10 = &v9;
  v11 = 0x2020000000;
  v12 = 0;
  if (!v4)
  {
    maLog("init_lockdown_server", 0, @"invalid input");
LABEL_7:
    v6 = 0;
    goto LABEL_10;
  }

  if (!&_lockdown_checkin_xpc)
  {
    maLog("init_lockdown_server", 0, @"Platform does not support lockdown.");
    goto LABEL_7;
  }

  [@"com.apple.mobileactivationd.lockdown" UTF8String];
  v8 = v3;
  v5 = lockdown_checkin_xpc();
  *(v10 + 6) = v5;
  if (v5)
  {
    maLog("init_lockdown_server", 0, @"failed to checkin with lockdown: 0x%08x", v5);
    v6 = *(v10 + 6) == 0;
  }

  else
  {
    v6 = 1;
  }

LABEL_10:
  _Block_object_dispose(&v9, 8);

  return v6;
}

void sub_1002EF2B4(_Unwind_Exception *a1, uint64_t a2, uint64_t a3, uint64_t a4, uint64_t a5, uint64_t a6, uint64_t a7, uint64_t a8, uint64_t a9, ...)
{
  va_start(va, a9);
  _Block_object_dispose(va, 8);
  _Unwind_Resume(a1);
}

void __init_lockdown_server_block_invoke(uint64_t a1, uint64_t a2, const __CFDictionary *a3)
{
  v85 = 0;
  v86 = 0;
  v80 = 0;
  v81 = &v80;
  v82 = 0x3032000000;
  v83 = __Block_byref_object_copy__2;
  v84 = __Block_byref_object_dispose__2;
  v74 = 0;
  v75 = &v74;
  v76 = 0x3032000000;
  v77 = __Block_byref_object_copy__2;
  v78 = __Block_byref_object_dispose__2;
  v79 = 0;
  if (!a3 || (v5 = [(__CFDictionary *)a3 objectForKeyedSubscript:@"ClientName"], v6 = isNSString(v5), v7 = v6 == 0, v6, v5, v7))
  {
    v8 = @"unknown";
  }

  else
  {
    v8 = CFDictionaryGetValue(a3, @"ClientName");
  }

  v9 = [*(a1 + 32) dark];
  v59 = @"HostProcessName";
  data_ark_set(v9, 0, @"HostProcessName", v8, 0);

  *(*(*(a1 + 40) + 8) + 24) = lockdown_receive_message();
  if (!*(*(*(a1 + 40) + 8) + 24))
  {
    v61 = v86;
    v20 = isNSDictionary(v86);
    v21 = v20 == 0;

    if (v21)
    {
      objc_storeStrong(v75 + 5, @"Error");
      v10 = createMobileActivationError("init_lockdown_server_block_invoke", 115, @"com.apple.MobileActivation.ErrorDomain", -2, 0, @"Invalid request.");
      v11 = 0;
      v12 = 0;
      v13 = 0;
      v14 = 0;
      v60 = 0;
      goto LABEL_7;
    }

    v62 = [v61 objectForKeyedSubscript:@"Command"];
    v22 = isNSString(v62);
    v23 = v22 == 0;

    if (v23)
    {
      objc_storeStrong(v75 + 5, @"Error");
      v10 = createMobileActivationError("init_lockdown_server_block_invoke", 122, @"com.apple.MobileActivation.ErrorDomain", -2, 0, @"Request missing required key: %@", @"Command");
      v11 = 0;
      v12 = 0;
      v13 = 0;
      v14 = 0;
      v60 = 0;
LABEL_33:
      v15 = 0;
      goto LABEL_8;
    }

    v24 = @"Options";
    v25 = [v61 objectForKeyedSubscript:@"Options"];
    v60 = v25;
    if (!v25)
    {
      goto LABEL_19;
    }

    v26 = isNSDictionary(v25);
    v27 = v26 == 0;

    if (v27)
    {
      v37 = @"Invalid request value for key %@.";
      v38 = 130;
      v39 = "init_lockdown_server_block_invoke";
      goto LABEL_30;
    }

    v28 = [v60 objectForKeyedSubscript:@"FactoryActivation"];
    v29 = isNSNumber(v28);

    if (v29)
    {
      v30 = [v60 objectForKeyedSubscript:@"FactoryActivation"];
      v31 = [v30 BOOLValue];
    }

    else
    {
LABEL_19:
      v31 = 0;
    }

    maLog("init_lockdown_server_block_invoke", 0, @"Host connection (%@): %@", v8, v62, @"HostProcessName");
    if (([(__CFString *)v62 isEqualToString:@"CreateActivationInfoRequest"]& 1) != 0 || [(__CFString *)v62 isEqualToString:@"CreateTunnel1ActivationInfoRequest"])
    {
      if (!v31)
      {
        v34 = [v61 objectForKeyedSubscript:@"Value"];
        v18 = isNSData(v34);

        v35 = *(a1 + 32);
        v33 = v72;
        v72[0] = _NSConcreteStackBlock;
        v72[1] = 3254779904;
        v72[2] = __init_lockdown_server_block_invoke_40;
        v72[3] = &__block_descriptor_64_e8_32s40r48r_e34_v24__0__NSDictionary_8__NSError_16l;
        v72[5] = &v74;
        v72[6] = &v80;
        v72[7] = a2;
        v72[4] = v8;
        [v35 createTunnel1ActivationInfo:v18 options:v60 withCompletionBlock:v72];
        v15 = 0;
        v17 = 0;
        v14 = 0;
        v13 = 0;
        v12 = 0;
        goto LABEL_26;
      }

      v32 = *(a1 + 32);
      v33 = v73;
      v73[0] = _NSConcreteStackBlock;
      v73[1] = 3254779904;
      v73[2] = __init_lockdown_server_block_invoke_2;
      v73[3] = &__block_descriptor_64_e8_32s40r48r_e34_v24__0__NSDictionary_8__NSError_16l;
      v73[5] = &v74;
      v73[6] = &v80;
      v73[7] = a2;
      v73[4] = v8;
      [v32 createActivationInfoWithCompletionBlock:v73];
LABEL_24:
      v15 = 0;
      v17 = 0;
      v14 = 0;
      v13 = 0;
      v12 = 0;
      v18 = 0;
LABEL_26:
      v11 = 0;
LABEL_27:
      v36 = (v33 + 4);
LABEL_28:

      v16 = v15;
      goto LABEL_10;
    }

    if ([(__CFString *)v62 isEqualToString:@"HandleActivationInfoWithSessionRequest"])
    {
      v12 = [v61 objectForKeyedSubscript:@"Value"];
      v40 = isNSData(v12);
      v41 = v40 == 0;

      if (!v41)
      {
        v71 = 0;
        v11 = getActivationRecordFromData(v12, &v71);
        v42 = v71;
        if (!v11)
        {
          v51 = v42;
          v70 = v42;
          v11 = getSessionActivationRecordFromData(v12, &v70);
          v15 = v70;

          if (v11)
          {
            v52 = [v61 objectForKeyedSubscript:@"ActivationResponseHeaders"];
            v13 = v52;
            if (!v52 || (v53 = isNSDictionary(v52), v54 = v53 == 0, v53, !v54))
            {
              v14 = [v13 objectForCaseInsensitiveKey:@"ARS"];
              v55 = isNSString(v14);
              v56 = v55 == 0;

              if (v56)
              {
                objc_storeStrong(v75 + 5, @"Error");
                v10 = createMobileActivationError("init_lockdown_server_block_invoke_2", 217, @"com.apple.MobileActivation.ErrorDomain", -2, 0, @"Request contains invalid key: %@", @"ARS");
                goto LABEL_8;
              }

              v17 = [[NSData alloc] initWithBase64EncodedString:v14 options:1];
              if (!v17)
              {
                v16 = createMobileActivationError("init_lockdown_server_block_invoke_2", 223, @"com.apple.MobileActivation.ErrorDomain", -2, 0, @"Invalid activation signature");
                goto LABEL_9;
              }

              v57 = *(a1 + 32);
              v33 = v69;
              v69[0] = _NSConcreteStackBlock;
              v69[1] = 3254779904;
              v69[2] = __init_lockdown_server_block_invoke_3;
              v69[3] = &__block_descriptor_64_e8_32s40r48r_e34_v24__0__NSDictionary_8__NSError_16l;
              v69[5] = &v74;
              v69[6] = &v80;
              v69[7] = a2;
              v69[4] = v8;
              [v57 handleActivationInfoWithSession:v12 activationSignature:v17 completionBlock:v69];
              v18 = 0;
              goto LABEL_27;
            }

            objc_storeStrong(v75 + 5, @"Error");
            v10 = createMobileActivationError("init_lockdown_server_block_invoke_2", 207, @"com.apple.MobileActivation.ErrorDomain", -2, 0, @"Request contains invalid key: %@", @"ActivationResponseHeaders");
          }

          else
          {
            objc_storeStrong(v75 + 5, @"Error");
            v10 = createMobileActivationError("init_lockdown_server_block_invoke_2", 196, @"com.apple.MobileActivation.ErrorDomain", -2, v15, @"Failed to extract activation record.");
            v11 = 0;
            v13 = 0;
          }

          v14 = 0;
          goto LABEL_8;
        }

        v15 = v42;
        v43 = *(a1 + 32);
        v89 = @"ActivationRecord";
        v90 = v11;
        v44 = [NSDictionary dictionaryWithObjects:&v90 forKeys:&v89 count:1];
        v45 = v68;
        v68[0] = _NSConcreteStackBlock;
        v68[1] = 3254779904;
        v68[2] = __init_lockdown_server_block_invoke_4;
        v68[3] = &__block_descriptor_64_e8_32s40r48r_e34_v24__0__NSDictionary_8__NSError_16l;
        v68[5] = &v74;
        v68[6] = &v80;
        v68[7] = a2;
        v68[4] = v8;
        [v43 handleActivationInfo:v44 withCompletionBlock:v68];
LABEL_41:
        v36 = (v45 + 4);

        v17 = 0;
        v14 = 0;
        v13 = 0;
        v18 = 0;
        goto LABEL_28;
      }

      objc_storeStrong(v75 + 5, @"Error");
      v10 = createMobileActivationError("init_lockdown_server_block_invoke_2", 187, @"com.apple.MobileActivation.ErrorDomain", -2, 0, @"Request missing required key: %@", @"Value");
      v11 = 0;
      goto LABEL_32;
    }

    if ([(__CFString *)v62 isEqualToString:@"HandleActivationInfoRequest"])
    {
      v11 = [v61 objectForKeyedSubscript:@"Value"];
      v46 = isNSDictionary(v11);
      v47 = v46 == 0;

      if (!v47)
      {
        v48 = *(a1 + 32);
        v87 = @"ActivationRecord";
        v88 = v11;
        v44 = [NSDictionary dictionaryWithObjects:&v88 forKeys:&v87 count:1];
        v45 = v67;
        v67[0] = _NSConcreteStackBlock;
        v67[1] = 3254779904;
        v67[2] = __init_lockdown_server_block_invoke_5;
        v67[3] = &__block_descriptor_64_e8_32s40r48r_e34_v24__0__NSDictionary_8__NSError_16l;
        v67[5] = &v74;
        v67[6] = &v80;
        v67[7] = a2;
        v67[4] = v8;
        [v48 handleActivationInfo:v44 withCompletionBlock:v67];
        v15 = 0;
        v12 = 0;
        goto LABEL_41;
      }

      objc_storeStrong(v75 + 5, @"Error");
      v10 = createMobileActivationError("init_lockdown_server_block_invoke_2", 253, @"com.apple.MobileActivation.ErrorDomain", -2, 0, @"Request missing required key: %@", @"Value");
      goto LABEL_31;
    }

    if ([(__CFString *)v62 isEqualToString:@"DeactivateRequest"])
    {
      v49 = *(a1 + 32);
      v33 = v66;
      v66[0] = _NSConcreteStackBlock;
      v66[1] = 3254779904;
      v66[2] = __init_lockdown_server_block_invoke_6;
      v66[3] = &__block_descriptor_64_e8_32s40r48r_e34_v24__0__NSDictionary_8__NSError_16l;
      v66[5] = &v74;
      v66[6] = &v80;
      v66[7] = a2;
      v66[4] = v8;
      [v49 deactivateDeviceWithCompletionBlock:v66];
      goto LABEL_24;
    }

    if ([(__CFString *)v62 isEqualToString:@"CreateTunnel1SessionInfoRequest"])
    {
      v50 = *(a1 + 32);
      v33 = v65;
      v65[0] = _NSConcreteStackBlock;
      v65[1] = 3254779904;
      v65[2] = __init_lockdown_server_block_invoke_7;
      v65[3] = &__block_descriptor_64_e8_32s40r48r_e34_v24__0__NSDictionary_8__NSError_16l;
      v65[5] = &v74;
      v65[6] = &v80;
      v65[7] = a2;
      v65[4] = v8;
      [v50 createTunnel1SessionInfoWithCompletionBlock:v65];
      goto LABEL_24;
    }

    if ([(__CFString *)v62 isEqualToString:@"GetActivationStateRequest"])
    {
      v58 = *(a1 + 32);
      v33 = v64;
      v64[0] = _NSConcreteStackBlock;
      v64[1] = 3254779904;
      v64[2] = __init_lockdown_server_block_invoke_8;
      v64[3] = &__block_descriptor_64_e8_32s40r48r_e34_v24__0__NSDictionary_8__NSError_16l;
      v64[5] = &v74;
      v64[6] = &v80;
      v64[7] = a2;
      v64[4] = v8;
      [v58 getActivationStateWithCompletionBlock:v64];
      goto LABEL_24;
    }

    v37 = @"Received unknown command: %@";
    v38 = 312;
    v24 = v62;
    v39 = "init_lockdown_server_block_invoke_2";
LABEL_30:
    objc_storeStrong(v75 + 5, @"Error");
    v10 = createMobileActivationError(v39, v38, @"com.apple.MobileActivation.ErrorDomain", -2, 0, v37, v24);
    v11 = 0;
LABEL_31:
    v12 = 0;
LABEL_32:
    v13 = 0;
    v14 = 0;
    goto LABEL_33;
  }

  objc_storeStrong(v75 + 5, @"Error");
  v10 = createMobileActivationError("init_lockdown_server_block_invoke", 108, @"com.apple.MobileActivation.ErrorDomain", -1, 0, @"Failed to receive request from host: 0x%08x", *(*(*(a1 + 40) + 8) + 24));
  v11 = 0;
  v12 = 0;
  v13 = 0;
  v14 = 0;
  v60 = 0;
  v61 = 0;
LABEL_7:
  v15 = 0;
  v62 = 0;
LABEL_8:
  v16 = v15;
  v15 = v81[5];
  v81[5] = v10;
LABEL_9:

  reply_and_disconnect(a2, v8, v75[5], v81[5]);
  v17 = 0;
  v18 = 0;
LABEL_10:
  v19 = [*(a1 + 32) dark];
  data_ark_remove(v19, 0, v59);

  _Block_object_dispose(&v74, 8);
  _Block_object_dispose(&v80, 8);
}

void sub_1002F0194(_Unwind_Exception *a1)
{
  _Block_object_dispose((v1 - 232), 8);
  _Block_object_dispose((v1 - 184), 8);
  _Unwind_Resume(a1);
}

uint64_t __Block_byref_object_copy__2(uint64_t result, uint64_t a2)
{
  *(result + 40) = *(a2 + 40);
  *(a2 + 40) = 0;
  return result;
}

void __init_lockdown_server_block_invoke_2(uint64_t a1, id a2, void *a3)
{
  v5 = a2;
  v6 = a3;
  v7 = v6;
  v8 = *(*(a1 + 40) + 8);
  if (!v5 || v6)
  {
    objc_storeStrong((v8 + 40), @"Error");
    v9 = createMobileActivationError("init_lockdown_server_block_invoke_2", 151, @"com.apple.MobileActivation.ErrorDomain", -2, v7, @"Failed to retrieve activation info.");
  }

  else
  {
    objc_storeStrong((v8 + 40), @"Value");
    v9 = [v5 copy];
  }

  v10 = *(*(a1 + 48) + 8);
  v11 = *(v10 + 40);
  *(v10 + 40) = v9;

  reply_and_disconnect(*(a1 + 56), *(a1 + 32), *(*(*(a1 + 40) + 8) + 40), *(*(*(a1 + 48) + 8) + 40));
}

void __copy_helper_block_e8_32s40r48r(uint64_t a1, uint64_t a2)
{
  v4 = *(a2 + 32);
  _Block_object_assign((a1 + 40), *(a2 + 40), 8);
  v5 = *(a2 + 48);

  _Block_object_assign((a1 + 48), v5, 8);
}

void __destroy_helper_block_e8_32s40r48r(uint64_t a1)
{
  _Block_object_dispose(*(a1 + 48), 8);
  _Block_object_dispose(*(a1 + 40), 8);
  v2 = *(a1 + 32);
}

void __init_lockdown_server_block_invoke_40(uint64_t a1, id a2, void *a3)
{
  v5 = a2;
  v6 = a3;
  v7 = v6;
  v8 = *(*(a1 + 40) + 8);
  if (!v5 || v6)
  {
    objc_storeStrong((v8 + 40), @"Error");
    v9 = createMobileActivationError("init_lockdown_server_block_invoke", 167, @"com.apple.MobileActivation.ErrorDomain", -2, v7, @"Failed to retrieve activation info.");
  }

  else
  {
    objc_storeStrong((v8 + 40), @"Value");
    v9 = [v5 copy];
  }

  v10 = *(*(a1 + 48) + 8);
  v11 = *(v10 + 40);
  *(v10 + 40) = v9;

  reply_and_disconnect(*(a1 + 56), *(a1 + 32), *(*(*(a1 + 40) + 8) + 40), *(*(*(a1 + 48) + 8) + 40));
}

void __init_lockdown_server_block_invoke_3(void *a1, uint64_t a2, void *a3)
{
  if (a3)
  {
    objc_storeStrong((*(a1[5] + 8) + 40), @"Error");
    v5 = a3;
    v6 = createMobileActivationError("init_lockdown_server_block_invoke_3", 230, @"com.apple.MobileActivation.ErrorDomain", -1, v5, @"Failed to activate device.");

    v7 = *(a1[6] + 8);
    v8 = *(v7 + 40);
    *(v7 + 40) = v6;
  }

  v9 = a1[4];
  v10 = *(*(a1[5] + 8) + 40);
  v11 = a1[7];
  v12 = *(*(a1[6] + 8) + 40);

  reply_and_disconnect(v11, v9, v10, v12);
}

void __init_lockdown_server_block_invoke_4(void *a1, uint64_t a2, void *a3)
{
  if (a3)
  {
    objc_storeStrong((*(a1[5] + 8) + 40), @"Error");
    v5 = a3;
    v6 = createMobileActivationError("init_lockdown_server_block_invoke_4", 240, @"com.apple.MobileActivation.ErrorDomain", -1, v5, @"Failed to activate device.");

    v7 = *(a1[6] + 8);
    v8 = *(v7 + 40);
    *(v7 + 40) = v6;
  }

  v9 = a1[4];
  v10 = *(*(a1[5] + 8) + 40);
  v11 = a1[7];
  v12 = *(*(a1[6] + 8) + 40);

  reply_and_disconnect(v11, v9, v10, v12);
}

void __init_lockdown_server_block_invoke_5(void *a1, uint64_t a2, void *a3)
{
  if (a3)
  {
    objc_storeStrong((*(a1[5] + 8) + 40), @"Error");
    v5 = a3;
    v6 = createMobileActivationError("init_lockdown_server_block_invoke_5", 260, @"com.apple.MobileActivation.ErrorDomain", -1, v5, @"Failed to activate device.");

    v7 = *(a1[6] + 8);
    v8 = *(v7 + 40);
    *(v7 + 40) = v6;
  }

  v9 = a1[4];
  v10 = *(*(a1[5] + 8) + 40);
  v11 = a1[7];
  v12 = *(*(a1[6] + 8) + 40);

  reply_and_disconnect(v11, v9, v10, v12);
}

void __init_lockdown_server_block_invoke_6(void *a1, uint64_t a2, void *a3)
{
  if (a3)
  {
    objc_storeStrong((*(a1[5] + 8) + 40), @"Error");
    v5 = a3;
    v6 = createMobileActivationError("init_lockdown_server_block_invoke_6", 272, @"com.apple.MobileActivation.ErrorDomain", -1, v5, @"Failed to deactivate device.");

    v7 = *(a1[6] + 8);
    v8 = *(v7 + 40);
    *(v7 + 40) = v6;
  }

  v9 = a1[4];
  v10 = *(*(a1[5] + 8) + 40);
  v11 = a1[7];
  v12 = *(*(a1[6] + 8) + 40);

  reply_and_disconnect(v11, v9, v10, v12);
}

void __init_lockdown_server_block_invoke_7(uint64_t a1, id a2, void *a3)
{
  v5 = a2;
  v6 = a3;
  v7 = v6;
  v8 = *(*(a1 + 40) + 8);
  if (!v5 || v6)
  {
    objc_storeStrong((v8 + 40), @"Error");
    v9 = createMobileActivationError("init_lockdown_server_block_invoke_7", 284, @"com.apple.MobileActivation.ErrorDomain", -1, v7, @"Failed to retrieve session info.");
  }

  else
  {
    objc_storeStrong((v8 + 40), @"Value");
    v9 = [v5 copy];
  }

  v10 = *(*(a1 + 48) + 8);
  v11 = *(v10 + 40);
  *(v10 + 40) = v9;

  reply_and_disconnect(*(a1 + 56), *(a1 + 32), *(*(*(a1 + 40) + 8) + 40), *(*(*(a1 + 48) + 8) + 40));
}

void __init_lockdown_server_block_invoke_8(uint64_t a1, id a2, void *a3)
{
  v5 = a2;
  v6 = a3;
  v7 = v6;
  v8 = *(*(a1 + 40) + 8);
  if (!v5 || v6)
  {
    objc_storeStrong((v8 + 40), @"Error");
    v13 = createMobileActivationError("init_lockdown_server_block_invoke_8", 299, @"com.apple.MobileActivation.ErrorDomain", -1, v7, @"Failed to retrieve activation state.");
    v14 = *(*(a1 + 48) + 8);
    v9 = *(v14 + 40);
    *(v14 + 40) = v13;
  }

  else
  {
    objc_storeStrong((v8 + 40), @"Value");
    v9 = [v5 objectForKeyedSubscript:@"ActivationState"];
    v10 = [v9 copy];
    v11 = *(*(a1 + 48) + 8);
    v12 = *(v11 + 40);
    *(v11 + 40) = v10;
  }

  reply_and_disconnect(*(a1 + 56), *(a1 + 32), *(*(*(a1 + 40) + 8) + 40), *(*(*(a1 + 48) + 8) + 40));
}

id lockcrypto_query_certificate_properties(uint64_t a1, id a2, NSError **a3)
{
  v5 = a2;
  v6 = v5;
  v150 = 0;
  v151 = 0;
  v148[1] = 0;
  v149 = 0;
  v147 = 0;
  v148[0] = 0;
  v146 = 0uLL;
  v144 = 0uLL;
  v145 = 0;
  v143 = 0;
  v142 = 0;
  v141 = 0;
  if (!a1 || !v5)
  {
    v9 = createMobileActivationError("lockcrypto_query_certificate_properties", 229, @"com.apple.MobileActivation.ErrorDomain", -2, 0, @"Invalid input(s).");
    v7 = 0;
LABEL_15:
    v8 = 0;
    v15 = 0;
    v16 = 0;
    v17 = 0;
    goto LABEL_180;
  }

  v7 = objc_alloc_init(NSMutableDictionary);
  if (!v7)
  {
    v9 = createMobileActivationError("lockcrypto_query_certificate_properties", 235, @"com.apple.MobileActivation.ErrorDomain", -1, 0, @"Failed to allocate dictionary.");
    goto LABEL_15;
  }

  if (&_SecCertificateCopyExtensionValue)
  {
    v8 = SecCertificateCopyExtensionValue();
    v9 = 0;
    if (v8)
    {
      goto LABEL_6;
    }

LABEL_178:
    v125 = v6;
    v11 = @"Failed to query DERSequence data for OID %@.";
    v12 = 245;
    v13 = -26;
    v14 = v9;
    goto LABEL_179;
  }

  v18 = v6;
  if (lockcrypto_query_oid_der_sequence_data_onceToken != -1)
  {
    lockcrypto_query_certificate_properties_cold_1();
  }

  v19 = SecCertificateCopyProperties();
  v20 = v19;
  v130 = a3;
  v132 = v6;
  if (v19)
  {
    v158 = 0u;
    v159 = 0u;
    v156 = 0u;
    v157 = 0u;
    v126 = v19;
    v21 = v19;
    v22 = [(NSError *)v21 countByEnumeratingWithState:&v156 objects:&v163 count:16];
    if (!v22)
    {
      v24 = 0;
      goto LABEL_175;
    }

    v23 = v22;
    v24 = 0;
    v135 = v7;
    v136 = *v157;
    v127 = v21;
    v128 = v18;
    while (1)
    {
      v25 = 0;
      do
      {
        if (*v157 != v136)
        {
          objc_enumerationMutation(v21);
        }

        v26 = *(*(&v156 + 1) + 8 * v25);
        objc_opt_class();
        if (objc_opt_isKindOfClass())
        {
          v27 = [v26 objectForKeyedSubscript:@"label"];
          objc_opt_class();
          if ((objc_opt_isKindOfClass() & 1) != 0 && [v27 isEqualToString:v18])
          {
            v28 = [v26 objectForKeyedSubscript:@"value"];

            if (v28)
            {
              objc_opt_class();
              if (objc_opt_isKindOfClass())
              {
                v129 = v23;
                v154 = 0u;
                v155 = 0u;
                v152 = 0u;
                v153 = 0u;
                v24 = v28;
                v29 = [v24 countByEnumeratingWithState:&v152 objects:&v160 count:16];
                if (!v29)
                {
                  goto LABEL_46;
                }

                v30 = v29;
                v31 = *v153;
                while (1)
                {
                  for (i = 0; i != v30; i = i + 1)
                  {
                    if (*v153 != v31)
                    {
                      objc_enumerationMutation(v24);
                    }

                    v33 = *(*(&v152 + 1) + 8 * i);
                    objc_opt_class();
                    if ((objc_opt_isKindOfClass() & 1) == 0)
                    {
                      v34 = 0;
LABEL_43:
                      v8 = 0;
                      goto LABEL_44;
                    }

                    v34 = [v33 objectForKeyedSubscript:@"label"];
                    if (!v34)
                    {
                      goto LABEL_43;
                    }

                    objc_opt_class();
                    if ((objc_opt_isKindOfClass() & 1) == 0 || ![v34 isEqualToString:@"Unparsed Data"])
                    {
                      goto LABEL_43;
                    }

                    v8 = [v33 objectForKeyedSubscript:@"value"];
                    if (v8)
                    {
                      objc_opt_class();
                      if ((objc_opt_isKindOfClass() & 1) != 0 && ![v8 isEqualToData:lockcrypto_query_oid_der_sequence_data_ASN1DERNull])
                      {

                        v98 = 0;
                        v7 = v135;
                        v99 = v127;
                        v18 = v128;
                        v20 = v126;
                        goto LABEL_177;
                      }
                    }

LABEL_44:
                  }

                  v30 = [v24 countByEnumeratingWithState:&v152 objects:&v160 count:16];
                  if (!v30)
                  {
LABEL_46:

                    v7 = v135;
                    v21 = v127;
                    v18 = v128;
                    v23 = v129;
                    goto LABEL_48;
                  }
                }
              }

              v24 = v28;
            }

            else
            {
              v24 = 0;
            }
          }
        }

        else
        {
          v27 = 0;
        }

LABEL_48:

        v25 = v25 + 1;
      }

      while (v25 != v23);
      v35 = [(NSError *)v21 countByEnumeratingWithState:&v156 objects:&v163 count:16];
      v23 = v35;
      if (!v35)
      {
LABEL_175:

        v97 = 0;
        v20 = v126;
        goto LABEL_176;
      }
    }
  }

  v97 = createMobileActivationError("lockcrypto_query_oid_der_sequence_data", 137, @"com.apple.MobileActivation.ErrorDomain", -1, 0, @"Failed to copy certificate properties.");
  v24 = 0;
LABEL_176:
  v99 = v97;
  v8 = 0;
  v98 = v99;
LABEL_177:

  v9 = v98;
  a3 = v130;
  v6 = v132;
  if (!v8)
  {
    goto LABEL_178;
  }

LABEL_6:
  v150 = [v8 bytes];
  v151 = [v8 length];
  v10 = DERDecodeSeqInit(&v150, &v149, v148);
  if (v10 == 2)
  {
    v10 = DERDecodeItem(&v150, &v146);
    if (!v10 && v146 == 4)
    {
      v10 = DERDecodeSeqInit(&v146 + 8, &v149, v148);
    }
  }

  if (v10)
  {
    v125 = v10;
    v11 = @"Failed to intialize DER sequence: %d";
    v12 = 267;
LABEL_12:
    v13 = -1;
    v14 = 0;
LABEL_179:
    v100 = createMobileActivationError("lockcrypto_query_certificate_properties", v12, @"com.apple.MobileActivation.ErrorDomain", v13, v14, v11, v125);

    v15 = 0;
    v16 = 0;
    v17 = 0;
    v9 = v100;
    goto LABEL_180;
  }

  if (v149 == 0x2000000000000010)
  {
    v104 = DERDecodeSeqNext(v148, &v146);
    v15 = 0;
    v134 = v6;
    if (v104 || !*(&v146 + 1))
    {
      v16 = 0;
      v17 = 0;
LABEL_231:
      if (v104 != 1)
      {
        v120 = createMobileActivationError("lockcrypto_query_certificate_properties", 299, @"com.apple.MobileActivation.ErrorDomain", -1, 0, @"Failed to decode DER sequence: %d", v104);

        v9 = v120;
      }

      v6 = v134;
      goto LABEL_180;
    }

    v17 = 0;
    v16 = 0;
    v15 = 0;
    while (1)
    {
      v105 = v15;
      v106 = [NSNumber numberWithUnsignedLongLong:v146 & 0x5FFFFFFFFFFFFFFFLL];
      v15 = [(NSNumber *)v106 stringValue];

      if (!DERDecodeItem(&v146 + 8, &v144))
      {
        v146 = v144;
        v147 = v145;
      }

      v107 = v146 & 0x5FFFFFFFFFFFFFFFLL;
      if ((v146 & 0x5FFFFFFFFFFFFFFFLL) == 1)
      {
        v113 = DERParseBoolean(&v146 + 1, &v141);
        if (v113)
        {
          MobileActivationError = createMobileActivationError("lockcrypto_query_certificate_properties", 353, @"com.apple.MobileActivation.ErrorDomain", -1, 0, @"Failed to decode DER encoded ASN1_BOOLEAN: %d", v113);
LABEL_209:
          v114 = MobileActivationError;

LABEL_210:
          v9 = v114;
          goto LABEL_220;
        }

        v117 = [NSNumber numberWithBool:v141];
      }

      else
      {
        if (v107 != 2)
        {
          if (v107 != 4)
          {
            goto LABEL_220;
          }

          if (v147)
          {
            v108 = 0;
            v109 = 0;
            while ((*(*(&v146 + 1) + v108) & 0x80000000) == 0)
            {
              v108 = ++v109;
              if (v147 <= v109)
              {
                v110 = [NSString alloc];
                v17 = [v110 initWithBytes:*(&v146 + 1) length:v147 encoding:1];
                if (v17)
                {
                  v16 = 0;
                  goto LABEL_213;
                }

                v114 = createMobileActivationError("lockcrypto_query_certificate_properties", 326, @"com.apple.MobileActivation.ErrorDomain", -1, 0, @"Failed to decode DER encoded ANS1_OCTET_STRING.");

                v16 = 0;
                goto LABEL_210;
              }
            }
          }

          v115 = [NSData alloc];
          v16 = [v115 initWithBytes:*(&v146 + 1) length:v147];
          if (v16)
          {
            v17 = 0;
LABEL_213:
            if (v17)
            {
              v116 = v17;
            }

            else
            {
              v116 = v16;
            }

            [v7 setObject:v116 forKeyedSubscript:v15];
            goto LABEL_220;
          }

          v114 = createMobileActivationError("lockcrypto_query_certificate_properties", 332, @"com.apple.MobileActivation.ErrorDomain", -1, 0, @"Failed to decode DER encoded ANS1_OCTET_STRING.");

          v17 = 0;
          goto LABEL_210;
        }

        v111 = DERParseInteger64(&v146 + 8, &v142);
        if (v111)
        {
          MobileActivationError = createMobileActivationError("lockcrypto_query_certificate_properties", 343, @"com.apple.MobileActivation.ErrorDomain", -1, 0, @"Failed to decode DER encoded ASN1_INTEGER: %d", v111);
          goto LABEL_209;
        }

        v117 = [NSNumber numberWithUnsignedLongLong:v142];
      }

      v118 = v117;
      [v7 setObject:v117 forKeyedSubscript:v15];

LABEL_220:
      v104 = DERDecodeSeqNext(v148, &v146);
      if (v104 || !*(&v146 + 1))
      {
        goto LABEL_231;
      }
    }
  }

  if (v149 != 0x2000000000000011)
  {
    v11 = @"Expected ASN1_CONSTR_SET or ASN1_CONSTR_SEQUENCE tag.";
    v12 = 717;
    goto LABEL_12;
  }

  v156 = 0uLL;
  v152 = 0uLL;
  v163 = 0;
  v164 = 0;
  v165 = 0;
  v36 = DERDecodeSeqNext(v148, &v146);
  v37 = 0;
  v131 = a3;
  v133 = v6;
  if (!v36)
  {
    v38 = *(&v146 + 1);
    if (*(&v146 + 1))
    {
      v17 = 0;
      v16 = 0;
      v15 = 0;
      v39 = @"com.apple.MobileActivation.ErrorDomain";
      while (1)
      {
        *&v156 = v38;
        *(&v156 + 1) = v147;
        v40 = DERDecodeSeqInit(&v156, &v149, &v152);
        if (v40)
        {
          v121 = createMobileActivationError("lockcrypto_query_certificate_properties", 479, v39, -1, 0, @"Failed to intialize DER sequence: %d", v40);
          goto LABEL_240;
        }

        if (v149 != 0x2000000000000010)
        {
          v121 = createMobileActivationError("lockcrypto_query_certificate_properties", 484, v39, -1, 0, @"Expected ASN1_CONSTR_SEQUENCE tag.", v125);
          goto LABEL_240;
        }

        v41 = DERDecodeSeqNext(&v152, &v163);
        if (v41 || !v164)
        {
          break;
        }

        if (v163 != 22)
        {
          v121 = createMobileActivationError("lockcrypto_query_certificate_properties", 497, v39, -1, 0, @"Invalid DER tag.", v125);
          goto LABEL_240;
        }

        v42 = DERParseInteger(&v164, &v143);
        if (v42)
        {
          v121 = createMobileActivationError("lockcrypto_query_certificate_properties", 503, v39, -1, 0, @"Failed to parse DER integer: %d", v42);
          goto LABEL_240;
        }

        if (v165 != 4)
        {
          v121 = createMobileActivationError("lockcrypto_query_certificate_properties", 508, v39, -1, 0, @"Invalid property key length: %ld", v165);
          goto LABEL_240;
        }

        v43 = [NSString alloc];
        v37 = [v43 initWithBytes:v164 length:v165 encoding:1];

        if (!v37)
        {
          v122 = createMobileActivationError("lockcrypto_query_certificate_properties", 514, v39, -1, 0, @"Failed to create string.");

          v15 = 0;
          goto LABEL_241;
        }

        v44 = DERDecodeSeqNext(&v152, &v163);
        if (v44 || !v164)
        {
          v124 = createMobileActivationError("lockcrypto_query_certificate_properties", 520, v39, -1, 0, @"Failed to decode DER sequence: %d", v44);
LABEL_244:
          v123 = v124;

LABEL_245:
          v9 = v123;
LABEL_247:
          v15 = v37;
          goto LABEL_248;
        }

        if (v163 <= 1)
        {
          switch(v163)
          {
            case 0xA000000000000000:
              v54 = v7;
              v55 = &off_1003FBC48;
              break;
            case 0xA000000000000001:
              v54 = v7;
              v55 = &off_1003FBC60;
              break;
            case 1:
              v45 = DERParseBoolean(&v164, &v141);
              if (!v45)
              {
                v46 = [NSNumber numberWithBool:v141];
LABEL_91:
                v57 = v46;
                [v7 setObject:v46 forKeyedSubscript:v37];

                goto LABEL_149;
              }

              v124 = createMobileActivationError("lockcrypto_query_certificate_properties", 559, v39, -1, 0, @"Failed to decode DER encoded ASN1_BOOLEAN: %d", v45);
              goto LABEL_244;
            default:
              goto LABEL_149;
          }

LABEL_148:
          [v54 setObject:v55 forKeyedSubscript:v37];
          goto LABEL_149;
        }

        if (v163 == 2)
        {
          v56 = DERParseInteger64(&v164, &v142);
          if (!v56)
          {
            v46 = [NSNumber numberWithUnsignedLongLong:v142];
            goto LABEL_91;
          }

          v124 = createMobileActivationError("lockcrypto_query_certificate_properties", 551, v39, -1, 0, @"Failed to decode DER encoded ASN1_INTEGER: %d", v56);
          goto LABEL_244;
        }

        if (v163 != 0x2000000000000011)
        {
          if (v163 != 4)
          {
            goto LABEL_149;
          }

          if (v165)
          {
            v47 = 0;
            v48 = 0;
            while ((v164[v47] & 0x80000000) == 0)
            {
              v47 = ++v48;
              if (v165 <= v48)
              {
                v49 = DERDecodeItem(&v164, &v144);
                v50 = [NSString alloc];
                v51 = &v144 + 1;
                if (v49)
                {
                  v51 = &v164;
                }

                v52 = *v51;
                v53 = &v145;
                if (v49)
                {
                  v53 = &v165;
                }

                v17 = [v50 initWithBytes:v52 length:*v53 encoding:1];
                if (!v17)
                {
                  v124 = createMobileActivationError("lockcrypto_query_certificate_properties", 536, v39, -1, 0, @"Failed to decode DER encoded ANS1_OCTET_STRING.", v125);
                  goto LABEL_244;
                }

                goto LABEL_144;
              }
            }
          }

          v90 = [NSData alloc];
          v91 = [v90 initWithBytes:v164 length:v165];

          if (!v91)
          {
            v123 = createMobileActivationError("lockcrypto_query_certificate_properties", 542, v39, -1, 0, @"Failed to decode DER encoded ANS1_OCTET_STRING.");

            v16 = 0;
            v17 = 0;
            goto LABEL_245;
          }

          v17 = 0;
          v16 = v91;
LABEL_144:
          if (v17)
          {
            v55 = v17;
          }

          else
          {
            v55 = v16;
          }

          v54 = v7;
          goto LABEL_148;
        }

        v58 = DERDecodeSeqContentInit(&v164, &v152);
        if (v58)
        {
          v124 = createMobileActivationError("lockcrypto_query_certificate_properties", 571, v39, -1, 0, @"Failed to intialize DER sequence: %d", v58);
          goto LABEL_244;
        }

        v59 = objc_alloc_init(NSMutableDictionary);
        [v7 setObject:v59 forKeyedSubscript:v37];

        v139 = 0;
        v140 = 0;
        v137 = 0;
        v138 = 0;
        v160 = 0;
        v161 = 0;
        v162 = 0;
        v60 = DERDecodeSeqNext(&v152, &v163);
        if (!v60)
        {
          v61 = v164;
          if (v164)
          {
            while (1)
            {
              v139 = v61;
              v140 = v165;
              v62 = DERDecodeSeqInit(&v139, &v149, &v137);
              if (v62)
              {
                v93 = createMobileActivationError("lockcrypto_query_certificate_properties", 601, v39, -1, 0, @"Failed to intialize DER sequence: %d", v62);
                goto LABEL_156;
              }

              if (v149 != 0x2000000000000010)
              {
                v93 = createMobileActivationError("lockcrypto_query_certificate_properties", 606, v39, -1, 0, @"Expected ASN1_CONSTR_SEQUENCE tag.", v125);
                goto LABEL_156;
              }

              v63 = DERDecodeSeqNext(&v137, &v160);
              if (v63 || !v161)
              {
                v93 = createMobileActivationError("lockcrypto_query_certificate_properties", 614, v39, -1, 0, @"Failed to decode DER sequence: %d", v63);
                goto LABEL_156;
              }

              if (v160 != 22)
              {
                v93 = createMobileActivationError("lockcrypto_query_certificate_properties", 619, v39, -1, 0, @"Invalid DER tag.", v125);
                goto LABEL_156;
              }

              v64 = DERParseInteger(&v161, &v143);
              if (v64)
              {
                v93 = createMobileActivationError("lockcrypto_query_certificate_properties", 625, v39, -1, 0, @"Failed to parse DER integer: %d", v64);
                goto LABEL_156;
              }

              if (v162 != 4)
              {
                v93 = createMobileActivationError("lockcrypto_query_certificate_properties", 630, v39, -1, 0, @"Invalid property key length: %ld", v165);
                goto LABEL_156;
              }

              v65 = [NSString alloc];
              v66 = [v65 initWithBytes:v161 length:v162 encoding:1];
              if (!v66)
              {
                v93 = createMobileActivationError("lockcrypto_query_certificate_properties", 636, v39, -1, 0, @"Failed to create string.", v125);
                goto LABEL_156;
              }

              v67 = v66;
              v68 = DERDecodeSeqNext(&v137, &v160);
              if (v68 || !v161)
              {
                v95 = createMobileActivationError("lockcrypto_query_certificate_properties", 644, v39, -1, 0, @"Failed to decode DER sequence: %d", v68);
LABEL_167:
                v94 = v95;

                v9 = v67;
                goto LABEL_157;
              }

              if (v160 > 0)
              {
                break;
              }

              if (v160 == 0xA000000000000000)
              {
                v77 = [v7 objectForKeyedSubscript:v37];
                v78 = v77;
                v79 = &off_1003FBC48;
              }

              else
              {
                if (v160 != 0xA000000000000001)
                {
                  goto LABEL_138;
                }

                v77 = [v7 objectForKeyedSubscript:v37];
                v78 = v77;
                v79 = &off_1003FBC60;
              }

              [(NSNumber *)v77 setObject:v79 forKeyedSubscript:v67];
LABEL_137:

LABEL_138:
              v89 = DERDecodeSeqNext(&v137, &v160);
              if (v89 != 1)
              {
                v95 = createMobileActivationError("lockcrypto_query_certificate_properties", 696, v39, -1, 0, @"DER sequence is invalid: %d", v89);
                goto LABEL_167;
              }

              v139 = 0;
              v140 = 0;
              v137 = 0;
              v138 = 0;
              v160 = 0;
              v161 = 0;
              v162 = 0;
              v60 = DERDecodeSeqNext(&v152, &v163);
              if (!v60)
              {
                v61 = v164;
                if (v164)
                {
                  continue;
                }
              }

              goto LABEL_154;
            }

            switch(v160)
            {
              case 1:
                v71 = v39;
                v80 = DERParseBoolean(&v161, &v141);
                if (v80)
                {
                  v96 = createMobileActivationError("lockcrypto_query_certificate_properties", 683, v39, -1, 0, @"Failed to decode DER encoded ASN1_BOOLEAN: %d", v80);
                  goto LABEL_171;
                }

                v81 = [NSNumber numberWithBool:v141];
                break;
              case 2:
                v71 = v39;
                v82 = DERParseInteger64(&v161, &v142);
                if (v82)
                {
                  v96 = createMobileActivationError("lockcrypto_query_certificate_properties", 675, v39, -1, 0, @"Failed to decode DER encoded ASN1_INTEGER: %d", v82);
LABEL_171:
                  v94 = v96;

LABEL_172:
                  v9 = v67;
LABEL_157:

                  v9 = v94;
                  goto LABEL_149;
                }

                v81 = [NSNumber numberWithUnsignedLongLong:v142];
                break;
              case 4:

                if (v162)
                {
                  v69 = 0;
                  v70 = 0;
                  while ((v161[v69] & 0x80000000) == 0)
                  {
                    v69 = ++v70;
                    if (v162 <= v70)
                    {
                      v71 = v39;
                      v72 = DERDecodeItem(&v161, &v144);
                      v73 = [NSString alloc];
                      v74 = &v144 + 1;
                      if (v72)
                      {
                        v74 = &v161;
                      }

                      v75 = *v74;
                      v76 = &v145;
                      if (v72)
                      {
                        v76 = &v162;
                      }

                      v17 = [v73 initWithBytes:v75 length:*v76 encoding:1];
                      if (!v17)
                      {
                        v96 = createMobileActivationError("lockcrypto_query_certificate_properties", 660, v39, -1, 0, @"Failed to decode DER encoded ANS1_OCTET_STRING.", v125);
                        goto LABEL_171;
                      }

                      goto LABEL_132;
                    }
                  }
                }

                v71 = v39;
                v86 = [NSData alloc];
                v87 = [v86 initWithBytes:v161 length:v162];

                if (!v87)
                {
                  v94 = createMobileActivationError("lockcrypto_query_certificate_properties", 666, v39, -1, 0, @"Failed to decode DER encoded ANS1_OCTET_STRING.");

                  v16 = 0;
                  v17 = 0;
                  goto LABEL_172;
                }

                v17 = 0;
                v16 = v87;
LABEL_132:
                if (v17)
                {
                  v88 = v17;
                }

                else
                {
                  v88 = v16;
                }

                v78 = [v7 objectForKeyedSubscript:v37];
                [(NSNumber *)v78 setObject:v88 forKeyedSubscript:v67];
                goto LABEL_136;
              default:
                goto LABEL_138;
            }

            v78 = v81;
            v83 = v7;
            v84 = [v7 objectForKeyedSubscript:v37];
            [v84 setObject:v78 forKeyedSubscript:v67];
            v85 = v84;
            v7 = v83;

LABEL_136:
            v39 = v71;
            goto LABEL_137;
          }
        }

LABEL_154:
        if (v60 != 1)
        {
          v93 = createMobileActivationError("lockcrypto_query_certificate_properties", 590, v39, -1, 0, @"Failed to decode DER sequence: %d", v60);
LABEL_156:
          v94 = v93;
          goto LABEL_157;
        }

LABEL_149:
        if (v9)
        {
          goto LABEL_247;
        }

        v92 = DERDecodeSeqNext(&v152, &v163);
        if (v92 != 1)
        {
          v9 = createMobileActivationError("lockcrypto_query_certificate_properties", 710, v39, -1, 0, @"DER sequence is invalid: %d", v92);
          goto LABEL_247;
        }

        v156 = 0uLL;
        v152 = 0uLL;
        v163 = 0;
        v164 = 0;
        v165 = 0;
        v36 = DERDecodeSeqNext(v148, &v146);
        v9 = 0;
        if (!v36)
        {
          v38 = *(&v146 + 1);
          v15 = v37;
          if (*(&v146 + 1))
          {
            continue;
          }
        }

        goto LABEL_227;
      }

      v121 = createMobileActivationError("lockcrypto_query_certificate_properties", 492, v39, -1, 0, @"Failed to decode DER sequence: %d", v41);
LABEL_240:
      v122 = v121;

LABEL_241:
      v9 = v122;
LABEL_248:
      a3 = v131;
      v6 = v133;
      goto LABEL_180;
    }
  }

  v16 = 0;
  v17 = 0;
LABEL_227:
  a3 = v131;
  v6 = v133;
  if (v36 != 1)
  {
    v119 = createMobileActivationError("lockcrypto_query_certificate_properties", 468, @"com.apple.MobileActivation.ErrorDomain", -1, 0, @"Failed to decode DER sequence: %d", v36);

    v9 = v119;
  }

  v15 = v37;
LABEL_180:
  if (v9)
  {
LABEL_181:

    goto LABEL_182;
  }

  if (v7)
  {
    if ([v7 count])
    {
      goto LABEL_188;
    }

    goto LABEL_181;
  }

LABEL_182:
  if (a3)
  {
    v101 = v9;
    v7 = 0;
    *a3 = v9;
  }

  else
  {
    v7 = 0;
  }

LABEL_188:
  v102 = v7;

  return v102;
}

uint64_t lockcrypto_digest_data(void *a1, void *a2)
{
  v3 = a1;
  if (!v3 || !a2)
  {
    MobileActivationError = createMobileActivationError("lockcrypto_digest_data", 744, @"com.apple.MobileActivation.ErrorDomain", -2, 0, @"Invalid input(s).");
LABEL_8:
    v7 = MobileActivationError;
    goto LABEL_9;
  }

  v4 = malloc_type_calloc(1uLL, 0x14uLL, 0x6F598F81uLL);
  if (!v4)
  {
    MobileActivationError = createMobileActivationError("lockcrypto_digest_data", 750, @"com.apple.MobileActivation.ErrorDomain", -1, 0, @"Failed to allocate memory.");
    goto LABEL_8;
  }

  v5 = v4;
  [v3 bytes];
  [v3 length];
  if (!CCDigest())
  {
    *a2 = v5;
    v9 = 20;
    goto LABEL_10;
  }

  v6 = createMobileActivationError("lockcrypto_digest_data", 761, @"com.apple.MobileActivation.ErrorDomain", -1, 0, @"Failed to digest data.");
  free(v5);
  v7 = v6;
LABEL_9:

  v9 = 0xFFFFFFFFLL;
LABEL_10:

  return v9;
}

char *lockcrypto_create_pem_from_key(__SecKey *a1, const char *a2, NSError **a3)
{
  error = 0;
  if (a1 && a2)
  {
    v5 = SecKeyCopyExternalRepresentation(a1, &error);
    v6 = v5;
    if (v5)
    {
      v12 = 0;
      v7 = lockcrypto_create_pem(v5, a2, &v12);
      v8 = v12;
      if (v7)
      {
        goto LABEL_11;
      }

      v9 = createMobileActivationError("lockcrypto_create_pem_from_key", 800, @"com.apple.MobileActivation.ErrorDomain", -1, v8, @"Failed to create pem data.");

      v8 = v9;
      if (!a3)
      {
        goto LABEL_10;
      }

LABEL_8:
      v10 = v8;
      v7 = 0;
      *a3 = v8;
      goto LABEL_11;
    }

    v8 = createMobileActivationError("lockcrypto_create_pem_from_key", 794, @"com.apple.MobileActivation.ErrorDomain", -1, error, @"Failed to convert SecKey to data.");
    if (a3)
    {
      goto LABEL_8;
    }
  }

  else
  {
    v8 = createMobileActivationError("lockcrypto_create_pem_from_key", 788, @"com.apple.MobileActivation.ErrorDomain", -2, 0, @"Invalid input(s).");
    v6 = 0;
    if (a3)
    {
      goto LABEL_8;
    }
  }

LABEL_10:
  v7 = 0;
LABEL_11:
  if (error)
  {
    CFRelease(error);
  }

  return v7;
}

char *lockcrypto_create_pem(void *a1, const char *a2, NSError **a3)
{
  v5 = a1;
  v25 = 0u;
  v26 = 0u;
  v23 = 0u;
  v24 = 0u;
  v21 = 0u;
  *__str = 0u;
  v19 = 0u;
  v20 = 0u;
  *__src = 0u;
  v18 = 0u;
  if (!v5 || !a2)
  {
    v14 = createMobileActivationError("lockcrypto_create_pem", 1376, @"com.apple.MobileActivation.ErrorDomain", -2, 0, @"Invalid input(s).");
    v8 = 0;
    if (!a3)
    {
      goto LABEL_14;
    }

    goto LABEL_12;
  }

  v6 = objc_autoreleasePoolPush();
  v7 = [v5 base64EncodedDataWithOptions:1];
  v8 = [v7 length];
  if (!v8)
  {
    goto LABEL_6;
  }

  v9 = snprintf(__str, 0x50uLL, "-----BEGIN %s-----\n", a2);
  v10 = &v8[v9 + snprintf(__src, 0x50uLL, "\n-----END %s-----", a2)];
  v11 = malloc_type_malloc((v10 + 1), 0x79512C65uLL);
  if (v11)
  {
    v12 = v11;
    v13 = &strcpy(v11, __str)[v9];
    [v7 getBytes:v13 range:{0, v8}];
    strcpy(&v8[v13], __src);
    v8 = [[NSData alloc] initWithBytesNoCopy:v12 length:v10];
    if (v8)
    {
LABEL_6:
      v14 = 0;
      goto LABEL_11;
    }

    v14 = createMobileActivationError("lockcrypto_create_pem", 1404, @"com.apple.MobileActivation.ErrorDomain", -1, 0, @"Failed to create pem data.");
    free(v12);
  }

  else
  {
    v14 = createMobileActivationError("lockcrypto_create_pem", 1391, @"com.apple.MobileActivation.ErrorDomain", -1, 0, @"Failed to allocate buffer.");
    v8 = 0;
  }

LABEL_11:

  objc_autoreleasePoolPop(v6);
  if (!a3)
  {
    goto LABEL_14;
  }

LABEL_12:
  if (!v8)
  {
    v15 = v14;
    *a3 = v14;
  }

LABEL_14:

  return v8;
}

uint64_t lockcrypto_genenerate_keypair(uint64_t a1, char **a2, char **a3, NSError **a4)
{
  error = 0;
  v30[0] = kSecAttrKeyTypeRSA;
  v29[0] = kSecAttrKeyType;
  v29[1] = kSecAttrKeySizeInBits;
  v7 = [NSNumber numberWithUnsignedInt:a1];
  v30[1] = v7;
  v8 = [NSDictionary dictionaryWithObjects:v30 forKeys:v29 count:2];

  v9 = SecKeyCreateRandomKey(v8, &error);
  v10 = v9;
  if (!v9)
  {
    v17 = createMobileActivationError("lockcrypto_genenerate_keypair", 835, @"com.apple.MobileActivation.ErrorDomain", -1, error, @"Failed to generate private key.");
    v13 = 0;
    v12 = 0;
    if (!a4)
    {
      goto LABEL_15;
    }

    goto LABEL_14;
  }

  v11 = SecKeyCopyPublicKey(v9);
  v12 = v11;
  if (!v11)
  {
    v17 = createMobileActivationError("lockcrypto_genenerate_keypair", 841, @"com.apple.MobileActivation.ErrorDomain", -1, 0, @"Failed to query public key.");
    v13 = 0;
    if (!a4)
    {
      goto LABEL_15;
    }

    goto LABEL_14;
  }

  v27 = 0;
  v13 = lockcrypto_create_pem_from_key(v11, "RSA PUBLIC KEY", &v27);
  v14 = v27;
  if (!a2)
  {
    v15 = createMobileActivationError("lockcrypto_genenerate_keypair", 847, @"com.apple.MobileActivation.ErrorDomain", -1, v14, @"Failed to create public key pem data.");

    v14 = v15;
  }

  v26 = v14;
  v16 = lockcrypto_create_pem_from_key(v10, "RSA PRIVATE KEY", &v26);
  v17 = v26;

  if (!v16)
  {
    v25 = createMobileActivationError("lockcrypto_genenerate_keypair", 852, @"com.apple.MobileActivation.ErrorDomain", -1, v17, @"Failed to create private key pem data.");

    v17 = v25;
    if (!a4)
    {
LABEL_15:
      v16 = 0;
      v20 = 0;
      v22 = 0;
      v23 = 0;
      if (!v12)
      {
        goto LABEL_17;
      }

      goto LABEL_16;
    }

LABEL_14:
    v21 = v17;
    *a4 = v17;
    goto LABEL_15;
  }

  if (a2)
  {
    v18 = v13;
    *a2 = v13;
  }

  if (a3)
  {
    v19 = v16;
    *a3 = v16;
  }

  v20 = 1;
LABEL_16:
  CFRelease(v12);
  v22 = v16;
  v23 = v20;
LABEL_17:
  if (v10)
  {
    CFRelease(v10);
  }

  if (error)
  {
    CFRelease(error);
  }

  error = 0;

  return v23;
}

id lockcrypto_sign(__SecKey *a1, id a2, NSError **a3)
{
  v5 = a2;
  v6 = v5;
  sigLen = 0;
  dataToSign = 0;
  if (!a1 || !v5)
  {
    MobileActivationError = createMobileActivationError("lockcrypto_sign", 891, @"com.apple.MobileActivation.ErrorDomain", -2, 0, @"Invalid input(s).");
    goto LABEL_9;
  }

  v7 = lockcrypto_digest_data(v5, &dataToSign);
  if (v7 <= 0)
  {
    MobileActivationError = createMobileActivationError("lockcrypto_sign", 899, @"com.apple.MobileActivation.ErrorDomain", -1, 0, @"Failed to digest data.");
LABEL_9:
    v13 = MobileActivationError;
    v9 = 0;
    if (!a3)
    {
LABEL_13:
      v15 = 0;
      goto LABEL_14;
    }

LABEL_10:
    v14 = v13;
    v15 = 0;
    *a3 = v13;
    goto LABEL_14;
  }

  v8 = v7;
  sigLen = SecKeyGetBlockSize(a1);
  v9 = malloc_type_malloc(sigLen, 0x66E43323uLL);
  if (!v9)
  {
    v11 = createMobileActivationError("lockcrypto_sign", 909, @"com.apple.MobileActivation.ErrorDomain", -1, 0, @"Failed to allocate memory.");
    goto LABEL_12;
  }

  v10 = SecKeyRawSign(a1, 0x8002u, dataToSign, v8, v9, &sigLen);
  if (v10)
  {
    v11 = createMobileActivationError("lockcrypto_sign", 920, @"com.apple.MobileActivation.ErrorDomain", -1, 0, @"Failed to sign data: %ld", v10);
    goto LABEL_12;
  }

  v17 = [NSData alloc];
  v18 = [v17 initWithBytesNoCopy:v9 length:sigLen];
  if (!v18)
  {
    v11 = createMobileActivationError("lockcrypto_sign", 928, @"com.apple.MobileActivation.ErrorDomain", -1, 0, @"Failed to encode signature.");
LABEL_12:
    v13 = v11;
    if (!a3)
    {
      goto LABEL_13;
    }

    goto LABEL_10;
  }

  v15 = v18;
  v13 = 0;
  v9 = 0;
LABEL_14:
  if (dataToSign)
  {
    free(dataToSign);
  }

  dataToSign = 0;
  if (v9)
  {
    free(v9);
  }

  return v15;
}

uint64_t lockcrypto_verify(__SecKey *a1, id a2, void *a3, NSError **a4)
{
  v7 = a2;
  v8 = a3;
  v9 = v8;
  signedData = 0;
  if (a1 && v7 && v8)
  {
    v10 = lockcrypto_digest_data(v8, &signedData);
    if (v10 <= 0)
    {
      v15 = @"Invalid digest length.";
      v16 = 971;
    }

    else
    {
      v11 = v10;
      v12 = [v7 bytes];
      v13 = [v7 length];
      v14 = SecKeyRawVerify(a1, 0x8002u, signedData, v11, v12, v13);
      if (!v14)
      {
        v19 = 0;
        v21 = 1;
        goto LABEL_14;
      }

      v23 = v14;
      v15 = @"Failed to verify signature: %d";
      v16 = 987;
    }

    MobileActivationError = createMobileActivationError("lockcrypto_verify", v16, @"com.apple.MobileActivation.ErrorDomain", -1, 0, v15, v23);
  }

  else
  {
    MobileActivationError = createMobileActivationError("lockcrypto_verify", 963, @"com.apple.MobileActivation.ErrorDomain", -2, 0, @"Invalid input(s).");
  }

  v18 = MobileActivationError;
  v19 = v18;
  if (a4)
  {
    v20 = v18;
    v21 = 0;
    *a4 = v19;
  }

  else
  {
    v21 = 0;
  }

LABEL_14:
  if (signedData)
  {
    free(signedData);
  }

  signedData = 0;

  return v21;
}

id lockcrypto_extract_public_key_size(__SecCertificate *a1, NSError **a2)
{
  error = 0;
  v3 = SecCertificateCopyKey(a1);
  v4 = v3;
  if (v3)
  {
    v5 = SecKeyCopyExternalRepresentation(v3, &error);
    if (v5)
    {
      v6 = v5;
      v7 = [(__CFData *)v5 length];

      v8 = 0;
      if (!a2)
      {
        goto LABEL_10;
      }

      goto LABEL_8;
    }

    MobileActivationError = createMobileActivationError("lockcrypto_extract_public_key_size", 1025, @"com.apple.MobileActivation.ErrorDomain", -1, error, @"Failed to copy public key data.");
  }

  else
  {
    MobileActivationError = createMobileActivationError("lockcrypto_extract_public_key_size", 1019, @"com.apple.MobileActivation.ErrorDomain", -1, 0, @"Failed to copy public key.");
  }

  v8 = MobileActivationError;
  v7 = 0;
  if (!a2)
  {
    goto LABEL_10;
  }

LABEL_8:
  if (!v7)
  {
    v10 = v8;
    *a2 = v8;
  }

LABEL_10:
  if (error)
  {
    CFRelease(error);
  }

  error = 0;
  if (v4)
  {
    CFRelease(v4);
  }

  return v7;
}

SecKeyRef lockcrypto_extract_public(void *a1, NSError **a2)
{
  v3 = a1;
  trust = 0;
  if (!v3)
  {
    v6 = createMobileActivationError("lockcrypto_extract_public", 1052, @"com.apple.MobileActivation.ErrorDomain", -2, 0, @"Invalid input.");
    BasicX509 = 0;
    if (a2)
    {
LABEL_9:
      v8 = v6;
      v7 = 0;
      *a2 = v6;
      goto LABEL_10;
    }

LABEL_6:
    v7 = 0;
    goto LABEL_10;
  }

  BasicX509 = SecPolicyCreateBasicX509();
  if (!BasicX509)
  {
    MobileActivationError = createMobileActivationError("lockcrypto_extract_public", 1058, @"com.apple.MobileActivation.ErrorDomain", -1, 0, @"Failed to create policy.");
    goto LABEL_8;
  }

  if (SecTrustCreateWithCertificates(v3, BasicX509, &trust))
  {
    MobileActivationError = createMobileActivationError("lockcrypto_extract_public", 1067, @"com.apple.MobileActivation.ErrorDomain", -1, 0, @"Failed to create trust.");
    goto LABEL_8;
  }

  v10 = SecTrustCopyPublicKey(trust);
  if (!v10)
  {
    MobileActivationError = createMobileActivationError("lockcrypto_extract_public", 1076, @"com.apple.MobileActivation.ErrorDomain", -1, 0, @"Failed to copy public key.");
LABEL_8:
    v6 = MobileActivationError;
    if (a2)
    {
      goto LABEL_9;
    }

    goto LABEL_6;
  }

  v7 = v10;
  v6 = 0;
LABEL_10:
  if (trust)
  {
    CFRelease(trust);
  }

  trust = 0;
  if (BasicX509)
  {
    CFRelease(BasicX509);
  }

  return v7;
}

SecKeyRef lockcrypto_extract_public_with_intermediate(void *a1, NSError **a2)
{
  v3 = a1;
  trust = 0;
  result = kSecTrustResultInvalid;
  if (!v3)
  {
    v6 = createMobileActivationError("lockcrypto_extract_public_with_intermediate", 1101, @"com.apple.MobileActivation.ErrorDomain", -2, 0, @"Invalid input.");
    v4 = 0;
    if (a2)
    {
LABEL_9:
      v7 = v6;
      v8 = 0;
      *a2 = v6;
      goto LABEL_13;
    }

    goto LABEL_12;
  }

  v4 = SecPolicyCreateiPhoneActivation();
  if (!v4)
  {
    MobileActivationError = createMobileActivationError("lockcrypto_extract_public_with_intermediate", 1107, @"com.apple.MobileActivation.ErrorDomain", -1, 0, @"Failed to create policy.");
    goto LABEL_8;
  }

  if (SecTrustCreateWithCertificates(v3, v4, &trust))
  {
    MobileActivationError = createMobileActivationError("lockcrypto_extract_public_with_intermediate", 1112, @"com.apple.MobileActivation.ErrorDomain", -1, 0, @"Failed to create trust.");
    goto LABEL_8;
  }

  v9 = SecTrustEvaluate(trust, &result);
  v10 = result;
  if (v9 || result != kSecTrustResultProceed && result != kSecTrustResultUnspecified)
  {
    v11 = SecTrustCopyFailureDescription();
    v6 = createMobileActivationError("lockcrypto_extract_public_with_intermediate", 1120, @"com.apple.MobileActivation.ErrorDomain", -1, 0, @"Failed to evaluate trust: %d (%@)", v10, v11);

    if (a2)
    {
      goto LABEL_9;
    }

LABEL_12:
    v8 = 0;
    goto LABEL_13;
  }

  v13 = SecTrustCopyPublicKey(trust);
  if (!v13)
  {
    MobileActivationError = createMobileActivationError("lockcrypto_extract_public_with_intermediate", 1129, @"com.apple.MobileActivation.ErrorDomain", -1, 0, @"Failed to copy public key.");
LABEL_8:
    v6 = MobileActivationError;
    if (a2)
    {
      goto LABEL_9;
    }

    goto LABEL_12;
  }

  v8 = v13;
  v6 = 0;
LABEL_13:
  if (trust)
  {
    CFRelease(trust);
  }

  trust = 0;
  if (v4)
  {
    CFRelease(v4);
  }

  return v8;
}

char *lockcrypto_create_cert_request(void *a1, void *a2, void *a3, NSError **a4)
{
  v7 = a1;
  v8 = a2;
  v9 = a3;
  v10 = v9;
  v57 = kSecOidCommonName;
  v58 = SecASN1PrintableString;
  v59 = v7;
  v60 = 0;
  v61 = 0;
  v62 = 0;
  v51 = kSecOidCountryName;
  v52 = SecASN1PrintableString;
  v53 = @"US";
  v54 = 0;
  v55 = 0;
  v56 = 0;
  v45 = kSecOidStateProvinceName;
  v46 = SecASN1PrintableString;
  v47 = @"CA";
  v48 = 0;
  v49 = 0;
  v50 = 0;
  v39 = kSecOidLocalityName;
  v40 = SecASN1PrintableString;
  v41 = @"Cupertino";
  v42 = 0;
  v43 = 0;
  v44 = 0;
  v33 = kSecOidOrganization;
  v34 = SecASN1PrintableString;
  v35 = @"Apple Inc.";
  v36 = 0;
  v37 = 0;
  v38 = 0;
  v26[7] = 0;
  v27 = kSecOidOrganizationalUnit;
  v28 = SecASN1PrintableString;
  v29 = @"iPhone";
  v30 = 0;
  v31 = 0;
  v32 = 0;
  v26[1] = &v57;
  v26[2] = &v51;
  v26[3] = &v45;
  v26[4] = &v39;
  v26[5] = &v33;
  v26[6] = &v27;
  if (!v8 || !v9)
  {
    v19 = createMobileActivationError("lockcrypto_create_cert_request", 1166, @"com.apple.MobileActivation.ErrorDomain", -2, 0, @"Invalid input(s).");
    v11 = 0;
LABEL_11:
    v14 = 0;
    goto LABEL_12;
  }

  v26[0] = 0;
  v11 = lockcrypto_public_key_from_pem_data(v8, v26);
  v12 = v26[0];
  v13 = v12;
  if (!v11)
  {
    v19 = createMobileActivationError("lockcrypto_create_cert_request", 1172, @"com.apple.MobileActivation.ErrorDomain", -1, v12, @"Failed to retrieve public key from data.");

    goto LABEL_11;
  }

  v25 = v12;
  v14 = lockcrypto_private_key_from_pem_data(v10, &v25);
  v15 = v25;

  if (!v14)
  {
    v19 = createMobileActivationError("lockcrypto_create_cert_request", 1178, @"com.apple.MobileActivation.ErrorDomain", -1, v15, @"Failed to retrieve private key from data.");

LABEL_12:
    v17 = 0;
    if (!a4)
    {
      goto LABEL_14;
    }

    goto LABEL_13;
  }

  CertificateRequestWithParameters = SecGenerateCertificateRequestWithParameters();
  v17 = CertificateRequestWithParameters;
  if (!CertificateRequestWithParameters)
  {
    v19 = createMobileActivationError("lockcrypto_create_cert_request", 1184, @"com.apple.MobileActivation.ErrorDomain", -1, 0, @"Failed to generate certificate request.");

    if (!a4)
    {
LABEL_14:
      v18 = 0;
      v22 = 0;
      if (!v11)
      {
        goto LABEL_16;
      }

      goto LABEL_15;
    }

LABEL_13:
    v21 = v19;
    *a4 = v19;
    goto LABEL_14;
  }

  v24 = v15;
  v18 = lockcrypto_create_pem(CertificateRequestWithParameters, "CERTIFICATE REQUEST", &v24);
  v19 = v24;

  if (!v18)
  {
    v20 = createMobileActivationError("lockcrypto_create_cert_request", 1190, @"com.apple.MobileActivation.ErrorDomain", -1, v19, @"Failed to encode the certificate request.");

    v19 = v20;
    if (!a4)
    {
      goto LABEL_14;
    }

    goto LABEL_13;
  }

LABEL_15:
  CFRelease(v11);
  v22 = v18;
LABEL_16:
  if (v14)
  {
    CFRelease(v14);
  }

  return v22;
}

uint64_t lockcrypto_public_key_from_pem_data(void *a1, NSError **a2)
{
  v3 = a1;
  v4 = v3;
  if (!v3)
  {
    v6 = createMobileActivationError("lockcrypto_public_key_from_pem_data", 1808, @"com.apple.MobileActivation.ErrorDomain", -2, 0, @"Invalid input.");
    v5 = 0;
    if (a2)
    {
LABEL_10:
      v11 = v6;
      v8 = 0;
      *a2 = v6;
      goto LABEL_11;
    }

LABEL_6:
    v8 = 0;
    goto LABEL_11;
  }

  v13 = 0;
  v5 = lockcrypto_decode_pem(v3, "RSA PUBLIC KEY", &v13);
  v6 = v13;
  if (!v5)
  {
    MobileActivationError = createMobileActivationError("lockcrypto_public_key_from_pem_data", 1814, @"com.apple.MobileActivation.ErrorDomain", -1, v6, @"Failed to decode data.");
    goto LABEL_9;
  }

  [v5 bytes];
  [v5 length];
  RSAPublicKey = SecKeyCreateRSAPublicKey();
  if (!RSAPublicKey)
  {
    MobileActivationError = createMobileActivationError("lockcrypto_public_key_from_pem_data", 1820, @"com.apple.MobileActivation.ErrorDomain", -1, 0, @"Failed to create public key from data.");
LABEL_9:
    v10 = MobileActivationError;

    v6 = v10;
    if (a2)
    {
      goto LABEL_10;
    }

    goto LABEL_6;
  }

  v8 = RSAPublicKey;
LABEL_11:

  return v8;
}

SecKeyRef lockcrypto_private_key_from_pem_data(void *a1, NSError **a2)
{
  v3 = a1;
  v4 = v3;
  error = 0;
  if (v3)
  {
    v13 = 0;
    v5 = lockcrypto_decode_pem(v3, "RSA PRIVATE KEY", &v13);
    v6 = v13;
    if (v5)
    {
      v15[0] = kSecAttrKeyType;
      v15[1] = kSecAttrKeyClass;
      v16[0] = kSecAttrKeyTypeRSA;
      v16[1] = kSecAttrKeyClassPrivate;
      v7 = [NSDictionary dictionaryWithObjects:v16 forKeys:v15 count:2];
      v8 = SecKeyCreateWithData(v5, v7, &error);
      if (v8)
      {
        v9 = v8;
        goto LABEL_11;
      }

      v10 = createMobileActivationError("lockcrypto_private_key_from_pem_data", 1785, @"com.apple.MobileActivation.ErrorDomain", -1, error, @"Failed to create private key from key data.");
    }

    else
    {
      v10 = createMobileActivationError("lockcrypto_private_key_from_pem_data", 1775, @"com.apple.MobileActivation.ErrorDomain", -1, v6, @"Failed to decode data.");

      v7 = 0;
    }

    v6 = v10;
    if (a2)
    {
      goto LABEL_10;
    }

LABEL_6:
    v9 = 0;
    goto LABEL_11;
  }

  v6 = createMobileActivationError("lockcrypto_private_key_from_pem_data", 1769, @"com.apple.MobileActivation.ErrorDomain", -2, 0, @"Invalid input.");
  v5 = 0;
  v7 = 0;
  if (!a2)
  {
    goto LABEL_6;
  }

LABEL_10:
  v11 = v6;
  v9 = 0;
  *a2 = v6;
LABEL_11:
  if (error)
  {
    CFRelease(error);
  }

  error = 0;

  return v9;
}

uint64_t lockcrypto_verify_device_cert(uint64_t a1, uint64_t a2, uint64_t a3, NSError **a4)
{
  trust = 0;
  result = kSecTrustResultInvalid;
  if (!a1 || !a2)
  {
    v12 = createMobileActivationError("lockcrypto_verify_device_cert", 1222, @"com.apple.MobileActivation.ErrorDomain", -1, 0, @"Invalid input(s).");
    v6 = 0;
    FactoryDeviceCertificate = 0;
    v8 = 0;
    if (a4)
    {
      goto LABEL_9;
    }

LABEL_13:
    v14 = 0;
    goto LABEL_14;
  }

  if (a3)
  {
    v21[0] = a1;
    v21[1] = a2;
    v21[2] = a3;
    v6 = [NSArray arrayWithObjects:v21 count:3];
    FactoryDeviceCertificate = SecPolicyCreateiPhoneDeviceCertificate();
    v8 = 0;
    if (!SecTrustCreateWithCertificates(v6, FactoryDeviceCertificate, &trust))
    {
      goto LABEL_5;
    }

    goto LABEL_11;
  }

  v20 = a1;
  v6 = [NSArray arrayWithObjects:&v20 count:1];
  v19 = a2;
  v8 = [NSArray arrayWithObjects:&v19 count:1];
  FactoryDeviceCertificate = SecPolicyCreateFactoryDeviceCertificate();
  if (SecTrustCreateWithCertificates(v6, FactoryDeviceCertificate, &trust))
  {
LABEL_11:
    MobileActivationError = createMobileActivationError("lockcrypto_verify_device_cert", 1236, @"com.apple.MobileActivation.ErrorDomain", -1, 0, @"Failed to trust.");
    goto LABEL_12;
  }

  if (v8 && SecTrustSetAnchorCertificates(trust, v8))
  {
    MobileActivationError = createMobileActivationError("lockcrypto_verify_device_cert", 1241, @"com.apple.MobileActivation.ErrorDomain", -1, 0, @"Failed to set anchor certs.");
LABEL_12:
    v12 = MobileActivationError;
    if (a4)
    {
      goto LABEL_9;
    }

    goto LABEL_13;
  }

LABEL_5:
  v9 = SecTrustEvaluate(trust, &result);
  v10 = result;
  if (v9 || (v12 = 0, v14 = 1, result != kSecTrustResultProceed) && result != kSecTrustResultUnspecified)
  {
    v11 = SecTrustCopyFailureDescription();
    v12 = createMobileActivationError("lockcrypto_verify_device_cert", 1249, @"com.apple.MobileActivation.ErrorDomain", -1, 0, @"Failed to evaluate trust: %d (%@)", v10, v11);

    if (!a4)
    {
      goto LABEL_13;
    }

LABEL_9:
    v13 = v12;
    v14 = 0;
    *a4 = v12;
  }

LABEL_14:
  if (FactoryDeviceCertificate)
  {
    CFRelease(FactoryDeviceCertificate);
  }

  if (trust)
  {
    CFRelease(trust);
  }

  trust = 0;

  return v14;
}

uint64_t lockcrypto_verify_factory_ucrt(__SecCertificate *a1, uint64_t a2, id a3, NSError **a4)
{
  v7 = a3;
  v8 = v7;
  result = kSecTrustResultInvalid;
  cf = 0;
  trust = 0;
  if (!a1 || !a2 || !v7)
  {
    v13 = createMobileActivationError("lockcrypto_verify_factory_ucrt", 1289, @"com.apple.MobileActivation.ErrorDomain", -2, 0, @"Invalid input(s).");
    v9 = 0;
    v10 = 0;
    v14 = 0;
    v15 = 0;
    v16 = 0;
    AppleFDRProvisioning = 0;
    if (!a4)
    {
      goto LABEL_15;
    }

    goto LABEL_14;
  }

  v35 = a1;
  v9 = [NSArray arrayWithObjects:&v35 count:1];
  v34 = a2;
  v10 = [NSArray arrayWithObjects:&v34 count:1];
  AppleFDRProvisioning = SecPolicyCreateAppleFDRProvisioning();
  if (!AppleFDRProvisioning)
  {
    MobileActivationError = createMobileActivationError("lockcrypto_verify_factory_ucrt", 1298, @"com.apple.MobileActivation.ErrorDomain", -1, 0, @"Failed to create policy.");
    goto LABEL_12;
  }

  if (SecTrustCreateWithCertificates(v9, AppleFDRProvisioning, &trust))
  {
    MobileActivationError = createMobileActivationError("lockcrypto_verify_factory_ucrt", 1303, @"com.apple.MobileActivation.ErrorDomain", -1, 0, @"Failed to create trust.");
LABEL_12:
    v13 = MobileActivationError;
    goto LABEL_13;
  }

  if (SecTrustSetAnchorCertificates(trust, v10))
  {
    MobileActivationError = createMobileActivationError("lockcrypto_verify_factory_ucrt", 1308, @"com.apple.MobileActivation.ErrorDomain", -1, 0, @"Failed to set anchors.");
    goto LABEL_12;
  }

  v21 = SecTrustEvaluate(trust, &result);
  v22 = result;
  if (v21 || result != kSecTrustResultProceed && result != kSecTrustResultUnspecified)
  {
    v23 = SecTrustCopyFailureDescription();
    v13 = createMobileActivationError("lockcrypto_verify_factory_ucrt", 1316, @"com.apple.MobileActivation.ErrorDomain", -1, 0, @"Failed to evaluate trust: %d (%@)", v22, v23);

LABEL_13:
    v14 = 0;
    v15 = 0;
    v16 = 0;
    if (!a4)
    {
      goto LABEL_15;
    }

    goto LABEL_14;
  }

  v24 = SecCertificateCopyCommonName(a1, &cf);
  if (v24)
  {
    MobileActivationError = createMobileActivationError("lockcrypto_verify_factory_ucrt", 1322, @"com.apple.MobileActivation.ErrorDomain", -1, 0, @"Failed to copy common name: %d", v24);
    goto LABEL_12;
  }

  v30 = 0;
  v14 = libaks_system_key_get_public(1, 1, &v30);
  v13 = v30;
  if (!v14)
  {
    v26 = createMobileActivationError("lockcrypto_verify_factory_ucrt", 1328, @"com.apple.MobileActivation.ErrorDomain", -1, v13, @"Failed to query SIK public key.");

    v15 = 0;
LABEL_35:
    v16 = 0;
    goto LABEL_39;
  }

  v15 = [v14 hexString];
  if (!v15)
  {
    v26 = createMobileActivationError("lockcrypto_verify_factory_ucrt", 1334, @"com.apple.MobileActivation.ErrorDomain", -1, 0, @"Failed to allocate string from data.");

    goto LABEL_35;
  }

  v25 = [[NSString alloc] initWithFormat:@"sik-%@-%@", v8, v15];
  v16 = v25;
  if (!v25)
  {
    v27 = createMobileActivationError("lockcrypto_verify_factory_ucrt", 1340, @"com.apple.MobileActivation.ErrorDomain", -1, 0, @"Failed to create string.", v28, v29);
LABEL_38:
    v26 = v27;

LABEL_39:
    v13 = v26;
    if (!a4)
    {
LABEL_15:
      v18 = 0;
      v19 = 0;
      if (!AppleFDRProvisioning)
      {
        goto LABEL_17;
      }

      goto LABEL_16;
    }

LABEL_14:
    v17 = v13;
    *a4 = v13;
    goto LABEL_15;
  }

  if (([v25 isEqualToString:cf] & 1) == 0)
  {
    v27 = createMobileActivationError("lockcrypto_verify_factory_ucrt", 1345, @"com.apple.MobileActivation.ErrorDomain", -1, 0, @"Invalid factory UCRT common name (actual, expected): %@, %@", cf, v16);
    goto LABEL_38;
  }

  v18 = 1;
LABEL_16:
  CFRelease(AppleFDRProvisioning);
  v19 = v18;
LABEL_17:
  if (trust)
  {
    CFRelease(trust);
  }

  trust = 0;
  if (cf)
  {
    CFRelease(cf);
  }

  return v19;
}

id lockcrypto_decode_error(void *a1, NSError **a2)
{
  v3 = a1;
  v4 = v3;
  v29 = 0u;
  v30 = 0u;
  v27 = 0u;
  v28 = 0u;
  v25 = 0u;
  *__str = 0u;
  v23 = 0u;
  v24 = 0u;
  *__little = 0u;
  v22 = 0u;
  if (v3)
  {
    v5 = [v3 bytes];
    v6 = [v4 length];
    if (v6)
    {
      v7 = v6;
      v8 = snprintf(__str, 0x50uLL, "-----BEGIN %s-----\n", "ERROR");
      snprintf(__little, 0x50uLL, "\n-----END %s-----", "ERROR");
      v9 = strnstr(v5, __str, v7);
      v10 = strnstr(v5, __little, v7);
      if (v9 && v10)
      {
        v11 = [[NSData alloc] initWithBytesNoCopy:&v9[v8] length:v10 - &v9[v8] freeWhenDone:0];
        if (v11)
        {
          v12 = [[NSString alloc] initWithData:v11 encoding:4];
          if (v12)
          {
            v13 = v12;
            v14 = 0;
            goto LABEL_18;
          }

          MobileActivationError = createMobileActivationError("lockcrypto_decode_error", 1466, @"com.apple.MobileActivation.ErrorDomain", -1, 0, @"Failed to create string.");
        }

        else
        {
          MobileActivationError = createMobileActivationError("lockcrypto_decode_error", 1460, @"com.apple.MobileActivation.ErrorDomain", -1, 0, @"Failed to decode data.");
        }

        v14 = MobileActivationError;
        if (!a2)
        {
          goto LABEL_17;
        }

LABEL_13:
        v18 = v14;
        v13 = 0;
        *a2 = v14;
        goto LABEL_18;
      }

      v16 = @"Invalid error data.";
      v17 = 1452;
    }

    else
    {
      v16 = @"Invalid data length.";
      v17 = 1442;
    }

    v15 = createMobileActivationError("lockcrypto_decode_error", v17, @"com.apple.MobileActivation.ErrorDomain", -1, 0, v16);
  }

  else
  {
    v15 = createMobileActivationError("lockcrypto_decode_error", 1435, @"com.apple.MobileActivation.ErrorDomain", -2, 0, @"Invalid input.");
  }

  v14 = v15;
  v11 = 0;
  if (a2)
  {
    goto LABEL_13;
  }

LABEL_17:
  v13 = 0;
LABEL_18:

  return v13;
}

id lockcrypto_decode_pem(void *a1, const char *a2, NSError **a3)
{
  v5 = a1;
  v6 = v5;
  v30 = 0u;
  v31 = 0u;
  v28 = 0u;
  v29 = 0u;
  v26 = 0u;
  *__str = 0u;
  v24 = 0u;
  v25 = 0u;
  *__little = 0u;
  v23 = 0u;
  if (v5 && a2)
  {
    v7 = [v5 bytes];
    v8 = [v6 length];
    if ((v8 & 0x8000000000000000) != 0)
    {
      v18 = @"Invalid data length.";
      v19 = 1496;
    }

    else
    {
      v9 = v8;
      v10 = snprintf(__str, 0x50uLL, "-----BEGIN %s-----\n", a2);
      snprintf(__little, 0x50uLL, "\n-----END %s-----", a2);
      v11 = strnstr(v7, __str, v9);
      v12 = strnstr(v7, __little, v9);
      if (v11 && v12)
      {
        v13 = [[NSData alloc] initWithBytesNoCopy:&v11[v10] length:v12 - &v11[v10] freeWhenDone:0];
        v14 = [[NSData alloc] initWithBase64EncodedData:v13 options:1];
        if (v14)
        {
          v15 = v14;
          v16 = 0;
          goto LABEL_16;
        }

        v16 = createMobileActivationError("lockcrypto_decode_pem", 1516, @"com.apple.MobileActivation.ErrorDomain", -1, 0, @"Failed to decode data.");
        if (!a3)
        {
          goto LABEL_15;
        }

LABEL_13:
        v20 = v16;
        v15 = 0;
        *a3 = v16;
        goto LABEL_16;
      }

      v18 = @"Invalid pem data.";
      v19 = 1505;
    }

    MobileActivationError = createMobileActivationError("lockcrypto_decode_pem", v19, @"com.apple.MobileActivation.ErrorDomain", -1, 0, v18);
  }

  else
  {
    MobileActivationError = createMobileActivationError("lockcrypto_decode_pem", 1489, @"com.apple.MobileActivation.ErrorDomain", -2, 0, @"Invalid inputs.");
  }

  v16 = MobileActivationError;
  v13 = 0;
  if (a3)
  {
    goto LABEL_13;
  }

LABEL_15:
  v15 = 0;
LABEL_16:

  return v15;
}

id lockcrypto_decode_pems(void *a1, const char *a2, NSError **a3)
{
  v5 = a1;
  v30 = 0u;
  v31 = 0u;
  v28 = 0u;
  v29 = 0u;
  v26 = 0u;
  *__str = 0u;
  v24 = 0u;
  v25 = 0u;
  *__little = 0u;
  v23 = 0u;
  if (!v5 || !a2)
  {
    v11 = createMobileActivationError("lockcrypto_decode_pems", 1547, @"com.apple.MobileActivation.ErrorDomain", -1, 0, @"Invalid input(s).");
    v9 = 0;
    goto LABEL_13;
  }

  v6 = objc_alloc_init(NSMutableArray);
  if (!v6)
  {
    v11 = createMobileActivationError("lockcrypto_decode_pems", 1553, @"com.apple.MobileActivation.ErrorDomain", -1, 0, @"Failed to allocate array.");
    v9 = 0;
    goto LABEL_23;
  }

  v7 = [v5 bytes];
  v8 = [v5 length];
  v9 = 0;
  if (v7)
  {
    v10 = v8;
    v11 = 0;
    if (v8 >= 1)
    {
      v21 = a3;
      v12 = 0;
      while (1)
      {
        v13 = snprintf(__str, 0x50uLL, "-----BEGIN %s-----\n", a2);
        v14 = snprintf(__little, 0x50uLL, "\n-----END %s-----", a2);
        v15 = strnstr(v7, __str, v10);
        v16 = strnstr(v7, __little, v10);
        if (!v15)
        {
          break;
        }

        v11 = v16;
        if (!v16)
        {
          goto LABEL_18;
        }

        v17 = [[NSData alloc] initWithBytesNoCopy:&v15[v13] length:v16 - &v15[v13] freeWhenDone:0];
        v9 = [[NSData alloc] initWithBase64EncodedData:v17 options:1];

        if (!v9)
        {
          v11 = createMobileActivationError("lockcrypto_decode_pems", 1582, @"com.apple.MobileActivation.ErrorDomain", -1, 0, @"Failed to decode data.");

          goto LABEL_19;
        }

        [v6 addObject:v9];
        v18 = v11 + v14;
        v10 = &v7[v10] - v18;

        v7 = v18;
        v12 = v9;
        if (v10 <= 0)
        {
          v11 = 0;
          goto LABEL_19;
        }
      }

      v11 = 0;
LABEL_18:
      v9 = v12;
LABEL_19:
      a3 = v21;
    }
  }

  else
  {
    v11 = 0;
  }

  if (![v6 count])
  {

    if (a3)
    {
      v19 = v11;
      v6 = 0;
      *a3 = v11;
      goto LABEL_23;
    }

LABEL_13:
    v6 = 0;
  }

LABEL_23:

  return v6;
}

id lockcrypto_decode_pem_trailing_data(void *a1, uint64_t a2, NSError **a3)
{
  v5 = a1;
  if (!v5 || !a2)
  {
    v11 = createMobileActivationError("lockcrypto_decode_pem_trailing_data", 1615, @"com.apple.MobileActivation.ErrorDomain", -2, 0, @"Invalid input(s).");
    v7 = 0;
    v6 = 0;
    if (a3)
    {
      goto LABEL_18;
    }

LABEL_10:
    v12 = 0;
    goto LABEL_19;
  }

  v6 = [[NSString alloc] initWithData:v5 encoding:4];
  if (!v6)
  {
    v11 = createMobileActivationError("lockcrypto_decode_pem_trailing_data", 1621, @"com.apple.MobileActivation.ErrorDomain", -1, 0, @"Failed to create string from pem data.");
    v7 = 0;
    if (a3)
    {
      goto LABEL_18;
    }

    goto LABEL_10;
  }

  v7 = [[NSString alloc] initWithFormat:@"\n-----END %s-----", a2];
  if (v7)
  {
    v8 = [v6 rangeOfString:v7];
    if (v8 == 0x7FFFFFFFFFFFFFFFLL)
    {
      MobileActivationError = createMobileActivationError("lockcrypto_decode_pem_trailing_data", 1633, @"com.apple.MobileActivation.ErrorDomain", -1, 0, @"String does not exist.");
    }

    else
    {
      v13 = v8;
      v14 = v9;
      if (v8 >= [v5 length] || &v13[v14] >= objc_msgSend(v5, "length"))
      {
        MobileActivationError = createMobileActivationError("lockcrypto_decode_pem_trailing_data", 1638, @"com.apple.MobileActivation.ErrorDomain", -1, 0, @"Invalid or no trailing data.");
      }

      else
      {
        v15 = [[NSData alloc] initWithBytes:&v13[objc_msgSend(v5 length:{"bytes") + v14], objc_msgSend(v5, "length") - &v13[v14]}];
        if (v15)
        {
          v12 = v15;
          v11 = 0;
          goto LABEL_19;
        }

        MobileActivationError = createMobileActivationError("lockcrypto_decode_pem_trailing_data", 1644, @"com.apple.MobileActivation.ErrorDomain", -1, 0, @"Failed to encode data.");
      }
    }
  }

  else
  {
    MobileActivationError = createMobileActivationError("lockcrypto_decode_pem_trailing_data", 1627, @"com.apple.MobileActivation.ErrorDomain", -1, 0, @"Failed to create string.");
  }

  v11 = MobileActivationError;
  if (!a3)
  {
    goto LABEL_10;
  }

LABEL_18:
  v11 = v11;
  v12 = 0;
  *a3 = v11;
LABEL_19:

  return v12;
}

id lockcrypto_trailing_data_from_cert_pem_data(void *a1, NSError **a2)
{
  v3 = a1;
  v4 = v3;
  if (v3)
  {
    v10 = 0;
    v5 = lockcrypto_decode_pem_trailing_data(v3, "CERTIFICATE", &v10);
    v6 = v10;
    if (v5)
    {
      goto LABEL_7;
    }

    v7 = createMobileActivationError("lockcrypto_trailing_data_from_cert_pem_data", 1670, @"com.apple.MobileActivation.ErrorDomain", -1, v6, @"Failed to retrieve trailing pem data.");

    v6 = v7;
    if (!a2)
    {
      goto LABEL_4;
    }
  }

  else
  {
    v6 = createMobileActivationError("lockcrypto_trailing_data_from_cert_pem_data", 1664, @"com.apple.MobileActivation.ErrorDomain", -2, 0, @"Invalid input.");
    if (!a2)
    {
LABEL_4:
      v5 = 0;
      goto LABEL_7;
    }
  }

  v8 = v6;
  v5 = 0;
  *a2 = v6;
LABEL_7:

  return v5;
}

uint64_t lockcrypto_identity_from_pem_data(void *a1, void *a2, NSError **a3)
{
  v5 = a1;
  v6 = a2;
  v7 = v6;
  if (!v5 || !v6)
  {
    v12 = createMobileActivationError("lockcrypto_identity_from_pem_data", 1692, @"com.apple.MobileActivation.ErrorDomain", -2, 0, @"Invalid input(s).");
    v8 = 0;
    goto LABEL_9;
  }

  v21 = 0;
  v8 = lockcrypto_cert_from_pem_data(v5, &v21);
  v9 = v21;
  v10 = v9;
  if (!v8)
  {
    v12 = createMobileActivationError("lockcrypto_identity_from_pem_data", 1698, @"com.apple.MobileActivation.ErrorDomain", -1, v9, @"Failed to get certificate from pem data.");

LABEL_9:
    v11 = 0;
    if (!a3)
    {
      goto LABEL_11;
    }

    goto LABEL_10;
  }

  v20 = v9;
  v11 = lockcrypto_private_key_from_pem_data(v7, &v20);
  v12 = v20;

  if (!v11)
  {
    MobileActivationError = createMobileActivationError("lockcrypto_identity_from_pem_data", 1704, @"com.apple.MobileActivation.ErrorDomain", -1, v12, @"Failed to get private key from pem data.");
    goto LABEL_18;
  }

  v13 = SecIdentityCreate();
  if (!v13)
  {
    MobileActivationError = createMobileActivationError("lockcrypto_identity_from_pem_data", 1710, @"com.apple.MobileActivation.ErrorDomain", -1, 0, @"Failed to create identity from certificate/private key.");
LABEL_18:
    v19 = MobileActivationError;

    v12 = v19;
    if (!a3)
    {
LABEL_11:
      v14 = 0;
      v16 = 0;
      if (!v11)
      {
        goto LABEL_13;
      }

      goto LABEL_12;
    }

LABEL_10:
    v15 = v12;
    *a3 = v12;
    goto LABEL_11;
  }

  v14 = v13;
LABEL_12:
  CFRelease(v11);
  v16 = v14;
LABEL_13:
  if (v8)
  {
    CFRelease(v8);
  }

  return v16;
}

SecCertificateRef lockcrypto_cert_from_pem_data(void *a1, NSError **a2)
{
  v3 = a1;
  v4 = v3;
  if (!v3)
  {
    v6 = createMobileActivationError("lockcrypto_cert_from_pem_data", 1734, @"com.apple.MobileActivation.ErrorDomain", -2, 0, @"Invalid input.");
    v5 = 0;
    if (a2)
    {
LABEL_10:
      v11 = v6;
      v8 = 0;
      *a2 = v6;
      goto LABEL_11;
    }

LABEL_6:
    v8 = 0;
    goto LABEL_11;
  }

  v13 = 0;
  v5 = lockcrypto_decode_pem(v3, "CERTIFICATE", &v13);
  v6 = v13;
  if (!v5)
  {
    MobileActivationError = createMobileActivationError("lockcrypto_cert_from_pem_data", 1740, @"com.apple.MobileActivation.ErrorDomain", -1, v6, @"Failed to decode data.");
    goto LABEL_9;
  }

  v7 = SecCertificateCreateWithData(kCFAllocatorDefault, v5);
  if (!v7)
  {
    MobileActivationError = createMobileActivationError("lockcrypto_cert_from_pem_data", 1746, @"com.apple.MobileActivation.ErrorDomain", -1, 0, @"Failed to create certificate with cert data.");
LABEL_9:
    v10 = MobileActivationError;

    v6 = v10;
    if (a2)
    {
      goto LABEL_10;
    }

    goto LABEL_6;
  }

  v8 = v7;
LABEL_11:

  return v8;
}

NSDate *lockcrypto_copy_certificate_validity_date(uint64_t a1, int a2, NSError **a3)
{
  if (!a1)
  {
    MobileActivationError = createMobileActivationError("lockcrypto_copy_certificate_validity_date", 1842, @"com.apple.MobileActivation.ErrorDomain", -2, 0, @"Invalid input.");
    goto LABEL_12;
  }

  if (!a2)
  {
    SecCertificateNotValidBefore();
    if (v8 == 0.0)
    {
      v5 = @"Failed to obtain 'not valid before' date.";
      v6 = 1855;
      goto LABEL_11;
    }

LABEL_8:
    v9 = [NSDate dateWithTimeIntervalSinceReferenceDate:?];
    if (v9)
    {
      v10 = v9;
      v11 = 0;
      goto LABEL_15;
    }

    v5 = @"Failed to convert validity date.";
    v6 = 1862;
    goto LABEL_11;
  }

  SecCertificateNotValidAfter();
  if (v4 != 0.0)
  {
    goto LABEL_8;
  }

  v5 = @"Failed to obtain 'not valid after' date.";
  v6 = 1849;
LABEL_11:
  MobileActivationError = createMobileActivationError("lockcrypto_copy_certificate_validity_date", v6, @"com.apple.MobileActivation.ErrorDomain", -1, 0, v5);
LABEL_12:
  v12 = MobileActivationError;
  v11 = v12;
  if (a3)
  {
    v13 = v12;
    v10 = 0;
    *a3 = v11;
  }

  else
  {
    v10 = 0;
  }

LABEL_15:

  return v10;
}

void __lockcrypto_query_oid_der_sequence_data_block_invoke(id a1)
{
  v1 = [NSData dataWithBytes:&unk_10035B3CE length:2];
  v2 = lockcrypto_query_oid_der_sequence_data_ASN1DERNull;
  lockcrypto_query_oid_der_sequence_data_ASN1DERNull = v1;
}

BOOL device_supports_mfi_certificates()
{
  v0 = +[DeviceType sharedInstance];
  v1 = [(DeviceType *)v0 device_supports_mfi_certificates];

  return v1;
}

BOOL device_supports_eda_certificates()
{
  v0 = +[DeviceType sharedInstance];
  v1 = [(DeviceType *)v0 device_supports_eda_certificates];

  return v1;
}

BOOL device_supports_dcrt_oob()
{
  v0 = +[DeviceType sharedInstance];
  v1 = [(DeviceType *)v0 device_supports_dcrt_oob];

  return v1;
}

BOOL is_prodfused_demoted()
{
  v0 = +[DeviceType sharedInstance];
  v1 = [(DeviceType *)v0 is_prodfused_demoted];

  return v1;
}

BOOL is_devfused_undemoted()
{
  v0 = +[DeviceType sharedInstance];
  v1 = [(DeviceType *)v0 is_devfused_undemoted];

  return v1;
}

BOOL is_dev_board()
{
  v0 = +[DeviceType sharedInstance];
  v1 = [(DeviceType *)v0 is_dev_board];

  return v1;
}

BOOL is_product_fpga()
{
  v0 = +[DeviceType sharedInstance];
  v1 = [(DeviceType *)v0 is_fpga];

  return v1;
}

NSString *get_device_type()
{
  v0 = +[DeviceType sharedInstance];
  v1 = [(DeviceType *)v0 product_type];

  return v1;
}

BOOL is_product_pod()
{
  v0 = +[DeviceType sharedInstance];
  v1 = [(DeviceType *)v0 is_ipod];

  return v1;
}

BOOL is_product_pad()
{
  v0 = +[DeviceType sharedInstance];
  v1 = [(DeviceType *)v0 is_ipad];

  return v1;
}

BOOL is_product_phone()
{
  v0 = +[DeviceType sharedInstance];
  v1 = [(DeviceType *)v0 is_iphone];

  return v1;
}

BOOL is_product_cellular()
{
  v0 = +[DeviceType sharedInstance];
  v1 = [(DeviceType *)v0 has_baseband];

  return v1;
}

BOOL is_product_audio_accessory()
{
  v0 = +[DeviceType sharedInstance];
  v1 = [(DeviceType *)v0 is_audio_accessory];

  return v1;
}

BOOL is_internal_build()
{
  v0 = +[DeviceType sharedInstance];
  v1 = [(DeviceType *)v0 is_internal_build];

  return v1;
}

BOOL has_internal_diagnostics()
{
  v0 = +[DeviceType sharedInstance];
  v1 = [(DeviceType *)v0 has_internal_diagnostics];

  return v1;
}

NSString *get_device_class()
{
  v0 = +[DeviceType sharedInstance];
  v1 = [(DeviceType *)v0 device_class];

  return v1;
}

BOOL use_hactivation()
{
  v0 = +[DeviceType sharedInstance];
  v1 = [(DeviceType *)v0 should_hactivate];

  return v1;
}

id copy_bootsession_uuid()
{
  v0 = +[DeviceType sharedInstance];
  v1 = [(DeviceType *)v0 copyBootSessionUUID];

  return v1;
}

NSString *copy_soc_generation()
{
  v0 = +[DeviceType sharedInstance];
  v1 = [(DeviceType *)v0 soc_generation];

  return v1;
}

id copy_trusted_local_policy_hash()
{
  v0 = +[DeviceType sharedInstance];
  v1 = [@"IODeviceTree" stringByAppendingString:@":/chosen"];
  v2 = [(DeviceType *)v0 copyDeviceTreeProperty:v1 key:@"trusted-boot-policy-measurement"];

  v3 = isNSData(v2);
  if (!v3)
  {
    goto LABEL_8;
  }

  v4 = v3;
  v5 = [v2 length];

  if (!v5)
  {
    goto LABEL_9;
  }

  v6 = malloc_type_calloc(1uLL, [v2 length], 0x25DEF4D3uLL);
  if (v6)
  {
    v7 = v6;
    [v2 getBytes:v6 length:{objc_msgSend(v2, "length")}];
    if (!*v7 && !memcmp(v7, v7 + 1, [v2 length] - 1))
    {
      v5 = 0;
    }

    else
    {
      v5 = v2;
    }

    free(v7);
  }

  else
  {
LABEL_8:
    v5 = 0;
  }

LABEL_9:

  return v5;
}